{
	"$schema": "http://schema.management.azure.com/schemas/2015-01-01/deploymentTemplate.json#",
	"contentVersion": "1.0.0.0",
	"parameters": {
		"workspaceName": {
			"type": "string",
			"metadata": "Workspace name",
			"defaultValue": "briggs-b-wus-syn-01"
		},
		"AzureSqlDatabase1_connectionString": {
			"type": "secureString",
			"metadata": "Secure string for 'connectionString' of 'AzureSqlDatabase1'"
		},
		"AzureSqlDatabase2_connectionString": {
			"type": "secureString",
			"metadata": "Secure string for 'connectionString' of 'AzureSqlDatabase2'"
		},
		"AzureSynapseAnalytics1_connectionString": {
			"type": "secureString",
			"metadata": "Secure string for 'connectionString' of 'AzureSynapseAnalytics1'"
		},
		"CeridianAPITest_password": {
			"type": "secureString",
			"metadata": "Secure string for 'password' of 'CeridianAPITest'"
		},
		"DS_MDW_SP_connectionString": {
			"type": "secureString",
			"metadata": "Secure string for 'connectionString' of 'DS_MDW_SP'"
		},
		"LS_ADLS_accountKey": {
			"type": "secureString",
			"metadata": "Secure string for 'accountKey' of 'LS_ADLS'"
		},
		"LS_ADLS_1_connectionString": {
			"type": "secureString",
			"metadata": "Secure string for 'connectionString' of 'LS_ADLS_1'"
		},
		"LS_Briggs_AX_connectionString": {
			"type": "secureString",
			"metadata": "Secure string for 'connectionString' of 'LS_Briggs_AX'"
		},
		"LS_Briggs_BIE_DATA_WAREHOUSE_connectionString": {
			"type": "secureString",
			"metadata": "Secure string for 'connectionString' of 'LS_Briggs_BIE_DATA_WAREHOUSE'"
		},
		"LS_Briggs_HR_connectionString": {
			"type": "secureString",
			"metadata": "Secure string for 'connectionString' of 'LS_Briggs_HR'"
		},
		"LS_Briggs_MST_connectionString": {
			"type": "secureString",
			"metadata": "Secure string for 'connectionString' of 'LS_Briggs_MST'"
		},
		"LS_Briggsmdw_MI_User_connectionString": {
			"type": "secureString",
			"metadata": "Secure string for 'connectionString' of 'LS_Briggsmdw_MI_User'"
		},
		"LS_POR_connectionString": {
			"type": "secureString",
			"metadata": "Secure string for 'connectionString' of 'LS_POR'"
		},
		"LS_POR99_connectionString": {
			"type": "secureString",
			"metadata": "Secure string for 'connectionString' of 'LS_POR99'"
		},
		"NewPOR_test_connectionString": {
			"type": "secureString",
			"metadata": "Secure string for 'connectionString' of 'NewPOR_test'"
		},
		"Odbc1_connectionString": {
			"type": "secureString",
			"metadata": "Secure string for 'connectionString' of 'Odbc1'"
		},
		"Odbc1_password": {
			"type": "secureString",
			"metadata": "Secure string for 'password' of 'Odbc1'"
		},
		"Odbc2_connectionString": {
			"type": "secureString",
			"metadata": "Secure string for 'connectionString' of 'Odbc2'"
		},
		"Odbc2_password": {
			"type": "secureString",
			"metadata": "Secure string for 'password' of 'Odbc2'"
		},
		"SFTP_password": {
			"type": "secureString",
			"metadata": "Secure string for 'password' of 'SFTP'"
		},
		"briggs-b-wus-syn-01-WorkspaceDefaultSqlServer_connectionString": {
			"type": "secureString",
			"metadata": "Secure string for 'connectionString' of 'briggs-b-wus-syn-01-WorkspaceDefaultSqlServer'"
		},
		"briggs-p-wus-syn-01-WorkspaceDefaultSqlServer_connectionString": {
			"type": "secureString",
			"metadata": "Secure string for 'connectionString' of 'briggs-p-wus-syn-01-WorkspaceDefaultSqlServer'"
		},
		"CeridianAPITest_properties_typeProperties_url": {
			"type": "string",
			"defaultValue": "https://us61e2-services.dayforcehcm.com/Api/BriggsEquipment/V1/"
		},
		"CeridianAPITest_properties_typeProperties_userName": {
			"type": "string",
			"defaultValue": "ReportingUser"
		},
		"LS_ADLS_properties_typeProperties_url": {
			"type": "string",
			"defaultValue": "https://briggsprdwusdls01.dfs.core.windows.net"
		},
		"NetSuiteDataTeamRESTAPI_properties_typeProperties_url": {
			"type": "string",
			"defaultValue": "https://7183791.suitetalk.api.netsuite.com"
		},
		"NetSuiteRestAPI_properties_typeProperties_url": {
			"type": "string",
			"defaultValue": "https://7183791.suitetalk.api.netsuite.com"
		},
		"Odbc1_properties_typeProperties_userName": {
			"type": "string",
			"defaultValue": "Team-SammonsDataTeam@sammonsindustrial.com"
		},
		"Odbc2_properties_typeProperties_userName": {
			"type": "string",
			"defaultValue": "Team-SammonsDataTeam@sammonsindustrial.com"
		},
		"SFTP_properties_typeProperties_host": {
			"type": "string",
			"defaultValue": "demo.wftpserver.com"
		},
		"SFTP_properties_typeProperties_userName": {
			"type": "string",
			"defaultValue": "demo"
		},
		"briggs-b-wus-syn-01-WorkspaceDefaultStorage_properties_typeProperties_url": {
			"type": "string",
			"defaultValue": "https://briggsbetawusdls01.dfs.core.windows.net"
		},
		"briggs-p-wus-syn-01-WorkspaceDefaultStorage_properties_typeProperties_url": {
			"type": "string",
			"defaultValue": "https://briggsprdwusdls01.dfs.core.windows.net"
		}
	},
	"variables": {
		"workspaceId": "[concat('Microsoft.Synapse/workspaces/', parameters('workspaceName'))]"
	},
	"resources": [
		{
			"name": "[concat(parameters('workspaceName'), '/Event Base Trigger')]",
			"type": "Microsoft.Synapse/workspaces/pipelines",
			"apiVersion": "2019-06-01-preview",
			"properties": {
				"activities": [
					{
						"name": "Copy data1",
						"type": "Copy",
						"dependsOn": [],
						"policy": {
							"timeout": "7.00:00:00",
							"retry": 0,
							"retryIntervalInSeconds": 30,
							"secureOutput": false,
							"secureInput": false
						},
						"userProperties": [],
						"typeProperties": {
							"source": {
								"type": "ParquetSource",
								"storeSettings": {
									"type": "AzureBlobFSReadSettings",
									"recursive": true,
									"enablePartitionDiscovery": false
								}
							},
							"sink": {
								"type": "ParquetSink",
								"storeSettings": {
									"type": "AzureBlobFSWriteSettings"
								},
								"formatSettings": {
									"type": "ParquetWriteSettings"
								}
							},
							"enableStaging": false,
							"translator": {
								"type": "TabularTranslator",
								"typeConversion": true,
								"typeConversionSettings": {
									"allowDataTruncation": true,
									"treatBooleanAsNumber": false
								}
							}
						},
						"inputs": [
							{
								"referenceName": "DS_ADLS_PARQUET_TEST",
								"type": "DatasetReference",
								"parameters": {
									"FileName": "AccountingAPIQueueCustomer.parquet"
								}
							}
						],
						"outputs": [
							{
								"referenceName": "DS_ADLS_PARQUET_TEST",
								"type": "DatasetReference",
								"parameters": {
									"FileName": "AccountingAPIQueueCustomer_out.parquet"
								}
							}
						]
					}
				],
				"policy": {
					"elapsedTimeMetric": {},
					"cancelAfter": {}
				},
				"folder": {
					"name": "MDP POR DataLoad"
				},
				"annotations": [],
				"lastPublishTime": "2022-02-15T12:42:04Z"
			},
			"dependsOn": [
				"[concat(variables('workspaceId'), '/datasets/DS_ADLS_PARQUET_TEST')]"
			]
		},
		{
			"name": "[concat(parameters('workspaceName'), '/Load_POR_TEMP')]",
			"type": "Microsoft.Synapse/workspaces/pipelines",
			"apiVersion": "2019-06-01-preview",
			"properties": {
				"activities": [
					{
						"name": "Heavy Equipment Tax_Updated",
						"type": "Copy",
						"dependsOn": [],
						"policy": {
							"timeout": "7.00:00:00",
							"retry": 0,
							"retryIntervalInSeconds": 30,
							"secureOutput": false,
							"secureInput": false
						},
						"userProperties": [],
						"typeProperties": {
							"source": {
								"type": "SqlServerSource",
								"sqlReaderQuery": " SELECT distinct  CLDT\n  ,CONVERT (varchar(10),CLDT, 101) as ClosedDate\n  ,CASE LEFT(t.CNTR,1) \n\t  WHEN 'c' THEN 'Credit'\n\t  ELSE 'Invoice'\n\t  END AS TransactionType,\n      t.CNTR as 'Contract'\n\t, cust.[KEY] AS 'POR Customer'\n\t, cust.[NAME] As 'Customer Name'\n\t, cust.APILink AS NetSuiteCustomer\n\t,[STR] AS 'Store'\n\t,CASE SUBSTRING(TXTY,1,1)\n\t\t\tWHEN 'R' THEN 'Rental'\n\t\t\tWHEN 'S' THEN 'Sale'\n\t\t\tEND AS LinePrimaryStatus\n\t\t--CASE SUBSTRING(TXTY,2,1)\n\t\t--\tWHEN 'R' THEN 'Returned'\n\t\t--\tWHEN 'X' THEN 'Prev Returned'\n\t\t--\tWHEN 'H' THEN 'Not Returned. Hold'\n\t\t--\tWHEN 'S' THEN 'Sales Item'\n\t\t--\tWHEN 'A' THEN 'Sold Asset'\n\t\t--\tWHEN 'D' THEN 'Not Returned'\n\t\t--\tWHEN 'M' THEN 'Not Returned Reservation'\n\t\t--\tWHEN 'N' THEN 'Not Returned'\n\t\t--\tWHEN ' ' THEN 'Not Returned'\n\t\t--ELSE 'UNKNOWN'\n\t\t--END AS LineSecondaryStatus\n\t,cat.[Name] AS CatDesc\n\t,ifile.[KEY] AS ItemKey\n\t,ifile.NUM AS ItemNumber\n\t,ifile.[Name] As EquipDesc\n\t,FUEL\n\t,MANF AS Manufacturer\n\t,MODN AS ModelNumber\n\t,ModelYear\n\t,SerialNumber\n\t,DEPA AS AssetCost\n\t,PRIC AS ItemAmount,\n\tgetdate() last_refresh_date\n    FROM [POR].dbo.Transactions t\n        JOIN [POR].dbo.AccountingAPIQueueTR api ON api.ContractNumber = t.CNTR\n        JOIN [POR].dbo.TransactionItems i ON i.CNTR = t.CNTR\n        JOIN [POR].dbo.ItemFile ifile ON ifile.NUM = i.ITEM  ---\n        JOIN [POR].dbo.ItemCategory cat ON ifile.Category = cat.Category\n        JOIN [POR].dbo.CustomerFile cust ON cust.CNUM = t.CUSN\n        LEFT JOIN [POR].dbo.ParameterFile store ON t.[STR] = store.Store\n    WHERE \nt.STAT IN ('C', 'CR') \nAND api.NoExport = 0\nAND STORE_CITY LIKE '%TX%'\n--AND ifile.TYPE IN ('H','T')\nAND  GVWR = 1\nAND cat.[Name] !='RERENT'\norder by t.CLDT",
								"queryTimeout": "02:00:00",
								"partitionOption": "None"
							},
							"sink": {
								"type": "AzureSqlSink",
								"preCopyScript": "truncate table por.Heavy_Equipment_Tax",
								"disableMetricsCollection": false
							},
							"enableStaging": false,
							"translator": {
								"type": "TabularTranslator",
								"typeConversion": true,
								"typeConversionSettings": {
									"allowDataTruncation": true,
									"treatBooleanAsNumber": false
								}
							}
						},
						"inputs": [
							{
								"referenceName": "DS_POR",
								"type": "DatasetReference",
								"parameters": {
									"schema_name": "dbo",
									"table_name": "user"
								}
							}
						],
						"outputs": [
							{
								"referenceName": "Briggs_MDW",
								"type": "DatasetReference",
								"parameters": {
									"schema_name": "POR",
									"table_name": "Heavy_Equipment_Tax"
								}
							}
						]
					},
					{
						"name": "TERP with Equipment Rented or Sold_Updated",
						"type": "Copy",
						"dependsOn": [
							{
								"activity": "TERP LINE ONLY_Updated",
								"dependencyConditions": [
									"Succeeded"
								]
							}
						],
						"policy": {
							"timeout": "7.00:00:00",
							"retry": 0,
							"retryIntervalInSeconds": 30,
							"secureOutput": false,
							"secureInput": false
						},
						"userProperties": [],
						"typeProperties": {
							"source": {
								"type": "SqlServerSource",
								"sqlReaderQuery": "\n SELECT ClosedDate,\nTransactionType,\nT.[Contract],\n[POR Customer],\n[NetSuiteCustomer],\n[Store],\n[RentalTotal],\n[TERPAmount],\n[DeliverToName],\n[custPickup],\n[DeliveryAddress],\n[DeliveryCity],\n[DeliveryState],\n[DeliveryZip],\n[CatDesc],\n[EquipDesc],\n[SerialNumber],\n[FUEL]\n,getdate() last_refresh_date\n  FROM\n\n --- TERP Line Item \n (\n SELECT distinct \n  CONVERT (varchar(10),CLDT, 101) as ClosedDate\n  ,CASE LEFT(t.CNTR,1) \n  WHEN 'c' THEN 'Credit'\n  ELSE 'Invoice'\n  END AS TransactionType,\n        t.CNTR as 'Contract'\n\t, cust.[KEY] AS 'POR Customer'\n\t, cust.APILink AS NetSuiteCustomer\n\t,[STR] AS 'Store'\n\t,t.RENT AS RentalTotal\n\t,i.PRIC AS TERPAmount\n\t,COALESCE(NULLIF(t.DeliverToCompany,''), NULLIF(cust.[NAME],'')) AS DeliverToName\n\t, t.Pickup AS custPickup\n\t\t,CASE t.Pickup \tWHEN 0 THEN \n\t COALESCE(NULLIF(j.SiteAddress,''), NULLIF(t.DeliveryAddress,''), NULLIF(store.STORE_STRT,''))\n\t ELSE (store.STORE_STRT)\n\t END AS DeliveryAddress\n\t, CASE t.Pickup WHEN 0 THEN \n\tCOALESCE(NULLIF(LEFT(j.SiteCity, CHARINDEX(',',j.SiteCity + ',',  1) -1),''),NULLIF(LEFT(t.DeliveryCity, CHARINDEX(',',t.DeliveryCity + ',',  1) -1),''), NULLIF(LEFT(store.STORE_CITY, CHARINDEX(',',store.STORE_CITY + ',',  1) -1),'')) \n\tELSE LEFT(STORE_CITY, CHARINDEX(',',STORE_CITY + ',',  1) -1)\n\tEND AS DeliveryCity\n\t,CASE t.Pickup WHEN 0 THEN \n\tCOALESCE(NULLIF(LEFT(j.SiteCity, CHARINDEX(',',j.SiteCity + ',',  1) -1),''),NULLIF(LEFT(t.DeliveryCity, CHARINDEX(',',t.DeliveryCity + ',',  1) -1),''), NULLIF(LEFT(store.STORE_CITY, CHARINDEX(',',store.STORE_CITY + ',',  1) -1),'')) \n\tELSE SUBSTRING(STORE_CITY,CHARINDEX(',',STORE_CITY)+1,3)\tEND AS DeliveryState\n\t,CASE t.Pickup \tWHEN 0 THEN \n\tCOALESCE(NULLIF(j.SiteZip,''), NULLIF(t.DeliveryZip,''), NULLIF(store.STORE_ZIP,'')) \n\tELSE NULLIF(store.STORE_ZIP,'') END AS DeliveryZip\n\n\n    FROM [POR].dbo.Transactions t\n        JOIN [POR].dbo.AccountingAPIQueueTR api ON api.ContractNumber = t.CNTR\n        JOIN [POR].dbo.TransactionItems i ON i.CNTR = t.CNTR\n        JOIN [POR].dbo.ItemFile ifile ON ifile.NUM = i.ITEM\n        JOIN [POR].dbo.ItemCategory cat ON ifile.Category = cat.Category\n        JOIN [POR].dbo.CustomerFile cust ON cust.CNUM = t.CUSN\n        LEFT JOIN [POR].dbo.CustomerJobSite j ON t.JobSite = j.Number\n        LEFT JOIN [POR].dbo.ParameterFile store ON t.[STR] = store.Store\n    WHERE \napi.NoExport = 0\nAND  ifile.[KEY] = 'EQTAX'\nAND PRIC >0\nAND STORE_CITY LIKE '%TX%'\n--AND CLDT BETWEEN DATEADD(month, DATEDIFF(month, -1, getdate()) - 2, 0) AND DATEADD(ss, -1, DATEADD(month, DATEDIFF(month, 0, getdate()), 0))\n\n\n) T\nJOIN \n--- Equipment on Rent\n(\n\n   select distinct\n   t.CNTR AS Contract\n\t,cat.[Name] AS CatDesc\n\t,ifile.[Name] As EquipDesc\n\t,SerialNumber\n\t,ifile.FUEL\n\t\n    FROM [POR].dbo.Transactions t\n        JOIN [POR].dbo.AccountingAPIQueueTR api ON api.ContractNumber = t.CNTR\n        JOIN [POR].dbo.TransactionItems i ON i.CNTR = t.CNTR\n        JOIN [POR].dbo.ItemFile ifile ON ifile.NUM = i.ITEM  ---\n        JOIN [POR].dbo.ItemCategory cat ON ifile.Category = cat.Category\n        JOIN [POR].dbo.CustomerFile cust ON cust.CNUM = t.CUSN\n        LEFT JOIN [POR].dbo.CustomerJobSite j ON t.JobSite = j.Number\n        LEFT JOIN [POR].dbo.ParameterFile store ON t.[STR] = store.Store\n    WHERE \napi.NoExport = 0\nAND t.CNTR In\n(select i.CNTR From TransactionItems i JOIN Itemfile ifile ON i.ITEM= ifile.NUM  where  [KEY] = 'EQTAX' AND PRIC >0)\nAND STORE_CITY LIKE '%TX%'\nAND ifile.TYPE IN ('H','T')\n) E ON T.Contract= E.Contract\n",
								"queryTimeout": "02:00:00",
								"partitionOption": "None"
							},
							"sink": {
								"type": "AzureSqlSink",
								"preCopyScript": "truncate table por.TERP_Support",
								"disableMetricsCollection": false
							},
							"enableStaging": false,
							"translator": {
								"type": "TabularTranslator",
								"typeConversion": true,
								"typeConversionSettings": {
									"allowDataTruncation": true,
									"treatBooleanAsNumber": false
								}
							}
						},
						"inputs": [
							{
								"referenceName": "DS_POR",
								"type": "DatasetReference",
								"parameters": {
									"schema_name": "dbo",
									"table_name": "user"
								}
							}
						],
						"outputs": [
							{
								"referenceName": "Briggs_MDW",
								"type": "DatasetReference",
								"parameters": {
									"schema_name": "POR",
									"table_name": "TERP_Support"
								}
							}
						]
					},
					{
						"name": "TERP LINE ONLY_Updated",
						"type": "Copy",
						"dependsOn": [
							{
								"activity": "Tax Recap_Updated",
								"dependencyConditions": [
									"Succeeded"
								]
							}
						],
						"policy": {
							"timeout": "7.00:00:00",
							"retry": 0,
							"retryIntervalInSeconds": 30,
							"secureOutput": false,
							"secureInput": false
						},
						"userProperties": [],
						"typeProperties": {
							"source": {
								"type": "SqlServerSource",
								"sqlReaderQuery": "SELECT distinct \n  CONVERT (varchar(10),CLDT, 101) as ClosedDate\n  ,CASE LEFT(t.CNTR,1) \n  WHEN 'c' THEN 'Credit'\n  ELSE 'Invoice'\n  END AS TransactionType,\n        t.CNTR as 'Contract'\n\t, cust.[KEY] AS 'POR Customer'\n\t, cust.APILink AS NetSuiteCustomer\n\t,[STR] AS 'Store'\n\t,t.RENT AS RentalTotal\n\t,i.PRIC AS TERPAmount\n\t,COALESCE(NULLIF(t.DeliverToCompany,''), NULLIF(cust.[NAME],'')) AS DeliverToName\n\t, t.Pickup AS custPickup\n\t\t,CASE t.Pickup \tWHEN 0 THEN \n\t COALESCE(NULLIF(j.SiteAddress,''), NULLIF(t.DeliveryAddress,''), NULLIF(store.STORE_STRT,''))\n\t ELSE (store.STORE_STRT)\n\t END AS DeliveryAddress\n\t, CASE t.Pickup WHEN 0 THEN \n\tCOALESCE(NULLIF(LEFT(j.SiteCity, CHARINDEX(',',j.SiteCity + ',',  1) -1),''),NULLIF(LEFT(t.DeliveryCity, CHARINDEX(',',t.DeliveryCity + ',',  1) -1),''), NULLIF(LEFT(store.STORE_CITY, CHARINDEX(',',store.STORE_CITY + ',',  1) -1),'')) \n\tELSE LEFT(STORE_CITY, CHARINDEX(',',STORE_CITY + ',',  1) -1)\n\tEND AS DeliveryCity\n\t,CASE t.Pickup WHEN 0 THEN \n\tCOALESCE(NULLIF(LEFT(j.SiteCity, CHARINDEX(',',j.SiteCity + ',',  1) -1),''),NULLIF(LEFT(t.DeliveryCity, CHARINDEX(',',t.DeliveryCity + ',',  1) -1),''), NULLIF(LEFT(store.STORE_CITY, CHARINDEX(',',store.STORE_CITY + ',',  1) -1),'')) \n\tELSE SUBSTRING(STORE_CITY,CHARINDEX(',',STORE_CITY)+1,3)\tEND AS DeliveryState\n\t,CASE t.Pickup \tWHEN 0 THEN \n\tCOALESCE(NULLIF(j.SiteZip,''), NULLIF(t.DeliveryZip,''), NULLIF(store.STORE_ZIP,'')) \n\tELSE NULLIF(store.STORE_ZIP,'') END AS DeliveryZip\n\n\t,getdate() last_refresh_date\n    FROM [POR].dbo.Transactions t\n        JOIN [POR].dbo.AccountingAPIQueueTR api ON api.ContractNumber = t.CNTR\n        JOIN [POR].dbo.TransactionItems i ON i.CNTR = t.CNTR\n        JOIN [POR].dbo.ItemFile ifile ON ifile.NUM = i.ITEM\n        JOIN [POR].dbo.ItemCategory cat ON ifile.Category = cat.Category\n        JOIN [POR].dbo.CustomerFile cust ON cust.CNUM = t.CUSN\n        LEFT JOIN [POR].dbo.CustomerJobSite j ON t.JobSite = j.Number\n        LEFT JOIN [POR].dbo.ParameterFile store ON t.[STR] = store.Store\n    WHERE \napi.NoExport = 0\nAND  ifile.[KEY] = 'EQTAX'\nAND PRIC >0\nAND STORE_CITY LIKE '%TX%'\n--AND CLDT BETWEEN DATEADD(month, DATEDIFF(month, -1, getdate()) - 2, 0) AND DATEADD(ss, -1, DATEADD(month, DATEDIFF(month, 0, getdate()), 0))\n",
								"queryTimeout": "02:00:00",
								"partitionOption": "None"
							},
							"sink": {
								"type": "AzureSqlSink",
								"preCopyScript": "truncate table por.TERP",
								"disableMetricsCollection": false
							},
							"enableStaging": false,
							"translator": {
								"type": "TabularTranslator",
								"typeConversion": true,
								"typeConversionSettings": {
									"allowDataTruncation": true,
									"treatBooleanAsNumber": false
								}
							}
						},
						"inputs": [
							{
								"referenceName": "DS_POR",
								"type": "DatasetReference",
								"parameters": {
									"schema_name": "dbo",
									"table_name": "user"
								}
							}
						],
						"outputs": [
							{
								"referenceName": "Briggs_MDW",
								"type": "DatasetReference",
								"parameters": {
									"schema_name": "POR",
									"table_name": "TERP"
								}
							}
						]
					},
					{
						"name": "Tax Recap_Updated",
						"type": "Copy",
						"dependsOn": [
							{
								"activity": "Heavy Equipment Tax_Updated",
								"dependencyConditions": [
									"Succeeded"
								]
							}
						],
						"policy": {
							"timeout": "7.00:00:00",
							"retry": 0,
							"retryIntervalInSeconds": 30,
							"secureOutput": false,
							"secureInput": false
						},
						"userProperties": [],
						"typeProperties": {
							"source": {
								"type": "SqlServerSource",
								"sqlReaderQuery": "select distinct CLDT,\n  CONVERT (varchar(10),CLDT, 101) as ClosedDate\n  ,CASE LEFT(CNTR,1) \n  WHEN 'c' THEN 'Credit'\n  ELSE 'Invoice'\n  END AS TransactionType,\n        t.CNTR as 'Contract'\n\t, cust.[KEY] AS 'POR Customer'\n\t, cust.APILink AS NetSuiteCustomer\n\t, cust.[Name] As 'Customer Name'\n\t, [STR] AS 'Store'\n\t, t.Rent AS 'RentTotal'\n\t, t.SALE AS 'SaleTotal'\n\t, t.Rent + t.SALE AS 'RevTotal'\n\t, t.DMG AS 'Damage Waiver'\n\t, Tax\n\t, Totl AS InvoiceTotal\n\t, CASE t.Pickup \n\tWHEN 0 THEN 'Delivery'\n\tWHEN 1 THEN 'Customer Pickup'\n\tELSE 'NA'\n\tEND AS custPickup\n\t--\t, COALESCE(NULLIF(j.SiteAddress,''), NULLIF(t.DeliveryAddress,''), NULLIF(store.STORE_STRT,'')) as DeliveryAddress\n\t\n\t,CASE t.Pickup \tWHEN 0 THEN \n\t COALESCE(NULLIF(j.SiteAddress,''), NULLIF(t.DeliveryAddress,''), NULLIF(store.STORE_STRT,''))\n\t ELSE (store.STORE_STRT)\n\t END AS DeliveryAddress\n\t, CASE t.Pickup WHEN 0 THEN \n\tCOALESCE(NULLIF(LEFT(j.SiteCity, CHARINDEX(',',j.SiteCity + ',',  1) -1),''),NULLIF(LEFT(t.DeliveryCity, CHARINDEX(',',t.DeliveryCity + ',',  1) -1),''), NULLIF(LEFT(store.STORE_CITY, CHARINDEX(',',store.STORE_CITY + ',',  1) -1),'')) \n\tELSE LEFT(STORE_CITY, CHARINDEX(',',STORE_CITY + ',',  1) -1)\n\tEND AS DeliveryCity\n\t,CASE t.Pickup WHEN 0 THEN \n\tCOALESCE(TRIM(NULLIF(RIGHT(j.SiteCity, NULLIF(CHARINDEX(',',REVERSE(j.SiteCity)),'') -1),'')),TRIM(NULLIF(RIGHT(t.DeliveryCity, NULLIF(CHARINDEX(',',REVERSE(t.DeliveryCity)),'') -1),''))\t,\n\tTRIM(NULLIF(RIGHT(store.STORE_CITY, NULLIF(CHARINDEX(',',REVERSE(store.STORE_CITY)),'') -1),''))) \n\tELSE TRIM(SUBSTRING(STORE_CITY,CHARINDEX(',',STORE_CITY)+1,3))\tEND AS DeliveryState\n\t,CASE t.Pickup \tWHEN 0 THEN \n\tCOALESCE(NULLIF(j.SiteZip,''), NULLIF(t.DeliveryZip,''), NULLIF(store.STORE_ZIP,'')) \n\tELSE NULLIF(store.STORE_ZIP,'') END AS DeliveryZip\n\t--,store.STORE_NAME As StoreName,\n\t--store.STORE_STRT AS StoreAddress, STORE_CITY AS StoreCity, STORE_ZIP AS StoreZipCode\n    ,getdate() last_refresh_date\n\tFROM [POR].dbo.Transactions t\n        JOIN [POR].dbo.AccountingAPIQueueTR api ON api.ContractNumber = t.CNTR\n        JOIN [POR].dbo.CustomerFile cust ON cust.CNUM = t.CUSN\n        LEFT JOIN [POR].dbo.CustomerJobSite j ON t.JobSite = j.Number\n        LEFT JOIN [POR].dbo.ParameterFile store ON t.[STR] = store.Store\n\t    WHERE t.STAT IN ('C', 'CR')  AND\n api.NoExport = 0\n-- AND CLDT BETWEEN DATEADD(month, DATEDIFF(month, -1, getdate()) - 2, 0) AND DATEADD(ss, -1, DATEADD(month, DATEDIFF(month, 0, getdate()), 0))\n order by CLDT, CNTR\n",
								"queryTimeout": "02:00:00",
								"partitionOption": "None"
							},
							"sink": {
								"type": "AzureSqlSink",
								"preCopyScript": "truncate table por.Tax_Summary",
								"disableMetricsCollection": false
							},
							"enableStaging": false,
							"translator": {
								"type": "TabularTranslator",
								"typeConversion": true,
								"typeConversionSettings": {
									"allowDataTruncation": true,
									"treatBooleanAsNumber": false
								}
							}
						},
						"inputs": [
							{
								"referenceName": "DS_POR",
								"type": "DatasetReference",
								"parameters": {
									"schema_name": "dbo",
									"table_name": "user"
								}
							}
						],
						"outputs": [
							{
								"referenceName": "Briggs_MDW",
								"type": "DatasetReference",
								"parameters": {
									"schema_name": "POR",
									"table_name": "Tax_Summary"
								}
							}
						]
					},
					{
						"name": "POR_Open_Contract",
						"type": "Copy",
						"dependsOn": [],
						"policy": {
							"timeout": "7.00:00:00",
							"retry": 0,
							"retryIntervalInSeconds": 30,
							"secureOutput": false,
							"secureInput": false
						},
						"userProperties": [],
						"typeProperties": {
							"source": {
								"type": "SqlServerSource",
								"sqlReaderQuery": "SELECT \n--Below are Transaction Level Items\n\t CASE WHEN pf.Store <> '001' THEN RIGHT(pf.STORE_NAME, LEN(pf.STORE_NAME) - 4) ELSE pf.STORE_NAME END AS [Store Name]\n\t, t.[STR] AS [Store No]\n\t, CASE WHEN t.PYMT = 'E' THEN 'Account' ELSE 'Cash' END AS CustomerType\n\t, cf.[Key] AS [Customer Number]\n\t, cf.[Name] AS [Customer Name]\n\t, t.JOBN AS [Job Name]\n\t, t.JBPO AS [Job PO#] \n\t, t.JBID AS [Job #]\n\t, cjs.Description AS [Job Site Name]\n\t, ISNULL(cjs.SiteAddress,'') + ' ' + ISNULL(cjs.SiteCity,'') + ' ' + ISNULL(cjs.SiteZip,'') AS [Job Site Address]\n\t, t.DMG AS [Extended Protection Plan]\n\t, s.[Name] AS [Contract Salesman]\n\t, s2.[Name] AS [Customer Salesman]\n\t, o.OPNM AS [Created by Operator Name]\n\t, o2.OPNM AS [Assigned to Operator Name] -- This drives the revenue\n\t, t.[DATE] AS [Contract Date]\n\t, t1.OriginalContractDate AS [Original Contract Date]\n\t, t.[CNTR] AS [Contract No]\n\t--Below are Item level details\n/** NOTE for this case statement --IF TXTY is RR (Called Off) then we should add ti.DDT as called off date, otherwise John doesn't want to see ti.DDT. Not sure best way to go about that in PowerBI **/\n\t, CASE WHEN ti.TXTY = 'R' THEN 'RENT'\n\t\t   WHEN ti.TXTY = 'RR' THEN 'Returned'\n\t\t   WHEN ti.TXTY = 'RX' THEN 'Previously Returned'\n\t\t   WHEN ti.TXTY = 'RH' THEN 'Not Returned. Item on hold for pickup'\n\t\t   WHEN ti.TXTY = 'RD' THEN 'Not Returned. Demand letter sent'\n\t\t   WHEN ti.TXTY = 'RM' THEN 'Not Returned. Reservation Reminder letter sent'\n\t\t   WHEN ti.TXTY = 'RN' THEN 'Not Returned. Reminder letter sent'\n\t\t   WHEN ti.TXTY = 'RV' THEN 'Not Returned. Reservation Verify letter sent'\n\t\t   WHEN ti.TXTY = '' THEN 'Not Returned. No letters have been sent'\n\t   ELSE 'Sale Item' END AS [Item Status]\n\t, ifi.Header  -- John wants to see HEADER key that each ITEM belongs too for grouping/pivot/lookup purposes\n\t, ti.ITEM AS [Key] \n\t, ifi.Name\n\t, ifi.SerialNumber AS [Serial Number]\n\t, ifi.MANF AS [Make]\n\t, ifi.MODN AS [Model]\n\t, ifi.Modelyear AS [Model Year]\n\t, ti.PRIC AS [Amount Charged]\n\t, ti.DailyAmount AS [Daily]\n\t, ifi.RATE1 AS [Book Rate Daily]\n\t, ti.WeeklyAmount AS [Weekly]\n\t, ifi.RATE2 AS [Book Rate Weekly]\n\t, ti.MonthlyAmount AS [Monthly]\n\t, ifi.RATE3 AS [Book Rate Monthly]\n\t, CASE WHEN ti.Substatus = 7 THEN 'Substitute' ELSE '' END AS [Is Substitute]\n\t, CASE WHEN ti.Substatus = 7 THEN ti.Comments ELSE '' END AS [Substitution Comments]\n\t, getdate() last_refresh_date\nFROM POR.dbo.transactions t\nJOIN POR.dbo.TransactionItems ti ON ti.CNTR = t.CNTR\nJOIN POR.dbo.ItemFile ifi ON ifi.NUM = ti.ITEM\nJOIN POR.dbo.ParameterFile pf ON pf.Store = t.[STR]\nJOIN (SELECT t0.CNTR, t0.[DATE] AS OriginalContractDate FROM POR.dbo.Transactions t0 WHERE RIGHT(t0.CNTR,1) NOT LIKE '[A-Za-z]%') t1\n              ON t1.CNTR = CASE WHEN RIGHT(t.CNTR,1) LIKE '[A-Za-z]%' THEN LEFT(t.CNTR, LEN(t.CNTR)-1) ELSE t.CNTR END\nLEFT JOIN POR.dbo.ItemComments ic ON ic.NUM = ifi.NUM\nLEFT JOIN POR.dbo.CustomerFile cf ON cf.CNUM = t.CUSN\nLEFT JOIN POR.dbo.CustomerJobSite cjs ON cjs.Number = t.JobSite\nLEFT JOIN POR.dbo.Salesman s ON s.Number = t.Salesman\nLEFT JOIN POR.dbo.Salesman s2 ON s2.Number = cf.Salesman -- Example CNTR 103071 See GUI. Trans SM is Misha Tufkova, but Customer assigned SM is Daniel Lee\nLEFT JOIN POR.dbo.OperatorId o ON o.OPNO = t.OperatorCreated\nLEFT JOIN POR.dbo.OperatorId o2 ON o2.OPNO = t.OperatorAssigned -- Exampel CMTR 102919 See GUI.\nWHERE LEFT(t.STAT,1) = 'O'\nAND LEFT(t.CNTR,1) NOT IN ('q','r','s','t')\nAND (ifi.TYPE IN ('T','H','U','V','A','L','R','N','K','D') -- Include Rental types & delivery/pickup charges only; exclude sales, diesel, etc.\n\t\tOR ifi.Name LIKE 'Delivery%' --2. Sale items to include\n\t\tOR ifi.Name LIKE 'Pickup%' --3. Sale items to include\\\n\t )\nAND t.STAT NOT IN ('OJ','OH','RR','OR')\nAND ti.TXTY <> 'RR'\nORDER BY [Store Name], cf.[NAME], t.[DATE] ASC, t.CNTR, s.[Name]",
								"queryTimeout": "02:00:00",
								"partitionOption": "None"
							},
							"sink": {
								"type": "AzureSqlSink",
								"preCopyScript": "truncate table por.POR_Open_Contracts",
								"writeBehavior": "insert",
								"sqlWriterUseTableLock": false,
								"disableMetricsCollection": false
							},
							"enableStaging": false,
							"translator": {
								"type": "TabularTranslator",
								"mappings": [
									{
										"source": {
											"name": "Store Name",
											"type": "String",
											"physicalType": "nvarchar"
										},
										"sink": {
											"name": "Store_Name",
											"type": "String",
											"physicalType": "nvarchar"
										}
									},
									{
										"source": {
											"name": "Store No",
											"type": "String",
											"physicalType": "nvarchar"
										},
										"sink": {
											"name": "Store_No",
											"type": "String",
											"physicalType": "nvarchar"
										}
									},
									{
										"source": {
											"name": "CustomerType",
											"type": "String",
											"physicalType": "varchar"
										},
										"sink": {
											"name": "Customer_Type",
											"type": "String",
											"physicalType": "nvarchar"
										}
									},
									{
										"source": {
											"name": "Customer Number",
											"type": "String",
											"physicalType": "nvarchar"
										},
										"sink": {
											"name": "Customer_Number",
											"type": "String",
											"physicalType": "nvarchar"
										}
									},
									{
										"source": {
											"name": "Customer Name",
											"type": "String",
											"physicalType": "nvarchar"
										},
										"sink": {
											"name": "Customer_Name",
											"type": "String",
											"physicalType": "nvarchar"
										}
									},
									{
										"source": {
											"name": "Job Name",
											"type": "String",
											"physicalType": "nvarchar"
										},
										"sink": {
											"name": "Job_Name",
											"type": "String",
											"physicalType": "nvarchar"
										}
									},
									{
										"source": {
											"name": "Job PO#",
											"type": "String",
											"physicalType": "nvarchar"
										},
										"sink": {
											"name": "Job_PO",
											"type": "String",
											"physicalType": "nvarchar"
										}
									},
									{
										"source": {
											"name": "Job #",
											"type": "String",
											"physicalType": "nvarchar"
										},
										"sink": {
											"name": "Job_ID",
											"type": "String",
											"physicalType": "nvarchar"
										}
									},
									{
										"source": {
											"name": "Job Site Name",
											"type": "String",
											"physicalType": "nvarchar"
										},
										"sink": {
											"name": "Job_Site_Name",
											"type": "String",
											"physicalType": "nvarchar"
										}
									},
									{
										"source": {
											"name": "Job Site Address",
											"type": "String",
											"physicalType": "nvarchar"
										},
										"sink": {
											"name": "Job_Site_Address",
											"type": "String",
											"physicalType": "nvarchar"
										}
									},
									{
										"source": {
											"name": "Extended Protection Plan",
											"type": "Decimal",
											"physicalType": "money",
											"scale": 4,
											"precision": 19
										},
										"sink": {
											"name": "Extended_Protection_Plan",
											"type": "Decimal",
											"physicalType": "money",
											"scale": 4,
											"precision": 19
										}
									},
									{
										"source": {
											"name": "Contract Salesman",
											"type": "String",
											"physicalType": "nvarchar"
										},
										"sink": {
											"name": "Contract_Salesman",
											"type": "String",
											"physicalType": "nvarchar"
										}
									},
									{
										"source": {
											"name": "Customer Salesman",
											"type": "String",
											"physicalType": "nvarchar"
										},
										"sink": {
											"name": "Customer_Salesman",
											"type": "String",
											"physicalType": "nvarchar"
										}
									},
									{
										"source": {
											"name": "Created by Operator Name",
											"type": "String",
											"physicalType": "nvarchar"
										},
										"sink": {
											"name": "Created_By_Operator_Name",
											"type": "String",
											"physicalType": "nvarchar"
										}
									},
									{
										"source": {
											"name": "Assigned to Operator Name",
											"type": "String",
											"physicalType": "nvarchar"
										},
										"sink": {
											"name": "Assigned_To_Operator_Name",
											"type": "String",
											"physicalType": "nvarchar"
										}
									},
									{
										"source": {
											"name": "Contract Date",
											"type": "DateTime",
											"physicalType": "datetime"
										},
										"sink": {
											"name": "Contract_Date",
											"type": "DateTime",
											"physicalType": "datetime"
										}
									},
									{
										"source": {
											"name": "Original Contract Date",
											"type": "DateTime",
											"physicalType": "datetime"
										},
										"sink": {
											"name": "Original_Contract_Date",
											"type": "DateTime",
											"physicalType": "datetime"
										}
									},
									{
										"source": {
											"name": "Contract No",
											"type": "String",
											"physicalType": "nvarchar"
										},
										"sink": {
											"name": "Contract_No",
											"type": "String",
											"physicalType": "nvarchar"
										}
									},
									{
										"source": {
											"name": "Item Status",
											"type": "String",
											"physicalType": "varchar"
										},
										"sink": {
											"name": "Item_Status",
											"type": "String",
											"physicalType": "nvarchar"
										}
									},
									{
										"source": {
											"name": "Header",
											"type": "String",
											"physicalType": "nvarchar"
										},
										"sink": {
											"name": "Header",
											"type": "String",
											"physicalType": "nvarchar"
										}
									},
									{
										"source": {
											"name": "Key",
											"type": "String",
											"physicalType": "nvarchar"
										},
										"sink": {
											"name": "Key",
											"type": "String",
											"physicalType": "nvarchar"
										}
									},
									{
										"source": {
											"name": "Name",
											"type": "String",
											"physicalType": "nvarchar"
										},
										"sink": {
											"name": "Name",
											"type": "String",
											"physicalType": "nvarchar"
										}
									},
									{
										"source": {
											"name": "Serial Number",
											"type": "String",
											"physicalType": "nvarchar"
										},
										"sink": {
											"name": "Serial_Number",
											"type": "String",
											"physicalType": "nvarchar"
										}
									},
									{
										"source": {
											"name": "Make",
											"type": "String",
											"physicalType": "nvarchar"
										},
										"sink": {
											"name": "Make",
											"type": "String",
											"physicalType": "nvarchar"
										}
									},
									{
										"source": {
											"name": "Model",
											"type": "String",
											"physicalType": "nvarchar"
										},
										"sink": {
											"name": "Model",
											"type": "String",
											"physicalType": "nvarchar"
										}
									},
									{
										"source": {
											"name": "Model Year",
											"type": "String",
											"physicalType": "nvarchar"
										},
										"sink": {
											"name": "Model_Year",
											"type": "String",
											"physicalType": "nvarchar"
										}
									},
									{
										"source": {
											"name": "Amount Charged",
											"type": "Decimal",
											"physicalType": "money",
											"scale": 4,
											"precision": 19
										},
										"sink": {
											"name": "Amount_Charged",
											"type": "Decimal",
											"physicalType": "money",
											"scale": 4,
											"precision": 19
										}
									},
									{
										"source": {
											"name": "Daily",
											"type": "Decimal",
											"physicalType": "money",
											"scale": 4,
											"precision": 19
										},
										"sink": {
											"name": "Daily",
											"type": "Decimal",
											"physicalType": "money",
											"scale": 4,
											"precision": 19
										}
									},
									{
										"source": {
											"name": "Book Rate Daily",
											"type": "Decimal",
											"physicalType": "money",
											"scale": 4,
											"precision": 19
										},
										"sink": {
											"name": "Book_Rate_Daily",
											"type": "Decimal",
											"physicalType": "money",
											"scale": 4,
											"precision": 19
										}
									},
									{
										"source": {
											"name": "Weekly",
											"type": "Decimal",
											"physicalType": "money",
											"scale": 4,
											"precision": 19
										},
										"sink": {
											"name": "Weekly",
											"type": "Decimal",
											"physicalType": "money",
											"scale": 4,
											"precision": 19
										}
									},
									{
										"source": {
											"name": "Book Rate Weekly",
											"type": "Decimal",
											"physicalType": "money",
											"scale": 4,
											"precision": 19
										},
										"sink": {
											"name": "Book_Rate_Weekly",
											"type": "Decimal",
											"physicalType": "money",
											"scale": 4,
											"precision": 19
										}
									},
									{
										"source": {
											"name": "Monthly",
											"type": "Decimal",
											"physicalType": "money",
											"scale": 4,
											"precision": 19
										},
										"sink": {
											"name": "Monthly",
											"type": "Decimal",
											"physicalType": "money",
											"scale": 4,
											"precision": 19
										}
									},
									{
										"source": {
											"name": "Book Rate Monthly",
											"type": "Decimal",
											"physicalType": "money",
											"scale": 4,
											"precision": 19
										},
										"sink": {
											"name": "Book_Rate_Monthly",
											"type": "Decimal",
											"physicalType": "money",
											"scale": 4,
											"precision": 19
										}
									},
									{
										"source": {
											"name": "Is Substitute",
											"type": "String",
											"physicalType": "varchar"
										},
										"sink": {
											"name": "Is_Substitute",
											"type": "String",
											"physicalType": "nvarchar"
										}
									},
									{
										"source": {
											"name": "Substitution Comments",
											"type": "String",
											"physicalType": "nvarchar"
										},
										"sink": {
											"name": "Substitution_Comments",
											"type": "String",
											"physicalType": "nvarchar"
										}
									},
									{
										"source": {
											"name": "last_refresh_date",
											"type": "DateTime",
											"physicalType": "datetime"
										},
										"sink": {
											"name": "last_refresh_date",
											"type": "DateTime",
											"physicalType": "date"
										}
									}
								],
								"typeConversion": true,
								"typeConversionSettings": {
									"allowDataTruncation": true,
									"treatBooleanAsNumber": false
								}
							}
						},
						"inputs": [
							{
								"referenceName": "DS_POR",
								"type": "DatasetReference",
								"parameters": {
									"schema_name": "dbo",
									"table_name": "user"
								}
							}
						],
						"outputs": [
							{
								"referenceName": "Briggs_MDW",
								"type": "DatasetReference",
								"parameters": {
									"schema_name": "POR",
									"table_name": "POR_Open_Contracts"
								}
							}
						]
					},
					{
						"name": "Inventory",
						"type": "Copy",
						"dependsOn": [
							{
								"activity": "POR_Open_Contract",
								"dependencyConditions": [
									"Succeeded"
								]
							}
						],
						"policy": {
							"timeout": "7.00:00:00",
							"retry": 0,
							"retryIntervalInSeconds": 30,
							"secureOutput": false,
							"secureInput": false
						},
						"userProperties": [],
						"typeProperties": {
							"source": {
								"type": "SqlServerSource",
								"sqlReaderQuery": "/*\nDATA PULL_Inventory_v13\nLast edit:  2022 March 18\n*/\n\n--Temp table (1/1)\tHave system generate unique dates\n--IF OBJECT_ID('tempdb..#DateRange') IS NOT NULL \n--   DROP TABLE #DateRange;  \n\n--CREATE TABLE #DateRange (UniqueDate DATE PRIMARY KEY)\n--INSERT INTO #DateRange\nwith DateRange_cte As\n(\n\tSELECT TOP (10592) DATEADD(DAY,ROW_NUMBER() OVER (ORDER BY (SELECT 1)), '20201231') AS UniqueDate\n\tFROM master.dbo.spt_values v1, master.dbo.spt_values v2\n)\n\n--CTEs:  amalgamate details and summary for scripted/automatic aggregation as needed\n--CTE (1/5)\t\tRepair info:  details and aggregates\n, repairs_cte AS\t\t--alias:  rc\n(\nSELECT\n  ti0.ITEM\n, summary.MaintenanceType\n, summary.TotalLaborHours\n, CAST(summary.LaborCost/NULLIF(summary.NumAssets,0) AS DECIMAL(18,2)) AS LaborCost\n, CAST(summary.ServicePartsCost/NULLIF(summary.NumAssets,0) AS DECIMAL(18,2)) AS ServicePartsCost\n, summary.OutDate\n, summary.CompletedDate\n, summary.CNTR\n, summary.DaysDown\nFROM POR.dbo.TransactionItems ti0\nJOIN POR.dbo.ItemFile ifi0 ON ifi0.NUM = ti0.ITEM\nJOIN (\n\tSELECT\n\t  details.CNTR\n\t, details.MaintenanceType\n\t, SUM(IIF(details.Asset = 1,1,0)) AS NumAssets\n\t, SUM(details.LaborHours) AS TotalLaborHours\n\t, SUM(IIF(details.Name LIKE 'labor', details.Pric,0)) AS LaborCost\n\t, SUM(IIF(details.Name NOT LIKE 'labor', details.Pric,0)) AS ServicePartsCost\n\t, MIN(details.OutDate) AS OutDate\n\t, MAX(details.CompletedDate) AS CompletedDate\n\t, DATEDIFF(d,details.OutDate,IIF(details.CompletedDate IS NULL, GETDATE(),details.CompletedDate)) AS DaysDown\n\tFROM (\n\t\tSELECT t.CNTR, ti.Sort, ifi.Asset, ifi.Name, ifi.NUM, IIF(ifi.Name LIKE '%labor%', ti.QTY, 0) AS LaborHours, ti.PRIC\n\t\t, CASE WHEN CF.[KEY] LIKE 'REPAIRS-MAINT%' THEN 'IMO'\n\t\t\tWHEN CF.[KEY] NOT LIKE 'REPAIRS-MAINT%' THEN 'IRO'\n\t\t\tEND AS [MaintenanceType]\n\t\t, CF.[KEY]\n\t\t, CAST(t.[DATE] AS DATE) AS OutDate\n\t\t, CAST(t.Completed AS DATE) AS CompletedDate\n\t\tFROM POR.dbo.Transactions t\n\t\tJOIN POR.dbo.TransactionItems ti ON ti.CNTR = t.CNTR\n\t\tJOIN POR.dbo.ItemFile ifi ON ifi.NUM = ti.ITEM\n\t\tJOIN POR.dbo.CustomerFile CF ON T.CUSN = CF.CNUM\n\t\tWHERE LEFT(t.CNTR,1) = 'r'\n\t\tAND LEFT(ti.Sort,4) <> 'zzzz'\n\t\tAND RIGHT(ifi.[KEY],2) <> 'RR'\n\t) details\n\tGROUP BY\n\t  details.CNTR\n\t, details.MaintenanceType\n\t, DATEDIFF(d,details.OutDate,IIF(details.CompletedDate IS NULL, GETDATE(),details.CompletedDate))\n) summary ON summary.CNTR = ti0.CNTR\nWHERE ifi0.Asset = 1\n)\n\n--CTE (2/5)\t\tRepair info:  Days since item was last down\n, lastCompletedDate_cte AS\t\t--alias:  lcd\n(\nSELECT ITEM, repairs_cte.MaintenanceType, repairs_cte.CompletedDate AS LastCompletedDate\n\t, ROW_NUMBER() OVER(PARTITION BY repairs_cte.ITEM ORDER BY (CASE WHEN repairs_cte.CompletedDate IS NULL THEN GETDATE() ELSE repairs_cte.CompletedDate END) DESC) AS [RowNumber]\nFROM repairs_cte\n)\n\n--CTE (3/5)\t\tRepair days:  Use unique days\n, repairDays_cte AS\t\t--alias:  rd\n(\n\tSELECT\n\t  a.ITEM\n\t, COUNT(DISTINCT CASE WHEN a.UniqueDate >= '2021-12-01' AND a.MaintenanceType = 'IMO' THEN a.UniqueDate ELSE NULL END) AS TotalDaysIMO\n\t, COUNT(DISTINCT CASE WHEN a.UniqueDate >= '2021-12-01' AND a.MaintenanceType = 'IRO' THEN a.UniqueDate ELSE NULL END) AS TotalDaysIRO\n\t, COUNT(DISTINCT CASE WHEN a.UniqueDate >= '2021-12-01' THEN a.UniqueDate ELSE NULL END) AS TotalDaysRepair\n\tFROM (\n\t\tSELECT\n\t\tti3.ITEM\n\t\t, CASE WHEN CF3.[KEY] LIKE 'REPAIRS-MAINT%' THEN 'IMO'\n\t\t\tWHEN CF3.[KEY] NOT LIKE 'REPAIRS-MAINT%' THEN 'IRO'\n\t\t\tEND AS [MaintenanceType]\n\t\t, dr3.UniqueDate\n\t\tFROM POR.dbo.Transactions t3\n\t\tJOIN POR.dbo.TransactionItems ti3 ON ti3.CNTR = t3.CNTR\n\t\tJOIN POR.dbo.ItemFile ifi3 ON ifi3.NUM = ti3.ITEM\n\t\tJOIN POR.dbo.CustomerFile CF3 ON T3.CUSN = CF3.CNUM\n\t\tJOIN DateRange_cte dr3 ON dr3.UniqueDate BETWEEN CAST(t3.[DATE] AS DATE) AND CAST(CASE WHEN t3.Completed IS NULL THEN GETDATE() ELSE CAST(t3.Completed AS DATE) END AS DATE)\n\t\tWHERE LEFT(t3.CNTR,1) = 'r'\n\t\tAND LEFT(ti3.Sort,4) <> 'zzzz'\n\t\tAND RIGHT(ifi3.[KEY],2) <> 'RR'\n\t\tGROUP BY\n\t\tti3.ITEM\n\t\t, CASE WHEN CF3.[KEY] LIKE 'REPAIRS-MAINT%' THEN 'IMO'\n\t\t\tWHEN CF3.[KEY] NOT LIKE 'REPAIRS-MAINT%' THEN 'IRO'\n\t\t\tEND\n\t\t, dr3.UniqueDate\n\t) a\n\tGROUP BY\n\t  a.ITEM\n)\n\n--CTE (4/5)\t\tContract info:  Aggregates by ITEM\n, contractRev_cte AS\t--alias:  cr\n(\nSELECT\n  c.ITEM\n, SUM(c.TotalContractRevenue) AS TotalRentalRevenue\n, SUM(c.[30d_ContractRevenue]) AS [30d_TotalRentalRevenue]\n, SUM(c.[60d_ContractRevenue]) AS [60d_TotalRentalRevenue]\n, SUM(c.[90d_ContractRevenue]) AS [90d_TotalRentalRevenue]\n, SUM(c.[180d_ContractRevenue]) AS [180d_TotalRentalRevenue]\n, SUM(c.[R12d_ContractRevenue]) AS [R12d_TotalRentalRevenue]\n, SUM(c.[YTD_ContractRevenue]) AS [YTD_TotalRentalRevenue]\n, CAST(MAX(c.MaxContractStartDate) AS DATE) AS [LastItemContractStartDate]\n, CAST(MAX(c.MaxContractDate) AS DATE) AS [LastItemContractDate]\n, CAST(MAX(c.MaxCurrentDate) AS DATE) AS [LastItemContractDate_current]\nFROM (\n\tSELECT\n\t  LEFT(b.CNTR,6) AS CNTR\n\t, b.ITEM\n\t, SUM(b.PRIC) AS TotalContractRevenue\n\t, SUM(CASE WHEN b.ARdays  = 30 THEN b.PRIC ELSE 0 END) AS [30d_ContractRevenue]\n\t, SUM(CASE WHEN b.ARdays <= 60 THEN b.PRIC ELSE 0 END) AS [60d_ContractRevenue]\n\t, SUM(CASE WHEN b.ARdays <= 90 THEN b.PRIC ELSE 0 END) AS [90d_ContractRevenue]\n\t, SUM(CASE WHEN b.ARdays <= 180 THEN b.PRIC ELSE 0 END) AS [180d_ContractRevenue]\n\t, SUM(CASE WHEN b.ARdays <= 365 THEN b.PRIC ELSE 0 END) AS [R12d_ContractRevenue]\n\t, SUM(IIF(YEAR(b.DATE) = YEAR(GETDATE()),b.PRIC,0)) AS [YTD_ContractRevenue]\n\t, MAX(b.DATE) AS MaxContractStartDate\n\t, MAX(b.MaxActualContractDate) AS MaxContractDate\n\t, MAX(b.MaxCurrentContractDate) AS MaxCurrentDate\n\tFROM (\n\t\tSELECT\n\t\t  ti0.CNTR\n\t\t, ti0.ITEM\n\t\t, ti0.PRIC\n\t\t, CASE WHEN DATEDIFF(d,t0.[DATE],GETDATE()) <= 30 THEN 30\n\t\t\tWHEN DATEDIFF(d,t0.[DATE],GETDATE()) > 30 AND DATEDIFF(d,t0.[DATE],GETDATE()) <= 60 THEN 60\n\t\t\tWHEN DATEDIFF(d,t0.[DATE],GETDATE()) > 60 AND DATEDIFF(d,t0.[DATE],GETDATE()) <= 90 THEN 90\n\t\t\tWHEN DATEDIFF(d,t0.[DATE],GETDATE()) > 90 AND DATEDIFF(d,t0.[DATE],GETDATE()) <= 180 THEN 180\n\t\t\tWHEN DATEDIFF(d,t0.[DATE],GETDATE()) > 180 AND DATEDIFF(d,t0.[DATE],GETDATE()) <= 365 THEN 365\n\t\t\tELSE 9999 END AS ARdays\n\t\t, t0.[DATE]\n\t\t, a.MaxActualContractDate\n\t\t, a.MaxCurrentContractDate\n\t\tFROM POR.dbo.Transactions t0\n\t\tJOIN POR.dbo.TransactionItems ti0 ON ti0.CNTR = t0.CNTR\n\t\tJOIN POR.dbo.ItemFile ifi0 ON ifi0.NUM = ti0.ITEM\n\t\tJOIN POR.dbo.ItemType it0 ON it0.[Type] = ifi0.[TYPE]\n\t\tJOIN (\n\t\t\t\tSELECT LEFT(ti1.CNTR,6) AS CNTRgroup, ti1.ITEM\n\t\t\t\t, MIN(t1.[DATE]) AS MinContractDate\n\t\t\t\t, MAX(CASE WHEN ti1.TXTY IN ('RR','RX') THEN ti1.DDT ELSE t1.CLDT END) AS MaxActualContractDate\t\t--basing on picked up date because they are partitioning at the item level\n\t\t\t\t, MAX(CASE WHEN t1.CLDT IS NULL THEN '3333-12-31' WHEN ti1.TXTY IN ('RR','RX') THEN ti1.DDT ELSE t1.CLDT END) AS MaxCurrentContractDate\n\t\t\t\tFROM POR.dbo.Transactions t1\n\t\t\t\tJOIN POR.dbo.TransactionItems ti1 ON ti1.CNTR = t1.CNTR\n\t\t\t\tJOIN POR.dbo.ItemFile ifi1 ON ifi1.NUM = ti1.ITEM\n\t\t\t\tWHERE ((ifi1.UserDefined1 <> '' AND t1.[DATE] >= '2021-12-01') OR ifi1.UserDefined1 = '')\n\t\t\t\tAND t1.[DATE] <= GETDATE()\n\t\t\t\tGROUP BY LEFT(ti1.CNTR,6), ti1.ITEM\n\t\t) a ON a.CNTRgroup = LEFT(ti0.CNTR,6) AND a.ITEM = ifi0.NUM\n\t\tWHERE LEFT(t0.CNTR,1) NOT IN ('q','r','s','t','w','c') \n\t\tAND LEFT(it0.TypeDescrip,6) = 'Rental'\n\t\tAND RIGHT(ifi0.[KEY],2) <> 'RR'\n\t\tAND ((ifi0.UserDefined1 <> '' AND t0.[DATE] >= '2021-12-01') OR ifi0.UserDefined1 = '')\n\t\tAND t0.[DATE] <= GETDATE()\n\t) b\n\tGROUP BY\n\t  LEFT(b.CNTR,6)\n\t, b.ITEM\n) c\nGROUP BY\n  c.ITEM\n)\n\n--CTE (5/5)\t\tTimeUt by Item info:  uses temp table at beginning of query\n, timeUt_cte AS (\t--alias:  tu\nSELECT\n  a.ITEM\n, SUM(IIF(a.UniqueDate >= CAST(IIF(DATEADD(DAY,-30,GETDATE()) < '2021-12-01', '2021-12-01',DATEADD(DAY,-30,GETDATE()+1)) AS DATE), 1, 0)) AS [30dDistinct_OnRent]\n, SUM(IIF(a.UniqueDate >= CAST(IIF(DATEADD(DAY,-90,GETDATE()) < '2021-12-01', '2021-12-01',DATEADD(DAY,-90,GETDATE()+1)) AS DATE), 1, 0)) AS [90dDistinct_OnRent]\n, SUM(IIF(a.UniqueDate >= CAST(IIF(DATEADD(DAY,-180,GETDATE()) < '2021-12-01', '2021-12-01',DATEADD(DAY,-180,GETDATE()+1)) AS DATE), 1, 0)) AS [180dDistinct_OnRent]\n, SUM(IIF(a.UniqueDate >= CAST(IIF(DATEADD(DAY,-365,GETDATE()) < '2021-12-01', '2021-12-01',DATEADD(DAY,-365,GETDATE()+1)) AS DATE), 1, 0)) AS [R12dDistinct_OnRent]\n, SUM(IIF(a.UniqueDate >= DATEADD(yy, DATEDIFF(yy, 0, GETDATE()), 0), 1, 0)) AS [YTDdistinct_OnRent]\n, SUM(IIF(a.UniqueDate >= '2021-12-01', 1, 0)) AS [TotalDistinct_UT]\nFROM (\n\tSELECT ti2.ITEM, dr.UniqueDate\n\tFROM POR.dbo.Transactions t2\n\tJOIN POR.dbo.TransactionItems ti2 ON ti2.CNTR = t2.CNTR\n\tJOIN POR.dbo.ItemFile ifi2 ON ifi2.NUM = ti2.ITEM\n\tJOIN POR.dbo.ItemPurchaseDetail ipd2 ON ipd2.ItemNumber = ifi2.NUM\n\tJOIN DateRange_cte dr ON dr.UniqueDate BETWEEN CAST(t2.[DATE] AS DATE) AND CAST(CASE WHEN t2.CLDT IS NULL THEN GETDATE() ELSE ti2.DDT END AS DATE)\n\tWHERE LEFT(t2.CNTR,1) NOT IN ('q','r','s','t','w','c')\n\tAND ifi2.SerialNumber <> ''\n\tAND t2.DATE < CAST(GETDATE() AS DATE)\n\tAND dr.UniqueDate <= GETDATE()\n\tAND dr.UniqueDate >= ipd2.PurchaseDate\n\tGROUP BY ti2.ITEM, dr.UniqueDate\n) a\nGROUP BY a.ITEM\n)\n\n--MAIN QUERY:\n--Expected approximation:  3.1k results\nSELECT\nifi.[KEY], ifi.[Name], ifi.MODN AS Model, ifi.SerialNumber AS [Serial_Number], ifi.ModelYear AS [Model_Year]\n, DATEDIFF(m,ipd.PurchaseDate,GETDATE()) AS [Age_In_Months]\n, CAST(ipd.PurchaseDate AS DATE) AS [Original_DOP], ipd.PurchasePrice AS [OEC], ifi.CURV AS NBV, ifi.DEPA AS [Accum_Depr]\n, ifi.PURP AS [Acquisition_Cost], ipd.PONumber AS [PO_Number], ipd.ExtraCost AS [Extra_Cost], ifi.CurrentStore AS [Current_Store]\n, CASE WHEN pf.Store <> '001' THEN RIGHT(pf.STORE_NAME, LEN(pf.STORE_NAME) - 4) ELSE pf.STORE_NAME END AS [Store_Name]\n, ic.[Name] AS Category, ifi.Header, it.TypeDescrip AS [Type], ifi.MTOT AS [Hours], ifi.MANF AS Make, ifi.UserDefined1 AS [Legacy_ID]\n\n--Time utilization\n, CASE WHEN LEFT(it.TypeDescrip,6) = 'Rental' THEN CAST(MAX(ISNULL(CAST(CAST(tu.[30dDistinct_OnRent] AS DECIMAL(18,2))/30.00 *100 AS DECIMAL(18,2)),0)) AS VARCHAR(20)) + '%' ELSE NULL END AS [30d_TU]\n, CASE WHEN LEFT(it.TypeDescrip,6) = 'Rental' THEN CAST(MAX(ISNULL(CAST(CAST(tu.[90dDistinct_OnRent] AS DECIMAL(18,2))/90.00 *100 AS DECIMAL(18,2)),0)) AS VARCHAR(20)) + '%' ELSE NULL END AS [90d_TU]\n, CASE WHEN LEFT(it.TypeDescrip,6) = 'Rental' THEN CAST(MAX(ISNULL(CAST(CAST(tu.[180dDistinct_OnRent] AS DECIMAL(18,2))/180.00 *100 AS DECIMAL(18,2)),0)) AS VARCHAR(20)) + '%' ELSE NULL END AS [180d_TU]\n, CASE WHEN LEFT(it.TypeDescrip,6) = 'Rental' THEN CAST(MAX(ISNULL(CAST(CAST(tu.[R12dDistinct_OnRent] AS DECIMAL(18,2))/365.00 *100 AS DECIMAL(18,2)),0)) AS VARCHAR(20)) + '%' ELSE NULL END AS [R12_TU]\n, CASE WHEN LEFT(it.TypeDescrip,6) = 'Rental' THEN CAST(MAX(ISNULL(CAST(CAST(tu.[YTDdistinct_OnRent] AS DECIMAL(18,2))/(DATEDIFF(d,DATEADD(yy, DATEDIFF(yy, 0, GETDATE()), 0),GETDATE()+1)) *100 AS DECIMAL(18,2)),0)) AS VARCHAR(20)) + '%' ELSE NULL END AS [YTD_TU]\n\n--Dollar utilization\n, CASE WHEN LEFT(it.TypeDescrip,6) = 'Rental' THEN CAST(ISNULL((SUM(cr.[30d_TotalRentalRevenue]/NULLIF(ipd.PurchasePrice,0))*12) *100,0) AS VARCHAR(20)) + '%' ELSE NULL END AS [30d_$Ut%]\n, CASE WHEN LEFT(it.TypeDescrip,6) = 'Rental' THEN CAST(ISNULL((SUM(cr.[90d_TotalRentalRevenue]/NULLIF(ipd.PurchasePrice,0))*4) *100,0) AS VARCHAR(20)) + '%' ELSE NULL END AS [90d_$Ut%]\n, CASE WHEN LEFT(it.TypeDescrip,6) = 'Rental' THEN CAST(ISNULL((SUM(cr.[180d_TotalRentalRevenue]/NULLIF(ipd.PurchasePrice,0))*2) *100,0) AS VARCHAR(20)) + '%' ELSE NULL END AS [180d_$Ut%]\n, CASE WHEN LEFT(it.TypeDescrip,6) = 'Rental' THEN CAST(ISNULL((SUM(cr.[R12d_TotalRentalRevenue]/NULLIF(ipd.PurchasePrice,0))) *100,0) AS VARCHAR(20)) + '%' ELSE NULL END AS [R12_$Ut%]\n, CASE WHEN LEFT(it.TypeDescrip,6) = 'Rental' THEN CAST(ISNULL((SUM(cr.[YTD_TotalRentalRevenue]/NULLIF(ipd.PurchasePrice,0))*(365/DATEDIFF(d,DATEADD(yy, DATEDIFF(yy, 0, GETDATE()), 0),GETDATE()))) *100,0) AS VARCHAR(20)) + '%' ELSE NULL END AS [YTD_$Ut%]\n, CASE WHEN LEFT(it.TypeDescrip,6) = 'Rental' THEN ISNULL(cr.TotalRentalRevenue,0) ELSE NULL END AS [LTD_Revenue]\n, CASE WHEN LEFT(it.TypeDescrip,6) = 'Rental' THEN CAST(ISNULL(CAST(CAST(tu.[TotalDistinct_UT] AS DECIMAL(18,2)) / NULLIF(DATEDIFF(d,IIF(ifi.UserDefined1 <> '','2021-12-01',CAST(ipd.PurchaseDate AS DATE)),CAST(GETDATE()+1 AS DATE)),0)*100 AS DECIMAL(18,2)),0) AS VARCHAR(10)) + '%' ELSE NULL END AS [SP%_LTDTU]\n, CASE WHEN LEFT(it.TypeDescrip,6) = 'Rental' THEN ISNULL(CAST(MAX(CAST(CAST(rd.TotalDaysRepair AS DECIMAL(18,2)) / NULLIF(DATEDIFF(d,IIF(ifi.UserDefined1 <> '','2021-12-01',CAST(ipd.PurchaseDate AS DATE)),GETDATE()+1),0)*100 AS DECIMAL(18,2))) AS VARCHAR(10)),0) + '%' ELSE NULL END AS [SP%_Life_Down]\n, IIF((cr.LastItemContractDate_current = '3333-12-31' OR GETDATE() BETWEEN cr.LastItemContractStartDate AND cr.LastItemContractDate_current),'On rent', CAST(DATEDIFF(d,cr.LastItemContractDate,GETDATE())AS VARCHAR(20)) ) AS [Last_Rent_In_Days]\n\n--Maintenance/Repair\n, SUM(IIF(rc.ITEM IS NOT NULL,ISNULL(rc.TotalLaborHours,0),NULL)) AS [Total_Labor_Hours]\n, SUM(rc.LaborCost) AS [Total_Labor_Cost]\n, CASE WHEN rc.ITEM IS NOT NULL AND lcd.RowNumber = 1 AND lcd.LastCompletedDate IS NOT NULL THEN CAST(DATEDIFF(d, lcd.LastCompletedDate,GETDATE()) AS VARCHAR(20))\n\tWHEN rc.ITEM IS NOT NULL AND lcd.LastCompletedDate IS NULL THEN CAST('Down' AS VARCHAR(5))\n\tELSE NULL END AS [Days_Since_Last_Down]\n, lcd.MaintenanceType AS [Last_Down_Type]\n, SUM(IIF(rc.ITEM IS NOT NULL,IIF(rc.MaintenanceType = 'IRO',1,0),NULL)) AS [IRO_Totals]\n, rd.TotalDaysIRO AS [IRO_Days_Down]\n, SUM(IIF(rc.ITEM IS NOT NULL,IIF(rc.MaintenanceType = 'IRO',rc.LaborCost + rc.ServicePartsCost,0),NULL)) AS [IRO_Labor_Parts_Cost]\n, SUM(IIF(rc.ITEM IS NOT NULL,IIF(rc.MaintenanceType = 'IMO',1,0),NULL)) AS [IMO_Totals]\n, rd.TotalDaysIMO AS [IMO_Days_Down]\n, SUM(IIF(rc.ITEM IS NOT NULL,IIF(rc.MaintenanceType = 'IMO',rc.LaborCost + rc.ServicePartsCost,0),NULL)) AS [IMO_Labor_PartsCost]\n, GETDATE() [last_refresh_date]\nFROM POR.dbo.ItemFile ifi\nLEFT JOIN POR.dbo.ItemCategory ic ON ic.Category = ifi.Category\nJOIN POR.dbo.ItemType it ON it.[Type] = ifi.[TYPE]\nJOIN (SELECT\n\t\tipd0.ItemNumber, CASE WHEN ipd0.PONumber = 0 THEN NULL ELSE ipd0.PONumber END AS PONumber, ipd0.PurchaseDate, ipd0.PriceEach AS PurchasePrice, ipd0.ExtraCharges AS ExtraCost\n\t\t, ROW_NUMBER() OVER(PARTITION BY ipd0.ItemNumber ORDER BY ipd0.PurchaseDate) AS [RowNumber]\n\t\tFROM POR.dbo.ItemPurchaseDetail ipd0\n\t\tWHERE ipd0.QuantityPurchased > 0\n\t) ipd ON ipd.ItemNumber = ifi.NUM\nLEFT JOIN POR.dbo.ParameterFile pf ON pf.Store = ifi.CurrentStore\nLEFT JOIN repairs_cte rc ON rc.ITEM = ifi.NUM\nLEFT JOIN lastCompletedDate_cte lcd ON lcd.ITEM = ifi.NUM AND lcd.RowNumber = 1\nLEFT JOIN contractRev_cte cr ON cr.ITEM = ifi.NUM\nLEFT JOIN timeUt_cte tu ON tu.ITEM = ifi.NUM\nLEFT JOIN repairDays_cte rd ON rd.ITEM = ifi.NUM\n\nWHERE ifi.SerialNumber <> ''\nAND ifi.QTY > 0\nAND ipd.RowNumber = 1\nAND RIGHT(ifi.[KEY],2) <> 'RR'\n\nGROUP BY\n  ifi.[KEY], ifi.NUM, ifi.[Name], ifi.MODN , ifi.SerialNumber, ifi.ModelYear, ipd.PurchaseDate, ipd.PONumber, ipd.PurchasePrice, ipd.ExtraCost, ifi.CurrentStore\n  , CASE WHEN pf.Store <> '001' THEN RIGHT(pf.STORE_NAME, LEN(pf.STORE_NAME) - 4) ELSE pf.STORE_NAME END  \n  , ic.[Name], ifi.Header, it.TypeDescrip, ifi.MTOT, ifi.MANF, ifi.CURV, ifi.DEPA, ifi.PURP, ifi.UserDefined1\n, CASE WHEN rc.ITEM IS NOT NULL AND lcd.RowNumber = 1 AND lcd.LastCompletedDate IS NOT NULL THEN CAST(DATEDIFF(d, lcd.LastCompletedDate,GETDATE()) AS VARCHAR(20))\n\tWHEN rc.ITEM IS NOT NULL AND lcd.LastCompletedDate IS NULL THEN CAST('Down' AS VARCHAR(5))\n\tELSE NULL END, lcd.MaintenanceType\n, cr.TotalRentalRevenue\n, tu.[TotalDistinct_UT]\n, IIF((cr.LastItemContractDate_current = '3333-12-31' OR GETDATE() BETWEEN cr.LastItemContractStartDate AND cr.LastItemContractDate_current),'On rent', CAST(DATEDIFF(d,cr.LastItemContractDate,GETDATE())AS VARCHAR(20)) )\n, rd.TotalDaysIRO, rd.TotalDaysIMO\n\nORDER BY RTRIM(LTRIM(ifi.Num))\n\n--DROP TABLE #DateRange",
								"queryTimeout": "02:00:00",
								"partitionOption": "None"
							},
							"sink": {
								"type": "AzureSqlSink",
								"preCopyScript": "truncate table por.Inventory",
								"writeBehavior": "insert",
								"sqlWriterUseTableLock": false,
								"disableMetricsCollection": false
							},
							"enableStaging": false,
							"translator": {
								"type": "TabularTranslator",
								"mappings": [
									{
										"source": {
											"name": "KEY",
											"type": "String",
											"physicalType": "nvarchar"
										},
										"sink": {
											"name": "KEY",
											"type": "String",
											"physicalType": "nvarchar"
										}
									},
									{
										"source": {
											"name": "Name",
											"type": "String",
											"physicalType": "nvarchar"
										},
										"sink": {
											"name": "Name",
											"type": "String",
											"physicalType": "nvarchar"
										}
									},
									{
										"source": {
											"name": "Model",
											"type": "String",
											"physicalType": "nvarchar"
										},
										"sink": {
											"name": "Model",
											"type": "String",
											"physicalType": "nvarchar"
										}
									},
									{
										"source": {
											"name": "Serial_Number",
											"type": "String",
											"physicalType": "nvarchar"
										},
										"sink": {
											"name": "Serial_Number",
											"type": "String",
											"physicalType": "nvarchar"
										}
									},
									{
										"source": {
											"name": "Model_Year",
											"type": "String",
											"physicalType": "nvarchar"
										},
										"sink": {
											"name": "Model_Year",
											"type": "String",
											"physicalType": "nvarchar"
										}
									},
									{
										"source": {
											"name": "Age_In_Months",
											"type": "Int32",
											"physicalType": "int"
										},
										"sink": {
											"name": "Age_In_Months",
											"type": "Int32",
											"physicalType": "int"
										}
									},
									{
										"source": {
											"name": "Original_DOP",
											"type": "DateTime",
											"physicalType": "date"
										},
										"sink": {
											"name": "Original_DOP",
											"type": "DateTime",
											"physicalType": "date"
										}
									},
									{
										"source": {
											"name": "OEC",
											"type": "Decimal",
											"physicalType": "money",
											"scale": 4,
											"precision": 19
										},
										"sink": {
											"name": "OEC",
											"type": "Decimal",
											"physicalType": "money",
											"scale": 4,
											"precision": 19
										}
									},
									{
										"source": {
											"name": "NBV",
											"type": "Decimal",
											"physicalType": "money",
											"scale": 4,
											"precision": 19
										},
										"sink": {
											"name": "NBV",
											"type": "Decimal",
											"physicalType": "money",
											"scale": 4,
											"precision": 19
										}
									},
									{
										"source": {
											"name": "Accum_Depr",
											"type": "Decimal",
											"physicalType": "money",
											"scale": 4,
											"precision": 19
										},
										"sink": {
											"name": "Accum_Depr",
											"type": "Decimal",
											"physicalType": "money",
											"scale": 4,
											"precision": 19
										}
									},
									{
										"source": {
											"name": "Acquisition_Cost",
											"type": "Decimal",
											"physicalType": "money",
											"scale": 4,
											"precision": 19
										},
										"sink": {
											"name": "Acquisition_Cost",
											"type": "Decimal",
											"physicalType": "money",
											"scale": 4,
											"precision": 19
										}
									},
									{
										"source": {
											"name": "PO_Number",
											"type": "Int32",
											"physicalType": "int"
										},
										"sink": {
											"name": "PO_Number",
											"type": "Int32",
											"physicalType": "int"
										}
									},
									{
										"source": {
											"name": "Extra_Cost",
											"type": "Decimal",
											"physicalType": "money",
											"scale": 4,
											"precision": 19
										},
										"sink": {
											"name": "Extra_Cost",
											"type": "Decimal",
											"physicalType": "money",
											"scale": 4,
											"precision": 19
										}
									},
									{
										"source": {
											"name": "Current_Store",
											"type": "String",
											"physicalType": "nvarchar"
										},
										"sink": {
											"name": "Current_Store",
											"type": "String",
											"physicalType": "nvarchar"
										}
									},
									{
										"source": {
											"name": "Category",
											"type": "String",
											"physicalType": "nvarchar"
										},
										"sink": {
											"name": "Category",
											"type": "String",
											"physicalType": "nvarchar"
										}
									},
									{
										"source": {
											"name": "Header",
											"type": "String",
											"physicalType": "nvarchar"
										},
										"sink": {
											"name": "Header",
											"type": "String",
											"physicalType": "nvarchar"
										}
									},
									{
										"source": {
											"name": "Type",
											"type": "String",
											"physicalType": "nvarchar"
										},
										"sink": {
											"name": "Type",
											"type": "String",
											"physicalType": "nvarchar"
										}
									},
									{
										"source": {
											"name": "Hours",
											"type": "Single",
											"physicalType": "real"
										},
										"sink": {
											"name": "Hours",
											"type": "Single",
											"physicalType": "real"
										}
									},
									{
										"source": {
											"name": "Make",
											"type": "String",
											"physicalType": "nvarchar"
										},
										"sink": {
											"name": "Make",
											"type": "String",
											"physicalType": "nvarchar"
										}
									},
									{
										"source": {
											"name": "Legacy_ID",
											"type": "String",
											"physicalType": "nvarchar"
										},
										"sink": {
											"name": "Legacy_ID",
											"type": "String",
											"physicalType": "nvarchar"
										}
									},
									{
										"source": {
											"name": "30d_TU",
											"type": "String",
											"physicalType": "varchar"
										},
										"sink": {
											"name": "30d_TU",
											"type": "String",
											"physicalType": "nvarchar"
										}
									},
									{
										"source": {
											"name": "90d_TU",
											"type": "String",
											"physicalType": "varchar"
										},
										"sink": {
											"name": "90d_TU",
											"type": "String",
											"physicalType": "nvarchar"
										}
									},
									{
										"source": {
											"name": "180d_TU",
											"type": "String",
											"physicalType": "varchar"
										},
										"sink": {
											"name": "180d_TU",
											"type": "String",
											"physicalType": "nvarchar"
										}
									},
									{
										"source": {
											"name": "R12_TU",
											"type": "String",
											"physicalType": "varchar"
										},
										"sink": {
											"name": "R12_TU",
											"type": "String",
											"physicalType": "nvarchar"
										}
									},
									{
										"source": {
											"name": "YTD_TU",
											"type": "String",
											"physicalType": "varchar"
										},
										"sink": {
											"name": "YTD_TU",
											"type": "String",
											"physicalType": "nvarchar"
										}
									},
									{
										"source": {
											"name": "30d_$Ut%",
											"type": "String",
											"physicalType": "varchar"
										},
										"sink": {
											"name": "30d_$Ut%",
											"type": "String",
											"physicalType": "nvarchar"
										}
									},
									{
										"source": {
											"name": "90d_$Ut%",
											"type": "String",
											"physicalType": "varchar"
										},
										"sink": {
											"name": "90d_$Ut%",
											"type": "String",
											"physicalType": "nvarchar"
										}
									},
									{
										"source": {
											"name": "180d_$Ut%",
											"type": "String",
											"physicalType": "varchar"
										},
										"sink": {
											"name": "180d_$Ut%",
											"type": "String",
											"physicalType": "nvarchar"
										}
									},
									{
										"source": {
											"name": "R12_$Ut%",
											"type": "String",
											"physicalType": "varchar"
										},
										"sink": {
											"name": "R12_$Ut%",
											"type": "String",
											"physicalType": "nvarchar"
										}
									},
									{
										"source": {
											"name": "YTD_$Ut%",
											"type": "String",
											"physicalType": "varchar"
										},
										"sink": {
											"name": "YTD_$Ut%",
											"type": "String",
											"physicalType": "nvarchar"
										}
									},
									{
										"source": {
											"name": "LTD_Revenue",
											"type": "Decimal",
											"physicalType": "money",
											"scale": 4,
											"precision": 19
										},
										"sink": {
											"name": "LTD_Revenue",
											"type": "Decimal",
											"physicalType": "money",
											"scale": 4,
											"precision": 19
										}
									},
									{
										"source": {
											"name": "SP%_LTDTU",
											"type": "String",
											"physicalType": "varchar"
										},
										"sink": {
											"name": "SP%_LTDTU",
											"type": "String",
											"physicalType": "nvarchar"
										}
									},
									{
										"source": {
											"name": "SP%_Life_Down",
											"type": "String",
											"physicalType": "varchar"
										},
										"sink": {
											"name": "SP%_Life_Down",
											"type": "String",
											"physicalType": "nvarchar"
										}
									},
									{
										"source": {
											"name": "Last_Rent_In_Days",
											"type": "String",
											"physicalType": "varchar"
										},
										"sink": {
											"name": "Last_Rent_In_Days",
											"type": "String",
											"physicalType": "nvarchar"
										}
									},
									{
										"source": {
											"name": "Total_Labor_Hours",
											"type": "Double",
											"physicalType": "float"
										},
										"sink": {
											"name": "Total_Labor_Hours",
											"type": "Double",
											"physicalType": "float"
										}
									},
									{
										"source": {
											"name": "Total_Labor_Cost",
											"type": "Decimal",
											"physicalType": "decimal",
											"scale": 2,
											"precision": 38
										},
										"sink": {
											"name": "Total_Labor_Cost",
											"type": "Decimal",
											"physicalType": "money",
											"scale": 4,
											"precision": 19
										}
									},
									{
										"source": {
											"name": "Days_Since_Last_Down",
											"type": "String",
											"physicalType": "varchar"
										},
										"sink": {
											"name": "Days_Since_Last_Down",
											"type": "String",
											"physicalType": "nvarchar"
										}
									},
									{
										"source": {
											"name": "Last_Down_Type",
											"type": "String",
											"physicalType": "varchar"
										},
										"sink": {
											"name": "Last_Down_Type",
											"type": "String",
											"physicalType": "nvarchar"
										}
									},
									{
										"source": {
											"name": "IRO_Totals",
											"type": "Int32",
											"physicalType": "int"
										},
										"sink": {
											"name": "IRO_Totals",
											"type": "Int32",
											"physicalType": "int"
										}
									},
									{
										"source": {
											"name": "IRO_Days_Down",
											"type": "Int32",
											"physicalType": "int"
										},
										"sink": {
											"name": "IRO_Days_Down",
											"type": "Int32",
											"physicalType": "int"
										}
									},
									{
										"source": {
											"name": "IRO_Labor_Parts_Cost",
											"type": "Decimal",
											"physicalType": "decimal",
											"scale": 2,
											"precision": 38
										},
										"sink": {
											"name": "IRO_Labor_Parts_Cost",
											"type": "Decimal",
											"physicalType": "money",
											"scale": 4,
											"precision": 19
										}
									},
									{
										"source": {
											"name": "IMO_Totals",
											"type": "Int32",
											"physicalType": "int"
										},
										"sink": {
											"name": "IMO_Totals",
											"type": "Int32",
											"physicalType": "int"
										}
									},
									{
										"source": {
											"name": "IMO_Days_Down",
											"type": "Int32",
											"physicalType": "int"
										},
										"sink": {
											"name": "IMO_Days_Down",
											"type": "Int32",
											"physicalType": "int"
										}
									},
									{
										"source": {
											"name": "IMO_Labor_PartsCost",
											"type": "Decimal",
											"physicalType": "decimal",
											"scale": 2,
											"precision": 38
										},
										"sink": {
											"name": "IMO_Labor_PartsCost",
											"type": "Decimal",
											"physicalType": "money",
											"scale": 4,
											"precision": 19
										}
									},
									{
										"source": {
											"name": "last_refresh_date",
											"type": "DateTime",
											"physicalType": "datetime"
										},
										"sink": {
											"name": "last_refresh_date",
											"type": "DateTime",
											"physicalType": "datetime"
										}
									},
									{
										"source": {
											"name": "Store_Name",
											"type": "String",
											"physicalType": "nvarchar"
										},
										"sink": {
											"name": "Store_Name",
											"type": "String",
											"physicalType": "nvarchar"
										}
									}
								],
								"typeConversion": true,
								"typeConversionSettings": {
									"allowDataTruncation": true,
									"treatBooleanAsNumber": false
								}
							}
						},
						"inputs": [
							{
								"referenceName": "DS_POR",
								"type": "DatasetReference",
								"parameters": {
									"schema_name": "dbo",
									"table_name": "user"
								}
							}
						],
						"outputs": [
							{
								"referenceName": "Briggs_MDW",
								"type": "DatasetReference",
								"parameters": {
									"schema_name": "POR",
									"table_name": "Inventory"
								}
							}
						]
					},
					{
						"name": "Purchase_Orders",
						"type": "Copy",
						"dependsOn": [
							{
								"activity": "Inventory",
								"dependencyConditions": [
									"Succeeded"
								]
							}
						],
						"policy": {
							"timeout": "7.00:00:00",
							"retry": 0,
							"retryIntervalInSeconds": 30,
							"secureOutput": false,
							"secureInput": false
						},
						"userProperties": [],
						"typeProperties": {
							"source": {
								"type": "SqlServerSource",
								"sqlReaderQuery": "/*\nPOR Purchase Orders report\nLast Modified:  2022.03.29\n*/\n\n--Temp table (1/1)\tSupplement table\n--IF OBJECT_ID('tempdb..##POStatus') IS NOT NULL \n--   DROP TABLE #POStatus;  \n--GO\nDeclare @POStatus as TABLE (POStatusID VARCHAR(1) PRIMARY KEY, POStatus VARCHAR(15))\nINSERT INTO @POStatus VALUES\n ('O', 'Open')\n,('B', 'BackOrdered')\n,('C', 'Closed')\n,('V', 'Voided')\n,('P', 'Requisition');\n\n\n--CTE (1/1)  ShipTo column - clean and normalize\nWITH storeName_cte AS (\nSELECT\npo.PONumber, po.Sequence, pod.LineNumber, post.Company\n, CASE WHEN post.Company LIKE '%Reserve%' THEN 'Reserve'\n\tWHEN po.Notes LIKE '%Ship to%#%' THEN IIF(ISNUMERIC(LEFT(LTRIM(SUBSTRING(po.Notes,CHARINDEX('#',po.Notes)+1,LEN(po.Notes))),3))=1, LEFT(LTRIM(SUBSTRING(po.Notes,CHARINDEX('#',po.Notes)+1,LEN(po.Notes))),3), 'Reserve')\n\tWHEN po.Notes LIKE '%Ship to %' THEN IIF(ISNUMERIC(LTRIM(RTRIM(SUBSTRING(post.Company, PATINDEX('%[0-9]%', post.Company), PATINDEX('%[0-9][^0-9]%', post.Company + 't') - PATINDEX('%[0-9]%', post.Company) + 1))))=1,LTRIM(RTRIM(SUBSTRING(post.Company, PATINDEX('%[0-9]%', post.Company), PATINDEX('%[0-9][^0-9]%', post.Company + 't') - PATINDEX('%[0-9]%', post.Company) + 1))) ,'Reserve')\n\tWHEN po.Notes LIKE '%Reserve%' THEN 'Reserve'\n\tWHEN ISNUMERIC(LTRIM(RTRIM(LEFT(post.Company,3))))=1 THEN LTRIM(RTRIM(LEFT(post.Company,3)))\n\tWHEN ISNUMERIC(LEFT(LTRIM(RTRIM(SUBSTRING(post.Company, PATINDEX('%[0-9]%', post.Company), PATINDEX('%[0-9][^0-9]%', post.Company + 't') - PATINDEX('%[0-9]%', post.Company) + 1))),3)) =1 THEN CAST(LEFT(LTRIM(RTRIM(SUBSTRING(post.Company, PATINDEX('%[0-9]%', post.Company), PATINDEX('%[0-9][^0-9]%', post.Company + 't') - PATINDEX('%[0-9]%', post.Company) + 1))),3) AS VARCHAR(MAX))\n\tWHEN ifi.CurrentStore > 0 THEN ifi.CurrentStore\n\tELSE 'Unknown' END AS StoreNumber\nFROM POR.dbo.PurchaseOrder po\nJOIN POR.dbo.PurchaseOrderDetail pod ON pod.PONumber = po.PONumber AND pod.[Sequence] = po.[Sequence]\nLEFT JOIN POR.dbo.PurchaseOrderShipTo post ON post.PONumber = po.PONumber AND post.[Sequence] = po.[Sequence]\nLEFT JOIN POR.dbo.ItemFile ifi ON ifi.NUM = pod.ItemNumber\nLEFT JOIN POR.dbo.ParameterFile pf ON pf.Store = ifi.CurrentStore\n)\n\n\nSELECT\n  po.PONumber AS [PO_Number]\n, po.Store\n, COALESCE(pf.STORE_NAME, IIF(LEN(sn.StoreNumber)=3, sn.Company,sn.StoreNumber)) AS [Ship_To]\n, po.[Sequence]\n, pod.LineNumber AS [Line_Number]\n, pos.POStatus AS [PO_Status]\n, CAST(po.[Date] AS DATE) AS [PO_Date]\n, IIF(pod.QuantityOrdered = pod.QuantityReceived, CAST(pod.DateReceived AS DATE), NULL) AS [Est_Arrival]\t--requires data feed\n, oi.OPNM AS [PO_By]\n, vh.VendorName AS [Vendor_Name]\n, pod.Comments AS [Line_Comments]\n, po.Notes AS [PO_Notes]\n, pod.ItemNumber AS [PO_Item_Num]\n, COALESCE(ifi.Header,ic.Name) AS Header\n, SUBSTRING(ic.[Name],0,CHARINDEX('-',ic.[Name])) AS Category\n, SUBSTRING(ic.[Name],CHARINDEX('-',ic.[Name])+1,LEN(ic.[Name])) AS [Category_Description]\n, pod.QuantityOrdered AS [Quantity_Ordered]\n, CAST(pod.PriceEach AS DECIMAL(18,2)) AS [Price_Each]\n, CAST(pod.ExtendedPrice AS DECIMAL(18,2)) AS [Extended_Price]\n, CAST((pod.QuantityOrdered * pod.FreightEach) AS DECIMAL(18,2)) AS [Extended_Freight]\n, CAST((pod.QuantityOrdered * pod.TaxEach) AS DECIMAL(18,2)) AS [Extended_Tax]\n, CAST((pod.QuantityOrdered * pod.MiscEach) AS DECIMAL(18,2)) AS [Extended_Misc]\n, CAST(SUM(pod.ExtendedPrice + (pod.QuantityOrdered * pod.FreightEach) \n\t+ (pod.QuantityOrdered * pod.TaxEach) + (pod.QuantityOrdered * pod.MiscEach)) AS DECIMAL(18,2)) AS [Total_Line_Amt]\n, IIF(pod.QuantityOrdered = pod.QuantityReceived,'Y','N') AS Received\n, IIF(pod.QuantityOrdered = pod.QuantityReceived, CAST(pod.DateReceived AS DATE), NULL) AS [Received_Date]\n, IIF(pod.QuantityOrdered = pod.QuantityReceived, ifi.NUM, NULL) AS [Item_Num]\n, IIF(pod.QuantityOrdered = pod.QuantityReceived, ifi.SerialNumber, NULL) AS [Serial_Number]\n, pogl.Number AS [GL_Number]\n, pogl.GLAccountNumber AS [GL_Account_Number]\n, getdate() AS [Last_Refresh_Date]\nFROM POR.dbo.PurchaseOrder po\nJOIN POR.dbo.PurchaseOrderDetail pod ON pod.PONumber = po.PONumber AND pod.[Sequence] = po.[Sequence]\nJOIN @POStatus pos ON pos.POStatusID = po.[Status]\nJOIN storeName_cte sn ON sn.PONumber = pod.PONumber AND sn.[Sequence] = pod.[Sequence] AND sn.LineNumber = pod.LineNumber\nLEFT JOIN POR.dbo.PurchaseOrderGL pogl ON pogl.Number = pod.GLNumber\nLEFT JOIN POR.dbo.VendorFile vh ON vh.VendorNumber = po.VendorNumber\nLEFT JOIN POR.dbo.ItemFile ifi ON ifi.NUM = pod.ItemNumber\nLEFT JOIN POR.dbo.ItemCategory ic ON ic.Category = ifi.Category\nLEFT JOIN POR.dbo.ParameterFile pf ON pf.Store = sn.StoreNumber\nLEFT JOIN POR.dbo.OperatorId oi ON oi.OPNO = po.Opr\n\nWHERE pod.GLAccount = 'Equipment ASSET Purchases'\nAND pod.QuantityOrdered > 0\nAND (LEFT(ifi.[KEY],7) <> 'SpclOrd' OR ifi.[KEY] IS NULL)\n\nGROUP BY\n  po.PONumber\n, po.Store\n, COALESCE(pf.STORE_NAME, IIF(LEN(sn.StoreNumber)=3, sn.Company,sn.StoreNumber))\n, po.[Sequence]\n, pod.LineNumber\n, pos.POStatus\n, CAST(po.[Date] AS DATE)\n, IIF(pod.QuantityOrdered = pod.QuantityReceived, CAST(pod.DateReceived AS DATE), NULL)\t-- EstArrival:  requires data feed\n, oi.OPNM\n, vh.VendorName\n, pod.Comments\n, po.Notes\n, pod.ItemNumber\n, COALESCE(ifi.Header,ic.Name)\n, SUBSTRING(ic.[Name],0,CHARINDEX('-',ic.[Name]))\n, SUBSTRING(ic.[Name],CHARINDEX('-',ic.[Name])+1,LEN(ic.[Name]))\n, pod.QuantityOrdered\n, pod.PriceEach\n, pod.ExtendedPrice\n, CAST((pod.QuantityOrdered * pod.FreightEach) AS DECIMAL(18,2))\n, CAST((pod.QuantityOrdered * pod.TaxEach) AS DECIMAL(18,2))\n, CAST((pod.QuantityOrdered * pod.MiscEach) AS DECIMAL(18,2))\n, IIF(pod.QuantityOrdered = pod.QuantityReceived,'Y','N')\n, IIF(pod.QuantityOrdered = pod.QuantityReceived, CAST(pod.DateReceived AS DATE), NULL)\n, IIF(pod.QuantityOrdered = pod.QuantityReceived, ifi.NUM, NULL)\n, IIF(pod.QuantityOrdered = pod.QuantityReceived, ifi.SerialNumber, NULL)\n, pogl.Number\n, pogl.GLAccountNumber\n\nORDER BY po.PONumber, po.[Sequence], pod.LineNumber\n\n--DROP TABLE #POStatus\n",
								"queryTimeout": "02:00:00",
								"partitionOption": "None"
							},
							"sink": {
								"type": "AzureSqlSink",
								"preCopyScript": "truncate table por.Purchase_Orders",
								"writeBehavior": "insert",
								"sqlWriterUseTableLock": false,
								"disableMetricsCollection": false
							},
							"enableStaging": false,
							"translator": {
								"type": "TabularTranslator",
								"mappings": [
									{
										"source": {
											"name": "PO_Number",
											"type": "Int32",
											"physicalType": "int"
										},
										"sink": {
											"name": "PO_Number",
											"type": "Int32",
											"physicalType": "int"
										}
									},
									{
										"source": {
											"name": "Store",
											"type": "String",
											"physicalType": "nvarchar"
										},
										"sink": {
											"name": "Store",
											"type": "String",
											"physicalType": "nvarchar"
										}
									},
									{
										"source": {
											"name": "Ship_To",
											"type": "String",
											"physicalType": "nvarchar"
										},
										"sink": {
											"name": "Ship_To",
											"type": "String",
											"physicalType": "nvarchar"
										}
									},
									{
										"source": {
											"name": "Sequence",
											"type": "Int32",
											"physicalType": "int"
										},
										"sink": {
											"name": "Sequence",
											"type": "Int32",
											"physicalType": "int"
										}
									},
									{
										"source": {
											"name": "Line_Number",
											"type": "Int32",
											"physicalType": "int"
										},
										"sink": {
											"name": "Line_Number",
											"type": "Int32",
											"physicalType": "int"
										}
									},
									{
										"source": {
											"name": "PO_Status",
											"type": "String",
											"physicalType": "varchar"
										},
										"sink": {
											"name": "PO_Status",
											"type": "String",
											"physicalType": "nvarchar"
										}
									},
									{
										"source": {
											"name": "PO_Date",
											"type": "DateTime",
											"physicalType": "date"
										},
										"sink": {
											"name": "PO_Date",
											"type": "DateTime",
											"physicalType": "date"
										}
									},
									{
										"source": {
											"name": "Est_Arrival",
											"type": "DateTime",
											"physicalType": "date"
										},
										"sink": {
											"name": "Est_Arrival",
											"type": "DateTime",
											"physicalType": "date"
										}
									},
									{
										"source": {
											"name": "PO_By",
											"type": "String",
											"physicalType": "nvarchar"
										},
										"sink": {
											"name": "PO_By",
											"type": "String",
											"physicalType": "nvarchar"
										}
									},
									{
										"source": {
											"name": "Vendor_Name",
											"type": "String",
											"physicalType": "nvarchar"
										},
										"sink": {
											"name": "Vendor_Name",
											"type": "String",
											"physicalType": "nvarchar"
										}
									},
									{
										"source": {
											"name": "Line_Comments",
											"type": "String",
											"physicalType": "nvarchar"
										},
										"sink": {
											"name": "Line_Comments",
											"type": "String",
											"physicalType": "nvarchar"
										}
									},
									{
										"source": {
											"name": "PO_Notes",
											"type": "String",
											"physicalType": "nvarchar"
										},
										"sink": {
											"name": "PO_Notes",
											"type": "String",
											"physicalType": "nvarchar"
										}
									},
									{
										"source": {
											"name": "PO_Item_Num",
											"type": "String",
											"physicalType": "nvarchar"
										},
										"sink": {
											"name": "PO_Item_Num",
											"type": "String",
											"physicalType": "nvarchar"
										}
									},
									{
										"source": {
											"name": "Header",
											"type": "String",
											"physicalType": "nvarchar"
										},
										"sink": {
											"name": "Header",
											"type": "String",
											"physicalType": "nvarchar"
										}
									},
									{
										"source": {
											"name": "Category",
											"type": "String",
											"physicalType": "nvarchar"
										},
										"sink": {
											"name": "Category",
											"type": "String",
											"physicalType": "nvarchar"
										}
									},
									{
										"source": {
											"name": "Category_Description",
											"type": "String",
											"physicalType": "nvarchar"
										},
										"sink": {
											"name": "Category_Description",
											"type": "String",
											"physicalType": "nvarchar"
										}
									},
									{
										"source": {
											"name": "Quantity_Ordered",
											"type": "Double",
											"physicalType": "float"
										},
										"sink": {
											"name": "Quantity_Ordered",
											"type": "Double",
											"physicalType": "float"
										}
									},
									{
										"source": {
											"name": "Price_Each",
											"type": "Decimal",
											"physicalType": "decimal",
											"scale": 2,
											"precision": 18
										},
										"sink": {
											"name": "Price_Each",
											"type": "Decimal",
											"physicalType": "decimal",
											"scale": 2,
											"precision": 18
										}
									},
									{
										"source": {
											"name": "Extended_Price",
											"type": "Decimal",
											"physicalType": "decimal",
											"scale": 2,
											"precision": 18
										},
										"sink": {
											"name": "Extended_Price",
											"type": "Decimal",
											"physicalType": "decimal",
											"scale": 2,
											"precision": 18
										}
									},
									{
										"source": {
											"name": "Extended_Freight",
											"type": "Decimal",
											"physicalType": "decimal",
											"scale": 2,
											"precision": 18
										},
										"sink": {
											"name": "Extended_Freight",
											"type": "Decimal",
											"physicalType": "decimal",
											"scale": 2,
											"precision": 18
										}
									},
									{
										"source": {
											"name": "Extended_Tax",
											"type": "Decimal",
											"physicalType": "decimal",
											"scale": 2,
											"precision": 18
										},
										"sink": {
											"name": "Extended_Tax",
											"type": "Decimal",
											"physicalType": "decimal",
											"scale": 2,
											"precision": 18
										}
									},
									{
										"source": {
											"name": "Extended_Misc",
											"type": "Decimal",
											"physicalType": "decimal",
											"scale": 2,
											"precision": 18
										},
										"sink": {
											"name": "Extended_Misc",
											"type": "Decimal",
											"physicalType": "decimal",
											"scale": 2,
											"precision": 18
										}
									},
									{
										"source": {
											"name": "Total_Line_Amt",
											"type": "Decimal",
											"physicalType": "decimal",
											"scale": 2,
											"precision": 18
										},
										"sink": {
											"name": "Total_Line_Amt",
											"type": "Decimal",
											"physicalType": "decimal",
											"scale": 2,
											"precision": 18
										}
									},
									{
										"source": {
											"name": "Received",
											"type": "String",
											"physicalType": "varchar"
										},
										"sink": {
											"name": "Received",
											"type": "String",
											"physicalType": "nvarchar"
										}
									},
									{
										"source": {
											"name": "Received_Date",
											"type": "DateTime",
											"physicalType": "date"
										},
										"sink": {
											"name": "Received_Date",
											"type": "DateTime",
											"physicalType": "date"
										}
									},
									{
										"source": {
											"name": "Item_Num",
											"type": "String",
											"physicalType": "nvarchar"
										},
										"sink": {
											"name": "Item_Num",
											"type": "String",
											"physicalType": "nvarchar"
										}
									},
									{
										"source": {
											"name": "Serial_Number",
											"type": "String",
											"physicalType": "nvarchar"
										},
										"sink": {
											"name": "Serial_Number",
											"type": "String",
											"physicalType": "nvarchar"
										}
									},
									{
										"source": {
											"name": "GL_Number",
											"type": "Int32",
											"physicalType": "int"
										},
										"sink": {
											"name": "GL_Number",
											"type": "Int32",
											"physicalType": "int"
										}
									},
									{
										"source": {
											"name": "GL_Account_Number",
											"type": "String",
											"physicalType": "nvarchar"
										},
										"sink": {
											"name": "GL_Account_Number",
											"type": "String",
											"physicalType": "nvarchar"
										}
									},
									{
										"source": {
											"name": "Last_Refresh_Date",
											"type": "DateTime",
											"physicalType": "datetime"
										},
										"sink": {
											"name": "Last_Refresh_Date",
											"type": "DateTime",
											"physicalType": "datetime"
										}
									}
								],
								"typeConversion": true,
								"typeConversionSettings": {
									"allowDataTruncation": true,
									"treatBooleanAsNumber": false
								}
							}
						},
						"inputs": [
							{
								"referenceName": "DS_POR",
								"type": "DatasetReference",
								"parameters": {
									"schema_name": "dbo",
									"table_name": "user"
								}
							}
						],
						"outputs": [
							{
								"referenceName": "Briggs_MDW",
								"type": "DatasetReference",
								"parameters": {
									"schema_name": "POR",
									"table_name": "Purchase_Orders"
								}
							}
						]
					}
				],
				"policy": {
					"elapsedTimeMetric": {},
					"cancelAfter": {}
				},
				"folder": {
					"name": "MDP POR DataLoad"
				},
				"annotations": [],
				"lastPublishTime": "2022-03-29T21:19:40Z"
			},
			"dependsOn": [
				"[concat(variables('workspaceId'), '/datasets/DS_POR')]",
				"[concat(variables('workspaceId'), '/datasets/Briggs_MDW')]"
			]
		},
		{
			"name": "[concat(parameters('workspaceName'), '/Load_POR_TEMP_copy1')]",
			"type": "Microsoft.Synapse/workspaces/pipelines",
			"apiVersion": "2019-06-01-preview",
			"properties": {
				"activities": [
					{
						"name": "Heavy Equipment Tax_Updated",
						"type": "Copy",
						"dependsOn": [],
						"policy": {
							"timeout": "7.00:00:00",
							"retry": 0,
							"retryIntervalInSeconds": 30,
							"secureOutput": false,
							"secureInput": false
						},
						"userProperties": [],
						"typeProperties": {
							"source": {
								"type": "AzureSqlSource",
								"sqlReaderQuery": " SELECT distinct  CLDT\n  ,CONVERT (varchar(10),CLDT, 101) as ClosedDate\n  ,CASE LEFT(t.CNTR,1) \n\t  WHEN 'c' THEN 'Credit'\n\t  ELSE 'Invoice'\n\t  END AS TransactionType,\n      t.CNTR as 'Contract'\n\t, cust.[KEY] AS 'POR Customer'\n\t, cust.[NAME] As 'Customer Name'\n\t, cust.APILink AS NetSuiteCustomer\n\t,[STR] AS 'Store'\n\t,CASE SUBSTRING(TXTY,1,1)\n\t\t\tWHEN 'R' THEN 'Rental'\n\t\t\tWHEN 'S' THEN 'Sale'\n\t\t\tEND AS LinePrimaryStatus\n\t\t--CASE SUBSTRING(TXTY,2,1)\n\t\t--\tWHEN 'R' THEN 'Returned'\n\t\t--\tWHEN 'X' THEN 'Prev Returned'\n\t\t--\tWHEN 'H' THEN 'Not Returned. Hold'\n\t\t--\tWHEN 'S' THEN 'Sales Item'\n\t\t--\tWHEN 'A' THEN 'Sold Asset'\n\t\t--\tWHEN 'D' THEN 'Not Returned'\n\t\t--\tWHEN 'M' THEN 'Not Returned Reservation'\n\t\t--\tWHEN 'N' THEN 'Not Returned'\n\t\t--\tWHEN ' ' THEN 'Not Returned'\n\t\t--ELSE 'UNKNOWN'\n\t\t--END AS LineSecondaryStatus\n\t,cat.[Name] AS CatDesc\n\t,ifile.[KEY] AS ItemKey\n\t,ifile.NUM AS ItemNumber\n\t,ifile.[Name] As EquipDesc\n\t,FUEL\n\t,MANF AS Manufacturer\n\t,MODN AS ModelNumber\n\t,ModelYear\n\t,SerialNumber\n\t,DEPA AS AssetCost\n\t,PRIC AS ItemAmount,\n\tgetdate() last_refresh_date\n    FROM [POR].Transactions t\n        JOIN [POR].AccountingAPIQueueTR api ON api.ContractNumber = t.CNTR\n        JOIN [POR].TransactionItems i ON i.CNTR = t.CNTR\n        JOIN [POR].ItemFile ifile ON ifile.NUM = i.ITEM  ---\n        JOIN [POR].ItemCategory cat ON ifile.Category = cat.Category\n        JOIN [POR].CustomerFile cust ON cust.CNUM = t.CUSN\n        LEFT JOIN [POR].ParameterFile store ON t.[STR] = store.Store\n    WHERE \nt.STAT IN ('C', 'CR') \nAND api.NoExport = 0\nAND STORE_CITY LIKE '%TX%'\n--AND ifile.TYPE IN ('H','T')\nAND  GVWR = 1\nAND cat.[Name] !='RERENT'\norder by t.CLDT",
								"queryTimeout": "02:00:00",
								"partitionOption": "None"
							},
							"sink": {
								"type": "AzureSqlSink",
								"preCopyScript": "truncate table por.Heavy_Equipment_Tax",
								"disableMetricsCollection": false
							},
							"enableStaging": false,
							"translator": {
								"type": "TabularTranslator",
								"typeConversion": true,
								"typeConversionSettings": {
									"allowDataTruncation": true,
									"treatBooleanAsNumber": false
								}
							}
						},
						"inputs": [
							{
								"referenceName": "Briggs_MDW",
								"type": "DatasetReference",
								"parameters": {
									"schema_name": "dbo",
									"table_name": "user"
								}
							}
						],
						"outputs": [
							{
								"referenceName": "Briggs_MDW",
								"type": "DatasetReference",
								"parameters": {
									"schema_name": "POR",
									"table_name": "Heavy_Equipment_Tax"
								}
							}
						]
					},
					{
						"name": "TERP with Equipment Rented or Sold_Updated",
						"type": "Copy",
						"dependsOn": [
							{
								"activity": "TERP LINE ONLY_Updated",
								"dependencyConditions": [
									"Succeeded"
								]
							}
						],
						"policy": {
							"timeout": "7.00:00:00",
							"retry": 0,
							"retryIntervalInSeconds": 30,
							"secureOutput": false,
							"secureInput": false
						},
						"userProperties": [],
						"typeProperties": {
							"source": {
								"type": "AzureSqlSource",
								"sqlReaderQuery": "SELECT ClosedDate,\nTransactionType,\nT.[Contract],\n[POR Customer],\n[NetSuiteCustomer],\n[Store],\n[RentalTotal],\n[TERPAmount],\n[DeliverToName],\n[custPickup],\n[DeliveryAddress],\n[DeliveryCity],\n[DeliveryState],\n[DeliveryZip],\n[CatDesc],\n[EquipDesc],\n[SerialNumber],\n[FUEL]\n,getdate() last_refresh_date\n  FROM\n\n --- TERP Line Item \n (\n SELECT distinct \n  CONVERT (varchar(10),CLDT, 101) as ClosedDate\n  ,CASE LEFT(t.CNTR,1) \n  WHEN 'c' THEN 'Credit'\n  ELSE 'Invoice'\n  END AS TransactionType,\n        t.CNTR as 'Contract'\n\t, cust.[KEY] AS 'POR Customer'\n\t, cust.APILink AS NetSuiteCustomer\n\t,[STR] AS 'Store'\n\t,t.RENT AS RentalTotal\n\t,i.PRIC AS TERPAmount\n\t,COALESCE(NULLIF(t.DeliverToCompany,''), NULLIF(cust.[NAME],'')) AS DeliverToName\n\t, t.Pickup AS custPickup\n\t\t,CASE t.Pickup \tWHEN 0 THEN \n\t COALESCE(NULLIF(j.SiteAddress,''), NULLIF(t.DeliveryAddress,''), NULLIF(store.STORE_STRT,''))\n\t ELSE (store.STORE_STRT)\n\t END AS DeliveryAddress\n\t, CASE t.Pickup WHEN 0 THEN \n\tCOALESCE(NULLIF(LEFT(j.SiteCity, CHARINDEX(',',j.SiteCity + ',',  1) -1),''),NULLIF(LEFT(t.DeliveryCity, CHARINDEX(',',t.DeliveryCity + ',',  1) -1),''), NULLIF(LEFT(store.STORE_CITY, CHARINDEX(',',store.STORE_CITY + ',',  1) -1),'')) \n\tELSE LEFT(STORE_CITY, CHARINDEX(',',STORE_CITY + ',',  1) -1)\n\tEND AS DeliveryCity\n\t,CASE t.Pickup WHEN 0 THEN \n\tCOALESCE(NULLIF(LEFT(j.SiteCity, CHARINDEX(',',j.SiteCity + ',',  1) -1),''),NULLIF(LEFT(t.DeliveryCity, CHARINDEX(',',t.DeliveryCity + ',',  1) -1),''), NULLIF(LEFT(store.STORE_CITY, CHARINDEX(',',store.STORE_CITY + ',',  1) -1),'')) \n\tELSE SUBSTRING(STORE_CITY,CHARINDEX(',',STORE_CITY)+1,3)\tEND AS DeliveryState\n\t,CASE t.Pickup \tWHEN 0 THEN \n\tCOALESCE(NULLIF(j.SiteZip,''), NULLIF(t.DeliveryZip,''), NULLIF(store.STORE_ZIP,'')) \n\tELSE NULLIF(store.STORE_ZIP,'') END AS DeliveryZip\n\n\n    FROM [POR].Transactions t\n        JOIN [POR].AccountingAPIQueueTR api ON api.ContractNumber = t.CNTR\n        JOIN [POR].TransactionItems i ON i.CNTR = t.CNTR\n        JOIN [POR].ItemFile ifile ON ifile.NUM = i.ITEM\n        JOIN [POR].ItemCategory cat ON ifile.Category = cat.Category\n        JOIN [POR].CustomerFile cust ON cust.CNUM = t.CUSN\n        LEFT JOIN [POR].CustomerJobSite j ON t.JobSite = j.Number\n        LEFT JOIN [POR].ParameterFile store ON t.[STR] = store.Store\n    WHERE \napi.NoExport = 0\nAND  ifile.[KEY] = 'EQTAX'\nAND PRIC >0\nAND STORE_CITY LIKE '%TX%'\n--AND CLDT BETWEEN DATEADD(month, DATEDIFF(month, -1, getdate()) - 2, 0) AND DATEADD(ss, -1, DATEADD(month, DATEDIFF(month, 0, getdate()), 0))\n\n\n) T\nJOIN \n--- Equipment on Rent\n(\n\n   select distinct\n   t.CNTR AS Contract\n\t,cat.[Name] AS CatDesc\n\t,ifile.[Name] As EquipDesc\n\t,SerialNumber\n\t,ifile.FUEL\n\t\n    FROM [POR].Transactions t\n        JOIN [POR].AccountingAPIQueueTR api ON api.ContractNumber = t.CNTR\n        JOIN [POR].TransactionItems i ON i.CNTR = t.CNTR\n        JOIN [POR].ItemFile ifile ON ifile.NUM = i.ITEM  ---\n        JOIN [POR].ItemCategory cat ON ifile.Category = cat.Category\n        JOIN [POR].CustomerFile cust ON cust.CNUM = t.CUSN\n        LEFT JOIN [POR].CustomerJobSite j ON t.JobSite = j.Number\n        LEFT JOIN [POR].ParameterFile store ON t.[STR] = store.Store\n    WHERE \napi.NoExport = 0\nAND t.CNTR In\n(select i.CNTR From POR.TransactionItems i JOIN POR.Itemfile ifile ON i.ITEM= ifile.NUM  where  [KEY] = 'EQTAX' AND PRIC >0)\nAND STORE_CITY LIKE '%TX%'\nAND ifile.TYPE IN ('H','T')\n) E ON T.Contract= E.Contract\n",
								"queryTimeout": "02:00:00",
								"partitionOption": "None"
							},
							"sink": {
								"type": "AzureSqlSink",
								"preCopyScript": "truncate table por.TERP_Support",
								"disableMetricsCollection": false
							},
							"enableStaging": false,
							"translator": {
								"type": "TabularTranslator",
								"typeConversion": true,
								"typeConversionSettings": {
									"allowDataTruncation": true,
									"treatBooleanAsNumber": false
								}
							}
						},
						"inputs": [
							{
								"referenceName": "Briggs_MDW",
								"type": "DatasetReference",
								"parameters": {
									"schema_name": "dbo",
									"table_name": "user"
								}
							}
						],
						"outputs": [
							{
								"referenceName": "Briggs_MDW",
								"type": "DatasetReference",
								"parameters": {
									"schema_name": "POR",
									"table_name": "TERP_Support"
								}
							}
						]
					},
					{
						"name": "TERP LINE ONLY_Updated",
						"type": "Copy",
						"dependsOn": [
							{
								"activity": "Tax Recap_Updated",
								"dependencyConditions": [
									"Succeeded"
								]
							}
						],
						"policy": {
							"timeout": "7.00:00:00",
							"retry": 0,
							"retryIntervalInSeconds": 30,
							"secureOutput": false,
							"secureInput": false
						},
						"userProperties": [],
						"typeProperties": {
							"source": {
								"type": "AzureSqlSource",
								"sqlReaderQuery": "SELECT distinct \n  CONVERT (varchar(10),CLDT, 101) as ClosedDate\n  ,CASE LEFT(t.CNTR,1) \n  WHEN 'c' THEN 'Credit'\n  ELSE 'Invoice'\n  END AS TransactionType,\n        t.CNTR as 'Contract'\n\t, cust.[KEY] AS 'POR Customer'\n\t, cust.APILink AS NetSuiteCustomer\n\t,[STR] AS 'Store'\n\t,t.RENT AS RentalTotal\n\t,i.PRIC AS TERPAmount\n\t,COALESCE(NULLIF(t.DeliverToCompany,''), NULLIF(cust.[NAME],'')) AS DeliverToName\n\t, t.Pickup AS custPickup\n\t\t,CASE t.Pickup \tWHEN 0 THEN \n\t COALESCE(NULLIF(j.SiteAddress,''), NULLIF(t.DeliveryAddress,''), NULLIF(store.STORE_STRT,''))\n\t ELSE (store.STORE_STRT)\n\t END AS DeliveryAddress\n\t, CASE t.Pickup WHEN 0 THEN \n\tCOALESCE(NULLIF(LEFT(j.SiteCity, CHARINDEX(',',j.SiteCity + ',',  1) -1),''),NULLIF(LEFT(t.DeliveryCity, CHARINDEX(',',t.DeliveryCity + ',',  1) -1),''), NULLIF(LEFT(store.STORE_CITY, CHARINDEX(',',store.STORE_CITY + ',',  1) -1),'')) \n\tELSE LEFT(STORE_CITY, CHARINDEX(',',STORE_CITY + ',',  1) -1)\n\tEND AS DeliveryCity\n\t,CASE t.Pickup WHEN 0 THEN \n\tCOALESCE(NULLIF(LEFT(j.SiteCity, CHARINDEX(',',j.SiteCity + ',',  1) -1),''),NULLIF(LEFT(t.DeliveryCity, CHARINDEX(',',t.DeliveryCity + ',',  1) -1),''), NULLIF(LEFT(store.STORE_CITY, CHARINDEX(',',store.STORE_CITY + ',',  1) -1),'')) \n\tELSE SUBSTRING(STORE_CITY,CHARINDEX(',',STORE_CITY)+1,3)\tEND AS DeliveryState\n\t,CASE t.Pickup \tWHEN 0 THEN \n\tCOALESCE(NULLIF(j.SiteZip,''), NULLIF(t.DeliveryZip,''), NULLIF(store.STORE_ZIP,'')) \n\tELSE NULLIF(store.STORE_ZIP,'') END AS DeliveryZip\n\n\t,getdate() last_refresh_date\n    FROM [POR].Transactions t\n        JOIN [POR].AccountingAPIQueueTR api ON api.ContractNumber = t.CNTR\n        JOIN [POR].TransactionItems i ON i.CNTR = t.CNTR\n        JOIN [POR].ItemFile ifile ON ifile.NUM = i.ITEM\n        JOIN [POR].ItemCategory cat ON ifile.Category = cat.Category\n        JOIN [POR].CustomerFile cust ON cust.CNUM = t.CUSN\n        LEFT JOIN [POR].CustomerJobSite j ON t.JobSite = j.Number\n        LEFT JOIN [POR].ParameterFile store ON t.[STR] = store.Store\n    WHERE \napi.NoExport = 0\nAND  ifile.[KEY] = 'EQTAX'\nAND PRIC >0\nAND STORE_CITY LIKE '%TX%'\n--AND CLDT BETWEEN DATEADD(month, DATEDIFF(month, -1, getdate()) - 2, 0) AND DATEADD(ss, -1, DATEADD(month, DATEDIFF(month, 0, getdate()), 0))",
								"queryTimeout": "02:00:00",
								"partitionOption": "None"
							},
							"sink": {
								"type": "AzureSqlSink",
								"preCopyScript": "truncate table por.TERP",
								"disableMetricsCollection": false
							},
							"enableStaging": false,
							"translator": {
								"type": "TabularTranslator",
								"typeConversion": true,
								"typeConversionSettings": {
									"allowDataTruncation": true,
									"treatBooleanAsNumber": false
								}
							}
						},
						"inputs": [
							{
								"referenceName": "Briggs_MDW",
								"type": "DatasetReference",
								"parameters": {
									"schema_name": "dbo",
									"table_name": "user"
								}
							}
						],
						"outputs": [
							{
								"referenceName": "Briggs_MDW",
								"type": "DatasetReference",
								"parameters": {
									"schema_name": "POR",
									"table_name": "TERP"
								}
							}
						]
					},
					{
						"name": "Tax Recap_Updated",
						"type": "Copy",
						"dependsOn": [
							{
								"activity": "Heavy Equipment Tax_Updated",
								"dependencyConditions": [
									"Succeeded"
								]
							}
						],
						"policy": {
							"timeout": "7.00:00:00",
							"retry": 0,
							"retryIntervalInSeconds": 30,
							"secureOutput": false,
							"secureInput": false
						},
						"userProperties": [],
						"typeProperties": {
							"source": {
								"type": "AzureSqlSource",
								"sqlReaderQuery": "select distinct CLDT,\n  CONVERT (varchar(10),CLDT, 101) as ClosedDate\n  ,CASE LEFT(CNTR,1) \n  WHEN 'c' THEN 'Credit'\n  ELSE 'Invoice'\n  END AS TransactionType,\n        t.CNTR as 'Contract'\n\t, cust.[KEY] AS 'POR Customer'\n\t, cust.APILink AS NetSuiteCustomer\n\t, cust.[Name] As 'Customer Name'\n\t, [STR] AS 'Store'\n\t, t.Rent AS 'RentTotal'\n\t, t.SALE AS 'SaleTotal'\n\t, t.Rent + t.SALE AS 'RevTotal'\n\t, t.DMG AS 'Damage Waiver'\n\t, Tax\n\t, Totl AS InvoiceTotal\n\t, CASE t.Pickup \n\tWHEN 0 THEN 'Delivery'\n\tWHEN 1 THEN 'Customer Pickup'\n\tELSE 'NA'\n\tEND AS custPickup\n\t--\t, COALESCE(NULLIF(j.SiteAddress,''), NULLIF(t.DeliveryAddress,''), NULLIF(store.STORE_STRT,'')) as DeliveryAddress\n\t\n\t,CASE t.Pickup \tWHEN 0 THEN \n\t COALESCE(NULLIF(j.SiteAddress,''), NULLIF(t.DeliveryAddress,''), NULLIF(store.STORE_STRT,''))\n\t ELSE (store.STORE_STRT)\n\t END AS DeliveryAddress\n\t, CASE t.Pickup WHEN 0 THEN \n\tCOALESCE(NULLIF(LEFT(j.SiteCity, CHARINDEX(',',j.SiteCity + ',',  1) -1),''),NULLIF(LEFT(t.DeliveryCity, CHARINDEX(',',t.DeliveryCity + ',',  1) -1),''), NULLIF(LEFT(store.STORE_CITY, CHARINDEX(',',store.STORE_CITY + ',',  1) -1),'')) \n\tELSE LEFT(STORE_CITY, CHARINDEX(',',STORE_CITY + ',',  1) -1)\n\tEND AS DeliveryCity\n\t,CASE t.Pickup WHEN 0 THEN \n\tCOALESCE(TRIM(NULLIF(RIGHT(j.SiteCity, NULLIF(CHARINDEX(',',REVERSE(j.SiteCity)),'') -1),'')),TRIM(NULLIF(RIGHT(t.DeliveryCity, NULLIF(CHARINDEX(',',REVERSE(t.DeliveryCity)),'') -1),''))\t,\n\tTRIM(NULLIF(RIGHT(store.STORE_CITY, NULLIF(CHARINDEX(',',REVERSE(store.STORE_CITY)),'') -1),''))) \n\tELSE TRIM(SUBSTRING(STORE_CITY,CHARINDEX(',',STORE_CITY)+1,3))\tEND AS DeliveryState\n\t,CASE t.Pickup \tWHEN 0 THEN \n\tCOALESCE(NULLIF(j.SiteZip,''), NULLIF(t.DeliveryZip,''), NULLIF(store.STORE_ZIP,'')) \n\tELSE NULLIF(store.STORE_ZIP,'') END AS DeliveryZip\n\t--,store.STORE_NAME As StoreName,\n\t--store.STORE_STRT AS StoreAddress, STORE_CITY AS StoreCity, STORE_ZIP AS StoreZipCode\n    ,getdate() last_refresh_date\n\tFROM [POR].Transactions t\n        JOIN [POR].AccountingAPIQueueTR api ON api.ContractNumber = t.CNTR\n        JOIN [POR].CustomerFile cust ON cust.CNUM = t.CUSN\n        LEFT JOIN [POR].CustomerJobSite j ON t.JobSite = j.Number\n        LEFT JOIN [POR].ParameterFile store ON t.[STR] = store.Store\n\t    WHERE t.STAT IN ('C', 'CR')  AND\n api.NoExport = 0\n-- AND CLDT BETWEEN DATEADD(month, DATEDIFF(month, -1, getdate()) - 2, 0) AND DATEADD(ss, -1, DATEADD(month, DATEDIFF(month, 0, getdate()), 0))\n order by CLDT, CNTR\n",
								"queryTimeout": "02:00:00",
								"partitionOption": "None"
							},
							"sink": {
								"type": "AzureSqlSink",
								"preCopyScript": "truncate table por.Tax_Summary",
								"disableMetricsCollection": false
							},
							"enableStaging": false,
							"translator": {
								"type": "TabularTranslator",
								"typeConversion": true,
								"typeConversionSettings": {
									"allowDataTruncation": true,
									"treatBooleanAsNumber": false
								}
							}
						},
						"inputs": [
							{
								"referenceName": "Briggs_MDW",
								"type": "DatasetReference",
								"parameters": {
									"schema_name": "dbo",
									"table_name": "user"
								}
							}
						],
						"outputs": [
							{
								"referenceName": "Briggs_MDW",
								"type": "DatasetReference",
								"parameters": {
									"schema_name": "POR",
									"table_name": "Tax_Summary"
								}
							}
						]
					},
					{
						"name": "POR_Open_Contract",
						"type": "Copy",
						"dependsOn": [],
						"policy": {
							"timeout": "7.00:00:00",
							"retry": 0,
							"retryIntervalInSeconds": 30,
							"secureOutput": false,
							"secureInput": false
						},
						"userProperties": [],
						"typeProperties": {
							"source": {
								"type": "AzureSqlSource",
								"sqlReaderQuery": "SELECT\n--Below are Transaction Level Items\nCASE WHEN pf.Store <> '001' THEN RIGHT(pf.STORE_NAME, LEN(pf.STORE_NAME) - 4) ELSE pf.STORE_NAME END AS [Store_Name]\n, t.[STR] AS [Store_No]\n, CASE WHEN t.PYMT = 'E' THEN 'Account' ELSE 'Cash' END AS Customer_Type\n--, cf.[Key] AS [Customer Number]\n, cf.[CNUM] AS [Customer_Number]\n, cf.[Name] AS [Customer_Name]\n, t.JOBN AS [Job_Name]\n, t.JBPO AS [Job_PO]\n, t.JBID AS [Job_id]\n, cjs.Description AS [Job_Site_Name]\n, ISNULL(cjs.SiteAddress,'') + ' ' + ISNULL(cjs.SiteCity,'') + ' ' + ISNULL(cjs.SiteZip,'') AS [Job_Site_Address]\n, t.DMG AS [Extended_Protection_Plan]\n, s.[Name] AS [Contract_Salesman]\n, s2.[Name] AS [Customer_Salesman]\n, o.OPNM AS [Created_by_Operator_Name]\n, o2.OPNM AS [Assigned_to_Operator_Name] -- This drives the revenue\n, t.[DATE] AS [Contract_Date]\n, t1.OriginalContractDate AS [Original_Contract_Date]\n, t.[CNTR] AS [Contract_No]\n--Below are Item level details\n/** NOTE for this case statement --IF TXTY is RR (Called Off) then we should add ti.DDT as called off date, otherwise John doesn't want to see ti.DDT. Not sure best way to go about that in PowerBI **/\n, CASE WHEN ti.TXTY = 'R' THEN 'RENT'\nWHEN ti.TXTY = 'RR' THEN 'Returned'\nWHEN ti.TXTY = 'RX' THEN 'Previously Returned'\nWHEN ti.TXTY = 'RH' THEN 'Not Returned. Item on hold for pickup'\nWHEN ti.TXTY = 'RD' THEN 'Not Returned. Demand letter sent'\nWHEN ti.TXTY = 'RM' THEN 'Not Returned. Reservation Reminder letter sent'\nWHEN ti.TXTY = 'RN' THEN 'Not Returned. Reminder letter sent'\nWHEN ti.TXTY = 'RV' THEN 'Not Returned. Reservation Verify letter sent'\nWHEN ti.TXTY = '' THEN 'Not Returned. No letters have been sent'\nELSE 'Sale Item' END AS [Item_Status]\n, ifi.Header -- John wants to see HEADER key that each ITEM belongs too for grouping/pivot/lookup purposes\n--, ti.ITEM AS [Key]\n\n, ifi.[KEY] \n, ifi.Name\n, ifi.SerialNumber AS [Serial_Number]\n, ifi.MANF AS [Make]\n, ifi.MODN AS [Model]\n, ifi.Modelyear AS [Model_Year]\n, ti.PRIC AS [Amount_Charged]\n, ti.DailyAmount AS [Daily]\n, ifi.RATE1 AS [Book_Rate_Daily]\n, ti.WeeklyAmount AS [Weekly]\n, ifi.RATE2 AS [Book_Rate_Weekly]\n, ti.MonthlyAmount AS [Monthly]\n, ifi.RATE3 AS [Book_Rate_Monthly]\n, CASE WHEN ti.Substatus = 7 THEN 'Substitute' ELSE '' END AS [Is_Substitute]\n, CASE WHEN ti.Substatus = 7 THEN ti.Comments ELSE '' END AS [Substitution_Comments]\n, ITF_OEC.OEC AS [OEC]\n, getdate() last_refresh_date\n, ti.ITEM AS [ItemNum]\n,oec\n,''[Job site zipcode]\nFROM POR.transactions t\nJOIN POR.TransactionItems ti ON ti.CNTR = t.CNTR\nJOIN POR.ItemFile ifi ON ifi.NUM = ti.ITEM\nJOIN POR.ParameterFile pf ON pf.Store = t.[STR]\nJOIN (SELECT t0.CNTR, t0.[DATE] AS OriginalContractDate FROM POR.Transactions t0 \nWHERE RIGHT(t0.CNTR,1) NOT LIKE '[A-Za-z]%') t1\nON t1.CNTR = CASE WHEN RIGHT(t.CNTR,1) LIKE '[A-Za-z]%' THEN LEFT(t.CNTR, LEN(t.CNTR)-1) ELSE t.CNTR END\nLEFT JOIN POR.ItemComments ic ON ic.NUM = ifi.NUM\nLEFT JOIN POR.CustomerFile cf ON cf.CNUM = t.CUSN\nLEFT JOIN POR.CustomerJobSite cjs ON cjs.Number = t.JobSite\nLEFT JOIN POR.Salesman s ON s.Number = t.Salesman\nLEFT JOIN POR.Salesman s2 ON s2.Number = cf.Salesman -- Example CNTR 103071 See GUI. Trans SM is Misha Tufkova, but Customer assigned SM is Daniel Lee\nLEFT JOIN POR.OperatorId o ON o.OPNO = t.OperatorCreated\nLEFT JOIN POR.OperatorId o2 ON o2.OPNO = t.OperatorAssigned -- Exampel CMTR 102919 See GUI.\nLEFT JOIN (SELECT [ItemNumber] ,sum(([QuantityPurchased] - [QuantitySold]) * ([PriceEach] + [ExtraCharges])) AS OEC\nFROM por.[ItemPurchaseDetail]\nWHERE [Disposed] = 0\nGROUP BY [ItemNumber]) AS ITF_OEC ON ifi.[NUM] = ITF_OEC.[ItemNumber]\nWHERE LEFT(t.STAT,1) = 'O'\nAND LEFT(t.CNTR,1) NOT IN ('q','r','s','t')\nAND (ifi.TYPE IN ('T','H','U','V','A','L','R','N','K','D') -- Include Rental types & delivery/pickup charges only; exclude sales, diesel, etc.\nOR ifi.Name LIKE 'Delivery%' --2. Sale items to include\nOR ifi.Name LIKE 'Pickup%' --3. Sale items to include\\\n)\nAND t.STAT NOT IN ('OJ','OH','RR','OR')\nAND ti.TXTY <> 'RR'\nORDER BY [Store_Name], cf.[NAME], t.[DATE] ASC, t.CNTR, s.[Name]",
								"queryTimeout": "02:00:00",
								"partitionOption": "None"
							},
							"sink": {
								"type": "AzureSqlSink",
								"preCopyScript": "truncate table por.POR_Open_Contracts",
								"writeBehavior": "insert",
								"sqlWriterUseTableLock": false,
								"disableMetricsCollection": false
							},
							"enableStaging": false,
							"translator": {
								"type": "TabularTranslator",
								"mappings": [
									{
										"source": {
											"name": "Store Name",
											"type": "String",
											"physicalType": "nvarchar"
										},
										"sink": {
											"name": "Store_Name",
											"type": "String",
											"physicalType": "nvarchar"
										}
									},
									{
										"source": {
											"name": "Store No",
											"type": "String",
											"physicalType": "nvarchar"
										},
										"sink": {
											"name": "Store_No",
											"type": "String",
											"physicalType": "nvarchar"
										}
									},
									{
										"source": {
											"name": "CustomerType",
											"type": "String",
											"physicalType": "varchar"
										},
										"sink": {
											"name": "Customer_Type",
											"type": "String",
											"physicalType": "nvarchar"
										}
									},
									{
										"source": {
											"name": "Customer Number",
											"type": "String",
											"physicalType": "nvarchar"
										},
										"sink": {
											"name": "Customer_Number",
											"type": "String",
											"physicalType": "nvarchar"
										}
									},
									{
										"source": {
											"name": "Customer Name",
											"type": "String",
											"physicalType": "nvarchar"
										},
										"sink": {
											"name": "Customer_Name",
											"type": "String",
											"physicalType": "nvarchar"
										}
									},
									{
										"source": {
											"name": "Job Name",
											"type": "String",
											"physicalType": "nvarchar"
										},
										"sink": {
											"name": "Job_Name",
											"type": "String",
											"physicalType": "nvarchar"
										}
									},
									{
										"source": {
											"name": "Job PO#",
											"type": "String",
											"physicalType": "nvarchar"
										},
										"sink": {
											"name": "Job_PO",
											"type": "String",
											"physicalType": "nvarchar"
										}
									},
									{
										"source": {
											"name": "Job #",
											"type": "String",
											"physicalType": "nvarchar"
										},
										"sink": {
											"name": "Job_ID",
											"type": "String",
											"physicalType": "nvarchar"
										}
									},
									{
										"source": {
											"name": "Job Site Name",
											"type": "String",
											"physicalType": "nvarchar"
										},
										"sink": {
											"name": "Job_Site_Name",
											"type": "String",
											"physicalType": "nvarchar"
										}
									},
									{
										"source": {
											"name": "Job Site Address",
											"type": "String",
											"physicalType": "nvarchar"
										},
										"sink": {
											"name": "Job_Site_Address",
											"type": "String",
											"physicalType": "nvarchar"
										}
									},
									{
										"source": {
											"name": "Extended Protection Plan",
											"type": "Decimal",
											"physicalType": "money",
											"scale": 4,
											"precision": 19
										},
										"sink": {
											"name": "Extended_Protection_Plan",
											"type": "Decimal",
											"physicalType": "money",
											"scale": 4,
											"precision": 19
										}
									},
									{
										"source": {
											"name": "Contract Salesman",
											"type": "String",
											"physicalType": "nvarchar"
										},
										"sink": {
											"name": "Contract_Salesman",
											"type": "String",
											"physicalType": "nvarchar"
										}
									},
									{
										"source": {
											"name": "Customer Salesman",
											"type": "String",
											"physicalType": "nvarchar"
										},
										"sink": {
											"name": "Customer_Salesman",
											"type": "String",
											"physicalType": "nvarchar"
										}
									},
									{
										"source": {
											"name": "Created by Operator Name",
											"type": "String",
											"physicalType": "nvarchar"
										},
										"sink": {
											"name": "Created_By_Operator_Name",
											"type": "String",
											"physicalType": "nvarchar"
										}
									},
									{
										"source": {
											"name": "Assigned to Operator Name",
											"type": "String",
											"physicalType": "nvarchar"
										},
										"sink": {
											"name": "Assigned_To_Operator_Name",
											"type": "String",
											"physicalType": "nvarchar"
										}
									},
									{
										"source": {
											"name": "Contract Date",
											"type": "DateTime",
											"physicalType": "datetime"
										},
										"sink": {
											"name": "Contract_Date",
											"type": "DateTime",
											"physicalType": "datetime"
										}
									},
									{
										"source": {
											"name": "Original Contract Date",
											"type": "DateTime",
											"physicalType": "datetime"
										},
										"sink": {
											"name": "Original_Contract_Date",
											"type": "DateTime",
											"physicalType": "datetime"
										}
									},
									{
										"source": {
											"name": "Contract No",
											"type": "String",
											"physicalType": "nvarchar"
										},
										"sink": {
											"name": "Contract_No",
											"type": "String",
											"physicalType": "nvarchar"
										}
									},
									{
										"source": {
											"name": "Item Status",
											"type": "String",
											"physicalType": "varchar"
										},
										"sink": {
											"name": "Item_Status",
											"type": "String",
											"physicalType": "nvarchar"
										}
									},
									{
										"source": {
											"name": "Header",
											"type": "String",
											"physicalType": "nvarchar"
										},
										"sink": {
											"name": "Header",
											"type": "String",
											"physicalType": "nvarchar"
										}
									},
									{
										"source": {
											"name": "Key",
											"type": "String",
											"physicalType": "nvarchar"
										},
										"sink": {
											"name": "Key",
											"type": "String",
											"physicalType": "nvarchar"
										}
									},
									{
										"source": {
											"name": "Name",
											"type": "String",
											"physicalType": "nvarchar"
										},
										"sink": {
											"name": "Name",
											"type": "String",
											"physicalType": "nvarchar"
										}
									},
									{
										"source": {
											"name": "Serial Number",
											"type": "String",
											"physicalType": "nvarchar"
										},
										"sink": {
											"name": "Serial_Number",
											"type": "String",
											"physicalType": "nvarchar"
										}
									},
									{
										"source": {
											"name": "Make",
											"type": "String",
											"physicalType": "nvarchar"
										},
										"sink": {
											"name": "Make",
											"type": "String",
											"physicalType": "nvarchar"
										}
									},
									{
										"source": {
											"name": "Model",
											"type": "String",
											"physicalType": "nvarchar"
										},
										"sink": {
											"name": "Model",
											"type": "String",
											"physicalType": "nvarchar"
										}
									},
									{
										"source": {
											"name": "Model Year",
											"type": "String",
											"physicalType": "nvarchar"
										},
										"sink": {
											"name": "Model_Year",
											"type": "String",
											"physicalType": "nvarchar"
										}
									},
									{
										"source": {
											"name": "Amount Charged",
											"type": "Decimal",
											"physicalType": "money",
											"scale": 4,
											"precision": 19
										},
										"sink": {
											"name": "Amount_Charged",
											"type": "Decimal",
											"physicalType": "money",
											"scale": 4,
											"precision": 19
										}
									},
									{
										"source": {
											"name": "Daily",
											"type": "Decimal",
											"physicalType": "money",
											"scale": 4,
											"precision": 19
										},
										"sink": {
											"name": "Daily",
											"type": "Decimal",
											"physicalType": "money",
											"scale": 4,
											"precision": 19
										}
									},
									{
										"source": {
											"name": "Book Rate Daily",
											"type": "Decimal",
											"physicalType": "money",
											"scale": 4,
											"precision": 19
										},
										"sink": {
											"name": "Book_Rate_Daily",
											"type": "Decimal",
											"physicalType": "money",
											"scale": 4,
											"precision": 19
										}
									},
									{
										"source": {
											"name": "Weekly",
											"type": "Decimal",
											"physicalType": "money",
											"scale": 4,
											"precision": 19
										},
										"sink": {
											"name": "Weekly",
											"type": "Decimal",
											"physicalType": "money",
											"scale": 4,
											"precision": 19
										}
									},
									{
										"source": {
											"name": "Book Rate Weekly",
											"type": "Decimal",
											"physicalType": "money",
											"scale": 4,
											"precision": 19
										},
										"sink": {
											"name": "Book_Rate_Weekly",
											"type": "Decimal",
											"physicalType": "money",
											"scale": 4,
											"precision": 19
										}
									},
									{
										"source": {
											"name": "Monthly",
											"type": "Decimal",
											"physicalType": "money",
											"scale": 4,
											"precision": 19
										},
										"sink": {
											"name": "Monthly",
											"type": "Decimal",
											"physicalType": "money",
											"scale": 4,
											"precision": 19
										}
									},
									{
										"source": {
											"name": "Book Rate Monthly",
											"type": "Decimal",
											"physicalType": "money",
											"scale": 4,
											"precision": 19
										},
										"sink": {
											"name": "Book_Rate_Monthly",
											"type": "Decimal",
											"physicalType": "money",
											"scale": 4,
											"precision": 19
										}
									},
									{
										"source": {
											"name": "Is Substitute",
											"type": "String",
											"physicalType": "varchar"
										},
										"sink": {
											"name": "Is_Substitute",
											"type": "String",
											"physicalType": "nvarchar"
										}
									},
									{
										"source": {
											"name": "Substitution Comments",
											"type": "String",
											"physicalType": "nvarchar"
										},
										"sink": {
											"name": "Substitution_Comments",
											"type": "String",
											"physicalType": "nvarchar"
										}
									},
									{
										"source": {
											"name": "last_refresh_date",
											"type": "DateTime",
											"physicalType": "datetime"
										},
										"sink": {
											"name": "last_refresh_date",
											"type": "DateTime",
											"physicalType": "date"
										}
									}
								],
								"typeConversion": true,
								"typeConversionSettings": {
									"allowDataTruncation": true,
									"treatBooleanAsNumber": false
								}
							}
						},
						"inputs": [
							{
								"referenceName": "Briggs_MDW",
								"type": "DatasetReference",
								"parameters": {
									"schema_name": "dbo",
									"table_name": "user"
								}
							}
						],
						"outputs": [
							{
								"referenceName": "Briggs_MDW",
								"type": "DatasetReference",
								"parameters": {
									"schema_name": "POR",
									"table_name": "POR_Open_Contracts"
								}
							}
						]
					},
					{
						"name": "Inventory",
						"type": "Copy",
						"dependsOn": [
							{
								"activity": "POR_Open_Contract",
								"dependencyConditions": [
									"Succeeded"
								]
							}
						],
						"policy": {
							"timeout": "7.00:00:00",
							"retry": 0,
							"retryIntervalInSeconds": 30,
							"secureOutput": false,
							"secureInput": false
						},
						"userProperties": [],
						"typeProperties": {
							"source": {
								"type": "SqlServerSource",
								"sqlReaderQuery": "/*\nDATA PULL_Inventory_v13\nLast edit:  2022 March 18\n*/\n\n--Temp table (1/1)\tHave system generate unique dates\n--IF OBJECT_ID('tempdb..#DateRange') IS NOT NULL \n--   DROP TABLE #DateRange;  \n\n--CREATE TABLE #DateRange (UniqueDate DATE PRIMARY KEY)\n--INSERT INTO #DateRange\nwith DateRange_cte As\n(\n\tSELECT TOP (10592) DATEADD(DAY,ROW_NUMBER() OVER (ORDER BY (SELECT 1)), '20201231') AS UniqueDate\n\tFROM POR.spt_values v1, POR.spt_values v2\n)\n\n--CTEs:  amalgamate details and summary for scripted/automatic aggregation as needed\n--CTE (1/5)\t\tRepair info:  details and aggregates\n, repairs_cte AS\t\t--alias:  rc\n(\nSELECT\n  ti0.ITEM\n, summary.MaintenanceType\n, summary.TotalLaborHours\n, CAST(summary.LaborCost/NULLIF(summary.NumAssets,0) AS DECIMAL(18,2)) AS LaborCost\n, CAST(summary.ServicePartsCost/NULLIF(summary.NumAssets,0) AS DECIMAL(18,2)) AS ServicePartsCost\n, summary.OutDate\n, summary.CompletedDate\n, summary.CNTR\n, summary.DaysDown\nFROM POR.TransactionItems ti0\nJOIN POR.ItemFile ifi0 ON ifi0.NUM = ti0.ITEM\nJOIN (\n\tSELECT\n\t  details.CNTR\n\t, details.MaintenanceType\n\t, SUM(case when details.Asset = 1 then 1 else 0 end) AS NumAssets\n\t, SUM(details.LaborHours) AS TotalLaborHours\n\t, SUM(case when details.Name LIKE 'labor' then details.Pric else 0 end) AS LaborCost\n\t, SUM(case when details.Name NOT LIKE 'labor' then details.Pric else 0 end) AS ServicePartsCost\n\t, MIN(details.OutDate) AS OutDate\n\t, MAX(details.CompletedDate) AS CompletedDate\n\t, DATEDIFF(d,details.OutDate,case when details.CompletedDate IS NULL then GETDATE() else details.CompletedDate end) AS DaysDown\n\tFROM (\n\t\tSELECT t.CNTR, ti.Sort, ifi.Asset, ifi.Name, ifi.NUM, case when ifi.Name LIKE '%labor%' then ti.QTY else 0 end AS LaborHours, ti.PRIC\n\t\t, CASE WHEN CF.[KEY] LIKE 'REPAIRS-MAINT%' THEN 'IMO'\n\t\t\tWHEN CF.[KEY] NOT LIKE 'REPAIRS-MAINT%' THEN 'IRO'\n\t\t\tEND AS [MaintenanceType]\n\t\t, CF.[KEY]\n\t\t, CAST(t.[DATE] AS DATE) AS OutDate\n\t\t, CAST(t.Completed AS DATE) AS CompletedDate\n\t\tFROM POR.Transactions t\n\t\tJOIN POR.TransactionItems ti ON ti.CNTR = t.CNTR\n\t\tJOIN POR.ItemFile ifi ON ifi.NUM = ti.ITEM\n\t\tJOIN POR.CustomerFile CF ON T.CUSN = CF.CNUM\n\t\tWHERE LEFT(t.CNTR,1) = 'r'\n\t\tAND LEFT(ti.Sort,4) <> 'zzzz'\n\t\tAND RIGHT(ifi.[KEY],2) <> 'RR'\n\t) details\n\tGROUP BY\n\t  details.CNTR\n\t, details.MaintenanceType\n\t, DATEDIFF(d,details.OutDate,case when details.CompletedDate IS NULL then GETDATE() else details.CompletedDate end)\n) summary ON summary.CNTR = ti0.CNTR\nWHERE ifi0.Asset = 1\n)\n\n--CTE (2/5)\t\tRepair info:  Days since item was last down\n, lastCompletedDate_cte AS\t\t--alias:  lcd\n(\nSELECT ITEM, repairs_cte.MaintenanceType, repairs_cte.CompletedDate AS LastCompletedDate\n\t, ROW_NUMBER() OVER(PARTITION BY repairs_cte.ITEM ORDER BY (CASE WHEN repairs_cte.CompletedDate IS NULL THEN GETDATE() ELSE repairs_cte.CompletedDate END) DESC) AS [RowNumber]\nFROM repairs_cte\n)\n\n--CTE (3/5)\t\tRepair days:  Use unique days\n, repairDays_cte AS\t\t--alias:  rd\n(\n\tSELECT\n\t  a.ITEM\n\t, COUNT(DISTINCT CASE WHEN a.UniqueDate >= '2021-12-01' AND a.MaintenanceType = 'IMO' THEN a.UniqueDate ELSE NULL END) AS TotalDaysIMO\n\t, COUNT(DISTINCT CASE WHEN a.UniqueDate >= '2021-12-01' AND a.MaintenanceType = 'IRO' THEN a.UniqueDate ELSE NULL END) AS TotalDaysIRO\n\t, COUNT(DISTINCT CASE WHEN a.UniqueDate >= '2021-12-01' THEN a.UniqueDate ELSE NULL END) AS TotalDaysRepair\n\tFROM (\n\t\tSELECT\n\t\tti3.ITEM\n\t\t, CASE WHEN CF3.[KEY] LIKE 'REPAIRS-MAINT%' THEN 'IMO'\n\t\t\tWHEN CF3.[KEY] NOT LIKE 'REPAIRS-MAINT%' THEN 'IRO'\n\t\t\tEND AS [MaintenanceType]\n\t\t, dr3.UniqueDate\n\t\tFROM POR.Transactions t3\n\t\tJOIN POR.TransactionItems ti3 ON ti3.CNTR = t3.CNTR\n\t\tJOIN POR.ItemFile ifi3 ON ifi3.NUM = ti3.ITEM\n\t\tJOIN POR.CustomerFile CF3 ON T3.CUSN = CF3.CNUM\n\t\tJOIN DateRange_cte dr3 ON dr3.UniqueDate BETWEEN CAST(t3.[DATE] AS DATE) AND CAST(CASE WHEN t3.Completed IS NULL THEN GETDATE() ELSE CAST(t3.Completed AS DATE) END AS DATE)\n\t\tWHERE LEFT(t3.CNTR,1) = 'r'\n\t\tAND LEFT(ti3.Sort,4) <> 'zzzz'\n\t\tAND RIGHT(ifi3.[KEY],2) <> 'RR'\n\t\tGROUP BY\n\t\tti3.ITEM\n\t\t, CASE WHEN CF3.[KEY] LIKE 'REPAIRS-MAINT%' THEN 'IMO'\n\t\t\tWHEN CF3.[KEY] NOT LIKE 'REPAIRS-MAINT%' THEN 'IRO'\n\t\t\tEND\n\t\t, dr3.UniqueDate\n\t) a\n\tGROUP BY\n\t  a.ITEM\n)\n\n--CTE (4/5)\t\tContract info:  Aggregates by ITEM\n, contractRev_cte AS\t--alias:  cr\n(\nSELECT \n  c.ITEM\n, SUM(c.TotalContractRevenue) AS TotalRentalRevenue\n, SUM(c.[30d_ContractRevenue]) AS [30d_TotalRentalRevenue]\n, SUM(c.[60d_ContractRevenue]) AS [60d_TotalRentalRevenue]\n, SUM(c.[90d_ContractRevenue]) AS [90d_TotalRentalRevenue]\n, SUM(c.[180d_ContractRevenue]) AS [180d_TotalRentalRevenue]\n, SUM(c.[R12d_ContractRevenue]) AS [R12d_TotalRentalRevenue]\n, SUM(c.[YTD_ContractRevenue]) AS [YTD_TotalRentalRevenue]\n, CAST(MAX(c.MaxContractStartDate) AS DATE) AS [LastItemContractStartDate]\n, CAST(MAX(c.MaxContractDate) AS DATE) AS [LastItemContractDate]\n, CAST(MAX(c.MaxCurrentDate) AS DATE) AS [LastItemContractDate_current]\nFROM (\n\tSELECT\n\t  LEFT(b.CNTR,6) AS CNTR\n\t, b.ITEM\n\t, SUM(b.PRIC) AS TotalContractRevenue\n\t, SUM(CASE WHEN b.ARdays  = 30 THEN b.PRIC ELSE 0 END) AS [30d_ContractRevenue]\n\t, SUM(CASE WHEN b.ARdays <= 60 THEN b.PRIC ELSE 0 END) AS [60d_ContractRevenue]\n\t, SUM(CASE WHEN b.ARdays <= 90 THEN b.PRIC ELSE 0 END) AS [90d_ContractRevenue]\n\t, SUM(CASE WHEN b.ARdays <= 180 THEN b.PRIC ELSE 0 END) AS [180d_ContractRevenue]\n\t, SUM(CASE WHEN b.ARdays <= 365 THEN b.PRIC ELSE 0 END) AS [R12d_ContractRevenue]\n\t--SUM(IIF(YEAR(b.DATE) = YEAR(GETDATE()),b.PRIC,0)) AS [YTD_ContractRevenue]\n\t, SUM(case when YEAR(b.DATE) = YEAR(GETDATE()) then b.PRIC else 0 end) AS [YTD_ContractRevenue]\n\t, MAX(b.DATE) AS MaxContractStartDate\n\t, MAX(b.MaxActualContractDate) AS MaxContractDate\n\t, MAX(b.MaxCurrentContractDate) AS MaxCurrentDate\n\tFROM (\n\t\tSELECT\n\t\t  ti0.CNTR\n\t\t, ti0.ITEM\n\t\t, ti0.PRIC\n\t\t, CASE WHEN DATEDIFF(d,t0.[DATE],GETDATE()) <= 30 THEN 30\n\t\t\tWHEN DATEDIFF(d,t0.[DATE],GETDATE()) > 30 AND DATEDIFF(d,t0.[DATE],GETDATE()) <= 60 THEN 60\n\t\t\tWHEN DATEDIFF(d,t0.[DATE],GETDATE()) > 60 AND DATEDIFF(d,t0.[DATE],GETDATE()) <= 90 THEN 90\n\t\t\tWHEN DATEDIFF(d,t0.[DATE],GETDATE()) > 90 AND DATEDIFF(d,t0.[DATE],GETDATE()) <= 180 THEN 180\n\t\t\tWHEN DATEDIFF(d,t0.[DATE],GETDATE()) > 180 AND DATEDIFF(d,t0.[DATE],GETDATE()) <= 365 THEN 365\n\t\t\tELSE 9999 END AS ARdays\n\t\t, t0.[DATE]\n\t\t, a.MaxActualContractDate\n\t\t, a.MaxCurrentContractDate\n\t\tFROM POR.Transactions t0\n\t\tJOIN POR.TransactionItems ti0 ON ti0.CNTR = t0.CNTR\n\t\tJOIN POR.ItemFile ifi0 ON ifi0.NUM = ti0.ITEM\n\t\tJOIN POR.ItemType it0 ON it0.[Type] = ifi0.[TYPE]\n\t\tJOIN (\n\t\t\t\tSELECT LEFT(ti1.CNTR,6) AS CNTRgroup, ti1.ITEM\n\t\t\t\t, MIN(t1.[DATE]) AS MinContractDate\n\t\t\t\t, MAX(CASE WHEN ti1.TXTY IN ('RR','RX') THEN ti1.DDT ELSE t1.CLDT END) AS MaxActualContractDate\t\t--basing on picked up date because they are partitioning at the item level\n\t\t\t\t, MAX(CASE WHEN t1.CLDT IS NULL THEN '3333-12-31' WHEN ti1.TXTY IN ('RR','RX') THEN ti1.DDT ELSE t1.CLDT END) AS MaxCurrentContractDate\n\t\t\t\tFROM POR.Transactions t1\n\t\t\t\tJOIN POR.TransactionItems ti1 ON ti1.CNTR = t1.CNTR\n\t\t\t\tJOIN POR.ItemFile ifi1 ON ifi1.NUM = ti1.ITEM\n\t\t\t\tWHERE ((ifi1.UserDefined1 <> '' AND t1.[DATE] >= '2021-12-01') OR ifi1.UserDefined1 = '')\n\t\t\t\tAND t1.[DATE] <= GETDATE()\n\t\t\t\tGROUP BY LEFT(ti1.CNTR,6), ti1.ITEM\n\t\t) a ON a.CNTRgroup = LEFT(ti0.CNTR,6) AND a.ITEM = ifi0.NUM\n\t\tWHERE LEFT(t0.CNTR,1) NOT IN ('q','r','s','t','w','c') \n\t\tAND LEFT(it0.TypeDescrip,6) = 'Rental'\n\t\tAND RIGHT(ifi0.[KEY],2) <> 'RR'\n\t\tAND ((ifi0.UserDefined1 <> '' AND t0.[DATE] >= '2021-12-01') OR ifi0.UserDefined1 = '')\n\t\tAND t0.[DATE] <= GETDATE()\n\t) b\n\tGROUP BY\n\t  LEFT(b.CNTR,6)\n\t, b.ITEM\n) c\nGROUP BY\n  c.ITEM\n)\n\n--CTE (5/5)\t\tTimeUt by Item info:  uses temp table at beginning of query\n, timeUt_cte AS (\t--alias:  tu\nSELECT\n  a.ITEM\n--, SUM(IIF(a.UniqueDate >= CAST(IIF(DATEADD(DAY,-30,GETDATE()) < '2021-12-01', '2021-12-01',DATEADD(DAY,-30,GETDATE()+1)) AS DATE), 1, 0)) AS [30dDistinct_OnRent]\n,SUM(case when a.UniqueDate >= CAST(case when DATEADD(DAY,-30,GETDATE()) < '2021-12-01' then '2021-12-01'else DATEADD(DAY,-30,GETDATE()+1)end AS DATE) then 1 else 0 end) AS [30dDistinct_OnRent]\n--, SUM(IIF(a.UniqueDate >= CAST(IIF(DATEADD(DAY,-90,GETDATE()) < '2021-12-01', '2021-12-01',DATEADD(DAY,-90,GETDATE()+1)) AS DATE), 1, 0)) AS [90dDistinct_OnRent]\n,SUM(case when a.UniqueDate >= CAST(case when DATEADD(DAY,-90,GETDATE()) < '2021-12-01' then '2021-12-01' else DATEADD(DAY,-90,GETDATE()+1) end AS DATE) then 1 else 0 end) AS [90dDistinct_OnRent]\n--, SUM(IIF(a.UniqueDate >= CAST(IIF(DATEADD(DAY,-180,GETDATE()) < '2021-12-01', '2021-12-01',DATEADD(DAY,-180,GETDATE()+1)) AS DATE), 1, 0)) AS [180dDistinct_OnRent]\n,SUM(case when a.UniqueDate >= CAST(case when DATEADD(DAY,-180,GETDATE()) < '2021-12-01' then '2021-12-01' else DATEADD(DAY,-180,GETDATE()+1) end AS DATE) then 1 else 0 end) AS [180dDistinct_OnRent]\n--, SUM(IIF(a.UniqueDate >= CAST(IIF(DATEADD(DAY,-365,GETDATE()) < '2021-12-01', '2021-12-01',DATEADD(DAY,-365,GETDATE()+1)) AS DATE), 1, 0)) AS [R12dDistinct_OnRent]\n,SUM(case when a.UniqueDate >= CAST(case when DATEADD(DAY,-365,GETDATE()) < '2021-12-01' then '2021-12-01' else DATEADD(DAY,-365,GETDATE()+1) end AS DATE) then 1 else 0 end) AS [R12dDistinct_OnRent]\n--, SUM(IIF(a.UniqueDate >= DATEADD(yy, DATEDIFF(yy, 0, GETDATE()), 0), 1, 0)) AS [YTDdistinct_OnRent]\n,SUM(case when a.UniqueDate >= DATEADD(yy, DATEDIFF(yy, 0, GETDATE()), 0) then 1 else 0 end) AS [YTDdistinct_OnRent]\n--, SUM(IIF(a.UniqueDate >= '2021-12-01', 1, 0)) AS [TotalDistinct_UT]\n, SUM(case when a.UniqueDate >= '2021-12-01' then 1 else 0 end) AS [TotalDistinct_UT]\nFROM (\n\tSELECT ti2.ITEM, dr.UniqueDate\n\tFROM POR.Transactions t2\n\tJOIN POR.TransactionItems ti2 ON ti2.CNTR = t2.CNTR\n\tJOIN POR.ItemFile ifi2 ON ifi2.NUM = ti2.ITEM\n\tJOIN POR.ItemPurchaseDetail ipd2 ON ipd2.ItemNumber = ifi2.NUM\n\tJOIN DateRange_cte dr ON dr.UniqueDate BETWEEN CAST(t2.[DATE] AS DATE) AND CAST(CASE WHEN t2.CLDT IS NULL THEN GETDATE() ELSE ti2.DDT END AS DATE)\n\tWHERE LEFT(t2.CNTR,1) NOT IN ('q','r','s','t','w','c')\n\tAND ifi2.SerialNumber <> ''\n\tAND t2.DATE < CAST(GETDATE() AS DATE)\n\tAND dr.UniqueDate <= GETDATE()\n\tAND dr.UniqueDate >= ipd2.PurchaseDate\n\tGROUP BY ti2.ITEM, dr.UniqueDate\n) a\nGROUP BY a.ITEM\n)\n\n--MAIN QUERY:\n--Expected approximation:  3.1k results\nSELECT\nifi.[KEY], ifi.[Name], ifi.MODN AS Model, ifi.SerialNumber AS [Serial_Number], ifi.ModelYear AS [Model_Year]\n, DATEDIFF(m,ipd.PurchaseDate,GETDATE()) AS [Age_In_Months]\n, CAST(ipd.PurchaseDate AS DATE) AS [Original_DOP], ipd.PurchasePrice AS [OEC], ifi.CURV AS NBV, ifi.DEPA AS [Accum_Depr]\n, ifi.PURP AS [Acquisition_Cost], ipd.PONumber AS [PO_Number], ipd.ExtraCost AS [Extra_Cost], ifi.CurrentStore AS [Current_Store]\n, CASE WHEN pf.Store <> '001' THEN RIGHT(pf.STORE_NAME, LEN(pf.STORE_NAME) - 4) ELSE pf.STORE_NAME END AS [Store_Name]\n, ic.[Name] AS Category, ifi.Header, it.TypeDescrip AS [Type], ifi.MTOT AS [Hours], ifi.MANF AS Make, ifi.UserDefined1 AS [Legacy_ID]\n\n--Time utilization\n, CASE WHEN LEFT(it.TypeDescrip,6) = 'Rental' THEN CAST(MAX(ISNULL(CAST(CAST(tu.[30dDistinct_OnRent] AS DECIMAL(18,2))/30.00 *100 AS DECIMAL(18,2)),0)) AS VARCHAR(20)) + '%' ELSE NULL END AS [30d_TU]\n, CASE WHEN LEFT(it.TypeDescrip,6) = 'Rental' THEN CAST(MAX(ISNULL(CAST(CAST(tu.[90dDistinct_OnRent] AS DECIMAL(18,2))/90.00 *100 AS DECIMAL(18,2)),0)) AS VARCHAR(20)) + '%' ELSE NULL END AS [90d_TU]\n, CASE WHEN LEFT(it.TypeDescrip,6) = 'Rental' THEN CAST(MAX(ISNULL(CAST(CAST(tu.[180dDistinct_OnRent] AS DECIMAL(18,2))/180.00 *100 AS DECIMAL(18,2)),0)) AS VARCHAR(20)) + '%' ELSE NULL END AS [180d_TU]\n, CASE WHEN LEFT(it.TypeDescrip,6) = 'Rental' THEN CAST(MAX(ISNULL(CAST(CAST(tu.[R12dDistinct_OnRent] AS DECIMAL(18,2))/365.00 *100 AS DECIMAL(18,2)),0)) AS VARCHAR(20)) + '%' ELSE NULL END AS [R12_TU]\n, CASE WHEN LEFT(it.TypeDescrip,6) = 'Rental' THEN CAST(MAX(ISNULL(CAST(CAST(tu.[YTDdistinct_OnRent] AS DECIMAL(18,2))/(DATEDIFF(d,DATEADD(yy, DATEDIFF(yy, 0, GETDATE()), 0),GETDATE()+1)) *100 AS DECIMAL(18,2)),0)) AS VARCHAR(20)) + '%' ELSE NULL END AS [YTD_TU]\n\n--Dollar utilization\n, CASE WHEN LEFT(it.TypeDescrip,6) = 'Rental' THEN CAST(ISNULL((SUM(cr.[30d_TotalRentalRevenue]/NULLIF(ipd.PurchasePrice,0))*12) *100,0) AS VARCHAR(20)) + '%' ELSE NULL END AS [30d_$Ut%]\n, CASE WHEN LEFT(it.TypeDescrip,6) = 'Rental' THEN CAST(ISNULL((SUM(cr.[90d_TotalRentalRevenue]/NULLIF(ipd.PurchasePrice,0))*4) *100,0) AS VARCHAR(20)) + '%' ELSE NULL END AS [90d_$Ut%]\n, CASE WHEN LEFT(it.TypeDescrip,6) = 'Rental' THEN CAST(ISNULL((SUM(cr.[180d_TotalRentalRevenue]/NULLIF(ipd.PurchasePrice,0))*2) *100,0) AS VARCHAR(20)) + '%' ELSE NULL END AS [180d_$Ut%]\n, CASE WHEN LEFT(it.TypeDescrip,6) = 'Rental' THEN CAST(ISNULL((SUM(cr.[R12d_TotalRentalRevenue]/NULLIF(ipd.PurchasePrice,0))) *100,0) AS VARCHAR(20)) + '%' ELSE NULL END AS [R12_$Ut%]\n, CASE WHEN LEFT(it.TypeDescrip,6) = 'Rental' THEN CAST(ISNULL((SUM(cr.[YTD_TotalRentalRevenue]/NULLIF(ipd.PurchasePrice,0))*(365/DATEDIFF(d,DATEADD(yy, DATEDIFF(yy, 0, GETDATE()), 0),GETDATE()))) *100,0) AS VARCHAR(20)) + '%' ELSE NULL END AS [YTD_$Ut%]\n, CASE WHEN LEFT(it.TypeDescrip,6) = 'Rental' THEN ISNULL(cr.TotalRentalRevenue,0) ELSE NULL END AS [LTD_Revenue]\n--, CASE WHEN LEFT(it.TypeDescrip,6) = 'Rental' THEN CAST(ISNULL(CAST(CAST(tu.[TotalDistinct_UT] AS DECIMAL(18,2)) / NULLIF(DATEDIFF(d,IIF(ifi.UserDefined1 <> '','2021-12-01',CAST(ipd.PurchaseDate AS DATE)),CAST(GETDATE()+1 AS DATE)),0)*100 AS DECIMAL(18,2)),0) AS VARCHAR(10)) + '%' ELSE NULL END AS [SP%_LTDTU]\n, CASE WHEN LEFT(it.TypeDescrip,6) = 'Rental' THEN CAST(ISNULL(CAST(CAST(tu.[TotalDistinct_UT] AS DECIMAL(18,2)) / NULLIF(DATEDIFF(d,case when ifi.UserDefined1 <> '' then '2021-12-01' else CAST(ipd.PurchaseDate AS DATE)end ,CAST(GETDATE()+1 AS DATE)),0)*100 AS DECIMAL(18,2)),0) AS VARCHAR(10)) + '%' ELSE NULL END AS [SP%_LTDTU]\n--, CASE WHEN LEFT(it.TypeDescrip,6) = 'Rental' THEN ISNULL(CAST(MAX(CAST(CAST(rd.TotalDaysRepair AS DECIMAL(18,2)) / NULLIF(DATEDIFF(d,IIF(ifi.UserDefined1 <> '','2021-12-01',CAST(ipd.PurchaseDate AS DATE)),GETDATE()+1),0)*100 AS DECIMAL(18,2))) AS VARCHAR(10)),0) + '%' ELSE NULL END AS [SP%_Life_Down]\n, CASE WHEN LEFT(it.TypeDescrip,6) = 'Rental' THEN ISNULL(CAST(MAX(CAST(CAST(rd.TotalDaysRepair AS DECIMAL(18,2)) / NULLIF(DATEDIFF(d,case when ifi.UserDefined1 <> '' then '2021-12-01' else CAST(ipd.PurchaseDate AS DATE)end ,GETDATE()+1),0)*100 AS DECIMAL(18,2))) AS VARCHAR(10)),0) + '%' ELSE NULL END AS [SP%_Life_Down]\n--, IIF((cr.LastItemContractDate_current = '3333-12-31' OR GETDATE() BETWEEN cr.LastItemContractStartDate AND cr.LastItemContractDate_current),'On rent', CAST(DATEDIFF(d,cr.LastItemContractDate,GETDATE())AS VARCHAR(20)) ) AS [Last_Rent_In_Days]\n, case when (cr.LastItemContractDate_current = '3333-12-31' OR GETDATE() BETWEEN cr.LastItemContractStartDate AND cr.LastItemContractDate_current) then 'On rent' else CAST(DATEDIFF(d,cr.LastItemContractDate,GETDATE())AS VARCHAR(20)) end AS [Last_Rent_In_Days]\n\n--Maintenance/Repair\n--, SUM(IIF(rc.ITEM IS NOT NULL,ISNULL(rc.TotalLaborHours,0),NULL)) AS [Total_Labor_Hours]\n, SUM(case when rc.ITEM IS NOT NULL then ISNULL(rc.TotalLaborHours,0) else NULL end ) AS [Total_Labor_Hours]\n, SUM(rc.LaborCost) AS [Total_Labor_Cost]\n, CASE WHEN rc.ITEM IS NOT NULL AND lcd.RowNumber = 1 AND lcd.LastCompletedDate IS NOT NULL THEN CAST(DATEDIFF(d, lcd.LastCompletedDate,GETDATE()) AS VARCHAR(20))\n\tWHEN rc.ITEM IS NOT NULL AND lcd.LastCompletedDate IS NULL THEN CAST('Down' AS VARCHAR(5))\n\tELSE NULL END AS [Days_Since_Last_Down]\n, lcd.MaintenanceType AS [Last_Down_Type]\n--, SUM(IIF(rc.ITEM IS NOT NULL,IIF(rc.MaintenanceType = 'IRO',1,0),NULL)) AS [IRO_Totals]\n, SUM(case when rc.ITEM IS NOT NULL then case when rc.MaintenanceType = 'IRO' then 1 else 0 end else NULL end) AS [IRO_Totals]\n, rd.TotalDaysIRO AS [IRO_Days_Down]\n--, SUM(IIF(rc.ITEM IS NOT NULL,IIF(rc.MaintenanceType = 'IRO',rc.LaborCost + rc.ServicePartsCost,0),NULL)) AS [IRO_Labor_Parts_Cost]\n, SUM(case when rc.ITEM IS NOT NULL then case when rc.MaintenanceType = 'IRO' then rc.LaborCost + rc.ServicePartsCost else 0 end else NULL end) AS [IRO_Labor_Parts_Cost]\n--, SUM(IIF(rc.ITEM IS NOT NULL,IIF(rc.MaintenanceType = 'IMO',1,0),NULL)) AS [IMO_Totals]\n, SUM(case when rc.ITEM IS NOT NULL then case when rc.MaintenanceType = 'IMO' then 1 else 0 end else NULL end) AS [IMO_Totals] \n, rd.TotalDaysIMO AS [IMO_Days_Down]\n--, SUM(IIF(rc.ITEM IS NOT NULL,IIF(rc.MaintenanceType = 'IMO',rc.LaborCost + rc.ServicePartsCost,0),NULL)) AS [IMO_Labor_PartsCost]\n, SUM(case when rc.ITEM IS NOT NULL then case when rc.MaintenanceType = 'IMO' then rc.LaborCost + rc.ServicePartsCost else 0 end else NULL end) AS [IMO_Labor_PartsCost]\n, GETDATE() [last_refresh_date]\nFROM POR.ItemFile ifi\nLEFT JOIN POR.ItemCategory ic ON ic.Category = ifi.Category\nJOIN POR.ItemType it ON it.[Type] = ifi.[TYPE]\nJOIN (SELECT\n\t\tipd0.ItemNumber, CASE WHEN ipd0.PONumber = 0 THEN NULL ELSE ipd0.PONumber END AS PONumber, ipd0.PurchaseDate, ipd0.PriceEach AS PurchasePrice, ipd0.ExtraCharges AS ExtraCost\n\t\t, ROW_NUMBER() OVER(PARTITION BY ipd0.ItemNumber ORDER BY ipd0.PurchaseDate) AS [RowNumber]\n\t\tFROM POR.ItemPurchaseDetail ipd0\n\t\tWHERE ipd0.QuantityPurchased > 0\n\t) ipd ON ipd.ItemNumber = ifi.NUM\nLEFT JOIN POR.ParameterFile pf ON pf.Store = ifi.CurrentStore\nLEFT JOIN repairs_cte rc ON rc.ITEM = ifi.NUM\nLEFT JOIN lastCompletedDate_cte lcd ON lcd.ITEM = ifi.NUM AND lcd.RowNumber = 1\nLEFT JOIN contractRev_cte cr ON cr.ITEM = ifi.NUM\nLEFT JOIN timeUt_cte tu ON tu.ITEM = ifi.NUM\nLEFT JOIN repairDays_cte rd ON rd.ITEM = ifi.NUM\n\nWHERE ifi.SerialNumber <> ''\nAND ifi.QTY > 0\nAND ipd.RowNumber = 1\nAND RIGHT(ifi.[KEY],2) <> 'RR'\n\nGROUP BY\n  ifi.[KEY], ifi.NUM, ifi.[Name], ifi.MODN , ifi.SerialNumber, ifi.ModelYear, ipd.PurchaseDate, ipd.PONumber, ipd.PurchasePrice, ipd.ExtraCost, ifi.CurrentStore\n  , CASE WHEN pf.Store <> '001' THEN RIGHT(pf.STORE_NAME, LEN(pf.STORE_NAME) - 4) ELSE pf.STORE_NAME END  \n  , ic.[Name], ifi.Header, it.TypeDescrip, ifi.MTOT, ifi.MANF, ifi.CURV, ifi.DEPA, ifi.PURP, ifi.UserDefined1\n, CASE WHEN rc.ITEM IS NOT NULL AND lcd.RowNumber = 1 AND lcd.LastCompletedDate IS NOT NULL THEN CAST(DATEDIFF(d, lcd.LastCompletedDate,GETDATE()) AS VARCHAR(20))\n\tWHEN rc.ITEM IS NOT NULL AND lcd.LastCompletedDate IS NULL THEN CAST('Down' AS VARCHAR(5))\n\tELSE NULL END, lcd.MaintenanceType\n, cr.TotalRentalRevenue\n, tu.[TotalDistinct_UT]\n--, IIF((cr.LastItemContractDate_current = '3333-12-31' OR GETDATE() BETWEEN cr.LastItemContractStartDate AND cr.LastItemContractDate_current),'On rent', CAST(DATEDIFF(d,cr.LastItemContractDate,GETDATE())AS VARCHAR(20)) )\n, case when (cr.LastItemContractDate_current = '3333-12-31' OR GETDATE() BETWEEN cr.LastItemContractStartDate AND cr.LastItemContractDate_current) then 'On rent' else CAST(DATEDIFF(d,cr.LastItemContractDate,GETDATE())AS VARCHAR(20)) end \n, rd.TotalDaysIRO, rd.TotalDaysIMO\n\nORDER BY RTRIM(LTRIM(ifi.Num))\n\n--DROP TABLE #DateRange",
								"queryTimeout": "02:00:00",
								"partitionOption": "None"
							},
							"sink": {
								"type": "AzureSqlSink",
								"preCopyScript": "truncate table por.Inventory",
								"writeBehavior": "insert",
								"sqlWriterUseTableLock": false,
								"disableMetricsCollection": false
							},
							"enableStaging": false,
							"translator": {
								"type": "TabularTranslator",
								"mappings": [
									{
										"source": {
											"name": "KEY",
											"type": "String",
											"physicalType": "nvarchar"
										},
										"sink": {
											"name": "KEY",
											"type": "String",
											"physicalType": "nvarchar"
										}
									},
									{
										"source": {
											"name": "Name",
											"type": "String",
											"physicalType": "nvarchar"
										},
										"sink": {
											"name": "Name",
											"type": "String",
											"physicalType": "nvarchar"
										}
									},
									{
										"source": {
											"name": "Model",
											"type": "String",
											"physicalType": "nvarchar"
										},
										"sink": {
											"name": "Model",
											"type": "String",
											"physicalType": "nvarchar"
										}
									},
									{
										"source": {
											"name": "Serial_Number",
											"type": "String",
											"physicalType": "nvarchar"
										},
										"sink": {
											"name": "Serial_Number",
											"type": "String",
											"physicalType": "nvarchar"
										}
									},
									{
										"source": {
											"name": "Model_Year",
											"type": "String",
											"physicalType": "nvarchar"
										},
										"sink": {
											"name": "Model_Year",
											"type": "String",
											"physicalType": "nvarchar"
										}
									},
									{
										"source": {
											"name": "Age_In_Months",
											"type": "Int32",
											"physicalType": "int"
										},
										"sink": {
											"name": "Age_In_Months",
											"type": "Int32",
											"physicalType": "int"
										}
									},
									{
										"source": {
											"name": "Original_DOP",
											"type": "DateTime",
											"physicalType": "date"
										},
										"sink": {
											"name": "Original_DOP",
											"type": "DateTime",
											"physicalType": "date"
										}
									},
									{
										"source": {
											"name": "OEC",
											"type": "Decimal",
											"physicalType": "money",
											"scale": 4,
											"precision": 19
										},
										"sink": {
											"name": "OEC",
											"type": "Decimal",
											"physicalType": "money",
											"scale": 4,
											"precision": 19
										}
									},
									{
										"source": {
											"name": "NBV",
											"type": "Decimal",
											"physicalType": "money",
											"scale": 4,
											"precision": 19
										},
										"sink": {
											"name": "NBV",
											"type": "Decimal",
											"physicalType": "money",
											"scale": 4,
											"precision": 19
										}
									},
									{
										"source": {
											"name": "Accum_Depr",
											"type": "Decimal",
											"physicalType": "money",
											"scale": 4,
											"precision": 19
										},
										"sink": {
											"name": "Accum_Depr",
											"type": "Decimal",
											"physicalType": "money",
											"scale": 4,
											"precision": 19
										}
									},
									{
										"source": {
											"name": "Acquisition_Cost",
											"type": "Decimal",
											"physicalType": "money",
											"scale": 4,
											"precision": 19
										},
										"sink": {
											"name": "Acquisition_Cost",
											"type": "Decimal",
											"physicalType": "money",
											"scale": 4,
											"precision": 19
										}
									},
									{
										"source": {
											"name": "PO_Number",
											"type": "Int32",
											"physicalType": "int"
										},
										"sink": {
											"name": "PO_Number",
											"type": "Int32",
											"physicalType": "int"
										}
									},
									{
										"source": {
											"name": "Extra_Cost",
											"type": "Decimal",
											"physicalType": "money",
											"scale": 4,
											"precision": 19
										},
										"sink": {
											"name": "Extra_Cost",
											"type": "Decimal",
											"physicalType": "money",
											"scale": 4,
											"precision": 19
										}
									},
									{
										"source": {
											"name": "Current_Store",
											"type": "String",
											"physicalType": "nvarchar"
										},
										"sink": {
											"name": "Current_Store",
											"type": "String",
											"physicalType": "nvarchar"
										}
									},
									{
										"source": {
											"name": "Category",
											"type": "String",
											"physicalType": "nvarchar"
										},
										"sink": {
											"name": "Category",
											"type": "String",
											"physicalType": "nvarchar"
										}
									},
									{
										"source": {
											"name": "Header",
											"type": "String",
											"physicalType": "nvarchar"
										},
										"sink": {
											"name": "Header",
											"type": "String",
											"physicalType": "nvarchar"
										}
									},
									{
										"source": {
											"name": "Type",
											"type": "String",
											"physicalType": "nvarchar"
										},
										"sink": {
											"name": "Type",
											"type": "String",
											"physicalType": "nvarchar"
										}
									},
									{
										"source": {
											"name": "Hours",
											"type": "Single",
											"physicalType": "real"
										},
										"sink": {
											"name": "Hours",
											"type": "Single",
											"physicalType": "real"
										}
									},
									{
										"source": {
											"name": "Make",
											"type": "String",
											"physicalType": "nvarchar"
										},
										"sink": {
											"name": "Make",
											"type": "String",
											"physicalType": "nvarchar"
										}
									},
									{
										"source": {
											"name": "Legacy_ID",
											"type": "String",
											"physicalType": "nvarchar"
										},
										"sink": {
											"name": "Legacy_ID",
											"type": "String",
											"physicalType": "nvarchar"
										}
									},
									{
										"source": {
											"name": "30d_TU",
											"type": "String",
											"physicalType": "varchar"
										},
										"sink": {
											"name": "30d_TU",
											"type": "String",
											"physicalType": "nvarchar"
										}
									},
									{
										"source": {
											"name": "90d_TU",
											"type": "String",
											"physicalType": "varchar"
										},
										"sink": {
											"name": "90d_TU",
											"type": "String",
											"physicalType": "nvarchar"
										}
									},
									{
										"source": {
											"name": "180d_TU",
											"type": "String",
											"physicalType": "varchar"
										},
										"sink": {
											"name": "180d_TU",
											"type": "String",
											"physicalType": "nvarchar"
										}
									},
									{
										"source": {
											"name": "R12_TU",
											"type": "String",
											"physicalType": "varchar"
										},
										"sink": {
											"name": "R12_TU",
											"type": "String",
											"physicalType": "nvarchar"
										}
									},
									{
										"source": {
											"name": "YTD_TU",
											"type": "String",
											"physicalType": "varchar"
										},
										"sink": {
											"name": "YTD_TU",
											"type": "String",
											"physicalType": "nvarchar"
										}
									},
									{
										"source": {
											"name": "30d_$Ut%",
											"type": "String",
											"physicalType": "varchar"
										},
										"sink": {
											"name": "30d_$Ut%",
											"type": "String",
											"physicalType": "nvarchar"
										}
									},
									{
										"source": {
											"name": "90d_$Ut%",
											"type": "String",
											"physicalType": "varchar"
										},
										"sink": {
											"name": "90d_$Ut%",
											"type": "String",
											"physicalType": "nvarchar"
										}
									},
									{
										"source": {
											"name": "180d_$Ut%",
											"type": "String",
											"physicalType": "varchar"
										},
										"sink": {
											"name": "180d_$Ut%",
											"type": "String",
											"physicalType": "nvarchar"
										}
									},
									{
										"source": {
											"name": "R12_$Ut%",
											"type": "String",
											"physicalType": "varchar"
										},
										"sink": {
											"name": "R12_$Ut%",
											"type": "String",
											"physicalType": "nvarchar"
										}
									},
									{
										"source": {
											"name": "YTD_$Ut%",
											"type": "String",
											"physicalType": "varchar"
										},
										"sink": {
											"name": "YTD_$Ut%",
											"type": "String",
											"physicalType": "nvarchar"
										}
									},
									{
										"source": {
											"name": "LTD_Revenue",
											"type": "Decimal",
											"physicalType": "money",
											"scale": 4,
											"precision": 19
										},
										"sink": {
											"name": "LTD_Revenue",
											"type": "Decimal",
											"physicalType": "money",
											"scale": 4,
											"precision": 19
										}
									},
									{
										"source": {
											"name": "SP%_LTDTU",
											"type": "String",
											"physicalType": "varchar"
										},
										"sink": {
											"name": "SP%_LTDTU",
											"type": "String",
											"physicalType": "nvarchar"
										}
									},
									{
										"source": {
											"name": "SP%_Life_Down",
											"type": "String",
											"physicalType": "varchar"
										},
										"sink": {
											"name": "SP%_Life_Down",
											"type": "String",
											"physicalType": "nvarchar"
										}
									},
									{
										"source": {
											"name": "Last_Rent_In_Days",
											"type": "String",
											"physicalType": "varchar"
										},
										"sink": {
											"name": "Last_Rent_In_Days",
											"type": "String",
											"physicalType": "nvarchar"
										}
									},
									{
										"source": {
											"name": "Total_Labor_Hours",
											"type": "Double",
											"physicalType": "float"
										},
										"sink": {
											"name": "Total_Labor_Hours",
											"type": "Double",
											"physicalType": "float"
										}
									},
									{
										"source": {
											"name": "Total_Labor_Cost",
											"type": "Decimal",
											"physicalType": "decimal",
											"scale": 2,
											"precision": 38
										},
										"sink": {
											"name": "Total_Labor_Cost",
											"type": "Decimal",
											"physicalType": "money",
											"scale": 4,
											"precision": 19
										}
									},
									{
										"source": {
											"name": "Days_Since_Last_Down",
											"type": "String",
											"physicalType": "varchar"
										},
										"sink": {
											"name": "Days_Since_Last_Down",
											"type": "String",
											"physicalType": "nvarchar"
										}
									},
									{
										"source": {
											"name": "Last_Down_Type",
											"type": "String",
											"physicalType": "varchar"
										},
										"sink": {
											"name": "Last_Down_Type",
											"type": "String",
											"physicalType": "nvarchar"
										}
									},
									{
										"source": {
											"name": "IRO_Totals",
											"type": "Int32",
											"physicalType": "int"
										},
										"sink": {
											"name": "IRO_Totals",
											"type": "Int32",
											"physicalType": "int"
										}
									},
									{
										"source": {
											"name": "IRO_Days_Down",
											"type": "Int32",
											"physicalType": "int"
										},
										"sink": {
											"name": "IRO_Days_Down",
											"type": "Int32",
											"physicalType": "int"
										}
									},
									{
										"source": {
											"name": "IRO_Labor_Parts_Cost",
											"type": "Decimal",
											"physicalType": "decimal",
											"scale": 2,
											"precision": 38
										},
										"sink": {
											"name": "IRO_Labor_Parts_Cost",
											"type": "Decimal",
											"physicalType": "money",
											"scale": 4,
											"precision": 19
										}
									},
									{
										"source": {
											"name": "IMO_Totals",
											"type": "Int32",
											"physicalType": "int"
										},
										"sink": {
											"name": "IMO_Totals",
											"type": "Int32",
											"physicalType": "int"
										}
									},
									{
										"source": {
											"name": "IMO_Days_Down",
											"type": "Int32",
											"physicalType": "int"
										},
										"sink": {
											"name": "IMO_Days_Down",
											"type": "Int32",
											"physicalType": "int"
										}
									},
									{
										"source": {
											"name": "IMO_Labor_PartsCost",
											"type": "Decimal",
											"physicalType": "decimal",
											"scale": 2,
											"precision": 38
										},
										"sink": {
											"name": "IMO_Labor_PartsCost",
											"type": "Decimal",
											"physicalType": "money",
											"scale": 4,
											"precision": 19
										}
									},
									{
										"source": {
											"name": "last_refresh_date",
											"type": "DateTime",
											"physicalType": "datetime"
										},
										"sink": {
											"name": "last_refresh_date",
											"type": "DateTime",
											"physicalType": "datetime"
										}
									},
									{
										"source": {
											"name": "Store_Name",
											"type": "String",
											"physicalType": "nvarchar"
										},
										"sink": {
											"name": "Store_Name",
											"type": "String",
											"physicalType": "nvarchar"
										}
									}
								],
								"typeConversion": true,
								"typeConversionSettings": {
									"allowDataTruncation": true,
									"treatBooleanAsNumber": false
								}
							}
						},
						"inputs": [
							{
								"referenceName": "DS_POR",
								"type": "DatasetReference",
								"parameters": {
									"schema_name": "dbo",
									"table_name": "user"
								}
							}
						],
						"outputs": [
							{
								"referenceName": "Briggs_MDW",
								"type": "DatasetReference",
								"parameters": {
									"schema_name": "POR",
									"table_name": "Inventory"
								}
							}
						]
					},
					{
						"name": "Purchase_Orders",
						"type": "Copy",
						"dependsOn": [
							{
								"activity": "Inventory",
								"dependencyConditions": [
									"Succeeded"
								]
							}
						],
						"policy": {
							"timeout": "7.00:00:00",
							"retry": 0,
							"retryIntervalInSeconds": 30,
							"secureOutput": false,
							"secureInput": false
						},
						"userProperties": [],
						"typeProperties": {
							"source": {
								"type": "AzureSqlSource",
								"sqlReaderQuery": "/*\nPOR Purchase Orders report\nLast Modified:  2022.03.29\n*/\n\n--Temp table (1/1)\tSupplement table\n--IF OBJECT_ID('tempdb..##POStatus') IS NOT NULL \n--   DROP TABLE #POStatus;  \n--GO\ncreate table #POStatus (POStatusID VARCHAR(10) , POStatus VARCHAR(15))\nINSERT INTO #POStatus (POStatusID,POStatus) values   ('O', 'Open');\nINSERT INTO #POStatus (POStatusID,POStatus) values  ('B', 'BackOrdered');\nINSERT INTO #POStatus (POStatusID,POStatus) values  ('C', 'Closed');\nINSERT INTO #POStatus (POStatusID,POStatus) values  ('V', 'Voided');\nINSERT INTO #POStatus (POStatusID,POStatus) values  ('P', 'Requisition') ;\n\n--CTE (1/1)  ShipTo column - clean and normalize\nWITH storeName_cte AS (\nSELECT\npo.PONumber, po.Sequence, pod.LineNumber, post.Company\n, CASE WHEN post.Company LIKE '%Reserve%' THEN 'Reserve'\n\t--WHEN po.Notes LIKE '%Ship to%#%' THEN IIF(ISNUMERIC(LEFT(LTRIM(SUBSTRING(po.Notes,CHARINDEX('#',po.Notes)+1,LEN(po.Notes))),3))=1, LEFT(LTRIM(SUBSTRING(po.Notes,CHARINDEX('#',po.Notes)+1,LEN(po.Notes))),3), 'Reserve')\n\tWHEN po.Notes LIKE '%Ship to%#%' THEN case when ISNUMERIC(LEFT(LTRIM(SUBSTRING(po.Notes,CHARINDEX('#',po.Notes)+1,LEN(po.Notes))),3))=1 then LEFT(LTRIM(SUBSTRING(po.Notes,CHARINDEX('#',po.Notes)+1,LEN(po.Notes))),3) else 'Reserve'  end\n\t--WHEN po.Notes LIKE '%Ship to %' THEN IIF(ISNUMERIC(LTRIM(RTRIM(SUBSTRING(post.Company, PATINDEX('%[0-9]%', post.Company), PATINDEX('%[0-9][^0-9]%', post.Company + 't') - PATINDEX('%[0-9]%', post.Company) + 1))))=1,LTRIM(RTRIM(SUBSTRING(post.Company, PATINDEX('%[0-9]%', post.Company), PATINDEX('%[0-9][^0-9]%', post.Company + 't') - PATINDEX('%[0-9]%', post.Company) + 1))) ,'Reserve')\n\tWHEN po.Notes LIKE '%Ship to %' THEN case when ISNUMERIC(LTRIM(RTRIM(SUBSTRING(post.Company, PATINDEX('%[0-9]%', post.Company), PATINDEX('%[0-9][^0-9]%', post.Company + 't') - PATINDEX('%[0-9]%', post.Company) + 1))))=1 then LTRIM(RTRIM(SUBSTRING(post.Company, PATINDEX('%[0-9]%', post.Company), PATINDEX('%[0-9][^0-9]%', post.Company + 't') - PATINDEX('%[0-9]%', post.Company) + 1))) else 'Reserve'  end\n\tWHEN po.Notes LIKE '%Reserve%' THEN 'Reserve'\n\tWHEN ISNUMERIC(LTRIM(RTRIM(LEFT(post.Company,3))))=1 THEN LTRIM(RTRIM(LEFT(post.Company,3)))\n\tWHEN ISNUMERIC(LEFT(LTRIM(RTRIM(SUBSTRING(post.Company, PATINDEX('%[0-9]%', post.Company), PATINDEX('%[0-9][^0-9]%', post.Company + 't') - PATINDEX('%[0-9]%', post.Company) + 1))),3)) =1 THEN CAST(LEFT(LTRIM(RTRIM(SUBSTRING(post.Company, PATINDEX('%[0-9]%', post.Company), PATINDEX('%[0-9][^0-9]%', post.Company + 't') - PATINDEX('%[0-9]%', post.Company) + 1))),3) AS VARCHAR(MAX))\n\tWHEN ifi.CurrentStore > 0 THEN ifi.CurrentStore\n\tELSE 'Unknown' END AS StoreNumber\nFROM POR.PurchaseOrder po\nJOIN POR.PurchaseOrderDetail pod ON pod.PONumber = po.PONumber AND pod.[Sequence] = po.[Sequence]\nLEFT JOIN POR.PurchaseOrderShipTo post ON post.PONumber = po.PONumber AND post.[Sequence] = po.[Sequence]\nLEFT JOIN POR.ItemFile ifi ON ifi.NUM = pod.ItemNumber\nLEFT JOIN POR.ParameterFile pf ON pf.Store = ifi.CurrentStore\n)\n\n\nSELECT\n  po.PONumber AS [PO_Number]\n, po.Store\n--, COALESCE(pf.STORE_NAME, IIF(LEN(sn.StoreNumber)=3, sn.Company,sn.StoreNumber)) AS [Ship_To]\n, COALESCE(pf.STORE_NAME, case when LEN(sn.StoreNumber)=3 then sn.Company else sn.StoreNumber end)  AS [Ship_To]\n, po.[Sequence]\n, pod.LineNumber AS [Line_Number]\n, pos.POStatus AS [PO_Status]\n, CAST(po.[Date] AS DATE) AS [PO_Date]\n--, IIF(pod.QuantityOrdered = pod.QuantityReceived, CAST(pod.DateReceived AS DATE), NULL) AS [Est_Arrival]\t--requires data feed\n, case when pod.QuantityOrdered = pod.QuantityReceived then CAST(pod.DateReceived AS DATE) else NULL end AS [Est_Arrival]\t--requires data feed\n, oi.OPNM AS [PO_By]\n, vh.VendorName AS [Vendor_Name]\n, pod.Comments AS [Line_Comments]\n, po.Notes AS [PO_Notes]\n, pod.ItemNumber AS [PO_Item_Num]\n, COALESCE(ifi.Header,ic.Name) AS Header\n, SUBSTRING(ic.[Name],0,CHARINDEX('-',ic.[Name])) AS Category\n, SUBSTRING(ic.[Name],CHARINDEX('-',ic.[Name])+1,LEN(ic.[Name])) AS [Category_Description]\n, pod.QuantityOrdered AS [Quantity_Ordered]\n, CAST(pod.PriceEach AS DECIMAL(18,2)) AS [Price_Each]\n, CAST(pod.ExtendedPrice AS DECIMAL(18,2)) AS [Extended_Price]\n, CAST((pod.QuantityOrdered * pod.FreightEach) AS DECIMAL(18,2)) AS [Extended_Freight]\n, CAST((pod.QuantityOrdered * pod.TaxEach) AS DECIMAL(18,2)) AS [Extended_Tax]\n, CAST((pod.QuantityOrdered * pod.MiscEach) AS DECIMAL(18,2)) AS [Extended_Misc]\n, CAST(SUM(pod.ExtendedPrice + (pod.QuantityOrdered * pod.FreightEach) \n\t+ (pod.QuantityOrdered * pod.TaxEach) + (pod.QuantityOrdered * pod.MiscEach)) AS DECIMAL(18,2)) AS [Total_Line_Amt]\n--, IIF(pod.QuantityOrdered = pod.QuantityReceived,'Y','N') AS Received\n,case when pod.QuantityOrdered = pod.QuantityReceived then 'Y' else 'N' end AS Received\n--, IIF(pod.QuantityOrdered = pod.QuantityReceived, CAST(pod.DateReceived AS DATE), NULL) AS [Received_Date]\n,case when pod.QuantityOrdered = pod.QuantityReceived then CAST(pod.DateReceived AS DATE) else NULL end AS [Received_Date]\n--, IIF(pod.QuantityOrdered = pod.QuantityReceived, ifi.NUM, NULL) AS [Item_Num]\n,case when pod.QuantityOrdered = pod.QuantityReceived then ifi.NUM else NULL end AS [Item_Num]\n--, IIF(pod.QuantityOrdered = pod.QuantityReceived, ifi.SerialNumber, NULL) AS [Serial_Number]\n,case when pod.QuantityOrdered = pod.QuantityReceived then  ifi.SerialNumber else NULL end AS [Serial_Number]\n, pogl.Number AS [GL_Number]\n, pogl.GLAccountNumber AS [GL_Account_Number]\n, getdate() AS [Last_Refresh_Date]\nFROM POR.PurchaseOrder po\nJOIN POR.PurchaseOrderDetail pod ON pod.PONumber = po.PONumber AND pod.[Sequence] = po.[Sequence]\nJOIN #POStatus pos ON pos.POStatusID = po.[Status]\nJOIN storeName_cte sn ON sn.PONumber = pod.PONumber AND sn.[Sequence] = pod.[Sequence] AND sn.LineNumber = pod.LineNumber\nLEFT JOIN POR.PurchaseOrderGL pogl ON pogl.Number = pod.GLNumber\nLEFT JOIN POR.VendorFile vh ON vh.VendorNumber = po.VendorNumber\nLEFT JOIN POR.ItemFile ifi ON ifi.NUM = pod.ItemNumber\nLEFT JOIN POR.ItemCategory ic ON ic.Category = ifi.Category\nLEFT JOIN POR.ParameterFile pf ON pf.Store = sn.StoreNumber\nLEFT JOIN POR.OperatorId oi ON oi.OPNO = po.Opr\n\nWHERE pod.GLAccount = 'Equipment ASSET Purchases'\nAND pod.QuantityOrdered > 0\nAND (LEFT(ifi.[KEY],7) <> 'SpclOrd' OR ifi.[KEY] IS NULL)\n\nGROUP BY\n  po.PONumber\n, po.Store\n--, COALESCE(pf.STORE_NAME, IIF(LEN(sn.StoreNumber)=3, sn.Company,sn.StoreNumber))\n, COALESCE(pf.STORE_NAME, case when LEN(sn.StoreNumber)=3 then sn.Company else sn.StoreNumber end )\n, po.[Sequence]\n, pod.LineNumber\n, pos.POStatus\n, CAST(po.[Date] AS DATE)\n--, IIF(pod.QuantityOrdered = pod.QuantityReceived, CAST(pod.DateReceived AS DATE), NULL)\t-- EstArrival:  requires data feed\n, case when pod.QuantityOrdered = pod.QuantityReceived then CAST(pod.DateReceived AS DATE) else NULL end \n, oi.OPNM\n, vh.VendorName\n, pod.Comments\n, po.Notes\n, pod.ItemNumber\n, COALESCE(ifi.Header,ic.Name)\n, SUBSTRING(ic.[Name],0,CHARINDEX('-',ic.[Name]))\n, SUBSTRING(ic.[Name],CHARINDEX('-',ic.[Name])+1,LEN(ic.[Name]))\n, pod.QuantityOrdered\n, pod.PriceEach\n, pod.ExtendedPrice\n, CAST((pod.QuantityOrdered * pod.FreightEach) AS DECIMAL(18,2))\n, CAST((pod.QuantityOrdered * pod.TaxEach) AS DECIMAL(18,2))\n, CAST((pod.QuantityOrdered * pod.MiscEach) AS DECIMAL(18,2))\n--, IIF(pod.QuantityOrdered = pod.QuantityReceived,'Y','N')\n, case when pod.QuantityOrdered = pod.QuantityReceived then 'Y' else 'N' end \n--, IIF(pod.QuantityOrdered = pod.QuantityReceived, CAST(pod.DateReceived AS DATE), NULL)\n, case when pod.QuantityOrdered = pod.QuantityReceived then CAST(pod.DateReceived AS DATE) else NULL end \n--, IIF(pod.QuantityOrdered = pod.QuantityReceived, ifi.NUM, NULL)\n, case when pod.QuantityOrdered = pod.QuantityReceived then ifi.NUM else NULL end \n--, IIF(pod.QuantityOrdered = pod.QuantityReceived, ifi.SerialNumber, NULL)\n, case when pod.QuantityOrdered = pod.QuantityReceived then ifi.SerialNumber else NULL end \n, pogl.Number\n, pogl.GLAccountNumber\n\nORDER BY po.PONumber, po.[Sequence], pod.LineNumber\n\n--DROP TABLE #POStatus\n",
								"queryTimeout": "02:00:00",
								"partitionOption": "None"
							},
							"sink": {
								"type": "AzureSqlSink",
								"preCopyScript": "truncate table por.Purchase_Orders",
								"writeBehavior": "insert",
								"sqlWriterUseTableLock": false,
								"disableMetricsCollection": false
							},
							"enableStaging": false,
							"translator": {
								"type": "TabularTranslator",
								"mappings": [
									{
										"source": {
											"name": "PO_Number",
											"type": "Int32",
											"physicalType": "int"
										},
										"sink": {
											"name": "PO_Number",
											"type": "Int32",
											"physicalType": "int"
										}
									},
									{
										"source": {
											"name": "Store",
											"type": "String",
											"physicalType": "nvarchar"
										},
										"sink": {
											"name": "Store",
											"type": "String",
											"physicalType": "nvarchar"
										}
									},
									{
										"source": {
											"name": "Ship_To",
											"type": "String",
											"physicalType": "nvarchar"
										},
										"sink": {
											"name": "Ship_To",
											"type": "String",
											"physicalType": "nvarchar"
										}
									},
									{
										"source": {
											"name": "Sequence",
											"type": "Int32",
											"physicalType": "int"
										},
										"sink": {
											"name": "Sequence",
											"type": "Int32",
											"physicalType": "int"
										}
									},
									{
										"source": {
											"name": "Line_Number",
											"type": "Int32",
											"physicalType": "int"
										},
										"sink": {
											"name": "Line_Number",
											"type": "Int32",
											"physicalType": "int"
										}
									},
									{
										"source": {
											"name": "PO_Status",
											"type": "String",
											"physicalType": "varchar"
										},
										"sink": {
											"name": "PO_Status",
											"type": "String",
											"physicalType": "nvarchar"
										}
									},
									{
										"source": {
											"name": "PO_Date",
											"type": "DateTime",
											"physicalType": "date"
										},
										"sink": {
											"name": "PO_Date",
											"type": "DateTime",
											"physicalType": "date"
										}
									},
									{
										"source": {
											"name": "Est_Arrival",
											"type": "DateTime",
											"physicalType": "date"
										},
										"sink": {
											"name": "Est_Arrival",
											"type": "DateTime",
											"physicalType": "date"
										}
									},
									{
										"source": {
											"name": "PO_By",
											"type": "String",
											"physicalType": "nvarchar"
										},
										"sink": {
											"name": "PO_By",
											"type": "String",
											"physicalType": "nvarchar"
										}
									},
									{
										"source": {
											"name": "Vendor_Name",
											"type": "String",
											"physicalType": "nvarchar"
										},
										"sink": {
											"name": "Vendor_Name",
											"type": "String",
											"physicalType": "nvarchar"
										}
									},
									{
										"source": {
											"name": "Line_Comments",
											"type": "String",
											"physicalType": "nvarchar"
										},
										"sink": {
											"name": "Line_Comments",
											"type": "String",
											"physicalType": "nvarchar"
										}
									},
									{
										"source": {
											"name": "PO_Notes",
											"type": "String",
											"physicalType": "nvarchar"
										},
										"sink": {
											"name": "PO_Notes",
											"type": "String",
											"physicalType": "nvarchar"
										}
									},
									{
										"source": {
											"name": "PO_Item_Num",
											"type": "String",
											"physicalType": "nvarchar"
										},
										"sink": {
											"name": "PO_Item_Num",
											"type": "String",
											"physicalType": "nvarchar"
										}
									},
									{
										"source": {
											"name": "Header",
											"type": "String",
											"physicalType": "nvarchar"
										},
										"sink": {
											"name": "Header",
											"type": "String",
											"physicalType": "nvarchar"
										}
									},
									{
										"source": {
											"name": "Category",
											"type": "String",
											"physicalType": "nvarchar"
										},
										"sink": {
											"name": "Category",
											"type": "String",
											"physicalType": "nvarchar"
										}
									},
									{
										"source": {
											"name": "Category_Description",
											"type": "String",
											"physicalType": "nvarchar"
										},
										"sink": {
											"name": "Category_Description",
											"type": "String",
											"physicalType": "nvarchar"
										}
									},
									{
										"source": {
											"name": "Quantity_Ordered",
											"type": "Double",
											"physicalType": "float"
										},
										"sink": {
											"name": "Quantity_Ordered",
											"type": "Double",
											"physicalType": "float"
										}
									},
									{
										"source": {
											"name": "Price_Each",
											"type": "Decimal",
											"physicalType": "decimal",
											"scale": 2,
											"precision": 18
										},
										"sink": {
											"name": "Price_Each",
											"type": "Decimal",
											"physicalType": "decimal",
											"scale": 2,
											"precision": 18
										}
									},
									{
										"source": {
											"name": "Extended_Price",
											"type": "Decimal",
											"physicalType": "decimal",
											"scale": 2,
											"precision": 18
										},
										"sink": {
											"name": "Extended_Price",
											"type": "Decimal",
											"physicalType": "decimal",
											"scale": 2,
											"precision": 18
										}
									},
									{
										"source": {
											"name": "Extended_Freight",
											"type": "Decimal",
											"physicalType": "decimal",
											"scale": 2,
											"precision": 18
										},
										"sink": {
											"name": "Extended_Freight",
											"type": "Decimal",
											"physicalType": "decimal",
											"scale": 2,
											"precision": 18
										}
									},
									{
										"source": {
											"name": "Extended_Tax",
											"type": "Decimal",
											"physicalType": "decimal",
											"scale": 2,
											"precision": 18
										},
										"sink": {
											"name": "Extended_Tax",
											"type": "Decimal",
											"physicalType": "decimal",
											"scale": 2,
											"precision": 18
										}
									},
									{
										"source": {
											"name": "Extended_Misc",
											"type": "Decimal",
											"physicalType": "decimal",
											"scale": 2,
											"precision": 18
										},
										"sink": {
											"name": "Extended_Misc",
											"type": "Decimal",
											"physicalType": "decimal",
											"scale": 2,
											"precision": 18
										}
									},
									{
										"source": {
											"name": "Total_Line_Amt",
											"type": "Decimal",
											"physicalType": "decimal",
											"scale": 2,
											"precision": 18
										},
										"sink": {
											"name": "Total_Line_Amt",
											"type": "Decimal",
											"physicalType": "decimal",
											"scale": 2,
											"precision": 18
										}
									},
									{
										"source": {
											"name": "Received",
											"type": "String",
											"physicalType": "varchar"
										},
										"sink": {
											"name": "Received",
											"type": "String",
											"physicalType": "nvarchar"
										}
									},
									{
										"source": {
											"name": "Received_Date",
											"type": "DateTime",
											"physicalType": "date"
										},
										"sink": {
											"name": "Received_Date",
											"type": "DateTime",
											"physicalType": "date"
										}
									},
									{
										"source": {
											"name": "Item_Num",
											"type": "String",
											"physicalType": "nvarchar"
										},
										"sink": {
											"name": "Item_Num",
											"type": "String",
											"physicalType": "nvarchar"
										}
									},
									{
										"source": {
											"name": "Serial_Number",
											"type": "String",
											"physicalType": "nvarchar"
										},
										"sink": {
											"name": "Serial_Number",
											"type": "String",
											"physicalType": "nvarchar"
										}
									},
									{
										"source": {
											"name": "GL_Number",
											"type": "Int32",
											"physicalType": "int"
										},
										"sink": {
											"name": "GL_Number",
											"type": "Int32",
											"physicalType": "int"
										}
									},
									{
										"source": {
											"name": "GL_Account_Number",
											"type": "String",
											"physicalType": "nvarchar"
										},
										"sink": {
											"name": "GL_Account_Number",
											"type": "String",
											"physicalType": "nvarchar"
										}
									},
									{
										"source": {
											"name": "Last_Refresh_Date",
											"type": "DateTime",
											"physicalType": "datetime"
										},
										"sink": {
											"name": "Last_Refresh_Date",
											"type": "DateTime",
											"physicalType": "datetime"
										}
									}
								],
								"typeConversion": true,
								"typeConversionSettings": {
									"allowDataTruncation": true,
									"treatBooleanAsNumber": false
								}
							}
						},
						"inputs": [
							{
								"referenceName": "Briggs_MDW",
								"type": "DatasetReference",
								"parameters": {
									"schema_name": "dbo",
									"table_name": "user"
								}
							}
						],
						"outputs": [
							{
								"referenceName": "Briggs_MDW",
								"type": "DatasetReference",
								"parameters": {
									"schema_name": "POR",
									"table_name": "Purchase_Orders"
								}
							}
						]
					}
				],
				"policy": {
					"elapsedTimeMetric": {},
					"cancelAfter": {}
				},
				"folder": {
					"name": "MDP POR DataLoad"
				},
				"annotations": [],
				"lastPublishTime": "2022-04-29T10:54:01Z"
			},
			"dependsOn": [
				"[concat(variables('workspaceId'), '/datasets/Briggs_MDW')]",
				"[concat(variables('workspaceId'), '/datasets/DS_POR')]"
			]
		},
		{
			"name": "[concat(parameters('workspaceName'), '/PL_Briggs_Heavy_Table_Load')]",
			"type": "Microsoft.Synapse/workspaces/pipelines",
			"apiVersion": "2019-06-01-preview",
			"properties": {
				"activities": [
					{
						"name": "Lookup2_Full",
						"type": "Lookup",
						"dependsOn": [
							{
								"activity": "PL_SCALE_AZURE_SQL_DW500",
								"dependencyConditions": [
									"Succeeded"
								]
							}
						],
						"policy": {
							"timeout": "7.00:00:00",
							"retry": 0,
							"retryIntervalInSeconds": 30,
							"secureOutput": false,
							"secureInput": false
						},
						"userProperties": [],
						"typeProperties": {
							"source": {
								"type": "AzureSqlSource",
								"sqlReaderQuery": "select id ID_Full from dbo.control_table where sourcetablename in (\n'XAP_INVOICESCHEDULELINE',\n'XAP_SVCREPORTINGTABLE',\n'DIMENSIONATTRIBUTEVALUE',\n'DIMENSIONATTRIBUTEVALUECOMBINATION',\n'DIMENSIONATTRIBUTEVALUEGROUPCOMBINATION',\n'ECORESPRODUCTTRANSLATION',\n'XAP_NPRITEM',\n'DIMENSIONATTRIBUTELEVELVALUE',\n'BRIGGS_CURRENTINVENTORY_ALL_INVENTORY'\n) order by id",
								"queryTimeout": "02:00:00",
								"partitionOption": "None"
							},
							"dataset": {
								"referenceName": "Briggs_MDW",
								"type": "DatasetReference",
								"parameters": {
									"schema_name": "dbo",
									"table_name": "user"
								}
							},
							"firstRowOnly": false
						}
					},
					{
						"name": "ForEach_Full_Load",
						"type": "ForEach",
						"dependsOn": [
							{
								"activity": "Lookup2_Full",
								"dependencyConditions": [
									"Succeeded"
								]
							}
						],
						"userProperties": [],
						"typeProperties": {
							"items": {
								"value": "@activity('Lookup2_Full').output.value",
								"type": "Expression"
							},
							"batchCount": 2,
							"activities": [
								{
									"name": "Lookup_Full",
									"type": "Lookup",
									"dependsOn": [],
									"policy": {
										"timeout": "7.00:00:00",
										"retry": 0,
										"retryIntervalInSeconds": 30,
										"secureOutput": false,
										"secureInput": false
									},
									"userProperties": [],
									"typeProperties": {
										"source": {
											"type": "AzureSqlSource",
											"sqlReaderQuery": {
												"value": "@concat('select SourceQuery=''select '' +columnList+ '' from ''+ sourceDB+''.''+SourceSchemaName+''.''+SourcetableName\n,SourceDB\n,TargetContainer\n, TargetPath, TargetFile, FileFormat,DateField,LastDate,targetstagetableschema,targetstagetablename\nfrom dbo.control_table\nwhere ID= ',item().ID_Full)",
												"type": "Expression"
											},
											"queryTimeout": "02:00:00",
											"partitionOption": "None"
										},
										"dataset": {
											"referenceName": "Briggs_MDW",
											"type": "DatasetReference",
											"parameters": {
												"schema_name": "dbo",
												"table_name": "user"
											}
										}
									}
								},
								{
									"name": "Copy_BriggsMST_ADLS_copy1",
									"type": "Copy",
									"dependsOn": [
										{
											"activity": "Lookup_Full",
											"dependencyConditions": [
												"Succeeded"
											]
										}
									],
									"policy": {
										"timeout": "7.00:00:00",
										"retry": 0,
										"retryIntervalInSeconds": 30,
										"secureOutput": false,
										"secureInput": false
									},
									"userProperties": [],
									"typeProperties": {
										"source": {
											"type": "SqlServerSource",
											"sqlReaderQuery": {
												"value": "@activity('Lookup_Full').output.firstRow.SourceQuery\n",
												"type": "Expression"
											},
											"queryTimeout": "02:00:00",
											"partitionOption": "None"
										},
										"sink": {
											"type": "AzureSqlSink",
											"preCopyScript": {
												"value": "@{concat('truncate table ',activity('Lookup_Full').output.firstRow.TargetStageTableSchema,'.',activity('Lookup_Full').output.firstRow.TargetStageTableName)}",
												"type": "Expression"
											},
											"disableMetricsCollection": false
										},
										"enableStaging": false,
										"translator": {
											"type": "TabularTranslator",
											"typeConversion": true,
											"typeConversionSettings": {
												"allowDataTruncation": true,
												"treatBooleanAsNumber": false
											}
										}
									},
									"inputs": [
										{
											"referenceName": "DS_Briggs_MST",
											"type": "DatasetReference",
											"parameters": {}
										}
									],
									"outputs": [
										{
											"referenceName": "Briggs_MDW",
											"type": "DatasetReference",
											"parameters": {
												"schema_name": {
													"value": "@activity('Lookup_Full').output.firstRow.TargetStageTableSchema",
													"type": "Expression"
												},
												"table_name": {
													"value": "@activity('Lookup_Full').output.firstRow.TargetStageTableName",
													"type": "Expression"
												}
											}
										}
									]
								}
							]
						}
					},
					{
						"name": "ForEach_Proc_Full",
						"type": "ForEach",
						"dependsOn": [
							{
								"activity": "ForEach_Full_Load",
								"dependencyConditions": [
									"Succeeded"
								]
							}
						],
						"userProperties": [],
						"typeProperties": {
							"items": {
								"value": "@activity('Lookup2_Full').output.value",
								"type": "Expression"
							},
							"activities": [
								{
									"name": "Stored procedure_Full",
									"type": "SqlServerStoredProcedure",
									"dependsOn": [],
									"policy": {
										"timeout": "7.00:00:00",
										"retry": 0,
										"retryIntervalInSeconds": 30,
										"secureOutput": false,
										"secureInput": false
									},
									"userProperties": [],
									"typeProperties": {
										"storedProcedureName": "[dbo].[USP_Control_Table_LastDate]",
										"storedProcedureParameters": {
											"id_I_F": {
												"value": {
													"value": "@item().ID_Full",
													"type": "Expression"
												},
												"type": "Int32"
											}
										}
									},
									"linkedServiceName": {
										"referenceName": "DS_MDW_SP",
										"type": "LinkedServiceReference"
									}
								}
							]
						}
					},
					{
						"name": "PL_SCALE_AZURE_SQL_DW500",
						"type": "ExecutePipeline",
						"dependsOn": [],
						"userProperties": [],
						"typeProperties": {
							"pipeline": {
								"referenceName": "PL_SCALE_AZURE_SQL_DW",
								"type": "PipelineReference"
							},
							"waitOnCompletion": true,
							"parameters": {}
						}
					},
					{
						"name": "PL_SCALE_AZURE_SQL_DW100",
						"type": "ExecutePipeline",
						"dependsOn": [
							{
								"activity": "ForEach_Proc_Full",
								"dependencyConditions": [
									"Succeeded"
								]
							}
						],
						"userProperties": [],
						"typeProperties": {
							"pipeline": {
								"referenceName": "PL_SCALE_AZURE_SQL_DW",
								"type": "PipelineReference"
							},
							"waitOnCompletion": true,
							"parameters": {
								"PerformanceLevel": "DW100c"
							}
						}
					}
				],
				"policy": {
					"elapsedTimeMetric": {},
					"cancelAfter": {}
				},
				"folder": {
					"name": "Briggs Data Load in Azure DataLake"
				},
				"annotations": [],
				"lastPublishTime": "2022-04-20T10:39:23Z"
			},
			"dependsOn": [
				"[concat(variables('workspaceId'), '/datasets/Briggs_MDW')]",
				"[concat(variables('workspaceId'), '/pipelines/PL_SCALE_AZURE_SQL_DW')]",
				"[concat(variables('workspaceId'), '/datasets/DS_Briggs_MST')]",
				"[concat(variables('workspaceId'), '/linkedServices/DS_MDW_SP')]"
			]
		},
		{
			"name": "[concat(parameters('workspaceName'), '/PL_Generic_Copy_ADLS_POR')]",
			"type": "Microsoft.Synapse/workspaces/pipelines",
			"apiVersion": "2019-06-01-preview",
			"properties": {
				"activities": [
					{
						"name": "Lkp_GetTableDetails",
						"type": "Lookup",
						"dependsOn": [
							{
								"activity": "lkp_ExecStartAuditProc",
								"dependencyConditions": [
									"Succeeded"
								]
							}
						],
						"policy": {
							"timeout": "7.00:00:00",
							"retry": 0,
							"retryIntervalInSeconds": 30,
							"secureOutput": false,
							"secureInput": false
						},
						"userProperties": [],
						"typeProperties": {
							"source": {
								"type": "AzureSqlSource",
								"sqlReaderQuery": {
									"value": "@concat('Select Distinct SourceDB , SourceQuery = ''Select ''+ColumnList+'' From ''+SourceSchemaName+''.''+SourceTableName, TargetContainer, TargetPath, TargetFile, FileFormat\nFrom [dbo].[control_table_por]\nWhere ID = ',string(pipeline().parameters.IDValue))",
									"type": "Expression"
								},
								"queryTimeout": "02:00:00",
								"partitionOption": "None"
							},
							"dataset": {
								"referenceName": "Briggs_MDW",
								"type": "DatasetReference",
								"parameters": {
									"schema_name": "dbo",
									"table_name": "user"
								}
							},
							"firstRowOnly": true
						}
					},
					{
						"name": "Parse_Through_DB",
						"type": "Switch",
						"dependsOn": [
							{
								"activity": "Sp_ExecUpdateAudit",
								"dependencyConditions": [
									"Succeeded"
								]
							}
						],
						"userProperties": [],
						"typeProperties": {
							"on": {
								"value": "@activity('Lkp_GetTableDetails').output.firstRow.SourceDB",
								"type": "Expression"
							},
							"cases": [
								{
									"value": "POR",
									"activities": [
										{
											"name": "Copy_POR_ADLS",
											"type": "Copy",
											"dependsOn": [],
											"policy": {
												"timeout": "7.00:00:00",
												"retry": 0,
												"retryIntervalInSeconds": 30,
												"secureOutput": false,
												"secureInput": false
											},
											"userProperties": [],
											"typeProperties": {
												"source": {
													"type": "SqlServerSource",
													"sqlReaderQuery": {
														"value": "@activity('Lkp_GetTableDetails').output.firstRow.SourceQuery",
														"type": "Expression"
													},
													"queryTimeout": "02:00:00",
													"partitionOption": "None"
												},
												"sink": {
													"type": "ParquetSink",
													"storeSettings": {
														"type": "AzureBlobStorageWriteSettings"
													},
													"formatSettings": {
														"type": "ParquetWriteSettings"
													}
												},
												"enableStaging": false,
												"translator": {
													"type": "TabularTranslator",
													"typeConversion": true,
													"typeConversionSettings": {
														"allowDataTruncation": true,
														"treatBooleanAsNumber": false
													}
												}
											},
											"inputs": [
												{
													"referenceName": "DS_POR",
													"type": "DatasetReference",
													"parameters": {
														"schema_name": "dbo",
														"table_name": "user"
													}
												}
											],
											"outputs": [
												{
													"referenceName": "DS_ADLS_Parquet_1",
													"type": "DatasetReference",
													"parameters": {
														"ContainerName": {
															"value": "@activity('Lkp_GetTableDetails').output.firstRow.TargetContainer",
															"type": "Expression"
														},
														"Path": {
															"value": "@activity('Lkp_GetTableDetails').output.firstRow.TargetPath",
															"type": "Expression"
														},
														"FileName": {
															"value": "@concat(activity('Lkp_GetTableDetails').output.firstRow.TargetFile,'.',activity('Lkp_GetTableDetails').output.firstRow.FileFormat)",
															"type": "Expression"
														}
													}
												}
											]
										},
										{
											"name": "Sp_ExecSuccessAudit",
											"type": "SqlServerStoredProcedure",
											"dependsOn": [
												{
													"activity": "Copy_POR_ADLS",
													"dependencyConditions": [
														"Succeeded"
													]
												}
											],
											"policy": {
												"timeout": "7.00:00:00",
												"retry": 0,
												"retryIntervalInSeconds": 30,
												"secureOutput": false,
												"secureInput": false
											},
											"userProperties": [],
											"typeProperties": {
												"storedProcedureName": "[dbo].[proc_UpdateAuditLog]",
												"storedProcedureParameters": {
													"AuditID": {
														"value": {
															"value": "@activity('lkp_ExecStartAuditProc').output.firstRow.AuditID",
															"type": "Expression"
														},
														"type": "Int32"
													},
													"DataLakePath": {
														"value": {
															"value": "@concat(activity('Lkp_GetTableDetails').output.firstRow.TargetPath,'/',activity('Lkp_GetTableDetails').output.firstRow.TargetFile,'_',formatDateTime(utcnow(),'yyyyMMdd'),'.',activity('Lkp_GetTableDetails').output.firstRow.FileFormat)",
															"type": "Expression"
														},
														"type": "String"
													},
													"RowsRead": {
														"value": {
															"value": "@activity('Copy_POR_ADLS').output.RowsRead",
															"type": "Expression"
														},
														"type": "Int64"
													},
													"Status": {
														"value": "Success",
														"type": "String"
													},
													"PipelineRunID": {
														"value": {
															"value": "@pipeline().RunId",
															"type": "Expression"
														},
														"type": "String"
													}
												}
											},
											"linkedServiceName": {
												"referenceName": "AzureSqlDatabase1",
												"type": "LinkedServiceReference"
											}
										},
										{
											"name": "Sp_ExecFailureAudit",
											"type": "SqlServerStoredProcedure",
											"dependsOn": [
												{
													"activity": "Copy_POR_ADLS",
													"dependencyConditions": [
														"Failed"
													]
												}
											],
											"policy": {
												"timeout": "7.00:00:00",
												"retry": 0,
												"retryIntervalInSeconds": 30,
												"secureOutput": false,
												"secureInput": false
											},
											"userProperties": [],
											"typeProperties": {
												"storedProcedureName": "[dbo].[proc_UpdateAuditLog]",
												"storedProcedureParameters": {
													"AuditID": {
														"value": {
															"value": "@activity('lkp_ExecStartAuditProc').output.firstRow.AuditID",
															"type": "Expression"
														},
														"type": "Int32"
													},
													"DataLakePath": {
														"value": null,
														"type": "String"
													},
													"RowsRead": {
														"value": null,
														"type": "Int64"
													},
													"Status": {
														"value": "Failed",
														"type": "String"
													},
													"PipelineRunID": {
														"value": {
															"value": "@pipeline().RunId",
															"type": "Expression"
														},
														"type": "String"
													}
												}
											},
											"linkedServiceName": {
												"referenceName": "AzureSqlDatabase1",
												"type": "LinkedServiceReference"
											}
										}
									]
								},
								{
									"value": "BriggsHR",
									"activities": [
										{
											"name": "Copy_BriggsHR_ADLS",
											"type": "Copy",
											"dependsOn": [],
											"policy": {
												"timeout": "7.00:00:00",
												"retry": 0,
												"retryIntervalInSeconds": 30,
												"secureOutput": false,
												"secureInput": false
											},
											"userProperties": [],
											"typeProperties": {
												"source": {
													"type": "SqlServerSource",
													"sqlReaderQuery": {
														"value": "@activity('Lkp_GetTableDetails').output.firstRow.SourceQuery",
														"type": "Expression"
													},
													"queryTimeout": "02:00:00",
													"partitionOption": "None"
												},
												"sink": {
													"type": "ParquetSink",
													"storeSettings": {
														"type": "AzureBlobStorageWriteSettings"
													},
													"formatSettings": {
														"type": "ParquetWriteSettings"
													}
												},
												"enableStaging": false,
												"translator": {
													"type": "TabularTranslator",
													"typeConversion": true,
													"typeConversionSettings": {
														"allowDataTruncation": true,
														"treatBooleanAsNumber": false
													}
												}
											},
											"inputs": [
												{
													"referenceName": "DS_BriggsHR",
													"type": "DatasetReference",
													"parameters": {}
												}
											],
											"outputs": [
												{
													"referenceName": "DS_ADLS_Parquet_1",
													"type": "DatasetReference",
													"parameters": {
														"ContainerName": {
															"value": "@activity('Lkp_GetTableDetails').output.firstRow.TargetContainer",
															"type": "Expression"
														},
														"Path": {
															"value": "@activity('Lkp_GetTableDetails').output.firstRow.TargetPath",
															"type": "Expression"
														},
														"FileName": {
															"value": "@concat(activity('Lkp_GetTableDetails').output.firstRow.TargetFile,'_',formatDateTime(utcnow(),'yyyyMMdd'),'.',activity('Lkp_GetTableDetails').output.firstRow.FileFormat)",
															"type": "Expression"
														}
													}
												}
											]
										},
										{
											"name": "Sp_ExecSuccessAudit_BriggsHR",
											"type": "SqlServerStoredProcedure",
											"dependsOn": [
												{
													"activity": "Copy_BriggsHR_ADLS",
													"dependencyConditions": [
														"Succeeded"
													]
												}
											],
											"policy": {
												"timeout": "7.00:00:00",
												"retry": 0,
												"retryIntervalInSeconds": 30,
												"secureOutput": false,
												"secureInput": false
											},
											"userProperties": [],
											"typeProperties": {
												"storedProcedureName": "[dbo].[proc_UpdateAuditLog]",
												"storedProcedureParameters": {
													"AuditID": {
														"value": {
															"value": "@activity('lkp_ExecStartAuditProc').output.firstRow.AuditID",
															"type": "Expression"
														},
														"type": "Int32"
													},
													"DataLakePath": {
														"value": {
															"value": "@concat(activity('Lkp_GetTableDetails').output.firstRow.TargetPath,'/',activity('Lkp_GetTableDetails').output.firstRow.TargetFile,'_',formatDateTime(utcnow(),'yyyyMMdd'),'.',activity('Lkp_GetTableDetails').output.firstRow.FileFormat)",
															"type": "Expression"
														},
														"type": "String"
													},
													"RowsRead": {
														"value": {
															"value": "@activity('Copy_BriggsHR_ADLS').output.RowsRead",
															"type": "Expression"
														},
														"type": "Int64"
													},
													"Status": {
														"value": "Success",
														"type": "String"
													},
													"PipelineRunID": {
														"value": {
															"value": "@pipeline().RunId",
															"type": "Expression"
														},
														"type": "String"
													}
												}
											},
											"linkedServiceName": {
												"referenceName": "AzureSqlDatabase1",
												"type": "LinkedServiceReference"
											}
										},
										{
											"name": "Sp_ExecFailureAudit_BriggsHR",
											"type": "SqlServerStoredProcedure",
											"dependsOn": [
												{
													"activity": "Copy_BriggsHR_ADLS",
													"dependencyConditions": [
														"Failed"
													]
												}
											],
											"policy": {
												"timeout": "7.00:00:00",
												"retry": 0,
												"retryIntervalInSeconds": 30,
												"secureOutput": false,
												"secureInput": false
											},
											"userProperties": [],
											"typeProperties": {
												"storedProcedureName": "[dbo].[proc_UpdateAuditLog]",
												"storedProcedureParameters": {
													"AuditID": {
														"value": {
															"value": "@activity('lkp_ExecStartAuditProc').output.firstRow.AuditID",
															"type": "Expression"
														},
														"type": "Int32"
													},
													"DataLakePath": {
														"value": null,
														"type": "String"
													},
													"RowsRead": {
														"value": null,
														"type": "Int64"
													},
													"Status": {
														"value": "Failed",
														"type": "String"
													},
													"PipelineRunID": {
														"value": {
															"value": "@pipeline().RunId",
															"type": "Expression"
														},
														"type": "String"
													}
												}
											},
											"linkedServiceName": {
												"referenceName": "AzureSqlDatabase1",
												"type": "LinkedServiceReference"
											}
										}
									]
								},
								{
									"value": "BriggsAX",
									"activities": [
										{
											"name": "Copy_BriggsAX_ADLS",
											"type": "Copy",
											"dependsOn": [],
											"policy": {
												"timeout": "7.00:00:00",
												"retry": 0,
												"retryIntervalInSeconds": 30,
												"secureOutput": false,
												"secureInput": false
											},
											"userProperties": [],
											"typeProperties": {
												"source": {
													"type": "SqlServerSource",
													"sqlReaderQuery": {
														"value": "@activity('Lkp_GetTableDetails').output.firstRow.SourceQuery",
														"type": "Expression"
													},
													"queryTimeout": "02:00:00",
													"partitionOption": "None"
												},
												"sink": {
													"type": "ParquetSink",
													"storeSettings": {
														"type": "AzureBlobStorageWriteSettings"
													},
													"formatSettings": {
														"type": "ParquetWriteSettings"
													}
												},
												"enableStaging": false,
												"translator": {
													"type": "TabularTranslator",
													"typeConversion": true,
													"typeConversionSettings": {
														"allowDataTruncation": true,
														"treatBooleanAsNumber": false
													}
												}
											},
											"inputs": [
												{
													"referenceName": "DS_BriggsAX",
													"type": "DatasetReference",
													"parameters": {}
												}
											],
											"outputs": [
												{
													"referenceName": "DS_ADLS_Parquet_1",
													"type": "DatasetReference",
													"parameters": {
														"ContainerName": {
															"value": "@activity('Lkp_GetTableDetails').output.firstRow.TargetContainer",
															"type": "Expression"
														},
														"Path": {
															"value": "@activity('Lkp_GetTableDetails').output.firstRow.TargetPath",
															"type": "Expression"
														},
														"FileName": {
															"value": "@concat(activity('Lkp_GetTableDetails').output.firstRow.TargetFile,'_',formatDateTime(utcnow(),'yyyyMMdd'),'.',activity('Lkp_GetTableDetails').output.firstRow.FileFormat)",
															"type": "Expression"
														}
													}
												}
											]
										},
										{
											"name": "Sp_ExecSuccessAudit_BriggsAX",
											"type": "SqlServerStoredProcedure",
											"dependsOn": [
												{
													"activity": "Copy_BriggsAX_ADLS",
													"dependencyConditions": [
														"Succeeded"
													]
												}
											],
											"policy": {
												"timeout": "7.00:00:00",
												"retry": 0,
												"retryIntervalInSeconds": 30,
												"secureOutput": false,
												"secureInput": false
											},
											"userProperties": [],
											"typeProperties": {
												"storedProcedureName": "[dbo].[proc_UpdateAuditLog]",
												"storedProcedureParameters": {
													"AuditID": {
														"value": {
															"value": "@activity('lkp_ExecStartAuditProc').output.firstRow.AuditID",
															"type": "Expression"
														},
														"type": "Int32"
													},
													"DataLakePath": {
														"value": {
															"value": "@concat(activity('Lkp_GetTableDetails').output.firstRow.TargetPath,'/',activity('Lkp_GetTableDetails').output.firstRow.TargetFile,'_',formatDateTime(utcnow(),'yyyyMMdd'),'.',activity('Lkp_GetTableDetails').output.firstRow.FileFormat)",
															"type": "Expression"
														},
														"type": "String"
													},
													"RowsRead": {
														"value": {
															"value": "@activity('Copy_BriggsAX_ADLS').output.RowsRead",
															"type": "Expression"
														},
														"type": "Int64"
													},
													"Status": {
														"value": "Success",
														"type": "String"
													},
													"PipelineRunID": {
														"value": {
															"value": "@pipeline().RunId",
															"type": "Expression"
														},
														"type": "String"
													}
												}
											},
											"linkedServiceName": {
												"referenceName": "AzureSqlDatabase1",
												"type": "LinkedServiceReference"
											}
										},
										{
											"name": "Sp_ExecFailureAudit_BriggsAX",
											"type": "SqlServerStoredProcedure",
											"dependsOn": [
												{
													"activity": "Copy_BriggsAX_ADLS",
													"dependencyConditions": [
														"Failed"
													]
												}
											],
											"policy": {
												"timeout": "7.00:00:00",
												"retry": 0,
												"retryIntervalInSeconds": 30,
												"secureOutput": false,
												"secureInput": false
											},
											"userProperties": [],
											"typeProperties": {
												"storedProcedureName": "[dbo].[proc_UpdateAuditLog]",
												"storedProcedureParameters": {
													"AuditID": {
														"value": {
															"value": "@activity('lkp_ExecStartAuditProc').output.firstRow.AuditID",
															"type": "Expression"
														},
														"type": "Int32"
													},
													"DataLakePath": {
														"value": null,
														"type": "String"
													},
													"RowsRead": {
														"value": null,
														"type": "Int64"
													},
													"Status": {
														"value": "Failed",
														"type": "String"
													},
													"PipelineRunID": {
														"value": {
															"value": "@pipeline().RunId",
															"type": "Expression"
														},
														"type": "String"
													}
												}
											},
											"linkedServiceName": {
												"referenceName": "AzureSqlDatabase1",
												"type": "LinkedServiceReference"
											}
										}
									]
								},
								{
									"value": "Briggs_MST",
									"activities": [
										{
											"name": "Copy_BriggsMST_ADLS",
											"type": "Copy",
											"dependsOn": [],
											"policy": {
												"timeout": "7.00:00:00",
												"retry": 0,
												"retryIntervalInSeconds": 30,
												"secureOutput": false,
												"secureInput": false
											},
											"userProperties": [],
											"typeProperties": {
												"source": {
													"type": "SqlServerSource",
													"sqlReaderQuery": {
														"value": "@activity('Lkp_GetTableDetails').output.firstRow.SourceQuery",
														"type": "Expression"
													},
													"queryTimeout": "02:00:00",
													"partitionOption": "None"
												},
												"sink": {
													"type": "ParquetSink",
													"storeSettings": {
														"type": "AzureBlobStorageWriteSettings"
													},
													"formatSettings": {
														"type": "ParquetWriteSettings"
													}
												},
												"enableStaging": false,
												"translator": {
													"type": "TabularTranslator",
													"typeConversion": true,
													"typeConversionSettings": {
														"allowDataTruncation": true,
														"treatBooleanAsNumber": false
													}
												}
											},
											"inputs": [
												{
													"referenceName": "DS_Briggs_MST",
													"type": "DatasetReference",
													"parameters": {}
												}
											],
											"outputs": [
												{
													"referenceName": "DS_ADLS_Parquet_1",
													"type": "DatasetReference",
													"parameters": {
														"ContainerName": {
															"value": "@activity('Lkp_GetTableDetails').output.firstRow.TargetContainer",
															"type": "Expression"
														},
														"Path": {
															"value": "@activity('Lkp_GetTableDetails').output.firstRow.TargetPath",
															"type": "Expression"
														},
														"FileName": {
															"value": "@concat(activity('Lkp_GetTableDetails').output.firstRow.TargetFile,'_',formatDateTime(utcnow(),'yyyyMMdd'),'.',activity('Lkp_GetTableDetails').output.firstRow.FileFormat)",
															"type": "Expression"
														}
													}
												}
											]
										},
										{
											"name": "Sp_ExecSuccessAudit_BriggsMST",
											"type": "SqlServerStoredProcedure",
											"dependsOn": [
												{
													"activity": "Copy_BriggsMST_ADLS",
													"dependencyConditions": [
														"Succeeded"
													]
												}
											],
											"policy": {
												"timeout": "7.00:00:00",
												"retry": 0,
												"retryIntervalInSeconds": 30,
												"secureOutput": false,
												"secureInput": false
											},
											"userProperties": [],
											"typeProperties": {
												"storedProcedureName": "[dbo].[proc_UpdateAuditLog]",
												"storedProcedureParameters": {
													"AuditID": {
														"value": {
															"value": "@activity('lkp_ExecStartAuditProc').output.firstRow.AuditID",
															"type": "Expression"
														},
														"type": "Int32"
													},
													"DataLakePath": {
														"value": {
															"value": "@concat(activity('Lkp_GetTableDetails').output.firstRow.TargetPath,'/',activity('Lkp_GetTableDetails').output.firstRow.TargetFile,'_',formatDateTime(utcnow(),'yyyyMMdd'),'.',activity('Lkp_GetTableDetails').output.firstRow.FileFormat)",
															"type": "Expression"
														},
														"type": "String"
													},
													"RowsRead": {
														"value": {
															"value": "@activity('Copy_BriggsMST_ADLS').output.RowsRead",
															"type": "Expression"
														},
														"type": "Int64"
													},
													"Status": {
														"value": "Success",
														"type": "String"
													},
													"PipelineRunID": {
														"value": {
															"value": "@pipeline().RunId",
															"type": "Expression"
														},
														"type": "String"
													}
												}
											},
											"linkedServiceName": {
												"referenceName": "AzureSqlDatabase1",
												"type": "LinkedServiceReference"
											}
										},
										{
											"name": "Sp_ExecFailureAudit_BriggsMST",
											"type": "SqlServerStoredProcedure",
											"dependsOn": [
												{
													"activity": "Copy_BriggsMST_ADLS",
													"dependencyConditions": [
														"Failed"
													]
												}
											],
											"policy": {
												"timeout": "7.00:00:00",
												"retry": 0,
												"retryIntervalInSeconds": 30,
												"secureOutput": false,
												"secureInput": false
											},
											"userProperties": [],
											"typeProperties": {
												"storedProcedureName": "[dbo].[proc_UpdateAuditLog]",
												"storedProcedureParameters": {
													"AuditID": {
														"value": {
															"value": "@activity('lkp_ExecStartAuditProc').output.firstRow.AuditID",
															"type": "Expression"
														},
														"type": "Int32"
													},
													"DataLakePath": {
														"value": null,
														"type": "String"
													},
													"RowsRead": {
														"value": null,
														"type": "Int64"
													},
													"Status": {
														"value": "Failed",
														"type": "String"
													},
													"PipelineRunID": {
														"value": {
															"value": "@pipeline().RunId",
															"type": "Expression"
														},
														"type": "String"
													}
												}
											},
											"linkedServiceName": {
												"referenceName": "AzureSqlDatabase1",
												"type": "LinkedServiceReference"
											}
										}
									]
								},
								{
									"value": "BIE_DATA_WAREHOUSE",
									"activities": [
										{
											"name": "Copy_BIE_DATA_WAREHOUSE_ADLS",
											"type": "Copy",
											"dependsOn": [],
											"policy": {
												"timeout": "7.00:00:00",
												"retry": 0,
												"retryIntervalInSeconds": 30,
												"secureOutput": false,
												"secureInput": false
											},
											"userProperties": [],
											"typeProperties": {
												"source": {
													"type": "SqlServerSource",
													"sqlReaderQuery": {
														"value": "@activity('Lkp_GetTableDetails').output.firstRow.SourceQuery",
														"type": "Expression"
													},
													"queryTimeout": "02:00:00",
													"partitionOption": "None"
												},
												"sink": {
													"type": "ParquetSink",
													"storeSettings": {
														"type": "AzureBlobStorageWriteSettings"
													},
													"formatSettings": {
														"type": "ParquetWriteSettings"
													}
												},
												"enableStaging": false,
												"translator": {
													"type": "TabularTranslator",
													"typeConversion": true,
													"typeConversionSettings": {
														"allowDataTruncation": true,
														"treatBooleanAsNumber": false
													}
												}
											},
											"inputs": [
												{
													"referenceName": "DS_BIE_DATA_WAREHOUSE",
													"type": "DatasetReference",
													"parameters": {}
												}
											],
											"outputs": [
												{
													"referenceName": "DS_ADLS_Parquet_1",
													"type": "DatasetReference",
													"parameters": {
														"ContainerName": {
															"value": "@activity('Lkp_GetTableDetails').output.firstRow.TargetContainer",
															"type": "Expression"
														},
														"Path": {
															"value": "@activity('Lkp_GetTableDetails').output.firstRow.TargetPath",
															"type": "Expression"
														},
														"FileName": {
															"value": "@concat(activity('Lkp_GetTableDetails').output.firstRow.TargetFile,'_',formatDateTime(utcnow(),'yyyyMMdd'),'.',activity('Lkp_GetTableDetails').output.firstRow.FileFormat)",
															"type": "Expression"
														}
													}
												}
											]
										},
										{
											"name": "Sp_ExecSuccessAudit_BIEDATAWH",
											"type": "SqlServerStoredProcedure",
											"dependsOn": [
												{
													"activity": "Copy_BIE_DATA_WAREHOUSE_ADLS",
													"dependencyConditions": [
														"Succeeded"
													]
												}
											],
											"policy": {
												"timeout": "7.00:00:00",
												"retry": 0,
												"retryIntervalInSeconds": 30,
												"secureOutput": false,
												"secureInput": false
											},
											"userProperties": [],
											"typeProperties": {
												"storedProcedureName": "[dbo].[proc_UpdateAuditLog]",
												"storedProcedureParameters": {
													"AuditID": {
														"value": {
															"value": "@activity('lkp_ExecStartAuditProc').output.firstRow.AuditID",
															"type": "Expression"
														},
														"type": "Int32"
													},
													"DataLakePath": {
														"value": {
															"value": "@concat(activity('Lkp_GetTableDetails').output.firstRow.TargetPath,'/',activity('Lkp_GetTableDetails').output.firstRow.TargetFile,'_',formatDateTime(utcnow(),'yyyyMMdd'),'.',activity('Lkp_GetTableDetails').output.firstRow.FileFormat)",
															"type": "Expression"
														},
														"type": "String"
													},
													"RowsRead": {
														"value": {
															"value": "@activity('Copy_BIE_DATA_WAREHOUSE_ADLS').output.RowsRead",
															"type": "Expression"
														},
														"type": "Int64"
													},
													"Status": {
														"value": "Success",
														"type": "String"
													},
													"PipelineRunID": {
														"value": {
															"value": "@pipeline().RunId",
															"type": "Expression"
														},
														"type": "String"
													}
												}
											},
											"linkedServiceName": {
												"referenceName": "AzureSqlDatabase1",
												"type": "LinkedServiceReference"
											}
										},
										{
											"name": "Sp_ExecFailureAudit_BIEDATAWH",
											"type": "SqlServerStoredProcedure",
											"dependsOn": [
												{
													"activity": "Copy_BIE_DATA_WAREHOUSE_ADLS",
													"dependencyConditions": [
														"Failed"
													]
												}
											],
											"policy": {
												"timeout": "7.00:00:00",
												"retry": 0,
												"retryIntervalInSeconds": 30,
												"secureOutput": false,
												"secureInput": false
											},
											"userProperties": [],
											"typeProperties": {
												"storedProcedureName": "[dbo].[proc_UpdateAuditLog]",
												"storedProcedureParameters": {
													"AuditID": {
														"value": {
															"value": "@activity('lkp_ExecStartAuditProc').output.firstRow.AuditID",
															"type": "Expression"
														},
														"type": "Int32"
													},
													"DataLakePath": {
														"value": null,
														"type": "String"
													},
													"RowsRead": {
														"value": null,
														"type": "Int64"
													},
													"Status": {
														"value": "Failed",
														"type": "String"
													},
													"PipelineRunID": {
														"value": {
															"value": "@pipeline().RunId",
															"type": "Expression"
														},
														"type": "String"
													}
												}
											},
											"linkedServiceName": {
												"referenceName": "AzureSqlDatabase1",
												"type": "LinkedServiceReference"
											}
										}
									]
								}
							]
						}
					},
					{
						"name": "lkp_ExecStartAuditProc",
						"type": "Lookup",
						"dependsOn": [],
						"policy": {
							"timeout": "7.00:00:00",
							"retry": 0,
							"retryIntervalInSeconds": 30,
							"secureOutput": false,
							"secureInput": false
						},
						"userProperties": [],
						"typeProperties": {
							"source": {
								"type": "AzureSqlSource",
								"sqlReaderStoredProcedureName": "[dbo].[proc_StartAuditLog]",
								"storedProcedureParameters": {
									"ConfigTableID": {
										"type": "Int32",
										"value": {
											"value": "@pipeline().parameters.IDValue",
											"type": "Expression"
										}
									},
									"DataFactoryName": {
										"type": "String",
										"value": {
											"value": "@pipeline().DataFactory",
											"type": "Expression"
										}
									},
									"ParentAuditID": {
										"type": "Int64",
										"value": {
											"value": "@pipeline().parameters.ParentAuditID",
											"type": "Expression"
										}
									},
									"PipelineName": {
										"type": "String",
										"value": {
											"value": "@pipeline().Pipeline",
											"type": "Expression"
										}
									},
									"PipelineRunID": {
										"type": "String",
										"value": {
											"value": "@pipeline().RunId",
											"type": "Expression"
										}
									},
									"PipelineTriggerID": {
										"type": "String",
										"value": {
											"value": "@pipeline().TriggerId",
											"type": "Expression"
										}
									},
									"PipelineTriggerName": {
										"type": "String",
										"value": {
											"value": "@pipeline().TriggerName",
											"type": "Expression"
										}
									},
									"PipelineTriggerType": {
										"type": "String",
										"value": {
											"value": "@pipeline().TriggerType",
											"type": "Expression"
										}
									}
								},
								"queryTimeout": "02:00:00",
								"partitionOption": "None"
							},
							"dataset": {
								"referenceName": "Briggs_MDW",
								"type": "DatasetReference",
								"parameters": {
									"schema_name": "dbo",
									"table_name": "user"
								}
							}
						}
					},
					{
						"name": "Sp_ExecUpdateAudit",
						"type": "SqlServerStoredProcedure",
						"dependsOn": [
							{
								"activity": "Lkp_GetTableDetails",
								"dependencyConditions": [
									"Succeeded"
								]
							}
						],
						"policy": {
							"timeout": "7.00:00:00",
							"retry": 0,
							"retryIntervalInSeconds": 30,
							"secureOutput": false,
							"secureInput": false
						},
						"userProperties": [],
						"typeProperties": {
							"storedProcedureName": "[dbo].[proc_UpdateAuditLog]",
							"storedProcedureParameters": {
								"AuditID": {
									"value": {
										"value": "@activity('lkp_ExecStartAuditProc').output.firstRow.AuditID",
										"type": "Expression"
									},
									"type": "Int32"
								},
								"DataLakePath": {
									"value": null,
									"type": "String"
								},
								"PipelineRunID": {
									"value": {
										"value": "@pipeline().RunId",
										"type": "Expression"
									},
									"type": "String"
								},
								"RowsRead": {
									"value": null,
									"type": "Int64"
								},
								"Status": {
									"value": "Got MetaData",
									"type": "String"
								}
							}
						},
						"linkedServiceName": {
							"referenceName": "AzureSqlDatabase1",
							"type": "LinkedServiceReference"
						}
					}
				],
				"policy": {
					"elapsedTimeMetric": {},
					"cancelAfter": {}
				},
				"parameters": {
					"IDValue": {
						"type": "int"
					},
					"ParentAuditID": {
						"type": "int"
					}
				},
				"folder": {
					"name": "MDP POR DataLoad"
				},
				"annotations": [],
				"lastPublishTime": "2022-03-29T09:52:06Z"
			},
			"dependsOn": [
				"[concat(variables('workspaceId'), '/datasets/Briggs_MDW')]",
				"[concat(variables('workspaceId'), '/linkedServices/AzureSqlDatabase1')]",
				"[concat(variables('workspaceId'), '/datasets/DS_POR')]",
				"[concat(variables('workspaceId'), '/datasets/DS_ADLS_Parquet_1')]",
				"[concat(variables('workspaceId'), '/datasets/DS_BriggsHR')]",
				"[concat(variables('workspaceId'), '/datasets/DS_BriggsAX')]",
				"[concat(variables('workspaceId'), '/datasets/DS_Briggs_MST')]",
				"[concat(variables('workspaceId'), '/datasets/DS_BIE_DATA_WAREHOUSE')]"
			]
		},
		{
			"name": "[concat(parameters('workspaceName'), '/PL_Generic_Copy_AP')]",
			"type": "Microsoft.Synapse/workspaces/pipelines",
			"apiVersion": "2019-06-01-preview",
			"properties": {
				"activities": [
					{
						"name": "Lookup1_Incremental",
						"type": "Lookup",
						"dependsOn": [
							{
								"activity": "lkp_ExecStartAuditProc",
								"dependencyConditions": [
									"Succeeded"
								]
							}
						],
						"policy": {
							"timeout": "7.00:00:00",
							"retry": 0,
							"retryIntervalInSeconds": 30,
							"secureOutput": false,
							"secureInput": false
						},
						"userProperties": [],
						"typeProperties": {
							"source": {
								"type": "AzureSqlSource",
								"sqlReaderQuery": "Select Distinct ID ID_Inc,sourcedb,sourcetablename From dbo.control_table Where ProcessName = 'AzSQL_ADLS'  \nAND DataLoadType = 'Incremental'  and EnableAction = 1  \nand (format(refresh_date,'dd-MM-yyyy') <> format(getdate(),'dd-MM-yyyy') or refresh_date is null)\nand subjectarea like '%Sales AP%' and id <> 253 \norder by 1 ",
								"queryTimeout": "02:00:00",
								"partitionOption": "None"
							},
							"dataset": {
								"referenceName": "Briggs_MDW",
								"type": "DatasetReference",
								"parameters": {
									"schema_name": "dbo",
									"table_name": "user"
								}
							},
							"firstRowOnly": false
						}
					},
					{
						"name": "Lookup2_Full",
						"type": "Lookup",
						"dependsOn": [
							{
								"activity": "lkp_ExecStartAuditProc",
								"dependencyConditions": [
									"Succeeded"
								]
							}
						],
						"policy": {
							"timeout": "7.00:00:00",
							"retry": 0,
							"retryIntervalInSeconds": 30,
							"secureOutput": false,
							"secureInput": false
						},
						"userProperties": [],
						"typeProperties": {
							"source": {
								"type": "AzureSqlSource",
								"sqlReaderQuery": "Select Distinct ID ID_Full,sourcedb,sourcetablename From dbo.control_table Where ProcessName = 'AzSQL_ADLS'  \nAND DataLoadType = 'Full'  and EnableAction = 1 \nand (format(refresh_date,'dd-MM-yyyy') <> format(getdate(),'dd-MM-yyyy') or refresh_date is null)\nand subjectarea like '%Sales AP%' \norder by 1 ",
								"queryTimeout": "02:00:00",
								"partitionOption": "None"
							},
							"dataset": {
								"referenceName": "Briggs_MDW",
								"type": "DatasetReference",
								"parameters": {
									"schema_name": "dbo",
									"table_name": "user"
								}
							},
							"firstRowOnly": false
						}
					},
					{
						"name": "ForEach_Incremental_Load",
						"type": "ForEach",
						"dependsOn": [
							{
								"activity": "Lookup1_Incremental",
								"dependencyConditions": [
									"Succeeded"
								]
							}
						],
						"userProperties": [],
						"typeProperties": {
							"items": {
								"value": "@activity('Lookup1_Incremental').output.value",
								"type": "Expression"
							},
							"activities": [
								{
									"name": "Lookup_Incremental",
									"type": "Lookup",
									"dependsOn": [],
									"policy": {
										"timeout": "7.00:00:00",
										"retry": 0,
										"retryIntervalInSeconds": 30,
										"secureOutput": false,
										"secureInput": false
									},
									"userProperties": [],
									"typeProperties": {
										"source": {
											"type": "AzureSqlSource",
											"sqlReaderQuery": {
												"value": "@concat('select SourceQuery=''select '' +columnList+ '' from ''+ sourceDB+''.''+SourceSchemaName+''.''+SourcetableName + '' where \ncast(''+DateField+'' as date) >=''''''+LastDate+''''''''\n,SourceDB\n,TargetContainer\n, TargetPath, TargetFile, FileFormat,DateField,LastDate,targetstagetableschema,targetstagetablename\nfrom dbo.control_table\nwhere ID= ',item().ID_Inc)",
												"type": "Expression"
											},
											"queryTimeout": "02:00:00",
											"partitionOption": "None"
										},
										"dataset": {
											"referenceName": "Briggs_MDW",
											"type": "DatasetReference",
											"parameters": {
												"schema_name": "dbo",
												"table_name": "user"
											}
										}
									}
								},
								{
									"name": "Copy_Briggs_Inc_ADLS",
									"type": "Copy",
									"dependsOn": [
										{
											"activity": "Start_Table_Audit1",
											"dependencyConditions": [
												"Succeeded"
											]
										}
									],
									"policy": {
										"timeout": "7.00:00:00",
										"retry": 0,
										"retryIntervalInSeconds": 30,
										"secureOutput": false,
										"secureInput": false
									},
									"userProperties": [],
									"typeProperties": {
										"source": {
											"type": "SqlServerSource",
											"sqlReaderQuery": {
												"value": "@activity('Lookup_Incremental').output.firstRow.SourceQuery\n",
												"type": "Expression"
											},
											"queryTimeout": "02:00:00",
											"partitionOption": "None"
										},
										"sink": {
											"type": "AzureSqlSink",
											"preCopyScript": {
												"value": "@{concat('delete from ',activity('Lookup_Incremental').output.firstRow.TargetStageTableSchema,'.',activity('Lookup_Incremental').output.firstRow.targetstagetablename,' where cast(',activity('Lookup_Incremental').output.firstRow.DateField,' as date)=','''',activity('Lookup_Incremental').output.firstRow.LastDate,'''')}",
												"type": "Expression"
											},
											"disableMetricsCollection": false
										},
										"enableStaging": false,
										"translator": {
											"type": "TabularTranslator",
											"typeConversion": true,
											"typeConversionSettings": {
												"allowDataTruncation": true,
												"treatBooleanAsNumber": false
											}
										}
									},
									"inputs": [
										{
											"referenceName": "DS_Briggs_MST",
											"type": "DatasetReference",
											"parameters": {}
										}
									],
									"outputs": [
										{
											"referenceName": "Briggs_MDW",
											"type": "DatasetReference",
											"parameters": {
												"schema_name": {
													"value": "@activity('Lookup_Incremental').output.firstRow.TargetStageTableSchema",
													"type": "Expression"
												},
												"table_name": {
													"value": "@activity('Lookup_Incremental').output.firstRow.TargetStageTableName",
													"type": "Expression"
												}
											}
										}
									]
								},
								{
									"name": "Copy_Briggs_Inc_ADLS_New",
									"type": "Copy",
									"dependsOn": [
										{
											"activity": "Copy_Briggs_Inc_ADLS",
											"dependencyConditions": [
												"Failed"
											]
										}
									],
									"policy": {
										"timeout": "7.00:00:00",
										"retry": 0,
										"retryIntervalInSeconds": 30,
										"secureOutput": false,
										"secureInput": false
									},
									"userProperties": [],
									"typeProperties": {
										"source": {
											"type": "SqlServerSource",
											"sqlReaderQuery": {
												"value": "@activity('Lookup_Incremental').output.firstRow.SourceQuery\n",
												"type": "Expression"
											},
											"queryTimeout": "02:00:00",
											"partitionOption": "None"
										},
										"sink": {
											"type": "AzureSqlSink",
											"writeBehavior": "insert",
											"sqlWriterUseTableLock": false,
											"tableOption": "autoCreate",
											"disableMetricsCollection": false
										},
										"enableStaging": false,
										"translator": {
											"type": "TabularTranslator",
											"typeConversion": true,
											"typeConversionSettings": {
												"allowDataTruncation": true,
												"treatBooleanAsNumber": false
											}
										}
									},
									"inputs": [
										{
											"referenceName": "DS_Briggs_MST",
											"type": "DatasetReference",
											"parameters": {}
										}
									],
									"outputs": [
										{
											"referenceName": "Briggs_MDW",
											"type": "DatasetReference",
											"parameters": {
												"schema_name": {
													"value": "@activity('Lookup_Incremental').output.firstRow.TargetStageTableSchema",
													"type": "Expression"
												},
												"table_name": {
													"value": "@activity('Lookup_Incremental').output.firstRow.TargetStageTableName",
													"type": "Expression"
												}
											}
										}
									]
								},
								{
									"name": "Start_Table_Audit1",
									"type": "Lookup",
									"dependsOn": [
										{
											"activity": "Lookup_Incremental",
											"dependencyConditions": [
												"Succeeded"
											]
										}
									],
									"policy": {
										"timeout": "7.00:00:00",
										"retry": 0,
										"retryIntervalInSeconds": 30,
										"secureOutput": false,
										"secureInput": false
									},
									"userProperties": [],
									"typeProperties": {
										"source": {
											"type": "AzureSqlSource",
											"sqlReaderStoredProcedureName": "[dbo].[proc_StartAuditLog_Briggs]",
											"storedProcedureParameters": {
												"ConfigTableID": {
													"type": "Int32",
													"value": {
														"value": "@item().ID_Inc",
														"type": "Expression"
													}
												},
												"DataFactoryName": {
													"type": "String",
													"value": {
														"value": "@pipeline().DataFactory",
														"type": "Expression"
													}
												},
												"ParentAuditID": {
													"type": "Int64",
													"value": {
														"value": "@item().ID_Inc",
														"type": "Expression"
													}
												},
												"PipelineName": {
													"type": "String",
													"value": {
														"value": "@pipeline().Pipeline",
														"type": "Expression"
													}
												},
												"PipelineRunID": {
													"type": "String",
													"value": {
														"value": "@pipeline().RunId",
														"type": "Expression"
													}
												},
												"PipelineTriggerID": {
													"type": "String",
													"value": {
														"value": "@pipeline().TriggerId",
														"type": "Expression"
													}
												},
												"PipelineTriggerName": {
													"type": "String",
													"value": {
														"value": "@pipeline().TriggerName",
														"type": "Expression"
													}
												},
												"PipelineTriggerType": {
													"type": "String",
													"value": {
														"value": "@pipeline().TriggerType",
														"type": "Expression"
													}
												},
												"Sourcedb": {
													"type": "String",
													"value": {
														"value": "@item().sourceDB",
														"type": "Expression"
													}
												},
												"sourcetable": {
													"type": "String",
													"value": {
														"value": "@item().SourcetableName",
														"type": "Expression"
													}
												}
											},
											"queryTimeout": "02:00:00",
											"partitionOption": "None"
										},
										"dataset": {
											"referenceName": "Briggs_MDW",
											"type": "DatasetReference",
											"parameters": {
												"schema_name": "dbo",
												"table_name": "user"
											}
										},
										"firstRowOnly": false
									}
								},
								{
									"name": "Success_Audit_Log1",
									"type": "SqlServerStoredProcedure",
									"dependsOn": [
										{
											"activity": "Copy_Briggs_Inc_ADLS",
											"dependencyConditions": [
												"Succeeded"
											]
										}
									],
									"policy": {
										"timeout": "7.00:00:00",
										"retry": 0,
										"retryIntervalInSeconds": 30,
										"secureOutput": false,
										"secureInput": false
									},
									"userProperties": [],
									"typeProperties": {
										"storedProcedureName": "[dbo].[proc_UpdateAuditLog_Briggs]",
										"storedProcedureParameters": {
											"ConfigTableID": {
												"value": {
													"value": "@item().ID_Inc",
													"type": "Expression"
												},
												"type": "Int32"
											},
											"RowsRead": {
												"value": {
													"value": "@activity('Copy_Briggs_Inc_ADLS').output.RowsRead",
													"type": "Expression"
												},
												"type": "Int64"
											},
											"Status": {
												"value": "Success",
												"type": "String"
											}
										}
									},
									"linkedServiceName": {
										"referenceName": "DS_MDW_SP",
										"type": "LinkedServiceReference"
									}
								},
								{
									"name": "Success_Audit_Log2",
									"type": "SqlServerStoredProcedure",
									"dependsOn": [
										{
											"activity": "Copy_Briggs_Inc_ADLS_New",
											"dependencyConditions": [
												"Succeeded"
											]
										}
									],
									"policy": {
										"timeout": "7.00:00:00",
										"retry": 0,
										"retryIntervalInSeconds": 30,
										"secureOutput": false,
										"secureInput": false
									},
									"userProperties": [],
									"typeProperties": {
										"storedProcedureName": "[dbo].[proc_UpdateAuditLog_Briggs]",
										"storedProcedureParameters": {
											"ConfigTableID": {
												"value": {
													"value": "@item().ID_Inc",
													"type": "Expression"
												},
												"type": "Int32"
											},
											"RowsRead": {
												"value": {
													"value": "@activity('Copy_Briggs_Inc_ADLS_New').output.RowsRead",
													"type": "Expression"
												},
												"type": "Int64"
											},
											"Status": {
												"value": "Success",
												"type": "String"
											}
										}
									},
									"linkedServiceName": {
										"referenceName": "DS_MDW_SP",
										"type": "LinkedServiceReference"
									}
								},
								{
									"name": "Failure_Audit_Log2",
									"type": "SqlServerStoredProcedure",
									"dependsOn": [
										{
											"activity": "Set variable1",
											"dependencyConditions": [
												"Succeeded"
											]
										}
									],
									"policy": {
										"timeout": "7.00:00:00",
										"retry": 0,
										"retryIntervalInSeconds": 30,
										"secureOutput": false,
										"secureInput": false
									},
									"userProperties": [],
									"typeProperties": {
										"storedProcedureName": "[dbo].[proc_UpdateAuditLog_Briggs]",
										"storedProcedureParameters": {
											"ConfigTableID": {
												"value": {
													"value": "@item().ID_Inc",
													"type": "Expression"
												},
												"type": "Int32"
											},
											"RowsRead": {
												"value": null,
												"type": "Int64"
											},
											"Status": {
												"value": {
													"value": "@variables('ErrorMsgInc')",
													"type": "Expression"
												},
												"type": "String"
											}
										}
									},
									"linkedServiceName": {
										"referenceName": "DS_MDW_SP",
										"type": "LinkedServiceReference"
									}
								},
								{
									"name": "Set variable1",
									"type": "SetVariable",
									"dependsOn": [
										{
											"activity": "Copy_Briggs_Inc_ADLS_New",
											"dependencyConditions": [
												"Failed"
											]
										},
										{
											"activity": "Copy_Briggs_Inc_ADLS",
											"dependencyConditions": [
												"Failed"
											]
										}
									],
									"userProperties": [],
									"typeProperties": {
										"variableName": "ErrorMsgInc",
										"value": {
											"value": "@activity('Copy_Briggs_Inc_ADLS').Error.Message",
											"type": "Expression"
										}
									}
								}
							]
						}
					},
					{
						"name": "ForEach_Full_Load",
						"type": "ForEach",
						"dependsOn": [
							{
								"activity": "Lookup2_Full",
								"dependencyConditions": [
									"Succeeded"
								]
							}
						],
						"userProperties": [],
						"typeProperties": {
							"items": {
								"value": "@activity('Lookup2_Full').output.value",
								"type": "Expression"
							},
							"activities": [
								{
									"name": "Lookup_Full",
									"type": "Lookup",
									"dependsOn": [],
									"policy": {
										"timeout": "7.00:00:00",
										"retry": 0,
										"retryIntervalInSeconds": 30,
										"secureOutput": false,
										"secureInput": false
									},
									"userProperties": [],
									"typeProperties": {
										"source": {
											"type": "AzureSqlSource",
											"sqlReaderQuery": {
												"value": "@concat('select SourceQuery=''select '' +columnList+ '' from ''+ sourceDB+''.''+SourceSchemaName+''.''+SourcetableName\n,SourceDB\n,TargetContainer\n, TargetPath, TargetFile, FileFormat,DateField,LastDate,targetstagetableschema,targetstagetablename\nfrom dbo.control_table\nwhere ID= ',item().ID_Full)",
												"type": "Expression"
											},
											"queryTimeout": "02:00:00",
											"partitionOption": "None"
										},
										"dataset": {
											"referenceName": "Briggs_MDW",
											"type": "DatasetReference",
											"parameters": {
												"schema_name": "dbo",
												"table_name": "user"
											}
										}
									}
								},
								{
									"name": "Copy_Briggs_Full_ADLS",
									"type": "Copy",
									"dependsOn": [
										{
											"activity": "Start_Table_Audit",
											"dependencyConditions": [
												"Succeeded"
											]
										}
									],
									"policy": {
										"timeout": "7.00:00:00",
										"retry": 0,
										"retryIntervalInSeconds": 30,
										"secureOutput": false,
										"secureInput": false
									},
									"userProperties": [],
									"typeProperties": {
										"source": {
											"type": "SqlServerSource",
											"sqlReaderQuery": {
												"value": "@activity('Lookup_Full').output.firstRow.SourceQuery\n",
												"type": "Expression"
											},
											"queryTimeout": "02:00:00",
											"partitionOption": "None"
										},
										"sink": {
											"type": "AzureSqlSink",
											"preCopyScript": {
												"value": "@{concat('truncate table ',activity('Lookup_Full').output.firstRow.TargetStageTableSchema,'.',activity('Lookup_Full').output.firstRow.TargetStageTableName)}",
												"type": "Expression"
											},
											"disableMetricsCollection": false
										},
										"enableStaging": false,
										"translator": {
											"type": "TabularTranslator",
											"typeConversion": true,
											"typeConversionSettings": {
												"allowDataTruncation": true,
												"treatBooleanAsNumber": false
											}
										}
									},
									"inputs": [
										{
											"referenceName": "DS_Briggs_MST",
											"type": "DatasetReference",
											"parameters": {}
										}
									],
									"outputs": [
										{
											"referenceName": "Briggs_MDW",
											"type": "DatasetReference",
											"parameters": {
												"schema_name": {
													"value": "@activity('Lookup_Full').output.firstRow.TargetStageTableSchema",
													"type": "Expression"
												},
												"table_name": {
													"value": "@activity('Lookup_Full').output.firstRow.TargetStageTableName",
													"type": "Expression"
												}
											}
										}
									]
								},
								{
									"name": "Copy_Briggs_Full_ADLS_New",
									"type": "Copy",
									"dependsOn": [
										{
											"activity": "Copy_Briggs_Full_ADLS",
											"dependencyConditions": [
												"Failed"
											]
										}
									],
									"policy": {
										"timeout": "7.00:00:00",
										"retry": 0,
										"retryIntervalInSeconds": 30,
										"secureOutput": false,
										"secureInput": false
									},
									"userProperties": [],
									"typeProperties": {
										"source": {
											"type": "SqlServerSource",
											"sqlReaderQuery": {
												"value": "@activity('Lookup_Full').output.firstRow.SourceQuery\n",
												"type": "Expression"
											},
											"queryTimeout": "02:00:00",
											"partitionOption": "None"
										},
										"sink": {
											"type": "AzureSqlSink",
											"writeBehavior": "insert",
											"sqlWriterUseTableLock": false,
											"tableOption": "autoCreate",
											"disableMetricsCollection": false
										},
										"enableStaging": false,
										"translator": {
											"type": "TabularTranslator",
											"typeConversion": true,
											"typeConversionSettings": {
												"allowDataTruncation": true,
												"treatBooleanAsNumber": false
											}
										}
									},
									"inputs": [
										{
											"referenceName": "DS_Briggs_MST",
											"type": "DatasetReference",
											"parameters": {}
										}
									],
									"outputs": [
										{
											"referenceName": "Briggs_MDW",
											"type": "DatasetReference",
											"parameters": {
												"schema_name": {
													"value": "@activity('Lookup_Full').output.firstRow.TargetStageTableSchema",
													"type": "Expression"
												},
												"table_name": {
													"value": "@activity('Lookup_Full').output.firstRow.TargetStageTableName",
													"type": "Expression"
												}
											}
										}
									]
								},
								{
									"name": "Start_Table_Audit",
									"type": "Lookup",
									"dependsOn": [
										{
											"activity": "Lookup_Full",
											"dependencyConditions": [
												"Succeeded"
											]
										}
									],
									"policy": {
										"timeout": "7.00:00:00",
										"retry": 0,
										"retryIntervalInSeconds": 30,
										"secureOutput": false,
										"secureInput": false
									},
									"userProperties": [],
									"typeProperties": {
										"source": {
											"type": "AzureSqlSource",
											"sqlReaderStoredProcedureName": "[dbo].[proc_StartAuditLog_Briggs]",
											"storedProcedureParameters": {
												"ConfigTableID": {
													"type": "Int32",
													"value": {
														"value": "@item().ID_Full",
														"type": "Expression"
													}
												},
												"DataFactoryName": {
													"type": "String",
													"value": {
														"value": "@pipeline().DataFactory",
														"type": "Expression"
													}
												},
												"ParentAuditID": {
													"type": "Int64",
													"value": {
														"value": "@item().ID_Full",
														"type": "Expression"
													}
												},
												"PipelineName": {
													"type": "String",
													"value": {
														"value": "@pipeline().Pipeline",
														"type": "Expression"
													}
												},
												"PipelineRunID": {
													"type": "String",
													"value": {
														"value": "@pipeline().RunId",
														"type": "Expression"
													}
												},
												"PipelineTriggerID": {
													"type": "String",
													"value": {
														"value": "@pipeline().TriggerId",
														"type": "Expression"
													}
												},
												"PipelineTriggerName": {
													"type": "String",
													"value": {
														"value": "@pipeline().TriggerName",
														"type": "Expression"
													}
												},
												"PipelineTriggerType": {
													"type": "String",
													"value": {
														"value": "@pipeline().TriggerType",
														"type": "Expression"
													}
												},
												"Sourcedb": {
													"type": "String",
													"value": {
														"value": "@item().sourceDB",
														"type": "Expression"
													}
												},
												"sourcetable": {
													"type": "String",
													"value": {
														"value": "@item().SourcetableName",
														"type": "Expression"
													}
												}
											},
											"queryTimeout": "02:00:00",
											"partitionOption": "None"
										},
										"dataset": {
											"referenceName": "Briggs_MDW",
											"type": "DatasetReference",
											"parameters": {
												"schema_name": "dbo",
												"table_name": "user"
											}
										},
										"firstRowOnly": false
									}
								},
								{
									"name": "Success_Audit_Log",
									"type": "SqlServerStoredProcedure",
									"dependsOn": [
										{
											"activity": "Copy_Briggs_Full_ADLS",
											"dependencyConditions": [
												"Succeeded"
											]
										}
									],
									"policy": {
										"timeout": "7.00:00:00",
										"retry": 0,
										"retryIntervalInSeconds": 30,
										"secureOutput": false,
										"secureInput": false
									},
									"userProperties": [],
									"typeProperties": {
										"storedProcedureName": "[dbo].[proc_UpdateAuditLog_Briggs]",
										"storedProcedureParameters": {
											"ConfigTableID": {
												"value": {
													"value": "@item().ID_Full",
													"type": "Expression"
												},
												"type": "Int32"
											},
											"RowsRead": {
												"value": {
													"value": "@activity('Copy_Briggs_Full_ADLS').output.RowsRead",
													"type": "Expression"
												},
												"type": "Int64"
											},
											"Status": {
												"value": "Success",
												"type": "String"
											}
										}
									},
									"linkedServiceName": {
										"referenceName": "DS_MDW_SP",
										"type": "LinkedServiceReference"
									}
								},
								{
									"name": "Success_Audit_Log_New",
									"type": "SqlServerStoredProcedure",
									"dependsOn": [
										{
											"activity": "Copy_Briggs_Full_ADLS_New",
											"dependencyConditions": [
												"Succeeded"
											]
										}
									],
									"policy": {
										"timeout": "7.00:00:00",
										"retry": 0,
										"retryIntervalInSeconds": 30,
										"secureOutput": false,
										"secureInput": false
									},
									"userProperties": [],
									"typeProperties": {
										"storedProcedureName": "[dbo].[proc_UpdateAuditLog_Briggs]",
										"storedProcedureParameters": {
											"ConfigTableID": {
												"value": {
													"value": "@item().ID_Full",
													"type": "Expression"
												},
												"type": "Int32"
											},
											"RowsRead": {
												"value": {
													"value": "@activity('Copy_Briggs_Full_ADLS_New').output.RowsRead",
													"type": "Expression"
												},
												"type": "Int64"
											},
											"Status": {
												"value": "Success",
												"type": "String"
											}
										}
									},
									"linkedServiceName": {
										"referenceName": "DS_MDW_SP",
										"type": "LinkedServiceReference"
									}
								},
								{
									"name": "Failure_Audit_Log_New",
									"type": "SqlServerStoredProcedure",
									"dependsOn": [
										{
											"activity": "Set variable2",
											"dependencyConditions": [
												"Succeeded"
											]
										}
									],
									"policy": {
										"timeout": "7.00:00:00",
										"retry": 0,
										"retryIntervalInSeconds": 30,
										"secureOutput": false,
										"secureInput": false
									},
									"userProperties": [],
									"typeProperties": {
										"storedProcedureName": "[dbo].[proc_UpdateAuditLog_Briggs]",
										"storedProcedureParameters": {
											"ConfigTableID": {
												"value": {
													"value": "@item().ID_Full",
													"type": "Expression"
												},
												"type": "Int32"
											},
											"RowsRead": {
												"value": null,
												"type": "Int64"
											},
											"Status": {
												"value": {
													"value": "@variables('ErrorMsgFull')",
													"type": "Expression"
												},
												"type": "String"
											}
										}
									},
									"linkedServiceName": {
										"referenceName": "DS_MDW_SP",
										"type": "LinkedServiceReference"
									}
								},
								{
									"name": "Set variable2",
									"type": "SetVariable",
									"dependsOn": [
										{
											"activity": "Copy_Briggs_Full_ADLS",
											"dependencyConditions": [
												"Failed"
											]
										},
										{
											"activity": "Copy_Briggs_Full_ADLS_New",
											"dependencyConditions": [
												"Failed"
											]
										}
									],
									"userProperties": [],
									"typeProperties": {
										"variableName": "ErrorMsgFull",
										"value": {
											"value": "@activity('Copy_Briggs_Full_ADLS').Error.Message",
											"type": "Expression"
										}
									}
								}
							]
						}
					},
					{
						"name": "ForEach_Proc_Incremental",
						"type": "ForEach",
						"dependsOn": [
							{
								"activity": "ForEach_Incremental_Load",
								"dependencyConditions": [
									"Succeeded"
								]
							}
						],
						"userProperties": [],
						"typeProperties": {
							"items": {
								"value": "@activity('Lookup1_Incremental').output.value",
								"type": "Expression"
							},
							"activities": [
								{
									"name": "Stored procedure1",
									"type": "SqlServerStoredProcedure",
									"dependsOn": [],
									"policy": {
										"timeout": "7.00:00:00",
										"retry": 0,
										"retryIntervalInSeconds": 30,
										"secureOutput": false,
										"secureInput": false
									},
									"userProperties": [],
									"typeProperties": {
										"storedProcedureName": "[dbo].[USP_Control_Table_LastDate]",
										"storedProcedureParameters": {
											"id_I_F": {
												"value": {
													"value": "@item().ID_Inc",
													"type": "Expression"
												},
												"type": "Int32"
											}
										}
									},
									"linkedServiceName": {
										"referenceName": "DS_MDW_SP",
										"type": "LinkedServiceReference"
									}
								}
							]
						}
					},
					{
						"name": "ForEach_Proc_Full",
						"type": "ForEach",
						"dependsOn": [
							{
								"activity": "ForEach_Full_Load",
								"dependencyConditions": [
									"Succeeded"
								]
							}
						],
						"userProperties": [],
						"typeProperties": {
							"items": {
								"value": "@activity('Lookup2_Full').output.value",
								"type": "Expression"
							},
							"activities": [
								{
									"name": "Stored procedure_Full",
									"type": "SqlServerStoredProcedure",
									"dependsOn": [],
									"policy": {
										"timeout": "7.00:00:00",
										"retry": 0,
										"retryIntervalInSeconds": 30,
										"secureOutput": false,
										"secureInput": false
									},
									"userProperties": [],
									"typeProperties": {
										"storedProcedureName": "[dbo].[USP_Control_Table_LastDate]",
										"storedProcedureParameters": {
											"id_I_F": {
												"value": {
													"value": "@item().ID_Full",
													"type": "Expression"
												},
												"type": "Int32"
											}
										}
									},
									"linkedServiceName": {
										"referenceName": "DS_MDW_SP",
										"type": "LinkedServiceReference"
									}
								}
							]
						}
					},
					{
						"name": "Sp_ExecFailureAudit_Full",
						"type": "SqlServerStoredProcedure",
						"dependsOn": [
							{
								"activity": "ForEach_Full_Load",
								"dependencyConditions": [
									"Failed"
								]
							}
						],
						"policy": {
							"timeout": "7.00:00:00",
							"retry": 0,
							"retryIntervalInSeconds": 30,
							"secureOutput": false,
							"secureInput": false
						},
						"userProperties": [],
						"typeProperties": {
							"storedProcedureName": "[dbo].[proc_UpdateAuditLog]",
							"storedProcedureParameters": {
								"AuditID": {
									"value": {
										"value": "@activity('lkp_ExecStartAuditProc').output.firstRow.AuditID",
										"type": "Expression"
									},
									"type": "Int32"
								},
								"DataLakePath": {
									"value": null,
									"type": "String"
								},
								"PipelineRunID": {
									"value": {
										"value": "@pipeline().RunId",
										"type": "Expression"
									},
									"type": "String"
								},
								"RowsRead": {
									"value": null,
									"type": "Int64"
								},
								"Status": {
									"value": "Full Load Failed",
									"type": "String"
								}
							}
						},
						"linkedServiceName": {
							"referenceName": "AzureSqlDatabase1",
							"type": "LinkedServiceReference"
						}
					},
					{
						"name": "Sp_ExecSuccessAudit",
						"type": "SqlServerStoredProcedure",
						"dependsOn": [
							{
								"activity": "ForEach_Proc_Incremental",
								"dependencyConditions": [
									"Succeeded"
								]
							},
							{
								"activity": "ForEach_Proc_Full",
								"dependencyConditions": [
									"Succeeded"
								]
							}
						],
						"policy": {
							"timeout": "7.00:00:00",
							"retry": 0,
							"retryIntervalInSeconds": 30,
							"secureOutput": false,
							"secureInput": false
						},
						"userProperties": [],
						"typeProperties": {
							"storedProcedureName": "[dbo].[proc_UpdateAuditLog]",
							"storedProcedureParameters": {
								"AuditID": {
									"value": {
										"value": "@activity('lkp_ExecStartAuditProc').output.firstRow.AuditID",
										"type": "Expression"
									},
									"type": "Int32"
								},
								"DataLakePath": {
									"value": null,
									"type": "String"
								},
								"RowsRead": {
									"value": null,
									"type": "Int64"
								},
								"Status": {
									"value": "Success",
									"type": "String"
								},
								"PipelineRunID": {
									"value": {
										"value": "@pipeline().RunId",
										"type": "Expression"
									},
									"type": "String"
								}
							}
						},
						"linkedServiceName": {
							"referenceName": "AzureSqlDatabase1",
							"type": "LinkedServiceReference"
						}
					},
					{
						"name": "Sp_ExecFailureAudit_Inc",
						"type": "SqlServerStoredProcedure",
						"dependsOn": [
							{
								"activity": "ForEach_Incremental_Load",
								"dependencyConditions": [
									"Failed"
								]
							}
						],
						"policy": {
							"timeout": "7.00:00:00",
							"retry": 0,
							"retryIntervalInSeconds": 30,
							"secureOutput": false,
							"secureInput": false
						},
						"userProperties": [],
						"typeProperties": {
							"storedProcedureName": "[dbo].[proc_UpdateAuditLog]",
							"storedProcedureParameters": {
								"AuditID": {
									"value": {
										"value": "@activity('lkp_ExecStartAuditProc').output.firstRow.AuditID",
										"type": "Expression"
									},
									"type": "Int32"
								},
								"DataLakePath": {
									"value": null,
									"type": "String"
								},
								"PipelineRunID": {
									"value": {
										"value": "@pipeline().RunId",
										"type": "Expression"
									},
									"type": "String"
								},
								"RowsRead": {
									"value": null,
									"type": "Int64"
								},
								"Status": {
									"value": "Incr Load Failed",
									"type": "String"
								}
							}
						},
						"linkedServiceName": {
							"referenceName": "AzureSqlDatabase1",
							"type": "LinkedServiceReference"
						}
					},
					{
						"name": "lkp_ExecStartAuditProc",
						"type": "Lookup",
						"dependsOn": [],
						"policy": {
							"timeout": "7.00:00:00",
							"retry": 0,
							"retryIntervalInSeconds": 30,
							"secureOutput": false,
							"secureInput": false
						},
						"userProperties": [],
						"typeProperties": {
							"source": {
								"type": "AzureSqlSource",
								"sqlReaderStoredProcedureName": "[dbo].[proc_StartAuditLog]",
								"storedProcedureParameters": {
									"ConfigTableID": {
										"type": "Int32",
										"value": "-1"
									},
									"DataFactoryName": {
										"type": "String",
										"value": {
											"value": "@pipeline().DataFactory",
											"type": "Expression"
										}
									},
									"ParentAuditID": {
										"type": "Int64",
										"value": "-1"
									},
									"PipelineName": {
										"type": "String",
										"value": {
											"value": "@concat(pipeline().Pipeline,' AP Source Table Load')",
											"type": "Expression"
										}
									},
									"PipelineRunID": {
										"type": "String",
										"value": {
											"value": "@pipeline().RunId",
											"type": "Expression"
										}
									},
									"PipelineTriggerID": {
										"type": "String",
										"value": {
											"value": "@pipeline().TriggerId",
											"type": "Expression"
										}
									},
									"PipelineTriggerName": {
										"type": "String",
										"value": {
											"value": "@pipeline().TriggerName",
											"type": "Expression"
										}
									},
									"PipelineTriggerType": {
										"type": "String",
										"value": {
											"value": "@pipeline().TriggerType",
											"type": "Expression"
										}
									}
								},
								"queryTimeout": "02:00:00",
								"partitionOption": "None"
							},
							"dataset": {
								"referenceName": "Briggs_MDW",
								"type": "DatasetReference",
								"parameters": {
									"schema_name": "dbo",
									"table_name": "user"
								}
							}
						}
					}
				],
				"policy": {
					"elapsedTimeMetric": {},
					"cancelAfter": {}
				},
				"variables": {
					"ErrorMsgInc": {
						"type": "String"
					},
					"ErrorMsgFull": {
						"type": "String"
					}
				},
				"folder": {
					"name": "Briggs Data Load Theme wise"
				},
				"annotations": [],
				"lastPublishTime": "2022-04-26T06:09:33Z"
			},
			"dependsOn": [
				"[concat(variables('workspaceId'), '/datasets/Briggs_MDW')]",
				"[concat(variables('workspaceId'), '/linkedServices/AzureSqlDatabase1')]",
				"[concat(variables('workspaceId'), '/datasets/DS_Briggs_MST')]",
				"[concat(variables('workspaceId'), '/linkedServices/DS_MDW_SP')]"
			]
		},
		{
			"name": "[concat(parameters('workspaceName'), '/PL_Generic_Copy_AR')]",
			"type": "Microsoft.Synapse/workspaces/pipelines",
			"apiVersion": "2019-06-01-preview",
			"properties": {
				"activities": [
					{
						"name": "Lookup1_Incremental",
						"type": "Lookup",
						"dependsOn": [
							{
								"activity": "lkp_ExecStartAuditProc",
								"dependencyConditions": [
									"Succeeded"
								]
							}
						],
						"policy": {
							"timeout": "7.00:00:00",
							"retry": 0,
							"retryIntervalInSeconds": 30,
							"secureOutput": false,
							"secureInput": false
						},
						"userProperties": [],
						"typeProperties": {
							"source": {
								"type": "AzureSqlSource",
								"sqlReaderQuery": "Select Distinct ID ID_Inc,sourcedb,sourcetablename  From dbo.control_table Where ProcessName = 'AzSQL_ADLS'  \nAND DataLoadType = 'Incremental'  and EnableAction = 1  \nand subjectarea like '%Sales AR%' and id <> 253 \nand (format(refresh_date,'dd-MM-yyyy') <> format(getdate(),'dd-MM-yyyy') or refresh_date is null)\norder by 1 ",
								"queryTimeout": "02:00:00",
								"partitionOption": "None"
							},
							"dataset": {
								"referenceName": "Briggs_MDW",
								"type": "DatasetReference",
								"parameters": {
									"schema_name": "dbo",
									"table_name": "user"
								}
							},
							"firstRowOnly": false
						}
					},
					{
						"name": "Lookup2_Full",
						"type": "Lookup",
						"dependsOn": [
							{
								"activity": "lkp_ExecStartAuditProc",
								"dependencyConditions": [
									"Succeeded"
								]
							}
						],
						"policy": {
							"timeout": "7.00:00:00",
							"retry": 0,
							"retryIntervalInSeconds": 30,
							"secureOutput": false,
							"secureInput": false
						},
						"userProperties": [],
						"typeProperties": {
							"source": {
								"type": "AzureSqlSource",
								"sqlReaderQuery": "Select Distinct ID ID_Full,sourcedb,sourcetablename  From dbo.control_table Where ProcessName = 'AzSQL_ADLS'  \nAND DataLoadType = 'Full'  and EnableAction = 1 and subjectarea like '%Sales AR%' \nand (format(refresh_date,'dd-MM-yyyy') <> format(getdate(),'dd-MM-yyyy') or refresh_date is null)\norder by 1 ",
								"queryTimeout": "02:00:00",
								"partitionOption": "None"
							},
							"dataset": {
								"referenceName": "Briggs_MDW",
								"type": "DatasetReference",
								"parameters": {
									"schema_name": "dbo",
									"table_name": "user"
								}
							},
							"firstRowOnly": false
						}
					},
					{
						"name": "ForEach_Incremental_Load",
						"type": "ForEach",
						"dependsOn": [
							{
								"activity": "Lookup1_Incremental",
								"dependencyConditions": [
									"Succeeded"
								]
							}
						],
						"userProperties": [],
						"typeProperties": {
							"items": {
								"value": "@activity('Lookup1_Incremental').output.value",
								"type": "Expression"
							},
							"activities": [
								{
									"name": "Lookup_Incremental",
									"type": "Lookup",
									"dependsOn": [],
									"policy": {
										"timeout": "7.00:00:00",
										"retry": 0,
										"retryIntervalInSeconds": 30,
										"secureOutput": false,
										"secureInput": false
									},
									"userProperties": [],
									"typeProperties": {
										"source": {
											"type": "AzureSqlSource",
											"sqlReaderQuery": {
												"value": "@concat('select SourceQuery=''select '' +columnList+ '' from ''+ sourceDB+''.''+SourceSchemaName+''.''+SourcetableName + '' where \ncast(''+DateField+'' as date) >=''''''+LastDate+''''''''\n,SourceDB\n,TargetContainer\n, TargetPath, TargetFile, FileFormat,DateField,LastDate,targetstagetableschema,targetstagetablename\nfrom dbo.control_table\nwhere ID= ',item().ID_Inc)",
												"type": "Expression"
											},
											"queryTimeout": "02:00:00",
											"partitionOption": "None"
										},
										"dataset": {
											"referenceName": "Briggs_MDW",
											"type": "DatasetReference",
											"parameters": {
												"schema_name": "dbo",
												"table_name": "user"
											}
										}
									}
								},
								{
									"name": "Copy_Briggs_Inc_ADLS",
									"type": "Copy",
									"dependsOn": [
										{
											"activity": "Start_Table_Audit1",
											"dependencyConditions": [
												"Succeeded"
											]
										}
									],
									"policy": {
										"timeout": "7.00:00:00",
										"retry": 0,
										"retryIntervalInSeconds": 30,
										"secureOutput": false,
										"secureInput": false
									},
									"userProperties": [],
									"typeProperties": {
										"source": {
											"type": "SqlServerSource",
											"sqlReaderQuery": {
												"value": "@activity('Lookup_Incremental').output.firstRow.SourceQuery\n",
												"type": "Expression"
											},
											"queryTimeout": "02:00:00",
											"partitionOption": "None"
										},
										"sink": {
											"type": "AzureSqlSink",
											"preCopyScript": {
												"value": "@{concat('delete from ',activity('Lookup_Incremental').output.firstRow.TargetStageTableSchema,'.',activity('Lookup_Incremental').output.firstRow.targetstagetablename,' where cast(',activity('Lookup_Incremental').output.firstRow.DateField,' as date)=','''',activity('Lookup_Incremental').output.firstRow.LastDate,'''')}",
												"type": "Expression"
											},
											"disableMetricsCollection": false
										},
										"enableStaging": false,
										"translator": {
											"type": "TabularTranslator",
											"typeConversion": true,
											"typeConversionSettings": {
												"allowDataTruncation": true,
												"treatBooleanAsNumber": false
											}
										}
									},
									"inputs": [
										{
											"referenceName": "DS_Briggs_MST",
											"type": "DatasetReference",
											"parameters": {}
										}
									],
									"outputs": [
										{
											"referenceName": "Briggs_MDW",
											"type": "DatasetReference",
											"parameters": {
												"schema_name": {
													"value": "@activity('Lookup_Incremental').output.firstRow.TargetStageTableSchema",
													"type": "Expression"
												},
												"table_name": {
													"value": "@activity('Lookup_Incremental').output.firstRow.TargetStageTableName",
													"type": "Expression"
												}
											}
										}
									]
								},
								{
									"name": "Copy_Briggs_Inc_ADLS_New",
									"type": "Copy",
									"dependsOn": [
										{
											"activity": "Copy_Briggs_Inc_ADLS",
											"dependencyConditions": [
												"Failed"
											]
										}
									],
									"policy": {
										"timeout": "7.00:00:00",
										"retry": 0,
										"retryIntervalInSeconds": 30,
										"secureOutput": false,
										"secureInput": false
									},
									"userProperties": [],
									"typeProperties": {
										"source": {
											"type": "SqlServerSource",
											"sqlReaderQuery": {
												"value": "@activity('Lookup_Incremental').output.firstRow.SourceQuery\n",
												"type": "Expression"
											},
											"queryTimeout": "02:00:00",
											"partitionOption": "None"
										},
										"sink": {
											"type": "AzureSqlSink",
											"writeBehavior": "insert",
											"sqlWriterUseTableLock": false,
											"tableOption": "autoCreate",
											"disableMetricsCollection": false
										},
										"enableStaging": false,
										"translator": {
											"type": "TabularTranslator",
											"typeConversion": true,
											"typeConversionSettings": {
												"allowDataTruncation": true,
												"treatBooleanAsNumber": false
											}
										}
									},
									"inputs": [
										{
											"referenceName": "DS_Briggs_MST",
											"type": "DatasetReference",
											"parameters": {}
										}
									],
									"outputs": [
										{
											"referenceName": "Briggs_MDW",
											"type": "DatasetReference",
											"parameters": {
												"schema_name": {
													"value": "@activity('Lookup_Incremental').output.firstRow.TargetStageTableSchema",
													"type": "Expression"
												},
												"table_name": {
													"value": "@activity('Lookup_Incremental').output.firstRow.TargetStageTableName",
													"type": "Expression"
												}
											}
										}
									]
								},
								{
									"name": "Start_Table_Audit1",
									"type": "Lookup",
									"dependsOn": [
										{
											"activity": "Lookup_Incremental",
											"dependencyConditions": [
												"Succeeded"
											]
										}
									],
									"policy": {
										"timeout": "7.00:00:00",
										"retry": 0,
										"retryIntervalInSeconds": 30,
										"secureOutput": false,
										"secureInput": false
									},
									"userProperties": [],
									"typeProperties": {
										"source": {
											"type": "AzureSqlSource",
											"sqlReaderStoredProcedureName": "[dbo].[proc_StartAuditLog_Briggs]",
											"storedProcedureParameters": {
												"ConfigTableID": {
													"type": "Int32",
													"value": {
														"value": "@item().ID_Inc",
														"type": "Expression"
													}
												},
												"DataFactoryName": {
													"type": "String",
													"value": {
														"value": "@pipeline().DataFactory",
														"type": "Expression"
													}
												},
												"ParentAuditID": {
													"type": "Int64",
													"value": {
														"value": "@item().ID_Inc",
														"type": "Expression"
													}
												},
												"PipelineName": {
													"type": "String",
													"value": {
														"value": "@pipeline().Pipeline",
														"type": "Expression"
													}
												},
												"PipelineRunID": {
													"type": "String",
													"value": {
														"value": "@pipeline().RunId",
														"type": "Expression"
													}
												},
												"PipelineTriggerID": {
													"type": "String",
													"value": {
														"value": "@pipeline().TriggerId",
														"type": "Expression"
													}
												},
												"PipelineTriggerName": {
													"type": "String",
													"value": {
														"value": "@pipeline().TriggerName",
														"type": "Expression"
													}
												},
												"PipelineTriggerType": {
													"type": "String",
													"value": {
														"value": "@pipeline().TriggerType",
														"type": "Expression"
													}
												},
												"Sourcedb": {
													"type": "String",
													"value": {
														"value": "@item().sourceDB",
														"type": "Expression"
													}
												},
												"sourcetable": {
													"type": "String",
													"value": {
														"value": "@item().SourcetableName",
														"type": "Expression"
													}
												}
											},
											"queryTimeout": "02:00:00",
											"partitionOption": "None"
										},
										"dataset": {
											"referenceName": "Briggs_MDW",
											"type": "DatasetReference",
											"parameters": {
												"schema_name": "dbo",
												"table_name": "user"
											}
										},
										"firstRowOnly": false
									}
								},
								{
									"name": "Success_Audit_Log1",
									"type": "SqlServerStoredProcedure",
									"dependsOn": [
										{
											"activity": "Copy_Briggs_Inc_ADLS",
											"dependencyConditions": [
												"Succeeded"
											]
										}
									],
									"policy": {
										"timeout": "7.00:00:00",
										"retry": 0,
										"retryIntervalInSeconds": 30,
										"secureOutput": false,
										"secureInput": false
									},
									"userProperties": [],
									"typeProperties": {
										"storedProcedureName": "[dbo].[proc_UpdateAuditLog_Briggs]",
										"storedProcedureParameters": {
											"ConfigTableID": {
												"value": {
													"value": "@item().ID_Inc",
													"type": "Expression"
												},
												"type": "Int32"
											},
											"RowsRead": {
												"value": {
													"value": "@activity('Copy_Briggs_Inc_ADLS').output.RowsRead",
													"type": "Expression"
												},
												"type": "Int64"
											},
											"Status": {
												"value": "Success",
												"type": "String"
											}
										}
									},
									"linkedServiceName": {
										"referenceName": "DS_MDW_SP",
										"type": "LinkedServiceReference"
									}
								},
								{
									"name": "Success_Audit_Log2",
									"type": "SqlServerStoredProcedure",
									"dependsOn": [
										{
											"activity": "Copy_Briggs_Inc_ADLS_New",
											"dependencyConditions": [
												"Succeeded"
											]
										}
									],
									"policy": {
										"timeout": "7.00:00:00",
										"retry": 0,
										"retryIntervalInSeconds": 30,
										"secureOutput": false,
										"secureInput": false
									},
									"userProperties": [],
									"typeProperties": {
										"storedProcedureName": "[dbo].[proc_UpdateAuditLog_Briggs]",
										"storedProcedureParameters": {
											"ConfigTableID": {
												"value": {
													"value": "@item().ID_Inc",
													"type": "Expression"
												},
												"type": "Int32"
											},
											"RowsRead": {
												"value": {
													"value": "@activity('Copy_Briggs_Inc_ADLS_New').output.RowsRead",
													"type": "Expression"
												},
												"type": "Int64"
											},
											"Status": {
												"value": "Success",
												"type": "String"
											}
										}
									},
									"linkedServiceName": {
										"referenceName": "DS_MDW_SP",
										"type": "LinkedServiceReference"
									}
								},
								{
									"name": "Failure_Audit_Log2",
									"type": "SqlServerStoredProcedure",
									"dependsOn": [
										{
											"activity": "Set variable1",
											"dependencyConditions": [
												"Succeeded"
											]
										}
									],
									"policy": {
										"timeout": "7.00:00:00",
										"retry": 0,
										"retryIntervalInSeconds": 30,
										"secureOutput": false,
										"secureInput": false
									},
									"userProperties": [],
									"typeProperties": {
										"storedProcedureName": "[dbo].[proc_UpdateAuditLog_Briggs]",
										"storedProcedureParameters": {
											"ConfigTableID": {
												"value": {
													"value": "@item().ID_Inc",
													"type": "Expression"
												},
												"type": "Int32"
											},
											"RowsRead": {
												"value": null,
												"type": "Int64"
											},
											"Status": {
												"value": {
													"value": "@variables('ErrorMsgInc')",
													"type": "Expression"
												},
												"type": "String"
											}
										}
									},
									"linkedServiceName": {
										"referenceName": "DS_MDW_SP",
										"type": "LinkedServiceReference"
									}
								},
								{
									"name": "Set variable1",
									"type": "SetVariable",
									"dependsOn": [
										{
											"activity": "Copy_Briggs_Inc_ADLS",
											"dependencyConditions": [
												"Failed"
											]
										},
										{
											"activity": "Copy_Briggs_Inc_ADLS_New",
											"dependencyConditions": [
												"Failed"
											]
										}
									],
									"userProperties": [],
									"typeProperties": {
										"variableName": "ErrorMsgInc",
										"value": {
											"value": "@activity('Copy_Briggs_Inc_ADLS').Error.Message",
											"type": "Expression"
										}
									}
								}
							]
						}
					},
					{
						"name": "ForEach_Full_Load",
						"type": "ForEach",
						"dependsOn": [
							{
								"activity": "Lookup2_Full",
								"dependencyConditions": [
									"Succeeded"
								]
							}
						],
						"userProperties": [],
						"typeProperties": {
							"items": {
								"value": "@activity('Lookup2_Full').output.value",
								"type": "Expression"
							},
							"activities": [
								{
									"name": "Lookup_Full",
									"type": "Lookup",
									"dependsOn": [],
									"policy": {
										"timeout": "7.00:00:00",
										"retry": 0,
										"retryIntervalInSeconds": 30,
										"secureOutput": false,
										"secureInput": false
									},
									"userProperties": [],
									"typeProperties": {
										"source": {
											"type": "AzureSqlSource",
											"sqlReaderQuery": {
												"value": "@concat('select SourceQuery=''select '' +columnList+ '' from ''+ sourceDB+''.''+SourceSchemaName+''.''+SourcetableName\n,SourceDB\n,TargetContainer\n, TargetPath, TargetFile, FileFormat,DateField,LastDate,targetstagetableschema,targetstagetablename\nfrom dbo.control_table\nwhere ID= ',item().ID_Full)",
												"type": "Expression"
											},
											"queryTimeout": "02:00:00",
											"partitionOption": "None"
										},
										"dataset": {
											"referenceName": "Briggs_MDW",
											"type": "DatasetReference",
											"parameters": {
												"schema_name": "dbo",
												"table_name": "user"
											}
										}
									}
								},
								{
									"name": "Copy_Briggs_Full_ADLS",
									"type": "Copy",
									"dependsOn": [
										{
											"activity": "Start_Table_Audit",
											"dependencyConditions": [
												"Succeeded"
											]
										}
									],
									"policy": {
										"timeout": "7.00:00:00",
										"retry": 0,
										"retryIntervalInSeconds": 30,
										"secureOutput": false,
										"secureInput": false
									},
									"userProperties": [],
									"typeProperties": {
										"source": {
											"type": "SqlServerSource",
											"sqlReaderQuery": {
												"value": "@activity('Lookup_Full').output.firstRow.SourceQuery\n",
												"type": "Expression"
											},
											"queryTimeout": "02:00:00",
											"partitionOption": "None"
										},
										"sink": {
											"type": "AzureSqlSink",
											"preCopyScript": {
												"value": "@{concat('truncate table ',activity('Lookup_Full').output.firstRow.TargetStageTableSchema,'.',activity('Lookup_Full').output.firstRow.TargetStageTableName)}",
												"type": "Expression"
											},
											"disableMetricsCollection": false
										},
										"enableStaging": false,
										"translator": {
											"type": "TabularTranslator",
											"typeConversion": true,
											"typeConversionSettings": {
												"allowDataTruncation": true,
												"treatBooleanAsNumber": false
											}
										}
									},
									"inputs": [
										{
											"referenceName": "DS_Briggs_MST",
											"type": "DatasetReference",
											"parameters": {}
										}
									],
									"outputs": [
										{
											"referenceName": "Briggs_MDW",
											"type": "DatasetReference",
											"parameters": {
												"schema_name": {
													"value": "@activity('Lookup_Full').output.firstRow.TargetStageTableSchema",
													"type": "Expression"
												},
												"table_name": {
													"value": "@activity('Lookup_Full').output.firstRow.TargetStageTableName",
													"type": "Expression"
												}
											}
										}
									]
								},
								{
									"name": "Copy_Briggs_Full_ADLS_New",
									"type": "Copy",
									"dependsOn": [
										{
											"activity": "Copy_Briggs_Full_ADLS",
											"dependencyConditions": [
												"Failed"
											]
										}
									],
									"policy": {
										"timeout": "7.00:00:00",
										"retry": 0,
										"retryIntervalInSeconds": 30,
										"secureOutput": false,
										"secureInput": false
									},
									"userProperties": [],
									"typeProperties": {
										"source": {
											"type": "SqlServerSource",
											"sqlReaderQuery": {
												"value": "@activity('Lookup_Full').output.firstRow.SourceQuery\n",
												"type": "Expression"
											},
											"queryTimeout": "02:00:00",
											"partitionOption": "None"
										},
										"sink": {
											"type": "AzureSqlSink",
											"writeBehavior": "insert",
											"sqlWriterUseTableLock": false,
											"tableOption": "autoCreate",
											"disableMetricsCollection": false
										},
										"enableStaging": false,
										"translator": {
											"type": "TabularTranslator",
											"typeConversion": true,
											"typeConversionSettings": {
												"allowDataTruncation": true,
												"treatBooleanAsNumber": false
											}
										}
									},
									"inputs": [
										{
											"referenceName": "DS_Briggs_MST",
											"type": "DatasetReference",
											"parameters": {}
										}
									],
									"outputs": [
										{
											"referenceName": "Briggs_MDW",
											"type": "DatasetReference",
											"parameters": {
												"schema_name": {
													"value": "@activity('Lookup_Full').output.firstRow.TargetStageTableSchema",
													"type": "Expression"
												},
												"table_name": {
													"value": "@activity('Lookup_Full').output.firstRow.TargetStageTableName",
													"type": "Expression"
												}
											}
										}
									]
								},
								{
									"name": "Start_Table_Audit",
									"type": "Lookup",
									"dependsOn": [
										{
											"activity": "Lookup_Full",
											"dependencyConditions": [
												"Succeeded"
											]
										}
									],
									"policy": {
										"timeout": "7.00:00:00",
										"retry": 0,
										"retryIntervalInSeconds": 30,
										"secureOutput": false,
										"secureInput": false
									},
									"userProperties": [],
									"typeProperties": {
										"source": {
											"type": "AzureSqlSource",
											"sqlReaderStoredProcedureName": "[dbo].[proc_StartAuditLog_Briggs]",
											"storedProcedureParameters": {
												"ConfigTableID": {
													"type": "Int32",
													"value": {
														"value": "@item().ID_Full",
														"type": "Expression"
													}
												},
												"DataFactoryName": {
													"type": "String",
													"value": {
														"value": "@pipeline().DataFactory",
														"type": "Expression"
													}
												},
												"ParentAuditID": {
													"type": "Int64",
													"value": {
														"value": "@item().ID_Full",
														"type": "Expression"
													}
												},
												"PipelineName": {
													"type": "String",
													"value": {
														"value": "@pipeline().Pipeline",
														"type": "Expression"
													}
												},
												"PipelineRunID": {
													"type": "String",
													"value": {
														"value": "@pipeline().RunId",
														"type": "Expression"
													}
												},
												"PipelineTriggerID": {
													"type": "String",
													"value": {
														"value": "@pipeline().TriggerId",
														"type": "Expression"
													}
												},
												"PipelineTriggerName": {
													"type": "String",
													"value": {
														"value": "@pipeline().TriggerName",
														"type": "Expression"
													}
												},
												"PipelineTriggerType": {
													"type": "String",
													"value": {
														"value": "@pipeline().TriggerType",
														"type": "Expression"
													}
												},
												"Sourcedb": {
													"type": "String",
													"value": {
														"value": "@item().sourceDB",
														"type": "Expression"
													}
												},
												"sourcetable": {
													"type": "String",
													"value": {
														"value": "@item().SourcetableName",
														"type": "Expression"
													}
												}
											},
											"queryTimeout": "02:00:00",
											"partitionOption": "None"
										},
										"dataset": {
											"referenceName": "Briggs_MDW",
											"type": "DatasetReference",
											"parameters": {
												"schema_name": "dbo",
												"table_name": "user"
											}
										},
										"firstRowOnly": false
									}
								},
								{
									"name": "Success_Audit_Log",
									"type": "SqlServerStoredProcedure",
									"dependsOn": [
										{
											"activity": "Copy_Briggs_Full_ADLS",
											"dependencyConditions": [
												"Succeeded"
											]
										}
									],
									"policy": {
										"timeout": "7.00:00:00",
										"retry": 0,
										"retryIntervalInSeconds": 30,
										"secureOutput": false,
										"secureInput": false
									},
									"userProperties": [],
									"typeProperties": {
										"storedProcedureName": "[dbo].[proc_UpdateAuditLog_Briggs]",
										"storedProcedureParameters": {
											"ConfigTableID": {
												"value": {
													"value": "@item().ID_Full",
													"type": "Expression"
												},
												"type": "Int32"
											},
											"RowsRead": {
												"value": {
													"value": "@activity('Copy_Briggs_Full_ADLS').output.RowsRead",
													"type": "Expression"
												},
												"type": "Int64"
											},
											"Status": {
												"value": "Success",
												"type": "String"
											}
										}
									},
									"linkedServiceName": {
										"referenceName": "DS_MDW_SP",
										"type": "LinkedServiceReference"
									}
								},
								{
									"name": "Success_Audit_Log_New",
									"type": "SqlServerStoredProcedure",
									"dependsOn": [
										{
											"activity": "Copy_Briggs_Full_ADLS_New",
											"dependencyConditions": [
												"Succeeded"
											]
										}
									],
									"policy": {
										"timeout": "7.00:00:00",
										"retry": 0,
										"retryIntervalInSeconds": 30,
										"secureOutput": false,
										"secureInput": false
									},
									"userProperties": [],
									"typeProperties": {
										"storedProcedureName": "[dbo].[proc_UpdateAuditLog_Briggs]",
										"storedProcedureParameters": {
											"ConfigTableID": {
												"value": {
													"value": "@item().ID_Full",
													"type": "Expression"
												},
												"type": "Int32"
											},
											"RowsRead": {
												"value": {
													"value": "@activity('Copy_Briggs_Full_ADLS_New').output.RowsRead",
													"type": "Expression"
												},
												"type": "Int64"
											},
											"Status": {
												"value": "Success",
												"type": "String"
											}
										}
									},
									"linkedServiceName": {
										"referenceName": "DS_MDW_SP",
										"type": "LinkedServiceReference"
									}
								},
								{
									"name": "Failure_Audit_Log_New",
									"type": "SqlServerStoredProcedure",
									"dependsOn": [
										{
											"activity": "Set variable2",
											"dependencyConditions": [
												"Succeeded"
											]
										}
									],
									"policy": {
										"timeout": "7.00:00:00",
										"retry": 0,
										"retryIntervalInSeconds": 30,
										"secureOutput": false,
										"secureInput": false
									},
									"userProperties": [],
									"typeProperties": {
										"storedProcedureName": "[dbo].[proc_UpdateAuditLog_Briggs]",
										"storedProcedureParameters": {
											"ConfigTableID": {
												"value": {
													"value": "@item().ID_Full",
													"type": "Expression"
												},
												"type": "Int32"
											},
											"RowsRead": {
												"value": null,
												"type": "Int64"
											},
											"Status": {
												"value": {
													"value": "@variables('ErrorMsgFull')",
													"type": "Expression"
												},
												"type": "String"
											}
										}
									},
									"linkedServiceName": {
										"referenceName": "DS_MDW_SP",
										"type": "LinkedServiceReference"
									}
								},
								{
									"name": "Set variable2",
									"type": "SetVariable",
									"dependsOn": [
										{
											"activity": "Copy_Briggs_Full_ADLS",
											"dependencyConditions": [
												"Failed"
											]
										},
										{
											"activity": "Copy_Briggs_Full_ADLS_New",
											"dependencyConditions": [
												"Failed"
											]
										}
									],
									"userProperties": [],
									"typeProperties": {
										"variableName": "ErrorMsgFull",
										"value": {
											"value": "@activity('Copy_Briggs_Full_ADLS').Error.Message",
											"type": "Expression"
										}
									}
								}
							]
						}
					},
					{
						"name": "ForEach_Incremental_Proc",
						"type": "ForEach",
						"dependsOn": [
							{
								"activity": "ForEach_Incremental_Load",
								"dependencyConditions": [
									"Succeeded"
								]
							}
						],
						"userProperties": [],
						"typeProperties": {
							"items": {
								"value": "@activity('Lookup1_Incremental').output.value",
								"type": "Expression"
							},
							"activities": [
								{
									"name": "Stored procedure1",
									"type": "SqlServerStoredProcedure",
									"dependsOn": [],
									"policy": {
										"timeout": "7.00:00:00",
										"retry": 0,
										"retryIntervalInSeconds": 30,
										"secureOutput": false,
										"secureInput": false
									},
									"userProperties": [],
									"typeProperties": {
										"storedProcedureName": "[dbo].[USP_Control_Table_LastDate]",
										"storedProcedureParameters": {
											"id_I_F": {
												"value": {
													"value": "@item().ID_Inc",
													"type": "Expression"
												},
												"type": "Int32"
											}
										}
									},
									"linkedServiceName": {
										"referenceName": "DS_MDW_SP",
										"type": "LinkedServiceReference"
									}
								}
							]
						}
					},
					{
						"name": "ForEach_Full_Proc",
						"type": "ForEach",
						"dependsOn": [
							{
								"activity": "ForEach_Full_Load",
								"dependencyConditions": [
									"Succeeded"
								]
							}
						],
						"userProperties": [],
						"typeProperties": {
							"items": {
								"value": "@activity('Lookup2_Full').output.value",
								"type": "Expression"
							},
							"activities": [
								{
									"name": "Stored procedure_Full",
									"type": "SqlServerStoredProcedure",
									"dependsOn": [],
									"policy": {
										"timeout": "7.00:00:00",
										"retry": 0,
										"retryIntervalInSeconds": 30,
										"secureOutput": false,
										"secureInput": false
									},
									"userProperties": [],
									"typeProperties": {
										"storedProcedureName": "[dbo].[USP_Control_Table_LastDate]",
										"storedProcedureParameters": {
											"id_I_F": {
												"value": {
													"value": "@item().ID_Full",
													"type": "Expression"
												},
												"type": "Int32"
											}
										}
									},
									"linkedServiceName": {
										"referenceName": "DS_MDW_SP",
										"type": "LinkedServiceReference"
									}
								}
							]
						}
					},
					{
						"name": "lkp_ExecStartAuditProc",
						"type": "Lookup",
						"dependsOn": [],
						"policy": {
							"timeout": "7.00:00:00",
							"retry": 0,
							"retryIntervalInSeconds": 30,
							"secureOutput": false,
							"secureInput": false
						},
						"userProperties": [],
						"typeProperties": {
							"source": {
								"type": "AzureSqlSource",
								"sqlReaderStoredProcedureName": "[dbo].[proc_StartAuditLog]",
								"storedProcedureParameters": {
									"ConfigTableID": {
										"type": "Int32",
										"value": "-1"
									},
									"DataFactoryName": {
										"type": "String",
										"value": {
											"value": "@pipeline().DataFactory",
											"type": "Expression"
										}
									},
									"ParentAuditID": {
										"type": "Int64",
										"value": "-1"
									},
									"PipelineName": {
										"type": "String",
										"value": {
											"value": "@concat(pipeline().Pipeline,' AR Source Table Load')",
											"type": "Expression"
										}
									},
									"PipelineRunID": {
										"type": "String",
										"value": {
											"value": "@pipeline().RunId",
											"type": "Expression"
										}
									},
									"PipelineTriggerID": {
										"type": "String",
										"value": {
											"value": "@pipeline().TriggerId",
											"type": "Expression"
										}
									},
									"PipelineTriggerName": {
										"type": "String",
										"value": {
											"value": "@pipeline().TriggerName",
											"type": "Expression"
										}
									},
									"PipelineTriggerType": {
										"type": "String",
										"value": {
											"value": "@pipeline().TriggerType",
											"type": "Expression"
										}
									}
								},
								"queryTimeout": "02:00:00",
								"partitionOption": "None"
							},
							"dataset": {
								"referenceName": "Briggs_MDW",
								"type": "DatasetReference",
								"parameters": {
									"schema_name": "dbo",
									"table_name": "user"
								}
							}
						}
					},
					{
						"name": "Sp_ExecFailureAudit_Full",
						"type": "SqlServerStoredProcedure",
						"dependsOn": [
							{
								"activity": "ForEach_Full_Load",
								"dependencyConditions": [
									"Failed"
								]
							}
						],
						"policy": {
							"timeout": "7.00:00:00",
							"retry": 0,
							"retryIntervalInSeconds": 30,
							"secureOutput": false,
							"secureInput": false
						},
						"userProperties": [],
						"typeProperties": {
							"storedProcedureName": "[dbo].[proc_UpdateAuditLog]",
							"storedProcedureParameters": {
								"AuditID": {
									"value": {
										"value": "@activity('lkp_ExecStartAuditProc').output.firstRow.AuditID",
										"type": "Expression"
									},
									"type": "Int32"
								},
								"DataLakePath": {
									"value": null,
									"type": "String"
								},
								"PipelineRunID": {
									"value": {
										"value": "@pipeline().RunId",
										"type": "Expression"
									},
									"type": "String"
								},
								"RowsRead": {
									"value": null,
									"type": "Int64"
								},
								"Status": {
									"value": "Full Load Failed",
									"type": "String"
								}
							}
						},
						"linkedServiceName": {
							"referenceName": "AzureSqlDatabase1",
							"type": "LinkedServiceReference"
						}
					},
					{
						"name": "Sp_ExecSuccessAudit_Inc",
						"type": "SqlServerStoredProcedure",
						"dependsOn": [
							{
								"activity": "ForEach_Incremental_Proc",
								"dependencyConditions": [
									"Succeeded"
								]
							},
							{
								"activity": "ForEach_Full_Proc",
								"dependencyConditions": [
									"Succeeded"
								]
							}
						],
						"policy": {
							"timeout": "7.00:00:00",
							"retry": 0,
							"retryIntervalInSeconds": 30,
							"secureOutput": false,
							"secureInput": false
						},
						"userProperties": [],
						"typeProperties": {
							"storedProcedureName": "[dbo].[proc_UpdateAuditLog]",
							"storedProcedureParameters": {
								"AuditID": {
									"value": {
										"value": "@activity('lkp_ExecStartAuditProc').output.firstRow.AuditID",
										"type": "Expression"
									},
									"type": "Int32"
								},
								"DataLakePath": {
									"value": null,
									"type": "String"
								},
								"RowsRead": {
									"value": null,
									"type": "Int64"
								},
								"Status": {
									"value": "Success",
									"type": "String"
								},
								"PipelineRunID": {
									"value": {
										"value": "@pipeline().RunId",
										"type": "Expression"
									},
									"type": "String"
								}
							}
						},
						"linkedServiceName": {
							"referenceName": "AzureSqlDatabase1",
							"type": "LinkedServiceReference"
						}
					},
					{
						"name": "Sp_ExecFailureAudit_Inc",
						"type": "SqlServerStoredProcedure",
						"dependsOn": [
							{
								"activity": "ForEach_Incremental_Load",
								"dependencyConditions": [
									"Failed"
								]
							}
						],
						"policy": {
							"timeout": "7.00:00:00",
							"retry": 0,
							"retryIntervalInSeconds": 30,
							"secureOutput": false,
							"secureInput": false
						},
						"userProperties": [],
						"typeProperties": {
							"storedProcedureName": "[dbo].[proc_UpdateAuditLog]",
							"storedProcedureParameters": {
								"AuditID": {
									"value": {
										"value": "@activity('lkp_ExecStartAuditProc').output.firstRow.AuditID",
										"type": "Expression"
									},
									"type": "Int32"
								},
								"DataLakePath": {
									"value": null,
									"type": "String"
								},
								"PipelineRunID": {
									"value": {
										"value": "@pipeline().RunId",
										"type": "Expression"
									},
									"type": "String"
								},
								"RowsRead": {
									"value": null,
									"type": "Int64"
								},
								"Status": {
									"value": "Incr Load Failed",
									"type": "String"
								}
							}
						},
						"linkedServiceName": {
							"referenceName": "AzureSqlDatabase1",
							"type": "LinkedServiceReference"
						}
					}
				],
				"policy": {
					"elapsedTimeMetric": {},
					"cancelAfter": {}
				},
				"variables": {
					"ErrorMsgInc": {
						"type": "String"
					},
					"ErrorMsgFull": {
						"type": "String"
					}
				},
				"folder": {
					"name": "Briggs Data Load Theme wise"
				},
				"annotations": [],
				"lastPublishTime": "2022-04-26T06:09:42Z"
			},
			"dependsOn": [
				"[concat(variables('workspaceId'), '/datasets/Briggs_MDW')]",
				"[concat(variables('workspaceId'), '/linkedServices/AzureSqlDatabase1')]",
				"[concat(variables('workspaceId'), '/datasets/DS_Briggs_MST')]",
				"[concat(variables('workspaceId'), '/linkedServices/DS_MDW_SP')]"
			]
		},
		{
			"name": "[concat(parameters('workspaceName'), '/PL_Generic_Copy_Billing')]",
			"type": "Microsoft.Synapse/workspaces/pipelines",
			"apiVersion": "2019-06-01-preview",
			"properties": {
				"activities": [
					{
						"name": "Lookup1_Incremental",
						"type": "Lookup",
						"dependsOn": [
							{
								"activity": "lkp_ExecStartAuditProc",
								"dependencyConditions": [
									"Succeeded"
								]
							}
						],
						"policy": {
							"timeout": "7.00:00:00",
							"retry": 0,
							"retryIntervalInSeconds": 30,
							"secureOutput": false,
							"secureInput": false
						},
						"userProperties": [],
						"typeProperties": {
							"source": {
								"type": "AzureSqlSource",
								"sqlReaderQuery": "Select Distinct ID ID_Inc,sourcedb,sourcetablename  From dbo.control_table Where ProcessName = 'AzSQL_ADLS'  \nAND DataLoadType = 'Incremental'  and EnableAction = 1  \nand (format(refresh_date,'dd-MM-yyyy') <> format(getdate(),'dd-MM-yyyy') or refresh_date is null)\nand subjectarea like '%Sales Billing%' and id <> 253 \norder by 1",
								"queryTimeout": "02:00:00",
								"partitionOption": "None"
							},
							"dataset": {
								"referenceName": "Briggs_MDW",
								"type": "DatasetReference",
								"parameters": {
									"schema_name": "dbo",
									"table_name": "user"
								}
							},
							"firstRowOnly": false
						}
					},
					{
						"name": "Lookup2_Full",
						"type": "Lookup",
						"dependsOn": [
							{
								"activity": "lkp_ExecStartAuditProc",
								"dependencyConditions": [
									"Succeeded"
								]
							}
						],
						"policy": {
							"timeout": "7.00:00:00",
							"retry": 0,
							"retryIntervalInSeconds": 30,
							"secureOutput": false,
							"secureInput": false
						},
						"userProperties": [],
						"typeProperties": {
							"source": {
								"type": "AzureSqlSource",
								"sqlReaderQuery": "Select Distinct ID ID_Full,sourcedb,sourcetablename  From dbo.control_table Where ProcessName = 'AzSQL_ADLS'  \nAND DataLoadType = 'Full'  and EnableAction = 1 \nand (format(refresh_date,'dd-MM-yyyy') <> format(getdate(),'dd-MM-yyyy') or refresh_date is null)\nand subjectarea like '%Sales Billing%' \norder by 1",
								"queryTimeout": "02:00:00",
								"partitionOption": "None"
							},
							"dataset": {
								"referenceName": "Briggs_MDW",
								"type": "DatasetReference",
								"parameters": {
									"schema_name": "dbo",
									"table_name": "user"
								}
							},
							"firstRowOnly": false
						}
					},
					{
						"name": "ForEach_Incremental_Load",
						"type": "ForEach",
						"dependsOn": [
							{
								"activity": "Lookup1_Incremental",
								"dependencyConditions": [
									"Succeeded"
								]
							}
						],
						"userProperties": [],
						"typeProperties": {
							"items": {
								"value": "@activity('Lookup1_Incremental').output.value",
								"type": "Expression"
							},
							"activities": [
								{
									"name": "Lookup_Incremental",
									"type": "Lookup",
									"dependsOn": [],
									"policy": {
										"timeout": "7.00:00:00",
										"retry": 0,
										"retryIntervalInSeconds": 30,
										"secureOutput": false,
										"secureInput": false
									},
									"userProperties": [],
									"typeProperties": {
										"source": {
											"type": "AzureSqlSource",
											"sqlReaderQuery": {
												"value": "@concat('select SourceQuery=''select '' +columnList+ '' from ''+ sourceDB+''.''+SourceSchemaName+''.''+SourcetableName + '' where \ncast(''+DateField+'' as date) >=''''''+LastDate+''''''''\n,SourceDB\n,TargetContainer\n, TargetPath, TargetFile, FileFormat,DateField,LastDate,targetstagetableschema,targetstagetablename\nfrom dbo.control_table\nwhere ID= ',item().ID_Inc)",
												"type": "Expression"
											},
											"queryTimeout": "02:00:00",
											"partitionOption": "None"
										},
										"dataset": {
											"referenceName": "Briggs_MDW",
											"type": "DatasetReference",
											"parameters": {
												"schema_name": "dbo",
												"table_name": "user"
											}
										}
									}
								},
								{
									"name": "Copy_Briggs_Inc_ADLS",
									"type": "Copy",
									"dependsOn": [
										{
											"activity": "Start_Table_Audit1",
											"dependencyConditions": [
												"Succeeded"
											]
										}
									],
									"policy": {
										"timeout": "7.00:00:00",
										"retry": 0,
										"retryIntervalInSeconds": 30,
										"secureOutput": false,
										"secureInput": false
									},
									"userProperties": [],
									"typeProperties": {
										"source": {
											"type": "SqlServerSource",
											"sqlReaderQuery": {
												"value": "@activity('Lookup_Incremental').output.firstRow.SourceQuery\n",
												"type": "Expression"
											},
											"queryTimeout": "02:00:00",
											"partitionOption": "None"
										},
										"sink": {
											"type": "AzureSqlSink",
											"preCopyScript": {
												"value": "@{concat('delete from ',activity('Lookup_Incremental').output.firstRow.TargetStageTableSchema,'.',activity('Lookup_Incremental').output.firstRow.targetstagetablename,' where cast(',activity('Lookup_Incremental').output.firstRow.DateField,' as date)=','''',activity('Lookup_Incremental').output.firstRow.LastDate,'''')}",
												"type": "Expression"
											},
											"disableMetricsCollection": false
										},
										"enableStaging": false,
										"translator": {
											"type": "TabularTranslator",
											"typeConversion": true,
											"typeConversionSettings": {
												"allowDataTruncation": true,
												"treatBooleanAsNumber": false
											}
										}
									},
									"inputs": [
										{
											"referenceName": "DS_Briggs_MST",
											"type": "DatasetReference",
											"parameters": {}
										}
									],
									"outputs": [
										{
											"referenceName": "Briggs_MDW",
											"type": "DatasetReference",
											"parameters": {
												"schema_name": {
													"value": "@activity('Lookup_Incremental').output.firstRow.TargetStageTableSchema",
													"type": "Expression"
												},
												"table_name": {
													"value": "@activity('Lookup_Incremental').output.firstRow.TargetStageTableName",
													"type": "Expression"
												}
											}
										}
									]
								},
								{
									"name": "Copy_Briggs_Inc_ADLS_New",
									"type": "Copy",
									"dependsOn": [
										{
											"activity": "Copy_Briggs_Inc_ADLS",
											"dependencyConditions": [
												"Failed"
											]
										}
									],
									"policy": {
										"timeout": "7.00:00:00",
										"retry": 0,
										"retryIntervalInSeconds": 30,
										"secureOutput": false,
										"secureInput": false
									},
									"userProperties": [],
									"typeProperties": {
										"source": {
											"type": "SqlServerSource",
											"sqlReaderQuery": {
												"value": "@activity('Lookup_Incremental').output.firstRow.SourceQuery\n",
												"type": "Expression"
											},
											"queryTimeout": "02:00:00",
											"partitionOption": "None"
										},
										"sink": {
											"type": "AzureSqlSink",
											"writeBehavior": "insert",
											"sqlWriterUseTableLock": false,
											"tableOption": "autoCreate",
											"disableMetricsCollection": false
										},
										"enableStaging": false,
										"translator": {
											"type": "TabularTranslator",
											"typeConversion": true,
											"typeConversionSettings": {
												"allowDataTruncation": true,
												"treatBooleanAsNumber": false
											}
										}
									},
									"inputs": [
										{
											"referenceName": "DS_Briggs_MST",
											"type": "DatasetReference",
											"parameters": {}
										}
									],
									"outputs": [
										{
											"referenceName": "Briggs_MDW",
											"type": "DatasetReference",
											"parameters": {
												"schema_name": {
													"value": "@activity('Lookup_Incremental').output.firstRow.TargetStageTableSchema",
													"type": "Expression"
												},
												"table_name": {
													"value": "@activity('Lookup_Incremental').output.firstRow.TargetStageTableName",
													"type": "Expression"
												}
											}
										}
									]
								},
								{
									"name": "Start_Table_Audit1",
									"type": "Lookup",
									"dependsOn": [
										{
											"activity": "Lookup_Incremental",
											"dependencyConditions": [
												"Succeeded"
											]
										}
									],
									"policy": {
										"timeout": "7.00:00:00",
										"retry": 0,
										"retryIntervalInSeconds": 30,
										"secureOutput": false,
										"secureInput": false
									},
									"userProperties": [],
									"typeProperties": {
										"source": {
											"type": "AzureSqlSource",
											"sqlReaderStoredProcedureName": "[dbo].[proc_StartAuditLog_Briggs]",
											"storedProcedureParameters": {
												"ConfigTableID": {
													"type": "Int32",
													"value": {
														"value": "@item().ID_Inc",
														"type": "Expression"
													}
												},
												"DataFactoryName": {
													"type": "String",
													"value": {
														"value": "@pipeline().DataFactory",
														"type": "Expression"
													}
												},
												"ParentAuditID": {
													"type": "Int64",
													"value": {
														"value": "@item().ID_Inc",
														"type": "Expression"
													}
												},
												"PipelineName": {
													"type": "String",
													"value": {
														"value": "@pipeline().Pipeline",
														"type": "Expression"
													}
												},
												"PipelineRunID": {
													"type": "String",
													"value": {
														"value": "@pipeline().RunId",
														"type": "Expression"
													}
												},
												"PipelineTriggerID": {
													"type": "String",
													"value": {
														"value": "@pipeline().TriggerId",
														"type": "Expression"
													}
												},
												"PipelineTriggerName": {
													"type": "String",
													"value": {
														"value": "@pipeline().TriggerName",
														"type": "Expression"
													}
												},
												"PipelineTriggerType": {
													"type": "String",
													"value": {
														"value": "@pipeline().TriggerType",
														"type": "Expression"
													}
												},
												"Sourcedb": {
													"type": "String",
													"value": {
														"value": "@item().sourceDB",
														"type": "Expression"
													}
												},
												"sourcetable": {
													"type": "String",
													"value": {
														"value": "@item().SourcetableName",
														"type": "Expression"
													}
												}
											},
											"queryTimeout": "02:00:00",
											"partitionOption": "None"
										},
										"dataset": {
											"referenceName": "Briggs_MDW",
											"type": "DatasetReference",
											"parameters": {
												"schema_name": "dbo",
												"table_name": "user"
											}
										},
										"firstRowOnly": false
									}
								},
								{
									"name": "Success_Audit_Log1",
									"type": "SqlServerStoredProcedure",
									"dependsOn": [
										{
											"activity": "Copy_Briggs_Inc_ADLS",
											"dependencyConditions": [
												"Succeeded"
											]
										}
									],
									"policy": {
										"timeout": "7.00:00:00",
										"retry": 0,
										"retryIntervalInSeconds": 30,
										"secureOutput": false,
										"secureInput": false
									},
									"userProperties": [],
									"typeProperties": {
										"storedProcedureName": "[dbo].[proc_UpdateAuditLog_Briggs]",
										"storedProcedureParameters": {
											"ConfigTableID": {
												"value": {
													"value": "@item().ID_Inc",
													"type": "Expression"
												},
												"type": "Int32"
											},
											"RowsRead": {
												"value": {
													"value": "@activity('Copy_Briggs_Inc_ADLS').output.RowsRead",
													"type": "Expression"
												},
												"type": "Int64"
											},
											"Status": {
												"value": "Success",
												"type": "String"
											}
										}
									},
									"linkedServiceName": {
										"referenceName": "DS_MDW_SP",
										"type": "LinkedServiceReference"
									}
								},
								{
									"name": "Success_Audit_Log2",
									"type": "SqlServerStoredProcedure",
									"dependsOn": [
										{
											"activity": "Copy_Briggs_Inc_ADLS_New",
											"dependencyConditions": [
												"Succeeded"
											]
										}
									],
									"policy": {
										"timeout": "7.00:00:00",
										"retry": 0,
										"retryIntervalInSeconds": 30,
										"secureOutput": false,
										"secureInput": false
									},
									"userProperties": [],
									"typeProperties": {
										"storedProcedureName": "[dbo].[proc_UpdateAuditLog_Briggs]",
										"storedProcedureParameters": {
											"ConfigTableID": {
												"value": {
													"value": "@item().ID_Inc",
													"type": "Expression"
												},
												"type": "Int32"
											},
											"RowsRead": {
												"value": {
													"value": "@activity('Copy_Briggs_Inc_ADLS_New').output.RowsRead",
													"type": "Expression"
												},
												"type": "Int64"
											},
											"Status": {
												"value": "Success",
												"type": "String"
											}
										}
									},
									"linkedServiceName": {
										"referenceName": "DS_MDW_SP",
										"type": "LinkedServiceReference"
									}
								},
								{
									"name": "Failure_Audit_Log2",
									"type": "SqlServerStoredProcedure",
									"dependsOn": [
										{
											"activity": "Set variable1",
											"dependencyConditions": [
												"Succeeded"
											]
										}
									],
									"policy": {
										"timeout": "7.00:00:00",
										"retry": 0,
										"retryIntervalInSeconds": 30,
										"secureOutput": false,
										"secureInput": false
									},
									"userProperties": [],
									"typeProperties": {
										"storedProcedureName": "[dbo].[proc_UpdateAuditLog_Briggs]",
										"storedProcedureParameters": {
											"ConfigTableID": {
												"value": {
													"value": "@item().ID_Inc",
													"type": "Expression"
												},
												"type": "Int32"
											},
											"RowsRead": {
												"value": null,
												"type": "Int64"
											},
											"Status": {
												"value": {
													"value": "@variables('ErrorMsgInc')",
													"type": "Expression"
												},
												"type": "String"
											}
										}
									},
									"linkedServiceName": {
										"referenceName": "DS_MDW_SP",
										"type": "LinkedServiceReference"
									}
								},
								{
									"name": "Set variable1",
									"type": "SetVariable",
									"dependsOn": [
										{
											"activity": "Copy_Briggs_Inc_ADLS",
											"dependencyConditions": [
												"Failed"
											]
										},
										{
											"activity": "Copy_Briggs_Inc_ADLS_New",
											"dependencyConditions": [
												"Failed"
											]
										}
									],
									"userProperties": [],
									"typeProperties": {
										"variableName": "ErrorMsgInc",
										"value": {
											"value": "@activity('Copy_Briggs_Inc_ADLS').Error.Message",
											"type": "Expression"
										}
									}
								}
							]
						}
					},
					{
						"name": "ForEach_Full_Load",
						"type": "ForEach",
						"dependsOn": [
							{
								"activity": "Lookup2_Full",
								"dependencyConditions": [
									"Succeeded"
								]
							}
						],
						"userProperties": [],
						"typeProperties": {
							"items": {
								"value": "@activity('Lookup2_Full').output.value",
								"type": "Expression"
							},
							"activities": [
								{
									"name": "Lookup_Full",
									"type": "Lookup",
									"dependsOn": [],
									"policy": {
										"timeout": "7.00:00:00",
										"retry": 0,
										"retryIntervalInSeconds": 30,
										"secureOutput": false,
										"secureInput": false
									},
									"userProperties": [],
									"typeProperties": {
										"source": {
											"type": "AzureSqlSource",
											"sqlReaderQuery": {
												"value": "@concat('select SourceQuery=''select '' +columnList+ '' from ''+ sourceDB+''.''+SourceSchemaName+''.''+SourcetableName\n,SourceDB\n,TargetContainer\n, TargetPath, TargetFile, FileFormat,DateField,LastDate,targetstagetableschema,targetstagetablename\nfrom dbo.control_table\nwhere ID= ',item().ID_Full)",
												"type": "Expression"
											},
											"queryTimeout": "02:00:00",
											"partitionOption": "None"
										},
										"dataset": {
											"referenceName": "Briggs_MDW",
											"type": "DatasetReference",
											"parameters": {
												"schema_name": "dbo",
												"table_name": "user"
											}
										}
									}
								},
								{
									"name": "Copy_Briggs_Full_ADLS",
									"type": "Copy",
									"dependsOn": [
										{
											"activity": "Start_Table_Audit",
											"dependencyConditions": [
												"Succeeded"
											]
										}
									],
									"policy": {
										"timeout": "7.00:00:00",
										"retry": 0,
										"retryIntervalInSeconds": 30,
										"secureOutput": false,
										"secureInput": false
									},
									"userProperties": [],
									"typeProperties": {
										"source": {
											"type": "SqlServerSource",
											"sqlReaderQuery": {
												"value": "@activity('Lookup_Full').output.firstRow.SourceQuery\n",
												"type": "Expression"
											},
											"queryTimeout": "02:00:00",
											"partitionOption": "None"
										},
										"sink": {
											"type": "AzureSqlSink",
											"preCopyScript": {
												"value": "@{concat('truncate table ',activity('Lookup_Full').output.firstRow.TargetStageTableSchema,'.',activity('Lookup_Full').output.firstRow.TargetStageTableName)}",
												"type": "Expression"
											},
											"disableMetricsCollection": false
										},
										"enableStaging": false,
										"translator": {
											"type": "TabularTranslator",
											"typeConversion": true,
											"typeConversionSettings": {
												"allowDataTruncation": true,
												"treatBooleanAsNumber": false
											}
										}
									},
									"inputs": [
										{
											"referenceName": "DS_Briggs_MST",
											"type": "DatasetReference",
											"parameters": {}
										}
									],
									"outputs": [
										{
											"referenceName": "Briggs_MDW",
											"type": "DatasetReference",
											"parameters": {
												"schema_name": {
													"value": "@activity('Lookup_Full').output.firstRow.TargetStageTableSchema",
													"type": "Expression"
												},
												"table_name": {
													"value": "@activity('Lookup_Full').output.firstRow.TargetStageTableName",
													"type": "Expression"
												}
											}
										}
									]
								},
								{
									"name": "Copy_Briggs_Full_ADLS_New",
									"type": "Copy",
									"dependsOn": [
										{
											"activity": "Copy_Briggs_Full_ADLS",
											"dependencyConditions": [
												"Failed"
											]
										}
									],
									"policy": {
										"timeout": "7.00:00:00",
										"retry": 0,
										"retryIntervalInSeconds": 30,
										"secureOutput": false,
										"secureInput": false
									},
									"userProperties": [],
									"typeProperties": {
										"source": {
											"type": "SqlServerSource",
											"sqlReaderQuery": {
												"value": "@activity('Lookup_Full').output.firstRow.SourceQuery\n",
												"type": "Expression"
											},
											"queryTimeout": "02:00:00",
											"partitionOption": "None"
										},
										"sink": {
											"type": "AzureSqlSink",
											"writeBehavior": "insert",
											"sqlWriterUseTableLock": false,
											"tableOption": "autoCreate",
											"disableMetricsCollection": false
										},
										"enableStaging": false,
										"translator": {
											"type": "TabularTranslator",
											"typeConversion": true,
											"typeConversionSettings": {
												"allowDataTruncation": true,
												"treatBooleanAsNumber": false
											}
										}
									},
									"inputs": [
										{
											"referenceName": "DS_Briggs_MST",
											"type": "DatasetReference",
											"parameters": {}
										}
									],
									"outputs": [
										{
											"referenceName": "Briggs_MDW",
											"type": "DatasetReference",
											"parameters": {
												"schema_name": {
													"value": "@activity('Lookup_Full').output.firstRow.TargetStageTableSchema",
													"type": "Expression"
												},
												"table_name": {
													"value": "@activity('Lookup_Full').output.firstRow.TargetStageTableName",
													"type": "Expression"
												}
											}
										}
									]
								},
								{
									"name": "Start_Table_Audit",
									"type": "Lookup",
									"dependsOn": [
										{
											"activity": "Lookup_Full",
											"dependencyConditions": [
												"Succeeded"
											]
										}
									],
									"policy": {
										"timeout": "7.00:00:00",
										"retry": 0,
										"retryIntervalInSeconds": 30,
										"secureOutput": false,
										"secureInput": false
									},
									"userProperties": [],
									"typeProperties": {
										"source": {
											"type": "AzureSqlSource",
											"sqlReaderStoredProcedureName": "[dbo].[proc_StartAuditLog_Briggs]",
											"storedProcedureParameters": {
												"ConfigTableID": {
													"type": "Int32",
													"value": {
														"value": "@item().ID_Full",
														"type": "Expression"
													}
												},
												"DataFactoryName": {
													"type": "String",
													"value": {
														"value": "@pipeline().DataFactory",
														"type": "Expression"
													}
												},
												"ParentAuditID": {
													"type": "Int64",
													"value": {
														"value": "@item().ID_Full",
														"type": "Expression"
													}
												},
												"PipelineName": {
													"type": "String",
													"value": {
														"value": "@pipeline().Pipeline",
														"type": "Expression"
													}
												},
												"PipelineRunID": {
													"type": "String",
													"value": {
														"value": "@pipeline().RunId",
														"type": "Expression"
													}
												},
												"PipelineTriggerID": {
													"type": "String",
													"value": {
														"value": "@pipeline().TriggerId",
														"type": "Expression"
													}
												},
												"PipelineTriggerName": {
													"type": "String",
													"value": {
														"value": "@pipeline().TriggerName",
														"type": "Expression"
													}
												},
												"PipelineTriggerType": {
													"type": "String",
													"value": {
														"value": "@pipeline().TriggerType",
														"type": "Expression"
													}
												},
												"Sourcedb": {
													"type": "String",
													"value": {
														"value": "@item().sourceDB",
														"type": "Expression"
													}
												},
												"sourcetable": {
													"type": "String",
													"value": {
														"value": "@item().SourcetableName",
														"type": "Expression"
													}
												}
											},
											"queryTimeout": "02:00:00",
											"partitionOption": "None"
										},
										"dataset": {
											"referenceName": "Briggs_MDW",
											"type": "DatasetReference",
											"parameters": {
												"schema_name": "dbo",
												"table_name": "user"
											}
										},
										"firstRowOnly": false
									}
								},
								{
									"name": "Success_Audit_Log",
									"type": "SqlServerStoredProcedure",
									"dependsOn": [
										{
											"activity": "Copy_Briggs_Full_ADLS",
											"dependencyConditions": [
												"Succeeded"
											]
										}
									],
									"policy": {
										"timeout": "7.00:00:00",
										"retry": 0,
										"retryIntervalInSeconds": 30,
										"secureOutput": false,
										"secureInput": false
									},
									"userProperties": [],
									"typeProperties": {
										"storedProcedureName": "[dbo].[proc_UpdateAuditLog_Briggs]",
										"storedProcedureParameters": {
											"ConfigTableID": {
												"value": {
													"value": "@item().ID_Full",
													"type": "Expression"
												},
												"type": "Int32"
											},
											"RowsRead": {
												"value": {
													"value": "@activity('Copy_Briggs_Full_ADLS').output.RowsRead",
													"type": "Expression"
												},
												"type": "Int64"
											},
											"Status": {
												"value": "Success",
												"type": "String"
											}
										}
									},
									"linkedServiceName": {
										"referenceName": "DS_MDW_SP",
										"type": "LinkedServiceReference"
									}
								},
								{
									"name": "Success_Audit_Log_New",
									"type": "SqlServerStoredProcedure",
									"dependsOn": [
										{
											"activity": "Copy_Briggs_Full_ADLS_New",
											"dependencyConditions": [
												"Succeeded"
											]
										}
									],
									"policy": {
										"timeout": "7.00:00:00",
										"retry": 0,
										"retryIntervalInSeconds": 30,
										"secureOutput": false,
										"secureInput": false
									},
									"userProperties": [],
									"typeProperties": {
										"storedProcedureName": "[dbo].[proc_UpdateAuditLog_Briggs]",
										"storedProcedureParameters": {
											"ConfigTableID": {
												"value": {
													"value": "@item().ID_Full",
													"type": "Expression"
												},
												"type": "Int32"
											},
											"RowsRead": {
												"value": {
													"value": "@activity('Copy_Briggs_Full_ADLS_New').output.RowsRead",
													"type": "Expression"
												},
												"type": "Int64"
											},
											"Status": {
												"value": "Success",
												"type": "String"
											}
										}
									},
									"linkedServiceName": {
										"referenceName": "DS_MDW_SP",
										"type": "LinkedServiceReference"
									}
								},
								{
									"name": "Failure_Audit_Log_New",
									"type": "SqlServerStoredProcedure",
									"dependsOn": [
										{
											"activity": "Set variable2",
											"dependencyConditions": [
												"Succeeded"
											]
										}
									],
									"policy": {
										"timeout": "7.00:00:00",
										"retry": 0,
										"retryIntervalInSeconds": 30,
										"secureOutput": false,
										"secureInput": false
									},
									"userProperties": [],
									"typeProperties": {
										"storedProcedureName": "[dbo].[proc_UpdateAuditLog_Briggs]",
										"storedProcedureParameters": {
											"ConfigTableID": {
												"value": {
													"value": "@item().ID_Full",
													"type": "Expression"
												},
												"type": "Int32"
											},
											"RowsRead": {
												"value": null,
												"type": "Int64"
											},
											"Status": {
												"value": {
													"value": "@variables('ErrorMsgFull')",
													"type": "Expression"
												},
												"type": "String"
											}
										}
									},
									"linkedServiceName": {
										"referenceName": "DS_MDW_SP",
										"type": "LinkedServiceReference"
									}
								},
								{
									"name": "Set variable2",
									"type": "SetVariable",
									"dependsOn": [
										{
											"activity": "Copy_Briggs_Full_ADLS",
											"dependencyConditions": [
												"Failed"
											]
										},
										{
											"activity": "Copy_Briggs_Full_ADLS_New",
											"dependencyConditions": [
												"Failed"
											]
										}
									],
									"userProperties": [],
									"typeProperties": {
										"variableName": "ErrorMsgFull",
										"value": {
											"value": "@activity('Copy_Briggs_Full_ADLS').Error.Message",
											"type": "Expression"
										}
									}
								}
							]
						}
					},
					{
						"name": "ForEach_Proc_Inc",
						"type": "ForEach",
						"dependsOn": [
							{
								"activity": "ForEach_Incremental_Load",
								"dependencyConditions": [
									"Succeeded"
								]
							}
						],
						"userProperties": [],
						"typeProperties": {
							"items": {
								"value": "@activity('Lookup1_Incremental').output.value",
								"type": "Expression"
							},
							"activities": [
								{
									"name": "Stored procedure1_copy1",
									"type": "SqlServerStoredProcedure",
									"dependsOn": [],
									"policy": {
										"timeout": "7.00:00:00",
										"retry": 0,
										"retryIntervalInSeconds": 30,
										"secureOutput": false,
										"secureInput": false
									},
									"userProperties": [],
									"typeProperties": {
										"storedProcedureName": "[dbo].[USP_Control_Table_LastDate]",
										"storedProcedureParameters": {
											"id_I_F": {
												"value": {
													"value": "@item().ID_Inc",
													"type": "Expression"
												},
												"type": "Int32"
											}
										}
									},
									"linkedServiceName": {
										"referenceName": "DS_MDW_SP",
										"type": "LinkedServiceReference"
									}
								}
							]
						}
					},
					{
						"name": "ForEach_Proc_Full",
						"type": "ForEach",
						"dependsOn": [
							{
								"activity": "ForEach_Full_Load",
								"dependencyConditions": [
									"Succeeded"
								]
							}
						],
						"userProperties": [],
						"typeProperties": {
							"items": {
								"value": "@activity('Lookup2_Full').output.value",
								"type": "Expression"
							},
							"activities": [
								{
									"name": "Stored procedure1",
									"type": "SqlServerStoredProcedure",
									"dependsOn": [],
									"policy": {
										"timeout": "7.00:00:00",
										"retry": 0,
										"retryIntervalInSeconds": 30,
										"secureOutput": false,
										"secureInput": false
									},
									"userProperties": [],
									"typeProperties": {
										"storedProcedureName": "[dbo].[USP_Control_Table_LastDate]",
										"storedProcedureParameters": {
											"id_I_F": {
												"value": {
													"value": "@item().ID_Full",
													"type": "Expression"
												},
												"type": "Int32"
											}
										}
									},
									"linkedServiceName": {
										"referenceName": "DS_MDW_SP",
										"type": "LinkedServiceReference"
									}
								}
							]
						}
					},
					{
						"name": "Sp_ExecFailureAudit_Full",
						"type": "SqlServerStoredProcedure",
						"dependsOn": [
							{
								"activity": "ForEach_Full_Load",
								"dependencyConditions": [
									"Failed"
								]
							}
						],
						"policy": {
							"timeout": "7.00:00:00",
							"retry": 0,
							"retryIntervalInSeconds": 30,
							"secureOutput": false,
							"secureInput": false
						},
						"userProperties": [],
						"typeProperties": {
							"storedProcedureName": "[dbo].[proc_UpdateAuditLog]",
							"storedProcedureParameters": {
								"AuditID": {
									"value": {
										"value": "@activity('lkp_ExecStartAuditProc').output.firstRow.AuditID",
										"type": "Expression"
									},
									"type": "Int32"
								},
								"DataLakePath": {
									"value": null,
									"type": "String"
								},
								"PipelineRunID": {
									"value": {
										"value": "@pipeline().RunId",
										"type": "Expression"
									},
									"type": "String"
								},
								"RowsRead": {
									"value": null,
									"type": "Int64"
								},
								"Status": {
									"value": "Full Load Failed",
									"type": "String"
								}
							}
						},
						"linkedServiceName": {
							"referenceName": "AzureSqlDatabase1",
							"type": "LinkedServiceReference"
						}
					},
					{
						"name": "Sp_ExecSuccessAudit",
						"type": "SqlServerStoredProcedure",
						"dependsOn": [
							{
								"activity": "ForEach_Proc_Inc",
								"dependencyConditions": [
									"Succeeded"
								]
							},
							{
								"activity": "ForEach_Proc_Full",
								"dependencyConditions": [
									"Succeeded"
								]
							}
						],
						"policy": {
							"timeout": "7.00:00:00",
							"retry": 0,
							"retryIntervalInSeconds": 30,
							"secureOutput": false,
							"secureInput": false
						},
						"userProperties": [],
						"typeProperties": {
							"storedProcedureName": "[dbo].[proc_UpdateAuditLog]",
							"storedProcedureParameters": {
								"AuditID": {
									"value": {
										"value": "@activity('lkp_ExecStartAuditProc').output.firstRow.AuditID",
										"type": "Expression"
									},
									"type": "Int32"
								},
								"DataLakePath": {
									"value": null,
									"type": "String"
								},
								"RowsRead": {
									"value": null,
									"type": "Int64"
								},
								"Status": {
									"value": "Success",
									"type": "String"
								},
								"PipelineRunID": {
									"value": {
										"value": "@pipeline().RunId",
										"type": "Expression"
									},
									"type": "String"
								}
							}
						},
						"linkedServiceName": {
							"referenceName": "AzureSqlDatabase1",
							"type": "LinkedServiceReference"
						}
					},
					{
						"name": "Sp_ExecFailureAudit_Inc",
						"type": "SqlServerStoredProcedure",
						"dependsOn": [
							{
								"activity": "ForEach_Incremental_Load",
								"dependencyConditions": [
									"Failed"
								]
							}
						],
						"policy": {
							"timeout": "7.00:00:00",
							"retry": 0,
							"retryIntervalInSeconds": 30,
							"secureOutput": false,
							"secureInput": false
						},
						"userProperties": [],
						"typeProperties": {
							"storedProcedureName": "[dbo].[proc_UpdateAuditLog]",
							"storedProcedureParameters": {
								"AuditID": {
									"value": {
										"value": "@activity('lkp_ExecStartAuditProc').output.firstRow.AuditID",
										"type": "Expression"
									},
									"type": "Int32"
								},
								"DataLakePath": {
									"value": null,
									"type": "String"
								},
								"PipelineRunID": {
									"value": {
										"value": "@pipeline().RunId",
										"type": "Expression"
									},
									"type": "String"
								},
								"RowsRead": {
									"value": null,
									"type": "Int64"
								},
								"Status": {
									"value": "Incr Load Failed",
									"type": "String"
								}
							}
						},
						"linkedServiceName": {
							"referenceName": "AzureSqlDatabase1",
							"type": "LinkedServiceReference"
						}
					},
					{
						"name": "lkp_ExecStartAuditProc",
						"type": "Lookup",
						"dependsOn": [],
						"policy": {
							"timeout": "7.00:00:00",
							"retry": 0,
							"retryIntervalInSeconds": 30,
							"secureOutput": false,
							"secureInput": false
						},
						"userProperties": [],
						"typeProperties": {
							"source": {
								"type": "AzureSqlSource",
								"sqlReaderStoredProcedureName": "[dbo].[proc_StartAuditLog]",
								"storedProcedureParameters": {
									"ConfigTableID": {
										"type": "Int32",
										"value": "-1"
									},
									"DataFactoryName": {
										"type": "String",
										"value": {
											"value": "@pipeline().DataFactory",
											"type": "Expression"
										}
									},
									"ParentAuditID": {
										"type": "Int64",
										"value": "-1"
									},
									"PipelineName": {
										"type": "String",
										"value": {
											"value": "@concat(pipeline().Pipeline,' Billing Source Table Load')",
											"type": "Expression"
										}
									},
									"PipelineRunID": {
										"type": "String",
										"value": {
											"value": "@pipeline().RunId",
											"type": "Expression"
										}
									},
									"PipelineTriggerID": {
										"type": "String",
										"value": {
											"value": "@pipeline().TriggerId",
											"type": "Expression"
										}
									},
									"PipelineTriggerName": {
										"type": "String",
										"value": {
											"value": "@pipeline().TriggerName",
											"type": "Expression"
										}
									},
									"PipelineTriggerType": {
										"type": "String",
										"value": {
											"value": "@pipeline().TriggerType",
											"type": "Expression"
										}
									}
								},
								"queryTimeout": "02:00:00",
								"partitionOption": "None"
							},
							"dataset": {
								"referenceName": "Briggs_MDW",
								"type": "DatasetReference",
								"parameters": {
									"schema_name": "dbo",
									"table_name": "user"
								}
							}
						}
					}
				],
				"policy": {
					"elapsedTimeMetric": {},
					"cancelAfter": {}
				},
				"variables": {
					"ErrorMsgInc": {
						"type": "String"
					},
					"ErrorMsgFull": {
						"type": "String"
					}
				},
				"folder": {
					"name": "Briggs Data Load Theme wise"
				},
				"annotations": [],
				"lastPublishTime": "2022-04-26T06:37:17Z"
			},
			"dependsOn": [
				"[concat(variables('workspaceId'), '/datasets/Briggs_MDW')]",
				"[concat(variables('workspaceId'), '/linkedServices/AzureSqlDatabase1')]",
				"[concat(variables('workspaceId'), '/datasets/DS_Briggs_MST')]",
				"[concat(variables('workspaceId'), '/linkedServices/DS_MDW_SP')]"
			]
		},
		{
			"name": "[concat(parameters('workspaceName'), '/PL_Generic_Copy_Commission')]",
			"type": "Microsoft.Synapse/workspaces/pipelines",
			"apiVersion": "2019-06-01-preview",
			"properties": {
				"activities": [
					{
						"name": "Lookup1_Incremental",
						"type": "Lookup",
						"dependsOn": [
							{
								"activity": "lkp_ExecStartAuditProc",
								"dependencyConditions": [
									"Succeeded"
								]
							}
						],
						"policy": {
							"timeout": "7.00:00:00",
							"retry": 0,
							"retryIntervalInSeconds": 30,
							"secureOutput": false,
							"secureInput": false
						},
						"userProperties": [],
						"typeProperties": {
							"source": {
								"type": "AzureSqlSource",
								"sqlReaderQuery": "Select Distinct ID ID_Inc,sourcedb,sourcetablename From dbo.control_table Where ProcessName = 'AzSQL_ADLS'  \nAND DataLoadType = 'Incremental'  and EnableAction = 1  \nand (format(refresh_date,'dd-MM-yyyy') <> format(getdate(),'dd-MM-yyyy') or refresh_date is null)\nand subjectarea like '%Sales Commission%' and id <> 253 \norder by 1 ",
								"queryTimeout": "02:00:00",
								"partitionOption": "None"
							},
							"dataset": {
								"referenceName": "Briggs_MDW",
								"type": "DatasetReference",
								"parameters": {
									"schema_name": "dbo",
									"table_name": "user"
								}
							},
							"firstRowOnly": false
						}
					},
					{
						"name": "Lookup2_Full",
						"type": "Lookup",
						"dependsOn": [
							{
								"activity": "lkp_ExecStartAuditProc",
								"dependencyConditions": [
									"Succeeded"
								]
							}
						],
						"policy": {
							"timeout": "7.00:00:00",
							"retry": 0,
							"retryIntervalInSeconds": 30,
							"secureOutput": false,
							"secureInput": false
						},
						"userProperties": [],
						"typeProperties": {
							"source": {
								"type": "AzureSqlSource",
								"sqlReaderQuery": "Select Distinct ID ID_Full,sourcedb,sourcetablename From dbo.control_table Where ProcessName = 'AzSQL_ADLS'  \nAND DataLoadType = 'Full'  and EnableAction = 1 and subjectarea like '%Sales Commission%' \nand (format(refresh_date,'dd-MM-yyyy') <> format(getdate(),'dd-MM-yyyy') or refresh_date is null)\norder by 1 ",
								"queryTimeout": "02:00:00",
								"partitionOption": "None"
							},
							"dataset": {
								"referenceName": "Briggs_MDW",
								"type": "DatasetReference",
								"parameters": {
									"schema_name": "dbo",
									"table_name": "user"
								}
							},
							"firstRowOnly": false
						}
					},
					{
						"name": "ForEach_Incremental_Load",
						"type": "ForEach",
						"dependsOn": [
							{
								"activity": "Lookup1_Incremental",
								"dependencyConditions": [
									"Succeeded"
								]
							}
						],
						"userProperties": [],
						"typeProperties": {
							"items": {
								"value": "@activity('Lookup1_Incremental').output.value",
								"type": "Expression"
							},
							"activities": [
								{
									"name": "Lookup_Incremental",
									"type": "Lookup",
									"dependsOn": [],
									"policy": {
										"timeout": "7.00:00:00",
										"retry": 0,
										"retryIntervalInSeconds": 30,
										"secureOutput": false,
										"secureInput": false
									},
									"userProperties": [],
									"typeProperties": {
										"source": {
											"type": "AzureSqlSource",
											"sqlReaderQuery": {
												"value": "@concat('select SourceQuery=''select '' +columnList+ '' from ''+ sourceDB+''.''+SourceSchemaName+''.''+SourcetableName + '' where \ncast(''+DateField+'' as date) >=''''''+LastDate+''''''''\n,SourceDB\n,TargetContainer\n, TargetPath, TargetFile, FileFormat,DateField,LastDate,targetstagetableschema,targetstagetablename\nfrom dbo.control_table\nwhere ID= ',item().ID_Inc)",
												"type": "Expression"
											},
											"queryTimeout": "02:00:00",
											"partitionOption": "None"
										},
										"dataset": {
											"referenceName": "Briggs_MDW",
											"type": "DatasetReference",
											"parameters": {
												"schema_name": "dbo",
												"table_name": "user"
											}
										}
									}
								},
								{
									"name": "Copy_Briggs_Inc_ADLS",
									"type": "Copy",
									"dependsOn": [
										{
											"activity": "Start_Table_Audit1",
											"dependencyConditions": [
												"Succeeded"
											]
										}
									],
									"policy": {
										"timeout": "7.00:00:00",
										"retry": 0,
										"retryIntervalInSeconds": 30,
										"secureOutput": false,
										"secureInput": false
									},
									"userProperties": [],
									"typeProperties": {
										"source": {
											"type": "SqlServerSource",
											"sqlReaderQuery": {
												"value": "@activity('Lookup_Incremental').output.firstRow.SourceQuery\n",
												"type": "Expression"
											},
											"queryTimeout": "02:00:00",
											"partitionOption": "None"
										},
										"sink": {
											"type": "AzureSqlSink",
											"preCopyScript": {
												"value": "@{concat('delete from ',activity('Lookup_Incremental').output.firstRow.TargetStageTableSchema,'.',activity('Lookup_Incremental').output.firstRow.targetstagetablename,' where cast(',activity('Lookup_Incremental').output.firstRow.DateField,' as date)=','''',activity('Lookup_Incremental').output.firstRow.LastDate,'''')}",
												"type": "Expression"
											},
											"disableMetricsCollection": false
										},
										"enableStaging": false,
										"translator": {
											"type": "TabularTranslator",
											"typeConversion": true,
											"typeConversionSettings": {
												"allowDataTruncation": true,
												"treatBooleanAsNumber": false
											}
										}
									},
									"inputs": [
										{
											"referenceName": "DS_Briggs_MST",
											"type": "DatasetReference",
											"parameters": {}
										}
									],
									"outputs": [
										{
											"referenceName": "Briggs_MDW",
											"type": "DatasetReference",
											"parameters": {
												"schema_name": {
													"value": "@activity('Lookup_Incremental').output.firstRow.TargetStageTableSchema",
													"type": "Expression"
												},
												"table_name": {
													"value": "@activity('Lookup_Incremental').output.firstRow.TargetStageTableName",
													"type": "Expression"
												}
											}
										}
									]
								},
								{
									"name": "Copy_Briggs_Inc_ADLS_New",
									"type": "Copy",
									"dependsOn": [
										{
											"activity": "Copy_Briggs_Inc_ADLS",
											"dependencyConditions": [
												"Failed"
											]
										}
									],
									"policy": {
										"timeout": "7.00:00:00",
										"retry": 0,
										"retryIntervalInSeconds": 30,
										"secureOutput": false,
										"secureInput": false
									},
									"userProperties": [],
									"typeProperties": {
										"source": {
											"type": "SqlServerSource",
											"sqlReaderQuery": {
												"value": "@activity('Lookup_Incremental').output.firstRow.SourceQuery\n",
												"type": "Expression"
											},
											"queryTimeout": "02:00:00",
											"partitionOption": "None"
										},
										"sink": {
											"type": "AzureSqlSink",
											"writeBehavior": "insert",
											"sqlWriterUseTableLock": false,
											"tableOption": "autoCreate",
											"disableMetricsCollection": false
										},
										"enableStaging": false,
										"translator": {
											"type": "TabularTranslator",
											"typeConversion": true,
											"typeConversionSettings": {
												"allowDataTruncation": true,
												"treatBooleanAsNumber": false
											}
										}
									},
									"inputs": [
										{
											"referenceName": "DS_Briggs_MST",
											"type": "DatasetReference",
											"parameters": {}
										}
									],
									"outputs": [
										{
											"referenceName": "Briggs_MDW",
											"type": "DatasetReference",
											"parameters": {
												"schema_name": {
													"value": "@activity('Lookup_Incremental').output.firstRow.TargetStageTableSchema",
													"type": "Expression"
												},
												"table_name": {
													"value": "@activity('Lookup_Incremental').output.firstRow.TargetStageTableName",
													"type": "Expression"
												}
											}
										}
									]
								},
								{
									"name": "Start_Table_Audit1",
									"type": "Lookup",
									"dependsOn": [
										{
											"activity": "Lookup_Incremental",
											"dependencyConditions": [
												"Succeeded"
											]
										}
									],
									"policy": {
										"timeout": "7.00:00:00",
										"retry": 0,
										"retryIntervalInSeconds": 30,
										"secureOutput": false,
										"secureInput": false
									},
									"userProperties": [],
									"typeProperties": {
										"source": {
											"type": "AzureSqlSource",
											"sqlReaderStoredProcedureName": "[dbo].[proc_StartAuditLog_Briggs]",
											"storedProcedureParameters": {
												"ConfigTableID": {
													"type": "Int32",
													"value": {
														"value": "@item().ID_Inc",
														"type": "Expression"
													}
												},
												"DataFactoryName": {
													"type": "String",
													"value": {
														"value": "@pipeline().DataFactory",
														"type": "Expression"
													}
												},
												"ParentAuditID": {
													"type": "Int64",
													"value": {
														"value": "@item().ID_Inc",
														"type": "Expression"
													}
												},
												"PipelineName": {
													"type": "String",
													"value": {
														"value": "@pipeline().Pipeline",
														"type": "Expression"
													}
												},
												"PipelineRunID": {
													"type": "String",
													"value": {
														"value": "@pipeline().RunId",
														"type": "Expression"
													}
												},
												"PipelineTriggerID": {
													"type": "String",
													"value": {
														"value": "@pipeline().TriggerId",
														"type": "Expression"
													}
												},
												"PipelineTriggerName": {
													"type": "String",
													"value": {
														"value": "@pipeline().TriggerName",
														"type": "Expression"
													}
												},
												"PipelineTriggerType": {
													"type": "String",
													"value": {
														"value": "@pipeline().TriggerType",
														"type": "Expression"
													}
												},
												"Sourcedb": {
													"type": "String",
													"value": {
														"value": "@item().sourceDB",
														"type": "Expression"
													}
												},
												"sourcetable": {
													"type": "String",
													"value": {
														"value": "@item().SourcetableName",
														"type": "Expression"
													}
												}
											},
											"queryTimeout": "02:00:00",
											"partitionOption": "None"
										},
										"dataset": {
											"referenceName": "Briggs_MDW",
											"type": "DatasetReference",
											"parameters": {
												"schema_name": "dbo",
												"table_name": "user"
											}
										},
										"firstRowOnly": false
									}
								},
								{
									"name": "Success_Audit_Log1",
									"type": "SqlServerStoredProcedure",
									"dependsOn": [
										{
											"activity": "Copy_Briggs_Inc_ADLS",
											"dependencyConditions": [
												"Succeeded"
											]
										}
									],
									"policy": {
										"timeout": "7.00:00:00",
										"retry": 0,
										"retryIntervalInSeconds": 30,
										"secureOutput": false,
										"secureInput": false
									},
									"userProperties": [],
									"typeProperties": {
										"storedProcedureName": "[dbo].[proc_UpdateAuditLog_Briggs]",
										"storedProcedureParameters": {
											"ConfigTableID": {
												"value": {
													"value": "@item().ID_Inc",
													"type": "Expression"
												},
												"type": "Int32"
											},
											"RowsRead": {
												"value": {
													"value": "@activity('Copy_Briggs_Inc_ADLS').output.RowsRead",
													"type": "Expression"
												},
												"type": "Int64"
											},
											"Status": {
												"value": "Success",
												"type": "String"
											}
										}
									},
									"linkedServiceName": {
										"referenceName": "DS_MDW_SP",
										"type": "LinkedServiceReference"
									}
								},
								{
									"name": "Success_Audit_Log2",
									"type": "SqlServerStoredProcedure",
									"dependsOn": [
										{
											"activity": "Copy_Briggs_Inc_ADLS_New",
											"dependencyConditions": [
												"Succeeded"
											]
										}
									],
									"policy": {
										"timeout": "7.00:00:00",
										"retry": 0,
										"retryIntervalInSeconds": 30,
										"secureOutput": false,
										"secureInput": false
									},
									"userProperties": [],
									"typeProperties": {
										"storedProcedureName": "[dbo].[proc_UpdateAuditLog_Briggs]",
										"storedProcedureParameters": {
											"ConfigTableID": {
												"value": {
													"value": "@item().ID_Inc",
													"type": "Expression"
												},
												"type": "Int32"
											},
											"RowsRead": {
												"value": {
													"value": "@activity('Copy_Briggs_Inc_ADLS_New').output.RowsRead",
													"type": "Expression"
												},
												"type": "Int64"
											},
											"Status": {
												"value": "Success",
												"type": "String"
											}
										}
									},
									"linkedServiceName": {
										"referenceName": "DS_MDW_SP",
										"type": "LinkedServiceReference"
									}
								},
								{
									"name": "Failure_Audit_Log2",
									"type": "SqlServerStoredProcedure",
									"dependsOn": [
										{
											"activity": "Set variable1",
											"dependencyConditions": [
												"Succeeded"
											]
										}
									],
									"policy": {
										"timeout": "7.00:00:00",
										"retry": 0,
										"retryIntervalInSeconds": 30,
										"secureOutput": false,
										"secureInput": false
									},
									"userProperties": [],
									"typeProperties": {
										"storedProcedureName": "[dbo].[proc_UpdateAuditLog_Briggs]",
										"storedProcedureParameters": {
											"ConfigTableID": {
												"value": {
													"value": "@item().ID_Inc",
													"type": "Expression"
												},
												"type": "Int32"
											},
											"RowsRead": {
												"value": null,
												"type": "Int64"
											},
											"Status": {
												"value": {
													"value": "@variables('ErrorMsgInc')",
													"type": "Expression"
												},
												"type": "String"
											}
										}
									},
									"linkedServiceName": {
										"referenceName": "DS_MDW_SP",
										"type": "LinkedServiceReference"
									}
								},
								{
									"name": "Set variable1",
									"type": "SetVariable",
									"dependsOn": [
										{
											"activity": "Copy_Briggs_Inc_ADLS",
											"dependencyConditions": [
												"Failed"
											]
										},
										{
											"activity": "Copy_Briggs_Inc_ADLS_New",
											"dependencyConditions": [
												"Failed"
											]
										}
									],
									"userProperties": [],
									"typeProperties": {
										"variableName": "ErrorMsgInc",
										"value": {
											"value": "@activity('Copy_Briggs_Inc_ADLS').Error.Message",
											"type": "Expression"
										}
									}
								}
							]
						}
					},
					{
						"name": "ForEach_Full_Load",
						"type": "ForEach",
						"dependsOn": [
							{
								"activity": "Lookup2_Full",
								"dependencyConditions": [
									"Succeeded"
								]
							}
						],
						"userProperties": [],
						"typeProperties": {
							"items": {
								"value": "@activity('Lookup2_Full').output.value",
								"type": "Expression"
							},
							"activities": [
								{
									"name": "Lookup_Full",
									"type": "Lookup",
									"dependsOn": [],
									"policy": {
										"timeout": "7.00:00:00",
										"retry": 0,
										"retryIntervalInSeconds": 30,
										"secureOutput": false,
										"secureInput": false
									},
									"userProperties": [],
									"typeProperties": {
										"source": {
											"type": "AzureSqlSource",
											"sqlReaderQuery": {
												"value": "@concat('select SourceQuery=''select '' +columnList+ '' from ''+ sourceDB+''.''+SourceSchemaName+''.''+SourcetableName\n,SourceDB\n,TargetContainer\n, TargetPath, TargetFile, FileFormat,DateField,LastDate,targetstagetableschema,targetstagetablename\nfrom dbo.control_table\nwhere ID= ',item().ID_Full)",
												"type": "Expression"
											},
											"queryTimeout": "02:00:00",
											"partitionOption": "None"
										},
										"dataset": {
											"referenceName": "Briggs_MDW",
											"type": "DatasetReference",
											"parameters": {
												"schema_name": "dbo",
												"table_name": "user"
											}
										}
									}
								},
								{
									"name": "Copy_Briggs_Full_ADLS",
									"type": "Copy",
									"dependsOn": [
										{
											"activity": "Start_Table_Audit",
											"dependencyConditions": [
												"Succeeded"
											]
										}
									],
									"policy": {
										"timeout": "7.00:00:00",
										"retry": 0,
										"retryIntervalInSeconds": 30,
										"secureOutput": false,
										"secureInput": false
									},
									"userProperties": [],
									"typeProperties": {
										"source": {
											"type": "SqlServerSource",
											"sqlReaderQuery": {
												"value": "@activity('Lookup_Full').output.firstRow.SourceQuery\n",
												"type": "Expression"
											},
											"queryTimeout": "02:00:00",
											"partitionOption": "None"
										},
										"sink": {
											"type": "AzureSqlSink",
											"preCopyScript": {
												"value": "@{concat('truncate table ',activity('Lookup_Full').output.firstRow.TargetStageTableSchema,'.',activity('Lookup_Full').output.firstRow.TargetStageTableName)}",
												"type": "Expression"
											},
											"disableMetricsCollection": false
										},
										"enableStaging": false,
										"translator": {
											"type": "TabularTranslator",
											"typeConversion": true,
											"typeConversionSettings": {
												"allowDataTruncation": true,
												"treatBooleanAsNumber": false
											}
										}
									},
									"inputs": [
										{
											"referenceName": "DS_Briggs_MST",
											"type": "DatasetReference",
											"parameters": {}
										}
									],
									"outputs": [
										{
											"referenceName": "Briggs_MDW",
											"type": "DatasetReference",
											"parameters": {
												"schema_name": {
													"value": "@activity('Lookup_Full').output.firstRow.TargetStageTableSchema",
													"type": "Expression"
												},
												"table_name": {
													"value": "@activity('Lookup_Full').output.firstRow.TargetStageTableName",
													"type": "Expression"
												}
											}
										}
									]
								},
								{
									"name": "Copy_Briggs_Full_ADLS_New",
									"type": "Copy",
									"dependsOn": [
										{
											"activity": "Copy_Briggs_Full_ADLS",
											"dependencyConditions": [
												"Failed"
											]
										}
									],
									"policy": {
										"timeout": "7.00:00:00",
										"retry": 0,
										"retryIntervalInSeconds": 30,
										"secureOutput": false,
										"secureInput": false
									},
									"userProperties": [],
									"typeProperties": {
										"source": {
											"type": "SqlServerSource",
											"sqlReaderQuery": {
												"value": "@activity('Lookup_Full').output.firstRow.SourceQuery\n",
												"type": "Expression"
											},
											"queryTimeout": "02:00:00",
											"partitionOption": "None"
										},
										"sink": {
											"type": "AzureSqlSink",
											"writeBehavior": "insert",
											"sqlWriterUseTableLock": false,
											"tableOption": "autoCreate",
											"disableMetricsCollection": false
										},
										"enableStaging": false,
										"translator": {
											"type": "TabularTranslator",
											"typeConversion": true,
											"typeConversionSettings": {
												"allowDataTruncation": true,
												"treatBooleanAsNumber": false
											}
										}
									},
									"inputs": [
										{
											"referenceName": "DS_Briggs_MST",
											"type": "DatasetReference",
											"parameters": {}
										}
									],
									"outputs": [
										{
											"referenceName": "Briggs_MDW",
											"type": "DatasetReference",
											"parameters": {
												"schema_name": {
													"value": "@activity('Lookup_Full').output.firstRow.TargetStageTableSchema",
													"type": "Expression"
												},
												"table_name": {
													"value": "@activity('Lookup_Full').output.firstRow.TargetStageTableName",
													"type": "Expression"
												}
											}
										}
									]
								},
								{
									"name": "Start_Table_Audit",
									"type": "Lookup",
									"dependsOn": [
										{
											"activity": "Lookup_Full",
											"dependencyConditions": [
												"Succeeded"
											]
										}
									],
									"policy": {
										"timeout": "7.00:00:00",
										"retry": 0,
										"retryIntervalInSeconds": 30,
										"secureOutput": false,
										"secureInput": false
									},
									"userProperties": [],
									"typeProperties": {
										"source": {
											"type": "AzureSqlSource",
											"sqlReaderStoredProcedureName": "[dbo].[proc_StartAuditLog_Briggs]",
											"storedProcedureParameters": {
												"ConfigTableID": {
													"type": "Int32",
													"value": {
														"value": "@item().ID_Full",
														"type": "Expression"
													}
												},
												"DataFactoryName": {
													"type": "String",
													"value": {
														"value": "@pipeline().DataFactory",
														"type": "Expression"
													}
												},
												"ParentAuditID": {
													"type": "Int64",
													"value": {
														"value": "@item().ID_Full",
														"type": "Expression"
													}
												},
												"PipelineName": {
													"type": "String",
													"value": {
														"value": "@pipeline().Pipeline",
														"type": "Expression"
													}
												},
												"PipelineRunID": {
													"type": "String",
													"value": {
														"value": "@pipeline().RunId",
														"type": "Expression"
													}
												},
												"PipelineTriggerID": {
													"type": "String",
													"value": {
														"value": "@pipeline().TriggerId",
														"type": "Expression"
													}
												},
												"PipelineTriggerName": {
													"type": "String",
													"value": {
														"value": "@pipeline().TriggerName",
														"type": "Expression"
													}
												},
												"PipelineTriggerType": {
													"type": "String",
													"value": {
														"value": "@pipeline().TriggerType",
														"type": "Expression"
													}
												},
												"Sourcedb": {
													"type": "String",
													"value": {
														"value": "@item().sourceDB",
														"type": "Expression"
													}
												},
												"sourcetable": {
													"type": "String",
													"value": {
														"value": "@item().SourcetableName",
														"type": "Expression"
													}
												}
											},
											"queryTimeout": "02:00:00",
											"partitionOption": "None"
										},
										"dataset": {
											"referenceName": "Briggs_MDW",
											"type": "DatasetReference",
											"parameters": {
												"schema_name": "dbo",
												"table_name": "user"
											}
										},
										"firstRowOnly": false
									}
								},
								{
									"name": "Success_Audit_Log",
									"type": "SqlServerStoredProcedure",
									"dependsOn": [
										{
											"activity": "Copy_Briggs_Full_ADLS",
											"dependencyConditions": [
												"Succeeded"
											]
										}
									],
									"policy": {
										"timeout": "7.00:00:00",
										"retry": 0,
										"retryIntervalInSeconds": 30,
										"secureOutput": false,
										"secureInput": false
									},
									"userProperties": [],
									"typeProperties": {
										"storedProcedureName": "[dbo].[proc_UpdateAuditLog_Briggs]",
										"storedProcedureParameters": {
											"ConfigTableID": {
												"value": {
													"value": "@item().ID_Full",
													"type": "Expression"
												},
												"type": "Int32"
											},
											"RowsRead": {
												"value": {
													"value": "@activity('Copy_Briggs_Full_ADLS').output.RowsRead",
													"type": "Expression"
												},
												"type": "Int64"
											},
											"Status": {
												"value": "Success",
												"type": "String"
											}
										}
									},
									"linkedServiceName": {
										"referenceName": "DS_MDW_SP",
										"type": "LinkedServiceReference"
									}
								},
								{
									"name": "Success_Audit_Log_New",
									"type": "SqlServerStoredProcedure",
									"dependsOn": [
										{
											"activity": "Copy_Briggs_Full_ADLS_New",
											"dependencyConditions": [
												"Succeeded"
											]
										}
									],
									"policy": {
										"timeout": "7.00:00:00",
										"retry": 0,
										"retryIntervalInSeconds": 30,
										"secureOutput": false,
										"secureInput": false
									},
									"userProperties": [],
									"typeProperties": {
										"storedProcedureName": "[dbo].[proc_UpdateAuditLog_Briggs]",
										"storedProcedureParameters": {
											"ConfigTableID": {
												"value": {
													"value": "@item().ID_Full",
													"type": "Expression"
												},
												"type": "Int32"
											},
											"RowsRead": {
												"value": {
													"value": "@activity('Copy_Briggs_Full_ADLS_New').output.RowsRead",
													"type": "Expression"
												},
												"type": "Int64"
											},
											"Status": {
												"value": "Success",
												"type": "String"
											}
										}
									},
									"linkedServiceName": {
										"referenceName": "DS_MDW_SP",
										"type": "LinkedServiceReference"
									}
								},
								{
									"name": "Failure_Audit_Log_New",
									"type": "SqlServerStoredProcedure",
									"dependsOn": [
										{
											"activity": "Set variable2",
											"dependencyConditions": [
												"Succeeded"
											]
										}
									],
									"policy": {
										"timeout": "7.00:00:00",
										"retry": 0,
										"retryIntervalInSeconds": 30,
										"secureOutput": false,
										"secureInput": false
									},
									"userProperties": [],
									"typeProperties": {
										"storedProcedureName": "[dbo].[proc_UpdateAuditLog_Briggs]",
										"storedProcedureParameters": {
											"ConfigTableID": {
												"value": {
													"value": "@item().ID_Full",
													"type": "Expression"
												},
												"type": "Int32"
											},
											"RowsRead": {
												"value": null,
												"type": "Int64"
											},
											"Status": {
												"value": {
													"value": "@variables('ErrorMsgFull')",
													"type": "Expression"
												},
												"type": "String"
											}
										}
									},
									"linkedServiceName": {
										"referenceName": "DS_MDW_SP",
										"type": "LinkedServiceReference"
									}
								},
								{
									"name": "Set variable2",
									"type": "SetVariable",
									"dependsOn": [
										{
											"activity": "Copy_Briggs_Full_ADLS",
											"dependencyConditions": [
												"Failed"
											]
										},
										{
											"activity": "Copy_Briggs_Full_ADLS_New",
											"dependencyConditions": [
												"Failed"
											]
										}
									],
									"userProperties": [],
									"typeProperties": {
										"variableName": "ErrorMsgFull",
										"value": {
											"value": "@activity('Copy_Briggs_Full_ADLS').Error.Message",
											"type": "Expression"
										}
									}
								}
							]
						}
					},
					{
						"name": "ForEach_Incremental_Proc",
						"type": "ForEach",
						"dependsOn": [
							{
								"activity": "ForEach_Incremental_Load",
								"dependencyConditions": [
									"Succeeded"
								]
							}
						],
						"userProperties": [],
						"typeProperties": {
							"items": {
								"value": "@activity('Lookup1_Incremental').output.value",
								"type": "Expression"
							},
							"activities": [
								{
									"name": "Stored procedure_Inc",
									"type": "SqlServerStoredProcedure",
									"dependsOn": [],
									"policy": {
										"timeout": "7.00:00:00",
										"retry": 0,
										"retryIntervalInSeconds": 30,
										"secureOutput": false,
										"secureInput": false
									},
									"userProperties": [],
									"typeProperties": {
										"storedProcedureName": "[dbo].[USP_Control_Table_LastDate]",
										"storedProcedureParameters": {
											"id_I_F": {
												"value": {
													"value": "@item().ID_Inc",
													"type": "Expression"
												},
												"type": "Int32"
											}
										}
									},
									"linkedServiceName": {
										"referenceName": "DS_MDW_SP",
										"type": "LinkedServiceReference"
									}
								}
							]
						}
					},
					{
						"name": "ForEach_Full_Proc",
						"type": "ForEach",
						"dependsOn": [
							{
								"activity": "ForEach_Full_Load",
								"dependencyConditions": [
									"Succeeded"
								]
							}
						],
						"userProperties": [],
						"typeProperties": {
							"items": {
								"value": "@activity('Lookup2_Full').output.value",
								"type": "Expression"
							},
							"activities": [
								{
									"name": "Stored procedure_Full",
									"type": "SqlServerStoredProcedure",
									"dependsOn": [],
									"policy": {
										"timeout": "7.00:00:00",
										"retry": 0,
										"retryIntervalInSeconds": 30,
										"secureOutput": false,
										"secureInput": false
									},
									"userProperties": [],
									"typeProperties": {
										"storedProcedureName": "[dbo].[USP_Control_Table_LastDate]",
										"storedProcedureParameters": {
											"id_I_F": {
												"value": {
													"value": "@item().ID_Full",
													"type": "Expression"
												},
												"type": "Int32"
											}
										}
									},
									"linkedServiceName": {
										"referenceName": "DS_MDW_SP",
										"type": "LinkedServiceReference"
									}
								}
							]
						}
					},
					{
						"name": "Sp_ExecFailureAudit_Full",
						"type": "SqlServerStoredProcedure",
						"dependsOn": [
							{
								"activity": "ForEach_Full_Load",
								"dependencyConditions": [
									"Failed"
								]
							}
						],
						"policy": {
							"timeout": "7.00:00:00",
							"retry": 0,
							"retryIntervalInSeconds": 30,
							"secureOutput": false,
							"secureInput": false
						},
						"userProperties": [],
						"typeProperties": {
							"storedProcedureName": "[dbo].[proc_UpdateAuditLog]",
							"storedProcedureParameters": {
								"AuditID": {
									"value": {
										"value": "@activity('lkp_ExecStartAuditProc').output.firstRow.AuditID",
										"type": "Expression"
									},
									"type": "Int32"
								},
								"DataLakePath": {
									"value": null,
									"type": "String"
								},
								"PipelineRunID": {
									"value": {
										"value": "@pipeline().RunId",
										"type": "Expression"
									},
									"type": "String"
								},
								"RowsRead": {
									"value": null,
									"type": "Int64"
								},
								"Status": {
									"value": "Full Load Failed",
									"type": "String"
								}
							}
						},
						"linkedServiceName": {
							"referenceName": "AzureSqlDatabase1",
							"type": "LinkedServiceReference"
						}
					},
					{
						"name": "Sp_ExecSuccessAudit",
						"type": "SqlServerStoredProcedure",
						"dependsOn": [
							{
								"activity": "ForEach_Incremental_Proc",
								"dependencyConditions": [
									"Succeeded"
								]
							},
							{
								"activity": "ForEach_Full_Proc",
								"dependencyConditions": [
									"Succeeded"
								]
							}
						],
						"policy": {
							"timeout": "7.00:00:00",
							"retry": 0,
							"retryIntervalInSeconds": 30,
							"secureOutput": false,
							"secureInput": false
						},
						"userProperties": [],
						"typeProperties": {
							"storedProcedureName": "[dbo].[proc_UpdateAuditLog]",
							"storedProcedureParameters": {
								"AuditID": {
									"value": {
										"value": "@activity('lkp_ExecStartAuditProc').output.firstRow.AuditID",
										"type": "Expression"
									},
									"type": "Int32"
								},
								"DataLakePath": {
									"value": null,
									"type": "String"
								},
								"RowsRead": {
									"value": null,
									"type": "Int64"
								},
								"Status": {
									"value": "Success",
									"type": "String"
								},
								"PipelineRunID": {
									"value": {
										"value": "@pipeline().RunId",
										"type": "Expression"
									},
									"type": "String"
								}
							}
						},
						"linkedServiceName": {
							"referenceName": "AzureSqlDatabase1",
							"type": "LinkedServiceReference"
						}
					},
					{
						"name": "Sp_ExecFailureAudit_Inc",
						"type": "SqlServerStoredProcedure",
						"dependsOn": [
							{
								"activity": "ForEach_Incremental_Load",
								"dependencyConditions": [
									"Failed"
								]
							}
						],
						"policy": {
							"timeout": "7.00:00:00",
							"retry": 0,
							"retryIntervalInSeconds": 30,
							"secureOutput": false,
							"secureInput": false
						},
						"userProperties": [],
						"typeProperties": {
							"storedProcedureName": "[dbo].[proc_UpdateAuditLog]",
							"storedProcedureParameters": {
								"AuditID": {
									"value": {
										"value": "@activity('lkp_ExecStartAuditProc').output.firstRow.AuditID",
										"type": "Expression"
									},
									"type": "Int32"
								},
								"DataLakePath": {
									"value": null,
									"type": "String"
								},
								"PipelineRunID": {
									"value": {
										"value": "@pipeline().RunId",
										"type": "Expression"
									},
									"type": "String"
								},
								"RowsRead": {
									"value": null,
									"type": "Int64"
								},
								"Status": {
									"value": "Incr Load Failed",
									"type": "String"
								}
							}
						},
						"linkedServiceName": {
							"referenceName": "AzureSqlDatabase1",
							"type": "LinkedServiceReference"
						}
					},
					{
						"name": "lkp_ExecStartAuditProc",
						"type": "Lookup",
						"dependsOn": [],
						"policy": {
							"timeout": "7.00:00:00",
							"retry": 0,
							"retryIntervalInSeconds": 30,
							"secureOutput": false,
							"secureInput": false
						},
						"userProperties": [],
						"typeProperties": {
							"source": {
								"type": "AzureSqlSource",
								"sqlReaderStoredProcedureName": "[dbo].[proc_StartAuditLog]",
								"storedProcedureParameters": {
									"ConfigTableID": {
										"type": "Int32",
										"value": "-1"
									},
									"DataFactoryName": {
										"type": "String",
										"value": {
											"value": "@pipeline().DataFactory",
											"type": "Expression"
										}
									},
									"ParentAuditID": {
										"type": "Int64",
										"value": "-1"
									},
									"PipelineName": {
										"type": "String",
										"value": {
											"value": "@concat(pipeline().Pipeline,' Commission Source Table Load')",
											"type": "Expression"
										}
									},
									"PipelineRunID": {
										"type": "String",
										"value": {
											"value": "@pipeline().RunId",
											"type": "Expression"
										}
									},
									"PipelineTriggerID": {
										"type": "String",
										"value": {
											"value": "@pipeline().TriggerId",
											"type": "Expression"
										}
									},
									"PipelineTriggerName": {
										"type": "String",
										"value": {
											"value": "@pipeline().TriggerName",
											"type": "Expression"
										}
									},
									"PipelineTriggerType": {
										"type": "String",
										"value": {
											"value": "@pipeline().TriggerType",
											"type": "Expression"
										}
									}
								},
								"queryTimeout": "02:00:00",
								"partitionOption": "None"
							},
							"dataset": {
								"referenceName": "Briggs_MDW",
								"type": "DatasetReference",
								"parameters": {
									"schema_name": "dbo",
									"table_name": "user"
								}
							}
						}
					}
				],
				"policy": {
					"elapsedTimeMetric": {},
					"cancelAfter": {}
				},
				"variables": {
					"ErrorMsgInc": {
						"type": "String"
					},
					"ErrorMsgFull": {
						"type": "String"
					}
				},
				"folder": {
					"name": "Briggs Data Load Theme wise"
				},
				"annotations": [],
				"lastPublishTime": "2022-04-26T06:37:22Z"
			},
			"dependsOn": [
				"[concat(variables('workspaceId'), '/datasets/Briggs_MDW')]",
				"[concat(variables('workspaceId'), '/linkedServices/AzureSqlDatabase1')]",
				"[concat(variables('workspaceId'), '/datasets/DS_Briggs_MST')]",
				"[concat(variables('workspaceId'), '/linkedServices/DS_MDW_SP')]"
			]
		},
		{
			"name": "[concat(parameters('workspaceName'), '/PL_Generic_Copy_Customer')]",
			"type": "Microsoft.Synapse/workspaces/pipelines",
			"apiVersion": "2019-06-01-preview",
			"properties": {
				"activities": [
					{
						"name": "Lookup1_Incremental",
						"type": "Lookup",
						"dependsOn": [
							{
								"activity": "lkp_ExecStartAuditProc",
								"dependencyConditions": [
									"Succeeded"
								]
							}
						],
						"policy": {
							"timeout": "7.00:00:00",
							"retry": 0,
							"retryIntervalInSeconds": 30,
							"secureOutput": false,
							"secureInput": false
						},
						"userProperties": [],
						"typeProperties": {
							"source": {
								"type": "AzureSqlSource",
								"sqlReaderQuery": "Select Distinct ID ID_Inc,sourcedb,sourcetablename  From dbo.control_table Where ProcessName = 'AzSQL_ADLS'  \nAND DataLoadType = 'Incremental'  and EnableAction = 1  \nand (format(refresh_date,'dd-MM-yyyy') <> format(getdate(),'dd-MM-yyyy') or refresh_date is null)\nand subjectarea like '%Sales Customer%' and id <> 253 \norder by 1 ",
								"queryTimeout": "02:00:00",
								"partitionOption": "None"
							},
							"dataset": {
								"referenceName": "Briggs_MDW",
								"type": "DatasetReference",
								"parameters": {
									"schema_name": "dbo",
									"table_name": "user"
								}
							},
							"firstRowOnly": false
						}
					},
					{
						"name": "Lookup2_Full",
						"type": "Lookup",
						"dependsOn": [
							{
								"activity": "lkp_ExecStartAuditProc",
								"dependencyConditions": [
									"Succeeded"
								]
							}
						],
						"policy": {
							"timeout": "7.00:00:00",
							"retry": 0,
							"retryIntervalInSeconds": 30,
							"secureOutput": false,
							"secureInput": false
						},
						"userProperties": [],
						"typeProperties": {
							"source": {
								"type": "AzureSqlSource",
								"sqlReaderQuery": "Select Distinct ID ID_Full,sourcedb,sourcetablename  From dbo.control_table Where ProcessName = 'AzSQL_ADLS'  \nAND DataLoadType = 'Full'  and EnableAction = 1 \nand (format(refresh_date,'dd-MM-yyyy') <> format(getdate(),'dd-MM-yyyy') or refresh_date is null)\nand subjectarea like '%Sales Customer%' \norder by 1 ",
								"queryTimeout": "02:00:00",
								"partitionOption": "None"
							},
							"dataset": {
								"referenceName": "Briggs_MDW",
								"type": "DatasetReference",
								"parameters": {
									"schema_name": "dbo",
									"table_name": "user"
								}
							},
							"firstRowOnly": false
						}
					},
					{
						"name": "ForEach_Incremental_Load",
						"type": "ForEach",
						"dependsOn": [
							{
								"activity": "Lookup1_Incremental",
								"dependencyConditions": [
									"Succeeded"
								]
							}
						],
						"userProperties": [],
						"typeProperties": {
							"items": {
								"value": "@activity('Lookup1_Incremental').output.value",
								"type": "Expression"
							},
							"activities": [
								{
									"name": "Lookup_Incremental",
									"type": "Lookup",
									"dependsOn": [],
									"policy": {
										"timeout": "7.00:00:00",
										"retry": 0,
										"retryIntervalInSeconds": 30,
										"secureOutput": false,
										"secureInput": false
									},
									"userProperties": [],
									"typeProperties": {
										"source": {
											"type": "AzureSqlSource",
											"sqlReaderQuery": {
												"value": "@concat('select SourceQuery=''select '' +columnList+ '' from ''+ sourceDB+''.''+SourceSchemaName+''.''+SourcetableName + '' where \ncast(''+DateField+'' as date) >=''''''+LastDate+''''''''\n,SourceDB\n,TargetContainer\n, TargetPath, TargetFile, FileFormat,DateField,LastDate,targetstagetableschema,targetstagetablename\nfrom dbo.control_table\nwhere ID= ',item().ID_Inc)",
												"type": "Expression"
											},
											"queryTimeout": "02:00:00",
											"partitionOption": "None"
										},
										"dataset": {
											"referenceName": "Briggs_MDW",
											"type": "DatasetReference",
											"parameters": {
												"schema_name": "dbo",
												"table_name": "user"
											}
										}
									}
								},
								{
									"name": "Copy_Briggs_Inc_ADLS",
									"type": "Copy",
									"dependsOn": [
										{
											"activity": "Start_Table_Audit1",
											"dependencyConditions": [
												"Succeeded"
											]
										}
									],
									"policy": {
										"timeout": "7.00:00:00",
										"retry": 0,
										"retryIntervalInSeconds": 30,
										"secureOutput": false,
										"secureInput": false
									},
									"userProperties": [],
									"typeProperties": {
										"source": {
											"type": "SqlServerSource",
											"sqlReaderQuery": {
												"value": "@activity('Lookup_Incremental').output.firstRow.SourceQuery\n",
												"type": "Expression"
											},
											"queryTimeout": "02:00:00",
											"partitionOption": "None"
										},
										"sink": {
											"type": "AzureSqlSink",
											"preCopyScript": {
												"value": "@{concat('delete from ',activity('Lookup_Incremental').output.firstRow.TargetStageTableSchema,'.',activity('Lookup_Incremental').output.firstRow.targetstagetablename,' where cast(',activity('Lookup_Incremental').output.firstRow.DateField,' as date)=','''',activity('Lookup_Incremental').output.firstRow.LastDate,'''')}",
												"type": "Expression"
											},
											"disableMetricsCollection": false
										},
										"enableStaging": false,
										"translator": {
											"type": "TabularTranslator",
											"typeConversion": true,
											"typeConversionSettings": {
												"allowDataTruncation": true,
												"treatBooleanAsNumber": false
											}
										}
									},
									"inputs": [
										{
											"referenceName": "DS_Briggs_MST",
											"type": "DatasetReference",
											"parameters": {}
										}
									],
									"outputs": [
										{
											"referenceName": "Briggs_MDW",
											"type": "DatasetReference",
											"parameters": {
												"schema_name": {
													"value": "@activity('Lookup_Incremental').output.firstRow.TargetStageTableSchema",
													"type": "Expression"
												},
												"table_name": {
													"value": "@activity('Lookup_Incremental').output.firstRow.TargetStageTableName",
													"type": "Expression"
												}
											}
										}
									]
								},
								{
									"name": "Copy_Briggs_Inc_ADLS_New",
									"type": "Copy",
									"dependsOn": [
										{
											"activity": "Copy_Briggs_Inc_ADLS",
											"dependencyConditions": [
												"Failed"
											]
										}
									],
									"policy": {
										"timeout": "7.00:00:00",
										"retry": 0,
										"retryIntervalInSeconds": 30,
										"secureOutput": false,
										"secureInput": false
									},
									"userProperties": [],
									"typeProperties": {
										"source": {
											"type": "SqlServerSource",
											"sqlReaderQuery": {
												"value": "@activity('Lookup_Incremental').output.firstRow.SourceQuery\n",
												"type": "Expression"
											},
											"queryTimeout": "02:00:00",
											"partitionOption": "None"
										},
										"sink": {
											"type": "AzureSqlSink",
											"writeBehavior": "insert",
											"sqlWriterUseTableLock": false,
											"tableOption": "autoCreate",
											"disableMetricsCollection": false
										},
										"enableStaging": false,
										"translator": {
											"type": "TabularTranslator",
											"typeConversion": true,
											"typeConversionSettings": {
												"allowDataTruncation": true,
												"treatBooleanAsNumber": false
											}
										}
									},
									"inputs": [
										{
											"referenceName": "DS_Briggs_MST",
											"type": "DatasetReference",
											"parameters": {}
										}
									],
									"outputs": [
										{
											"referenceName": "Briggs_MDW",
											"type": "DatasetReference",
											"parameters": {
												"schema_name": {
													"value": "@activity('Lookup_Incremental').output.firstRow.TargetStageTableSchema",
													"type": "Expression"
												},
												"table_name": {
													"value": "@activity('Lookup_Incremental').output.firstRow.TargetStageTableName",
													"type": "Expression"
												}
											}
										}
									]
								},
								{
									"name": "Start_Table_Audit1",
									"type": "Lookup",
									"dependsOn": [
										{
											"activity": "Lookup_Incremental",
											"dependencyConditions": [
												"Succeeded"
											]
										}
									],
									"policy": {
										"timeout": "7.00:00:00",
										"retry": 0,
										"retryIntervalInSeconds": 30,
										"secureOutput": false,
										"secureInput": false
									},
									"userProperties": [],
									"typeProperties": {
										"source": {
											"type": "AzureSqlSource",
											"sqlReaderStoredProcedureName": "[dbo].[proc_StartAuditLog_Briggs]",
											"storedProcedureParameters": {
												"ConfigTableID": {
													"type": "Int32",
													"value": {
														"value": "@item().ID_Inc",
														"type": "Expression"
													}
												},
												"DataFactoryName": {
													"type": "String",
													"value": {
														"value": "@pipeline().DataFactory",
														"type": "Expression"
													}
												},
												"ParentAuditID": {
													"type": "Int64",
													"value": {
														"value": "@item().ID_Inc",
														"type": "Expression"
													}
												},
												"PipelineName": {
													"type": "String",
													"value": {
														"value": "@pipeline().Pipeline",
														"type": "Expression"
													}
												},
												"PipelineRunID": {
													"type": "String",
													"value": {
														"value": "@pipeline().RunId",
														"type": "Expression"
													}
												},
												"PipelineTriggerID": {
													"type": "String",
													"value": {
														"value": "@pipeline().TriggerId",
														"type": "Expression"
													}
												},
												"PipelineTriggerName": {
													"type": "String",
													"value": {
														"value": "@pipeline().TriggerName",
														"type": "Expression"
													}
												},
												"PipelineTriggerType": {
													"type": "String",
													"value": {
														"value": "@pipeline().TriggerType",
														"type": "Expression"
													}
												},
												"Sourcedb": {
													"type": "String",
													"value": {
														"value": "@item().sourceDB",
														"type": "Expression"
													}
												},
												"sourcetable": {
													"type": "String",
													"value": {
														"value": "@item().SourcetableName",
														"type": "Expression"
													}
												}
											},
											"queryTimeout": "02:00:00",
											"partitionOption": "None"
										},
										"dataset": {
											"referenceName": "Briggs_MDW",
											"type": "DatasetReference",
											"parameters": {
												"schema_name": "dbo",
												"table_name": "user"
											}
										},
										"firstRowOnly": false
									}
								},
								{
									"name": "Success_Audit_Log1",
									"type": "SqlServerStoredProcedure",
									"dependsOn": [
										{
											"activity": "Copy_Briggs_Inc_ADLS",
											"dependencyConditions": [
												"Succeeded"
											]
										}
									],
									"policy": {
										"timeout": "7.00:00:00",
										"retry": 0,
										"retryIntervalInSeconds": 30,
										"secureOutput": false,
										"secureInput": false
									},
									"userProperties": [],
									"typeProperties": {
										"storedProcedureName": "[dbo].[proc_UpdateAuditLog_Briggs]",
										"storedProcedureParameters": {
											"ConfigTableID": {
												"value": {
													"value": "@item().ID_Inc",
													"type": "Expression"
												},
												"type": "Int32"
											},
											"RowsRead": {
												"value": {
													"value": "@activity('Copy_Briggs_Inc_ADLS').output.RowsRead",
													"type": "Expression"
												},
												"type": "Int64"
											},
											"Status": {
												"value": "Success",
												"type": "String"
											}
										}
									},
									"linkedServiceName": {
										"referenceName": "DS_MDW_SP",
										"type": "LinkedServiceReference"
									}
								},
								{
									"name": "Success_Audit_Log2",
									"type": "SqlServerStoredProcedure",
									"dependsOn": [
										{
											"activity": "Copy_Briggs_Inc_ADLS_New",
											"dependencyConditions": [
												"Succeeded"
											]
										}
									],
									"policy": {
										"timeout": "7.00:00:00",
										"retry": 0,
										"retryIntervalInSeconds": 30,
										"secureOutput": false,
										"secureInput": false
									},
									"userProperties": [],
									"typeProperties": {
										"storedProcedureName": "[dbo].[proc_UpdateAuditLog_Briggs]",
										"storedProcedureParameters": {
											"ConfigTableID": {
												"value": {
													"value": "@item().ID_Inc",
													"type": "Expression"
												},
												"type": "Int32"
											},
											"RowsRead": {
												"value": {
													"value": "@activity('Copy_Briggs_Inc_ADLS_New').output.RowsRead",
													"type": "Expression"
												},
												"type": "Int64"
											},
											"Status": {
												"value": "Success",
												"type": "String"
											}
										}
									},
									"linkedServiceName": {
										"referenceName": "DS_MDW_SP",
										"type": "LinkedServiceReference"
									}
								},
								{
									"name": "Failure_Audit_Log2",
									"type": "SqlServerStoredProcedure",
									"dependsOn": [
										{
											"activity": "Set variable1",
											"dependencyConditions": [
												"Succeeded"
											]
										}
									],
									"policy": {
										"timeout": "7.00:00:00",
										"retry": 0,
										"retryIntervalInSeconds": 30,
										"secureOutput": false,
										"secureInput": false
									},
									"userProperties": [],
									"typeProperties": {
										"storedProcedureName": "[dbo].[proc_UpdateAuditLog_Briggs]",
										"storedProcedureParameters": {
											"ConfigTableID": {
												"value": {
													"value": "@item().ID_Inc",
													"type": "Expression"
												},
												"type": "Int32"
											},
											"RowsRead": {
												"value": null,
												"type": "Int64"
											},
											"Status": {
												"value": {
													"value": "@variables('ErrorMsgInc')",
													"type": "Expression"
												},
												"type": "String"
											}
										}
									},
									"linkedServiceName": {
										"referenceName": "DS_MDW_SP",
										"type": "LinkedServiceReference"
									}
								},
								{
									"name": "Set variable1",
									"type": "SetVariable",
									"dependsOn": [
										{
											"activity": "Copy_Briggs_Inc_ADLS",
											"dependencyConditions": [
												"Failed"
											]
										},
										{
											"activity": "Copy_Briggs_Inc_ADLS_New",
											"dependencyConditions": [
												"Failed"
											]
										}
									],
									"userProperties": [],
									"typeProperties": {
										"variableName": "ErrorMsgInc",
										"value": {
											"value": "@activity('Copy_Briggs_Inc_ADLS').Error.Message",
											"type": "Expression"
										}
									}
								}
							]
						}
					},
					{
						"name": "ForEach_Full_Load",
						"type": "ForEach",
						"dependsOn": [
							{
								"activity": "Lookup2_Full",
								"dependencyConditions": [
									"Succeeded"
								]
							}
						],
						"userProperties": [],
						"typeProperties": {
							"items": {
								"value": "@activity('Lookup2_Full').output.value",
								"type": "Expression"
							},
							"activities": [
								{
									"name": "Lookup_Full",
									"type": "Lookup",
									"dependsOn": [],
									"policy": {
										"timeout": "7.00:00:00",
										"retry": 0,
										"retryIntervalInSeconds": 30,
										"secureOutput": false,
										"secureInput": false
									},
									"userProperties": [],
									"typeProperties": {
										"source": {
											"type": "AzureSqlSource",
											"sqlReaderQuery": {
												"value": "@concat('select SourceQuery=''select '' +columnList+ '' from ''+ sourceDB+''.''+SourceSchemaName+''.''+SourcetableName\n,SourceDB\n,TargetContainer\n, TargetPath, TargetFile, FileFormat,DateField,LastDate,targetstagetableschema,targetstagetablename\nfrom dbo.control_table\nwhere ID= ',item().ID_Full)",
												"type": "Expression"
											},
											"queryTimeout": "02:00:00",
											"partitionOption": "None"
										},
										"dataset": {
											"referenceName": "Briggs_MDW",
											"type": "DatasetReference",
											"parameters": {
												"schema_name": "dbo",
												"table_name": "user"
											}
										}
									}
								},
								{
									"name": "Copy_Briggs_Full_ADLS",
									"type": "Copy",
									"dependsOn": [
										{
											"activity": "Start_Table_Audit",
											"dependencyConditions": [
												"Succeeded"
											]
										}
									],
									"policy": {
										"timeout": "7.00:00:00",
										"retry": 0,
										"retryIntervalInSeconds": 30,
										"secureOutput": false,
										"secureInput": false
									},
									"userProperties": [],
									"typeProperties": {
										"source": {
											"type": "SqlServerSource",
											"sqlReaderQuery": {
												"value": "@activity('Lookup_Full').output.firstRow.SourceQuery\n",
												"type": "Expression"
											},
											"queryTimeout": "02:00:00",
											"partitionOption": "None"
										},
										"sink": {
											"type": "AzureSqlSink",
											"preCopyScript": {
												"value": "@{concat('truncate table ',activity('Lookup_Full').output.firstRow.TargetStageTableSchema,'.',activity('Lookup_Full').output.firstRow.TargetStageTableName)}",
												"type": "Expression"
											},
											"disableMetricsCollection": false
										},
										"enableStaging": false,
										"translator": {
											"type": "TabularTranslator",
											"typeConversion": true,
											"typeConversionSettings": {
												"allowDataTruncation": true,
												"treatBooleanAsNumber": false
											}
										}
									},
									"inputs": [
										{
											"referenceName": "DS_Briggs_MST",
											"type": "DatasetReference",
											"parameters": {}
										}
									],
									"outputs": [
										{
											"referenceName": "Briggs_MDW",
											"type": "DatasetReference",
											"parameters": {
												"schema_name": {
													"value": "@activity('Lookup_Full').output.firstRow.TargetStageTableSchema",
													"type": "Expression"
												},
												"table_name": {
													"value": "@activity('Lookup_Full').output.firstRow.TargetStageTableName",
													"type": "Expression"
												}
											}
										}
									]
								},
								{
									"name": "Copy_Briggs_Full_ADLS_New",
									"type": "Copy",
									"dependsOn": [
										{
											"activity": "Copy_Briggs_Full_ADLS",
											"dependencyConditions": [
												"Failed"
											]
										}
									],
									"policy": {
										"timeout": "7.00:00:00",
										"retry": 0,
										"retryIntervalInSeconds": 30,
										"secureOutput": false,
										"secureInput": false
									},
									"userProperties": [],
									"typeProperties": {
										"source": {
											"type": "SqlServerSource",
											"sqlReaderQuery": {
												"value": "@activity('Lookup_Full').output.firstRow.SourceQuery\n",
												"type": "Expression"
											},
											"queryTimeout": "02:00:00",
											"partitionOption": "None"
										},
										"sink": {
											"type": "AzureSqlSink",
											"writeBehavior": "insert",
											"sqlWriterUseTableLock": false,
											"tableOption": "autoCreate",
											"disableMetricsCollection": false
										},
										"enableStaging": false,
										"translator": {
											"type": "TabularTranslator",
											"typeConversion": true,
											"typeConversionSettings": {
												"allowDataTruncation": true,
												"treatBooleanAsNumber": false
											}
										}
									},
									"inputs": [
										{
											"referenceName": "DS_Briggs_MST",
											"type": "DatasetReference",
											"parameters": {}
										}
									],
									"outputs": [
										{
											"referenceName": "Briggs_MDW",
											"type": "DatasetReference",
											"parameters": {
												"schema_name": {
													"value": "@activity('Lookup_Full').output.firstRow.TargetStageTableSchema",
													"type": "Expression"
												},
												"table_name": {
													"value": "@activity('Lookup_Full').output.firstRow.TargetStageTableName",
													"type": "Expression"
												}
											}
										}
									]
								},
								{
									"name": "Start_Table_Audit",
									"type": "Lookup",
									"dependsOn": [
										{
											"activity": "Lookup_Full",
											"dependencyConditions": [
												"Succeeded"
											]
										}
									],
									"policy": {
										"timeout": "7.00:00:00",
										"retry": 0,
										"retryIntervalInSeconds": 30,
										"secureOutput": false,
										"secureInput": false
									},
									"userProperties": [],
									"typeProperties": {
										"source": {
											"type": "AzureSqlSource",
											"sqlReaderStoredProcedureName": "[dbo].[proc_StartAuditLog_Briggs]",
											"storedProcedureParameters": {
												"ConfigTableID": {
													"type": "Int32",
													"value": {
														"value": "@item().ID_Full",
														"type": "Expression"
													}
												},
												"DataFactoryName": {
													"type": "String",
													"value": {
														"value": "@pipeline().DataFactory",
														"type": "Expression"
													}
												},
												"ParentAuditID": {
													"type": "Int64",
													"value": {
														"value": "@item().ID_Full",
														"type": "Expression"
													}
												},
												"PipelineName": {
													"type": "String",
													"value": {
														"value": "@pipeline().Pipeline",
														"type": "Expression"
													}
												},
												"PipelineRunID": {
													"type": "String",
													"value": {
														"value": "@pipeline().RunId",
														"type": "Expression"
													}
												},
												"PipelineTriggerID": {
													"type": "String",
													"value": {
														"value": "@pipeline().TriggerId",
														"type": "Expression"
													}
												},
												"PipelineTriggerName": {
													"type": "String",
													"value": {
														"value": "@pipeline().TriggerName",
														"type": "Expression"
													}
												},
												"PipelineTriggerType": {
													"type": "String",
													"value": {
														"value": "@pipeline().TriggerType",
														"type": "Expression"
													}
												},
												"Sourcedb": {
													"type": "String",
													"value": {
														"value": "@item().sourceDB",
														"type": "Expression"
													}
												},
												"sourcetable": {
													"type": "String",
													"value": {
														"value": "@item().SourcetableName",
														"type": "Expression"
													}
												}
											},
											"queryTimeout": "02:00:00",
											"partitionOption": "None"
										},
										"dataset": {
											"referenceName": "Briggs_MDW",
											"type": "DatasetReference",
											"parameters": {
												"schema_name": "dbo",
												"table_name": "user"
											}
										},
										"firstRowOnly": false
									}
								},
								{
									"name": "Success_Audit_Log",
									"type": "SqlServerStoredProcedure",
									"dependsOn": [
										{
											"activity": "Copy_Briggs_Full_ADLS",
											"dependencyConditions": [
												"Succeeded"
											]
										}
									],
									"policy": {
										"timeout": "7.00:00:00",
										"retry": 0,
										"retryIntervalInSeconds": 30,
										"secureOutput": false,
										"secureInput": false
									},
									"userProperties": [],
									"typeProperties": {
										"storedProcedureName": "[dbo].[proc_UpdateAuditLog_Briggs]",
										"storedProcedureParameters": {
											"ConfigTableID": {
												"value": {
													"value": "@item().ID_Full",
													"type": "Expression"
												},
												"type": "Int32"
											},
											"RowsRead": {
												"value": {
													"value": "@activity('Copy_Briggs_Full_ADLS').output.RowsRead",
													"type": "Expression"
												},
												"type": "Int64"
											},
											"Status": {
												"value": "Success",
												"type": "String"
											}
										}
									},
									"linkedServiceName": {
										"referenceName": "DS_MDW_SP",
										"type": "LinkedServiceReference"
									}
								},
								{
									"name": "Success_Audit_Log_New",
									"type": "SqlServerStoredProcedure",
									"dependsOn": [
										{
											"activity": "Copy_Briggs_Full_ADLS_New",
											"dependencyConditions": [
												"Succeeded"
											]
										}
									],
									"policy": {
										"timeout": "7.00:00:00",
										"retry": 0,
										"retryIntervalInSeconds": 30,
										"secureOutput": false,
										"secureInput": false
									},
									"userProperties": [],
									"typeProperties": {
										"storedProcedureName": "[dbo].[proc_UpdateAuditLog_Briggs]",
										"storedProcedureParameters": {
											"ConfigTableID": {
												"value": {
													"value": "@item().ID_Full",
													"type": "Expression"
												},
												"type": "Int32"
											},
											"RowsRead": {
												"value": {
													"value": "@activity('Copy_Briggs_Full_ADLS_New').output.RowsRead",
													"type": "Expression"
												},
												"type": "Int64"
											},
											"Status": {
												"value": "Success",
												"type": "String"
											}
										}
									},
									"linkedServiceName": {
										"referenceName": "DS_MDW_SP",
										"type": "LinkedServiceReference"
									}
								},
								{
									"name": "Failure_Audit_Log_New",
									"type": "SqlServerStoredProcedure",
									"dependsOn": [
										{
											"activity": "Set variable2",
											"dependencyConditions": [
												"Succeeded"
											]
										}
									],
									"policy": {
										"timeout": "7.00:00:00",
										"retry": 0,
										"retryIntervalInSeconds": 30,
										"secureOutput": false,
										"secureInput": false
									},
									"userProperties": [],
									"typeProperties": {
										"storedProcedureName": "[dbo].[proc_UpdateAuditLog_Briggs]",
										"storedProcedureParameters": {
											"ConfigTableID": {
												"value": {
													"value": "@item().ID_Full",
													"type": "Expression"
												},
												"type": "Int32"
											},
											"RowsRead": {
												"value": null,
												"type": "Int64"
											},
											"Status": {
												"value": {
													"value": "@variables('ErrorMsgFull')",
													"type": "Expression"
												},
												"type": "String"
											}
										}
									},
									"linkedServiceName": {
										"referenceName": "DS_MDW_SP",
										"type": "LinkedServiceReference"
									}
								},
								{
									"name": "Set variable2",
									"type": "SetVariable",
									"dependsOn": [
										{
											"activity": "Copy_Briggs_Full_ADLS",
											"dependencyConditions": [
												"Failed"
											]
										},
										{
											"activity": "Copy_Briggs_Full_ADLS_New",
											"dependencyConditions": [
												"Failed"
											]
										}
									],
									"userProperties": [],
									"typeProperties": {
										"variableName": "ErrorMsgFull",
										"value": {
											"value": "@activity('Copy_Briggs_Full_ADLS').Error.Message",
											"type": "Expression"
										}
									}
								}
							]
						}
					},
					{
						"name": "ForEach_Full_Proc",
						"type": "ForEach",
						"dependsOn": [
							{
								"activity": "ForEach_Full_Load",
								"dependencyConditions": [
									"Succeeded"
								]
							}
						],
						"userProperties": [],
						"typeProperties": {
							"items": {
								"value": "@activity('Lookup2_Full').output.value",
								"type": "Expression"
							},
							"activities": [
								{
									"name": "Stored procedure_Full",
									"type": "SqlServerStoredProcedure",
									"dependsOn": [],
									"policy": {
										"timeout": "7.00:00:00",
										"retry": 0,
										"retryIntervalInSeconds": 30,
										"secureOutput": false,
										"secureInput": false
									},
									"userProperties": [],
									"typeProperties": {
										"storedProcedureName": "[dbo].[USP_Control_Table_LastDate]",
										"storedProcedureParameters": {
											"id_I_F": {
												"value": {
													"value": "@item().ID_Full",
													"type": "Expression"
												},
												"type": "Int32"
											}
										}
									},
									"linkedServiceName": {
										"referenceName": "DS_MDW_SP",
										"type": "LinkedServiceReference"
									}
								}
							]
						}
					},
					{
						"name": "ForEach_Incremental_Proc",
						"type": "ForEach",
						"dependsOn": [
							{
								"activity": "ForEach_Incremental_Load",
								"dependencyConditions": [
									"Succeeded"
								]
							}
						],
						"userProperties": [],
						"typeProperties": {
							"items": {
								"value": "@activity('Lookup1_Incremental').output.value",
								"type": "Expression"
							},
							"activities": [
								{
									"name": "Stored procedure1",
									"type": "SqlServerStoredProcedure",
									"dependsOn": [],
									"policy": {
										"timeout": "7.00:00:00",
										"retry": 0,
										"retryIntervalInSeconds": 30,
										"secureOutput": false,
										"secureInput": false
									},
									"userProperties": [],
									"typeProperties": {
										"storedProcedureName": "[dbo].[USP_Control_Table_LastDate]",
										"storedProcedureParameters": {
											"id_I_F": {
												"value": {
													"value": "@item().ID_Inc",
													"type": "Expression"
												},
												"type": "Int32"
											}
										}
									},
									"linkedServiceName": {
										"referenceName": "DS_MDW_SP",
										"type": "LinkedServiceReference"
									}
								}
							]
						}
					},
					{
						"name": "Sp_ExecFailureAudit_Full",
						"type": "SqlServerStoredProcedure",
						"dependsOn": [
							{
								"activity": "ForEach_Full_Load",
								"dependencyConditions": [
									"Failed"
								]
							}
						],
						"policy": {
							"timeout": "7.00:00:00",
							"retry": 0,
							"retryIntervalInSeconds": 30,
							"secureOutput": false,
							"secureInput": false
						},
						"userProperties": [],
						"typeProperties": {
							"storedProcedureName": "[dbo].[proc_UpdateAuditLog]",
							"storedProcedureParameters": {
								"AuditID": {
									"value": {
										"value": "@activity('lkp_ExecStartAuditProc').output.firstRow.AuditID",
										"type": "Expression"
									},
									"type": "Int32"
								},
								"DataLakePath": {
									"value": null,
									"type": "String"
								},
								"PipelineRunID": {
									"value": {
										"value": "@pipeline().RunId",
										"type": "Expression"
									},
									"type": "String"
								},
								"RowsRead": {
									"value": null,
									"type": "Int64"
								},
								"Status": {
									"value": "Full Load Failed",
									"type": "String"
								}
							}
						},
						"linkedServiceName": {
							"referenceName": "AzureSqlDatabase1",
							"type": "LinkedServiceReference"
						}
					},
					{
						"name": "Sp_ExecSuccessAudit",
						"type": "SqlServerStoredProcedure",
						"dependsOn": [
							{
								"activity": "ForEach_Full_Proc",
								"dependencyConditions": [
									"Succeeded"
								]
							},
							{
								"activity": "ForEach_Incremental_Proc",
								"dependencyConditions": [
									"Succeeded"
								]
							}
						],
						"policy": {
							"timeout": "7.00:00:00",
							"retry": 0,
							"retryIntervalInSeconds": 30,
							"secureOutput": false,
							"secureInput": false
						},
						"userProperties": [],
						"typeProperties": {
							"storedProcedureName": "[dbo].[proc_UpdateAuditLog]",
							"storedProcedureParameters": {
								"AuditID": {
									"value": {
										"value": "@activity('lkp_ExecStartAuditProc').output.firstRow.AuditID",
										"type": "Expression"
									},
									"type": "Int32"
								},
								"DataLakePath": {
									"value": null,
									"type": "String"
								},
								"RowsRead": {
									"value": null,
									"type": "Int64"
								},
								"Status": {
									"value": "Success",
									"type": "String"
								},
								"PipelineRunID": {
									"value": {
										"value": "@pipeline().RunId",
										"type": "Expression"
									},
									"type": "String"
								}
							}
						},
						"linkedServiceName": {
							"referenceName": "AzureSqlDatabase1",
							"type": "LinkedServiceReference"
						}
					},
					{
						"name": "Sp_ExecFailureAudit_Inc",
						"type": "SqlServerStoredProcedure",
						"dependsOn": [
							{
								"activity": "ForEach_Incremental_Load",
								"dependencyConditions": [
									"Failed"
								]
							}
						],
						"policy": {
							"timeout": "7.00:00:00",
							"retry": 0,
							"retryIntervalInSeconds": 30,
							"secureOutput": false,
							"secureInput": false
						},
						"userProperties": [],
						"typeProperties": {
							"storedProcedureName": "[dbo].[proc_UpdateAuditLog]",
							"storedProcedureParameters": {
								"AuditID": {
									"value": {
										"value": "@activity('lkp_ExecStartAuditProc').output.firstRow.AuditID",
										"type": "Expression"
									},
									"type": "Int32"
								},
								"DataLakePath": {
									"value": null,
									"type": "String"
								},
								"PipelineRunID": {
									"value": {
										"value": "@pipeline().RunId",
										"type": "Expression"
									},
									"type": "String"
								},
								"RowsRead": {
									"value": null,
									"type": "Int64"
								},
								"Status": {
									"value": "Incr Load Failed",
									"type": "String"
								}
							}
						},
						"linkedServiceName": {
							"referenceName": "AzureSqlDatabase1",
							"type": "LinkedServiceReference"
						}
					},
					{
						"name": "lkp_ExecStartAuditProc",
						"type": "Lookup",
						"dependsOn": [],
						"policy": {
							"timeout": "7.00:00:00",
							"retry": 0,
							"retryIntervalInSeconds": 30,
							"secureOutput": false,
							"secureInput": false
						},
						"userProperties": [],
						"typeProperties": {
							"source": {
								"type": "AzureSqlSource",
								"sqlReaderStoredProcedureName": "[dbo].[proc_StartAuditLog]",
								"storedProcedureParameters": {
									"ConfigTableID": {
										"type": "Int32",
										"value": "-1"
									},
									"DataFactoryName": {
										"type": "String",
										"value": {
											"value": "@pipeline().DataFactory",
											"type": "Expression"
										}
									},
									"ParentAuditID": {
										"type": "Int64",
										"value": "-1"
									},
									"PipelineName": {
										"type": "String",
										"value": {
											"value": "@concat(pipeline().Pipeline,' Customer Source Table Load')",
											"type": "Expression"
										}
									},
									"PipelineRunID": {
										"type": "String",
										"value": {
											"value": "@pipeline().RunId",
											"type": "Expression"
										}
									},
									"PipelineTriggerID": {
										"type": "String",
										"value": {
											"value": "@pipeline().TriggerId",
											"type": "Expression"
										}
									},
									"PipelineTriggerName": {
										"type": "String",
										"value": {
											"value": "@pipeline().TriggerName",
											"type": "Expression"
										}
									},
									"PipelineTriggerType": {
										"type": "String",
										"value": {
											"value": "@pipeline().TriggerType",
											"type": "Expression"
										}
									}
								},
								"queryTimeout": "02:00:00",
								"partitionOption": "None"
							},
							"dataset": {
								"referenceName": "Briggs_MDW",
								"type": "DatasetReference",
								"parameters": {
									"schema_name": "dbo",
									"table_name": "user"
								}
							}
						}
					}
				],
				"policy": {
					"elapsedTimeMetric": {},
					"cancelAfter": {}
				},
				"variables": {
					"ErrorMsgInc": {
						"type": "String"
					},
					"ErrorMsgFull": {
						"type": "String"
					}
				},
				"folder": {
					"name": "Briggs Data Load Theme wise"
				},
				"annotations": [],
				"lastPublishTime": "2022-04-26T06:37:28Z"
			},
			"dependsOn": [
				"[concat(variables('workspaceId'), '/datasets/Briggs_MDW')]",
				"[concat(variables('workspaceId'), '/linkedServices/AzureSqlDatabase1')]",
				"[concat(variables('workspaceId'), '/datasets/DS_Briggs_MST')]",
				"[concat(variables('workspaceId'), '/linkedServices/DS_MDW_SP')]"
			]
		},
		{
			"name": "[concat(parameters('workspaceName'), '/PL_Generic_Copy_Equipment')]",
			"type": "Microsoft.Synapse/workspaces/pipelines",
			"apiVersion": "2019-06-01-preview",
			"properties": {
				"activities": [
					{
						"name": "Lookup1_Incremental",
						"type": "Lookup",
						"dependsOn": [
							{
								"activity": "lkp_ExecStartAuditProc",
								"dependencyConditions": [
									"Succeeded"
								]
							}
						],
						"policy": {
							"timeout": "7.00:00:00",
							"retry": 0,
							"retryIntervalInSeconds": 30,
							"secureOutput": false,
							"secureInput": false
						},
						"userProperties": [],
						"typeProperties": {
							"source": {
								"type": "AzureSqlSource",
								"sqlReaderQuery": "Select Distinct ID ID_Inc,sourcedb,sourcetablename  From dbo.control_table Where ProcessName = 'AzSQL_ADLS'  \nAND DataLoadType = 'Incremental'  and EnableAction = 1  \nand (format(refresh_date,'dd-MM-yyyy') <> format(getdate(),'dd-MM-yyyy') or refresh_date is null)\nand subjectarea like '%Sales Equipment%' and id <> 253 \norder by 1 ",
								"queryTimeout": "02:00:00",
								"partitionOption": "None"
							},
							"dataset": {
								"referenceName": "Briggs_MDW",
								"type": "DatasetReference",
								"parameters": {
									"schema_name": "dbo",
									"table_name": "user"
								}
							},
							"firstRowOnly": false
						}
					},
					{
						"name": "Lookup2_Full",
						"type": "Lookup",
						"dependsOn": [
							{
								"activity": "lkp_ExecStartAuditProc",
								"dependencyConditions": [
									"Succeeded"
								]
							}
						],
						"policy": {
							"timeout": "7.00:00:00",
							"retry": 0,
							"retryIntervalInSeconds": 30,
							"secureOutput": false,
							"secureInput": false
						},
						"userProperties": [],
						"typeProperties": {
							"source": {
								"type": "AzureSqlSource",
								"sqlReaderQuery": "Select Distinct ID ID_Full,sourcedb,sourcetablename  From dbo.control_table Where ProcessName = 'AzSQL_ADLS'  \nAND DataLoadType = 'Full'  and EnableAction = 1 and subjectarea like '%Sales Equipment%' \nand (format(refresh_date,'dd-MM-yyyy') <> format(getdate(),'dd-MM-yyyy') or refresh_date is null)\norder by 1 ",
								"queryTimeout": "02:00:00",
								"partitionOption": "None"
							},
							"dataset": {
								"referenceName": "Briggs_MDW",
								"type": "DatasetReference",
								"parameters": {
									"schema_name": "dbo",
									"table_name": "user"
								}
							},
							"firstRowOnly": false
						}
					},
					{
						"name": "ForEach_Incremental_Load",
						"type": "ForEach",
						"dependsOn": [
							{
								"activity": "Lookup1_Incremental",
								"dependencyConditions": [
									"Succeeded"
								]
							}
						],
						"userProperties": [],
						"typeProperties": {
							"items": {
								"value": "@activity('Lookup1_Incremental').output.value",
								"type": "Expression"
							},
							"activities": [
								{
									"name": "Lookup_Incremental",
									"type": "Lookup",
									"dependsOn": [],
									"policy": {
										"timeout": "7.00:00:00",
										"retry": 0,
										"retryIntervalInSeconds": 30,
										"secureOutput": false,
										"secureInput": false
									},
									"userProperties": [],
									"typeProperties": {
										"source": {
											"type": "AzureSqlSource",
											"sqlReaderQuery": {
												"value": "@concat('select SourceQuery=''select '' +columnList+ '' from ''+ sourceDB+''.''+SourceSchemaName+''.''+SourcetableName + '' where \ncast(''+DateField+'' as date) >=''''''+LastDate+''''''''\n,SourceDB\n,TargetContainer\n, TargetPath, TargetFile, FileFormat,DateField,LastDate,targetstagetableschema,targetstagetablename\nfrom dbo.control_table\nwhere ID= ',item().ID_Inc)",
												"type": "Expression"
											},
											"queryTimeout": "02:00:00",
											"partitionOption": "None"
										},
										"dataset": {
											"referenceName": "Briggs_MDW",
											"type": "DatasetReference",
											"parameters": {
												"schema_name": "dbo",
												"table_name": "user"
											}
										}
									}
								},
								{
									"name": "Copy_Briggs_Inc_ADLS",
									"type": "Copy",
									"dependsOn": [
										{
											"activity": "Start_Table_Audit1",
											"dependencyConditions": [
												"Succeeded"
											]
										}
									],
									"policy": {
										"timeout": "7.00:00:00",
										"retry": 0,
										"retryIntervalInSeconds": 30,
										"secureOutput": false,
										"secureInput": false
									},
									"userProperties": [],
									"typeProperties": {
										"source": {
											"type": "SqlServerSource",
											"sqlReaderQuery": {
												"value": "@activity('Lookup_Incremental').output.firstRow.SourceQuery\n",
												"type": "Expression"
											},
											"queryTimeout": "02:00:00",
											"partitionOption": "None"
										},
										"sink": {
											"type": "AzureSqlSink",
											"preCopyScript": {
												"value": "@{concat('delete from ',activity('Lookup_Incremental').output.firstRow.TargetStageTableSchema,'.',activity('Lookup_Incremental').output.firstRow.targetstagetablename,' where cast(',activity('Lookup_Incremental').output.firstRow.DateField,' as date)=','''',activity('Lookup_Incremental').output.firstRow.LastDate,'''')}",
												"type": "Expression"
											},
											"disableMetricsCollection": false
										},
										"enableStaging": false,
										"translator": {
											"type": "TabularTranslator",
											"typeConversion": true,
											"typeConversionSettings": {
												"allowDataTruncation": true,
												"treatBooleanAsNumber": false
											}
										}
									},
									"inputs": [
										{
											"referenceName": "DS_Briggs_MST",
											"type": "DatasetReference",
											"parameters": {}
										}
									],
									"outputs": [
										{
											"referenceName": "Briggs_MDW",
											"type": "DatasetReference",
											"parameters": {
												"schema_name": {
													"value": "@activity('Lookup_Incremental').output.firstRow.TargetStageTableSchema",
													"type": "Expression"
												},
												"table_name": {
													"value": "@activity('Lookup_Incremental').output.firstRow.TargetStageTableName",
													"type": "Expression"
												}
											}
										}
									]
								},
								{
									"name": "Copy_Briggs_Inc_ADLS_New",
									"type": "Copy",
									"dependsOn": [
										{
											"activity": "Copy_Briggs_Inc_ADLS",
											"dependencyConditions": [
												"Failed"
											]
										}
									],
									"policy": {
										"timeout": "7.00:00:00",
										"retry": 0,
										"retryIntervalInSeconds": 30,
										"secureOutput": false,
										"secureInput": false
									},
									"userProperties": [],
									"typeProperties": {
										"source": {
											"type": "SqlServerSource",
											"sqlReaderQuery": {
												"value": "@activity('Lookup_Incremental').output.firstRow.SourceQuery\n",
												"type": "Expression"
											},
											"queryTimeout": "02:00:00",
											"partitionOption": "None"
										},
										"sink": {
											"type": "AzureSqlSink",
											"writeBehavior": "insert",
											"sqlWriterUseTableLock": false,
											"tableOption": "autoCreate",
											"disableMetricsCollection": false
										},
										"enableStaging": false,
										"translator": {
											"type": "TabularTranslator",
											"typeConversion": true,
											"typeConversionSettings": {
												"allowDataTruncation": true,
												"treatBooleanAsNumber": false
											}
										}
									},
									"inputs": [
										{
											"referenceName": "DS_Briggs_MST",
											"type": "DatasetReference",
											"parameters": {}
										}
									],
									"outputs": [
										{
											"referenceName": "Briggs_MDW",
											"type": "DatasetReference",
											"parameters": {
												"schema_name": {
													"value": "@activity('Lookup_Incremental').output.firstRow.TargetStageTableSchema",
													"type": "Expression"
												},
												"table_name": {
													"value": "@activity('Lookup_Incremental').output.firstRow.TargetStageTableName",
													"type": "Expression"
												}
											}
										}
									]
								},
								{
									"name": "Start_Table_Audit1",
									"type": "Lookup",
									"dependsOn": [
										{
											"activity": "Lookup_Incremental",
											"dependencyConditions": [
												"Succeeded"
											]
										}
									],
									"policy": {
										"timeout": "7.00:00:00",
										"retry": 0,
										"retryIntervalInSeconds": 30,
										"secureOutput": false,
										"secureInput": false
									},
									"userProperties": [],
									"typeProperties": {
										"source": {
											"type": "AzureSqlSource",
											"sqlReaderStoredProcedureName": "[dbo].[proc_StartAuditLog_Briggs]",
											"storedProcedureParameters": {
												"ConfigTableID": {
													"type": "Int32",
													"value": {
														"value": "@item().ID_Inc",
														"type": "Expression"
													}
												},
												"DataFactoryName": {
													"type": "String",
													"value": {
														"value": "@pipeline().DataFactory",
														"type": "Expression"
													}
												},
												"ParentAuditID": {
													"type": "Int64",
													"value": {
														"value": "@item().ID_Inc",
														"type": "Expression"
													}
												},
												"PipelineName": {
													"type": "String",
													"value": {
														"value": "@pipeline().Pipeline",
														"type": "Expression"
													}
												},
												"PipelineRunID": {
													"type": "String",
													"value": {
														"value": "@pipeline().RunId",
														"type": "Expression"
													}
												},
												"PipelineTriggerID": {
													"type": "String",
													"value": {
														"value": "@pipeline().TriggerId",
														"type": "Expression"
													}
												},
												"PipelineTriggerName": {
													"type": "String",
													"value": {
														"value": "@pipeline().TriggerName",
														"type": "Expression"
													}
												},
												"PipelineTriggerType": {
													"type": "String",
													"value": {
														"value": "@pipeline().TriggerType",
														"type": "Expression"
													}
												},
												"Sourcedb": {
													"type": "String",
													"value": {
														"value": "@item().sourceDB",
														"type": "Expression"
													}
												},
												"sourcetable": {
													"type": "String",
													"value": {
														"value": "@item().SourcetableName",
														"type": "Expression"
													}
												}
											},
											"queryTimeout": "02:00:00",
											"partitionOption": "None"
										},
										"dataset": {
											"referenceName": "Briggs_MDW",
											"type": "DatasetReference",
											"parameters": {
												"schema_name": "dbo",
												"table_name": "user"
											}
										},
										"firstRowOnly": false
									}
								},
								{
									"name": "Success_Audit_Log1",
									"type": "SqlServerStoredProcedure",
									"dependsOn": [
										{
											"activity": "Copy_Briggs_Inc_ADLS",
											"dependencyConditions": [
												"Succeeded"
											]
										}
									],
									"policy": {
										"timeout": "7.00:00:00",
										"retry": 0,
										"retryIntervalInSeconds": 30,
										"secureOutput": false,
										"secureInput": false
									},
									"userProperties": [],
									"typeProperties": {
										"storedProcedureName": "[dbo].[proc_UpdateAuditLog_Briggs]",
										"storedProcedureParameters": {
											"ConfigTableID": {
												"value": {
													"value": "@item().ID_Inc",
													"type": "Expression"
												},
												"type": "Int32"
											},
											"RowsRead": {
												"value": {
													"value": "@activity('Copy_Briggs_Inc_ADLS').output.RowsRead",
													"type": "Expression"
												},
												"type": "Int64"
											},
											"Status": {
												"value": "Success",
												"type": "String"
											}
										}
									},
									"linkedServiceName": {
										"referenceName": "DS_MDW_SP",
										"type": "LinkedServiceReference"
									}
								},
								{
									"name": "Success_Audit_Log2",
									"type": "SqlServerStoredProcedure",
									"dependsOn": [
										{
											"activity": "Copy_Briggs_Inc_ADLS_New",
											"dependencyConditions": [
												"Succeeded"
											]
										}
									],
									"policy": {
										"timeout": "7.00:00:00",
										"retry": 0,
										"retryIntervalInSeconds": 30,
										"secureOutput": false,
										"secureInput": false
									},
									"userProperties": [],
									"typeProperties": {
										"storedProcedureName": "[dbo].[proc_UpdateAuditLog_Briggs]",
										"storedProcedureParameters": {
											"ConfigTableID": {
												"value": {
													"value": "@item().ID_Inc",
													"type": "Expression"
												},
												"type": "Int32"
											},
											"RowsRead": {
												"value": {
													"value": "@activity('Copy_Briggs_Inc_ADLS_New').output.RowsRead",
													"type": "Expression"
												},
												"type": "Int64"
											},
											"Status": {
												"value": "Success",
												"type": "String"
											}
										}
									},
									"linkedServiceName": {
										"referenceName": "DS_MDW_SP",
										"type": "LinkedServiceReference"
									}
								},
								{
									"name": "Failure_Audit_Log2",
									"type": "SqlServerStoredProcedure",
									"dependsOn": [
										{
											"activity": "Set variable1",
											"dependencyConditions": [
												"Succeeded"
											]
										}
									],
									"policy": {
										"timeout": "7.00:00:00",
										"retry": 0,
										"retryIntervalInSeconds": 30,
										"secureOutput": false,
										"secureInput": false
									},
									"userProperties": [],
									"typeProperties": {
										"storedProcedureName": "[dbo].[proc_UpdateAuditLog_Briggs]",
										"storedProcedureParameters": {
											"ConfigTableID": {
												"value": {
													"value": "@item().ID_Inc",
													"type": "Expression"
												},
												"type": "Int32"
											},
											"RowsRead": {
												"value": null,
												"type": "Int64"
											},
											"Status": {
												"value": {
													"value": "@variables('ErrorMsgInc')",
													"type": "Expression"
												},
												"type": "String"
											}
										}
									},
									"linkedServiceName": {
										"referenceName": "DS_MDW_SP",
										"type": "LinkedServiceReference"
									}
								},
								{
									"name": "Set variable1",
									"type": "SetVariable",
									"dependsOn": [
										{
											"activity": "Copy_Briggs_Inc_ADLS",
											"dependencyConditions": [
												"Failed"
											]
										},
										{
											"activity": "Copy_Briggs_Inc_ADLS_New",
											"dependencyConditions": [
												"Failed"
											]
										}
									],
									"userProperties": [],
									"typeProperties": {
										"variableName": "ErrorMsgInc",
										"value": {
											"value": "@activity('Copy_Briggs_Inc_ADLS').Error.Message",
											"type": "Expression"
										}
									}
								}
							]
						}
					},
					{
						"name": "ForEach_Full_Load",
						"type": "ForEach",
						"dependsOn": [
							{
								"activity": "Lookup2_Full",
								"dependencyConditions": [
									"Succeeded"
								]
							}
						],
						"userProperties": [],
						"typeProperties": {
							"items": {
								"value": "@activity('Lookup2_Full').output.value",
								"type": "Expression"
							},
							"activities": [
								{
									"name": "Lookup_Full",
									"type": "Lookup",
									"dependsOn": [],
									"policy": {
										"timeout": "7.00:00:00",
										"retry": 0,
										"retryIntervalInSeconds": 30,
										"secureOutput": false,
										"secureInput": false
									},
									"userProperties": [],
									"typeProperties": {
										"source": {
											"type": "AzureSqlSource",
											"sqlReaderQuery": {
												"value": "@concat('select SourceQuery=''select '' +columnList+ '' from ''+ sourceDB+''.''+SourceSchemaName+''.''+SourcetableName\n,SourceDB\n,TargetContainer\n, TargetPath, TargetFile, FileFormat,DateField,LastDate,targetstagetableschema,targetstagetablename\nfrom dbo.control_table\nwhere ID= ',item().ID_Full)",
												"type": "Expression"
											},
											"queryTimeout": "02:00:00",
											"partitionOption": "None"
										},
										"dataset": {
											"referenceName": "Briggs_MDW",
											"type": "DatasetReference",
											"parameters": {
												"schema_name": "dbo",
												"table_name": "user"
											}
										}
									}
								},
								{
									"name": "Copy_Briggs_Full_ADLS",
									"type": "Copy",
									"dependsOn": [
										{
											"activity": "Start_Table_Audit",
											"dependencyConditions": [
												"Succeeded"
											]
										}
									],
									"policy": {
										"timeout": "7.00:00:00",
										"retry": 0,
										"retryIntervalInSeconds": 30,
										"secureOutput": false,
										"secureInput": false
									},
									"userProperties": [],
									"typeProperties": {
										"source": {
											"type": "SqlServerSource",
											"sqlReaderQuery": {
												"value": "@activity('Lookup_Full').output.firstRow.SourceQuery\n",
												"type": "Expression"
											},
											"queryTimeout": "02:00:00",
											"partitionOption": "None"
										},
										"sink": {
											"type": "AzureSqlSink",
											"preCopyScript": {
												"value": "@{concat('truncate table ',activity('Lookup_Full').output.firstRow.TargetStageTableSchema,'.',activity('Lookup_Full').output.firstRow.TargetStageTableName)}",
												"type": "Expression"
											},
											"disableMetricsCollection": false
										},
										"enableStaging": false,
										"translator": {
											"type": "TabularTranslator",
											"typeConversion": true,
											"typeConversionSettings": {
												"allowDataTruncation": true,
												"treatBooleanAsNumber": false
											}
										}
									},
									"inputs": [
										{
											"referenceName": "DS_Briggs_MST",
											"type": "DatasetReference",
											"parameters": {}
										}
									],
									"outputs": [
										{
											"referenceName": "Briggs_MDW",
											"type": "DatasetReference",
											"parameters": {
												"schema_name": {
													"value": "@activity('Lookup_Full').output.firstRow.TargetStageTableSchema",
													"type": "Expression"
												},
												"table_name": {
													"value": "@activity('Lookup_Full').output.firstRow.TargetStageTableName",
													"type": "Expression"
												}
											}
										}
									]
								},
								{
									"name": "Copy_Briggs_Full_ADLS_New",
									"type": "Copy",
									"dependsOn": [
										{
											"activity": "Copy_Briggs_Full_ADLS",
											"dependencyConditions": [
												"Failed"
											]
										}
									],
									"policy": {
										"timeout": "7.00:00:00",
										"retry": 0,
										"retryIntervalInSeconds": 30,
										"secureOutput": false,
										"secureInput": false
									},
									"userProperties": [],
									"typeProperties": {
										"source": {
											"type": "SqlServerSource",
											"sqlReaderQuery": {
												"value": "@activity('Lookup_Full').output.firstRow.SourceQuery\n",
												"type": "Expression"
											},
											"queryTimeout": "02:00:00",
											"partitionOption": "None"
										},
										"sink": {
											"type": "AzureSqlSink",
											"writeBehavior": "insert",
											"sqlWriterUseTableLock": false,
											"tableOption": "autoCreate",
											"disableMetricsCollection": false
										},
										"enableStaging": false,
										"translator": {
											"type": "TabularTranslator",
											"typeConversion": true,
											"typeConversionSettings": {
												"allowDataTruncation": true,
												"treatBooleanAsNumber": false
											}
										}
									},
									"inputs": [
										{
											"referenceName": "DS_Briggs_MST",
											"type": "DatasetReference",
											"parameters": {}
										}
									],
									"outputs": [
										{
											"referenceName": "Briggs_MDW",
											"type": "DatasetReference",
											"parameters": {
												"schema_name": {
													"value": "@activity('Lookup_Full').output.firstRow.TargetStageTableSchema",
													"type": "Expression"
												},
												"table_name": {
													"value": "@activity('Lookup_Full').output.firstRow.TargetStageTableName",
													"type": "Expression"
												}
											}
										}
									]
								},
								{
									"name": "Start_Table_Audit",
									"type": "Lookup",
									"dependsOn": [
										{
											"activity": "Lookup_Full",
											"dependencyConditions": [
												"Succeeded"
											]
										}
									],
									"policy": {
										"timeout": "7.00:00:00",
										"retry": 0,
										"retryIntervalInSeconds": 30,
										"secureOutput": false,
										"secureInput": false
									},
									"userProperties": [],
									"typeProperties": {
										"source": {
											"type": "AzureSqlSource",
											"sqlReaderStoredProcedureName": "[dbo].[proc_StartAuditLog_Briggs]",
											"storedProcedureParameters": {
												"ConfigTableID": {
													"type": "Int32",
													"value": {
														"value": "@item().ID_Full",
														"type": "Expression"
													}
												},
												"DataFactoryName": {
													"type": "String",
													"value": {
														"value": "@pipeline().DataFactory",
														"type": "Expression"
													}
												},
												"ParentAuditID": {
													"type": "Int64",
													"value": {
														"value": "@item().ID_Full",
														"type": "Expression"
													}
												},
												"PipelineName": {
													"type": "String",
													"value": {
														"value": "@pipeline().Pipeline",
														"type": "Expression"
													}
												},
												"PipelineRunID": {
													"type": "String",
													"value": {
														"value": "@pipeline().RunId",
														"type": "Expression"
													}
												},
												"PipelineTriggerID": {
													"type": "String",
													"value": {
														"value": "@pipeline().TriggerId",
														"type": "Expression"
													}
												},
												"PipelineTriggerName": {
													"type": "String",
													"value": {
														"value": "@pipeline().TriggerName",
														"type": "Expression"
													}
												},
												"PipelineTriggerType": {
													"type": "String",
													"value": {
														"value": "@pipeline().TriggerType",
														"type": "Expression"
													}
												},
												"Sourcedb": {
													"type": "String",
													"value": {
														"value": "@item().sourceDB",
														"type": "Expression"
													}
												},
												"sourcetable": {
													"type": "String",
													"value": {
														"value": "@item().SourcetableName",
														"type": "Expression"
													}
												}
											},
											"queryTimeout": "02:00:00",
											"partitionOption": "None"
										},
										"dataset": {
											"referenceName": "Briggs_MDW",
											"type": "DatasetReference",
											"parameters": {
												"schema_name": "dbo",
												"table_name": "user"
											}
										},
										"firstRowOnly": false
									}
								},
								{
									"name": "Success_Audit_Log",
									"type": "SqlServerStoredProcedure",
									"dependsOn": [
										{
											"activity": "Copy_Briggs_Full_ADLS",
											"dependencyConditions": [
												"Succeeded"
											]
										}
									],
									"policy": {
										"timeout": "7.00:00:00",
										"retry": 0,
										"retryIntervalInSeconds": 30,
										"secureOutput": false,
										"secureInput": false
									},
									"userProperties": [],
									"typeProperties": {
										"storedProcedureName": "[dbo].[proc_UpdateAuditLog_Briggs]",
										"storedProcedureParameters": {
											"ConfigTableID": {
												"value": {
													"value": "@item().ID_Full",
													"type": "Expression"
												},
												"type": "Int32"
											},
											"RowsRead": {
												"value": {
													"value": "@activity('Copy_Briggs_Full_ADLS').output.RowsRead",
													"type": "Expression"
												},
												"type": "Int64"
											},
											"Status": {
												"value": "Success",
												"type": "String"
											}
										}
									},
									"linkedServiceName": {
										"referenceName": "DS_MDW_SP",
										"type": "LinkedServiceReference"
									}
								},
								{
									"name": "Success_Audit_Log_New",
									"type": "SqlServerStoredProcedure",
									"dependsOn": [
										{
											"activity": "Copy_Briggs_Full_ADLS_New",
											"dependencyConditions": [
												"Succeeded"
											]
										}
									],
									"policy": {
										"timeout": "7.00:00:00",
										"retry": 0,
										"retryIntervalInSeconds": 30,
										"secureOutput": false,
										"secureInput": false
									},
									"userProperties": [],
									"typeProperties": {
										"storedProcedureName": "[dbo].[proc_UpdateAuditLog_Briggs]",
										"storedProcedureParameters": {
											"ConfigTableID": {
												"value": {
													"value": "@item().ID_Full",
													"type": "Expression"
												},
												"type": "Int32"
											},
											"RowsRead": {
												"value": {
													"value": "@activity('Copy_Briggs_Full_ADLS_New').output.RowsRead",
													"type": "Expression"
												},
												"type": "Int64"
											},
											"Status": {
												"value": "Success",
												"type": "String"
											}
										}
									},
									"linkedServiceName": {
										"referenceName": "DS_MDW_SP",
										"type": "LinkedServiceReference"
									}
								},
								{
									"name": "Failure_Audit_Log_New",
									"type": "SqlServerStoredProcedure",
									"dependsOn": [
										{
											"activity": "Set variable2",
											"dependencyConditions": [
												"Succeeded"
											]
										}
									],
									"policy": {
										"timeout": "7.00:00:00",
										"retry": 0,
										"retryIntervalInSeconds": 30,
										"secureOutput": false,
										"secureInput": false
									},
									"userProperties": [],
									"typeProperties": {
										"storedProcedureName": "[dbo].[proc_UpdateAuditLog_Briggs]",
										"storedProcedureParameters": {
											"ConfigTableID": {
												"value": {
													"value": "@item().ID_Full",
													"type": "Expression"
												},
												"type": "Int32"
											},
											"RowsRead": {
												"value": null,
												"type": "Int64"
											},
											"Status": {
												"value": {
													"value": "@variables('ErrorMsgFull')",
													"type": "Expression"
												},
												"type": "String"
											}
										}
									},
									"linkedServiceName": {
										"referenceName": "DS_MDW_SP",
										"type": "LinkedServiceReference"
									}
								},
								{
									"name": "Set variable2",
									"type": "SetVariable",
									"dependsOn": [
										{
											"activity": "Copy_Briggs_Full_ADLS",
											"dependencyConditions": [
												"Failed"
											]
										},
										{
											"activity": "Copy_Briggs_Full_ADLS_New",
											"dependencyConditions": [
												"Failed"
											]
										}
									],
									"userProperties": [],
									"typeProperties": {
										"variableName": "ErrorMsgFull",
										"value": {
											"value": "@activity('Copy_Briggs_Full_ADLS').Error.Message",
											"type": "Expression"
										}
									}
								}
							]
						}
					},
					{
						"name": "ForEach_Incremental_Proc",
						"type": "ForEach",
						"dependsOn": [
							{
								"activity": "ForEach_Incremental_Load",
								"dependencyConditions": [
									"Succeeded"
								]
							}
						],
						"userProperties": [],
						"typeProperties": {
							"items": {
								"value": "@activity('Lookup1_Incremental').output.value",
								"type": "Expression"
							},
							"activities": [
								{
									"name": "Stored procedure1",
									"type": "SqlServerStoredProcedure",
									"dependsOn": [],
									"policy": {
										"timeout": "7.00:00:00",
										"retry": 0,
										"retryIntervalInSeconds": 30,
										"secureOutput": false,
										"secureInput": false
									},
									"userProperties": [],
									"typeProperties": {
										"storedProcedureName": "[dbo].[USP_Control_Table_LastDate]",
										"storedProcedureParameters": {
											"id_I_F": {
												"value": {
													"value": "@item().ID_Inc",
													"type": "Expression"
												},
												"type": "Int32"
											}
										}
									},
									"linkedServiceName": {
										"referenceName": "DS_MDW_SP",
										"type": "LinkedServiceReference"
									}
								}
							]
						}
					},
					{
						"name": "ForEach_Full_Proc",
						"type": "ForEach",
						"dependsOn": [
							{
								"activity": "ForEach_Full_Load",
								"dependencyConditions": [
									"Succeeded"
								]
							}
						],
						"userProperties": [],
						"typeProperties": {
							"items": {
								"value": "@activity('Lookup2_Full').output.value",
								"type": "Expression"
							},
							"activities": [
								{
									"name": "Stored procedure_Full",
									"type": "SqlServerStoredProcedure",
									"dependsOn": [],
									"policy": {
										"timeout": "7.00:00:00",
										"retry": 0,
										"retryIntervalInSeconds": 30,
										"secureOutput": false,
										"secureInput": false
									},
									"userProperties": [],
									"typeProperties": {
										"storedProcedureName": "[dbo].[USP_Control_Table_LastDate]",
										"storedProcedureParameters": {
											"id_I_F": {
												"value": {
													"value": "@item().ID_Full",
													"type": "Expression"
												},
												"type": "Int32"
											}
										}
									},
									"linkedServiceName": {
										"referenceName": "DS_MDW_SP",
										"type": "LinkedServiceReference"
									}
								}
							]
						}
					},
					{
						"name": "lkp_ExecStartAuditProc",
						"type": "Lookup",
						"dependsOn": [],
						"policy": {
							"timeout": "7.00:00:00",
							"retry": 0,
							"retryIntervalInSeconds": 30,
							"secureOutput": false,
							"secureInput": false
						},
						"userProperties": [],
						"typeProperties": {
							"source": {
								"type": "AzureSqlSource",
								"sqlReaderStoredProcedureName": "[dbo].[proc_StartAuditLog]",
								"storedProcedureParameters": {
									"ConfigTableID": {
										"type": "Int32",
										"value": "-1"
									},
									"DataFactoryName": {
										"type": "String",
										"value": {
											"value": "@pipeline().DataFactory",
											"type": "Expression"
										}
									},
									"ParentAuditID": {
										"type": "Int64",
										"value": "-1"
									},
									"PipelineName": {
										"type": "String",
										"value": {
											"value": "@concat(pipeline().Pipeline,' Equipment Source Table Load')",
											"type": "Expression"
										}
									},
									"PipelineRunID": {
										"type": "String",
										"value": {
											"value": "@pipeline().RunId",
											"type": "Expression"
										}
									},
									"PipelineTriggerID": {
										"type": "String",
										"value": {
											"value": "@pipeline().TriggerId",
											"type": "Expression"
										}
									},
									"PipelineTriggerName": {
										"type": "String",
										"value": {
											"value": "@pipeline().TriggerName",
											"type": "Expression"
										}
									},
									"PipelineTriggerType": {
										"type": "String",
										"value": {
											"value": "@pipeline().TriggerType",
											"type": "Expression"
										}
									}
								},
								"queryTimeout": "02:00:00",
								"partitionOption": "None"
							},
							"dataset": {
								"referenceName": "Briggs_MDW",
								"type": "DatasetReference",
								"parameters": {
									"schema_name": "dbo",
									"table_name": "user"
								}
							}
						}
					},
					{
						"name": "Sp_ExecFailureAudit_Full",
						"type": "SqlServerStoredProcedure",
						"dependsOn": [
							{
								"activity": "ForEach_Full_Load",
								"dependencyConditions": [
									"Failed"
								]
							}
						],
						"policy": {
							"timeout": "7.00:00:00",
							"retry": 0,
							"retryIntervalInSeconds": 30,
							"secureOutput": false,
							"secureInput": false
						},
						"userProperties": [],
						"typeProperties": {
							"storedProcedureName": "[dbo].[proc_UpdateAuditLog]",
							"storedProcedureParameters": {
								"AuditID": {
									"value": {
										"value": "@activity('lkp_ExecStartAuditProc').output.firstRow.AuditID",
										"type": "Expression"
									},
									"type": "Int32"
								},
								"DataLakePath": {
									"value": null,
									"type": "String"
								},
								"PipelineRunID": {
									"value": {
										"value": "@pipeline().RunId",
										"type": "Expression"
									},
									"type": "String"
								},
								"RowsRead": {
									"value": null,
									"type": "Int64"
								},
								"Status": {
									"value": "Full Load Failed",
									"type": "String"
								}
							}
						},
						"linkedServiceName": {
							"referenceName": "AzureSqlDatabase1",
							"type": "LinkedServiceReference"
						}
					},
					{
						"name": "Sp_ExecSuccessAudit",
						"type": "SqlServerStoredProcedure",
						"dependsOn": [
							{
								"activity": "ForEach_Full_Proc",
								"dependencyConditions": [
									"Succeeded"
								]
							},
							{
								"activity": "ForEach_Incremental_Proc",
								"dependencyConditions": [
									"Succeeded"
								]
							}
						],
						"policy": {
							"timeout": "7.00:00:00",
							"retry": 0,
							"retryIntervalInSeconds": 30,
							"secureOutput": false,
							"secureInput": false
						},
						"userProperties": [],
						"typeProperties": {
							"storedProcedureName": "[dbo].[proc_UpdateAuditLog]",
							"storedProcedureParameters": {
								"AuditID": {
									"value": {
										"value": "@activity('lkp_ExecStartAuditProc').output.firstRow.AuditID",
										"type": "Expression"
									},
									"type": "Int32"
								},
								"DataLakePath": {
									"value": null,
									"type": "String"
								},
								"RowsRead": {
									"value": null,
									"type": "Int64"
								},
								"Status": {
									"value": "Success",
									"type": "String"
								},
								"PipelineRunID": {
									"value": {
										"value": "@pipeline().RunId",
										"type": "Expression"
									},
									"type": "String"
								}
							}
						},
						"linkedServiceName": {
							"referenceName": "AzureSqlDatabase1",
							"type": "LinkedServiceReference"
						}
					},
					{
						"name": "Sp_ExecFailureAudit_Inc",
						"type": "SqlServerStoredProcedure",
						"dependsOn": [
							{
								"activity": "ForEach_Incremental_Load",
								"dependencyConditions": [
									"Failed"
								]
							}
						],
						"policy": {
							"timeout": "7.00:00:00",
							"retry": 0,
							"retryIntervalInSeconds": 30,
							"secureOutput": false,
							"secureInput": false
						},
						"userProperties": [],
						"typeProperties": {
							"storedProcedureName": "[dbo].[proc_UpdateAuditLog]",
							"storedProcedureParameters": {
								"AuditID": {
									"value": {
										"value": "@activity('lkp_ExecStartAuditProc').output.firstRow.AuditID",
										"type": "Expression"
									},
									"type": "Int32"
								},
								"DataLakePath": {
									"value": null,
									"type": "String"
								},
								"PipelineRunID": {
									"value": {
										"value": "@pipeline().RunId",
										"type": "Expression"
									},
									"type": "String"
								},
								"RowsRead": {
									"value": null,
									"type": "Int64"
								},
								"Status": {
									"value": "Incr Load Failed",
									"type": "String"
								}
							}
						},
						"linkedServiceName": {
							"referenceName": "AzureSqlDatabase1",
							"type": "LinkedServiceReference"
						}
					}
				],
				"policy": {
					"elapsedTimeMetric": {},
					"cancelAfter": {}
				},
				"variables": {
					"ErrorMsgInc": {
						"type": "String"
					},
					"ErrorMsgFull": {
						"type": "String"
					}
				},
				"folder": {
					"name": "Briggs Data Load Theme wise"
				},
				"annotations": [],
				"lastPublishTime": "2022-04-26T07:21:26Z"
			},
			"dependsOn": [
				"[concat(variables('workspaceId'), '/datasets/Briggs_MDW')]",
				"[concat(variables('workspaceId'), '/linkedServices/AzureSqlDatabase1')]",
				"[concat(variables('workspaceId'), '/datasets/DS_Briggs_MST')]",
				"[concat(variables('workspaceId'), '/linkedServices/DS_MDW_SP')]"
			]
		},
		{
			"name": "[concat(parameters('workspaceName'), '/PL_Generic_Copy_GM')]",
			"type": "Microsoft.Synapse/workspaces/pipelines",
			"apiVersion": "2019-06-01-preview",
			"properties": {
				"activities": [
					{
						"name": "Lookup1_Incremental",
						"type": "Lookup",
						"dependsOn": [
							{
								"activity": "lkp_ExecStartAuditProc",
								"dependencyConditions": [
									"Succeeded"
								]
							}
						],
						"policy": {
							"timeout": "7.00:00:00",
							"retry": 0,
							"retryIntervalInSeconds": 30,
							"secureOutput": false,
							"secureInput": false
						},
						"userProperties": [],
						"typeProperties": {
							"source": {
								"type": "AzureSqlSource",
								"sqlReaderQuery": "Select Distinct ID ID_Inc,sourcedb,sourcetablename  From dbo.control_table Where ProcessName = 'AzSQL_ADLS'  \nAND DataLoadType = 'Incremental'  and EnableAction = 1  \nand (format(refresh_date,'dd-MM-yyyy') <> format(getdate(),'dd-MM-yyyy') or refresh_date is null)\nand subjectarea like '%Sales GM%' and id <> 253 \norder by 1 ",
								"queryTimeout": "02:00:00",
								"partitionOption": "None"
							},
							"dataset": {
								"referenceName": "Briggs_MDW",
								"type": "DatasetReference",
								"parameters": {
									"schema_name": "dbo",
									"table_name": "user"
								}
							},
							"firstRowOnly": false
						}
					},
					{
						"name": "Lookup2_Full",
						"type": "Lookup",
						"dependsOn": [
							{
								"activity": "lkp_ExecStartAuditProc",
								"dependencyConditions": [
									"Succeeded"
								]
							}
						],
						"policy": {
							"timeout": "7.00:00:00",
							"retry": 0,
							"retryIntervalInSeconds": 30,
							"secureOutput": false,
							"secureInput": false
						},
						"userProperties": [],
						"typeProperties": {
							"source": {
								"type": "AzureSqlSource",
								"sqlReaderQuery": "Select Distinct ID ID_Full,sourcedb,sourcetablename  From dbo.control_table Where ProcessName = 'AzSQL_ADLS'  \nAND DataLoadType = 'Full'  and EnableAction = 1 \nand (format(refresh_date,'dd-MM-yyyy') <> format(getdate(),'dd-MM-yyyy') or refresh_date is null)\nand subjectarea like '%Sales GM%' \norder by 1 ",
								"queryTimeout": "02:00:00",
								"partitionOption": "None"
							},
							"dataset": {
								"referenceName": "Briggs_MDW",
								"type": "DatasetReference",
								"parameters": {
									"schema_name": "dbo",
									"table_name": "user"
								}
							},
							"firstRowOnly": false
						}
					},
					{
						"name": "ForEach_Incremental_Load",
						"type": "ForEach",
						"dependsOn": [
							{
								"activity": "Lookup1_Incremental",
								"dependencyConditions": [
									"Succeeded"
								]
							}
						],
						"userProperties": [],
						"typeProperties": {
							"items": {
								"value": "@activity('Lookup1_Incremental').output.value",
								"type": "Expression"
							},
							"activities": [
								{
									"name": "Lookup_Incremental",
									"type": "Lookup",
									"dependsOn": [],
									"policy": {
										"timeout": "7.00:00:00",
										"retry": 0,
										"retryIntervalInSeconds": 30,
										"secureOutput": false,
										"secureInput": false
									},
									"userProperties": [],
									"typeProperties": {
										"source": {
											"type": "AzureSqlSource",
											"sqlReaderQuery": {
												"value": "@concat('select SourceQuery=''select '' +columnList+ '' from ''+ sourceDB+''.''+SourceSchemaName+''.''+SourcetableName + '' where \ncast(''+DateField+'' as date) >=''''''+LastDate+''''''''\n,SourceDB\n,TargetContainer\n, TargetPath, TargetFile, FileFormat,DateField,LastDate,targetstagetableschema,targetstagetablename\nfrom dbo.control_table\nwhere ID= ',item().ID_Inc)",
												"type": "Expression"
											},
											"queryTimeout": "02:00:00",
											"partitionOption": "None"
										},
										"dataset": {
											"referenceName": "Briggs_MDW",
											"type": "DatasetReference",
											"parameters": {
												"schema_name": "dbo",
												"table_name": "user"
											}
										}
									}
								},
								{
									"name": "Copy_Briggs_Inc_ADLS",
									"type": "Copy",
									"dependsOn": [
										{
											"activity": "Start_Table_Audit1",
											"dependencyConditions": [
												"Succeeded"
											]
										}
									],
									"policy": {
										"timeout": "7.00:00:00",
										"retry": 0,
										"retryIntervalInSeconds": 30,
										"secureOutput": false,
										"secureInput": false
									},
									"userProperties": [],
									"typeProperties": {
										"source": {
											"type": "SqlServerSource",
											"sqlReaderQuery": {
												"value": "@activity('Lookup_Incremental').output.firstRow.SourceQuery\n",
												"type": "Expression"
											},
											"queryTimeout": "02:00:00",
											"partitionOption": "None"
										},
										"sink": {
											"type": "AzureSqlSink",
											"preCopyScript": {
												"value": "@{concat('delete from ',activity('Lookup_Incremental').output.firstRow.TargetStageTableSchema,'.',activity('Lookup_Incremental').output.firstRow.targetstagetablename,' where cast(',activity('Lookup_Incremental').output.firstRow.DateField,' as date)=','''',activity('Lookup_Incremental').output.firstRow.LastDate,'''')}",
												"type": "Expression"
											},
											"disableMetricsCollection": false
										},
										"enableStaging": false,
										"translator": {
											"type": "TabularTranslator",
											"typeConversion": true,
											"typeConversionSettings": {
												"allowDataTruncation": true,
												"treatBooleanAsNumber": false
											}
										}
									},
									"inputs": [
										{
											"referenceName": "DS_Briggs_MST",
											"type": "DatasetReference",
											"parameters": {}
										}
									],
									"outputs": [
										{
											"referenceName": "Briggs_MDW",
											"type": "DatasetReference",
											"parameters": {
												"schema_name": {
													"value": "@activity('Lookup_Incremental').output.firstRow.TargetStageTableSchema",
													"type": "Expression"
												},
												"table_name": {
													"value": "@activity('Lookup_Incremental').output.firstRow.TargetStageTableName",
													"type": "Expression"
												}
											}
										}
									]
								},
								{
									"name": "Copy_Briggs_Inc_ADLS_New",
									"type": "Copy",
									"dependsOn": [
										{
											"activity": "Copy_Briggs_Inc_ADLS",
											"dependencyConditions": [
												"Failed"
											]
										}
									],
									"policy": {
										"timeout": "7.00:00:00",
										"retry": 0,
										"retryIntervalInSeconds": 30,
										"secureOutput": false,
										"secureInput": false
									},
									"userProperties": [],
									"typeProperties": {
										"source": {
											"type": "SqlServerSource",
											"sqlReaderQuery": {
												"value": "@activity('Lookup_Incremental').output.firstRow.SourceQuery\n",
												"type": "Expression"
											},
											"queryTimeout": "02:00:00",
											"partitionOption": "None"
										},
										"sink": {
											"type": "AzureSqlSink",
											"writeBehavior": "insert",
											"sqlWriterUseTableLock": false,
											"tableOption": "autoCreate",
											"disableMetricsCollection": false
										},
										"enableStaging": false,
										"translator": {
											"type": "TabularTranslator",
											"typeConversion": true,
											"typeConversionSettings": {
												"allowDataTruncation": true,
												"treatBooleanAsNumber": false
											}
										}
									},
									"inputs": [
										{
											"referenceName": "DS_Briggs_MST",
											"type": "DatasetReference",
											"parameters": {}
										}
									],
									"outputs": [
										{
											"referenceName": "Briggs_MDW",
											"type": "DatasetReference",
											"parameters": {
												"schema_name": {
													"value": "@activity('Lookup_Incremental').output.firstRow.TargetStageTableSchema",
													"type": "Expression"
												},
												"table_name": {
													"value": "@activity('Lookup_Incremental').output.firstRow.TargetStageTableName",
													"type": "Expression"
												}
											}
										}
									]
								},
								{
									"name": "Start_Table_Audit1",
									"type": "Lookup",
									"dependsOn": [
										{
											"activity": "Lookup_Incremental",
											"dependencyConditions": [
												"Succeeded"
											]
										}
									],
									"policy": {
										"timeout": "7.00:00:00",
										"retry": 0,
										"retryIntervalInSeconds": 30,
										"secureOutput": false,
										"secureInput": false
									},
									"userProperties": [],
									"typeProperties": {
										"source": {
											"type": "AzureSqlSource",
											"sqlReaderStoredProcedureName": "[dbo].[proc_StartAuditLog_Briggs]",
											"storedProcedureParameters": {
												"ConfigTableID": {
													"type": "Int32",
													"value": {
														"value": "@item().ID_Inc",
														"type": "Expression"
													}
												},
												"DataFactoryName": {
													"type": "String",
													"value": {
														"value": "@pipeline().DataFactory",
														"type": "Expression"
													}
												},
												"ParentAuditID": {
													"type": "Int64",
													"value": {
														"value": "@item().ID_Inc",
														"type": "Expression"
													}
												},
												"PipelineName": {
													"type": "String",
													"value": {
														"value": "@pipeline().Pipeline",
														"type": "Expression"
													}
												},
												"PipelineRunID": {
													"type": "String",
													"value": {
														"value": "@pipeline().RunId",
														"type": "Expression"
													}
												},
												"PipelineTriggerID": {
													"type": "String",
													"value": {
														"value": "@pipeline().TriggerId",
														"type": "Expression"
													}
												},
												"PipelineTriggerName": {
													"type": "String",
													"value": {
														"value": "@pipeline().TriggerName",
														"type": "Expression"
													}
												},
												"PipelineTriggerType": {
													"type": "String",
													"value": {
														"value": "@pipeline().TriggerType",
														"type": "Expression"
													}
												},
												"Sourcedb": {
													"type": "String",
													"value": {
														"value": "@item().sourceDB",
														"type": "Expression"
													}
												},
												"sourcetable": {
													"type": "String",
													"value": {
														"value": "@item().SourcetableName",
														"type": "Expression"
													}
												}
											},
											"queryTimeout": "02:00:00",
											"partitionOption": "None"
										},
										"dataset": {
											"referenceName": "Briggs_MDW",
											"type": "DatasetReference",
											"parameters": {
												"schema_name": "dbo",
												"table_name": "user"
											}
										},
										"firstRowOnly": false
									}
								},
								{
									"name": "Success_Audit_Log1",
									"type": "SqlServerStoredProcedure",
									"dependsOn": [
										{
											"activity": "Copy_Briggs_Inc_ADLS",
											"dependencyConditions": [
												"Succeeded"
											]
										}
									],
									"policy": {
										"timeout": "7.00:00:00",
										"retry": 0,
										"retryIntervalInSeconds": 30,
										"secureOutput": false,
										"secureInput": false
									},
									"userProperties": [],
									"typeProperties": {
										"storedProcedureName": "[dbo].[proc_UpdateAuditLog_Briggs]",
										"storedProcedureParameters": {
											"ConfigTableID": {
												"value": {
													"value": "@item().ID_Inc",
													"type": "Expression"
												},
												"type": "Int32"
											},
											"RowsRead": {
												"value": {
													"value": "@activity('Copy_Briggs_Inc_ADLS').output.RowsRead",
													"type": "Expression"
												},
												"type": "Int64"
											},
											"Status": {
												"value": "Success",
												"type": "String"
											}
										}
									},
									"linkedServiceName": {
										"referenceName": "DS_MDW_SP",
										"type": "LinkedServiceReference"
									}
								},
								{
									"name": "Success_Audit_Log2",
									"type": "SqlServerStoredProcedure",
									"dependsOn": [
										{
											"activity": "Copy_Briggs_Inc_ADLS_New",
											"dependencyConditions": [
												"Succeeded"
											]
										}
									],
									"policy": {
										"timeout": "7.00:00:00",
										"retry": 0,
										"retryIntervalInSeconds": 30,
										"secureOutput": false,
										"secureInput": false
									},
									"userProperties": [],
									"typeProperties": {
										"storedProcedureName": "[dbo].[proc_UpdateAuditLog_Briggs]",
										"storedProcedureParameters": {
											"ConfigTableID": {
												"value": {
													"value": "@item().ID_Inc",
													"type": "Expression"
												},
												"type": "Int32"
											},
											"RowsRead": {
												"value": {
													"value": "@activity('Copy_Briggs_Inc_ADLS_New').output.RowsRead",
													"type": "Expression"
												},
												"type": "Int64"
											},
											"Status": {
												"value": "Success",
												"type": "String"
											}
										}
									},
									"linkedServiceName": {
										"referenceName": "DS_MDW_SP",
										"type": "LinkedServiceReference"
									}
								},
								{
									"name": "Failure_Audit_Log2",
									"type": "SqlServerStoredProcedure",
									"dependsOn": [
										{
											"activity": "Set variable1",
											"dependencyConditions": [
												"Succeeded"
											]
										}
									],
									"policy": {
										"timeout": "7.00:00:00",
										"retry": 0,
										"retryIntervalInSeconds": 30,
										"secureOutput": false,
										"secureInput": false
									},
									"userProperties": [],
									"typeProperties": {
										"storedProcedureName": "[dbo].[proc_UpdateAuditLog_Briggs]",
										"storedProcedureParameters": {
											"ConfigTableID": {
												"value": {
													"value": "@item().ID_Inc",
													"type": "Expression"
												},
												"type": "Int32"
											},
											"RowsRead": {
												"value": null,
												"type": "Int64"
											},
											"Status": {
												"value": {
													"value": "@variables('ErrorMsgInc')",
													"type": "Expression"
												},
												"type": "String"
											}
										}
									},
									"linkedServiceName": {
										"referenceName": "DS_MDW_SP",
										"type": "LinkedServiceReference"
									}
								},
								{
									"name": "Set variable1",
									"type": "SetVariable",
									"dependsOn": [
										{
											"activity": "Copy_Briggs_Inc_ADLS",
											"dependencyConditions": [
												"Failed"
											]
										},
										{
											"activity": "Copy_Briggs_Inc_ADLS_New",
											"dependencyConditions": [
												"Failed"
											]
										}
									],
									"userProperties": [],
									"typeProperties": {
										"variableName": "ErrorMsgInc",
										"value": {
											"value": "@activity('Copy_Briggs_Inc_ADLS').Error.Message",
											"type": "Expression"
										}
									}
								}
							]
						}
					},
					{
						"name": "ForEach_Full_Load",
						"type": "ForEach",
						"dependsOn": [
							{
								"activity": "Lookup2_Full",
								"dependencyConditions": [
									"Succeeded"
								]
							}
						],
						"userProperties": [],
						"typeProperties": {
							"items": {
								"value": "@activity('Lookup2_Full').output.value",
								"type": "Expression"
							},
							"activities": [
								{
									"name": "Lookup_Full",
									"type": "Lookup",
									"dependsOn": [],
									"policy": {
										"timeout": "7.00:00:00",
										"retry": 0,
										"retryIntervalInSeconds": 30,
										"secureOutput": false,
										"secureInput": false
									},
									"userProperties": [],
									"typeProperties": {
										"source": {
											"type": "AzureSqlSource",
											"sqlReaderQuery": {
												"value": "@concat('select SourceQuery=''select '' +columnList+ '' from ''+ sourceDB+''.''+SourceSchemaName+''.''+SourcetableName\n,SourceDB\n,TargetContainer\n, TargetPath, TargetFile, FileFormat,DateField,LastDate,targetstagetableschema,targetstagetablename\nfrom dbo.control_table\nwhere ID= ',item().ID_Full)",
												"type": "Expression"
											},
											"queryTimeout": "02:00:00",
											"partitionOption": "None"
										},
										"dataset": {
											"referenceName": "Briggs_MDW",
											"type": "DatasetReference",
											"parameters": {
												"schema_name": "dbo",
												"table_name": "user"
											}
										}
									}
								},
								{
									"name": "Copy_Briggs_Full_ADLS",
									"type": "Copy",
									"dependsOn": [
										{
											"activity": "Start_Table_Audit",
											"dependencyConditions": [
												"Succeeded"
											]
										}
									],
									"policy": {
										"timeout": "7.00:00:00",
										"retry": 0,
										"retryIntervalInSeconds": 30,
										"secureOutput": false,
										"secureInput": false
									},
									"userProperties": [],
									"typeProperties": {
										"source": {
											"type": "SqlServerSource",
											"sqlReaderQuery": {
												"value": "@activity('Lookup_Full').output.firstRow.SourceQuery\n",
												"type": "Expression"
											},
											"queryTimeout": "02:00:00",
											"partitionOption": "None"
										},
										"sink": {
											"type": "AzureSqlSink",
											"preCopyScript": {
												"value": "@{concat('truncate table ',activity('Lookup_Full').output.firstRow.TargetStageTableSchema,'.',activity('Lookup_Full').output.firstRow.TargetStageTableName)}",
												"type": "Expression"
											},
											"disableMetricsCollection": false
										},
										"enableStaging": false,
										"translator": {
											"type": "TabularTranslator",
											"typeConversion": true,
											"typeConversionSettings": {
												"allowDataTruncation": true,
												"treatBooleanAsNumber": false
											}
										}
									},
									"inputs": [
										{
											"referenceName": "DS_Briggs_MST",
											"type": "DatasetReference",
											"parameters": {}
										}
									],
									"outputs": [
										{
											"referenceName": "Briggs_MDW",
											"type": "DatasetReference",
											"parameters": {
												"schema_name": {
													"value": "@activity('Lookup_Full').output.firstRow.TargetStageTableSchema",
													"type": "Expression"
												},
												"table_name": {
													"value": "@activity('Lookup_Full').output.firstRow.TargetStageTableName",
													"type": "Expression"
												}
											}
										}
									]
								},
								{
									"name": "Copy_Briggs_Full_ADLS_New",
									"type": "Copy",
									"dependsOn": [
										{
											"activity": "Copy_Briggs_Full_ADLS",
											"dependencyConditions": [
												"Failed"
											]
										}
									],
									"policy": {
										"timeout": "7.00:00:00",
										"retry": 0,
										"retryIntervalInSeconds": 30,
										"secureOutput": false,
										"secureInput": false
									},
									"userProperties": [],
									"typeProperties": {
										"source": {
											"type": "SqlServerSource",
											"sqlReaderQuery": {
												"value": "@activity('Lookup_Full').output.firstRow.SourceQuery\n",
												"type": "Expression"
											},
											"queryTimeout": "02:00:00",
											"partitionOption": "None"
										},
										"sink": {
											"type": "AzureSqlSink",
											"writeBehavior": "insert",
											"sqlWriterUseTableLock": false,
											"tableOption": "autoCreate",
											"disableMetricsCollection": false
										},
										"enableStaging": false,
										"translator": {
											"type": "TabularTranslator",
											"typeConversion": true,
											"typeConversionSettings": {
												"allowDataTruncation": true,
												"treatBooleanAsNumber": false
											}
										}
									},
									"inputs": [
										{
											"referenceName": "DS_Briggs_MST",
											"type": "DatasetReference",
											"parameters": {}
										}
									],
									"outputs": [
										{
											"referenceName": "Briggs_MDW",
											"type": "DatasetReference",
											"parameters": {
												"schema_name": {
													"value": "@activity('Lookup_Full').output.firstRow.TargetStageTableSchema",
													"type": "Expression"
												},
												"table_name": {
													"value": "@activity('Lookup_Full').output.firstRow.TargetStageTableName",
													"type": "Expression"
												}
											}
										}
									]
								},
								{
									"name": "Start_Table_Audit",
									"type": "Lookup",
									"dependsOn": [
										{
											"activity": "Lookup_Full",
											"dependencyConditions": [
												"Succeeded"
											]
										}
									],
									"policy": {
										"timeout": "7.00:00:00",
										"retry": 0,
										"retryIntervalInSeconds": 30,
										"secureOutput": false,
										"secureInput": false
									},
									"userProperties": [],
									"typeProperties": {
										"source": {
											"type": "AzureSqlSource",
											"sqlReaderStoredProcedureName": "[dbo].[proc_StartAuditLog_Briggs]",
											"storedProcedureParameters": {
												"ConfigTableID": {
													"type": "Int32",
													"value": {
														"value": "@item().ID_Full",
														"type": "Expression"
													}
												},
												"DataFactoryName": {
													"type": "String",
													"value": {
														"value": "@pipeline().DataFactory",
														"type": "Expression"
													}
												},
												"ParentAuditID": {
													"type": "Int64",
													"value": {
														"value": "@item().ID_Full",
														"type": "Expression"
													}
												},
												"PipelineName": {
													"type": "String",
													"value": {
														"value": "@pipeline().Pipeline",
														"type": "Expression"
													}
												},
												"PipelineRunID": {
													"type": "String",
													"value": {
														"value": "@pipeline().RunId",
														"type": "Expression"
													}
												},
												"PipelineTriggerID": {
													"type": "String",
													"value": {
														"value": "@pipeline().TriggerId",
														"type": "Expression"
													}
												},
												"PipelineTriggerName": {
													"type": "String",
													"value": {
														"value": "@pipeline().TriggerName",
														"type": "Expression"
													}
												},
												"PipelineTriggerType": {
													"type": "String",
													"value": {
														"value": "@pipeline().TriggerType",
														"type": "Expression"
													}
												},
												"Sourcedb": {
													"type": "String",
													"value": {
														"value": "@item().sourceDB",
														"type": "Expression"
													}
												},
												"sourcetable": {
													"type": "String",
													"value": {
														"value": "@item().SourcetableName",
														"type": "Expression"
													}
												}
											},
											"queryTimeout": "02:00:00",
											"partitionOption": "None"
										},
										"dataset": {
											"referenceName": "Briggs_MDW",
											"type": "DatasetReference",
											"parameters": {
												"schema_name": "dbo",
												"table_name": "user"
											}
										},
										"firstRowOnly": false
									}
								},
								{
									"name": "Success_Audit_Log",
									"type": "SqlServerStoredProcedure",
									"dependsOn": [
										{
											"activity": "Copy_Briggs_Full_ADLS",
											"dependencyConditions": [
												"Succeeded"
											]
										}
									],
									"policy": {
										"timeout": "7.00:00:00",
										"retry": 0,
										"retryIntervalInSeconds": 30,
										"secureOutput": false,
										"secureInput": false
									},
									"userProperties": [],
									"typeProperties": {
										"storedProcedureName": "[dbo].[proc_UpdateAuditLog_Briggs]",
										"storedProcedureParameters": {
											"ConfigTableID": {
												"value": {
													"value": "@item().ID_Full",
													"type": "Expression"
												},
												"type": "Int32"
											},
											"RowsRead": {
												"value": {
													"value": "@activity('Copy_Briggs_Full_ADLS').output.RowsRead",
													"type": "Expression"
												},
												"type": "Int64"
											},
											"Status": {
												"value": "Success",
												"type": "String"
											}
										}
									},
									"linkedServiceName": {
										"referenceName": "DS_MDW_SP",
										"type": "LinkedServiceReference"
									}
								},
								{
									"name": "Success_Audit_Log_New",
									"type": "SqlServerStoredProcedure",
									"dependsOn": [
										{
											"activity": "Copy_Briggs_Full_ADLS_New",
											"dependencyConditions": [
												"Succeeded"
											]
										}
									],
									"policy": {
										"timeout": "7.00:00:00",
										"retry": 0,
										"retryIntervalInSeconds": 30,
										"secureOutput": false,
										"secureInput": false
									},
									"userProperties": [],
									"typeProperties": {
										"storedProcedureName": "[dbo].[proc_UpdateAuditLog_Briggs]",
										"storedProcedureParameters": {
											"ConfigTableID": {
												"value": {
													"value": "@item().ID_Full",
													"type": "Expression"
												},
												"type": "Int32"
											},
											"RowsRead": {
												"value": {
													"value": "@activity('Copy_Briggs_Full_ADLS_New').output.RowsRead",
													"type": "Expression"
												},
												"type": "Int64"
											},
											"Status": {
												"value": "Success",
												"type": "String"
											}
										}
									},
									"linkedServiceName": {
										"referenceName": "DS_MDW_SP",
										"type": "LinkedServiceReference"
									}
								},
								{
									"name": "Failure_Audit_Log_New",
									"type": "SqlServerStoredProcedure",
									"dependsOn": [
										{
											"activity": "Set variable2",
											"dependencyConditions": [
												"Succeeded"
											]
										}
									],
									"policy": {
										"timeout": "7.00:00:00",
										"retry": 0,
										"retryIntervalInSeconds": 30,
										"secureOutput": false,
										"secureInput": false
									},
									"userProperties": [],
									"typeProperties": {
										"storedProcedureName": "[dbo].[proc_UpdateAuditLog_Briggs]",
										"storedProcedureParameters": {
											"ConfigTableID": {
												"value": {
													"value": "@item().ID_Full",
													"type": "Expression"
												},
												"type": "Int32"
											},
											"RowsRead": {
												"value": null,
												"type": "Int64"
											},
											"Status": {
												"value": {
													"value": "@variables('ErrorMsgFull')",
													"type": "Expression"
												},
												"type": "String"
											}
										}
									},
									"linkedServiceName": {
										"referenceName": "DS_MDW_SP",
										"type": "LinkedServiceReference"
									}
								},
								{
									"name": "Set variable2",
									"type": "SetVariable",
									"dependsOn": [
										{
											"activity": "Copy_Briggs_Full_ADLS",
											"dependencyConditions": [
												"Failed"
											]
										},
										{
											"activity": "Copy_Briggs_Full_ADLS_New",
											"dependencyConditions": [
												"Failed"
											]
										}
									],
									"userProperties": [],
									"typeProperties": {
										"variableName": "ErrorMsgFull",
										"value": {
											"value": "@activity('Copy_Briggs_Full_ADLS').Error.Message",
											"type": "Expression"
										}
									}
								}
							]
						}
					},
					{
						"name": "ForEach_Proc_Incremental",
						"type": "ForEach",
						"dependsOn": [
							{
								"activity": "ForEach_Incremental_Load",
								"dependencyConditions": [
									"Succeeded"
								]
							}
						],
						"userProperties": [],
						"typeProperties": {
							"items": {
								"value": "@activity('Lookup1_Incremental').output.value",
								"type": "Expression"
							},
							"activities": [
								{
									"name": "Stored procedure1",
									"type": "SqlServerStoredProcedure",
									"dependsOn": [],
									"policy": {
										"timeout": "7.00:00:00",
										"retry": 0,
										"retryIntervalInSeconds": 30,
										"secureOutput": false,
										"secureInput": false
									},
									"userProperties": [],
									"typeProperties": {
										"storedProcedureName": "[dbo].[USP_Control_Table_LastDate]",
										"storedProcedureParameters": {
											"id_I_F": {
												"value": {
													"value": "@item().ID_Inc",
													"type": "Expression"
												},
												"type": "Int32"
											}
										}
									},
									"linkedServiceName": {
										"referenceName": "DS_MDW_SP",
										"type": "LinkedServiceReference"
									}
								}
							]
						}
					},
					{
						"name": "ForEach_Proc_Full",
						"type": "ForEach",
						"dependsOn": [
							{
								"activity": "ForEach_Full_Load",
								"dependencyConditions": [
									"Succeeded"
								]
							}
						],
						"userProperties": [],
						"typeProperties": {
							"items": {
								"value": "@activity('Lookup2_Full').output.value",
								"type": "Expression"
							},
							"activities": [
								{
									"name": "Stored procedure_Full",
									"type": "SqlServerStoredProcedure",
									"dependsOn": [],
									"policy": {
										"timeout": "7.00:00:00",
										"retry": 0,
										"retryIntervalInSeconds": 30,
										"secureOutput": false,
										"secureInput": false
									},
									"userProperties": [],
									"typeProperties": {
										"storedProcedureName": "[dbo].[USP_Control_Table_LastDate]",
										"storedProcedureParameters": {
											"id_I_F": {
												"value": {
													"value": "@item().ID_Full",
													"type": "Expression"
												},
												"type": "Int32"
											}
										}
									},
									"linkedServiceName": {
										"referenceName": "DS_MDW_SP",
										"type": "LinkedServiceReference"
									}
								}
							]
						}
					},
					{
						"name": "lkp_ExecStartAuditProc",
						"type": "Lookup",
						"dependsOn": [],
						"policy": {
							"timeout": "7.00:00:00",
							"retry": 0,
							"retryIntervalInSeconds": 30,
							"secureOutput": false,
							"secureInput": false
						},
						"userProperties": [],
						"typeProperties": {
							"source": {
								"type": "AzureSqlSource",
								"sqlReaderStoredProcedureName": "[dbo].[proc_StartAuditLog]",
								"storedProcedureParameters": {
									"ConfigTableID": {
										"type": "Int32",
										"value": "-1"
									},
									"DataFactoryName": {
										"type": "String",
										"value": {
											"value": "@pipeline().DataFactory",
											"type": "Expression"
										}
									},
									"ParentAuditID": {
										"type": "Int64",
										"value": "-1"
									},
									"PipelineName": {
										"type": "String",
										"value": {
											"value": "@concat(pipeline().Pipeline,' GM Source Table Load')",
											"type": "Expression"
										}
									},
									"PipelineRunID": {
										"type": "String",
										"value": {
											"value": "@pipeline().RunId",
											"type": "Expression"
										}
									},
									"PipelineTriggerID": {
										"type": "String",
										"value": {
											"value": "@pipeline().TriggerId",
											"type": "Expression"
										}
									},
									"PipelineTriggerName": {
										"type": "String",
										"value": {
											"value": "@pipeline().TriggerName",
											"type": "Expression"
										}
									},
									"PipelineTriggerType": {
										"type": "String",
										"value": {
											"value": "@pipeline().TriggerType",
											"type": "Expression"
										}
									}
								},
								"queryTimeout": "02:00:00",
								"partitionOption": "None"
							},
							"dataset": {
								"referenceName": "Briggs_MDW",
								"type": "DatasetReference",
								"parameters": {
									"schema_name": "dbo",
									"table_name": "user"
								}
							}
						}
					},
					{
						"name": "Sp_ExecFailureAudit_Full",
						"type": "SqlServerStoredProcedure",
						"dependsOn": [
							{
								"activity": "ForEach_Full_Load",
								"dependencyConditions": [
									"Failed"
								]
							}
						],
						"policy": {
							"timeout": "7.00:00:00",
							"retry": 0,
							"retryIntervalInSeconds": 30,
							"secureOutput": false,
							"secureInput": false
						},
						"userProperties": [],
						"typeProperties": {
							"storedProcedureName": "[dbo].[proc_UpdateAuditLog]",
							"storedProcedureParameters": {
								"AuditID": {
									"value": {
										"value": "@activity('lkp_ExecStartAuditProc').output.firstRow.AuditID",
										"type": "Expression"
									},
									"type": "Int32"
								},
								"DataLakePath": {
									"value": null,
									"type": "String"
								},
								"PipelineRunID": {
									"value": {
										"value": "@pipeline().RunId",
										"type": "Expression"
									},
									"type": "String"
								},
								"RowsRead": {
									"value": null,
									"type": "Int64"
								},
								"Status": {
									"value": "Full Load Failed",
									"type": "String"
								}
							}
						},
						"linkedServiceName": {
							"referenceName": "AzureSqlDatabase1",
							"type": "LinkedServiceReference"
						}
					},
					{
						"name": "Sp_ExecSuccessAudit",
						"type": "SqlServerStoredProcedure",
						"dependsOn": [
							{
								"activity": "ForEach_Proc_Full",
								"dependencyConditions": [
									"Succeeded"
								]
							},
							{
								"activity": "ForEach_Proc_Incremental",
								"dependencyConditions": [
									"Succeeded"
								]
							}
						],
						"policy": {
							"timeout": "7.00:00:00",
							"retry": 0,
							"retryIntervalInSeconds": 30,
							"secureOutput": false,
							"secureInput": false
						},
						"userProperties": [],
						"typeProperties": {
							"storedProcedureName": "[dbo].[proc_UpdateAuditLog]",
							"storedProcedureParameters": {
								"AuditID": {
									"value": {
										"value": "@activity('lkp_ExecStartAuditProc').output.firstRow.AuditID",
										"type": "Expression"
									},
									"type": "Int32"
								},
								"DataLakePath": {
									"value": null,
									"type": "String"
								},
								"RowsRead": {
									"value": null,
									"type": "Int64"
								},
								"Status": {
									"value": "Success",
									"type": "String"
								},
								"PipelineRunID": {
									"value": {
										"value": "@pipeline().RunId",
										"type": "Expression"
									},
									"type": "String"
								}
							}
						},
						"linkedServiceName": {
							"referenceName": "AzureSqlDatabase1",
							"type": "LinkedServiceReference"
						}
					},
					{
						"name": "Sp_ExecFailureAudit_Inc",
						"type": "SqlServerStoredProcedure",
						"dependsOn": [
							{
								"activity": "ForEach_Incremental_Load",
								"dependencyConditions": [
									"Failed"
								]
							}
						],
						"policy": {
							"timeout": "7.00:00:00",
							"retry": 0,
							"retryIntervalInSeconds": 30,
							"secureOutput": false,
							"secureInput": false
						},
						"userProperties": [],
						"typeProperties": {
							"storedProcedureName": "[dbo].[proc_UpdateAuditLog]",
							"storedProcedureParameters": {
								"AuditID": {
									"value": {
										"value": "@activity('lkp_ExecStartAuditProc').output.firstRow.AuditID",
										"type": "Expression"
									},
									"type": "Int32"
								},
								"DataLakePath": {
									"value": null,
									"type": "String"
								},
								"PipelineRunID": {
									"value": {
										"value": "@pipeline().RunId",
										"type": "Expression"
									},
									"type": "String"
								},
								"RowsRead": {
									"value": null,
									"type": "Int64"
								},
								"Status": {
									"value": "Incr Load Failed",
									"type": "String"
								}
							}
						},
						"linkedServiceName": {
							"referenceName": "AzureSqlDatabase1",
							"type": "LinkedServiceReference"
						}
					}
				],
				"policy": {
					"elapsedTimeMetric": {},
					"cancelAfter": {}
				},
				"variables": {
					"ErrorMsgInc": {
						"type": "String"
					},
					"ErrorMsgFull": {
						"type": "String"
					}
				},
				"folder": {
					"name": "Briggs Data Load Theme wise"
				},
				"annotations": [],
				"lastPublishTime": "2022-04-26T07:21:31Z"
			},
			"dependsOn": [
				"[concat(variables('workspaceId'), '/datasets/Briggs_MDW')]",
				"[concat(variables('workspaceId'), '/linkedServices/AzureSqlDatabase1')]",
				"[concat(variables('workspaceId'), '/datasets/DS_Briggs_MST')]",
				"[concat(variables('workspaceId'), '/linkedServices/DS_MDW_SP')]"
			]
		},
		{
			"name": "[concat(parameters('workspaceName'), '/PL_Generic_Copy_Inventory')]",
			"type": "Microsoft.Synapse/workspaces/pipelines",
			"apiVersion": "2019-06-01-preview",
			"properties": {
				"activities": [
					{
						"name": "Lookup1_Incremental",
						"type": "Lookup",
						"dependsOn": [
							{
								"activity": "lkp_ExecStartAuditProc",
								"dependencyConditions": [
									"Succeeded"
								]
							}
						],
						"policy": {
							"timeout": "7.00:00:00",
							"retry": 0,
							"retryIntervalInSeconds": 30,
							"secureOutput": false,
							"secureInput": false
						},
						"userProperties": [],
						"typeProperties": {
							"source": {
								"type": "AzureSqlSource",
								"sqlReaderQuery": "Select Distinct ID ID_Inc,sourcedb,sourcetablename  From dbo.control_table Where ProcessName = 'AzSQL_ADLS'  \nAND DataLoadType = 'Incremental'  and EnableAction = 1  \nand (format(refresh_date,'dd-MM-yyyy') <> format(getdate(),'dd-MM-yyyy') or refresh_date is null)\nand subjectarea like '%Sales Inventory%' and id <> 253 \norder by 1 ",
								"queryTimeout": "02:00:00",
								"partitionOption": "None"
							},
							"dataset": {
								"referenceName": "Briggs_MDW",
								"type": "DatasetReference",
								"parameters": {
									"schema_name": "dbo",
									"table_name": "user"
								}
							},
							"firstRowOnly": false
						}
					},
					{
						"name": "Lookup2_Full",
						"type": "Lookup",
						"dependsOn": [
							{
								"activity": "lkp_ExecStartAuditProc",
								"dependencyConditions": [
									"Succeeded"
								]
							}
						],
						"policy": {
							"timeout": "7.00:00:00",
							"retry": 0,
							"retryIntervalInSeconds": 30,
							"secureOutput": false,
							"secureInput": false
						},
						"userProperties": [],
						"typeProperties": {
							"source": {
								"type": "AzureSqlSource",
								"sqlReaderQuery": "Select Distinct ID ID_Full,sourcedb,sourcetablename  From dbo.control_table Where ProcessName = 'AzSQL_ADLS'  \nAND DataLoadType = 'Full'  and EnableAction = 1 \nand (format(refresh_date,'dd-MM-yyyy') <> format(getdate(),'dd-MM-yyyy') or refresh_date is null)\nand subjectarea like '%Sales Inventory%' \norder by 1 ",
								"queryTimeout": "02:00:00",
								"partitionOption": "None"
							},
							"dataset": {
								"referenceName": "Briggs_MDW",
								"type": "DatasetReference",
								"parameters": {
									"schema_name": "dbo",
									"table_name": "user"
								}
							},
							"firstRowOnly": false
						}
					},
					{
						"name": "ForEach_Incremental_Load",
						"type": "ForEach",
						"dependsOn": [
							{
								"activity": "Lookup1_Incremental",
								"dependencyConditions": [
									"Succeeded"
								]
							}
						],
						"userProperties": [],
						"typeProperties": {
							"items": {
								"value": "@activity('Lookup1_Incremental').output.value",
								"type": "Expression"
							},
							"activities": [
								{
									"name": "Lookup_Incremental",
									"type": "Lookup",
									"dependsOn": [],
									"policy": {
										"timeout": "7.00:00:00",
										"retry": 0,
										"retryIntervalInSeconds": 30,
										"secureOutput": false,
										"secureInput": false
									},
									"userProperties": [],
									"typeProperties": {
										"source": {
											"type": "AzureSqlSource",
											"sqlReaderQuery": {
												"value": "@concat('select SourceQuery=''select '' +columnList+ '' from ''+ sourceDB+''.''+SourceSchemaName+''.''+SourcetableName + '' where \ncast(''+DateField+'' as date) >=''''''+LastDate+''''''''\n,SourceDB\n,TargetContainer\n, TargetPath, TargetFile, FileFormat,DateField,LastDate,targetstagetableschema,targetstagetablename\nfrom dbo.control_table\nwhere ID= ',item().ID_Inc)",
												"type": "Expression"
											},
											"queryTimeout": "02:00:00",
											"partitionOption": "None"
										},
										"dataset": {
											"referenceName": "Briggs_MDW",
											"type": "DatasetReference",
											"parameters": {
												"schema_name": "dbo",
												"table_name": "user"
											}
										}
									}
								},
								{
									"name": "Copy_Briggs_Inc_ADLS",
									"type": "Copy",
									"dependsOn": [
										{
											"activity": "Start_Table_Audit1",
											"dependencyConditions": [
												"Succeeded"
											]
										}
									],
									"policy": {
										"timeout": "7.00:00:00",
										"retry": 0,
										"retryIntervalInSeconds": 30,
										"secureOutput": false,
										"secureInput": false
									},
									"userProperties": [],
									"typeProperties": {
										"source": {
											"type": "SqlServerSource",
											"sqlReaderQuery": {
												"value": "@activity('Lookup_Incremental').output.firstRow.SourceQuery\n",
												"type": "Expression"
											},
											"queryTimeout": "02:00:00",
											"partitionOption": "None"
										},
										"sink": {
											"type": "AzureSqlSink",
											"preCopyScript": {
												"value": "@{concat('delete from ',activity('Lookup_Incremental').output.firstRow.TargetStageTableSchema,'.',activity('Lookup_Incremental').output.firstRow.targetstagetablename,' where cast(',activity('Lookup_Incremental').output.firstRow.DateField,' as date)=','''',activity('Lookup_Incremental').output.firstRow.LastDate,'''')}",
												"type": "Expression"
											},
											"disableMetricsCollection": false
										},
										"enableStaging": false,
										"translator": {
											"type": "TabularTranslator",
											"typeConversion": true,
											"typeConversionSettings": {
												"allowDataTruncation": true,
												"treatBooleanAsNumber": false
											}
										}
									},
									"inputs": [
										{
											"referenceName": "DS_Briggs_MST",
											"type": "DatasetReference",
											"parameters": {}
										}
									],
									"outputs": [
										{
											"referenceName": "Briggs_MDW",
											"type": "DatasetReference",
											"parameters": {
												"schema_name": {
													"value": "@activity('Lookup_Incremental').output.firstRow.TargetStageTableSchema",
													"type": "Expression"
												},
												"table_name": {
													"value": "@activity('Lookup_Incremental').output.firstRow.TargetStageTableName",
													"type": "Expression"
												}
											}
										}
									]
								},
								{
									"name": "Copy_Briggs_Inc_ADLS_New",
									"type": "Copy",
									"dependsOn": [
										{
											"activity": "Copy_Briggs_Inc_ADLS",
											"dependencyConditions": [
												"Failed"
											]
										}
									],
									"policy": {
										"timeout": "7.00:00:00",
										"retry": 0,
										"retryIntervalInSeconds": 30,
										"secureOutput": false,
										"secureInput": false
									},
									"userProperties": [],
									"typeProperties": {
										"source": {
											"type": "SqlServerSource",
											"sqlReaderQuery": {
												"value": "@activity('Lookup_Incremental').output.firstRow.SourceQuery\n",
												"type": "Expression"
											},
											"queryTimeout": "02:00:00",
											"partitionOption": "None"
										},
										"sink": {
											"type": "AzureSqlSink",
											"writeBehavior": "insert",
											"sqlWriterUseTableLock": false,
											"tableOption": "autoCreate",
											"disableMetricsCollection": false
										},
										"enableStaging": false,
										"translator": {
											"type": "TabularTranslator",
											"typeConversion": true,
											"typeConversionSettings": {
												"allowDataTruncation": true,
												"treatBooleanAsNumber": false
											}
										}
									},
									"inputs": [
										{
											"referenceName": "DS_Briggs_MST",
											"type": "DatasetReference",
											"parameters": {}
										}
									],
									"outputs": [
										{
											"referenceName": "Briggs_MDW",
											"type": "DatasetReference",
											"parameters": {
												"schema_name": {
													"value": "@activity('Lookup_Incremental').output.firstRow.TargetStageTableSchema",
													"type": "Expression"
												},
												"table_name": {
													"value": "@activity('Lookup_Incremental').output.firstRow.TargetStageTableName",
													"type": "Expression"
												}
											}
										}
									]
								},
								{
									"name": "Start_Table_Audit1",
									"type": "Lookup",
									"dependsOn": [
										{
											"activity": "Lookup_Incremental",
											"dependencyConditions": [
												"Succeeded"
											]
										}
									],
									"policy": {
										"timeout": "7.00:00:00",
										"retry": 0,
										"retryIntervalInSeconds": 30,
										"secureOutput": false,
										"secureInput": false
									},
									"userProperties": [],
									"typeProperties": {
										"source": {
											"type": "AzureSqlSource",
											"sqlReaderStoredProcedureName": "[dbo].[proc_StartAuditLog_Briggs]",
											"storedProcedureParameters": {
												"ConfigTableID": {
													"type": "Int32",
													"value": {
														"value": "@item().ID_Inc",
														"type": "Expression"
													}
												},
												"DataFactoryName": {
													"type": "String",
													"value": {
														"value": "@pipeline().DataFactory",
														"type": "Expression"
													}
												},
												"ParentAuditID": {
													"type": "Int64",
													"value": {
														"value": "@item().ID_Inc",
														"type": "Expression"
													}
												},
												"PipelineName": {
													"type": "String",
													"value": {
														"value": "@pipeline().Pipeline",
														"type": "Expression"
													}
												},
												"PipelineRunID": {
													"type": "String",
													"value": {
														"value": "@pipeline().RunId",
														"type": "Expression"
													}
												},
												"PipelineTriggerID": {
													"type": "String",
													"value": {
														"value": "@pipeline().TriggerId",
														"type": "Expression"
													}
												},
												"PipelineTriggerName": {
													"type": "String",
													"value": {
														"value": "@pipeline().TriggerName",
														"type": "Expression"
													}
												},
												"PipelineTriggerType": {
													"type": "String",
													"value": {
														"value": "@pipeline().TriggerType",
														"type": "Expression"
													}
												},
												"Sourcedb": {
													"type": "String",
													"value": {
														"value": "@item().sourceDB",
														"type": "Expression"
													}
												},
												"sourcetable": {
													"type": "String",
													"value": {
														"value": "@item().SourcetableName",
														"type": "Expression"
													}
												}
											},
											"queryTimeout": "02:00:00",
											"partitionOption": "None"
										},
										"dataset": {
											"referenceName": "Briggs_MDW",
											"type": "DatasetReference",
											"parameters": {
												"schema_name": "dbo",
												"table_name": "user"
											}
										},
										"firstRowOnly": false
									}
								},
								{
									"name": "Success_Audit_Log1",
									"type": "SqlServerStoredProcedure",
									"dependsOn": [
										{
											"activity": "Copy_Briggs_Inc_ADLS",
											"dependencyConditions": [
												"Succeeded"
											]
										}
									],
									"policy": {
										"timeout": "7.00:00:00",
										"retry": 0,
										"retryIntervalInSeconds": 30,
										"secureOutput": false,
										"secureInput": false
									},
									"userProperties": [],
									"typeProperties": {
										"storedProcedureName": "[dbo].[proc_UpdateAuditLog_Briggs]",
										"storedProcedureParameters": {
											"ConfigTableID": {
												"value": {
													"value": "@item().ID_Inc",
													"type": "Expression"
												},
												"type": "Int32"
											},
											"RowsRead": {
												"value": {
													"value": "@activity('Copy_Briggs_Inc_ADLS').output.RowsRead",
													"type": "Expression"
												},
												"type": "Int64"
											},
											"Status": {
												"value": "Success",
												"type": "String"
											}
										}
									},
									"linkedServiceName": {
										"referenceName": "DS_MDW_SP",
										"type": "LinkedServiceReference"
									}
								},
								{
									"name": "Success_Audit_Log2",
									"type": "SqlServerStoredProcedure",
									"dependsOn": [
										{
											"activity": "Copy_Briggs_Inc_ADLS_New",
											"dependencyConditions": [
												"Succeeded"
											]
										}
									],
									"policy": {
										"timeout": "7.00:00:00",
										"retry": 0,
										"retryIntervalInSeconds": 30,
										"secureOutput": false,
										"secureInput": false
									},
									"userProperties": [],
									"typeProperties": {
										"storedProcedureName": "[dbo].[proc_UpdateAuditLog_Briggs]",
										"storedProcedureParameters": {
											"ConfigTableID": {
												"value": {
													"value": "@item().ID_Inc",
													"type": "Expression"
												},
												"type": "Int32"
											},
											"RowsRead": {
												"value": {
													"value": "@activity('Copy_Briggs_Inc_ADLS_New').output.RowsRead",
													"type": "Expression"
												},
												"type": "Int64"
											},
											"Status": {
												"value": "Success",
												"type": "String"
											}
										}
									},
									"linkedServiceName": {
										"referenceName": "DS_MDW_SP",
										"type": "LinkedServiceReference"
									}
								},
								{
									"name": "Failure_Audit_Log1",
									"type": "SqlServerStoredProcedure",
									"dependsOn": [
										{
											"activity": "Set variable1",
											"dependencyConditions": [
												"Succeeded"
											]
										}
									],
									"policy": {
										"timeout": "7.00:00:00",
										"retry": 0,
										"retryIntervalInSeconds": 30,
										"secureOutput": false,
										"secureInput": false
									},
									"userProperties": [],
									"typeProperties": {
										"storedProcedureName": "[dbo].[proc_UpdateAuditLog_Briggs]",
										"storedProcedureParameters": {
											"ConfigTableID": {
												"value": {
													"value": "@item().ID_Inc",
													"type": "Expression"
												},
												"type": "Int32"
											},
											"RowsRead": {
												"value": null,
												"type": "Int64"
											},
											"Status": {
												"value": {
													"value": "@variables('ErrorMsgInc')",
													"type": "Expression"
												},
												"type": "String"
											}
										}
									},
									"linkedServiceName": {
										"referenceName": "DS_MDW_SP",
										"type": "LinkedServiceReference"
									}
								},
								{
									"name": "Set variable1",
									"type": "SetVariable",
									"dependsOn": [
										{
											"activity": "Copy_Briggs_Inc_ADLS",
											"dependencyConditions": [
												"Failed"
											]
										},
										{
											"activity": "Copy_Briggs_Inc_ADLS_New",
											"dependencyConditions": [
												"Failed"
											]
										}
									],
									"userProperties": [],
									"typeProperties": {
										"variableName": "ErrorMsgInc",
										"value": {
											"value": "@activity('Copy_Briggs_Inc_ADLS').Error.Message",
											"type": "Expression"
										}
									}
								}
							]
						}
					},
					{
						"name": "ForEach_Full_Load",
						"type": "ForEach",
						"dependsOn": [
							{
								"activity": "Lookup2_Full",
								"dependencyConditions": [
									"Succeeded"
								]
							}
						],
						"userProperties": [],
						"typeProperties": {
							"items": {
								"value": "@activity('Lookup2_Full').output.value",
								"type": "Expression"
							},
							"activities": [
								{
									"name": "Lookup_Full",
									"type": "Lookup",
									"dependsOn": [],
									"policy": {
										"timeout": "7.00:00:00",
										"retry": 0,
										"retryIntervalInSeconds": 30,
										"secureOutput": false,
										"secureInput": false
									},
									"userProperties": [],
									"typeProperties": {
										"source": {
											"type": "AzureSqlSource",
											"sqlReaderQuery": {
												"value": "@concat('select SourceQuery=''select '' +columnList+ '' from ''+ sourceDB+''.''+SourceSchemaName+''.''+SourcetableName\n,SourceDB\n,TargetContainer\n, TargetPath, TargetFile, FileFormat,DateField,LastDate,targetstagetableschema,targetstagetablename\nfrom dbo.control_table\nwhere ID= ',item().ID_Full)",
												"type": "Expression"
											},
											"queryTimeout": "02:00:00",
											"partitionOption": "None"
										},
										"dataset": {
											"referenceName": "Briggs_MDW",
											"type": "DatasetReference",
											"parameters": {
												"schema_name": "dbo",
												"table_name": "user"
											}
										}
									}
								},
								{
									"name": "Copy_Briggs_Full_ADLS",
									"type": "Copy",
									"dependsOn": [
										{
											"activity": "Start_Table_Audit",
											"dependencyConditions": [
												"Succeeded"
											]
										}
									],
									"policy": {
										"timeout": "7.00:00:00",
										"retry": 0,
										"retryIntervalInSeconds": 30,
										"secureOutput": false,
										"secureInput": false
									},
									"userProperties": [],
									"typeProperties": {
										"source": {
											"type": "SqlServerSource",
											"sqlReaderQuery": {
												"value": "@activity('Lookup_Full').output.firstRow.SourceQuery\n",
												"type": "Expression"
											},
											"queryTimeout": "02:00:00",
											"partitionOption": "None"
										},
										"sink": {
											"type": "AzureSqlSink",
											"preCopyScript": {
												"value": "@{concat('truncate table ',activity('Lookup_Full').output.firstRow.TargetStageTableSchema,'.',activity('Lookup_Full').output.firstRow.TargetStageTableName)}",
												"type": "Expression"
											},
											"disableMetricsCollection": false
										},
										"enableStaging": false,
										"translator": {
											"type": "TabularTranslator",
											"typeConversion": true,
											"typeConversionSettings": {
												"allowDataTruncation": true,
												"treatBooleanAsNumber": false
											}
										}
									},
									"inputs": [
										{
											"referenceName": "DS_Briggs_MST",
											"type": "DatasetReference",
											"parameters": {}
										}
									],
									"outputs": [
										{
											"referenceName": "Briggs_MDW",
											"type": "DatasetReference",
											"parameters": {
												"schema_name": {
													"value": "@activity('Lookup_Full').output.firstRow.TargetStageTableSchema",
													"type": "Expression"
												},
												"table_name": {
													"value": "@activity('Lookup_Full').output.firstRow.TargetStageTableName",
													"type": "Expression"
												}
											}
										}
									]
								},
								{
									"name": "Copy_Briggs_Full_ADLS_New",
									"type": "Copy",
									"dependsOn": [
										{
											"activity": "Copy_Briggs_Full_ADLS",
											"dependencyConditions": [
												"Failed"
											]
										}
									],
									"policy": {
										"timeout": "7.00:00:00",
										"retry": 0,
										"retryIntervalInSeconds": 30,
										"secureOutput": false,
										"secureInput": false
									},
									"userProperties": [],
									"typeProperties": {
										"source": {
											"type": "SqlServerSource",
											"sqlReaderQuery": {
												"value": "@activity('Lookup_Full').output.firstRow.SourceQuery\n",
												"type": "Expression"
											},
											"queryTimeout": "02:00:00",
											"partitionOption": "None"
										},
										"sink": {
											"type": "AzureSqlSink",
											"writeBehavior": "insert",
											"sqlWriterUseTableLock": false,
											"tableOption": "autoCreate",
											"disableMetricsCollection": false
										},
										"enableStaging": false,
										"translator": {
											"type": "TabularTranslator",
											"typeConversion": true,
											"typeConversionSettings": {
												"allowDataTruncation": true,
												"treatBooleanAsNumber": false
											}
										}
									},
									"inputs": [
										{
											"referenceName": "DS_Briggs_MST",
											"type": "DatasetReference",
											"parameters": {}
										}
									],
									"outputs": [
										{
											"referenceName": "Briggs_MDW",
											"type": "DatasetReference",
											"parameters": {
												"schema_name": {
													"value": "@activity('Lookup_Full').output.firstRow.TargetStageTableSchema",
													"type": "Expression"
												},
												"table_name": {
													"value": "@activity('Lookup_Full').output.firstRow.TargetStageTableName",
													"type": "Expression"
												}
											}
										}
									]
								},
								{
									"name": "Start_Table_Audit",
									"type": "Lookup",
									"dependsOn": [
										{
											"activity": "Lookup_Full",
											"dependencyConditions": [
												"Succeeded"
											]
										}
									],
									"policy": {
										"timeout": "7.00:00:00",
										"retry": 0,
										"retryIntervalInSeconds": 30,
										"secureOutput": false,
										"secureInput": false
									},
									"userProperties": [],
									"typeProperties": {
										"source": {
											"type": "AzureSqlSource",
											"sqlReaderStoredProcedureName": "[dbo].[proc_StartAuditLog_Briggs]",
											"storedProcedureParameters": {
												"ConfigTableID": {
													"type": "Int32",
													"value": {
														"value": "@item().ID_Full",
														"type": "Expression"
													}
												},
												"DataFactoryName": {
													"type": "String",
													"value": {
														"value": "@pipeline().DataFactory",
														"type": "Expression"
													}
												},
												"ParentAuditID": {
													"type": "Int64",
													"value": {
														"value": "@item().ID_Full",
														"type": "Expression"
													}
												},
												"PipelineName": {
													"type": "String",
													"value": {
														"value": "@pipeline().Pipeline",
														"type": "Expression"
													}
												},
												"PipelineRunID": {
													"type": "String",
													"value": {
														"value": "@pipeline().RunId",
														"type": "Expression"
													}
												},
												"PipelineTriggerID": {
													"type": "String",
													"value": {
														"value": "@pipeline().TriggerId",
														"type": "Expression"
													}
												},
												"PipelineTriggerName": {
													"type": "String",
													"value": {
														"value": "@pipeline().TriggerName",
														"type": "Expression"
													}
												},
												"PipelineTriggerType": {
													"type": "String",
													"value": {
														"value": "@pipeline().TriggerType",
														"type": "Expression"
													}
												},
												"Sourcedb": {
													"type": "String",
													"value": {
														"value": "@item().sourceDB",
														"type": "Expression"
													}
												},
												"sourcetable": {
													"type": "String",
													"value": {
														"value": "@item().SourcetableName",
														"type": "Expression"
													}
												}
											},
											"queryTimeout": "02:00:00",
											"partitionOption": "None"
										},
										"dataset": {
											"referenceName": "Briggs_MDW",
											"type": "DatasetReference",
											"parameters": {
												"schema_name": "dbo",
												"table_name": "user"
											}
										},
										"firstRowOnly": false
									}
								},
								{
									"name": "Success_Audit_Log",
									"type": "SqlServerStoredProcedure",
									"dependsOn": [
										{
											"activity": "Copy_Briggs_Full_ADLS",
											"dependencyConditions": [
												"Succeeded"
											]
										}
									],
									"policy": {
										"timeout": "7.00:00:00",
										"retry": 0,
										"retryIntervalInSeconds": 30,
										"secureOutput": false,
										"secureInput": false
									},
									"userProperties": [],
									"typeProperties": {
										"storedProcedureName": "[dbo].[proc_UpdateAuditLog_Briggs]",
										"storedProcedureParameters": {
											"ConfigTableID": {
												"value": {
													"value": "@item().ID_Full",
													"type": "Expression"
												},
												"type": "Int32"
											},
											"RowsRead": {
												"value": {
													"value": "@activity('Copy_Briggs_Full_ADLS').output.RowsRead",
													"type": "Expression"
												},
												"type": "Int64"
											},
											"Status": {
												"value": "Success",
												"type": "String"
											}
										}
									},
									"linkedServiceName": {
										"referenceName": "DS_MDW_SP",
										"type": "LinkedServiceReference"
									}
								},
								{
									"name": "Success_Audit_Log_New",
									"type": "SqlServerStoredProcedure",
									"dependsOn": [
										{
											"activity": "Copy_Briggs_Full_ADLS_New",
											"dependencyConditions": [
												"Succeeded"
											]
										}
									],
									"policy": {
										"timeout": "7.00:00:00",
										"retry": 0,
										"retryIntervalInSeconds": 30,
										"secureOutput": false,
										"secureInput": false
									},
									"userProperties": [],
									"typeProperties": {
										"storedProcedureName": "[dbo].[proc_UpdateAuditLog_Briggs]",
										"storedProcedureParameters": {
											"ConfigTableID": {
												"value": {
													"value": "@item().ID_Full",
													"type": "Expression"
												},
												"type": "Int32"
											},
											"RowsRead": {
												"value": {
													"value": "@activity('Copy_Briggs_Full_ADLS_New').output.RowsRead",
													"type": "Expression"
												},
												"type": "Int64"
											},
											"Status": {
												"value": "Success",
												"type": "String"
											}
										}
									},
									"linkedServiceName": {
										"referenceName": "DS_MDW_SP",
										"type": "LinkedServiceReference"
									}
								},
								{
									"name": "Failure_Audit_Log_New",
									"type": "SqlServerStoredProcedure",
									"dependsOn": [
										{
											"activity": "Set variable2",
											"dependencyConditions": [
												"Succeeded"
											]
										}
									],
									"policy": {
										"timeout": "7.00:00:00",
										"retry": 0,
										"retryIntervalInSeconds": 30,
										"secureOutput": false,
										"secureInput": false
									},
									"userProperties": [],
									"typeProperties": {
										"storedProcedureName": "[dbo].[proc_UpdateAuditLog_Briggs]",
										"storedProcedureParameters": {
											"ConfigTableID": {
												"value": {
													"value": "@item().ID_Full",
													"type": "Expression"
												},
												"type": "Int32"
											},
											"RowsRead": {
												"value": null,
												"type": "Int64"
											},
											"Status": {
												"value": {
													"value": "@variables('ErrorMsgFull')",
													"type": "Expression"
												},
												"type": "String"
											}
										}
									},
									"linkedServiceName": {
										"referenceName": "DS_MDW_SP",
										"type": "LinkedServiceReference"
									}
								},
								{
									"name": "Set variable2",
									"type": "SetVariable",
									"dependsOn": [
										{
											"activity": "Copy_Briggs_Full_ADLS",
											"dependencyConditions": [
												"Failed"
											]
										},
										{
											"activity": "Copy_Briggs_Full_ADLS_New",
											"dependencyConditions": [
												"Failed"
											]
										}
									],
									"userProperties": [],
									"typeProperties": {
										"variableName": "ErrorMsgFull",
										"value": {
											"value": "@activity('Copy_Briggs_Full_ADLS').Error.Message",
											"type": "Expression"
										}
									}
								}
							]
						}
					},
					{
						"name": "ForEach_Proc_Incremental",
						"type": "ForEach",
						"dependsOn": [
							{
								"activity": "ForEach_Incremental_Load",
								"dependencyConditions": [
									"Succeeded"
								]
							}
						],
						"userProperties": [],
						"typeProperties": {
							"items": {
								"value": "@activity('Lookup1_Incremental').output.value",
								"type": "Expression"
							},
							"activities": [
								{
									"name": "Stored procedure1",
									"type": "SqlServerStoredProcedure",
									"dependsOn": [],
									"policy": {
										"timeout": "7.00:00:00",
										"retry": 0,
										"retryIntervalInSeconds": 30,
										"secureOutput": false,
										"secureInput": false
									},
									"userProperties": [],
									"typeProperties": {
										"storedProcedureName": "[dbo].[USP_Control_Table_LastDate]",
										"storedProcedureParameters": {
											"id_I_F": {
												"value": {
													"value": "@item().ID_Inc",
													"type": "Expression"
												},
												"type": "Int32"
											}
										}
									},
									"linkedServiceName": {
										"referenceName": "DS_MDW_SP",
										"type": "LinkedServiceReference"
									}
								}
							]
						}
					},
					{
						"name": "ForEach_Proc_Full",
						"type": "ForEach",
						"dependsOn": [
							{
								"activity": "ForEach_Full_Load",
								"dependencyConditions": [
									"Succeeded"
								]
							}
						],
						"userProperties": [],
						"typeProperties": {
							"items": {
								"value": "@activity('Lookup2_Full').output.value",
								"type": "Expression"
							},
							"activities": [
								{
									"name": "Stored procedure_Full",
									"type": "SqlServerStoredProcedure",
									"dependsOn": [],
									"policy": {
										"timeout": "7.00:00:00",
										"retry": 0,
										"retryIntervalInSeconds": 30,
										"secureOutput": false,
										"secureInput": false
									},
									"userProperties": [],
									"typeProperties": {
										"storedProcedureName": "[dbo].[USP_Control_Table_LastDate]",
										"storedProcedureParameters": {
											"id_I_F": {
												"value": {
													"value": "@item().ID_Full",
													"type": "Expression"
												},
												"type": "Int32"
											}
										}
									},
									"linkedServiceName": {
										"referenceName": "DS_MDW_SP",
										"type": "LinkedServiceReference"
									}
								}
							]
						}
					},
					{
						"name": "lkp_ExecStartAuditProc",
						"type": "Lookup",
						"dependsOn": [],
						"policy": {
							"timeout": "7.00:00:00",
							"retry": 0,
							"retryIntervalInSeconds": 30,
							"secureOutput": false,
							"secureInput": false
						},
						"userProperties": [],
						"typeProperties": {
							"source": {
								"type": "AzureSqlSource",
								"sqlReaderStoredProcedureName": "[dbo].[proc_StartAuditLog]",
								"storedProcedureParameters": {
									"ConfigTableID": {
										"type": "Int32",
										"value": "-1"
									},
									"DataFactoryName": {
										"type": "String",
										"value": {
											"value": "@pipeline().DataFactory",
											"type": "Expression"
										}
									},
									"ParentAuditID": {
										"type": "Int64",
										"value": "-1"
									},
									"PipelineName": {
										"type": "String",
										"value": {
											"value": "@concat(pipeline().Pipeline,' Inventory Source Table Load')",
											"type": "Expression"
										}
									},
									"PipelineRunID": {
										"type": "String",
										"value": {
											"value": "@pipeline().RunId",
											"type": "Expression"
										}
									},
									"PipelineTriggerID": {
										"type": "String",
										"value": {
											"value": "@pipeline().TriggerId",
											"type": "Expression"
										}
									},
									"PipelineTriggerName": {
										"type": "String",
										"value": {
											"value": "@pipeline().TriggerName",
											"type": "Expression"
										}
									},
									"PipelineTriggerType": {
										"type": "String",
										"value": {
											"value": "@pipeline().TriggerType",
											"type": "Expression"
										}
									}
								},
								"queryTimeout": "02:00:00",
								"partitionOption": "None"
							},
							"dataset": {
								"referenceName": "Briggs_MDW",
								"type": "DatasetReference",
								"parameters": {
									"schema_name": "dbo",
									"table_name": "user"
								}
							}
						}
					},
					{
						"name": "Sp_ExecFailureAudit_Full",
						"type": "SqlServerStoredProcedure",
						"dependsOn": [
							{
								"activity": "ForEach_Full_Load",
								"dependencyConditions": [
									"Failed"
								]
							}
						],
						"policy": {
							"timeout": "7.00:00:00",
							"retry": 0,
							"retryIntervalInSeconds": 30,
							"secureOutput": false,
							"secureInput": false
						},
						"userProperties": [],
						"typeProperties": {
							"storedProcedureName": "[dbo].[proc_UpdateAuditLog]",
							"storedProcedureParameters": {
								"AuditID": {
									"value": {
										"value": "@activity('lkp_ExecStartAuditProc').output.firstRow.AuditID",
										"type": "Expression"
									},
									"type": "Int32"
								},
								"DataLakePath": {
									"value": null,
									"type": "String"
								},
								"PipelineRunID": {
									"value": {
										"value": "@pipeline().RunId",
										"type": "Expression"
									},
									"type": "String"
								},
								"RowsRead": {
									"value": null,
									"type": "Int64"
								},
								"Status": {
									"value": "Full Load Failed",
									"type": "String"
								}
							}
						},
						"linkedServiceName": {
							"referenceName": "AzureSqlDatabase1",
							"type": "LinkedServiceReference"
						}
					},
					{
						"name": "Sp_ExecSuccessAudit",
						"type": "SqlServerStoredProcedure",
						"dependsOn": [
							{
								"activity": "ForEach_Proc_Incremental",
								"dependencyConditions": [
									"Succeeded"
								]
							},
							{
								"activity": "ForEach_Proc_Full",
								"dependencyConditions": [
									"Succeeded"
								]
							}
						],
						"policy": {
							"timeout": "7.00:00:00",
							"retry": 0,
							"retryIntervalInSeconds": 30,
							"secureOutput": false,
							"secureInput": false
						},
						"userProperties": [],
						"typeProperties": {
							"storedProcedureName": "[dbo].[proc_UpdateAuditLog]",
							"storedProcedureParameters": {
								"AuditID": {
									"value": {
										"value": "@activity('lkp_ExecStartAuditProc').output.firstRow.AuditID",
										"type": "Expression"
									},
									"type": "Int32"
								},
								"DataLakePath": {
									"value": null,
									"type": "String"
								},
								"RowsRead": {
									"value": null,
									"type": "Int64"
								},
								"Status": {
									"value": "Success",
									"type": "String"
								},
								"PipelineRunID": {
									"value": {
										"value": "@pipeline().RunId",
										"type": "Expression"
									},
									"type": "String"
								}
							}
						},
						"linkedServiceName": {
							"referenceName": "AzureSqlDatabase1",
							"type": "LinkedServiceReference"
						}
					},
					{
						"name": "Sp_ExecFailureAudit_Inc",
						"type": "SqlServerStoredProcedure",
						"dependsOn": [
							{
								"activity": "ForEach_Incremental_Load",
								"dependencyConditions": [
									"Failed"
								]
							}
						],
						"policy": {
							"timeout": "7.00:00:00",
							"retry": 0,
							"retryIntervalInSeconds": 30,
							"secureOutput": false,
							"secureInput": false
						},
						"userProperties": [],
						"typeProperties": {
							"storedProcedureName": "[dbo].[proc_UpdateAuditLog]",
							"storedProcedureParameters": {
								"AuditID": {
									"value": {
										"value": "@activity('lkp_ExecStartAuditProc').output.firstRow.AuditID",
										"type": "Expression"
									},
									"type": "Int32"
								},
								"DataLakePath": {
									"value": null,
									"type": "String"
								},
								"PipelineRunID": {
									"value": {
										"value": "@pipeline().RunId",
										"type": "Expression"
									},
									"type": "String"
								},
								"RowsRead": {
									"value": null,
									"type": "Int64"
								},
								"Status": {
									"value": "Incr Load Failed",
									"type": "String"
								}
							}
						},
						"linkedServiceName": {
							"referenceName": "AzureSqlDatabase1",
							"type": "LinkedServiceReference"
						}
					}
				],
				"policy": {
					"elapsedTimeMetric": {},
					"cancelAfter": {}
				},
				"variables": {
					"ErrorMsgInc": {
						"type": "String"
					},
					"ErrorMsgFull": {
						"type": "String"
					}
				},
				"folder": {
					"name": "Briggs Data Load Theme wise"
				},
				"annotations": [],
				"lastPublishTime": "2022-04-26T07:21:45Z"
			},
			"dependsOn": [
				"[concat(variables('workspaceId'), '/datasets/Briggs_MDW')]",
				"[concat(variables('workspaceId'), '/linkedServices/AzureSqlDatabase1')]",
				"[concat(variables('workspaceId'), '/datasets/DS_Briggs_MST')]",
				"[concat(variables('workspaceId'), '/linkedServices/DS_MDW_SP')]"
			]
		},
		{
			"name": "[concat(parameters('workspaceName'), '/PL_Generic_Copy_Invoices')]",
			"type": "Microsoft.Synapse/workspaces/pipelines",
			"apiVersion": "2019-06-01-preview",
			"properties": {
				"activities": [
					{
						"name": "Lookup1_Incremental",
						"type": "Lookup",
						"dependsOn": [
							{
								"activity": "lkp_ExecStartAuditProc",
								"dependencyConditions": [
									"Succeeded"
								]
							}
						],
						"policy": {
							"timeout": "7.00:00:00",
							"retry": 0,
							"retryIntervalInSeconds": 30,
							"secureOutput": false,
							"secureInput": false
						},
						"userProperties": [],
						"typeProperties": {
							"source": {
								"type": "AzureSqlSource",
								"sqlReaderQuery": "Select Distinct ID ID_Inc,sourcedb,sourcetablename  From dbo.control_table Where ProcessName = 'AzSQL_ADLS'  \nAND DataLoadType = 'Incremental'  and EnableAction = 1  \nand (format(refresh_date,'dd-MM-yyyy') <> format(getdate(),'dd-MM-yyyy') or refresh_date is null)\nand subjectarea like '%Sales Invoices%' and id <> 253 \norder by 1 ",
								"queryTimeout": "02:00:00",
								"partitionOption": "None"
							},
							"dataset": {
								"referenceName": "Briggs_MDW",
								"type": "DatasetReference",
								"parameters": {
									"schema_name": "dbo",
									"table_name": "user"
								}
							},
							"firstRowOnly": false
						}
					},
					{
						"name": "Lookup2_Full",
						"type": "Lookup",
						"dependsOn": [
							{
								"activity": "lkp_ExecStartAuditProc",
								"dependencyConditions": [
									"Succeeded"
								]
							}
						],
						"policy": {
							"timeout": "7.00:00:00",
							"retry": 0,
							"retryIntervalInSeconds": 30,
							"secureOutput": false,
							"secureInput": false
						},
						"userProperties": [],
						"typeProperties": {
							"source": {
								"type": "AzureSqlSource",
								"sqlReaderQuery": "Select Distinct ID ID_Full,sourcedb,sourcetablename  From dbo.control_table Where ProcessName = 'AzSQL_ADLS'  \nAND DataLoadType = 'Full'  and EnableAction = 1 \nand (format(refresh_date,'dd-MM-yyyy') <> format(getdate(),'dd-MM-yyyy') or refresh_date is null)\nand subjectarea like '%Sales Invoices%' \norder by 1 ",
								"queryTimeout": "02:00:00",
								"partitionOption": "None"
							},
							"dataset": {
								"referenceName": "Briggs_MDW",
								"type": "DatasetReference",
								"parameters": {
									"schema_name": "dbo",
									"table_name": "user"
								}
							},
							"firstRowOnly": false
						}
					},
					{
						"name": "ForEach_Incremental_Load",
						"type": "ForEach",
						"dependsOn": [
							{
								"activity": "Lookup1_Incremental",
								"dependencyConditions": [
									"Succeeded"
								]
							}
						],
						"userProperties": [],
						"typeProperties": {
							"items": {
								"value": "@activity('Lookup1_Incremental').output.value",
								"type": "Expression"
							},
							"activities": [
								{
									"name": "Lookup_Incremental",
									"type": "Lookup",
									"dependsOn": [],
									"policy": {
										"timeout": "7.00:00:00",
										"retry": 0,
										"retryIntervalInSeconds": 30,
										"secureOutput": false,
										"secureInput": false
									},
									"userProperties": [],
									"typeProperties": {
										"source": {
											"type": "AzureSqlSource",
											"sqlReaderQuery": {
												"value": "@concat('select SourceQuery=''select '' +columnList+ '' from ''+ sourceDB+''.''+SourceSchemaName+''.''+SourcetableName + '' where \ncast(''+DateField+'' as date) >=''''''+LastDate+''''''''\n,SourceDB\n,TargetContainer\n, TargetPath, TargetFile, FileFormat,DateField,LastDate,targetstagetableschema,targetstagetablename\nfrom dbo.control_table\nwhere ID= ',item().ID_Inc)",
												"type": "Expression"
											},
											"queryTimeout": "02:00:00",
											"partitionOption": "None"
										},
										"dataset": {
											"referenceName": "Briggs_MDW",
											"type": "DatasetReference",
											"parameters": {
												"schema_name": "dbo",
												"table_name": "user"
											}
										}
									}
								},
								{
									"name": "Copy_Briggs_Inc_ADLS",
									"type": "Copy",
									"dependsOn": [
										{
											"activity": "Start_Table_Audit1",
											"dependencyConditions": [
												"Succeeded"
											]
										}
									],
									"policy": {
										"timeout": "7.00:00:00",
										"retry": 0,
										"retryIntervalInSeconds": 30,
										"secureOutput": false,
										"secureInput": false
									},
									"userProperties": [],
									"typeProperties": {
										"source": {
											"type": "SqlServerSource",
											"sqlReaderQuery": {
												"value": "@activity('Lookup_Incremental').output.firstRow.SourceQuery\n",
												"type": "Expression"
											},
											"queryTimeout": "02:00:00",
											"partitionOption": "None"
										},
										"sink": {
											"type": "AzureSqlSink",
											"preCopyScript": {
												"value": "@{concat('delete from ',activity('Lookup_Incremental').output.firstRow.TargetStageTableSchema,'.',activity('Lookup_Incremental').output.firstRow.targetstagetablename,' where cast(',activity('Lookup_Incremental').output.firstRow.DateField,' as date)=','''',activity('Lookup_Incremental').output.firstRow.LastDate,'''')}",
												"type": "Expression"
											},
											"disableMetricsCollection": false
										},
										"enableStaging": false,
										"translator": {
											"type": "TabularTranslator",
											"typeConversion": true,
											"typeConversionSettings": {
												"allowDataTruncation": true,
												"treatBooleanAsNumber": false
											}
										}
									},
									"inputs": [
										{
											"referenceName": "DS_Briggs_MST",
											"type": "DatasetReference",
											"parameters": {}
										}
									],
									"outputs": [
										{
											"referenceName": "Briggs_MDW",
											"type": "DatasetReference",
											"parameters": {
												"schema_name": {
													"value": "@activity('Lookup_Incremental').output.firstRow.TargetStageTableSchema",
													"type": "Expression"
												},
												"table_name": {
													"value": "@activity('Lookup_Incremental').output.firstRow.TargetStageTableName",
													"type": "Expression"
												}
											}
										}
									]
								},
								{
									"name": "Copy_Briggs_Inc_ADLS_New",
									"type": "Copy",
									"dependsOn": [
										{
											"activity": "Copy_Briggs_Inc_ADLS",
											"dependencyConditions": [
												"Failed"
											]
										}
									],
									"policy": {
										"timeout": "7.00:00:00",
										"retry": 0,
										"retryIntervalInSeconds": 30,
										"secureOutput": false,
										"secureInput": false
									},
									"userProperties": [],
									"typeProperties": {
										"source": {
											"type": "SqlServerSource",
											"sqlReaderQuery": {
												"value": "@activity('Lookup_Incremental').output.firstRow.SourceQuery\n",
												"type": "Expression"
											},
											"queryTimeout": "02:00:00",
											"partitionOption": "None"
										},
										"sink": {
											"type": "AzureSqlSink",
											"writeBehavior": "insert",
											"sqlWriterUseTableLock": false,
											"tableOption": "autoCreate",
											"disableMetricsCollection": false
										},
										"enableStaging": false,
										"translator": {
											"type": "TabularTranslator",
											"typeConversion": true,
											"typeConversionSettings": {
												"allowDataTruncation": true,
												"treatBooleanAsNumber": false
											}
										}
									},
									"inputs": [
										{
											"referenceName": "DS_Briggs_MST",
											"type": "DatasetReference",
											"parameters": {}
										}
									],
									"outputs": [
										{
											"referenceName": "Briggs_MDW",
											"type": "DatasetReference",
											"parameters": {
												"schema_name": {
													"value": "@activity('Lookup_Incremental').output.firstRow.TargetStageTableSchema",
													"type": "Expression"
												},
												"table_name": {
													"value": "@activity('Lookup_Incremental').output.firstRow.TargetStageTableName",
													"type": "Expression"
												}
											}
										}
									]
								},
								{
									"name": "Start_Table_Audit1",
									"type": "Lookup",
									"dependsOn": [
										{
											"activity": "Lookup_Incremental",
											"dependencyConditions": [
												"Succeeded"
											]
										}
									],
									"policy": {
										"timeout": "7.00:00:00",
										"retry": 0,
										"retryIntervalInSeconds": 30,
										"secureOutput": false,
										"secureInput": false
									},
									"userProperties": [],
									"typeProperties": {
										"source": {
											"type": "AzureSqlSource",
											"sqlReaderStoredProcedureName": "[dbo].[proc_StartAuditLog_Briggs]",
											"storedProcedureParameters": {
												"ConfigTableID": {
													"type": "Int32",
													"value": {
														"value": "@item().ID_Inc",
														"type": "Expression"
													}
												},
												"DataFactoryName": {
													"type": "String",
													"value": {
														"value": "@pipeline().DataFactory",
														"type": "Expression"
													}
												},
												"ParentAuditID": {
													"type": "Int64",
													"value": {
														"value": "@item().ID_Inc",
														"type": "Expression"
													}
												},
												"PipelineName": {
													"type": "String",
													"value": {
														"value": "@pipeline().Pipeline",
														"type": "Expression"
													}
												},
												"PipelineRunID": {
													"type": "String",
													"value": {
														"value": "@pipeline().RunId",
														"type": "Expression"
													}
												},
												"PipelineTriggerID": {
													"type": "String",
													"value": {
														"value": "@pipeline().TriggerId",
														"type": "Expression"
													}
												},
												"PipelineTriggerName": {
													"type": "String",
													"value": {
														"value": "@pipeline().TriggerName",
														"type": "Expression"
													}
												},
												"PipelineTriggerType": {
													"type": "String",
													"value": {
														"value": "@pipeline().TriggerType",
														"type": "Expression"
													}
												},
												"Sourcedb": {
													"type": "String",
													"value": {
														"value": "@item().sourceDB",
														"type": "Expression"
													}
												},
												"sourcetable": {
													"type": "String",
													"value": {
														"value": "@item().SourcetableName",
														"type": "Expression"
													}
												}
											},
											"queryTimeout": "02:00:00",
											"partitionOption": "None"
										},
										"dataset": {
											"referenceName": "Briggs_MDW",
											"type": "DatasetReference",
											"parameters": {
												"schema_name": "dbo",
												"table_name": "user"
											}
										},
										"firstRowOnly": false
									}
								},
								{
									"name": "Success_Audit_Log1",
									"type": "SqlServerStoredProcedure",
									"dependsOn": [
										{
											"activity": "Copy_Briggs_Inc_ADLS",
											"dependencyConditions": [
												"Succeeded"
											]
										}
									],
									"policy": {
										"timeout": "7.00:00:00",
										"retry": 0,
										"retryIntervalInSeconds": 30,
										"secureOutput": false,
										"secureInput": false
									},
									"userProperties": [],
									"typeProperties": {
										"storedProcedureName": "[dbo].[proc_UpdateAuditLog_Briggs]",
										"storedProcedureParameters": {
											"ConfigTableID": {
												"value": {
													"value": "@item().ID_Inc",
													"type": "Expression"
												},
												"type": "Int32"
											},
											"RowsRead": {
												"value": {
													"value": "@activity('Copy_Briggs_Inc_ADLS').output.RowsRead",
													"type": "Expression"
												},
												"type": "Int64"
											},
											"Status": {
												"value": "Success",
												"type": "String"
											}
										}
									},
									"linkedServiceName": {
										"referenceName": "DS_MDW_SP",
										"type": "LinkedServiceReference"
									}
								},
								{
									"name": "Success_Audit_Log2",
									"type": "SqlServerStoredProcedure",
									"dependsOn": [
										{
											"activity": "Copy_Briggs_Inc_ADLS_New",
											"dependencyConditions": [
												"Succeeded"
											]
										}
									],
									"policy": {
										"timeout": "7.00:00:00",
										"retry": 0,
										"retryIntervalInSeconds": 30,
										"secureOutput": false,
										"secureInput": false
									},
									"userProperties": [],
									"typeProperties": {
										"storedProcedureName": "[dbo].[proc_UpdateAuditLog_Briggs]",
										"storedProcedureParameters": {
											"ConfigTableID": {
												"value": {
													"value": "@item().ID_Inc",
													"type": "Expression"
												},
												"type": "Int32"
											},
											"RowsRead": {
												"value": {
													"value": "@activity('Copy_Briggs_Inc_ADLS_New').output.RowsRead",
													"type": "Expression"
												},
												"type": "Int64"
											},
											"Status": {
												"value": "Success",
												"type": "String"
											}
										}
									},
									"linkedServiceName": {
										"referenceName": "DS_MDW_SP",
										"type": "LinkedServiceReference"
									}
								},
								{
									"name": "Failure_Audit_Log2",
									"type": "SqlServerStoredProcedure",
									"dependsOn": [
										{
											"activity": "Set variable1",
											"dependencyConditions": [
												"Succeeded"
											]
										}
									],
									"policy": {
										"timeout": "7.00:00:00",
										"retry": 0,
										"retryIntervalInSeconds": 30,
										"secureOutput": false,
										"secureInput": false
									},
									"userProperties": [],
									"typeProperties": {
										"storedProcedureName": "[dbo].[proc_UpdateAuditLog_Briggs]",
										"storedProcedureParameters": {
											"ConfigTableID": {
												"value": {
													"value": "@item().ID_Inc",
													"type": "Expression"
												},
												"type": "Int32"
											},
											"RowsRead": {
												"value": null,
												"type": "Int64"
											},
											"Status": {
												"value": {
													"value": "@variables('ErrorMsgInc')",
													"type": "Expression"
												},
												"type": "String"
											}
										}
									},
									"linkedServiceName": {
										"referenceName": "DS_MDW_SP",
										"type": "LinkedServiceReference"
									}
								},
								{
									"name": "Set variable1",
									"type": "SetVariable",
									"dependsOn": [
										{
											"activity": "Copy_Briggs_Inc_ADLS_New",
											"dependencyConditions": [
												"Failed"
											]
										},
										{
											"activity": "Copy_Briggs_Inc_ADLS",
											"dependencyConditions": [
												"Failed"
											]
										}
									],
									"userProperties": [],
									"typeProperties": {
										"variableName": "ErrorMsgInc",
										"value": {
											"value": "@activity('Copy_Briggs_Inc_ADLS').Error.Message",
											"type": "Expression"
										}
									}
								}
							]
						}
					},
					{
						"name": "ForEach_Full_Load",
						"type": "ForEach",
						"dependsOn": [
							{
								"activity": "Lookup2_Full",
								"dependencyConditions": [
									"Succeeded"
								]
							}
						],
						"userProperties": [],
						"typeProperties": {
							"items": {
								"value": "@activity('Lookup2_Full').output.value",
								"type": "Expression"
							},
							"activities": [
								{
									"name": "Lookup_Full",
									"type": "Lookup",
									"dependsOn": [],
									"policy": {
										"timeout": "7.00:00:00",
										"retry": 0,
										"retryIntervalInSeconds": 30,
										"secureOutput": false,
										"secureInput": false
									},
									"userProperties": [],
									"typeProperties": {
										"source": {
											"type": "AzureSqlSource",
											"sqlReaderQuery": {
												"value": "@concat('select SourceQuery=''select '' +columnList+ '' from ''+ sourceDB+''.''+SourceSchemaName+''.''+SourcetableName\n,SourceDB\n,TargetContainer\n, TargetPath, TargetFile, FileFormat,DateField,LastDate,targetstagetableschema,targetstagetablename\nfrom dbo.control_table\nwhere ID= ',item().ID_Full)",
												"type": "Expression"
											},
											"queryTimeout": "02:00:00",
											"partitionOption": "None"
										},
										"dataset": {
											"referenceName": "Briggs_MDW",
											"type": "DatasetReference",
											"parameters": {
												"schema_name": "dbo",
												"table_name": "user"
											}
										}
									}
								},
								{
									"name": "Copy_Briggs_Full_ADLS",
									"type": "Copy",
									"dependsOn": [
										{
											"activity": "Start_Table_Audit",
											"dependencyConditions": [
												"Succeeded"
											]
										}
									],
									"policy": {
										"timeout": "7.00:00:00",
										"retry": 0,
										"retryIntervalInSeconds": 30,
										"secureOutput": false,
										"secureInput": false
									},
									"userProperties": [],
									"typeProperties": {
										"source": {
											"type": "SqlServerSource",
											"sqlReaderQuery": {
												"value": "@activity('Lookup_Full').output.firstRow.SourceQuery\n",
												"type": "Expression"
											},
											"queryTimeout": "02:00:00",
											"partitionOption": "None"
										},
										"sink": {
											"type": "AzureSqlSink",
											"preCopyScript": {
												"value": "@{concat('truncate table ',activity('Lookup_Full').output.firstRow.TargetStageTableSchema,'.',activity('Lookup_Full').output.firstRow.TargetStageTableName)}",
												"type": "Expression"
											},
											"disableMetricsCollection": false
										},
										"enableStaging": false,
										"translator": {
											"type": "TabularTranslator",
											"typeConversion": true,
											"typeConversionSettings": {
												"allowDataTruncation": true,
												"treatBooleanAsNumber": false
											}
										}
									},
									"inputs": [
										{
											"referenceName": "DS_Briggs_MST",
											"type": "DatasetReference",
											"parameters": {}
										}
									],
									"outputs": [
										{
											"referenceName": "Briggs_MDW",
											"type": "DatasetReference",
											"parameters": {
												"schema_name": {
													"value": "@activity('Lookup_Full').output.firstRow.TargetStageTableSchema",
													"type": "Expression"
												},
												"table_name": {
													"value": "@activity('Lookup_Full').output.firstRow.TargetStageTableName",
													"type": "Expression"
												}
											}
										}
									]
								},
								{
									"name": "Copy_Briggs_Full_ADLS_New",
									"type": "Copy",
									"dependsOn": [
										{
											"activity": "Copy_Briggs_Full_ADLS",
											"dependencyConditions": [
												"Failed"
											]
										}
									],
									"policy": {
										"timeout": "7.00:00:00",
										"retry": 0,
										"retryIntervalInSeconds": 30,
										"secureOutput": false,
										"secureInput": false
									},
									"userProperties": [],
									"typeProperties": {
										"source": {
											"type": "SqlServerSource",
											"sqlReaderQuery": {
												"value": "@activity('Lookup_Full').output.firstRow.SourceQuery\n",
												"type": "Expression"
											},
											"queryTimeout": "02:00:00",
											"partitionOption": "None"
										},
										"sink": {
											"type": "AzureSqlSink",
											"tableOption": "autoCreate",
											"disableMetricsCollection": false
										},
										"enableStaging": false,
										"translator": {
											"type": "TabularTranslator",
											"typeConversion": true,
											"typeConversionSettings": {
												"allowDataTruncation": true,
												"treatBooleanAsNumber": false
											}
										}
									},
									"inputs": [
										{
											"referenceName": "DS_Briggs_MST",
											"type": "DatasetReference",
											"parameters": {}
										}
									],
									"outputs": [
										{
											"referenceName": "Briggs_MDW",
											"type": "DatasetReference",
											"parameters": {
												"schema_name": {
													"value": "@activity('Lookup_Full').output.firstRow.TargetStageTableSchema",
													"type": "Expression"
												},
												"table_name": {
													"value": "@activity('Lookup_Full').output.firstRow.TargetStageTableName",
													"type": "Expression"
												}
											}
										}
									]
								},
								{
									"name": "Start_Table_Audit",
									"type": "Lookup",
									"dependsOn": [
										{
											"activity": "Lookup_Full",
											"dependencyConditions": [
												"Succeeded"
											]
										}
									],
									"policy": {
										"timeout": "7.00:00:00",
										"retry": 0,
										"retryIntervalInSeconds": 30,
										"secureOutput": false,
										"secureInput": false
									},
									"userProperties": [],
									"typeProperties": {
										"source": {
											"type": "AzureSqlSource",
											"sqlReaderStoredProcedureName": "[dbo].[proc_StartAuditLog_Briggs]",
											"storedProcedureParameters": {
												"ConfigTableID": {
													"type": "Int32",
													"value": {
														"value": "@item().ID_Full",
														"type": "Expression"
													}
												},
												"DataFactoryName": {
													"type": "String",
													"value": {
														"value": "@pipeline().DataFactory",
														"type": "Expression"
													}
												},
												"ParentAuditID": {
													"type": "Int64",
													"value": {
														"value": "@item().ID_Full",
														"type": "Expression"
													}
												},
												"PipelineName": {
													"type": "String",
													"value": {
														"value": "@pipeline().Pipeline",
														"type": "Expression"
													}
												},
												"PipelineRunID": {
													"type": "String",
													"value": {
														"value": "@pipeline().RunId",
														"type": "Expression"
													}
												},
												"PipelineTriggerID": {
													"type": "String",
													"value": {
														"value": "@pipeline().TriggerId",
														"type": "Expression"
													}
												},
												"PipelineTriggerName": {
													"type": "String",
													"value": {
														"value": "@pipeline().TriggerName",
														"type": "Expression"
													}
												},
												"PipelineTriggerType": {
													"type": "String",
													"value": {
														"value": "@pipeline().TriggerType",
														"type": "Expression"
													}
												},
												"Sourcedb": {
													"type": "String",
													"value": {
														"value": "@item().sourceDB",
														"type": "Expression"
													}
												},
												"sourcetable": {
													"type": "String",
													"value": {
														"value": "@item().SourcetableName",
														"type": "Expression"
													}
												}
											},
											"queryTimeout": "02:00:00",
											"partitionOption": "None"
										},
										"dataset": {
											"referenceName": "Briggs_MDW",
											"type": "DatasetReference",
											"parameters": {
												"schema_name": "dbo",
												"table_name": "user"
											}
										},
										"firstRowOnly": false
									}
								},
								{
									"name": "Success_Audit_Log",
									"type": "SqlServerStoredProcedure",
									"dependsOn": [
										{
											"activity": "Copy_Briggs_Full_ADLS",
											"dependencyConditions": [
												"Succeeded"
											]
										}
									],
									"policy": {
										"timeout": "7.00:00:00",
										"retry": 0,
										"retryIntervalInSeconds": 30,
										"secureOutput": false,
										"secureInput": false
									},
									"userProperties": [],
									"typeProperties": {
										"storedProcedureName": "[dbo].[proc_UpdateAuditLog_Briggs]",
										"storedProcedureParameters": {
											"ConfigTableID": {
												"value": {
													"value": "@item().ID_Full",
													"type": "Expression"
												},
												"type": "Int32"
											},
											"RowsRead": {
												"value": {
													"value": "@activity('Copy_Briggs_Full_ADLS').output.RowsRead",
													"type": "Expression"
												},
												"type": "Int64"
											},
											"Status": {
												"value": "Success",
												"type": "String"
											}
										}
									},
									"linkedServiceName": {
										"referenceName": "DS_MDW_SP",
										"type": "LinkedServiceReference"
									}
								},
								{
									"name": "Success_Audit_Log_New",
									"type": "SqlServerStoredProcedure",
									"dependsOn": [
										{
											"activity": "Copy_Briggs_Full_ADLS_New",
											"dependencyConditions": [
												"Succeeded"
											]
										}
									],
									"policy": {
										"timeout": "7.00:00:00",
										"retry": 0,
										"retryIntervalInSeconds": 30,
										"secureOutput": false,
										"secureInput": false
									},
									"userProperties": [],
									"typeProperties": {
										"storedProcedureName": "[dbo].[proc_UpdateAuditLog_Briggs]",
										"storedProcedureParameters": {
											"ConfigTableID": {
												"value": {
													"value": "@item().ID_Full",
													"type": "Expression"
												},
												"type": "Int32"
											},
											"RowsRead": {
												"value": {
													"value": "@activity('Copy_Briggs_Full_ADLS_New').output.RowsRead",
													"type": "Expression"
												},
												"type": "Int64"
											},
											"Status": {
												"value": "Success",
												"type": "String"
											}
										}
									},
									"linkedServiceName": {
										"referenceName": "DS_MDW_SP",
										"type": "LinkedServiceReference"
									}
								},
								{
									"name": "Failure_Audit_Log_New",
									"type": "SqlServerStoredProcedure",
									"dependsOn": [
										{
											"activity": "Set variable2",
											"dependencyConditions": [
												"Succeeded"
											]
										}
									],
									"policy": {
										"timeout": "7.00:00:00",
										"retry": 0,
										"retryIntervalInSeconds": 30,
										"secureOutput": false,
										"secureInput": false
									},
									"userProperties": [],
									"typeProperties": {
										"storedProcedureName": "[dbo].[proc_UpdateAuditLog_Briggs]",
										"storedProcedureParameters": {
											"ConfigTableID": {
												"value": {
													"value": "@item().ID_Full",
													"type": "Expression"
												},
												"type": "Int32"
											},
											"RowsRead": {
												"value": null,
												"type": "Int64"
											},
											"Status": {
												"value": {
													"value": "@variables('ErrorMsgFull')",
													"type": "Expression"
												},
												"type": "String"
											}
										}
									},
									"linkedServiceName": {
										"referenceName": "DS_MDW_SP",
										"type": "LinkedServiceReference"
									}
								},
								{
									"name": "Set variable2",
									"type": "SetVariable",
									"dependsOn": [
										{
											"activity": "Copy_Briggs_Full_ADLS",
											"dependencyConditions": [
												"Failed"
											]
										},
										{
											"activity": "Copy_Briggs_Full_ADLS_New",
											"dependencyConditions": [
												"Failed"
											]
										}
									],
									"userProperties": [],
									"typeProperties": {
										"variableName": "ErrorMsgFull",
										"value": {
											"value": "@activity('Copy_Briggs_Full_ADLS').Error.Message",
											"type": "Expression"
										}
									}
								}
							]
						}
					},
					{
						"name": "ForEach_Proc_Incremental",
						"type": "ForEach",
						"dependsOn": [
							{
								"activity": "ForEach_Incremental_Load",
								"dependencyConditions": [
									"Succeeded"
								]
							}
						],
						"userProperties": [],
						"typeProperties": {
							"items": {
								"value": "@activity('Lookup1_Incremental').output.value",
								"type": "Expression"
							},
							"activities": [
								{
									"name": "Stored procedure1",
									"type": "SqlServerStoredProcedure",
									"dependsOn": [],
									"policy": {
										"timeout": "7.00:00:00",
										"retry": 0,
										"retryIntervalInSeconds": 30,
										"secureOutput": false,
										"secureInput": false
									},
									"userProperties": [],
									"typeProperties": {
										"storedProcedureName": "[dbo].[USP_Control_Table_LastDate]",
										"storedProcedureParameters": {
											"id_I_F": {
												"value": {
													"value": "@item().ID_Inc",
													"type": "Expression"
												},
												"type": "Int32"
											}
										}
									},
									"linkedServiceName": {
										"referenceName": "DS_MDW_SP",
										"type": "LinkedServiceReference"
									}
								}
							]
						}
					},
					{
						"name": "ForEach_Proc_Full",
						"type": "ForEach",
						"dependsOn": [
							{
								"activity": "ForEach_Full_Load",
								"dependencyConditions": [
									"Succeeded"
								]
							}
						],
						"userProperties": [],
						"typeProperties": {
							"items": {
								"value": "@activity('Lookup2_Full').output.value",
								"type": "Expression"
							},
							"activities": [
								{
									"name": "Stored procedure_Full",
									"type": "SqlServerStoredProcedure",
									"dependsOn": [],
									"policy": {
										"timeout": "7.00:00:00",
										"retry": 0,
										"retryIntervalInSeconds": 30,
										"secureOutput": false,
										"secureInput": false
									},
									"userProperties": [],
									"typeProperties": {
										"storedProcedureName": "[dbo].[USP_Control_Table_LastDate]",
										"storedProcedureParameters": {
											"id_I_F": {
												"value": {
													"value": "@item().ID_Full",
													"type": "Expression"
												},
												"type": "Int32"
											}
										}
									},
									"linkedServiceName": {
										"referenceName": "DS_MDW_SP",
										"type": "LinkedServiceReference"
									}
								}
							]
						}
					},
					{
						"name": "lkp_ExecStartAuditProc",
						"type": "Lookup",
						"dependsOn": [],
						"policy": {
							"timeout": "7.00:00:00",
							"retry": 0,
							"retryIntervalInSeconds": 30,
							"secureOutput": false,
							"secureInput": false
						},
						"userProperties": [],
						"typeProperties": {
							"source": {
								"type": "AzureSqlSource",
								"sqlReaderStoredProcedureName": "[dbo].[proc_StartAuditLog]",
								"storedProcedureParameters": {
									"ConfigTableID": {
										"type": "Int32",
										"value": "-1"
									},
									"DataFactoryName": {
										"type": "String",
										"value": {
											"value": "@pipeline().DataFactory",
											"type": "Expression"
										}
									},
									"ParentAuditID": {
										"type": "Int64",
										"value": "-1"
									},
									"PipelineName": {
										"type": "String",
										"value": {
											"value": "@concat(pipeline().Pipeline,' Invoices Source Table Load')",
											"type": "Expression"
										}
									},
									"PipelineRunID": {
										"type": "String",
										"value": {
											"value": "@pipeline().RunId",
											"type": "Expression"
										}
									},
									"PipelineTriggerID": {
										"type": "String",
										"value": {
											"value": "@pipeline().TriggerId",
											"type": "Expression"
										}
									},
									"PipelineTriggerName": {
										"type": "String",
										"value": {
											"value": "@pipeline().TriggerName",
											"type": "Expression"
										}
									},
									"PipelineTriggerType": {
										"type": "String",
										"value": {
											"value": "@pipeline().TriggerType",
											"type": "Expression"
										}
									}
								},
								"queryTimeout": "02:00:00",
								"partitionOption": "None"
							},
							"dataset": {
								"referenceName": "Briggs_MDW",
								"type": "DatasetReference",
								"parameters": {
									"schema_name": "dbo",
									"table_name": "user"
								}
							}
						}
					},
					{
						"name": "Sp_ExecFailureAudit_Full",
						"type": "SqlServerStoredProcedure",
						"dependsOn": [
							{
								"activity": "ForEach_Full_Load",
								"dependencyConditions": [
									"Failed"
								]
							}
						],
						"policy": {
							"timeout": "7.00:00:00",
							"retry": 0,
							"retryIntervalInSeconds": 30,
							"secureOutput": false,
							"secureInput": false
						},
						"userProperties": [],
						"typeProperties": {
							"storedProcedureName": "[dbo].[proc_UpdateAuditLog]",
							"storedProcedureParameters": {
								"AuditID": {
									"value": {
										"value": "@activity('lkp_ExecStartAuditProc').output.firstRow.AuditID",
										"type": "Expression"
									},
									"type": "Int32"
								},
								"DataLakePath": {
									"value": null,
									"type": "String"
								},
								"PipelineRunID": {
									"value": {
										"value": "@pipeline().RunId",
										"type": "Expression"
									},
									"type": "String"
								},
								"RowsRead": {
									"value": null,
									"type": "Int64"
								},
								"Status": {
									"value": "Full Load Failed",
									"type": "String"
								}
							}
						},
						"linkedServiceName": {
							"referenceName": "AzureSqlDatabase1",
							"type": "LinkedServiceReference"
						}
					},
					{
						"name": "Sp_ExecSuccessAudit",
						"type": "SqlServerStoredProcedure",
						"dependsOn": [
							{
								"activity": "ForEach_Proc_Full",
								"dependencyConditions": [
									"Succeeded"
								]
							},
							{
								"activity": "ForEach_Proc_Incremental",
								"dependencyConditions": [
									"Succeeded"
								]
							}
						],
						"policy": {
							"timeout": "7.00:00:00",
							"retry": 0,
							"retryIntervalInSeconds": 30,
							"secureOutput": false,
							"secureInput": false
						},
						"userProperties": [],
						"typeProperties": {
							"storedProcedureName": "[dbo].[proc_UpdateAuditLog]",
							"storedProcedureParameters": {
								"AuditID": {
									"value": {
										"value": "@activity('lkp_ExecStartAuditProc').output.firstRow.AuditID",
										"type": "Expression"
									},
									"type": "Int32"
								},
								"DataLakePath": {
									"value": null,
									"type": "String"
								},
								"RowsRead": {
									"value": null,
									"type": "Int64"
								},
								"Status": {
									"value": "Success",
									"type": "String"
								},
								"PipelineRunID": {
									"value": {
										"value": "@pipeline().RunId",
										"type": "Expression"
									},
									"type": "String"
								}
							}
						},
						"linkedServiceName": {
							"referenceName": "AzureSqlDatabase1",
							"type": "LinkedServiceReference"
						}
					},
					{
						"name": "Sp_ExecFailureAudit_Inc",
						"type": "SqlServerStoredProcedure",
						"dependsOn": [
							{
								"activity": "ForEach_Incremental_Load",
								"dependencyConditions": [
									"Failed"
								]
							}
						],
						"policy": {
							"timeout": "7.00:00:00",
							"retry": 0,
							"retryIntervalInSeconds": 30,
							"secureOutput": false,
							"secureInput": false
						},
						"userProperties": [],
						"typeProperties": {
							"storedProcedureName": "[dbo].[proc_UpdateAuditLog]",
							"storedProcedureParameters": {
								"AuditID": {
									"value": {
										"value": "@activity('lkp_ExecStartAuditProc').output.firstRow.AuditID",
										"type": "Expression"
									},
									"type": "Int32"
								},
								"DataLakePath": {
									"value": null,
									"type": "String"
								},
								"PipelineRunID": {
									"value": {
										"value": "@pipeline().RunId",
										"type": "Expression"
									},
									"type": "String"
								},
								"RowsRead": {
									"value": null,
									"type": "Int64"
								},
								"Status": {
									"value": "Incr Load Failed",
									"type": "String"
								}
							}
						},
						"linkedServiceName": {
							"referenceName": "AzureSqlDatabase1",
							"type": "LinkedServiceReference"
						}
					}
				],
				"policy": {
					"elapsedTimeMetric": {},
					"cancelAfter": {}
				},
				"variables": {
					"ErrorMsgInc": {
						"type": "String"
					},
					"ErrorMsgFull": {
						"type": "String"
					}
				},
				"folder": {
					"name": "Briggs Data Load Theme wise"
				},
				"annotations": [],
				"lastPublishTime": "2022-04-26T07:21:38Z"
			},
			"dependsOn": [
				"[concat(variables('workspaceId'), '/datasets/Briggs_MDW')]",
				"[concat(variables('workspaceId'), '/linkedServices/AzureSqlDatabase1')]",
				"[concat(variables('workspaceId'), '/datasets/DS_Briggs_MST')]",
				"[concat(variables('workspaceId'), '/linkedServices/DS_MDW_SP')]"
			]
		},
		{
			"name": "[concat(parameters('workspaceName'), '/PL_Generic_Copy_Misc')]",
			"type": "Microsoft.Synapse/workspaces/pipelines",
			"apiVersion": "2019-06-01-preview",
			"properties": {
				"activities": [
					{
						"name": "Lookup1_Incremental",
						"type": "Lookup",
						"dependsOn": [
							{
								"activity": "lkp_ExecStartAuditProc",
								"dependencyConditions": [
									"Succeeded"
								]
							}
						],
						"policy": {
							"timeout": "7.00:00:00",
							"retry": 0,
							"retryIntervalInSeconds": 30,
							"secureOutput": false,
							"secureInput": false
						},
						"userProperties": [],
						"typeProperties": {
							"source": {
								"type": "AzureSqlSource",
								"sqlReaderQuery": "Select Distinct ID ID_Inc,sourcedb,sourcetablename From dbo.control_table Where ProcessName = 'AzSQL_ADLS'  \nAND DataLoadType = 'Incremental'  and EnableAction = 1  \nand (format(refresh_date,'dd-MM-yyyy') <> format(getdate(),'dd-MM-yyyy') or refresh_date is null)\nand subjectarea like '%Sales Misc%' and id <> 253 \norder by 1 ",
								"queryTimeout": "02:00:00",
								"partitionOption": "None"
							},
							"dataset": {
								"referenceName": "Briggs_MDW",
								"type": "DatasetReference",
								"parameters": {
									"schema_name": "dbo",
									"table_name": "user"
								}
							},
							"firstRowOnly": false
						}
					},
					{
						"name": "Lookup2_Full",
						"type": "Lookup",
						"dependsOn": [
							{
								"activity": "lkp_ExecStartAuditProc",
								"dependencyConditions": [
									"Succeeded"
								]
							}
						],
						"policy": {
							"timeout": "7.00:00:00",
							"retry": 0,
							"retryIntervalInSeconds": 30,
							"secureOutput": false,
							"secureInput": false
						},
						"userProperties": [],
						"typeProperties": {
							"source": {
								"type": "AzureSqlSource",
								"sqlReaderQuery": "Select Distinct ID ID_Full,sourcedb,sourcetablename From dbo.control_table Where ProcessName = 'AzSQL_ADLS'  \nAND DataLoadType = 'Full'  and EnableAction = 1 \nand (format(refresh_date,'dd-MM-yyyy') <> format(getdate(),'dd-MM-yyyy') or refresh_date is null)\nand subjectarea like '%Sales Misc%' \norder by 1 ",
								"queryTimeout": "02:00:00",
								"partitionOption": "None"
							},
							"dataset": {
								"referenceName": "Briggs_MDW",
								"type": "DatasetReference",
								"parameters": {
									"schema_name": "dbo",
									"table_name": "user"
								}
							},
							"firstRowOnly": false
						}
					},
					{
						"name": "ForEach_Incremental_Load",
						"type": "ForEach",
						"dependsOn": [
							{
								"activity": "Lookup1_Incremental",
								"dependencyConditions": [
									"Succeeded"
								]
							}
						],
						"userProperties": [],
						"typeProperties": {
							"items": {
								"value": "@activity('Lookup1_Incremental').output.value",
								"type": "Expression"
							},
							"batchCount": 6,
							"activities": [
								{
									"name": "Lookup_Incremental",
									"type": "Lookup",
									"dependsOn": [],
									"policy": {
										"timeout": "7.00:00:00",
										"retry": 0,
										"retryIntervalInSeconds": 30,
										"secureOutput": false,
										"secureInput": false
									},
									"userProperties": [],
									"typeProperties": {
										"source": {
											"type": "AzureSqlSource",
											"sqlReaderQuery": {
												"value": "@concat('select SourceQuery=''select '' +columnList+ '' from ''+ sourceDB+''.''+SourceSchemaName+''.''+SourcetableName + '' where \ncast(''+DateField+'' as date) >=''''''+LastDate+''''''''\n,SourceDB\n,TargetContainer\n, TargetPath, TargetFile, FileFormat,DateField,LastDate,targetstagetableschema,targetstagetablename\nfrom dbo.control_table\nwhere ID= ',item().ID_Inc)",
												"type": "Expression"
											},
											"queryTimeout": "02:00:00",
											"partitionOption": "None"
										},
										"dataset": {
											"referenceName": "Briggs_MDW",
											"type": "DatasetReference",
											"parameters": {
												"schema_name": "dbo",
												"table_name": "user"
											}
										}
									}
								},
								{
									"name": "Copy_Briggs_Inc_ADLS",
									"type": "Copy",
									"dependsOn": [
										{
											"activity": "Start_Table_Audit1",
											"dependencyConditions": [
												"Succeeded"
											]
										}
									],
									"policy": {
										"timeout": "7.00:00:00",
										"retry": 0,
										"retryIntervalInSeconds": 30,
										"secureOutput": false,
										"secureInput": false
									},
									"userProperties": [],
									"typeProperties": {
										"source": {
											"type": "SqlServerSource",
											"sqlReaderQuery": {
												"value": "@activity('Lookup_Incremental').output.firstRow.SourceQuery\n",
												"type": "Expression"
											},
											"queryTimeout": "02:00:00",
											"partitionOption": "None"
										},
										"sink": {
											"type": "AzureSqlSink",
											"preCopyScript": {
												"value": "@{concat('delete from ',activity('Lookup_Incremental').output.firstRow.TargetStageTableSchema,'.',activity('Lookup_Incremental').output.firstRow.targetstagetablename,' where cast(',activity('Lookup_Incremental').output.firstRow.DateField,' as date)=','''',activity('Lookup_Incremental').output.firstRow.LastDate,'''')}",
												"type": "Expression"
											},
											"disableMetricsCollection": false
										},
										"enableStaging": false,
										"translator": {
											"type": "TabularTranslator",
											"typeConversion": true,
											"typeConversionSettings": {
												"allowDataTruncation": true,
												"treatBooleanAsNumber": false
											}
										}
									},
									"inputs": [
										{
											"referenceName": "DS_Briggs_MST",
											"type": "DatasetReference",
											"parameters": {}
										}
									],
									"outputs": [
										{
											"referenceName": "Briggs_MDW",
											"type": "DatasetReference",
											"parameters": {
												"schema_name": {
													"value": "@activity('Lookup_Incremental').output.firstRow.TargetStageTableSchema",
													"type": "Expression"
												},
												"table_name": {
													"value": "@activity('Lookup_Incremental').output.firstRow.TargetStageTableName",
													"type": "Expression"
												}
											}
										}
									]
								},
								{
									"name": "Copy_Briggs_Inc_ADLS_New",
									"type": "Copy",
									"dependsOn": [
										{
											"activity": "Copy_Briggs_Inc_ADLS",
											"dependencyConditions": [
												"Failed"
											]
										}
									],
									"policy": {
										"timeout": "7.00:00:00",
										"retry": 0,
										"retryIntervalInSeconds": 30,
										"secureOutput": false,
										"secureInput": false
									},
									"userProperties": [],
									"typeProperties": {
										"source": {
											"type": "SqlServerSource",
											"sqlReaderQuery": {
												"value": "@activity('Lookup_Incremental').output.firstRow.SourceQuery\n",
												"type": "Expression"
											},
											"queryTimeout": "02:00:00",
											"partitionOption": "None"
										},
										"sink": {
											"type": "AzureSqlSink",
											"writeBehavior": "insert",
											"sqlWriterUseTableLock": false,
											"tableOption": "autoCreate",
											"disableMetricsCollection": false
										},
										"enableStaging": false,
										"translator": {
											"type": "TabularTranslator",
											"typeConversion": true,
											"typeConversionSettings": {
												"allowDataTruncation": true,
												"treatBooleanAsNumber": false
											}
										}
									},
									"inputs": [
										{
											"referenceName": "DS_Briggs_MST",
											"type": "DatasetReference",
											"parameters": {}
										}
									],
									"outputs": [
										{
											"referenceName": "Briggs_MDW",
											"type": "DatasetReference",
											"parameters": {
												"schema_name": {
													"value": "@activity('Lookup_Incremental').output.firstRow.TargetStageTableSchema",
													"type": "Expression"
												},
												"table_name": {
													"value": "@activity('Lookup_Incremental').output.firstRow.TargetStageTableName",
													"type": "Expression"
												}
											}
										}
									]
								},
								{
									"name": "Start_Table_Audit1",
									"type": "Lookup",
									"dependsOn": [
										{
											"activity": "Lookup_Incremental",
											"dependencyConditions": [
												"Succeeded"
											]
										}
									],
									"policy": {
										"timeout": "7.00:00:00",
										"retry": 0,
										"retryIntervalInSeconds": 30,
										"secureOutput": false,
										"secureInput": false
									},
									"userProperties": [],
									"typeProperties": {
										"source": {
											"type": "AzureSqlSource",
											"sqlReaderStoredProcedureName": "[dbo].[proc_StartAuditLog_Briggs]",
											"storedProcedureParameters": {
												"ConfigTableID": {
													"type": "Int32",
													"value": {
														"value": "@item().ID_Inc",
														"type": "Expression"
													}
												},
												"DataFactoryName": {
													"type": "String",
													"value": {
														"value": "@pipeline().DataFactory",
														"type": "Expression"
													}
												},
												"ParentAuditID": {
													"type": "Int64",
													"value": {
														"value": "@item().ID_Inc",
														"type": "Expression"
													}
												},
												"PipelineName": {
													"type": "String",
													"value": {
														"value": "@pipeline().Pipeline",
														"type": "Expression"
													}
												},
												"PipelineRunID": {
													"type": "String",
													"value": {
														"value": "@pipeline().RunId",
														"type": "Expression"
													}
												},
												"PipelineTriggerID": {
													"type": "String",
													"value": {
														"value": "@pipeline().TriggerId",
														"type": "Expression"
													}
												},
												"PipelineTriggerName": {
													"type": "String",
													"value": {
														"value": "@pipeline().TriggerName",
														"type": "Expression"
													}
												},
												"PipelineTriggerType": {
													"type": "String",
													"value": {
														"value": "@pipeline().TriggerType",
														"type": "Expression"
													}
												},
												"Sourcedb": {
													"type": "String",
													"value": {
														"value": "@item().sourceDB",
														"type": "Expression"
													}
												},
												"sourcetable": {
													"type": "String",
													"value": {
														"value": "@item().SourcetableName",
														"type": "Expression"
													}
												}
											},
											"queryTimeout": "02:00:00",
											"partitionOption": "None"
										},
										"dataset": {
											"referenceName": "Briggs_MDW",
											"type": "DatasetReference",
											"parameters": {
												"schema_name": "dbo",
												"table_name": "user"
											}
										},
										"firstRowOnly": false
									}
								},
								{
									"name": "Success_Audit_Log1",
									"type": "SqlServerStoredProcedure",
									"dependsOn": [
										{
											"activity": "Copy_Briggs_Inc_ADLS",
											"dependencyConditions": [
												"Succeeded"
											]
										}
									],
									"policy": {
										"timeout": "7.00:00:00",
										"retry": 0,
										"retryIntervalInSeconds": 30,
										"secureOutput": false,
										"secureInput": false
									},
									"userProperties": [],
									"typeProperties": {
										"storedProcedureName": "[dbo].[proc_UpdateAuditLog_Briggs]",
										"storedProcedureParameters": {
											"ConfigTableID": {
												"value": {
													"value": "@item().ID_Inc",
													"type": "Expression"
												},
												"type": "Int32"
											},
											"RowsRead": {
												"value": {
													"value": "@activity('Copy_Briggs_Inc_ADLS').output.RowsRead",
													"type": "Expression"
												},
												"type": "Int64"
											},
											"Status": {
												"value": "Success",
												"type": "String"
											}
										}
									},
									"linkedServiceName": {
										"referenceName": "DS_MDW_SP",
										"type": "LinkedServiceReference"
									}
								},
								{
									"name": "Success_Audit_Log_New1",
									"type": "SqlServerStoredProcedure",
									"dependsOn": [
										{
											"activity": "Copy_Briggs_Inc_ADLS_New",
											"dependencyConditions": [
												"Succeeded"
											]
										}
									],
									"policy": {
										"timeout": "7.00:00:00",
										"retry": 0,
										"retryIntervalInSeconds": 30,
										"secureOutput": false,
										"secureInput": false
									},
									"userProperties": [],
									"typeProperties": {
										"storedProcedureName": "[dbo].[proc_UpdateAuditLog_Briggs]",
										"storedProcedureParameters": {
											"ConfigTableID": {
												"value": {
													"value": "@item().ID_Inc",
													"type": "Expression"
												},
												"type": "Int32"
											},
											"RowsRead": {
												"value": {
													"value": "@activity('Copy_Briggs_Inc_ADLS_New').output.RowsRead",
													"type": "Expression"
												},
												"type": "Int64"
											},
											"Status": {
												"value": "Success",
												"type": "String"
											}
										}
									},
									"linkedServiceName": {
										"referenceName": "DS_MDW_SP",
										"type": "LinkedServiceReference"
									}
								},
								{
									"name": "Failure_Audit_Log_New1",
									"type": "SqlServerStoredProcedure",
									"dependsOn": [
										{
											"activity": "Set variable1",
											"dependencyConditions": [
												"Succeeded"
											]
										}
									],
									"policy": {
										"timeout": "7.00:00:00",
										"retry": 0,
										"retryIntervalInSeconds": 30,
										"secureOutput": false,
										"secureInput": false
									},
									"userProperties": [],
									"typeProperties": {
										"storedProcedureName": "[dbo].[proc_UpdateAuditLog_Briggs]",
										"storedProcedureParameters": {
											"ConfigTableID": {
												"value": {
													"value": "@item().ID_Inc",
													"type": "Expression"
												},
												"type": "Int32"
											},
											"RowsRead": {
												"value": null,
												"type": "Int64"
											},
											"Status": {
												"value": {
													"value": "@variables('ErrorMsgInc')",
													"type": "Expression"
												},
												"type": "String"
											}
										}
									},
									"linkedServiceName": {
										"referenceName": "DS_MDW_SP",
										"type": "LinkedServiceReference"
									}
								},
								{
									"name": "Set variable1",
									"type": "SetVariable",
									"dependsOn": [
										{
											"activity": "Copy_Briggs_Inc_ADLS_New",
											"dependencyConditions": [
												"Failed"
											]
										},
										{
											"activity": "Copy_Briggs_Inc_ADLS",
											"dependencyConditions": [
												"Failed"
											]
										}
									],
									"userProperties": [],
									"typeProperties": {
										"variableName": "ErrorMsgInc",
										"value": {
											"value": "@activity('Copy_Briggs_Inc_ADLS').Error.Message",
											"type": "Expression"
										}
									}
								}
							]
						}
					},
					{
						"name": "ForEach_Full_Load",
						"type": "ForEach",
						"dependsOn": [
							{
								"activity": "Lookup2_Full",
								"dependencyConditions": [
									"Succeeded"
								]
							}
						],
						"userProperties": [],
						"typeProperties": {
							"items": {
								"value": "@activity('Lookup2_Full').output.value",
								"type": "Expression"
							},
							"batchCount": 6,
							"activities": [
								{
									"name": "Lookup_Full",
									"type": "Lookup",
									"dependsOn": [],
									"policy": {
										"timeout": "7.00:00:00",
										"retry": 0,
										"retryIntervalInSeconds": 30,
										"secureOutput": false,
										"secureInput": false
									},
									"userProperties": [],
									"typeProperties": {
										"source": {
											"type": "AzureSqlSource",
											"sqlReaderQuery": {
												"value": "@concat('select SourceQuery=''select '' +columnList+ '' from ''+ sourceDB+''.''+SourceSchemaName+''.''+SourcetableName\n,SourceDB\n,TargetContainer\n, TargetPath, TargetFile, FileFormat,DateField,LastDate,targetstagetableschema,targetstagetablename\nfrom dbo.control_table\nwhere ID= ',item().ID_Full)",
												"type": "Expression"
											},
											"queryTimeout": "02:00:00",
											"partitionOption": "None"
										},
										"dataset": {
											"referenceName": "Briggs_MDW",
											"type": "DatasetReference",
											"parameters": {
												"schema_name": "dbo",
												"table_name": "user"
											}
										}
									}
								},
								{
									"name": "Copy_Briggs_Full_ADLS",
									"type": "Copy",
									"dependsOn": [
										{
											"activity": "Start_Table_Audit",
											"dependencyConditions": [
												"Succeeded"
											]
										}
									],
									"policy": {
										"timeout": "7.00:00:00",
										"retry": 0,
										"retryIntervalInSeconds": 30,
										"secureOutput": false,
										"secureInput": false
									},
									"userProperties": [],
									"typeProperties": {
										"source": {
											"type": "SqlServerSource",
											"sqlReaderQuery": {
												"value": "@activity('Lookup_Full').output.firstRow.SourceQuery\n",
												"type": "Expression"
											},
											"queryTimeout": "02:00:00",
											"partitionOption": "None"
										},
										"sink": {
											"type": "AzureSqlSink",
											"preCopyScript": {
												"value": "@{concat('truncate table ',activity('Lookup_Full').output.firstRow.TargetStageTableSchema,'.',activity('Lookup_Full').output.firstRow.TargetStageTableName)}",
												"type": "Expression"
											},
											"disableMetricsCollection": false
										},
										"enableStaging": false,
										"translator": {
											"type": "TabularTranslator",
											"typeConversion": true,
											"typeConversionSettings": {
												"allowDataTruncation": true,
												"treatBooleanAsNumber": false
											}
										}
									},
									"inputs": [
										{
											"referenceName": "DS_Briggs_MST",
											"type": "DatasetReference",
											"parameters": {}
										}
									],
									"outputs": [
										{
											"referenceName": "Briggs_MDW",
											"type": "DatasetReference",
											"parameters": {
												"schema_name": {
													"value": "@activity('Lookup_Full').output.firstRow.TargetStageTableSchema",
													"type": "Expression"
												},
												"table_name": {
													"value": "@activity('Lookup_Full').output.firstRow.TargetStageTableName",
													"type": "Expression"
												}
											}
										}
									]
								},
								{
									"name": "Copy_Briggs_Full_ADLS_New",
									"type": "Copy",
									"dependsOn": [
										{
											"activity": "Copy_Briggs_Full_ADLS",
											"dependencyConditions": [
												"Failed"
											]
										}
									],
									"policy": {
										"timeout": "7.00:00:00",
										"retry": 0,
										"retryIntervalInSeconds": 30,
										"secureOutput": false,
										"secureInput": false
									},
									"userProperties": [],
									"typeProperties": {
										"source": {
											"type": "SqlServerSource",
											"sqlReaderQuery": {
												"value": "@activity('Lookup_Full').output.firstRow.SourceQuery\n",
												"type": "Expression"
											},
											"queryTimeout": "02:00:00",
											"partitionOption": "None"
										},
										"sink": {
											"type": "AzureSqlSink",
											"writeBehavior": "insert",
											"sqlWriterUseTableLock": false,
											"tableOption": "autoCreate",
											"disableMetricsCollection": false
										},
										"enableStaging": false,
										"translator": {
											"type": "TabularTranslator",
											"typeConversion": true,
											"typeConversionSettings": {
												"allowDataTruncation": true,
												"treatBooleanAsNumber": false
											}
										}
									},
									"inputs": [
										{
											"referenceName": "DS_Briggs_MST",
											"type": "DatasetReference",
											"parameters": {}
										}
									],
									"outputs": [
										{
											"referenceName": "Briggs_MDW",
											"type": "DatasetReference",
											"parameters": {
												"schema_name": {
													"value": "@activity('Lookup_Full').output.firstRow.TargetStageTableSchema",
													"type": "Expression"
												},
												"table_name": {
													"value": "@activity('Lookup_Full').output.firstRow.TargetStageTableName",
													"type": "Expression"
												}
											}
										}
									]
								},
								{
									"name": "Start_Table_Audit",
									"type": "Lookup",
									"dependsOn": [
										{
											"activity": "Lookup_Full",
											"dependencyConditions": [
												"Succeeded"
											]
										}
									],
									"policy": {
										"timeout": "7.00:00:00",
										"retry": 0,
										"retryIntervalInSeconds": 30,
										"secureOutput": false,
										"secureInput": false
									},
									"userProperties": [],
									"typeProperties": {
										"source": {
											"type": "AzureSqlSource",
											"sqlReaderStoredProcedureName": "[dbo].[proc_StartAuditLog_Briggs]",
											"storedProcedureParameters": {
												"ConfigTableID": {
													"type": "Int32",
													"value": {
														"value": "@item().ID_Full",
														"type": "Expression"
													}
												},
												"DataFactoryName": {
													"type": "String",
													"value": {
														"value": "@pipeline().DataFactory",
														"type": "Expression"
													}
												},
												"ParentAuditID": {
													"type": "Int64",
													"value": {
														"value": "@item().ID_Full",
														"type": "Expression"
													}
												},
												"PipelineName": {
													"type": "String",
													"value": {
														"value": "@pipeline().Pipeline",
														"type": "Expression"
													}
												},
												"PipelineRunID": {
													"type": "String",
													"value": {
														"value": "@pipeline().RunId",
														"type": "Expression"
													}
												},
												"PipelineTriggerID": {
													"type": "String",
													"value": {
														"value": "@pipeline().TriggerId",
														"type": "Expression"
													}
												},
												"PipelineTriggerName": {
													"type": "String",
													"value": {
														"value": "@pipeline().TriggerName",
														"type": "Expression"
													}
												},
												"PipelineTriggerType": {
													"type": "String",
													"value": {
														"value": "@pipeline().TriggerType",
														"type": "Expression"
													}
												},
												"Sourcedb": {
													"type": "String",
													"value": {
														"value": "@item().sourceDB",
														"type": "Expression"
													}
												},
												"sourcetable": {
													"type": "String",
													"value": {
														"value": "@item().SourcetableName",
														"type": "Expression"
													}
												}
											},
											"queryTimeout": "02:00:00",
											"partitionOption": "None"
										},
										"dataset": {
											"referenceName": "Briggs_MDW",
											"type": "DatasetReference",
											"parameters": {
												"schema_name": "dbo",
												"table_name": "user"
											}
										},
										"firstRowOnly": false
									}
								},
								{
									"name": "Success_Audit_Log",
									"type": "SqlServerStoredProcedure",
									"dependsOn": [
										{
											"activity": "Copy_Briggs_Full_ADLS",
											"dependencyConditions": [
												"Succeeded"
											]
										}
									],
									"policy": {
										"timeout": "7.00:00:00",
										"retry": 0,
										"retryIntervalInSeconds": 30,
										"secureOutput": false,
										"secureInput": false
									},
									"userProperties": [],
									"typeProperties": {
										"storedProcedureName": "[dbo].[proc_UpdateAuditLog_Briggs]",
										"storedProcedureParameters": {
											"ConfigTableID": {
												"value": {
													"value": "@item().ID_Full",
													"type": "Expression"
												},
												"type": "Int32"
											},
											"RowsRead": {
												"value": {
													"value": "@activity('Copy_Briggs_Full_ADLS').output.RowsRead",
													"type": "Expression"
												},
												"type": "Int64"
											},
											"Status": {
												"value": "Success",
												"type": "String"
											}
										}
									},
									"linkedServiceName": {
										"referenceName": "DS_MDW_SP",
										"type": "LinkedServiceReference"
									}
								},
								{
									"name": "Success_Audit_Log_New",
									"type": "SqlServerStoredProcedure",
									"dependsOn": [
										{
											"activity": "Copy_Briggs_Full_ADLS_New",
											"dependencyConditions": [
												"Succeeded"
											]
										}
									],
									"policy": {
										"timeout": "7.00:00:00",
										"retry": 0,
										"retryIntervalInSeconds": 30,
										"secureOutput": false,
										"secureInput": false
									},
									"userProperties": [],
									"typeProperties": {
										"storedProcedureName": "[dbo].[proc_UpdateAuditLog_Briggs]",
										"storedProcedureParameters": {
											"ConfigTableID": {
												"value": {
													"value": "@item().ID_Full",
													"type": "Expression"
												},
												"type": "Int32"
											},
											"RowsRead": {
												"value": {
													"value": "@activity('Copy_Briggs_Full_ADLS_New').output.RowsRead",
													"type": "Expression"
												},
												"type": "Int64"
											},
											"Status": {
												"value": "Success",
												"type": "String"
											}
										}
									},
									"linkedServiceName": {
										"referenceName": "DS_MDW_SP",
										"type": "LinkedServiceReference"
									}
								},
								{
									"name": "Failure_Audit_Log_New",
									"type": "SqlServerStoredProcedure",
									"dependsOn": [
										{
											"activity": "Set variable2",
											"dependencyConditions": [
												"Succeeded"
											]
										}
									],
									"policy": {
										"timeout": "7.00:00:00",
										"retry": 0,
										"retryIntervalInSeconds": 30,
										"secureOutput": false,
										"secureInput": false
									},
									"userProperties": [],
									"typeProperties": {
										"storedProcedureName": "[dbo].[proc_UpdateAuditLog_Briggs]",
										"storedProcedureParameters": {
											"ConfigTableID": {
												"value": {
													"value": "@item().ID_Full",
													"type": "Expression"
												},
												"type": "Int32"
											},
											"RowsRead": {
												"value": null,
												"type": "Int64"
											},
											"Status": {
												"value": {
													"value": "@variables('ErrorMsgFull')",
													"type": "Expression"
												},
												"type": "String"
											}
										}
									},
									"linkedServiceName": {
										"referenceName": "DS_MDW_SP",
										"type": "LinkedServiceReference"
									}
								},
								{
									"name": "Set variable2",
									"type": "SetVariable",
									"dependsOn": [
										{
											"activity": "Copy_Briggs_Full_ADLS",
											"dependencyConditions": [
												"Failed"
											]
										},
										{
											"activity": "Copy_Briggs_Full_ADLS_New",
											"dependencyConditions": [
												"Failed"
											]
										}
									],
									"userProperties": [],
									"typeProperties": {
										"variableName": "ErrorMsgFull",
										"value": {
											"value": "@activity('Copy_Briggs_Full_ADLS').Error.Message",
											"type": "Expression"
										}
									}
								}
							]
						}
					},
					{
						"name": "ForEach_Proc_Incremental",
						"type": "ForEach",
						"dependsOn": [
							{
								"activity": "ForEach_Incremental_Load",
								"dependencyConditions": [
									"Succeeded"
								]
							}
						],
						"userProperties": [],
						"typeProperties": {
							"items": {
								"value": "@activity('Lookup1_Incremental').output.value",
								"type": "Expression"
							},
							"batchCount": 8,
							"activities": [
								{
									"name": "Stored procedure1",
									"type": "SqlServerStoredProcedure",
									"dependsOn": [],
									"policy": {
										"timeout": "7.00:00:00",
										"retry": 0,
										"retryIntervalInSeconds": 30,
										"secureOutput": false,
										"secureInput": false
									},
									"userProperties": [],
									"typeProperties": {
										"storedProcedureName": "[dbo].[USP_Control_Table_LastDate]",
										"storedProcedureParameters": {
											"id_I_F": {
												"value": {
													"value": "@item().ID_Inc",
													"type": "Expression"
												},
												"type": "Int32"
											}
										}
									},
									"linkedServiceName": {
										"referenceName": "DS_MDW_SP",
										"type": "LinkedServiceReference"
									}
								}
							]
						}
					},
					{
						"name": "ForEach_Proc_Full",
						"type": "ForEach",
						"dependsOn": [
							{
								"activity": "ForEach_Full_Load",
								"dependencyConditions": [
									"Succeeded"
								]
							}
						],
						"userProperties": [],
						"typeProperties": {
							"items": {
								"value": "@activity('Lookup2_Full').output.value",
								"type": "Expression"
							},
							"batchCount": 8,
							"activities": [
								{
									"name": "Stored procedure_Full",
									"type": "SqlServerStoredProcedure",
									"dependsOn": [],
									"policy": {
										"timeout": "7.00:00:00",
										"retry": 0,
										"retryIntervalInSeconds": 30,
										"secureOutput": false,
										"secureInput": false
									},
									"userProperties": [],
									"typeProperties": {
										"storedProcedureName": "[dbo].[USP_Control_Table_LastDate]",
										"storedProcedureParameters": {
											"id_I_F": {
												"value": {
													"value": "@item().ID_Full",
													"type": "Expression"
												},
												"type": "Int32"
											}
										}
									},
									"linkedServiceName": {
										"referenceName": "DS_MDW_SP",
										"type": "LinkedServiceReference"
									}
								}
							]
						}
					},
					{
						"name": "lkp_ExecStartAuditProc",
						"type": "Lookup",
						"dependsOn": [],
						"policy": {
							"timeout": "7.00:00:00",
							"retry": 0,
							"retryIntervalInSeconds": 30,
							"secureOutput": false,
							"secureInput": false
						},
						"userProperties": [],
						"typeProperties": {
							"source": {
								"type": "AzureSqlSource",
								"sqlReaderStoredProcedureName": "[dbo].[proc_StartAuditLog]",
								"storedProcedureParameters": {
									"ConfigTableID": {
										"type": "Int32",
										"value": "-1"
									},
									"DataFactoryName": {
										"type": "String",
										"value": {
											"value": "@pipeline().DataFactory",
											"type": "Expression"
										}
									},
									"ParentAuditID": {
										"type": "Int64",
										"value": "-1"
									},
									"PipelineName": {
										"type": "String",
										"value": {
											"value": "@concat(pipeline().Pipeline,' Misc Source Table Load')",
											"type": "Expression"
										}
									},
									"PipelineRunID": {
										"type": "String",
										"value": {
											"value": "@pipeline().RunId",
											"type": "Expression"
										}
									},
									"PipelineTriggerID": {
										"type": "String",
										"value": {
											"value": "@pipeline().TriggerId",
											"type": "Expression"
										}
									},
									"PipelineTriggerName": {
										"type": "String",
										"value": {
											"value": "@pipeline().TriggerName",
											"type": "Expression"
										}
									},
									"PipelineTriggerType": {
										"type": "String",
										"value": {
											"value": "@pipeline().TriggerType",
											"type": "Expression"
										}
									}
								},
								"queryTimeout": "02:00:00",
								"partitionOption": "None"
							},
							"dataset": {
								"referenceName": "Briggs_MDW",
								"type": "DatasetReference",
								"parameters": {
									"schema_name": "dbo",
									"table_name": "user"
								}
							}
						}
					},
					{
						"name": "Sp_ExecFailureAudit_Full",
						"type": "SqlServerStoredProcedure",
						"dependsOn": [
							{
								"activity": "ForEach_Full_Load",
								"dependencyConditions": [
									"Failed"
								]
							}
						],
						"policy": {
							"timeout": "7.00:00:00",
							"retry": 0,
							"retryIntervalInSeconds": 30,
							"secureOutput": false,
							"secureInput": false
						},
						"userProperties": [],
						"typeProperties": {
							"storedProcedureName": "[dbo].[proc_UpdateAuditLog]",
							"storedProcedureParameters": {
								"AuditID": {
									"value": {
										"value": "@activity('lkp_ExecStartAuditProc').output.firstRow.AuditID",
										"type": "Expression"
									},
									"type": "Int32"
								},
								"DataLakePath": {
									"value": null,
									"type": "String"
								},
								"PipelineRunID": {
									"value": {
										"value": "@pipeline().RunId",
										"type": "Expression"
									},
									"type": "String"
								},
								"RowsRead": {
									"value": null,
									"type": "Int64"
								},
								"Status": {
									"value": "Full Load Failed",
									"type": "String"
								}
							}
						},
						"linkedServiceName": {
							"referenceName": "AzureSqlDatabase1",
							"type": "LinkedServiceReference"
						}
					},
					{
						"name": "Sp_ExecSuccessAudit",
						"type": "SqlServerStoredProcedure",
						"dependsOn": [
							{
								"activity": "ForEach_Proc_Incremental",
								"dependencyConditions": [
									"Succeeded"
								]
							},
							{
								"activity": "ForEach_Proc_Full",
								"dependencyConditions": [
									"Succeeded"
								]
							}
						],
						"policy": {
							"timeout": "7.00:00:00",
							"retry": 0,
							"retryIntervalInSeconds": 30,
							"secureOutput": false,
							"secureInput": false
						},
						"userProperties": [],
						"typeProperties": {
							"storedProcedureName": "[dbo].[proc_UpdateAuditLog]",
							"storedProcedureParameters": {
								"AuditID": {
									"value": {
										"value": "@activity('lkp_ExecStartAuditProc').output.firstRow.AuditID",
										"type": "Expression"
									},
									"type": "Int32"
								},
								"DataLakePath": {
									"value": null,
									"type": "String"
								},
								"RowsRead": {
									"value": null,
									"type": "Int64"
								},
								"Status": {
									"value": "Success",
									"type": "String"
								},
								"PipelineRunID": {
									"value": {
										"value": "@pipeline().RunId",
										"type": "Expression"
									},
									"type": "String"
								}
							}
						},
						"linkedServiceName": {
							"referenceName": "AzureSqlDatabase1",
							"type": "LinkedServiceReference"
						}
					},
					{
						"name": "Sp_ExecFailureAudit_Inc",
						"type": "SqlServerStoredProcedure",
						"dependsOn": [
							{
								"activity": "ForEach_Incremental_Load",
								"dependencyConditions": [
									"Failed"
								]
							}
						],
						"policy": {
							"timeout": "7.00:00:00",
							"retry": 0,
							"retryIntervalInSeconds": 30,
							"secureOutput": false,
							"secureInput": false
						},
						"userProperties": [],
						"typeProperties": {
							"storedProcedureName": "[dbo].[proc_UpdateAuditLog]",
							"storedProcedureParameters": {
								"AuditID": {
									"value": {
										"value": "@activity('lkp_ExecStartAuditProc').output.firstRow.AuditID",
										"type": "Expression"
									},
									"type": "Int32"
								},
								"DataLakePath": {
									"value": null,
									"type": "String"
								},
								"PipelineRunID": {
									"value": {
										"value": "@pipeline().RunId",
										"type": "Expression"
									},
									"type": "String"
								},
								"RowsRead": {
									"value": null,
									"type": "Int64"
								},
								"Status": {
									"value": "Incr Load Failed",
									"type": "String"
								}
							}
						},
						"linkedServiceName": {
							"referenceName": "AzureSqlDatabase1",
							"type": "LinkedServiceReference"
						}
					}
				],
				"policy": {
					"elapsedTimeMetric": {},
					"cancelAfter": {}
				},
				"variables": {
					"ErrorMsgInc": {
						"type": "String"
					},
					"ErrorMsgFull": {
						"type": "String"
					}
				},
				"folder": {
					"name": "Briggs Data Load Theme wise"
				},
				"annotations": [],
				"lastPublishTime": "2022-04-26T07:21:50Z"
			},
			"dependsOn": [
				"[concat(variables('workspaceId'), '/datasets/Briggs_MDW')]",
				"[concat(variables('workspaceId'), '/linkedServices/AzureSqlDatabase1')]",
				"[concat(variables('workspaceId'), '/datasets/DS_Briggs_MST')]",
				"[concat(variables('workspaceId'), '/linkedServices/DS_MDW_SP')]"
			]
		},
		{
			"name": "[concat(parameters('workspaceName'), '/PL_Generic_Copy_Operations')]",
			"type": "Microsoft.Synapse/workspaces/pipelines",
			"apiVersion": "2019-06-01-preview",
			"properties": {
				"activities": [
					{
						"name": "Lookup1_Incremental",
						"type": "Lookup",
						"dependsOn": [
							{
								"activity": "lkp_ExecStartAuditProc",
								"dependencyConditions": [
									"Succeeded"
								]
							}
						],
						"policy": {
							"timeout": "7.00:00:00",
							"retry": 0,
							"retryIntervalInSeconds": 30,
							"secureOutput": false,
							"secureInput": false
						},
						"userProperties": [],
						"typeProperties": {
							"source": {
								"type": "AzureSqlSource",
								"sqlReaderQuery": "Select Distinct ID ID_Inc,sourcedb,sourcetablename  From dbo.control_table Where ProcessName = 'AzSQL_ADLS'  \nAND DataLoadType = 'Incremental'  and EnableAction = 1  \nand (format(refresh_date,'dd-MM-yyyy') <> format(getdate(),'dd-MM-yyyy') or refresh_date is null)\nand subjectarea like '%Sales Operations%' and id <> 253 \norder by 1 ",
								"queryTimeout": "02:00:00",
								"partitionOption": "None"
							},
							"dataset": {
								"referenceName": "Briggs_MDW",
								"type": "DatasetReference",
								"parameters": {
									"schema_name": "dbo",
									"table_name": "user"
								}
							},
							"firstRowOnly": false
						}
					},
					{
						"name": "Lookup2_Full",
						"type": "Lookup",
						"dependsOn": [
							{
								"activity": "lkp_ExecStartAuditProc",
								"dependencyConditions": [
									"Succeeded"
								]
							}
						],
						"policy": {
							"timeout": "7.00:00:00",
							"retry": 0,
							"retryIntervalInSeconds": 30,
							"secureOutput": false,
							"secureInput": false
						},
						"userProperties": [],
						"typeProperties": {
							"source": {
								"type": "AzureSqlSource",
								"sqlReaderQuery": "Select Distinct ID ID_Full,sourcedb,sourcetablename  From dbo.control_table Where ProcessName = 'AzSQL_ADLS'  \nAND DataLoadType = 'Full'  and EnableAction = 1 \nand (format(refresh_date,'dd-MM-yyyy') <> format(getdate(),'dd-MM-yyyy') or refresh_date is null)\nand subjectarea like '%Sales Operations%' \norder by 1 ",
								"queryTimeout": "02:00:00",
								"partitionOption": "None"
							},
							"dataset": {
								"referenceName": "Briggs_MDW",
								"type": "DatasetReference",
								"parameters": {
									"schema_name": "dbo",
									"table_name": "user"
								}
							},
							"firstRowOnly": false
						}
					},
					{
						"name": "ForEach_Incremental_Load",
						"type": "ForEach",
						"dependsOn": [
							{
								"activity": "Lookup1_Incremental",
								"dependencyConditions": [
									"Succeeded"
								]
							}
						],
						"userProperties": [],
						"typeProperties": {
							"items": {
								"value": "@activity('Lookup1_Incremental').output.value",
								"type": "Expression"
							},
							"activities": [
								{
									"name": "Lookup_Incremental",
									"type": "Lookup",
									"dependsOn": [],
									"policy": {
										"timeout": "7.00:00:00",
										"retry": 0,
										"retryIntervalInSeconds": 30,
										"secureOutput": false,
										"secureInput": false
									},
									"userProperties": [],
									"typeProperties": {
										"source": {
											"type": "AzureSqlSource",
											"sqlReaderQuery": {
												"value": "@concat('select SourceQuery=''select '' +columnList+ '' from ''+ sourceDB+''.''+SourceSchemaName+''.''+SourcetableName + '' where \ncast(''+DateField+'' as date) >=''''''+LastDate+''''''''\n,SourceDB\n,TargetContainer\n, TargetPath, TargetFile, FileFormat,DateField,LastDate,targetstagetableschema,targetstagetablename\nfrom dbo.control_table\nwhere ID= ',item().ID_Inc)",
												"type": "Expression"
											},
											"queryTimeout": "02:00:00",
											"partitionOption": "None"
										},
										"dataset": {
											"referenceName": "Briggs_MDW",
											"type": "DatasetReference",
											"parameters": {
												"schema_name": "dbo",
												"table_name": "user"
											}
										}
									}
								},
								{
									"name": "Copy_Briggs_Inc_ADLS",
									"type": "Copy",
									"dependsOn": [
										{
											"activity": "Start_Table_Audit1",
											"dependencyConditions": [
												"Succeeded"
											]
										}
									],
									"policy": {
										"timeout": "7.00:00:00",
										"retry": 0,
										"retryIntervalInSeconds": 30,
										"secureOutput": false,
										"secureInput": false
									},
									"userProperties": [],
									"typeProperties": {
										"source": {
											"type": "SqlServerSource",
											"sqlReaderQuery": {
												"value": "@activity('Lookup_Incremental').output.firstRow.SourceQuery\n",
												"type": "Expression"
											},
											"queryTimeout": "02:00:00",
											"partitionOption": "None"
										},
										"sink": {
											"type": "AzureSqlSink",
											"preCopyScript": {
												"value": "@{concat('delete from ',activity('Lookup_Incremental').output.firstRow.TargetStageTableSchema,'.',activity('Lookup_Incremental').output.firstRow.targetstagetablename,' where cast(',activity('Lookup_Incremental').output.firstRow.DateField,' as date)=','''',activity('Lookup_Incremental').output.firstRow.LastDate,'''')}",
												"type": "Expression"
											},
											"disableMetricsCollection": false
										},
										"enableStaging": false,
										"translator": {
											"type": "TabularTranslator",
											"typeConversion": true,
											"typeConversionSettings": {
												"allowDataTruncation": true,
												"treatBooleanAsNumber": false
											}
										}
									},
									"inputs": [
										{
											"referenceName": "DS_Briggs_MST",
											"type": "DatasetReference",
											"parameters": {}
										}
									],
									"outputs": [
										{
											"referenceName": "Briggs_MDW",
											"type": "DatasetReference",
											"parameters": {
												"schema_name": {
													"value": "@activity('Lookup_Incremental').output.firstRow.TargetStageTableSchema",
													"type": "Expression"
												},
												"table_name": {
													"value": "@activity('Lookup_Incremental').output.firstRow.TargetStageTableName",
													"type": "Expression"
												}
											}
										}
									]
								},
								{
									"name": "Copy_Briggs_Inc_ADLS_New",
									"type": "Copy",
									"dependsOn": [
										{
											"activity": "Copy_Briggs_Inc_ADLS",
											"dependencyConditions": [
												"Failed"
											]
										}
									],
									"policy": {
										"timeout": "7.00:00:00",
										"retry": 0,
										"retryIntervalInSeconds": 30,
										"secureOutput": false,
										"secureInput": false
									},
									"userProperties": [],
									"typeProperties": {
										"source": {
											"type": "SqlServerSource",
											"sqlReaderQuery": {
												"value": "@activity('Lookup_Incremental').output.firstRow.SourceQuery\n",
												"type": "Expression"
											},
											"queryTimeout": "02:00:00",
											"partitionOption": "None"
										},
										"sink": {
											"type": "AzureSqlSink",
											"writeBehavior": "insert",
											"sqlWriterUseTableLock": false,
											"tableOption": "autoCreate",
											"disableMetricsCollection": false
										},
										"enableStaging": false,
										"translator": {
											"type": "TabularTranslator",
											"typeConversion": true,
											"typeConversionSettings": {
												"allowDataTruncation": true,
												"treatBooleanAsNumber": false
											}
										}
									},
									"inputs": [
										{
											"referenceName": "DS_Briggs_MST",
											"type": "DatasetReference",
											"parameters": {}
										}
									],
									"outputs": [
										{
											"referenceName": "Briggs_MDW",
											"type": "DatasetReference",
											"parameters": {
												"schema_name": {
													"value": "@activity('Lookup_Incremental').output.firstRow.TargetStageTableSchema",
													"type": "Expression"
												},
												"table_name": {
													"value": "@activity('Lookup_Incremental').output.firstRow.TargetStageTableName",
													"type": "Expression"
												}
											}
										}
									]
								},
								{
									"name": "Start_Table_Audit1",
									"type": "Lookup",
									"dependsOn": [
										{
											"activity": "Lookup_Incremental",
											"dependencyConditions": [
												"Succeeded"
											]
										}
									],
									"policy": {
										"timeout": "7.00:00:00",
										"retry": 0,
										"retryIntervalInSeconds": 30,
										"secureOutput": false,
										"secureInput": false
									},
									"userProperties": [],
									"typeProperties": {
										"source": {
											"type": "AzureSqlSource",
											"sqlReaderStoredProcedureName": "[dbo].[proc_StartAuditLog_Briggs]",
											"storedProcedureParameters": {
												"ConfigTableID": {
													"type": "Int32",
													"value": {
														"value": "@item().ID_Inc",
														"type": "Expression"
													}
												},
												"DataFactoryName": {
													"type": "String",
													"value": {
														"value": "@pipeline().DataFactory",
														"type": "Expression"
													}
												},
												"ParentAuditID": {
													"type": "Int64",
													"value": {
														"value": "@item().ID_Inc",
														"type": "Expression"
													}
												},
												"PipelineName": {
													"type": "String",
													"value": {
														"value": "@pipeline().Pipeline",
														"type": "Expression"
													}
												},
												"PipelineRunID": {
													"type": "String",
													"value": {
														"value": "@pipeline().RunId",
														"type": "Expression"
													}
												},
												"PipelineTriggerID": {
													"type": "String",
													"value": {
														"value": "@pipeline().TriggerId",
														"type": "Expression"
													}
												},
												"PipelineTriggerName": {
													"type": "String",
													"value": {
														"value": "@pipeline().TriggerName",
														"type": "Expression"
													}
												},
												"PipelineTriggerType": {
													"type": "String",
													"value": {
														"value": "@pipeline().TriggerType",
														"type": "Expression"
													}
												},
												"Sourcedb": {
													"type": "String",
													"value": {
														"value": "@item().sourceDB",
														"type": "Expression"
													}
												},
												"sourcetable": {
													"type": "String",
													"value": {
														"value": "@item().SourcetableName",
														"type": "Expression"
													}
												}
											},
											"queryTimeout": "02:00:00",
											"partitionOption": "None"
										},
										"dataset": {
											"referenceName": "Briggs_MDW",
											"type": "DatasetReference",
											"parameters": {
												"schema_name": "dbo",
												"table_name": "user"
											}
										},
										"firstRowOnly": false
									}
								},
								{
									"name": "Success_Audit_Log1",
									"type": "SqlServerStoredProcedure",
									"dependsOn": [
										{
											"activity": "Copy_Briggs_Inc_ADLS",
											"dependencyConditions": [
												"Succeeded"
											]
										}
									],
									"policy": {
										"timeout": "7.00:00:00",
										"retry": 0,
										"retryIntervalInSeconds": 30,
										"secureOutput": false,
										"secureInput": false
									},
									"userProperties": [],
									"typeProperties": {
										"storedProcedureName": "[dbo].[proc_UpdateAuditLog_Briggs]",
										"storedProcedureParameters": {
											"ConfigTableID": {
												"value": {
													"value": "@item().ID_Inc",
													"type": "Expression"
												},
												"type": "Int32"
											},
											"RowsRead": {
												"value": {
													"value": "@activity('Copy_Briggs_Inc_ADLS').output.RowsRead",
													"type": "Expression"
												},
												"type": "Int64"
											},
											"Status": {
												"value": "Success",
												"type": "String"
											}
										}
									},
									"linkedServiceName": {
										"referenceName": "DS_MDW_SP",
										"type": "LinkedServiceReference"
									}
								},
								{
									"name": "Success_Audit_Log2",
									"type": "SqlServerStoredProcedure",
									"dependsOn": [
										{
											"activity": "Copy_Briggs_Inc_ADLS_New",
											"dependencyConditions": [
												"Succeeded"
											]
										}
									],
									"policy": {
										"timeout": "7.00:00:00",
										"retry": 0,
										"retryIntervalInSeconds": 30,
										"secureOutput": false,
										"secureInput": false
									},
									"userProperties": [],
									"typeProperties": {
										"storedProcedureName": "[dbo].[proc_UpdateAuditLog_Briggs]",
										"storedProcedureParameters": {
											"ConfigTableID": {
												"value": {
													"value": "@item().ID_Inc",
													"type": "Expression"
												},
												"type": "Int32"
											},
											"RowsRead": {
												"value": {
													"value": "@activity('Copy_Briggs_Inc_ADLS_New').output.RowsRead",
													"type": "Expression"
												},
												"type": "Int64"
											},
											"Status": {
												"value": "Success",
												"type": "String"
											}
										}
									},
									"linkedServiceName": {
										"referenceName": "DS_MDW_SP",
										"type": "LinkedServiceReference"
									}
								},
								{
									"name": "Failure_Audit_Log2",
									"type": "SqlServerStoredProcedure",
									"dependsOn": [
										{
											"activity": "Set variable1",
											"dependencyConditions": [
												"Succeeded"
											]
										}
									],
									"policy": {
										"timeout": "7.00:00:00",
										"retry": 0,
										"retryIntervalInSeconds": 30,
										"secureOutput": false,
										"secureInput": false
									},
									"userProperties": [],
									"typeProperties": {
										"storedProcedureName": "[dbo].[proc_UpdateAuditLog_Briggs]",
										"storedProcedureParameters": {
											"ConfigTableID": {
												"value": {
													"value": "@item().ID_Inc",
													"type": "Expression"
												},
												"type": "Int32"
											},
											"RowsRead": {
												"value": null,
												"type": "Int64"
											},
											"Status": {
												"value": {
													"value": "@variables('ErrorMsgInc')",
													"type": "Expression"
												},
												"type": "String"
											}
										}
									},
									"linkedServiceName": {
										"referenceName": "DS_MDW_SP",
										"type": "LinkedServiceReference"
									}
								},
								{
									"name": "Set variable1",
									"type": "SetVariable",
									"dependsOn": [
										{
											"activity": "Copy_Briggs_Inc_ADLS",
											"dependencyConditions": [
												"Failed"
											]
										},
										{
											"activity": "Copy_Briggs_Inc_ADLS_New",
											"dependencyConditions": [
												"Failed"
											]
										}
									],
									"userProperties": [],
									"typeProperties": {
										"variableName": "ErrorMsgInc",
										"value": {
											"value": "@activity('Copy_Briggs_Inc_ADLS').Error.Message",
											"type": "Expression"
										}
									}
								}
							]
						}
					},
					{
						"name": "ForEach_Full_Load",
						"type": "ForEach",
						"dependsOn": [
							{
								"activity": "Lookup2_Full",
								"dependencyConditions": [
									"Succeeded"
								]
							}
						],
						"userProperties": [],
						"typeProperties": {
							"items": {
								"value": "@activity('Lookup2_Full').output.value",
								"type": "Expression"
							},
							"activities": [
								{
									"name": "Lookup_Full",
									"type": "Lookup",
									"dependsOn": [],
									"policy": {
										"timeout": "7.00:00:00",
										"retry": 0,
										"retryIntervalInSeconds": 30,
										"secureOutput": false,
										"secureInput": false
									},
									"userProperties": [],
									"typeProperties": {
										"source": {
											"type": "AzureSqlSource",
											"sqlReaderQuery": {
												"value": "@concat('select SourceQuery=''select '' +columnList+ '' from ''+ sourceDB+''.''+SourceSchemaName+''.''+SourcetableName\n,SourceDB\n,TargetContainer\n, TargetPath, TargetFile, FileFormat,DateField,LastDate,targetstagetableschema,targetstagetablename\nfrom dbo.control_table\nwhere ID= ',item().ID_Full)",
												"type": "Expression"
											},
											"queryTimeout": "02:00:00",
											"partitionOption": "None"
										},
										"dataset": {
											"referenceName": "Briggs_MDW",
											"type": "DatasetReference",
											"parameters": {
												"schema_name": "dbo",
												"table_name": "user"
											}
										}
									}
								},
								{
									"name": "Copy_Briggs_Full_ADLS",
									"type": "Copy",
									"dependsOn": [
										{
											"activity": "Start_Table_Audit",
											"dependencyConditions": [
												"Succeeded"
											]
										}
									],
									"policy": {
										"timeout": "7.00:00:00",
										"retry": 0,
										"retryIntervalInSeconds": 30,
										"secureOutput": false,
										"secureInput": false
									},
									"userProperties": [],
									"typeProperties": {
										"source": {
											"type": "SqlServerSource",
											"sqlReaderQuery": {
												"value": "@activity('Lookup_Full').output.firstRow.SourceQuery\n",
												"type": "Expression"
											},
											"queryTimeout": "02:00:00",
											"partitionOption": "None"
										},
										"sink": {
											"type": "AzureSqlSink",
											"preCopyScript": {
												"value": "@{concat('truncate table ',activity('Lookup_Full').output.firstRow.TargetStageTableSchema,'.',activity('Lookup_Full').output.firstRow.TargetStageTableName)}",
												"type": "Expression"
											},
											"disableMetricsCollection": false
										},
										"enableStaging": false,
										"translator": {
											"type": "TabularTranslator",
											"typeConversion": true,
											"typeConversionSettings": {
												"allowDataTruncation": true,
												"treatBooleanAsNumber": false
											}
										}
									},
									"inputs": [
										{
											"referenceName": "DS_Briggs_MST",
											"type": "DatasetReference",
											"parameters": {}
										}
									],
									"outputs": [
										{
											"referenceName": "Briggs_MDW",
											"type": "DatasetReference",
											"parameters": {
												"schema_name": {
													"value": "@activity('Lookup_Full').output.firstRow.TargetStageTableSchema",
													"type": "Expression"
												},
												"table_name": {
													"value": "@activity('Lookup_Full').output.firstRow.TargetStageTableName",
													"type": "Expression"
												}
											}
										}
									]
								},
								{
									"name": "Copy_Briggs_Full_ADLS_New",
									"type": "Copy",
									"dependsOn": [
										{
											"activity": "Copy_Briggs_Full_ADLS",
											"dependencyConditions": [
												"Failed"
											]
										}
									],
									"policy": {
										"timeout": "7.00:00:00",
										"retry": 0,
										"retryIntervalInSeconds": 30,
										"secureOutput": false,
										"secureInput": false
									},
									"userProperties": [],
									"typeProperties": {
										"source": {
											"type": "SqlServerSource",
											"sqlReaderQuery": {
												"value": "@activity('Lookup_Full').output.firstRow.SourceQuery\n",
												"type": "Expression"
											},
											"queryTimeout": "02:00:00",
											"partitionOption": "None"
										},
										"sink": {
											"type": "AzureSqlSink",
											"writeBehavior": "insert",
											"sqlWriterUseTableLock": false,
											"tableOption": "autoCreate",
											"disableMetricsCollection": false
										},
										"enableStaging": false,
										"translator": {
											"type": "TabularTranslator",
											"typeConversion": true,
											"typeConversionSettings": {
												"allowDataTruncation": true,
												"treatBooleanAsNumber": false
											}
										}
									},
									"inputs": [
										{
											"referenceName": "DS_Briggs_MST",
											"type": "DatasetReference",
											"parameters": {}
										}
									],
									"outputs": [
										{
											"referenceName": "Briggs_MDW",
											"type": "DatasetReference",
											"parameters": {
												"schema_name": {
													"value": "@activity('Lookup_Full').output.firstRow.TargetStageTableSchema",
													"type": "Expression"
												},
												"table_name": {
													"value": "@activity('Lookup_Full').output.firstRow.TargetStageTableName",
													"type": "Expression"
												}
											}
										}
									]
								},
								{
									"name": "Start_Table_Audit",
									"type": "Lookup",
									"dependsOn": [
										{
											"activity": "Lookup_Full",
											"dependencyConditions": [
												"Succeeded"
											]
										}
									],
									"policy": {
										"timeout": "7.00:00:00",
										"retry": 0,
										"retryIntervalInSeconds": 30,
										"secureOutput": false,
										"secureInput": false
									},
									"userProperties": [],
									"typeProperties": {
										"source": {
											"type": "AzureSqlSource",
											"sqlReaderStoredProcedureName": "[dbo].[proc_StartAuditLog_Briggs]",
											"storedProcedureParameters": {
												"ConfigTableID": {
													"type": "Int32",
													"value": {
														"value": "@item().ID_Full",
														"type": "Expression"
													}
												},
												"DataFactoryName": {
													"type": "String",
													"value": {
														"value": "@pipeline().DataFactory",
														"type": "Expression"
													}
												},
												"ParentAuditID": {
													"type": "Int64",
													"value": {
														"value": "@item().ID_Full",
														"type": "Expression"
													}
												},
												"PipelineName": {
													"type": "String",
													"value": {
														"value": "@pipeline().Pipeline",
														"type": "Expression"
													}
												},
												"PipelineRunID": {
													"type": "String",
													"value": {
														"value": "@pipeline().RunId",
														"type": "Expression"
													}
												},
												"PipelineTriggerID": {
													"type": "String",
													"value": {
														"value": "@pipeline().TriggerId",
														"type": "Expression"
													}
												},
												"PipelineTriggerName": {
													"type": "String",
													"value": {
														"value": "@pipeline().TriggerName",
														"type": "Expression"
													}
												},
												"PipelineTriggerType": {
													"type": "String",
													"value": {
														"value": "@pipeline().TriggerType",
														"type": "Expression"
													}
												},
												"Sourcedb": {
													"type": "String",
													"value": {
														"value": "@item().sourceDB",
														"type": "Expression"
													}
												},
												"sourcetable": {
													"type": "String",
													"value": {
														"value": "@item().SourcetableName",
														"type": "Expression"
													}
												}
											},
											"queryTimeout": "02:00:00",
											"partitionOption": "None"
										},
										"dataset": {
											"referenceName": "Briggs_MDW",
											"type": "DatasetReference",
											"parameters": {
												"schema_name": "dbo",
												"table_name": "user"
											}
										},
										"firstRowOnly": false
									}
								},
								{
									"name": "Success_Audit_Log",
									"type": "SqlServerStoredProcedure",
									"dependsOn": [
										{
											"activity": "Copy_Briggs_Full_ADLS",
											"dependencyConditions": [
												"Succeeded"
											]
										}
									],
									"policy": {
										"timeout": "7.00:00:00",
										"retry": 0,
										"retryIntervalInSeconds": 30,
										"secureOutput": false,
										"secureInput": false
									},
									"userProperties": [],
									"typeProperties": {
										"storedProcedureName": "[dbo].[proc_UpdateAuditLog_Briggs]",
										"storedProcedureParameters": {
											"ConfigTableID": {
												"value": {
													"value": "@item().ID_Full",
													"type": "Expression"
												},
												"type": "Int32"
											},
											"RowsRead": {
												"value": {
													"value": "@activity('Copy_Briggs_Full_ADLS').output.RowsRead",
													"type": "Expression"
												},
												"type": "Int64"
											},
											"Status": {
												"value": "Success",
												"type": "String"
											}
										}
									},
									"linkedServiceName": {
										"referenceName": "DS_MDW_SP",
										"type": "LinkedServiceReference"
									}
								},
								{
									"name": "Success_Audit_Log_New",
									"type": "SqlServerStoredProcedure",
									"dependsOn": [
										{
											"activity": "Copy_Briggs_Full_ADLS_New",
											"dependencyConditions": [
												"Succeeded"
											]
										}
									],
									"policy": {
										"timeout": "7.00:00:00",
										"retry": 0,
										"retryIntervalInSeconds": 30,
										"secureOutput": false,
										"secureInput": false
									},
									"userProperties": [],
									"typeProperties": {
										"storedProcedureName": "[dbo].[proc_UpdateAuditLog_Briggs]",
										"storedProcedureParameters": {
											"ConfigTableID": {
												"value": {
													"value": "@item().ID_Full",
													"type": "Expression"
												},
												"type": "Int32"
											},
											"RowsRead": {
												"value": {
													"value": "@activity('Copy_Briggs_Full_ADLS_New').output.RowsRead",
													"type": "Expression"
												},
												"type": "Int64"
											},
											"Status": {
												"value": "Success",
												"type": "String"
											}
										}
									},
									"linkedServiceName": {
										"referenceName": "DS_MDW_SP",
										"type": "LinkedServiceReference"
									}
								},
								{
									"name": "Failure_Audit_Log_New",
									"type": "SqlServerStoredProcedure",
									"dependsOn": [
										{
											"activity": "Set variable2",
											"dependencyConditions": [
												"Succeeded"
											]
										}
									],
									"policy": {
										"timeout": "7.00:00:00",
										"retry": 0,
										"retryIntervalInSeconds": 30,
										"secureOutput": false,
										"secureInput": false
									},
									"userProperties": [],
									"typeProperties": {
										"storedProcedureName": "[dbo].[proc_UpdateAuditLog_Briggs]",
										"storedProcedureParameters": {
											"ConfigTableID": {
												"value": {
													"value": "@item().ID_Full",
													"type": "Expression"
												},
												"type": "Int32"
											},
											"RowsRead": {
												"value": null,
												"type": "Int64"
											},
											"Status": {
												"value": {
													"value": "@variables('ErrorMsgFull')",
													"type": "Expression"
												},
												"type": "String"
											}
										}
									},
									"linkedServiceName": {
										"referenceName": "DS_MDW_SP",
										"type": "LinkedServiceReference"
									}
								},
								{
									"name": "Set variable2",
									"type": "SetVariable",
									"dependsOn": [
										{
											"activity": "Copy_Briggs_Full_ADLS",
											"dependencyConditions": [
												"Failed"
											]
										},
										{
											"activity": "Copy_Briggs_Full_ADLS_New",
											"dependencyConditions": [
												"Failed"
											]
										}
									],
									"userProperties": [],
									"typeProperties": {
										"variableName": "ErrorMsgFull",
										"value": {
											"value": "@activity('Copy_Briggs_Full_ADLS').Error.Message",
											"type": "Expression"
										}
									}
								}
							]
						}
					},
					{
						"name": "ForEach_Proc_Incremental",
						"type": "ForEach",
						"dependsOn": [
							{
								"activity": "ForEach_Incremental_Load",
								"dependencyConditions": [
									"Succeeded"
								]
							}
						],
						"userProperties": [],
						"typeProperties": {
							"items": {
								"value": "@activity('Lookup1_Incremental').output.value",
								"type": "Expression"
							},
							"activities": [
								{
									"name": "Stored procedure1",
									"type": "SqlServerStoredProcedure",
									"dependsOn": [],
									"policy": {
										"timeout": "7.00:00:00",
										"retry": 0,
										"retryIntervalInSeconds": 30,
										"secureOutput": false,
										"secureInput": false
									},
									"userProperties": [],
									"typeProperties": {
										"storedProcedureName": "[dbo].[USP_Control_Table_LastDate]",
										"storedProcedureParameters": {
											"id_I_F": {
												"value": {
													"value": "@item().ID_Inc",
													"type": "Expression"
												},
												"type": "Int32"
											}
										}
									},
									"linkedServiceName": {
										"referenceName": "DS_MDW_SP",
										"type": "LinkedServiceReference"
									}
								}
							]
						}
					},
					{
						"name": "ForEach_Proc_Full",
						"type": "ForEach",
						"dependsOn": [
							{
								"activity": "ForEach_Full_Load",
								"dependencyConditions": [
									"Succeeded"
								]
							}
						],
						"userProperties": [],
						"typeProperties": {
							"items": {
								"value": "@activity('Lookup2_Full').output.value",
								"type": "Expression"
							},
							"activities": [
								{
									"name": "Stored procedure_Full",
									"type": "SqlServerStoredProcedure",
									"dependsOn": [],
									"policy": {
										"timeout": "7.00:00:00",
										"retry": 0,
										"retryIntervalInSeconds": 30,
										"secureOutput": false,
										"secureInput": false
									},
									"userProperties": [],
									"typeProperties": {
										"storedProcedureName": "[dbo].[USP_Control_Table_LastDate]",
										"storedProcedureParameters": {
											"id_I_F": {
												"value": {
													"value": "@item().ID_Full",
													"type": "Expression"
												},
												"type": "Int32"
											}
										}
									},
									"linkedServiceName": {
										"referenceName": "DS_MDW_SP",
										"type": "LinkedServiceReference"
									}
								}
							]
						}
					},
					{
						"name": "lkp_ExecStartAuditProc",
						"type": "Lookup",
						"dependsOn": [],
						"policy": {
							"timeout": "7.00:00:00",
							"retry": 0,
							"retryIntervalInSeconds": 30,
							"secureOutput": false,
							"secureInput": false
						},
						"userProperties": [],
						"typeProperties": {
							"source": {
								"type": "AzureSqlSource",
								"sqlReaderStoredProcedureName": "[dbo].[proc_StartAuditLog]",
								"storedProcedureParameters": {
									"ConfigTableID": {
										"type": "Int32",
										"value": "-1"
									},
									"DataFactoryName": {
										"type": "String",
										"value": {
											"value": "@pipeline().DataFactory",
											"type": "Expression"
										}
									},
									"ParentAuditID": {
										"type": "Int64",
										"value": "-1"
									},
									"PipelineName": {
										"type": "String",
										"value": {
											"value": "@concat(pipeline().Pipeline,' Operations Source Table Load')",
											"type": "Expression"
										}
									},
									"PipelineRunID": {
										"type": "String",
										"value": {
											"value": "@pipeline().RunId",
											"type": "Expression"
										}
									},
									"PipelineTriggerID": {
										"type": "String",
										"value": {
											"value": "@pipeline().TriggerId",
											"type": "Expression"
										}
									},
									"PipelineTriggerName": {
										"type": "String",
										"value": {
											"value": "@pipeline().TriggerName",
											"type": "Expression"
										}
									},
									"PipelineTriggerType": {
										"type": "String",
										"value": {
											"value": "@pipeline().TriggerType",
											"type": "Expression"
										}
									}
								},
								"queryTimeout": "02:00:00",
								"partitionOption": "None"
							},
							"dataset": {
								"referenceName": "Briggs_MDW",
								"type": "DatasetReference",
								"parameters": {
									"schema_name": "dbo",
									"table_name": "user"
								}
							}
						}
					},
					{
						"name": "Sp_ExecFailureAudit_Full",
						"type": "SqlServerStoredProcedure",
						"dependsOn": [
							{
								"activity": "ForEach_Full_Load",
								"dependencyConditions": [
									"Failed"
								]
							}
						],
						"policy": {
							"timeout": "7.00:00:00",
							"retry": 0,
							"retryIntervalInSeconds": 30,
							"secureOutput": false,
							"secureInput": false
						},
						"userProperties": [],
						"typeProperties": {
							"storedProcedureName": "[dbo].[proc_UpdateAuditLog]",
							"storedProcedureParameters": {
								"AuditID": {
									"value": {
										"value": "@activity('lkp_ExecStartAuditProc').output.firstRow.AuditID",
										"type": "Expression"
									},
									"type": "Int32"
								},
								"DataLakePath": {
									"value": null,
									"type": "String"
								},
								"PipelineRunID": {
									"value": {
										"value": "@pipeline().RunId",
										"type": "Expression"
									},
									"type": "String"
								},
								"RowsRead": {
									"value": null,
									"type": "Int64"
								},
								"Status": {
									"value": "Full Load Failed",
									"type": "String"
								}
							}
						},
						"linkedServiceName": {
							"referenceName": "AzureSqlDatabase1",
							"type": "LinkedServiceReference"
						}
					},
					{
						"name": "Sp_ExecSuccessAudit",
						"type": "SqlServerStoredProcedure",
						"dependsOn": [
							{
								"activity": "ForEach_Proc_Incremental",
								"dependencyConditions": [
									"Succeeded"
								]
							},
							{
								"activity": "ForEach_Proc_Full",
								"dependencyConditions": [
									"Succeeded"
								]
							}
						],
						"policy": {
							"timeout": "7.00:00:00",
							"retry": 0,
							"retryIntervalInSeconds": 30,
							"secureOutput": false,
							"secureInput": false
						},
						"userProperties": [],
						"typeProperties": {
							"storedProcedureName": "[dbo].[proc_UpdateAuditLog]",
							"storedProcedureParameters": {
								"AuditID": {
									"value": {
										"value": "@activity('lkp_ExecStartAuditProc').output.firstRow.AuditID",
										"type": "Expression"
									},
									"type": "Int32"
								},
								"DataLakePath": {
									"value": null,
									"type": "String"
								},
								"RowsRead": {
									"value": null,
									"type": "Int64"
								},
								"Status": {
									"value": "Success",
									"type": "String"
								},
								"PipelineRunID": {
									"value": {
										"value": "@pipeline().RunId",
										"type": "Expression"
									},
									"type": "String"
								}
							}
						},
						"linkedServiceName": {
							"referenceName": "AzureSqlDatabase1",
							"type": "LinkedServiceReference"
						}
					},
					{
						"name": "Sp_ExecFailureAudit_Inc",
						"type": "SqlServerStoredProcedure",
						"dependsOn": [
							{
								"activity": "ForEach_Incremental_Load",
								"dependencyConditions": [
									"Failed"
								]
							}
						],
						"policy": {
							"timeout": "7.00:00:00",
							"retry": 0,
							"retryIntervalInSeconds": 30,
							"secureOutput": false,
							"secureInput": false
						},
						"userProperties": [],
						"typeProperties": {
							"storedProcedureName": "[dbo].[proc_UpdateAuditLog]",
							"storedProcedureParameters": {
								"AuditID": {
									"value": {
										"value": "@activity('lkp_ExecStartAuditProc').output.firstRow.AuditID",
										"type": "Expression"
									},
									"type": "Int32"
								},
								"DataLakePath": {
									"value": null,
									"type": "String"
								},
								"PipelineRunID": {
									"value": {
										"value": "@pipeline().RunId",
										"type": "Expression"
									},
									"type": "String"
								},
								"RowsRead": {
									"value": null,
									"type": "Int64"
								},
								"Status": {
									"value": "Incr Load Failed",
									"type": "String"
								}
							}
						},
						"linkedServiceName": {
							"referenceName": "AzureSqlDatabase1",
							"type": "LinkedServiceReference"
						}
					}
				],
				"policy": {
					"elapsedTimeMetric": {},
					"cancelAfter": {}
				},
				"variables": {
					"ErrorMsgInc": {
						"type": "String"
					},
					"ErrorMsgFull": {
						"type": "String"
					}
				},
				"folder": {
					"name": "Briggs Data Load Theme wise"
				},
				"annotations": [],
				"lastPublishTime": "2022-04-26T07:45:28Z"
			},
			"dependsOn": [
				"[concat(variables('workspaceId'), '/datasets/Briggs_MDW')]",
				"[concat(variables('workspaceId'), '/linkedServices/AzureSqlDatabase1')]",
				"[concat(variables('workspaceId'), '/datasets/DS_Briggs_MST')]",
				"[concat(variables('workspaceId'), '/linkedServices/DS_MDW_SP')]"
			]
		},
		{
			"name": "[concat(parameters('workspaceName'), '/PL_Generic_Copy_Parts')]",
			"type": "Microsoft.Synapse/workspaces/pipelines",
			"apiVersion": "2019-06-01-preview",
			"properties": {
				"activities": [
					{
						"name": "Lookup1_Incremental",
						"type": "Lookup",
						"dependsOn": [
							{
								"activity": "lkp_ExecStartAuditProc",
								"dependencyConditions": [
									"Succeeded"
								]
							}
						],
						"policy": {
							"timeout": "7.00:00:00",
							"retry": 0,
							"retryIntervalInSeconds": 30,
							"secureOutput": false,
							"secureInput": false
						},
						"userProperties": [],
						"typeProperties": {
							"source": {
								"type": "AzureSqlSource",
								"sqlReaderQuery": "Select Distinct ID ID_Inc,sourcedb,sourcetablename From dbo.control_table Where ProcessName = 'AzSQL_ADLS'  \nAND DataLoadType = 'Incremental'  and EnableAction = 1  \nand (format(refresh_date,'dd-MM-yyyy') <> format(getdate(),'dd-MM-yyyy') or refresh_date is null)\nand subjectarea like '%Sales Parts%' and id <> 253 \norder by 1 ",
								"queryTimeout": "02:00:00",
								"partitionOption": "None"
							},
							"dataset": {
								"referenceName": "Briggs_MDW",
								"type": "DatasetReference",
								"parameters": {
									"schema_name": "dbo",
									"table_name": "user"
								}
							},
							"firstRowOnly": false
						}
					},
					{
						"name": "Lookup2_Full",
						"type": "Lookup",
						"dependsOn": [
							{
								"activity": "lkp_ExecStartAuditProc",
								"dependencyConditions": [
									"Succeeded"
								]
							}
						],
						"policy": {
							"timeout": "7.00:00:00",
							"retry": 0,
							"retryIntervalInSeconds": 30,
							"secureOutput": false,
							"secureInput": false
						},
						"userProperties": [],
						"typeProperties": {
							"source": {
								"type": "AzureSqlSource",
								"sqlReaderQuery": "Select Distinct ID ID_Full,sourcedb,sourcetablename From dbo.control_table Where ProcessName = 'AzSQL_ADLS'  \nAND DataLoadType = 'Full'  and EnableAction = 1 \nand (format(refresh_date,'dd-MM-yyyy') <> format(getdate(),'dd-MM-yyyy') or refresh_date is null)\nand subjectarea like '%Sales Parts%' \norder by 1 ",
								"queryTimeout": "02:00:00",
								"partitionOption": "None"
							},
							"dataset": {
								"referenceName": "Briggs_MDW",
								"type": "DatasetReference",
								"parameters": {
									"schema_name": "dbo",
									"table_name": "user"
								}
							},
							"firstRowOnly": false
						}
					},
					{
						"name": "ForEach_Incremental_Load",
						"type": "ForEach",
						"dependsOn": [
							{
								"activity": "Lookup1_Incremental",
								"dependencyConditions": [
									"Succeeded"
								]
							}
						],
						"userProperties": [],
						"typeProperties": {
							"items": {
								"value": "@activity('Lookup1_Incremental').output.value",
								"type": "Expression"
							},
							"activities": [
								{
									"name": "Lookup_Incremental",
									"type": "Lookup",
									"dependsOn": [],
									"policy": {
										"timeout": "7.00:00:00",
										"retry": 0,
										"retryIntervalInSeconds": 30,
										"secureOutput": false,
										"secureInput": false
									},
									"userProperties": [],
									"typeProperties": {
										"source": {
											"type": "AzureSqlSource",
											"sqlReaderQuery": {
												"value": "@concat('select SourceQuery=''select '' +columnList+ '' from ''+ sourceDB+''.''+SourceSchemaName+''.''+SourcetableName + '' where \ncast(''+DateField+'' as date) >=''''''+LastDate+''''''''\n,SourceDB\n,TargetContainer\n, TargetPath, TargetFile, FileFormat,DateField,LastDate,targetstagetableschema,targetstagetablename\nfrom dbo.control_table\nwhere ID= ',item().ID_Inc)",
												"type": "Expression"
											},
											"queryTimeout": "02:00:00",
											"partitionOption": "None"
										},
										"dataset": {
											"referenceName": "Briggs_MDW",
											"type": "DatasetReference",
											"parameters": {
												"schema_name": "dbo",
												"table_name": "user"
											}
										}
									}
								},
								{
									"name": "Copy_Briggs_Inc_ADLS",
									"type": "Copy",
									"dependsOn": [
										{
											"activity": "Start_Table_Audit1",
											"dependencyConditions": [
												"Succeeded"
											]
										}
									],
									"policy": {
										"timeout": "7.00:00:00",
										"retry": 0,
										"retryIntervalInSeconds": 30,
										"secureOutput": false,
										"secureInput": false
									},
									"userProperties": [],
									"typeProperties": {
										"source": {
											"type": "SqlServerSource",
											"sqlReaderQuery": {
												"value": "@activity('Lookup_Incremental').output.firstRow.SourceQuery\n",
												"type": "Expression"
											},
											"queryTimeout": "02:00:00",
											"partitionOption": "None"
										},
										"sink": {
											"type": "AzureSqlSink",
											"preCopyScript": {
												"value": "@{concat('delete from ',activity('Lookup_Incremental').output.firstRow.TargetStageTableSchema,'.',activity('Lookup_Incremental').output.firstRow.targetstagetablename,' where cast(',activity('Lookup_Incremental').output.firstRow.DateField,' as date)=','''',activity('Lookup_Incremental').output.firstRow.LastDate,'''')}",
												"type": "Expression"
											},
											"disableMetricsCollection": false
										},
										"enableStaging": false,
										"translator": {
											"type": "TabularTranslator",
											"typeConversion": true,
											"typeConversionSettings": {
												"allowDataTruncation": true,
												"treatBooleanAsNumber": false
											}
										}
									},
									"inputs": [
										{
											"referenceName": "DS_Briggs_MST",
											"type": "DatasetReference",
											"parameters": {}
										}
									],
									"outputs": [
										{
											"referenceName": "Briggs_MDW",
											"type": "DatasetReference",
											"parameters": {
												"schema_name": {
													"value": "@activity('Lookup_Incremental').output.firstRow.TargetStageTableSchema",
													"type": "Expression"
												},
												"table_name": {
													"value": "@activity('Lookup_Incremental').output.firstRow.TargetStageTableName",
													"type": "Expression"
												}
											}
										}
									]
								},
								{
									"name": "Copy_Briggs_Inc_ADLS_New",
									"type": "Copy",
									"dependsOn": [
										{
											"activity": "Copy_Briggs_Inc_ADLS",
											"dependencyConditions": [
												"Failed"
											]
										}
									],
									"policy": {
										"timeout": "7.00:00:00",
										"retry": 0,
										"retryIntervalInSeconds": 30,
										"secureOutput": false,
										"secureInput": false
									},
									"userProperties": [],
									"typeProperties": {
										"source": {
											"type": "SqlServerSource",
											"sqlReaderQuery": {
												"value": "@activity('Lookup_Incremental').output.firstRow.SourceQuery\n",
												"type": "Expression"
											},
											"queryTimeout": "02:00:00",
											"partitionOption": "None"
										},
										"sink": {
											"type": "AzureSqlSink",
											"writeBehavior": "insert",
											"sqlWriterUseTableLock": false,
											"tableOption": "autoCreate",
											"disableMetricsCollection": false
										},
										"enableStaging": false,
										"translator": {
											"type": "TabularTranslator",
											"typeConversion": true,
											"typeConversionSettings": {
												"allowDataTruncation": true,
												"treatBooleanAsNumber": false
											}
										}
									},
									"inputs": [
										{
											"referenceName": "DS_Briggs_MST",
											"type": "DatasetReference",
											"parameters": {}
										}
									],
									"outputs": [
										{
											"referenceName": "Briggs_MDW",
											"type": "DatasetReference",
											"parameters": {
												"schema_name": {
													"value": "@activity('Lookup_Incremental').output.firstRow.TargetStageTableSchema",
													"type": "Expression"
												},
												"table_name": {
													"value": "@activity('Lookup_Incremental').output.firstRow.TargetStageTableName",
													"type": "Expression"
												}
											}
										}
									]
								},
								{
									"name": "Start_Table_Audit1",
									"type": "Lookup",
									"dependsOn": [
										{
											"activity": "Lookup_Incremental",
											"dependencyConditions": [
												"Succeeded"
											]
										}
									],
									"policy": {
										"timeout": "7.00:00:00",
										"retry": 0,
										"retryIntervalInSeconds": 30,
										"secureOutput": false,
										"secureInput": false
									},
									"userProperties": [],
									"typeProperties": {
										"source": {
											"type": "AzureSqlSource",
											"sqlReaderStoredProcedureName": "[dbo].[proc_StartAuditLog_Briggs]",
											"storedProcedureParameters": {
												"ConfigTableID": {
													"type": "Int32",
													"value": {
														"value": "@item().ID_Inc",
														"type": "Expression"
													}
												},
												"DataFactoryName": {
													"type": "String",
													"value": {
														"value": "@pipeline().DataFactory",
														"type": "Expression"
													}
												},
												"ParentAuditID": {
													"type": "Int64",
													"value": {
														"value": "@item().ID_Inc",
														"type": "Expression"
													}
												},
												"PipelineName": {
													"type": "String",
													"value": {
														"value": "@pipeline().Pipeline",
														"type": "Expression"
													}
												},
												"PipelineRunID": {
													"type": "String",
													"value": {
														"value": "@pipeline().RunId",
														"type": "Expression"
													}
												},
												"PipelineTriggerID": {
													"type": "String",
													"value": {
														"value": "@pipeline().TriggerId",
														"type": "Expression"
													}
												},
												"PipelineTriggerName": {
													"type": "String",
													"value": {
														"value": "@pipeline().TriggerName",
														"type": "Expression"
													}
												},
												"PipelineTriggerType": {
													"type": "String",
													"value": {
														"value": "@pipeline().TriggerType",
														"type": "Expression"
													}
												},
												"Sourcedb": {
													"type": "String",
													"value": {
														"value": "@item().sourceDB",
														"type": "Expression"
													}
												},
												"sourcetable": {
													"type": "String",
													"value": {
														"value": "@item().SourcetableName",
														"type": "Expression"
													}
												}
											},
											"queryTimeout": "02:00:00",
											"partitionOption": "None"
										},
										"dataset": {
											"referenceName": "Briggs_MDW",
											"type": "DatasetReference",
											"parameters": {
												"schema_name": "dbo",
												"table_name": "user"
											}
										},
										"firstRowOnly": false
									}
								},
								{
									"name": "Success_Audit_Log1",
									"type": "SqlServerStoredProcedure",
									"dependsOn": [
										{
											"activity": "Copy_Briggs_Inc_ADLS",
											"dependencyConditions": [
												"Succeeded"
											]
										}
									],
									"policy": {
										"timeout": "7.00:00:00",
										"retry": 0,
										"retryIntervalInSeconds": 30,
										"secureOutput": false,
										"secureInput": false
									},
									"userProperties": [],
									"typeProperties": {
										"storedProcedureName": "[dbo].[proc_UpdateAuditLog_Briggs]",
										"storedProcedureParameters": {
											"ConfigTableID": {
												"value": {
													"value": "@item().ID_Inc",
													"type": "Expression"
												},
												"type": "Int32"
											},
											"RowsRead": {
												"value": {
													"value": "@activity('Copy_Briggs_Inc_ADLS').output.RowsRead",
													"type": "Expression"
												},
												"type": "Int64"
											},
											"Status": {
												"value": "Success",
												"type": "String"
											}
										}
									},
									"linkedServiceName": {
										"referenceName": "DS_MDW_SP",
										"type": "LinkedServiceReference"
									}
								},
								{
									"name": "Success_Audit_Log2",
									"type": "SqlServerStoredProcedure",
									"dependsOn": [
										{
											"activity": "Copy_Briggs_Inc_ADLS_New",
											"dependencyConditions": [
												"Succeeded"
											]
										}
									],
									"policy": {
										"timeout": "7.00:00:00",
										"retry": 0,
										"retryIntervalInSeconds": 30,
										"secureOutput": false,
										"secureInput": false
									},
									"userProperties": [],
									"typeProperties": {
										"storedProcedureName": "[dbo].[proc_UpdateAuditLog_Briggs]",
										"storedProcedureParameters": {
											"ConfigTableID": {
												"value": {
													"value": "@item().ID_Inc",
													"type": "Expression"
												},
												"type": "Int32"
											},
											"RowsRead": {
												"value": {
													"value": "@activity('Copy_Briggs_Inc_ADLS_New').output.RowsRead",
													"type": "Expression"
												},
												"type": "Int64"
											},
											"Status": {
												"value": "Success",
												"type": "String"
											}
										}
									},
									"linkedServiceName": {
										"referenceName": "DS_MDW_SP",
										"type": "LinkedServiceReference"
									}
								},
								{
									"name": "Failure_Audit_Log2",
									"type": "SqlServerStoredProcedure",
									"dependsOn": [
										{
											"activity": "Set variable1",
											"dependencyConditions": [
												"Succeeded"
											]
										}
									],
									"policy": {
										"timeout": "7.00:00:00",
										"retry": 0,
										"retryIntervalInSeconds": 30,
										"secureOutput": false,
										"secureInput": false
									},
									"userProperties": [],
									"typeProperties": {
										"storedProcedureName": "[dbo].[proc_UpdateAuditLog_Briggs]",
										"storedProcedureParameters": {
											"ConfigTableID": {
												"value": {
													"value": "@item().ID_Inc",
													"type": "Expression"
												},
												"type": "Int32"
											},
											"RowsRead": {
												"value": null,
												"type": "Int64"
											},
											"Status": {
												"value": {
													"value": "@variables('ErrorMsgInc')",
													"type": "Expression"
												},
												"type": "String"
											}
										}
									},
									"linkedServiceName": {
										"referenceName": "DS_MDW_SP",
										"type": "LinkedServiceReference"
									}
								},
								{
									"name": "Set variable1",
									"type": "SetVariable",
									"dependsOn": [
										{
											"activity": "Copy_Briggs_Inc_ADLS",
											"dependencyConditions": [
												"Failed"
											]
										},
										{
											"activity": "Copy_Briggs_Inc_ADLS_New",
											"dependencyConditions": [
												"Failed"
											]
										}
									],
									"userProperties": [],
									"typeProperties": {
										"variableName": "ErrorMsgInc",
										"value": {
											"value": "@activity('Copy_Briggs_Inc_ADLS').Error.Message",
											"type": "Expression"
										}
									}
								}
							]
						}
					},
					{
						"name": "ForEach_Full_Load",
						"type": "ForEach",
						"dependsOn": [
							{
								"activity": "Lookup2_Full",
								"dependencyConditions": [
									"Succeeded"
								]
							}
						],
						"userProperties": [],
						"typeProperties": {
							"items": {
								"value": "@activity('Lookup2_Full').output.value",
								"type": "Expression"
							},
							"activities": [
								{
									"name": "Lookup_Full",
									"type": "Lookup",
									"dependsOn": [],
									"policy": {
										"timeout": "7.00:00:00",
										"retry": 0,
										"retryIntervalInSeconds": 30,
										"secureOutput": false,
										"secureInput": false
									},
									"userProperties": [],
									"typeProperties": {
										"source": {
											"type": "AzureSqlSource",
											"sqlReaderQuery": {
												"value": "@concat('select SourceQuery=''select '' +columnList+ '' from ''+ sourceDB+''.''+SourceSchemaName+''.''+SourcetableName\n,SourceDB\n,TargetContainer\n, TargetPath, TargetFile, FileFormat,DateField,LastDate,targetstagetableschema,targetstagetablename\nfrom dbo.control_table\nwhere ID= ',item().ID_Full)",
												"type": "Expression"
											},
											"queryTimeout": "02:00:00",
											"partitionOption": "None"
										},
										"dataset": {
											"referenceName": "Briggs_MDW",
											"type": "DatasetReference",
											"parameters": {
												"schema_name": "dbo",
												"table_name": "user"
											}
										}
									}
								},
								{
									"name": "Copy_Briggs_Full_ADLS",
									"type": "Copy",
									"dependsOn": [
										{
											"activity": "Start_Table_Audit",
											"dependencyConditions": [
												"Succeeded"
											]
										}
									],
									"policy": {
										"timeout": "7.00:00:00",
										"retry": 0,
										"retryIntervalInSeconds": 30,
										"secureOutput": false,
										"secureInput": false
									},
									"userProperties": [],
									"typeProperties": {
										"source": {
											"type": "SqlServerSource",
											"sqlReaderQuery": {
												"value": "@activity('Lookup_Full').output.firstRow.SourceQuery\n",
												"type": "Expression"
											},
											"queryTimeout": "02:00:00",
											"partitionOption": "None"
										},
										"sink": {
											"type": "AzureSqlSink",
											"preCopyScript": {
												"value": "@{concat('truncate table ',activity('Lookup_Full').output.firstRow.TargetStageTableSchema,'.',activity('Lookup_Full').output.firstRow.TargetStageTableName)}",
												"type": "Expression"
											},
											"disableMetricsCollection": false
										},
										"enableStaging": false,
										"translator": {
											"type": "TabularTranslator",
											"typeConversion": true,
											"typeConversionSettings": {
												"allowDataTruncation": true,
												"treatBooleanAsNumber": false
											}
										}
									},
									"inputs": [
										{
											"referenceName": "DS_Briggs_MST",
											"type": "DatasetReference",
											"parameters": {}
										}
									],
									"outputs": [
										{
											"referenceName": "Briggs_MDW",
											"type": "DatasetReference",
											"parameters": {
												"schema_name": {
													"value": "@activity('Lookup_Full').output.firstRow.TargetStageTableSchema",
													"type": "Expression"
												},
												"table_name": {
													"value": "@activity('Lookup_Full').output.firstRow.TargetStageTableName",
													"type": "Expression"
												}
											}
										}
									]
								},
								{
									"name": "Copy_Briggs_Full_ADLS_New",
									"type": "Copy",
									"dependsOn": [
										{
											"activity": "Copy_Briggs_Full_ADLS",
											"dependencyConditions": [
												"Failed"
											]
										}
									],
									"policy": {
										"timeout": "7.00:00:00",
										"retry": 0,
										"retryIntervalInSeconds": 30,
										"secureOutput": false,
										"secureInput": false
									},
									"userProperties": [],
									"typeProperties": {
										"source": {
											"type": "SqlServerSource",
											"sqlReaderQuery": {
												"value": "@activity('Lookup_Full').output.firstRow.SourceQuery\n",
												"type": "Expression"
											},
											"queryTimeout": "02:00:00",
											"partitionOption": "None"
										},
										"sink": {
											"type": "AzureSqlSink",
											"writeBehavior": "insert",
											"sqlWriterUseTableLock": false,
											"tableOption": "autoCreate",
											"disableMetricsCollection": false
										},
										"enableStaging": false,
										"translator": {
											"type": "TabularTranslator",
											"typeConversion": true,
											"typeConversionSettings": {
												"allowDataTruncation": true,
												"treatBooleanAsNumber": false
											}
										}
									},
									"inputs": [
										{
											"referenceName": "DS_Briggs_MST",
											"type": "DatasetReference",
											"parameters": {}
										}
									],
									"outputs": [
										{
											"referenceName": "Briggs_MDW",
											"type": "DatasetReference",
											"parameters": {
												"schema_name": {
													"value": "@activity('Lookup_Full').output.firstRow.TargetStageTableSchema",
													"type": "Expression"
												},
												"table_name": {
													"value": "@activity('Lookup_Full').output.firstRow.TargetStageTableName",
													"type": "Expression"
												}
											}
										}
									]
								},
								{
									"name": "Start_Table_Audit",
									"type": "Lookup",
									"dependsOn": [
										{
											"activity": "Lookup_Full",
											"dependencyConditions": [
												"Succeeded"
											]
										}
									],
									"policy": {
										"timeout": "7.00:00:00",
										"retry": 0,
										"retryIntervalInSeconds": 30,
										"secureOutput": false,
										"secureInput": false
									},
									"userProperties": [],
									"typeProperties": {
										"source": {
											"type": "AzureSqlSource",
											"sqlReaderStoredProcedureName": "[dbo].[proc_StartAuditLog_Briggs]",
											"storedProcedureParameters": {
												"ConfigTableID": {
													"type": "Int32",
													"value": {
														"value": "@item().ID_Full",
														"type": "Expression"
													}
												},
												"DataFactoryName": {
													"type": "String",
													"value": {
														"value": "@pipeline().DataFactory",
														"type": "Expression"
													}
												},
												"ParentAuditID": {
													"type": "Int64",
													"value": {
														"value": "@item().ID_Full",
														"type": "Expression"
													}
												},
												"PipelineName": {
													"type": "String",
													"value": {
														"value": "@pipeline().Pipeline",
														"type": "Expression"
													}
												},
												"PipelineRunID": {
													"type": "String",
													"value": {
														"value": "@pipeline().RunId",
														"type": "Expression"
													}
												},
												"PipelineTriggerID": {
													"type": "String",
													"value": {
														"value": "@pipeline().TriggerId",
														"type": "Expression"
													}
												},
												"PipelineTriggerName": {
													"type": "String",
													"value": {
														"value": "@pipeline().TriggerName",
														"type": "Expression"
													}
												},
												"PipelineTriggerType": {
													"type": "String",
													"value": {
														"value": "@pipeline().TriggerType",
														"type": "Expression"
													}
												},
												"Sourcedb": {
													"type": "String",
													"value": {
														"value": "@item().sourceDB",
														"type": "Expression"
													}
												},
												"sourcetable": {
													"type": "String",
													"value": {
														"value": "@item().SourcetableName",
														"type": "Expression"
													}
												}
											},
											"queryTimeout": "02:00:00",
											"partitionOption": "None"
										},
										"dataset": {
											"referenceName": "Briggs_MDW",
											"type": "DatasetReference",
											"parameters": {
												"schema_name": "dbo",
												"table_name": "user"
											}
										},
										"firstRowOnly": false
									}
								},
								{
									"name": "Success_Audit_Log",
									"type": "SqlServerStoredProcedure",
									"dependsOn": [
										{
											"activity": "Copy_Briggs_Full_ADLS",
											"dependencyConditions": [
												"Succeeded"
											]
										}
									],
									"policy": {
										"timeout": "7.00:00:00",
										"retry": 0,
										"retryIntervalInSeconds": 30,
										"secureOutput": false,
										"secureInput": false
									},
									"userProperties": [],
									"typeProperties": {
										"storedProcedureName": "[dbo].[proc_UpdateAuditLog_Briggs]",
										"storedProcedureParameters": {
											"ConfigTableID": {
												"value": {
													"value": "@item().ID_Full",
													"type": "Expression"
												},
												"type": "Int32"
											},
											"RowsRead": {
												"value": {
													"value": "@activity('Copy_Briggs_Full_ADLS').output.RowsRead",
													"type": "Expression"
												},
												"type": "Int64"
											},
											"Status": {
												"value": "Success",
												"type": "String"
											}
										}
									},
									"linkedServiceName": {
										"referenceName": "DS_MDW_SP",
										"type": "LinkedServiceReference"
									}
								},
								{
									"name": "Success_Audit_Log_New",
									"type": "SqlServerStoredProcedure",
									"dependsOn": [
										{
											"activity": "Copy_Briggs_Full_ADLS_New",
											"dependencyConditions": [
												"Succeeded"
											]
										}
									],
									"policy": {
										"timeout": "7.00:00:00",
										"retry": 0,
										"retryIntervalInSeconds": 30,
										"secureOutput": false,
										"secureInput": false
									},
									"userProperties": [],
									"typeProperties": {
										"storedProcedureName": "[dbo].[proc_UpdateAuditLog_Briggs]",
										"storedProcedureParameters": {
											"ConfigTableID": {
												"value": {
													"value": "@item().ID_Full",
													"type": "Expression"
												},
												"type": "Int32"
											},
											"RowsRead": {
												"value": {
													"value": "@activity('Copy_Briggs_Full_ADLS_New').output.RowsRead",
													"type": "Expression"
												},
												"type": "Int64"
											},
											"Status": {
												"value": "Success",
												"type": "String"
											}
										}
									},
									"linkedServiceName": {
										"referenceName": "DS_MDW_SP",
										"type": "LinkedServiceReference"
									}
								},
								{
									"name": "Failure_Audit_Log",
									"type": "SqlServerStoredProcedure",
									"dependsOn": [
										{
											"activity": "Set variable2",
											"dependencyConditions": [
												"Succeeded"
											]
										}
									],
									"policy": {
										"timeout": "7.00:00:00",
										"retry": 0,
										"retryIntervalInSeconds": 30,
										"secureOutput": false,
										"secureInput": false
									},
									"userProperties": [],
									"typeProperties": {
										"storedProcedureName": "[dbo].[proc_UpdateAuditLog_Briggs]",
										"storedProcedureParameters": {
											"ConfigTableID": {
												"value": {
													"value": "@item().ID_Full",
													"type": "Expression"
												},
												"type": "Int32"
											},
											"RowsRead": {
												"value": null,
												"type": "Int64"
											},
											"Status": {
												"value": {
													"value": "@variables('ErrorMsgFull')",
													"type": "Expression"
												},
												"type": "String"
											}
										}
									},
									"linkedServiceName": {
										"referenceName": "DS_MDW_SP",
										"type": "LinkedServiceReference"
									}
								},
								{
									"name": "Set variable2",
									"type": "SetVariable",
									"dependsOn": [
										{
											"activity": "Copy_Briggs_Full_ADLS",
											"dependencyConditions": [
												"Failed"
											]
										},
										{
											"activity": "Copy_Briggs_Full_ADLS_New",
											"dependencyConditions": [
												"Failed"
											]
										}
									],
									"userProperties": [],
									"typeProperties": {
										"variableName": "ErrorMsgFull",
										"value": {
											"value": "@activity('Copy_Briggs_Full_ADLS').Error.Message",
											"type": "Expression"
										}
									}
								}
							]
						}
					},
					{
						"name": "ForEach_Proc_Inc",
						"type": "ForEach",
						"dependsOn": [
							{
								"activity": "ForEach_Incremental_Load",
								"dependencyConditions": [
									"Succeeded"
								]
							}
						],
						"userProperties": [],
						"typeProperties": {
							"items": {
								"value": "@activity('Lookup1_Incremental').output.value",
								"type": "Expression"
							},
							"batchCount": 5,
							"activities": [
								{
									"name": "Stored procedure1_copy1",
									"type": "SqlServerStoredProcedure",
									"dependsOn": [],
									"policy": {
										"timeout": "7.00:00:00",
										"retry": 0,
										"retryIntervalInSeconds": 30,
										"secureOutput": false,
										"secureInput": false
									},
									"userProperties": [],
									"typeProperties": {
										"storedProcedureName": "[dbo].[USP_Control_Table_LastDate]",
										"storedProcedureParameters": {
											"id_I_F": {
												"value": {
													"value": "@item().ID_Inc",
													"type": "Expression"
												},
												"type": "Int32"
											}
										}
									},
									"linkedServiceName": {
										"referenceName": "DS_MDW_SP",
										"type": "LinkedServiceReference"
									}
								}
							]
						}
					},
					{
						"name": "ForEach_Proc_Full",
						"type": "ForEach",
						"dependsOn": [
							{
								"activity": "ForEach_Full_Load",
								"dependencyConditions": [
									"Succeeded"
								]
							}
						],
						"userProperties": [],
						"typeProperties": {
							"items": {
								"value": "@activity('Lookup2_Full').output.value",
								"type": "Expression"
							},
							"batchCount": 5,
							"activities": [
								{
									"name": "Stored procedure1",
									"type": "SqlServerStoredProcedure",
									"dependsOn": [],
									"policy": {
										"timeout": "7.00:00:00",
										"retry": 0,
										"retryIntervalInSeconds": 30,
										"secureOutput": false,
										"secureInput": false
									},
									"userProperties": [],
									"typeProperties": {
										"storedProcedureName": "[dbo].[USP_Control_Table_LastDate]",
										"storedProcedureParameters": {
											"id_I_F": {
												"value": {
													"value": "@item().ID_Full",
													"type": "Expression"
												},
												"type": "Int32"
											}
										}
									},
									"linkedServiceName": {
										"referenceName": "DS_MDW_SP",
										"type": "LinkedServiceReference"
									}
								}
							]
						}
					},
					{
						"name": "lkp_ExecStartAuditProc",
						"type": "Lookup",
						"dependsOn": [],
						"policy": {
							"timeout": "7.00:00:00",
							"retry": 0,
							"retryIntervalInSeconds": 30,
							"secureOutput": false,
							"secureInput": false
						},
						"userProperties": [],
						"typeProperties": {
							"source": {
								"type": "AzureSqlSource",
								"sqlReaderStoredProcedureName": "[dbo].[proc_StartAuditLog]",
								"storedProcedureParameters": {
									"ConfigTableID": {
										"type": "Int32",
										"value": "-1"
									},
									"DataFactoryName": {
										"type": "String",
										"value": {
											"value": "@pipeline().DataFactory",
											"type": "Expression"
										}
									},
									"ParentAuditID": {
										"type": "Int64",
										"value": "-1"
									},
									"PipelineName": {
										"type": "String",
										"value": {
											"value": "@concat(pipeline().Pipeline,' Parts Source Table Load')",
											"type": "Expression"
										}
									},
									"PipelineRunID": {
										"type": "String",
										"value": {
											"value": "@pipeline().RunId",
											"type": "Expression"
										}
									},
									"PipelineTriggerID": {
										"type": "String",
										"value": {
											"value": "@pipeline().TriggerId",
											"type": "Expression"
										}
									},
									"PipelineTriggerName": {
										"type": "String",
										"value": {
											"value": "@pipeline().TriggerName",
											"type": "Expression"
										}
									},
									"PipelineTriggerType": {
										"type": "String",
										"value": {
											"value": "@pipeline().TriggerType",
											"type": "Expression"
										}
									}
								},
								"queryTimeout": "02:00:00",
								"partitionOption": "None"
							},
							"dataset": {
								"referenceName": "Briggs_MDW",
								"type": "DatasetReference",
								"parameters": {
									"schema_name": "dbo",
									"table_name": "user"
								}
							}
						}
					},
					{
						"name": "Sp_ExecFailureAudit_Full",
						"type": "SqlServerStoredProcedure",
						"dependsOn": [
							{
								"activity": "ForEach_Full_Load",
								"dependencyConditions": [
									"Failed"
								]
							}
						],
						"policy": {
							"timeout": "7.00:00:00",
							"retry": 0,
							"retryIntervalInSeconds": 30,
							"secureOutput": false,
							"secureInput": false
						},
						"userProperties": [],
						"typeProperties": {
							"storedProcedureName": "[dbo].[proc_UpdateAuditLog]",
							"storedProcedureParameters": {
								"AuditID": {
									"value": {
										"value": "@activity('lkp_ExecStartAuditProc').output.firstRow.AuditID",
										"type": "Expression"
									},
									"type": "Int32"
								},
								"DataLakePath": {
									"value": null,
									"type": "String"
								},
								"PipelineRunID": {
									"value": {
										"value": "@pipeline().RunId",
										"type": "Expression"
									},
									"type": "String"
								},
								"RowsRead": {
									"value": null,
									"type": "Int64"
								},
								"Status": {
									"value": "Full Load Failed",
									"type": "String"
								}
							}
						},
						"linkedServiceName": {
							"referenceName": "AzureSqlDatabase1",
							"type": "LinkedServiceReference"
						}
					},
					{
						"name": "Sp_ExecSuccessAudit",
						"type": "SqlServerStoredProcedure",
						"dependsOn": [
							{
								"activity": "ForEach_Proc_Full",
								"dependencyConditions": [
									"Succeeded"
								]
							},
							{
								"activity": "ForEach_Proc_Inc",
								"dependencyConditions": [
									"Succeeded"
								]
							}
						],
						"policy": {
							"timeout": "7.00:00:00",
							"retry": 0,
							"retryIntervalInSeconds": 30,
							"secureOutput": false,
							"secureInput": false
						},
						"userProperties": [],
						"typeProperties": {
							"storedProcedureName": "[dbo].[proc_UpdateAuditLog]",
							"storedProcedureParameters": {
								"AuditID": {
									"value": {
										"value": "@activity('lkp_ExecStartAuditProc').output.firstRow.AuditID",
										"type": "Expression"
									},
									"type": "Int32"
								},
								"DataLakePath": {
									"value": null,
									"type": "String"
								},
								"RowsRead": {
									"value": null,
									"type": "Int64"
								},
								"Status": {
									"value": "Success",
									"type": "String"
								},
								"PipelineRunID": {
									"value": {
										"value": "@pipeline().RunId",
										"type": "Expression"
									},
									"type": "String"
								}
							}
						},
						"linkedServiceName": {
							"referenceName": "AzureSqlDatabase1",
							"type": "LinkedServiceReference"
						}
					},
					{
						"name": "Sp_ExecFailureAudit_Inc",
						"type": "SqlServerStoredProcedure",
						"dependsOn": [
							{
								"activity": "ForEach_Incremental_Load",
								"dependencyConditions": [
									"Failed"
								]
							}
						],
						"policy": {
							"timeout": "7.00:00:00",
							"retry": 0,
							"retryIntervalInSeconds": 30,
							"secureOutput": false,
							"secureInput": false
						},
						"userProperties": [],
						"typeProperties": {
							"storedProcedureName": "[dbo].[proc_UpdateAuditLog]",
							"storedProcedureParameters": {
								"AuditID": {
									"value": {
										"value": "@activity('lkp_ExecStartAuditProc').output.firstRow.AuditID",
										"type": "Expression"
									},
									"type": "Int32"
								},
								"DataLakePath": {
									"value": null,
									"type": "String"
								},
								"PipelineRunID": {
									"value": {
										"value": "@pipeline().RunId",
										"type": "Expression"
									},
									"type": "String"
								},
								"RowsRead": {
									"value": null,
									"type": "Int64"
								},
								"Status": {
									"value": "Incr Load Failed",
									"type": "String"
								}
							}
						},
						"linkedServiceName": {
							"referenceName": "AzureSqlDatabase1",
							"type": "LinkedServiceReference"
						}
					}
				],
				"policy": {
					"elapsedTimeMetric": {},
					"cancelAfter": {}
				},
				"variables": {
					"ErrorMsgInc": {
						"type": "String"
					},
					"ErrorMsgFull": {
						"type": "String"
					}
				},
				"folder": {
					"name": "Briggs Data Load Theme wise"
				},
				"annotations": [],
				"lastPublishTime": "2022-04-26T07:45:10Z"
			},
			"dependsOn": [
				"[concat(variables('workspaceId'), '/datasets/Briggs_MDW')]",
				"[concat(variables('workspaceId'), '/linkedServices/AzureSqlDatabase1')]",
				"[concat(variables('workspaceId'), '/datasets/DS_Briggs_MST')]",
				"[concat(variables('workspaceId'), '/linkedServices/DS_MDW_SP')]"
			]
		},
		{
			"name": "[concat(parameters('workspaceName'), '/PL_Generic_Copy_Rental')]",
			"type": "Microsoft.Synapse/workspaces/pipelines",
			"apiVersion": "2019-06-01-preview",
			"properties": {
				"activities": [
					{
						"name": "Lookup1_Incremental",
						"type": "Lookup",
						"dependsOn": [
							{
								"activity": "lkp_ExecStartAuditProc",
								"dependencyConditions": [
									"Succeeded"
								]
							}
						],
						"policy": {
							"timeout": "7.00:00:00",
							"retry": 0,
							"retryIntervalInSeconds": 30,
							"secureOutput": false,
							"secureInput": false
						},
						"userProperties": [],
						"typeProperties": {
							"source": {
								"type": "AzureSqlSource",
								"sqlReaderQuery": "Select Distinct ID ID_Inc,sourcedb,sourcetablename From dbo.control_table Where ProcessName = 'AzSQL_ADLS'  \nAND DataLoadType = 'Incremental'  and EnableAction = 1  \nand (format(refresh_date,'dd-MM-yyyy') <> format(getdate(),'dd-MM-yyyy') or refresh_date is null)\nand subjectarea like '%Sales Rental%' and id <> 253 \norder by 1 ",
								"queryTimeout": "02:00:00",
								"partitionOption": "None"
							},
							"dataset": {
								"referenceName": "Briggs_MDW",
								"type": "DatasetReference",
								"parameters": {
									"schema_name": "dbo",
									"table_name": "user"
								}
							},
							"firstRowOnly": false
						}
					},
					{
						"name": "Lookup2_Full",
						"type": "Lookup",
						"dependsOn": [
							{
								"activity": "lkp_ExecStartAuditProc",
								"dependencyConditions": [
									"Succeeded"
								]
							}
						],
						"policy": {
							"timeout": "7.00:00:00",
							"retry": 0,
							"retryIntervalInSeconds": 30,
							"secureOutput": false,
							"secureInput": false
						},
						"userProperties": [],
						"typeProperties": {
							"source": {
								"type": "AzureSqlSource",
								"sqlReaderQuery": "Select Distinct ID ID_Full,sourcedb,sourcetablename From dbo.control_table Where ProcessName = 'AzSQL_ADLS'  \nAND DataLoadType = 'Full'  and EnableAction = 1 \nand (format(refresh_date,'dd-MM-yyyy') <> format(getdate(),'dd-MM-yyyy') or refresh_date is null)\nand subjectarea like '%Sales Rental%' \norder by 1 ",
								"queryTimeout": "02:00:00",
								"partitionOption": "None"
							},
							"dataset": {
								"referenceName": "Briggs_MDW",
								"type": "DatasetReference",
								"parameters": {
									"schema_name": "dbo",
									"table_name": "user"
								}
							},
							"firstRowOnly": false
						}
					},
					{
						"name": "ForEach_Incremental_Load",
						"type": "ForEach",
						"dependsOn": [
							{
								"activity": "Lookup1_Incremental",
								"dependencyConditions": [
									"Succeeded"
								]
							}
						],
						"userProperties": [],
						"typeProperties": {
							"items": {
								"value": "@activity('Lookup1_Incremental').output.value",
								"type": "Expression"
							},
							"activities": [
								{
									"name": "Lookup_Incremental",
									"type": "Lookup",
									"dependsOn": [],
									"policy": {
										"timeout": "7.00:00:00",
										"retry": 0,
										"retryIntervalInSeconds": 30,
										"secureOutput": false,
										"secureInput": false
									},
									"userProperties": [],
									"typeProperties": {
										"source": {
											"type": "AzureSqlSource",
											"sqlReaderQuery": {
												"value": "@concat('select SourceQuery=''select '' +columnList+ '' from ''+ sourceDB+''.''+SourceSchemaName+''.''+SourcetableName + '' where \ncast(''+DateField+'' as date) >=''''''+LastDate+''''''''\n,SourceDB\n,TargetContainer\n, TargetPath, TargetFile, FileFormat,DateField,LastDate,targetstagetableschema,targetstagetablename\nfrom dbo.control_table\nwhere ID= ',item().ID_Inc)",
												"type": "Expression"
											},
											"queryTimeout": "02:00:00",
											"partitionOption": "None"
										},
										"dataset": {
											"referenceName": "Briggs_MDW",
											"type": "DatasetReference",
											"parameters": {
												"schema_name": "dbo",
												"table_name": "user"
											}
										}
									}
								},
								{
									"name": "Copy_Briggs_Inc_ADLS",
									"type": "Copy",
									"dependsOn": [
										{
											"activity": "Start_Table_Audit1",
											"dependencyConditions": [
												"Succeeded"
											]
										}
									],
									"policy": {
										"timeout": "7.00:00:00",
										"retry": 0,
										"retryIntervalInSeconds": 30,
										"secureOutput": false,
										"secureInput": false
									},
									"userProperties": [],
									"typeProperties": {
										"source": {
											"type": "SqlServerSource",
											"sqlReaderQuery": {
												"value": "@activity('Lookup_Incremental').output.firstRow.SourceQuery\n",
												"type": "Expression"
											},
											"queryTimeout": "02:00:00",
											"partitionOption": "None"
										},
										"sink": {
											"type": "AzureSqlSink",
											"preCopyScript": {
												"value": "@{concat('delete from ',activity('Lookup_Incremental').output.firstRow.TargetStageTableSchema,'.',activity('Lookup_Incremental').output.firstRow.targetstagetablename,' where cast(',activity('Lookup_Incremental').output.firstRow.DateField,' as date)=','''',activity('Lookup_Incremental').output.firstRow.LastDate,'''')}",
												"type": "Expression"
											},
											"disableMetricsCollection": false
										},
										"enableStaging": false,
										"translator": {
											"type": "TabularTranslator",
											"typeConversion": true,
											"typeConversionSettings": {
												"allowDataTruncation": true,
												"treatBooleanAsNumber": false
											}
										}
									},
									"inputs": [
										{
											"referenceName": "DS_Briggs_MST",
											"type": "DatasetReference",
											"parameters": {}
										}
									],
									"outputs": [
										{
											"referenceName": "Briggs_MDW",
											"type": "DatasetReference",
											"parameters": {
												"schema_name": {
													"value": "@activity('Lookup_Incremental').output.firstRow.TargetStageTableSchema",
													"type": "Expression"
												},
												"table_name": {
													"value": "@activity('Lookup_Incremental').output.firstRow.TargetStageTableName",
													"type": "Expression"
												}
											}
										}
									]
								},
								{
									"name": "Copy_Briggs_Inc_ADLS_New",
									"type": "Copy",
									"dependsOn": [
										{
											"activity": "Copy_Briggs_Inc_ADLS",
											"dependencyConditions": [
												"Failed"
											]
										}
									],
									"policy": {
										"timeout": "7.00:00:00",
										"retry": 0,
										"retryIntervalInSeconds": 30,
										"secureOutput": false,
										"secureInput": false
									},
									"userProperties": [],
									"typeProperties": {
										"source": {
											"type": "SqlServerSource",
											"sqlReaderQuery": {
												"value": "@activity('Lookup_Incremental').output.firstRow.SourceQuery\n",
												"type": "Expression"
											},
											"queryTimeout": "02:00:00",
											"partitionOption": "None"
										},
										"sink": {
											"type": "AzureSqlSink",
											"writeBehavior": "insert",
											"sqlWriterUseTableLock": false,
											"tableOption": "autoCreate",
											"disableMetricsCollection": false
										},
										"enableStaging": false,
										"translator": {
											"type": "TabularTranslator",
											"typeConversion": true,
											"typeConversionSettings": {
												"allowDataTruncation": true,
												"treatBooleanAsNumber": false
											}
										}
									},
									"inputs": [
										{
											"referenceName": "DS_Briggs_MST",
											"type": "DatasetReference",
											"parameters": {}
										}
									],
									"outputs": [
										{
											"referenceName": "Briggs_MDW",
											"type": "DatasetReference",
											"parameters": {
												"schema_name": {
													"value": "@activity('Lookup_Incremental').output.firstRow.TargetStageTableSchema",
													"type": "Expression"
												},
												"table_name": {
													"value": "@activity('Lookup_Incremental').output.firstRow.TargetStageTableName",
													"type": "Expression"
												}
											}
										}
									]
								},
								{
									"name": "Start_Table_Audit1",
									"type": "Lookup",
									"dependsOn": [
										{
											"activity": "Lookup_Incremental",
											"dependencyConditions": [
												"Succeeded"
											]
										}
									],
									"policy": {
										"timeout": "7.00:00:00",
										"retry": 0,
										"retryIntervalInSeconds": 30,
										"secureOutput": false,
										"secureInput": false
									},
									"userProperties": [],
									"typeProperties": {
										"source": {
											"type": "AzureSqlSource",
											"sqlReaderStoredProcedureName": "[dbo].[proc_StartAuditLog_Briggs]",
											"storedProcedureParameters": {
												"ConfigTableID": {
													"type": "Int32",
													"value": {
														"value": "@item().ID_Inc",
														"type": "Expression"
													}
												},
												"DataFactoryName": {
													"type": "String",
													"value": {
														"value": "@pipeline().DataFactory",
														"type": "Expression"
													}
												},
												"ParentAuditID": {
													"type": "Int64",
													"value": {
														"value": "@item().ID_Inc",
														"type": "Expression"
													}
												},
												"PipelineName": {
													"type": "String",
													"value": {
														"value": "@pipeline().Pipeline",
														"type": "Expression"
													}
												},
												"PipelineRunID": {
													"type": "String",
													"value": {
														"value": "@pipeline().RunId",
														"type": "Expression"
													}
												},
												"PipelineTriggerID": {
													"type": "String",
													"value": {
														"value": "@pipeline().TriggerId",
														"type": "Expression"
													}
												},
												"PipelineTriggerName": {
													"type": "String",
													"value": {
														"value": "@pipeline().TriggerName",
														"type": "Expression"
													}
												},
												"PipelineTriggerType": {
													"type": "String",
													"value": {
														"value": "@pipeline().TriggerType",
														"type": "Expression"
													}
												},
												"Sourcedb": {
													"type": "String",
													"value": {
														"value": "@item().sourceDB",
														"type": "Expression"
													}
												},
												"sourcetable": {
													"type": "String",
													"value": {
														"value": "@item().SourcetableName",
														"type": "Expression"
													}
												}
											},
											"queryTimeout": "02:00:00",
											"partitionOption": "None"
										},
										"dataset": {
											"referenceName": "Briggs_MDW",
											"type": "DatasetReference",
											"parameters": {
												"schema_name": "dbo",
												"table_name": "user"
											}
										},
										"firstRowOnly": false
									}
								},
								{
									"name": "Success_Audit_Log1",
									"type": "SqlServerStoredProcedure",
									"dependsOn": [
										{
											"activity": "Copy_Briggs_Inc_ADLS",
											"dependencyConditions": [
												"Succeeded"
											]
										}
									],
									"policy": {
										"timeout": "7.00:00:00",
										"retry": 0,
										"retryIntervalInSeconds": 30,
										"secureOutput": false,
										"secureInput": false
									},
									"userProperties": [],
									"typeProperties": {
										"storedProcedureName": "[dbo].[proc_UpdateAuditLog_Briggs]",
										"storedProcedureParameters": {
											"ConfigTableID": {
												"value": {
													"value": "@item().ID_Inc",
													"type": "Expression"
												},
												"type": "Int32"
											},
											"RowsRead": {
												"value": {
													"value": "@activity('Copy_Briggs_Inc_ADLS').output.RowsRead",
													"type": "Expression"
												},
												"type": "Int64"
											},
											"Status": {
												"value": "Success",
												"type": "String"
											}
										}
									},
									"linkedServiceName": {
										"referenceName": "DS_MDW_SP",
										"type": "LinkedServiceReference"
									}
								},
								{
									"name": "Success_Audit_Log2",
									"type": "SqlServerStoredProcedure",
									"dependsOn": [
										{
											"activity": "Copy_Briggs_Inc_ADLS_New",
											"dependencyConditions": [
												"Succeeded"
											]
										}
									],
									"policy": {
										"timeout": "7.00:00:00",
										"retry": 0,
										"retryIntervalInSeconds": 30,
										"secureOutput": false,
										"secureInput": false
									},
									"userProperties": [],
									"typeProperties": {
										"storedProcedureName": "[dbo].[proc_UpdateAuditLog_Briggs]",
										"storedProcedureParameters": {
											"ConfigTableID": {
												"value": {
													"value": "@item().ID_Inc",
													"type": "Expression"
												},
												"type": "Int32"
											},
											"RowsRead": {
												"value": {
													"value": "@activity('Copy_Briggs_Inc_ADLS_New').output.RowsRead",
													"type": "Expression"
												},
												"type": "Int64"
											},
											"Status": {
												"value": "Success",
												"type": "String"
											}
										}
									},
									"linkedServiceName": {
										"referenceName": "DS_MDW_SP",
										"type": "LinkedServiceReference"
									}
								},
								{
									"name": "Failure_Audit_Log2",
									"type": "SqlServerStoredProcedure",
									"dependsOn": [
										{
											"activity": "Set variable1",
											"dependencyConditions": [
												"Succeeded"
											]
										}
									],
									"policy": {
										"timeout": "7.00:00:00",
										"retry": 0,
										"retryIntervalInSeconds": 30,
										"secureOutput": false,
										"secureInput": false
									},
									"userProperties": [],
									"typeProperties": {
										"storedProcedureName": "[dbo].[proc_UpdateAuditLog_Briggs]",
										"storedProcedureParameters": {
											"ConfigTableID": {
												"value": {
													"value": "@item().ID_Inc",
													"type": "Expression"
												},
												"type": "Int32"
											},
											"RowsRead": {
												"value": null,
												"type": "Int64"
											},
											"Status": {
												"value": {
													"value": "@variables('ErrorMsgInc')",
													"type": "Expression"
												},
												"type": "String"
											}
										}
									},
									"linkedServiceName": {
										"referenceName": "DS_MDW_SP",
										"type": "LinkedServiceReference"
									}
								},
								{
									"name": "Set variable1",
									"type": "SetVariable",
									"dependsOn": [
										{
											"activity": "Copy_Briggs_Inc_ADLS_New",
											"dependencyConditions": [
												"Failed"
											]
										},
										{
											"activity": "Copy_Briggs_Inc_ADLS",
											"dependencyConditions": [
												"Failed"
											]
										}
									],
									"userProperties": [],
									"typeProperties": {
										"variableName": "ErrorMsgInc",
										"value": {
											"value": "@activity('Copy_Briggs_Inc_ADLS').Error.Message",
											"type": "Expression"
										}
									}
								}
							]
						}
					},
					{
						"name": "ForEach_Full_Load",
						"type": "ForEach",
						"dependsOn": [
							{
								"activity": "Lookup2_Full",
								"dependencyConditions": [
									"Succeeded"
								]
							}
						],
						"userProperties": [],
						"typeProperties": {
							"items": {
								"value": "@activity('Lookup2_Full').output.value",
								"type": "Expression"
							},
							"activities": [
								{
									"name": "Lookup_Full",
									"type": "Lookup",
									"dependsOn": [],
									"policy": {
										"timeout": "7.00:00:00",
										"retry": 0,
										"retryIntervalInSeconds": 30,
										"secureOutput": false,
										"secureInput": false
									},
									"userProperties": [],
									"typeProperties": {
										"source": {
											"type": "AzureSqlSource",
											"sqlReaderQuery": {
												"value": "@concat('select SourceQuery=''select '' +columnList+ '' from ''+ sourceDB+''.''+SourceSchemaName+''.''+SourcetableName\n,SourceDB\n,TargetContainer\n, TargetPath, TargetFile, FileFormat,DateField,LastDate,targetstagetableschema,targetstagetablename\nfrom dbo.control_table\nwhere ID= ',item().ID_Full)",
												"type": "Expression"
											},
											"queryTimeout": "02:00:00",
											"partitionOption": "None"
										},
										"dataset": {
											"referenceName": "Briggs_MDW",
											"type": "DatasetReference",
											"parameters": {
												"schema_name": "dbo",
												"table_name": "user"
											}
										}
									}
								},
								{
									"name": "Copy_Briggs_Full_ADLS",
									"type": "Copy",
									"dependsOn": [
										{
											"activity": "Start_Table_Audit",
											"dependencyConditions": [
												"Succeeded"
											]
										}
									],
									"policy": {
										"timeout": "7.00:00:00",
										"retry": 0,
										"retryIntervalInSeconds": 30,
										"secureOutput": false,
										"secureInput": false
									},
									"userProperties": [],
									"typeProperties": {
										"source": {
											"type": "SqlServerSource",
											"sqlReaderQuery": {
												"value": "@activity('Lookup_Full').output.firstRow.SourceQuery\n",
												"type": "Expression"
											},
											"queryTimeout": "02:00:00",
											"partitionOption": "None"
										},
										"sink": {
											"type": "AzureSqlSink",
											"preCopyScript": {
												"value": "@{concat('truncate table ',activity('Lookup_Full').output.firstRow.TargetStageTableSchema,'.',activity('Lookup_Full').output.firstRow.TargetStageTableName)}",
												"type": "Expression"
											},
											"disableMetricsCollection": false
										},
										"enableStaging": false,
										"translator": {
											"type": "TabularTranslator",
											"typeConversion": true,
											"typeConversionSettings": {
												"allowDataTruncation": true,
												"treatBooleanAsNumber": false
											}
										}
									},
									"inputs": [
										{
											"referenceName": "DS_Briggs_MST",
											"type": "DatasetReference",
											"parameters": {}
										}
									],
									"outputs": [
										{
											"referenceName": "Briggs_MDW",
											"type": "DatasetReference",
											"parameters": {
												"schema_name": {
													"value": "@activity('Lookup_Full').output.firstRow.TargetStageTableSchema",
													"type": "Expression"
												},
												"table_name": {
													"value": "@activity('Lookup_Full').output.firstRow.TargetStageTableName",
													"type": "Expression"
												}
											}
										}
									]
								},
								{
									"name": "Copy_Briggs_Full_ADLS_New",
									"type": "Copy",
									"dependsOn": [
										{
											"activity": "Copy_Briggs_Full_ADLS",
											"dependencyConditions": [
												"Failed"
											]
										}
									],
									"policy": {
										"timeout": "7.00:00:00",
										"retry": 0,
										"retryIntervalInSeconds": 30,
										"secureOutput": false,
										"secureInput": false
									},
									"userProperties": [],
									"typeProperties": {
										"source": {
											"type": "SqlServerSource",
											"sqlReaderQuery": {
												"value": "@activity('Lookup_Full').output.firstRow.SourceQuery\n",
												"type": "Expression"
											},
											"queryTimeout": "02:00:00",
											"partitionOption": "None"
										},
										"sink": {
											"type": "AzureSqlSink",
											"writeBehavior": "insert",
											"sqlWriterUseTableLock": false,
											"tableOption": "autoCreate",
											"disableMetricsCollection": false
										},
										"enableStaging": false,
										"translator": {
											"type": "TabularTranslator",
											"typeConversion": true,
											"typeConversionSettings": {
												"allowDataTruncation": true,
												"treatBooleanAsNumber": false
											}
										}
									},
									"inputs": [
										{
											"referenceName": "DS_Briggs_MST",
											"type": "DatasetReference",
											"parameters": {}
										}
									],
									"outputs": [
										{
											"referenceName": "Briggs_MDW",
											"type": "DatasetReference",
											"parameters": {
												"schema_name": {
													"value": "@activity('Lookup_Full').output.firstRow.TargetStageTableSchema",
													"type": "Expression"
												},
												"table_name": {
													"value": "@activity('Lookup_Full').output.firstRow.TargetStageTableName",
													"type": "Expression"
												}
											}
										}
									]
								},
								{
									"name": "Start_Table_Audit",
									"type": "Lookup",
									"dependsOn": [
										{
											"activity": "Lookup_Full",
											"dependencyConditions": [
												"Succeeded"
											]
										}
									],
									"policy": {
										"timeout": "7.00:00:00",
										"retry": 0,
										"retryIntervalInSeconds": 30,
										"secureOutput": false,
										"secureInput": false
									},
									"userProperties": [],
									"typeProperties": {
										"source": {
											"type": "AzureSqlSource",
											"sqlReaderStoredProcedureName": "[dbo].[proc_StartAuditLog_Briggs]",
											"storedProcedureParameters": {
												"ConfigTableID": {
													"type": "Int32",
													"value": {
														"value": "@item().ID_Full",
														"type": "Expression"
													}
												},
												"DataFactoryName": {
													"type": "String",
													"value": {
														"value": "@pipeline().DataFactory",
														"type": "Expression"
													}
												},
												"ParentAuditID": {
													"type": "Int64",
													"value": {
														"value": "@item().ID_Full",
														"type": "Expression"
													}
												},
												"PipelineName": {
													"type": "String",
													"value": {
														"value": "@pipeline().Pipeline",
														"type": "Expression"
													}
												},
												"PipelineRunID": {
													"type": "String",
													"value": {
														"value": "@pipeline().RunId",
														"type": "Expression"
													}
												},
												"PipelineTriggerID": {
													"type": "String",
													"value": {
														"value": "@pipeline().TriggerId",
														"type": "Expression"
													}
												},
												"PipelineTriggerName": {
													"type": "String",
													"value": {
														"value": "@pipeline().TriggerName",
														"type": "Expression"
													}
												},
												"PipelineTriggerType": {
													"type": "String",
													"value": {
														"value": "@pipeline().TriggerType",
														"type": "Expression"
													}
												},
												"Sourcedb": {
													"type": "String",
													"value": {
														"value": "@item().sourceDB",
														"type": "Expression"
													}
												},
												"sourcetable": {
													"type": "String",
													"value": {
														"value": "@item().SourcetableName",
														"type": "Expression"
													}
												}
											},
											"queryTimeout": "02:00:00",
											"partitionOption": "None"
										},
										"dataset": {
											"referenceName": "Briggs_MDW",
											"type": "DatasetReference",
											"parameters": {
												"schema_name": "dbo",
												"table_name": "user"
											}
										},
										"firstRowOnly": false
									}
								},
								{
									"name": "Success_Audit_Log",
									"type": "SqlServerStoredProcedure",
									"dependsOn": [
										{
											"activity": "Copy_Briggs_Full_ADLS",
											"dependencyConditions": [
												"Succeeded"
											]
										}
									],
									"policy": {
										"timeout": "7.00:00:00",
										"retry": 0,
										"retryIntervalInSeconds": 30,
										"secureOutput": false,
										"secureInput": false
									},
									"userProperties": [],
									"typeProperties": {
										"storedProcedureName": "[dbo].[proc_UpdateAuditLog_Briggs]",
										"storedProcedureParameters": {
											"ConfigTableID": {
												"value": {
													"value": "@item().ID_Full",
													"type": "Expression"
												},
												"type": "Int32"
											},
											"RowsRead": {
												"value": {
													"value": "@activity('Copy_Briggs_Full_ADLS').output.RowsRead",
													"type": "Expression"
												},
												"type": "Int64"
											},
											"Status": {
												"value": "Success",
												"type": "String"
											}
										}
									},
									"linkedServiceName": {
										"referenceName": "DS_MDW_SP",
										"type": "LinkedServiceReference"
									}
								},
								{
									"name": "Success_Audit_Log_New",
									"type": "SqlServerStoredProcedure",
									"dependsOn": [
										{
											"activity": "Copy_Briggs_Full_ADLS_New",
											"dependencyConditions": [
												"Succeeded"
											]
										}
									],
									"policy": {
										"timeout": "7.00:00:00",
										"retry": 0,
										"retryIntervalInSeconds": 30,
										"secureOutput": false,
										"secureInput": false
									},
									"userProperties": [],
									"typeProperties": {
										"storedProcedureName": "[dbo].[proc_UpdateAuditLog_Briggs]",
										"storedProcedureParameters": {
											"ConfigTableID": {
												"value": {
													"value": "@item().ID_Full",
													"type": "Expression"
												},
												"type": "Int32"
											},
											"RowsRead": {
												"value": {
													"value": "@activity('Copy_Briggs_Full_ADLS_New').output.RowsRead",
													"type": "Expression"
												},
												"type": "Int64"
											},
											"Status": {
												"value": "Success",
												"type": "String"
											}
										}
									},
									"linkedServiceName": {
										"referenceName": "DS_MDW_SP",
										"type": "LinkedServiceReference"
									}
								},
								{
									"name": "Failure_Audit_Log_New",
									"type": "SqlServerStoredProcedure",
									"dependsOn": [
										{
											"activity": "Set variable2",
											"dependencyConditions": [
												"Succeeded"
											]
										}
									],
									"policy": {
										"timeout": "7.00:00:00",
										"retry": 0,
										"retryIntervalInSeconds": 30,
										"secureOutput": false,
										"secureInput": false
									},
									"userProperties": [],
									"typeProperties": {
										"storedProcedureName": "[dbo].[proc_UpdateAuditLog_Briggs]",
										"storedProcedureParameters": {
											"ConfigTableID": {
												"value": {
													"value": "@item().ID_Full",
													"type": "Expression"
												},
												"type": "Int32"
											},
											"RowsRead": {
												"value": null,
												"type": "Int64"
											},
											"Status": {
												"value": {
													"value": "@variables('ErrorMsgFull')",
													"type": "Expression"
												},
												"type": "String"
											}
										}
									},
									"linkedServiceName": {
										"referenceName": "DS_MDW_SP",
										"type": "LinkedServiceReference"
									}
								},
								{
									"name": "Set variable2",
									"type": "SetVariable",
									"dependsOn": [
										{
											"activity": "Copy_Briggs_Full_ADLS_New",
											"dependencyConditions": [
												"Failed"
											]
										},
										{
											"activity": "Copy_Briggs_Full_ADLS",
											"dependencyConditions": [
												"Failed"
											]
										}
									],
									"userProperties": [],
									"typeProperties": {
										"variableName": "ErrorMsgFull",
										"value": {
											"value": "@activity('Copy_Briggs_Full_ADLS').Error.Message",
											"type": "Expression"
										}
									}
								}
							]
						}
					},
					{
						"name": "ForEach_Incremental_Proc",
						"type": "ForEach",
						"dependsOn": [
							{
								"activity": "ForEach_Incremental_Load",
								"dependencyConditions": [
									"Succeeded"
								]
							}
						],
						"userProperties": [],
						"typeProperties": {
							"items": {
								"value": "@activity('Lookup1_Incremental').output.value",
								"type": "Expression"
							},
							"batchCount": 5,
							"activities": [
								{
									"name": "Stored procedure1",
									"type": "SqlServerStoredProcedure",
									"dependsOn": [],
									"policy": {
										"timeout": "7.00:00:00",
										"retry": 0,
										"retryIntervalInSeconds": 30,
										"secureOutput": false,
										"secureInput": false
									},
									"userProperties": [],
									"typeProperties": {
										"storedProcedureName": "[dbo].[USP_Control_Table_LastDate]",
										"storedProcedureParameters": {
											"id_I_F": {
												"value": {
													"value": "@item().ID_Inc",
													"type": "Expression"
												},
												"type": "Int32"
											}
										}
									},
									"linkedServiceName": {
										"referenceName": "DS_MDW_SP",
										"type": "LinkedServiceReference"
									}
								}
							]
						}
					},
					{
						"name": "ForEach_Full_Proc",
						"type": "ForEach",
						"dependsOn": [
							{
								"activity": "ForEach_Full_Load",
								"dependencyConditions": [
									"Succeeded"
								]
							}
						],
						"userProperties": [],
						"typeProperties": {
							"items": {
								"value": "@activity('Lookup2_Full').output.value",
								"type": "Expression"
							},
							"batchCount": 5,
							"activities": [
								{
									"name": "Stored procedure_Full",
									"type": "SqlServerStoredProcedure",
									"dependsOn": [],
									"policy": {
										"timeout": "7.00:00:00",
										"retry": 0,
										"retryIntervalInSeconds": 30,
										"secureOutput": false,
										"secureInput": false
									},
									"userProperties": [],
									"typeProperties": {
										"storedProcedureName": "[dbo].[USP_Control_Table_LastDate]",
										"storedProcedureParameters": {
											"id_I_F": {
												"value": {
													"value": "@item().ID_Full",
													"type": "Expression"
												},
												"type": "Int32"
											}
										}
									},
									"linkedServiceName": {
										"referenceName": "DS_MDW_SP",
										"type": "LinkedServiceReference"
									}
								}
							]
						}
					},
					{
						"name": "lkp_ExecStartAuditProc",
						"type": "Lookup",
						"dependsOn": [],
						"policy": {
							"timeout": "7.00:00:00",
							"retry": 0,
							"retryIntervalInSeconds": 30,
							"secureOutput": false,
							"secureInput": false
						},
						"userProperties": [],
						"typeProperties": {
							"source": {
								"type": "AzureSqlSource",
								"sqlReaderStoredProcedureName": "[dbo].[proc_StartAuditLog]",
								"storedProcedureParameters": {
									"ConfigTableID": {
										"type": "Int32",
										"value": "-1"
									},
									"DataFactoryName": {
										"type": "String",
										"value": {
											"value": "@pipeline().DataFactory",
											"type": "Expression"
										}
									},
									"ParentAuditID": {
										"type": "Int64",
										"value": "-1"
									},
									"PipelineName": {
										"type": "String",
										"value": {
											"value": "@concat(pipeline().Pipeline,' Rental Source Table Load')",
											"type": "Expression"
										}
									},
									"PipelineRunID": {
										"type": "String",
										"value": {
											"value": "@pipeline().RunId",
											"type": "Expression"
										}
									},
									"PipelineTriggerID": {
										"type": "String",
										"value": {
											"value": "@pipeline().TriggerId",
											"type": "Expression"
										}
									},
									"PipelineTriggerName": {
										"type": "String",
										"value": {
											"value": "@pipeline().TriggerName",
											"type": "Expression"
										}
									},
									"PipelineTriggerType": {
										"type": "String",
										"value": {
											"value": "@pipeline().TriggerType",
											"type": "Expression"
										}
									}
								},
								"queryTimeout": "02:00:00",
								"partitionOption": "None"
							},
							"dataset": {
								"referenceName": "Briggs_MDW",
								"type": "DatasetReference",
								"parameters": {
									"schema_name": "dbo",
									"table_name": "user"
								}
							}
						}
					},
					{
						"name": "Sp_ExecFailureAudit_Full",
						"type": "SqlServerStoredProcedure",
						"dependsOn": [
							{
								"activity": "ForEach_Full_Load",
								"dependencyConditions": [
									"Failed"
								]
							}
						],
						"policy": {
							"timeout": "7.00:00:00",
							"retry": 0,
							"retryIntervalInSeconds": 30,
							"secureOutput": false,
							"secureInput": false
						},
						"userProperties": [],
						"typeProperties": {
							"storedProcedureName": "[dbo].[proc_UpdateAuditLog]",
							"storedProcedureParameters": {
								"AuditID": {
									"value": {
										"value": "@activity('lkp_ExecStartAuditProc').output.firstRow.AuditID",
										"type": "Expression"
									},
									"type": "Int32"
								},
								"DataLakePath": {
									"value": null,
									"type": "String"
								},
								"PipelineRunID": {
									"value": {
										"value": "@pipeline().RunId",
										"type": "Expression"
									},
									"type": "String"
								},
								"RowsRead": {
									"value": null,
									"type": "Int64"
								},
								"Status": {
									"value": "Full Load Failed",
									"type": "String"
								}
							}
						},
						"linkedServiceName": {
							"referenceName": "AzureSqlDatabase1",
							"type": "LinkedServiceReference"
						}
					},
					{
						"name": "Sp_ExecSuccessAudit",
						"type": "SqlServerStoredProcedure",
						"dependsOn": [
							{
								"activity": "ForEach_Incremental_Proc",
								"dependencyConditions": [
									"Succeeded"
								]
							},
							{
								"activity": "ForEach_Full_Proc",
								"dependencyConditions": [
									"Succeeded"
								]
							}
						],
						"policy": {
							"timeout": "7.00:00:00",
							"retry": 0,
							"retryIntervalInSeconds": 30,
							"secureOutput": false,
							"secureInput": false
						},
						"userProperties": [],
						"typeProperties": {
							"storedProcedureName": "[dbo].[proc_UpdateAuditLog]",
							"storedProcedureParameters": {
								"AuditID": {
									"value": {
										"value": "@activity('lkp_ExecStartAuditProc').output.firstRow.AuditID",
										"type": "Expression"
									},
									"type": "Int32"
								},
								"DataLakePath": {
									"value": null,
									"type": "String"
								},
								"RowsRead": {
									"value": null,
									"type": "Int64"
								},
								"Status": {
									"value": "Success",
									"type": "String"
								},
								"PipelineRunID": {
									"value": {
										"value": "@pipeline().RunId",
										"type": "Expression"
									},
									"type": "String"
								}
							}
						},
						"linkedServiceName": {
							"referenceName": "AzureSqlDatabase1",
							"type": "LinkedServiceReference"
						}
					},
					{
						"name": "Sp_ExecFailureAudit_Inc",
						"type": "SqlServerStoredProcedure",
						"dependsOn": [
							{
								"activity": "ForEach_Incremental_Load",
								"dependencyConditions": [
									"Failed"
								]
							}
						],
						"policy": {
							"timeout": "7.00:00:00",
							"retry": 0,
							"retryIntervalInSeconds": 30,
							"secureOutput": false,
							"secureInput": false
						},
						"userProperties": [],
						"typeProperties": {
							"storedProcedureName": "[dbo].[proc_UpdateAuditLog]",
							"storedProcedureParameters": {
								"AuditID": {
									"value": {
										"value": "@activity('lkp_ExecStartAuditProc').output.firstRow.AuditID",
										"type": "Expression"
									},
									"type": "Int32"
								},
								"DataLakePath": {
									"value": null,
									"type": "String"
								},
								"PipelineRunID": {
									"value": {
										"value": "@pipeline().RunId",
										"type": "Expression"
									},
									"type": "String"
								},
								"RowsRead": {
									"value": null,
									"type": "Int64"
								},
								"Status": {
									"value": "Incr Load Failed",
									"type": "String"
								}
							}
						},
						"linkedServiceName": {
							"referenceName": "AzureSqlDatabase1",
							"type": "LinkedServiceReference"
						}
					}
				],
				"policy": {
					"elapsedTimeMetric": {},
					"cancelAfter": {}
				},
				"variables": {
					"ErrorMsgInc": {
						"type": "String"
					},
					"ErrorMsgFull": {
						"type": "String"
					}
				},
				"folder": {
					"name": "Briggs Data Load Theme wise"
				},
				"annotations": [],
				"lastPublishTime": "2022-04-26T07:45:16Z"
			},
			"dependsOn": [
				"[concat(variables('workspaceId'), '/datasets/Briggs_MDW')]",
				"[concat(variables('workspaceId'), '/linkedServices/AzureSqlDatabase1')]",
				"[concat(variables('workspaceId'), '/datasets/DS_Briggs_MST')]",
				"[concat(variables('workspaceId'), '/linkedServices/DS_MDW_SP')]"
			]
		},
		{
			"name": "[concat(parameters('workspaceName'), '/PL_Generic_Copy_Service')]",
			"type": "Microsoft.Synapse/workspaces/pipelines",
			"apiVersion": "2019-06-01-preview",
			"properties": {
				"activities": [
					{
						"name": "Lookup1_Incremental",
						"type": "Lookup",
						"dependsOn": [
							{
								"activity": "lkp_ExecStartAuditProc",
								"dependencyConditions": [
									"Succeeded"
								]
							}
						],
						"policy": {
							"timeout": "7.00:00:00",
							"retry": 0,
							"retryIntervalInSeconds": 30,
							"secureOutput": false,
							"secureInput": false
						},
						"userProperties": [],
						"typeProperties": {
							"source": {
								"type": "AzureSqlSource",
								"sqlReaderQuery": "Select Distinct ID ID_Inc,sourcedb,sourcetablename From dbo.control_table Where ProcessName = 'AzSQL_ADLS'  \nAND DataLoadType = 'Incremental'  and EnableAction = 1  \nand (format(refresh_date,'dd-MM-yyyy') <> format(getdate(),'dd-MM-yyyy') or refresh_date is null)\nand subjectarea like '%Sales Service%' and id <> 253 \norder by 1 ",
								"queryTimeout": "02:00:00",
								"partitionOption": "None"
							},
							"dataset": {
								"referenceName": "Briggs_MDW",
								"type": "DatasetReference",
								"parameters": {
									"schema_name": "dbo",
									"table_name": "user"
								}
							},
							"firstRowOnly": false
						}
					},
					{
						"name": "Lookup2_Full",
						"type": "Lookup",
						"dependsOn": [
							{
								"activity": "lkp_ExecStartAuditProc",
								"dependencyConditions": [
									"Succeeded"
								]
							}
						],
						"policy": {
							"timeout": "7.00:00:00",
							"retry": 0,
							"retryIntervalInSeconds": 30,
							"secureOutput": false,
							"secureInput": false
						},
						"userProperties": [],
						"typeProperties": {
							"source": {
								"type": "AzureSqlSource",
								"sqlReaderQuery": "Select Distinct ID ID_Full,sourcedb,sourcetablename From dbo.control_table Where ProcessName = 'AzSQL_ADLS'  \nAND DataLoadType = 'Full'  and EnableAction = 1 \nand (format(refresh_date,'dd-MM-yyyy') <> format(getdate(),'dd-MM-yyyy') or refresh_date is null)\nand subjectarea like '%Sales Service%' \norder by 1 ",
								"queryTimeout": "02:00:00",
								"partitionOption": "None"
							},
							"dataset": {
								"referenceName": "Briggs_MDW",
								"type": "DatasetReference",
								"parameters": {
									"schema_name": "dbo",
									"table_name": "user"
								}
							},
							"firstRowOnly": false
						}
					},
					{
						"name": "ForEach_Incremental_Load",
						"type": "ForEach",
						"dependsOn": [
							{
								"activity": "Lookup1_Incremental",
								"dependencyConditions": [
									"Succeeded"
								]
							}
						],
						"userProperties": [],
						"typeProperties": {
							"items": {
								"value": "@activity('Lookup1_Incremental').output.value",
								"type": "Expression"
							},
							"activities": [
								{
									"name": "Lookup_Incremental",
									"type": "Lookup",
									"dependsOn": [],
									"policy": {
										"timeout": "7.00:00:00",
										"retry": 0,
										"retryIntervalInSeconds": 30,
										"secureOutput": false,
										"secureInput": false
									},
									"userProperties": [],
									"typeProperties": {
										"source": {
											"type": "AzureSqlSource",
											"sqlReaderQuery": {
												"value": "@concat('select SourceQuery=''select '' +columnList+ '' from ''+ sourceDB+''.''+SourceSchemaName+''.''+SourcetableName + '' where \ncast(''+DateField+'' as date) >=''''''+LastDate+''''''''\n,SourceDB\n,TargetContainer\n, TargetPath, TargetFile, FileFormat,DateField,LastDate,targetstagetableschema,targetstagetablename\nfrom dbo.control_table\nwhere ID= ',item().ID_Inc)",
												"type": "Expression"
											},
											"queryTimeout": "02:00:00",
											"partitionOption": "None"
										},
										"dataset": {
											"referenceName": "Briggs_MDW",
											"type": "DatasetReference",
											"parameters": {
												"schema_name": "dbo",
												"table_name": "user"
											}
										}
									}
								},
								{
									"name": "Copy_Briggs_Inc_ADLS",
									"type": "Copy",
									"dependsOn": [
										{
											"activity": "Start_Table_Audit1",
											"dependencyConditions": [
												"Succeeded"
											]
										}
									],
									"policy": {
										"timeout": "7.00:00:00",
										"retry": 0,
										"retryIntervalInSeconds": 30,
										"secureOutput": false,
										"secureInput": false
									},
									"userProperties": [],
									"typeProperties": {
										"source": {
											"type": "SqlServerSource",
											"sqlReaderQuery": {
												"value": "@activity('Lookup_Incremental').output.firstRow.SourceQuery\n",
												"type": "Expression"
											},
											"queryTimeout": "02:00:00",
											"partitionOption": "None"
										},
										"sink": {
											"type": "AzureSqlSink",
											"preCopyScript": {
												"value": "@{concat('delete from ',activity('Lookup_Incremental').output.firstRow.TargetStageTableSchema,'.',activity('Lookup_Incremental').output.firstRow.targetstagetablename,' where cast(',activity('Lookup_Incremental').output.firstRow.DateField,' as date)=','''',activity('Lookup_Incremental').output.firstRow.LastDate,'''')}",
												"type": "Expression"
											},
											"writeBehavior": "insert",
											"sqlWriterUseTableLock": false,
											"disableMetricsCollection": false
										},
										"enableStaging": false,
										"translator": {
											"type": "TabularTranslator",
											"typeConversion": true,
											"typeConversionSettings": {
												"allowDataTruncation": true,
												"treatBooleanAsNumber": false
											}
										}
									},
									"inputs": [
										{
											"referenceName": "DS_Briggs_MST",
											"type": "DatasetReference",
											"parameters": {}
										}
									],
									"outputs": [
										{
											"referenceName": "Briggs_MDW",
											"type": "DatasetReference",
											"parameters": {
												"schema_name": {
													"value": "@activity('Lookup_Incremental').output.firstRow.TargetStageTableSchema",
													"type": "Expression"
												},
												"table_name": {
													"value": "@activity('Lookup_Incremental').output.firstRow.TargetStageTableName",
													"type": "Expression"
												}
											}
										}
									]
								},
								{
									"name": "Copy_Briggs_Inc_ADLS_New",
									"type": "Copy",
									"dependsOn": [
										{
											"activity": "Copy_Briggs_Inc_ADLS",
											"dependencyConditions": [
												"Failed"
											]
										}
									],
									"policy": {
										"timeout": "7.00:00:00",
										"retry": 0,
										"retryIntervalInSeconds": 30,
										"secureOutput": false,
										"secureInput": false
									},
									"userProperties": [],
									"typeProperties": {
										"source": {
											"type": "SqlServerSource",
											"sqlReaderQuery": {
												"value": "@activity('Lookup_Incremental').output.firstRow.SourceQuery\n",
												"type": "Expression"
											},
											"queryTimeout": "02:00:00",
											"partitionOption": "None"
										},
										"sink": {
											"type": "AzureSqlSink",
											"writeBehavior": "insert",
											"sqlWriterUseTableLock": false,
											"tableOption": "autoCreate",
											"disableMetricsCollection": false
										},
										"enableStaging": false,
										"translator": {
											"type": "TabularTranslator",
											"typeConversion": true,
											"typeConversionSettings": {
												"allowDataTruncation": true,
												"treatBooleanAsNumber": false
											}
										}
									},
									"inputs": [
										{
											"referenceName": "DS_Briggs_MST",
											"type": "DatasetReference",
											"parameters": {}
										}
									],
									"outputs": [
										{
											"referenceName": "Briggs_MDW",
											"type": "DatasetReference",
											"parameters": {
												"schema_name": {
													"value": "@activity('Lookup_Incremental').output.firstRow.TargetStageTableSchema",
													"type": "Expression"
												},
												"table_name": {
													"value": "@activity('Lookup_Incremental').output.firstRow.TargetStageTableName",
													"type": "Expression"
												}
											}
										}
									]
								},
								{
									"name": "Start_Table_Audit1",
									"type": "Lookup",
									"dependsOn": [
										{
											"activity": "Lookup_Incremental",
											"dependencyConditions": [
												"Succeeded"
											]
										}
									],
									"policy": {
										"timeout": "7.00:00:00",
										"retry": 0,
										"retryIntervalInSeconds": 30,
										"secureOutput": false,
										"secureInput": false
									},
									"userProperties": [],
									"typeProperties": {
										"source": {
											"type": "AzureSqlSource",
											"sqlReaderStoredProcedureName": "[dbo].[proc_StartAuditLog_Briggs]",
											"storedProcedureParameters": {
												"ConfigTableID": {
													"type": "Int32",
													"value": {
														"value": "@item().ID_Inc",
														"type": "Expression"
													}
												},
												"DataFactoryName": {
													"type": "String",
													"value": {
														"value": "@pipeline().DataFactory",
														"type": "Expression"
													}
												},
												"ParentAuditID": {
													"type": "Int64",
													"value": {
														"value": "@item().ID_Inc",
														"type": "Expression"
													}
												},
												"PipelineName": {
													"type": "String",
													"value": {
														"value": "@pipeline().Pipeline",
														"type": "Expression"
													}
												},
												"PipelineRunID": {
													"type": "String",
													"value": {
														"value": "@pipeline().RunId",
														"type": "Expression"
													}
												},
												"PipelineTriggerID": {
													"type": "String",
													"value": {
														"value": "@pipeline().TriggerId",
														"type": "Expression"
													}
												},
												"PipelineTriggerName": {
													"type": "String",
													"value": {
														"value": "@pipeline().TriggerName",
														"type": "Expression"
													}
												},
												"PipelineTriggerType": {
													"type": "String",
													"value": {
														"value": "@pipeline().TriggerType",
														"type": "Expression"
													}
												},
												"Sourcedb": {
													"type": "String",
													"value": {
														"value": "@item().sourceDB",
														"type": "Expression"
													}
												},
												"sourcetable": {
													"type": "String",
													"value": {
														"value": "@item().SourcetableName",
														"type": "Expression"
													}
												}
											},
											"queryTimeout": "02:00:00",
											"partitionOption": "None"
										},
										"dataset": {
											"referenceName": "Briggs_MDW",
											"type": "DatasetReference",
											"parameters": {
												"schema_name": "dbo",
												"table_name": "user"
											}
										},
										"firstRowOnly": false
									}
								},
								{
									"name": "Success_Audit_Log1",
									"type": "SqlServerStoredProcedure",
									"dependsOn": [
										{
											"activity": "Copy_Briggs_Inc_ADLS",
											"dependencyConditions": [
												"Succeeded"
											]
										}
									],
									"policy": {
										"timeout": "7.00:00:00",
										"retry": 0,
										"retryIntervalInSeconds": 30,
										"secureOutput": false,
										"secureInput": false
									},
									"userProperties": [],
									"typeProperties": {
										"storedProcedureName": "[dbo].[proc_UpdateAuditLog_Briggs]",
										"storedProcedureParameters": {
											"ConfigTableID": {
												"value": {
													"value": "@item().ID_Inc",
													"type": "Expression"
												},
												"type": "Int32"
											},
											"RowsRead": {
												"value": {
													"value": "@activity('Copy_Briggs_Inc_ADLS').output.RowsRead",
													"type": "Expression"
												},
												"type": "Int64"
											},
											"Status": {
												"value": "Success",
												"type": "String"
											}
										}
									},
									"linkedServiceName": {
										"referenceName": "DS_MDW_SP",
										"type": "LinkedServiceReference"
									}
								},
								{
									"name": "Success_Audit_Log2",
									"type": "SqlServerStoredProcedure",
									"dependsOn": [
										{
											"activity": "Copy_Briggs_Inc_ADLS_New",
											"dependencyConditions": [
												"Succeeded"
											]
										}
									],
									"policy": {
										"timeout": "7.00:00:00",
										"retry": 0,
										"retryIntervalInSeconds": 30,
										"secureOutput": false,
										"secureInput": false
									},
									"userProperties": [],
									"typeProperties": {
										"storedProcedureName": "[dbo].[proc_UpdateAuditLog_Briggs]",
										"storedProcedureParameters": {
											"ConfigTableID": {
												"value": {
													"value": "@item().ID_Inc",
													"type": "Expression"
												},
												"type": "Int32"
											},
											"RowsRead": {
												"value": {
													"value": "@activity('Copy_Briggs_Inc_ADLS_New').output.RowsRead",
													"type": "Expression"
												},
												"type": "Int64"
											},
											"Status": {
												"value": "Success",
												"type": "String"
											}
										}
									},
									"linkedServiceName": {
										"referenceName": "DS_MDW_SP",
										"type": "LinkedServiceReference"
									}
								},
								{
									"name": "Failure_Audit_Log2",
									"type": "SqlServerStoredProcedure",
									"dependsOn": [
										{
											"activity": "Set variable1",
											"dependencyConditions": [
												"Succeeded"
											]
										}
									],
									"policy": {
										"timeout": "7.00:00:00",
										"retry": 0,
										"retryIntervalInSeconds": 30,
										"secureOutput": false,
										"secureInput": false
									},
									"userProperties": [],
									"typeProperties": {
										"storedProcedureName": "[dbo].[proc_UpdateAuditLog_Briggs]",
										"storedProcedureParameters": {
											"ConfigTableID": {
												"value": {
													"value": "@item().ID_Inc",
													"type": "Expression"
												},
												"type": "Int32"
											},
											"RowsRead": {
												"value": null,
												"type": "Int64"
											},
											"Status": {
												"value": {
													"value": "@variables('ErrorMsgInc')",
													"type": "Expression"
												},
												"type": "String"
											}
										}
									},
									"linkedServiceName": {
										"referenceName": "DS_MDW_SP",
										"type": "LinkedServiceReference"
									}
								},
								{
									"name": "Set variable1",
									"type": "SetVariable",
									"dependsOn": [
										{
											"activity": "Copy_Briggs_Inc_ADLS_New",
											"dependencyConditions": [
												"Failed"
											]
										},
										{
											"activity": "Copy_Briggs_Inc_ADLS",
											"dependencyConditions": [
												"Failed"
											]
										}
									],
									"userProperties": [],
									"typeProperties": {
										"variableName": "ErrorMsgInc",
										"value": {
											"value": "@activity('Copy_Briggs_Inc_ADLS').Error.Message",
											"type": "Expression"
										}
									}
								}
							]
						}
					},
					{
						"name": "ForEach_Full_Load",
						"type": "ForEach",
						"dependsOn": [
							{
								"activity": "Lookup2_Full",
								"dependencyConditions": [
									"Succeeded"
								]
							}
						],
						"userProperties": [],
						"typeProperties": {
							"items": {
								"value": "@activity('Lookup2_Full').output.value",
								"type": "Expression"
							},
							"activities": [
								{
									"name": "Lookup_Full",
									"type": "Lookup",
									"dependsOn": [],
									"policy": {
										"timeout": "7.00:00:00",
										"retry": 0,
										"retryIntervalInSeconds": 30,
										"secureOutput": false,
										"secureInput": false
									},
									"userProperties": [],
									"typeProperties": {
										"source": {
											"type": "AzureSqlSource",
											"sqlReaderQuery": {
												"value": "@concat('select SourceQuery=''select '' +columnList+ '' from ''+ sourceDB+''.''+SourceSchemaName+''.''+SourcetableName\n,SourceDB\n,TargetContainer\n, TargetPath, TargetFile, FileFormat,DateField,LastDate,targetstagetableschema,targetstagetablename\nfrom dbo.control_table\nwhere ID= ',item().ID_Full)",
												"type": "Expression"
											},
											"queryTimeout": "02:00:00",
											"partitionOption": "None"
										},
										"dataset": {
											"referenceName": "Briggs_MDW",
											"type": "DatasetReference",
											"parameters": {
												"schema_name": "dbo",
												"table_name": "user"
											}
										}
									}
								},
								{
									"name": "Copy_Briggs_Full_ADLS",
									"type": "Copy",
									"dependsOn": [
										{
											"activity": "Start_Table_Audit",
											"dependencyConditions": [
												"Succeeded"
											]
										}
									],
									"policy": {
										"timeout": "7.00:00:00",
										"retry": 0,
										"retryIntervalInSeconds": 30,
										"secureOutput": false,
										"secureInput": false
									},
									"userProperties": [],
									"typeProperties": {
										"source": {
											"type": "SqlServerSource",
											"sqlReaderQuery": {
												"value": "@activity('Lookup_Full').output.firstRow.SourceQuery\n",
												"type": "Expression"
											},
											"queryTimeout": "02:00:00",
											"partitionOption": "None"
										},
										"sink": {
											"type": "AzureSqlSink",
											"preCopyScript": {
												"value": "@{concat('truncate table ',activity('Lookup_Full').output.firstRow.TargetStageTableSchema,'.',activity('Lookup_Full').output.firstRow.TargetStageTableName)}",
												"type": "Expression"
											},
											"disableMetricsCollection": false
										},
										"enableStaging": false,
										"translator": {
											"type": "TabularTranslator",
											"typeConversion": true,
											"typeConversionSettings": {
												"allowDataTruncation": true,
												"treatBooleanAsNumber": false
											}
										}
									},
									"inputs": [
										{
											"referenceName": "DS_Briggs_MST",
											"type": "DatasetReference",
											"parameters": {}
										}
									],
									"outputs": [
										{
											"referenceName": "Briggs_MDW",
											"type": "DatasetReference",
											"parameters": {
												"schema_name": {
													"value": "@activity('Lookup_Full').output.firstRow.TargetStageTableSchema",
													"type": "Expression"
												},
												"table_name": {
													"value": "@activity('Lookup_Full').output.firstRow.TargetStageTableName",
													"type": "Expression"
												}
											}
										}
									]
								},
								{
									"name": "Copy_Briggs_Full_ADLS_New",
									"type": "Copy",
									"dependsOn": [
										{
											"activity": "Copy_Briggs_Full_ADLS",
											"dependencyConditions": [
												"Failed"
											]
										}
									],
									"policy": {
										"timeout": "7.00:00:00",
										"retry": 0,
										"retryIntervalInSeconds": 30,
										"secureOutput": false,
										"secureInput": false
									},
									"userProperties": [],
									"typeProperties": {
										"source": {
											"type": "SqlServerSource",
											"sqlReaderQuery": {
												"value": "@activity('Lookup_Full').output.firstRow.SourceQuery\n",
												"type": "Expression"
											},
											"queryTimeout": "02:00:00",
											"partitionOption": "None"
										},
										"sink": {
											"type": "AzureSqlSink",
											"writeBehavior": "insert",
											"sqlWriterUseTableLock": false,
											"tableOption": "autoCreate",
											"disableMetricsCollection": false
										},
										"enableStaging": false,
										"translator": {
											"type": "TabularTranslator",
											"typeConversion": true,
											"typeConversionSettings": {
												"allowDataTruncation": true,
												"treatBooleanAsNumber": false
											}
										}
									},
									"inputs": [
										{
											"referenceName": "DS_Briggs_MST",
											"type": "DatasetReference",
											"parameters": {}
										}
									],
									"outputs": [
										{
											"referenceName": "Briggs_MDW",
											"type": "DatasetReference",
											"parameters": {
												"schema_name": {
													"value": "@activity('Lookup_Full').output.firstRow.TargetStageTableSchema",
													"type": "Expression"
												},
												"table_name": {
													"value": "@activity('Lookup_Full').output.firstRow.TargetStageTableName",
													"type": "Expression"
												}
											}
										}
									]
								},
								{
									"name": "Start_Table_Audit",
									"type": "Lookup",
									"dependsOn": [
										{
											"activity": "Lookup_Full",
											"dependencyConditions": [
												"Succeeded"
											]
										}
									],
									"policy": {
										"timeout": "7.00:00:00",
										"retry": 0,
										"retryIntervalInSeconds": 30,
										"secureOutput": false,
										"secureInput": false
									},
									"userProperties": [],
									"typeProperties": {
										"source": {
											"type": "AzureSqlSource",
											"sqlReaderStoredProcedureName": "[dbo].[proc_StartAuditLog_Briggs]",
											"storedProcedureParameters": {
												"ConfigTableID": {
													"type": "Int32",
													"value": {
														"value": "@item().ID_Full",
														"type": "Expression"
													}
												},
												"DataFactoryName": {
													"type": "String",
													"value": {
														"value": "@pipeline().DataFactory",
														"type": "Expression"
													}
												},
												"ParentAuditID": {
													"type": "Int64",
													"value": {
														"value": "@item().ID_Full",
														"type": "Expression"
													}
												},
												"PipelineName": {
													"type": "String",
													"value": {
														"value": "@pipeline().Pipeline",
														"type": "Expression"
													}
												},
												"PipelineRunID": {
													"type": "String",
													"value": {
														"value": "@pipeline().RunId",
														"type": "Expression"
													}
												},
												"PipelineTriggerID": {
													"type": "String",
													"value": {
														"value": "@pipeline().TriggerId",
														"type": "Expression"
													}
												},
												"PipelineTriggerName": {
													"type": "String",
													"value": {
														"value": "@pipeline().TriggerName",
														"type": "Expression"
													}
												},
												"PipelineTriggerType": {
													"type": "String",
													"value": {
														"value": "@pipeline().TriggerType",
														"type": "Expression"
													}
												},
												"Sourcedb": {
													"type": "String",
													"value": {
														"value": "@item().sourceDB",
														"type": "Expression"
													}
												},
												"sourcetable": {
													"type": "String",
													"value": {
														"value": "@item().SourcetableName",
														"type": "Expression"
													}
												}
											},
											"queryTimeout": "02:00:00",
											"partitionOption": "None"
										},
										"dataset": {
											"referenceName": "Briggs_MDW",
											"type": "DatasetReference",
											"parameters": {
												"schema_name": "dbo",
												"table_name": "user"
											}
										},
										"firstRowOnly": false
									}
								},
								{
									"name": "Success_Audit_Log",
									"type": "SqlServerStoredProcedure",
									"dependsOn": [
										{
											"activity": "Copy_Briggs_Full_ADLS",
											"dependencyConditions": [
												"Succeeded"
											]
										}
									],
									"policy": {
										"timeout": "7.00:00:00",
										"retry": 0,
										"retryIntervalInSeconds": 30,
										"secureOutput": false,
										"secureInput": false
									},
									"userProperties": [],
									"typeProperties": {
										"storedProcedureName": "[dbo].[proc_UpdateAuditLog_Briggs]",
										"storedProcedureParameters": {
											"ConfigTableID": {
												"value": {
													"value": "@item().ID_Full",
													"type": "Expression"
												},
												"type": "Int32"
											},
											"RowsRead": {
												"value": {
													"value": "@activity('Copy_Briggs_Full_ADLS').output.RowsRead",
													"type": "Expression"
												},
												"type": "Int64"
											},
											"Status": {
												"value": "Success",
												"type": "String"
											}
										}
									},
									"linkedServiceName": {
										"referenceName": "DS_MDW_SP",
										"type": "LinkedServiceReference"
									}
								},
								{
									"name": "Success_Audit_Log_New",
									"type": "SqlServerStoredProcedure",
									"dependsOn": [
										{
											"activity": "Copy_Briggs_Full_ADLS_New",
											"dependencyConditions": [
												"Succeeded"
											]
										}
									],
									"policy": {
										"timeout": "7.00:00:00",
										"retry": 0,
										"retryIntervalInSeconds": 30,
										"secureOutput": false,
										"secureInput": false
									},
									"userProperties": [],
									"typeProperties": {
										"storedProcedureName": "[dbo].[proc_UpdateAuditLog_Briggs]",
										"storedProcedureParameters": {
											"ConfigTableID": {
												"value": {
													"value": "@item().ID_Full",
													"type": "Expression"
												},
												"type": "Int32"
											},
											"RowsRead": {
												"value": {
													"value": "@activity('Copy_Briggs_Full_ADLS_New').output.RowsRead",
													"type": "Expression"
												},
												"type": "Int64"
											},
											"Status": {
												"value": "Success",
												"type": "String"
											}
										}
									},
									"linkedServiceName": {
										"referenceName": "DS_MDW_SP",
										"type": "LinkedServiceReference"
									}
								},
								{
									"name": "Failure_Audit_Log_New",
									"type": "SqlServerStoredProcedure",
									"dependsOn": [
										{
											"activity": "Set variable2",
											"dependencyConditions": [
												"Succeeded"
											]
										}
									],
									"policy": {
										"timeout": "7.00:00:00",
										"retry": 0,
										"retryIntervalInSeconds": 30,
										"secureOutput": false,
										"secureInput": false
									},
									"userProperties": [],
									"typeProperties": {
										"storedProcedureName": "[dbo].[proc_UpdateAuditLog_Briggs]",
										"storedProcedureParameters": {
											"ConfigTableID": {
												"value": {
													"value": "@item().ID_Full",
													"type": "Expression"
												},
												"type": "Int32"
											},
											"RowsRead": {
												"value": null,
												"type": "Int64"
											},
											"Status": {
												"value": {
													"value": "@variables('ErrorMsgFull')",
													"type": "Expression"
												},
												"type": "String"
											}
										}
									},
									"linkedServiceName": {
										"referenceName": "DS_MDW_SP",
										"type": "LinkedServiceReference"
									}
								},
								{
									"name": "Set variable2",
									"type": "SetVariable",
									"dependsOn": [
										{
											"activity": "Copy_Briggs_Full_ADLS",
											"dependencyConditions": [
												"Failed"
											]
										},
										{
											"activity": "Copy_Briggs_Full_ADLS_New",
											"dependencyConditions": [
												"Failed"
											]
										}
									],
									"userProperties": [],
									"typeProperties": {
										"variableName": "ErrorMsgFull",
										"value": {
											"value": "@activity('Copy_Briggs_Full_ADLS').Error.Message",
											"type": "Expression"
										}
									}
								}
							]
						}
					},
					{
						"name": "ForEach_Proc_Incremental",
						"type": "ForEach",
						"dependsOn": [
							{
								"activity": "ForEach_Incremental_Load",
								"dependencyConditions": [
									"Succeeded"
								]
							}
						],
						"userProperties": [],
						"typeProperties": {
							"items": {
								"value": "@activity('Lookup1_Incremental').output.value",
								"type": "Expression"
							},
							"activities": [
								{
									"name": "Stored procedure1",
									"type": "SqlServerStoredProcedure",
									"dependsOn": [],
									"policy": {
										"timeout": "7.00:00:00",
										"retry": 0,
										"retryIntervalInSeconds": 30,
										"secureOutput": false,
										"secureInput": false
									},
									"userProperties": [],
									"typeProperties": {
										"storedProcedureName": "[dbo].[USP_Control_Table_LastDate]",
										"storedProcedureParameters": {
											"id_I_F": {
												"value": {
													"value": "@item().ID_Inc",
													"type": "Expression"
												},
												"type": "Int32"
											}
										}
									},
									"linkedServiceName": {
										"referenceName": "DS_MDW_SP",
										"type": "LinkedServiceReference"
									}
								}
							]
						}
					},
					{
						"name": "ForEach_Proc_Full",
						"type": "ForEach",
						"dependsOn": [
							{
								"activity": "ForEach_Full_Load",
								"dependencyConditions": [
									"Succeeded"
								]
							}
						],
						"userProperties": [],
						"typeProperties": {
							"items": {
								"value": "@activity('Lookup2_Full').output.value",
								"type": "Expression"
							},
							"activities": [
								{
									"name": "Stored procedure_Full",
									"type": "SqlServerStoredProcedure",
									"dependsOn": [],
									"policy": {
										"timeout": "7.00:00:00",
										"retry": 0,
										"retryIntervalInSeconds": 30,
										"secureOutput": false,
										"secureInput": false
									},
									"userProperties": [],
									"typeProperties": {
										"storedProcedureName": "[dbo].[USP_Control_Table_LastDate]",
										"storedProcedureParameters": {
											"id_I_F": {
												"value": {
													"value": "@item().ID_Full",
													"type": "Expression"
												},
												"type": "Int32"
											}
										}
									},
									"linkedServiceName": {
										"referenceName": "DS_MDW_SP",
										"type": "LinkedServiceReference"
									}
								}
							]
						}
					},
					{
						"name": "lkp_ExecStartAuditProc",
						"type": "Lookup",
						"dependsOn": [],
						"policy": {
							"timeout": "7.00:00:00",
							"retry": 0,
							"retryIntervalInSeconds": 30,
							"secureOutput": false,
							"secureInput": false
						},
						"userProperties": [],
						"typeProperties": {
							"source": {
								"type": "AzureSqlSource",
								"sqlReaderStoredProcedureName": "[dbo].[proc_StartAuditLog]",
								"storedProcedureParameters": {
									"ConfigTableID": {
										"type": "Int32",
										"value": "-1"
									},
									"DataFactoryName": {
										"type": "String",
										"value": {
											"value": "@pipeline().DataFactory",
											"type": "Expression"
										}
									},
									"ParentAuditID": {
										"type": "Int64",
										"value": "-1"
									},
									"PipelineName": {
										"type": "String",
										"value": {
											"value": "@concat(pipeline().Pipeline,' Service Source Table Load')",
											"type": "Expression"
										}
									},
									"PipelineRunID": {
										"type": "String",
										"value": {
											"value": "@pipeline().RunId",
											"type": "Expression"
										}
									},
									"PipelineTriggerID": {
										"type": "String",
										"value": {
											"value": "@pipeline().TriggerId",
											"type": "Expression"
										}
									},
									"PipelineTriggerName": {
										"type": "String",
										"value": {
											"value": "@pipeline().TriggerName",
											"type": "Expression"
										}
									},
									"PipelineTriggerType": {
										"type": "String",
										"value": {
											"value": "@pipeline().TriggerType",
											"type": "Expression"
										}
									}
								},
								"queryTimeout": "02:00:00",
								"partitionOption": "None"
							},
							"dataset": {
								"referenceName": "Briggs_MDW",
								"type": "DatasetReference",
								"parameters": {
									"schema_name": "dbo",
									"table_name": "user"
								}
							}
						}
					},
					{
						"name": "Sp_ExecFailureAudit_Full",
						"type": "SqlServerStoredProcedure",
						"dependsOn": [
							{
								"activity": "ForEach_Full_Load",
								"dependencyConditions": [
									"Failed"
								]
							}
						],
						"policy": {
							"timeout": "7.00:00:00",
							"retry": 0,
							"retryIntervalInSeconds": 30,
							"secureOutput": false,
							"secureInput": false
						},
						"userProperties": [],
						"typeProperties": {
							"storedProcedureName": "[dbo].[proc_UpdateAuditLog]",
							"storedProcedureParameters": {
								"AuditID": {
									"value": {
										"value": "@activity('lkp_ExecStartAuditProc').output.firstRow.AuditID",
										"type": "Expression"
									},
									"type": "Int32"
								},
								"DataLakePath": {
									"value": null,
									"type": "String"
								},
								"PipelineRunID": {
									"value": {
										"value": "@pipeline().RunId",
										"type": "Expression"
									},
									"type": "String"
								},
								"RowsRead": {
									"value": null,
									"type": "Int64"
								},
								"Status": {
									"value": "Full Load Failed",
									"type": "String"
								}
							}
						},
						"linkedServiceName": {
							"referenceName": "AzureSqlDatabase1",
							"type": "LinkedServiceReference"
						}
					},
					{
						"name": "Sp_ExecSuccessAudit",
						"type": "SqlServerStoredProcedure",
						"dependsOn": [
							{
								"activity": "ForEach_Proc_Incremental",
								"dependencyConditions": [
									"Succeeded"
								]
							},
							{
								"activity": "ForEach_Proc_Full",
								"dependencyConditions": [
									"Succeeded"
								]
							}
						],
						"policy": {
							"timeout": "7.00:00:00",
							"retry": 0,
							"retryIntervalInSeconds": 30,
							"secureOutput": false,
							"secureInput": false
						},
						"userProperties": [],
						"typeProperties": {
							"storedProcedureName": "[dbo].[proc_UpdateAuditLog]",
							"storedProcedureParameters": {
								"AuditID": {
									"value": {
										"value": "@activity('lkp_ExecStartAuditProc').output.firstRow.AuditID",
										"type": "Expression"
									},
									"type": "Int32"
								},
								"DataLakePath": {
									"value": null,
									"type": "String"
								},
								"RowsRead": {
									"value": null,
									"type": "Int64"
								},
								"Status": {
									"value": "Success",
									"type": "String"
								},
								"PipelineRunID": {
									"value": {
										"value": "@pipeline().RunId",
										"type": "Expression"
									},
									"type": "String"
								}
							}
						},
						"linkedServiceName": {
							"referenceName": "AzureSqlDatabase1",
							"type": "LinkedServiceReference"
						}
					},
					{
						"name": "Sp_ExecFailureAudit_Inc",
						"type": "SqlServerStoredProcedure",
						"dependsOn": [
							{
								"activity": "ForEach_Incremental_Load",
								"dependencyConditions": [
									"Failed"
								]
							}
						],
						"policy": {
							"timeout": "7.00:00:00",
							"retry": 0,
							"retryIntervalInSeconds": 30,
							"secureOutput": false,
							"secureInput": false
						},
						"userProperties": [],
						"typeProperties": {
							"storedProcedureName": "[dbo].[proc_UpdateAuditLog]",
							"storedProcedureParameters": {
								"AuditID": {
									"value": {
										"value": "@activity('lkp_ExecStartAuditProc').output.firstRow.AuditID",
										"type": "Expression"
									},
									"type": "Int32"
								},
								"DataLakePath": {
									"value": null,
									"type": "String"
								},
								"PipelineRunID": {
									"value": {
										"value": "@pipeline().RunId",
										"type": "Expression"
									},
									"type": "String"
								},
								"RowsRead": {
									"value": null,
									"type": "Int64"
								},
								"Status": {
									"value": "Incr Load Failed",
									"type": "String"
								}
							}
						},
						"linkedServiceName": {
							"referenceName": "AzureSqlDatabase1",
							"type": "LinkedServiceReference"
						}
					}
				],
				"policy": {
					"elapsedTimeMetric": {},
					"cancelAfter": {}
				},
				"variables": {
					"ErrorMsgInc": {
						"type": "String"
					},
					"ErrorMsgFull": {
						"type": "String"
					}
				},
				"folder": {
					"name": "Briggs Data Load Theme wise"
				},
				"annotations": [],
				"lastPublishTime": "2022-04-26T07:45:31Z"
			},
			"dependsOn": [
				"[concat(variables('workspaceId'), '/datasets/Briggs_MDW')]",
				"[concat(variables('workspaceId'), '/linkedServices/AzureSqlDatabase1')]",
				"[concat(variables('workspaceId'), '/datasets/DS_Briggs_MST')]",
				"[concat(variables('workspaceId'), '/linkedServices/DS_MDW_SP')]"
			]
		},
		{
			"name": "[concat(parameters('workspaceName'), '/PL_Generic_Copy_Statement')]",
			"type": "Microsoft.Synapse/workspaces/pipelines",
			"apiVersion": "2019-06-01-preview",
			"properties": {
				"activities": [
					{
						"name": "Lookup1_Incremental",
						"type": "Lookup",
						"dependsOn": [
							{
								"activity": "lkp_ExecStartAuditProc",
								"dependencyConditions": [
									"Succeeded"
								]
							}
						],
						"policy": {
							"timeout": "7.00:00:00",
							"retry": 0,
							"retryIntervalInSeconds": 30,
							"secureOutput": false,
							"secureInput": false
						},
						"userProperties": [],
						"typeProperties": {
							"source": {
								"type": "AzureSqlSource",
								"sqlReaderQuery": "Select Distinct ID ID_Inc,sourcedb,sourcetablename From dbo.control_table Where ProcessName = 'AzSQL_ADLS'  \nAND DataLoadType = 'Incremental'  and EnableAction = 1  \nand (format(refresh_date,'dd-MM-yyyy') <> format(getdate(),'dd-MM-yyyy') or refresh_date is null)\nand subjectarea like '%Sales Statement%' and id <> 253 \norder by 1 ",
								"queryTimeout": "02:00:00",
								"partitionOption": "None"
							},
							"dataset": {
								"referenceName": "Briggs_MDW",
								"type": "DatasetReference",
								"parameters": {
									"schema_name": "dbo",
									"table_name": "user"
								}
							},
							"firstRowOnly": false
						}
					},
					{
						"name": "Lookup2_Full",
						"type": "Lookup",
						"dependsOn": [
							{
								"activity": "lkp_ExecStartAuditProc",
								"dependencyConditions": [
									"Succeeded"
								]
							}
						],
						"policy": {
							"timeout": "7.00:00:00",
							"retry": 0,
							"retryIntervalInSeconds": 30,
							"secureOutput": false,
							"secureInput": false
						},
						"userProperties": [],
						"typeProperties": {
							"source": {
								"type": "AzureSqlSource",
								"sqlReaderQuery": "Select Distinct ID ID_Full,sourcedb,sourcetablename From dbo.control_table Where ProcessName = 'AzSQL_ADLS'  \nAND DataLoadType = 'Full'  and EnableAction = 1 \nand (format(refresh_date,'dd-MM-yyyy') <> format(getdate(),'dd-MM-yyyy') or refresh_date is null)\nand subjectarea like '%Sales Statement%' \norder by 1 ",
								"queryTimeout": "02:00:00",
								"partitionOption": "None"
							},
							"dataset": {
								"referenceName": "Briggs_MDW",
								"type": "DatasetReference",
								"parameters": {
									"schema_name": "dbo",
									"table_name": "user"
								}
							},
							"firstRowOnly": false
						}
					},
					{
						"name": "ForEach_Incremental_Load",
						"type": "ForEach",
						"dependsOn": [
							{
								"activity": "Lookup1_Incremental",
								"dependencyConditions": [
									"Succeeded"
								]
							}
						],
						"userProperties": [],
						"typeProperties": {
							"items": {
								"value": "@activity('Lookup1_Incremental').output.value",
								"type": "Expression"
							},
							"activities": [
								{
									"name": "Lookup_Incremental",
									"type": "Lookup",
									"dependsOn": [],
									"policy": {
										"timeout": "7.00:00:00",
										"retry": 0,
										"retryIntervalInSeconds": 30,
										"secureOutput": false,
										"secureInput": false
									},
									"userProperties": [],
									"typeProperties": {
										"source": {
											"type": "AzureSqlSource",
											"sqlReaderQuery": {
												"value": "@concat('select SourceQuery=''select '' +columnList+ '' from ''+ sourceDB+''.''+SourceSchemaName+''.''+SourcetableName + '' where \ncast(''+DateField+'' as date) >=''''''+LastDate+''''''''\n,SourceDB\n,TargetContainer\n, TargetPath, TargetFile, FileFormat,DateField,LastDate,targetstagetableschema,targetstagetablename\nfrom dbo.control_table\nwhere ID= ',item().ID_Inc)",
												"type": "Expression"
											},
											"queryTimeout": "02:00:00",
											"partitionOption": "None"
										},
										"dataset": {
											"referenceName": "Briggs_MDW",
											"type": "DatasetReference",
											"parameters": {
												"schema_name": "dbo",
												"table_name": "user"
											}
										}
									}
								},
								{
									"name": "Copy_Briggs_Inc_ADLS",
									"type": "Copy",
									"dependsOn": [
										{
											"activity": "Start_Table_Audit1",
											"dependencyConditions": [
												"Succeeded"
											]
										}
									],
									"policy": {
										"timeout": "7.00:00:00",
										"retry": 0,
										"retryIntervalInSeconds": 30,
										"secureOutput": false,
										"secureInput": false
									},
									"userProperties": [],
									"typeProperties": {
										"source": {
											"type": "SqlServerSource",
											"sqlReaderQuery": {
												"value": "@activity('Lookup_Incremental').output.firstRow.SourceQuery\n",
												"type": "Expression"
											},
											"queryTimeout": "02:00:00",
											"partitionOption": "None"
										},
										"sink": {
											"type": "AzureSqlSink",
											"preCopyScript": {
												"value": "@{concat('delete from ',activity('Lookup_Incremental').output.firstRow.TargetStageTableSchema,'.',activity('Lookup_Incremental').output.firstRow.targetstagetablename,' where cast(',activity('Lookup_Incremental').output.firstRow.DateField,' as date)=','''',activity('Lookup_Incremental').output.firstRow.LastDate,'''')}",
												"type": "Expression"
											},
											"disableMetricsCollection": false
										},
										"enableStaging": false,
										"translator": {
											"type": "TabularTranslator",
											"typeConversion": true,
											"typeConversionSettings": {
												"allowDataTruncation": true,
												"treatBooleanAsNumber": false
											}
										}
									},
									"inputs": [
										{
											"referenceName": "DS_Briggs_MST",
											"type": "DatasetReference",
											"parameters": {}
										}
									],
									"outputs": [
										{
											"referenceName": "Briggs_MDW",
											"type": "DatasetReference",
											"parameters": {
												"schema_name": {
													"value": "@activity('Lookup_Incremental').output.firstRow.TargetStageTableSchema",
													"type": "Expression"
												},
												"table_name": {
													"value": "@activity('Lookup_Incremental').output.firstRow.TargetStageTableName",
													"type": "Expression"
												}
											}
										}
									]
								},
								{
									"name": "Copy_Briggs_Inc_ADLS_New",
									"type": "Copy",
									"dependsOn": [
										{
											"activity": "Copy_Briggs_Inc_ADLS",
											"dependencyConditions": [
												"Failed"
											]
										}
									],
									"policy": {
										"timeout": "7.00:00:00",
										"retry": 0,
										"retryIntervalInSeconds": 30,
										"secureOutput": false,
										"secureInput": false
									},
									"userProperties": [],
									"typeProperties": {
										"source": {
											"type": "SqlServerSource",
											"sqlReaderQuery": {
												"value": "@activity('Lookup_Incremental').output.firstRow.SourceQuery\n",
												"type": "Expression"
											},
											"queryTimeout": "02:00:00",
											"partitionOption": "None"
										},
										"sink": {
											"type": "AzureSqlSink",
											"writeBehavior": "insert",
											"sqlWriterUseTableLock": false,
											"tableOption": "autoCreate",
											"disableMetricsCollection": false
										},
										"enableStaging": false,
										"translator": {
											"type": "TabularTranslator",
											"typeConversion": true,
											"typeConversionSettings": {
												"allowDataTruncation": true,
												"treatBooleanAsNumber": false
											}
										}
									},
									"inputs": [
										{
											"referenceName": "DS_Briggs_MST",
											"type": "DatasetReference",
											"parameters": {}
										}
									],
									"outputs": [
										{
											"referenceName": "Briggs_MDW",
											"type": "DatasetReference",
											"parameters": {
												"schema_name": {
													"value": "@activity('Lookup_Incremental').output.firstRow.TargetStageTableSchema",
													"type": "Expression"
												},
												"table_name": {
													"value": "@activity('Lookup_Incremental').output.firstRow.TargetStageTableName",
													"type": "Expression"
												}
											}
										}
									]
								},
								{
									"name": "Start_Table_Audit1",
									"type": "Lookup",
									"dependsOn": [
										{
											"activity": "Lookup_Incremental",
											"dependencyConditions": [
												"Succeeded"
											]
										}
									],
									"policy": {
										"timeout": "7.00:00:00",
										"retry": 0,
										"retryIntervalInSeconds": 30,
										"secureOutput": false,
										"secureInput": false
									},
									"userProperties": [],
									"typeProperties": {
										"source": {
											"type": "AzureSqlSource",
											"sqlReaderStoredProcedureName": "[dbo].[proc_StartAuditLog_Briggs]",
											"storedProcedureParameters": {
												"ConfigTableID": {
													"type": "Int32",
													"value": {
														"value": "@item().ID_Inc",
														"type": "Expression"
													}
												},
												"DataFactoryName": {
													"type": "String",
													"value": {
														"value": "@pipeline().DataFactory",
														"type": "Expression"
													}
												},
												"ParentAuditID": {
													"type": "Int64",
													"value": {
														"value": "@item().ID_Inc",
														"type": "Expression"
													}
												},
												"PipelineName": {
													"type": "String",
													"value": {
														"value": "@pipeline().Pipeline",
														"type": "Expression"
													}
												},
												"PipelineRunID": {
													"type": "String",
													"value": {
														"value": "@pipeline().RunId",
														"type": "Expression"
													}
												},
												"PipelineTriggerID": {
													"type": "String",
													"value": {
														"value": "@pipeline().TriggerId",
														"type": "Expression"
													}
												},
												"PipelineTriggerName": {
													"type": "String",
													"value": {
														"value": "@pipeline().TriggerName",
														"type": "Expression"
													}
												},
												"PipelineTriggerType": {
													"type": "String",
													"value": {
														"value": "@pipeline().TriggerType",
														"type": "Expression"
													}
												},
												"Sourcedb": {
													"type": "String",
													"value": {
														"value": "@item().sourceDB",
														"type": "Expression"
													}
												},
												"sourcetable": {
													"type": "String",
													"value": {
														"value": "@item().SourcetableName",
														"type": "Expression"
													}
												}
											},
											"queryTimeout": "02:00:00",
											"partitionOption": "None"
										},
										"dataset": {
											"referenceName": "Briggs_MDW",
											"type": "DatasetReference",
											"parameters": {
												"schema_name": "dbo",
												"table_name": "user"
											}
										},
										"firstRowOnly": false
									}
								},
								{
									"name": "Success_Audit_Log1",
									"type": "SqlServerStoredProcedure",
									"dependsOn": [
										{
											"activity": "Copy_Briggs_Inc_ADLS",
											"dependencyConditions": [
												"Succeeded"
											]
										}
									],
									"policy": {
										"timeout": "7.00:00:00",
										"retry": 0,
										"retryIntervalInSeconds": 30,
										"secureOutput": false,
										"secureInput": false
									},
									"userProperties": [],
									"typeProperties": {
										"storedProcedureName": "[dbo].[proc_UpdateAuditLog_Briggs]",
										"storedProcedureParameters": {
											"ConfigTableID": {
												"value": {
													"value": "@item().ID_Inc",
													"type": "Expression"
												},
												"type": "Int32"
											},
											"RowsRead": {
												"value": {
													"value": "@activity('Copy_Briggs_Inc_ADLS').output.RowsRead",
													"type": "Expression"
												},
												"type": "Int64"
											},
											"Status": {
												"value": "Success",
												"type": "String"
											}
										}
									},
									"linkedServiceName": {
										"referenceName": "DS_MDW_SP",
										"type": "LinkedServiceReference"
									}
								},
								{
									"name": "Success_Audit_Log2",
									"type": "SqlServerStoredProcedure",
									"dependsOn": [
										{
											"activity": "Copy_Briggs_Inc_ADLS_New",
											"dependencyConditions": [
												"Succeeded"
											]
										}
									],
									"policy": {
										"timeout": "7.00:00:00",
										"retry": 0,
										"retryIntervalInSeconds": 30,
										"secureOutput": false,
										"secureInput": false
									},
									"userProperties": [],
									"typeProperties": {
										"storedProcedureName": "[dbo].[proc_UpdateAuditLog_Briggs]",
										"storedProcedureParameters": {
											"ConfigTableID": {
												"value": {
													"value": "@item().ID_Inc",
													"type": "Expression"
												},
												"type": "Int32"
											},
											"RowsRead": {
												"value": {
													"value": "@activity('Copy_Briggs_Inc_ADLS_New').output.RowsRead",
													"type": "Expression"
												},
												"type": "Int64"
											},
											"Status": {
												"value": "Success",
												"type": "String"
											}
										}
									},
									"linkedServiceName": {
										"referenceName": "DS_MDW_SP",
										"type": "LinkedServiceReference"
									}
								},
								{
									"name": "Failure_Audit_Log2",
									"type": "SqlServerStoredProcedure",
									"dependsOn": [
										{
											"activity": "Set variable1",
											"dependencyConditions": [
												"Succeeded"
											]
										}
									],
									"policy": {
										"timeout": "7.00:00:00",
										"retry": 0,
										"retryIntervalInSeconds": 30,
										"secureOutput": false,
										"secureInput": false
									},
									"userProperties": [],
									"typeProperties": {
										"storedProcedureName": "[dbo].[proc_UpdateAuditLog_Briggs]",
										"storedProcedureParameters": {
											"ConfigTableID": {
												"value": {
													"value": "@item().ID_Inc",
													"type": "Expression"
												},
												"type": "Int32"
											},
											"RowsRead": {
												"value": null,
												"type": "Int64"
											},
											"Status": {
												"value": {
													"value": "@variables('ErrorMsgInc')",
													"type": "Expression"
												},
												"type": "String"
											}
										}
									},
									"linkedServiceName": {
										"referenceName": "DS_MDW_SP",
										"type": "LinkedServiceReference"
									}
								},
								{
									"name": "Set variable1",
									"type": "SetVariable",
									"dependsOn": [
										{
											"activity": "Copy_Briggs_Inc_ADLS_New",
											"dependencyConditions": [
												"Failed"
											]
										},
										{
											"activity": "Copy_Briggs_Inc_ADLS",
											"dependencyConditions": [
												"Failed"
											]
										}
									],
									"userProperties": [],
									"typeProperties": {
										"variableName": "ErrorMsgInc",
										"value": {
											"value": "@activity('Copy_Briggs_Inc_ADLS').Error.Message",
											"type": "Expression"
										}
									}
								}
							]
						}
					},
					{
						"name": "ForEach_Full_Load",
						"type": "ForEach",
						"dependsOn": [
							{
								"activity": "Lookup2_Full",
								"dependencyConditions": [
									"Succeeded"
								]
							}
						],
						"userProperties": [],
						"typeProperties": {
							"items": {
								"value": "@activity('Lookup2_Full').output.value",
								"type": "Expression"
							},
							"activities": [
								{
									"name": "Lookup_Full",
									"type": "Lookup",
									"dependsOn": [],
									"policy": {
										"timeout": "7.00:00:00",
										"retry": 0,
										"retryIntervalInSeconds": 30,
										"secureOutput": false,
										"secureInput": false
									},
									"userProperties": [],
									"typeProperties": {
										"source": {
											"type": "AzureSqlSource",
											"sqlReaderQuery": {
												"value": "@concat('select SourceQuery=''select '' +columnList+ '' from ''+ sourceDB+''.''+SourceSchemaName+''.''+SourcetableName\n,SourceDB\n,TargetContainer\n, TargetPath, TargetFile, FileFormat,DateField,LastDate,targetstagetableschema,targetstagetablename\nfrom dbo.control_table\nwhere ID= ',item().ID_Full)",
												"type": "Expression"
											},
											"queryTimeout": "02:00:00",
											"partitionOption": "None"
										},
										"dataset": {
											"referenceName": "Briggs_MDW",
											"type": "DatasetReference",
											"parameters": {
												"schema_name": "dbo",
												"table_name": "user"
											}
										}
									}
								},
								{
									"name": "Copy_Briggs_Full_ADLS",
									"type": "Copy",
									"dependsOn": [
										{
											"activity": "Start_Table_Audit",
											"dependencyConditions": [
												"Succeeded"
											]
										}
									],
									"policy": {
										"timeout": "7.00:00:00",
										"retry": 0,
										"retryIntervalInSeconds": 30,
										"secureOutput": false,
										"secureInput": false
									},
									"userProperties": [],
									"typeProperties": {
										"source": {
											"type": "SqlServerSource",
											"sqlReaderQuery": {
												"value": "@activity('Lookup_Full').output.firstRow.SourceQuery\n",
												"type": "Expression"
											},
											"queryTimeout": "02:00:00",
											"partitionOption": "None"
										},
										"sink": {
											"type": "AzureSqlSink",
											"preCopyScript": {
												"value": "@{concat('truncate table ',activity('Lookup_Full').output.firstRow.TargetStageTableSchema,'.',activity('Lookup_Full').output.firstRow.TargetStageTableName)}",
												"type": "Expression"
											},
											"disableMetricsCollection": false
										},
										"enableStaging": false,
										"translator": {
											"type": "TabularTranslator",
											"typeConversion": true,
											"typeConversionSettings": {
												"allowDataTruncation": true,
												"treatBooleanAsNumber": false
											}
										}
									},
									"inputs": [
										{
											"referenceName": "DS_Briggs_MST",
											"type": "DatasetReference",
											"parameters": {}
										}
									],
									"outputs": [
										{
											"referenceName": "Briggs_MDW",
											"type": "DatasetReference",
											"parameters": {
												"schema_name": {
													"value": "@activity('Lookup_Full').output.firstRow.TargetStageTableSchema",
													"type": "Expression"
												},
												"table_name": {
													"value": "@activity('Lookup_Full').output.firstRow.TargetStageTableName",
													"type": "Expression"
												}
											}
										}
									]
								},
								{
									"name": "Copy_Briggs_Full_ADLS_New",
									"type": "Copy",
									"dependsOn": [
										{
											"activity": "Copy_Briggs_Full_ADLS",
											"dependencyConditions": [
												"Failed"
											]
										}
									],
									"policy": {
										"timeout": "7.00:00:00",
										"retry": 0,
										"retryIntervalInSeconds": 30,
										"secureOutput": false,
										"secureInput": false
									},
									"userProperties": [],
									"typeProperties": {
										"source": {
											"type": "SqlServerSource",
											"sqlReaderQuery": {
												"value": "@activity('Lookup_Full').output.firstRow.SourceQuery\n",
												"type": "Expression"
											},
											"queryTimeout": "02:00:00",
											"partitionOption": "None"
										},
										"sink": {
											"type": "AzureSqlSink",
											"writeBehavior": "insert",
											"sqlWriterUseTableLock": false,
											"tableOption": "autoCreate",
											"disableMetricsCollection": false
										},
										"enableStaging": false,
										"translator": {
											"type": "TabularTranslator",
											"typeConversion": true,
											"typeConversionSettings": {
												"allowDataTruncation": true,
												"treatBooleanAsNumber": false
											}
										}
									},
									"inputs": [
										{
											"referenceName": "DS_Briggs_MST",
											"type": "DatasetReference",
											"parameters": {}
										}
									],
									"outputs": [
										{
											"referenceName": "Briggs_MDW",
											"type": "DatasetReference",
											"parameters": {
												"schema_name": {
													"value": "@activity('Lookup_Full').output.firstRow.TargetStageTableSchema",
													"type": "Expression"
												},
												"table_name": {
													"value": "@activity('Lookup_Full').output.firstRow.TargetStageTableName",
													"type": "Expression"
												}
											}
										}
									]
								},
								{
									"name": "Start_Table_Audit",
									"type": "Lookup",
									"dependsOn": [
										{
											"activity": "Lookup_Full",
											"dependencyConditions": [
												"Succeeded"
											]
										}
									],
									"policy": {
										"timeout": "7.00:00:00",
										"retry": 0,
										"retryIntervalInSeconds": 30,
										"secureOutput": false,
										"secureInput": false
									},
									"userProperties": [],
									"typeProperties": {
										"source": {
											"type": "AzureSqlSource",
											"sqlReaderStoredProcedureName": "[dbo].[proc_StartAuditLog_Briggs]",
											"storedProcedureParameters": {
												"ConfigTableID": {
													"type": "Int32",
													"value": {
														"value": "@item().ID_Full",
														"type": "Expression"
													}
												},
												"DataFactoryName": {
													"type": "String",
													"value": {
														"value": "@pipeline().DataFactory",
														"type": "Expression"
													}
												},
												"ParentAuditID": {
													"type": "Int64",
													"value": {
														"value": "@item().ID_Full",
														"type": "Expression"
													}
												},
												"PipelineName": {
													"type": "String",
													"value": {
														"value": "@pipeline().Pipeline",
														"type": "Expression"
													}
												},
												"PipelineRunID": {
													"type": "String",
													"value": {
														"value": "@pipeline().RunId",
														"type": "Expression"
													}
												},
												"PipelineTriggerID": {
													"type": "String",
													"value": {
														"value": "@pipeline().TriggerId",
														"type": "Expression"
													}
												},
												"PipelineTriggerName": {
													"type": "String",
													"value": {
														"value": "@pipeline().TriggerName",
														"type": "Expression"
													}
												},
												"PipelineTriggerType": {
													"type": "String",
													"value": {
														"value": "@pipeline().TriggerType",
														"type": "Expression"
													}
												},
												"Sourcedb": {
													"type": "String",
													"value": {
														"value": "@item().sourceDB",
														"type": "Expression"
													}
												},
												"sourcetable": {
													"type": "String",
													"value": {
														"value": "@item().SourcetableName",
														"type": "Expression"
													}
												}
											},
											"queryTimeout": "02:00:00",
											"partitionOption": "None"
										},
										"dataset": {
											"referenceName": "Briggs_MDW",
											"type": "DatasetReference",
											"parameters": {
												"schema_name": "dbo",
												"table_name": "user"
											}
										},
										"firstRowOnly": false
									}
								},
								{
									"name": "Success_Audit_Log",
									"type": "SqlServerStoredProcedure",
									"dependsOn": [
										{
											"activity": "Copy_Briggs_Full_ADLS",
											"dependencyConditions": [
												"Succeeded"
											]
										}
									],
									"policy": {
										"timeout": "7.00:00:00",
										"retry": 0,
										"retryIntervalInSeconds": 30,
										"secureOutput": false,
										"secureInput": false
									},
									"userProperties": [],
									"typeProperties": {
										"storedProcedureName": "[dbo].[proc_UpdateAuditLog_Briggs]",
										"storedProcedureParameters": {
											"ConfigTableID": {
												"value": {
													"value": "@item().ID_Full",
													"type": "Expression"
												},
												"type": "Int32"
											},
											"RowsRead": {
												"value": {
													"value": "@activity('Copy_Briggs_Full_ADLS').output.RowsRead",
													"type": "Expression"
												},
												"type": "Int64"
											},
											"Status": {
												"value": "Success",
												"type": "String"
											}
										}
									},
									"linkedServiceName": {
										"referenceName": "DS_MDW_SP",
										"type": "LinkedServiceReference"
									}
								},
								{
									"name": "Success_Audit_Log_New",
									"type": "SqlServerStoredProcedure",
									"dependsOn": [
										{
											"activity": "Copy_Briggs_Full_ADLS_New",
											"dependencyConditions": [
												"Succeeded"
											]
										}
									],
									"policy": {
										"timeout": "7.00:00:00",
										"retry": 0,
										"retryIntervalInSeconds": 30,
										"secureOutput": false,
										"secureInput": false
									},
									"userProperties": [],
									"typeProperties": {
										"storedProcedureName": "[dbo].[proc_UpdateAuditLog_Briggs]",
										"storedProcedureParameters": {
											"ConfigTableID": {
												"value": {
													"value": "@item().ID_Full",
													"type": "Expression"
												},
												"type": "Int32"
											},
											"RowsRead": {
												"value": {
													"value": "@activity('Copy_Briggs_Full_ADLS_New').output.RowsRead",
													"type": "Expression"
												},
												"type": "Int64"
											},
											"Status": {
												"value": "Success",
												"type": "String"
											}
										}
									},
									"linkedServiceName": {
										"referenceName": "DS_MDW_SP",
										"type": "LinkedServiceReference"
									}
								},
								{
									"name": "Failure_Audit_Log_New",
									"type": "SqlServerStoredProcedure",
									"dependsOn": [
										{
											"activity": "Set variable2",
											"dependencyConditions": [
												"Succeeded"
											]
										}
									],
									"policy": {
										"timeout": "7.00:00:00",
										"retry": 0,
										"retryIntervalInSeconds": 30,
										"secureOutput": false,
										"secureInput": false
									},
									"userProperties": [],
									"typeProperties": {
										"storedProcedureName": "[dbo].[proc_UpdateAuditLog_Briggs]",
										"storedProcedureParameters": {
											"ConfigTableID": {
												"value": {
													"value": "@item().ID_Full",
													"type": "Expression"
												},
												"type": "Int32"
											},
											"RowsRead": {
												"value": null,
												"type": "Int64"
											},
											"Status": {
												"value": {
													"value": "@variables('ErrorMsgFull')",
													"type": "Expression"
												},
												"type": "String"
											}
										}
									},
									"linkedServiceName": {
										"referenceName": "DS_MDW_SP",
										"type": "LinkedServiceReference"
									}
								},
								{
									"name": "Set variable2",
									"type": "SetVariable",
									"dependsOn": [
										{
											"activity": "Copy_Briggs_Full_ADLS_New",
											"dependencyConditions": [
												"Failed"
											]
										},
										{
											"activity": "Copy_Briggs_Full_ADLS",
											"dependencyConditions": [
												"Failed"
											]
										}
									],
									"userProperties": [],
									"typeProperties": {
										"variableName": "ErrorMsgFull",
										"value": {
											"value": "@activity('Copy_Briggs_Full_ADLS').Error.Message",
											"type": "Expression"
										}
									}
								}
							]
						}
					},
					{
						"name": "ForEach_Incremental_Proc",
						"type": "ForEach",
						"dependsOn": [
							{
								"activity": "ForEach_Incremental_Load",
								"dependencyConditions": [
									"Succeeded"
								]
							}
						],
						"userProperties": [],
						"typeProperties": {
							"items": {
								"value": "@activity('Lookup1_Incremental').output.value",
								"type": "Expression"
							},
							"activities": [
								{
									"name": "Stored procedure1",
									"type": "SqlServerStoredProcedure",
									"dependsOn": [],
									"policy": {
										"timeout": "7.00:00:00",
										"retry": 0,
										"retryIntervalInSeconds": 30,
										"secureOutput": false,
										"secureInput": false
									},
									"userProperties": [],
									"typeProperties": {
										"storedProcedureName": "[dbo].[USP_Control_Table_LastDate]",
										"storedProcedureParameters": {
											"id_I_F": {
												"value": {
													"value": "@item().ID_Inc",
													"type": "Expression"
												},
												"type": "Int32"
											}
										}
									},
									"linkedServiceName": {
										"referenceName": "DS_MDW_SP",
										"type": "LinkedServiceReference"
									}
								}
							]
						}
					},
					{
						"name": "ForEach_Full_Proc",
						"type": "ForEach",
						"dependsOn": [
							{
								"activity": "ForEach_Full_Load",
								"dependencyConditions": [
									"Succeeded"
								]
							}
						],
						"userProperties": [],
						"typeProperties": {
							"items": {
								"value": "@activity('Lookup2_Full').output.value",
								"type": "Expression"
							},
							"activities": [
								{
									"name": "Stored procedure_Full",
									"type": "SqlServerStoredProcedure",
									"dependsOn": [],
									"policy": {
										"timeout": "7.00:00:00",
										"retry": 0,
										"retryIntervalInSeconds": 30,
										"secureOutput": false,
										"secureInput": false
									},
									"userProperties": [],
									"typeProperties": {
										"storedProcedureName": "[dbo].[USP_Control_Table_LastDate]",
										"storedProcedureParameters": {
											"id_I_F": {
												"value": {
													"value": "@item().ID_Full",
													"type": "Expression"
												},
												"type": "Int32"
											}
										}
									},
									"linkedServiceName": {
										"referenceName": "DS_MDW_SP",
										"type": "LinkedServiceReference"
									}
								}
							]
						}
					},
					{
						"name": "lkp_ExecStartAuditProc",
						"type": "Lookup",
						"dependsOn": [],
						"policy": {
							"timeout": "7.00:00:00",
							"retry": 0,
							"retryIntervalInSeconds": 30,
							"secureOutput": false,
							"secureInput": false
						},
						"userProperties": [],
						"typeProperties": {
							"source": {
								"type": "AzureSqlSource",
								"sqlReaderStoredProcedureName": "[dbo].[proc_StartAuditLog]",
								"storedProcedureParameters": {
									"ConfigTableID": {
										"type": "Int32",
										"value": "-1"
									},
									"DataFactoryName": {
										"type": "String",
										"value": {
											"value": "@pipeline().DataFactory",
											"type": "Expression"
										}
									},
									"ParentAuditID": {
										"type": "Int64",
										"value": "-1"
									},
									"PipelineName": {
										"type": "String",
										"value": {
											"value": "@concat(pipeline().Pipeline,' Statement Source Table Load')",
											"type": "Expression"
										}
									},
									"PipelineRunID": {
										"type": "String",
										"value": {
											"value": "@pipeline().RunId",
											"type": "Expression"
										}
									},
									"PipelineTriggerID": {
										"type": "String",
										"value": {
											"value": "@pipeline().TriggerId",
											"type": "Expression"
										}
									},
									"PipelineTriggerName": {
										"type": "String",
										"value": {
											"value": "@pipeline().TriggerName",
											"type": "Expression"
										}
									},
									"PipelineTriggerType": {
										"type": "String",
										"value": {
											"value": "@pipeline().TriggerType",
											"type": "Expression"
										}
									}
								},
								"queryTimeout": "02:00:00",
								"partitionOption": "None"
							},
							"dataset": {
								"referenceName": "Briggs_MDW",
								"type": "DatasetReference",
								"parameters": {
									"schema_name": "dbo",
									"table_name": "user"
								}
							}
						}
					},
					{
						"name": "Sp_ExecFailureAudit_Full",
						"type": "SqlServerStoredProcedure",
						"dependsOn": [
							{
								"activity": "ForEach_Full_Load",
								"dependencyConditions": [
									"Failed"
								]
							}
						],
						"policy": {
							"timeout": "7.00:00:00",
							"retry": 0,
							"retryIntervalInSeconds": 30,
							"secureOutput": false,
							"secureInput": false
						},
						"userProperties": [],
						"typeProperties": {
							"storedProcedureName": "[dbo].[proc_UpdateAuditLog]",
							"storedProcedureParameters": {
								"AuditID": {
									"value": {
										"value": "@activity('lkp_ExecStartAuditProc').output.firstRow.AuditID",
										"type": "Expression"
									},
									"type": "Int32"
								},
								"DataLakePath": {
									"value": null,
									"type": "String"
								},
								"PipelineRunID": {
									"value": {
										"value": "@pipeline().RunId",
										"type": "Expression"
									},
									"type": "String"
								},
								"RowsRead": {
									"value": null,
									"type": "Int64"
								},
								"Status": {
									"value": "Full Load Failed",
									"type": "String"
								}
							}
						},
						"linkedServiceName": {
							"referenceName": "AzureSqlDatabase1",
							"type": "LinkedServiceReference"
						}
					},
					{
						"name": "Sp_ExecSuccessAudit",
						"type": "SqlServerStoredProcedure",
						"dependsOn": [
							{
								"activity": "ForEach_Incremental_Proc",
								"dependencyConditions": [
									"Succeeded"
								]
							},
							{
								"activity": "ForEach_Full_Proc",
								"dependencyConditions": [
									"Succeeded"
								]
							}
						],
						"policy": {
							"timeout": "7.00:00:00",
							"retry": 0,
							"retryIntervalInSeconds": 30,
							"secureOutput": false,
							"secureInput": false
						},
						"userProperties": [],
						"typeProperties": {
							"storedProcedureName": "[dbo].[proc_UpdateAuditLog]",
							"storedProcedureParameters": {
								"AuditID": {
									"value": {
										"value": "@activity('lkp_ExecStartAuditProc').output.firstRow.AuditID",
										"type": "Expression"
									},
									"type": "Int32"
								},
								"DataLakePath": {
									"value": null,
									"type": "String"
								},
								"RowsRead": {
									"value": null,
									"type": "Int64"
								},
								"Status": {
									"value": "Success",
									"type": "String"
								},
								"PipelineRunID": {
									"value": {
										"value": "@pipeline().RunId",
										"type": "Expression"
									},
									"type": "String"
								}
							}
						},
						"linkedServiceName": {
							"referenceName": "AzureSqlDatabase1",
							"type": "LinkedServiceReference"
						}
					},
					{
						"name": "Sp_ExecFailureAudit_Inc",
						"type": "SqlServerStoredProcedure",
						"dependsOn": [
							{
								"activity": "ForEach_Incremental_Load",
								"dependencyConditions": [
									"Failed"
								]
							}
						],
						"policy": {
							"timeout": "7.00:00:00",
							"retry": 0,
							"retryIntervalInSeconds": 30,
							"secureOutput": false,
							"secureInput": false
						},
						"userProperties": [],
						"typeProperties": {
							"storedProcedureName": "[dbo].[proc_UpdateAuditLog]",
							"storedProcedureParameters": {
								"AuditID": {
									"value": {
										"value": "@activity('lkp_ExecStartAuditProc').output.firstRow.AuditID",
										"type": "Expression"
									},
									"type": "Int32"
								},
								"DataLakePath": {
									"value": null,
									"type": "String"
								},
								"PipelineRunID": {
									"value": {
										"value": "@pipeline().RunId",
										"type": "Expression"
									},
									"type": "String"
								},
								"RowsRead": {
									"value": null,
									"type": "Int64"
								},
								"Status": {
									"value": "Incr Load Failed",
									"type": "String"
								}
							}
						},
						"linkedServiceName": {
							"referenceName": "AzureSqlDatabase1",
							"type": "LinkedServiceReference"
						}
					}
				],
				"policy": {
					"elapsedTimeMetric": {},
					"cancelAfter": {}
				},
				"variables": {
					"ErrorMsgInc": {
						"type": "String"
					},
					"ErrorMsgFull": {
						"type": "String"
					}
				},
				"folder": {
					"name": "Briggs Data Load Theme wise"
				},
				"annotations": [],
				"lastPublishTime": "2022-04-26T07:45:21Z"
			},
			"dependsOn": [
				"[concat(variables('workspaceId'), '/datasets/Briggs_MDW')]",
				"[concat(variables('workspaceId'), '/linkedServices/AzureSqlDatabase1')]",
				"[concat(variables('workspaceId'), '/datasets/DS_Briggs_MST')]",
				"[concat(variables('workspaceId'), '/linkedServices/DS_MDW_SP')]"
			]
		},
		{
			"name": "[concat(parameters('workspaceName'), '/PL_Generic_Copy_Tech')]",
			"type": "Microsoft.Synapse/workspaces/pipelines",
			"apiVersion": "2019-06-01-preview",
			"properties": {
				"activities": [
					{
						"name": "Lookup1_Incremental",
						"type": "Lookup",
						"dependsOn": [
							{
								"activity": "lkp_ExecStartAuditProc",
								"dependencyConditions": [
									"Succeeded"
								]
							}
						],
						"policy": {
							"timeout": "7.00:00:00",
							"retry": 0,
							"retryIntervalInSeconds": 30,
							"secureOutput": false,
							"secureInput": false
						},
						"userProperties": [],
						"typeProperties": {
							"source": {
								"type": "AzureSqlSource",
								"sqlReaderQuery": "Select Distinct ID ID_Inc,sourcedb,sourcetablename From dbo.control_table Where ProcessName = 'AzSQL_ADLS'  \nAND DataLoadType = 'Incremental'  and EnableAction = 1  \nand (format(refresh_date,'dd-MM-yyyy') <> format(getdate(),'dd-MM-yyyy') or refresh_date is null)\nand subjectarea like '%Sales Tech%' and id <> 253 \norder by 1 ",
								"queryTimeout": "02:00:00",
								"partitionOption": "None"
							},
							"dataset": {
								"referenceName": "Briggs_MDW",
								"type": "DatasetReference",
								"parameters": {
									"schema_name": "dbo",
									"table_name": "user"
								}
							},
							"firstRowOnly": false
						}
					},
					{
						"name": "Lookup2_Full",
						"type": "Lookup",
						"dependsOn": [
							{
								"activity": "lkp_ExecStartAuditProc",
								"dependencyConditions": [
									"Succeeded"
								]
							}
						],
						"policy": {
							"timeout": "7.00:00:00",
							"retry": 0,
							"retryIntervalInSeconds": 30,
							"secureOutput": false,
							"secureInput": false
						},
						"userProperties": [],
						"typeProperties": {
							"source": {
								"type": "AzureSqlSource",
								"sqlReaderQuery": "Select Distinct ID ID_Full,sourcedb,sourcetablename From dbo.control_table Where ProcessName = 'AzSQL_ADLS'  \nAND DataLoadType = 'Full'  and EnableAction = 1 \nand (format(refresh_date,'dd-MM-yyyy') <> format(getdate(),'dd-MM-yyyy') or refresh_date is null)\nand subjectarea like '%Sales Tech%' \norder by 1 ",
								"queryTimeout": "02:00:00",
								"partitionOption": "None"
							},
							"dataset": {
								"referenceName": "Briggs_MDW",
								"type": "DatasetReference",
								"parameters": {
									"schema_name": "dbo",
									"table_name": "user"
								}
							},
							"firstRowOnly": false
						}
					},
					{
						"name": "ForEach_Incremental_Load",
						"type": "ForEach",
						"dependsOn": [
							{
								"activity": "Lookup1_Incremental",
								"dependencyConditions": [
									"Succeeded"
								]
							}
						],
						"userProperties": [],
						"typeProperties": {
							"items": {
								"value": "@activity('Lookup1_Incremental').output.value",
								"type": "Expression"
							},
							"activities": [
								{
									"name": "Lookup_Incremental",
									"type": "Lookup",
									"dependsOn": [],
									"policy": {
										"timeout": "7.00:00:00",
										"retry": 0,
										"retryIntervalInSeconds": 30,
										"secureOutput": false,
										"secureInput": false
									},
									"userProperties": [],
									"typeProperties": {
										"source": {
											"type": "AzureSqlSource",
											"sqlReaderQuery": {
												"value": "@concat('select SourceQuery=''select '' +columnList+ '' from ''+ sourceDB+''.''+SourceSchemaName+''.''+SourcetableName + '' where \ncast(''+DateField+'' as date) >=''''''+LastDate+''''''''\n,SourceDB\n,TargetContainer\n, TargetPath, TargetFile, FileFormat,DateField,LastDate,targetstagetableschema,targetstagetablename\nfrom dbo.control_table\nwhere ID= ',item().ID_Inc)",
												"type": "Expression"
											},
											"queryTimeout": "02:00:00",
											"partitionOption": "None"
										},
										"dataset": {
											"referenceName": "Briggs_MDW",
											"type": "DatasetReference",
											"parameters": {
												"schema_name": "dbo",
												"table_name": "user"
											}
										}
									}
								},
								{
									"name": "Copy_Briggs_Inc_ADLS",
									"type": "Copy",
									"dependsOn": [
										{
											"activity": "Start_Table_Audit1",
											"dependencyConditions": [
												"Succeeded"
											]
										}
									],
									"policy": {
										"timeout": "7.00:00:00",
										"retry": 0,
										"retryIntervalInSeconds": 30,
										"secureOutput": false,
										"secureInput": false
									},
									"userProperties": [],
									"typeProperties": {
										"source": {
											"type": "SqlServerSource",
											"sqlReaderQuery": {
												"value": "@activity('Lookup_Incremental').output.firstRow.SourceQuery\n",
												"type": "Expression"
											},
											"queryTimeout": "02:00:00",
											"partitionOption": "None"
										},
										"sink": {
											"type": "AzureSqlSink",
											"preCopyScript": {
												"value": "@{concat('delete from ',activity('Lookup_Incremental').output.firstRow.TargetStageTableSchema,'.',activity('Lookup_Incremental').output.firstRow.targetstagetablename,' where cast(',activity('Lookup_Incremental').output.firstRow.DateField,' as date)=','''',activity('Lookup_Incremental').output.firstRow.LastDate,'''')}",
												"type": "Expression"
											},
											"disableMetricsCollection": false
										},
										"enableStaging": false,
										"translator": {
											"type": "TabularTranslator",
											"typeConversion": true,
											"typeConversionSettings": {
												"allowDataTruncation": true,
												"treatBooleanAsNumber": false
											}
										}
									},
									"inputs": [
										{
											"referenceName": "DS_Briggs_MST",
											"type": "DatasetReference",
											"parameters": {}
										}
									],
									"outputs": [
										{
											"referenceName": "Briggs_MDW",
											"type": "DatasetReference",
											"parameters": {
												"schema_name": {
													"value": "@activity('Lookup_Incremental').output.firstRow.TargetStageTableSchema",
													"type": "Expression"
												},
												"table_name": {
													"value": "@activity('Lookup_Incremental').output.firstRow.TargetStageTableName",
													"type": "Expression"
												}
											}
										}
									]
								},
								{
									"name": "Copy_Briggs_Inc_ADLS_New",
									"type": "Copy",
									"dependsOn": [
										{
											"activity": "Copy_Briggs_Inc_ADLS",
											"dependencyConditions": [
												"Failed"
											]
										}
									],
									"policy": {
										"timeout": "7.00:00:00",
										"retry": 0,
										"retryIntervalInSeconds": 30,
										"secureOutput": false,
										"secureInput": false
									},
									"userProperties": [],
									"typeProperties": {
										"source": {
											"type": "SqlServerSource",
											"sqlReaderQuery": {
												"value": "@activity('Lookup_Incremental').output.firstRow.SourceQuery\n",
												"type": "Expression"
											},
											"queryTimeout": "02:00:00",
											"partitionOption": "None"
										},
										"sink": {
											"type": "AzureSqlSink",
											"writeBehavior": "insert",
											"sqlWriterUseTableLock": false,
											"tableOption": "autoCreate",
											"disableMetricsCollection": false
										},
										"enableStaging": false,
										"translator": {
											"type": "TabularTranslator",
											"typeConversion": true,
											"typeConversionSettings": {
												"allowDataTruncation": true,
												"treatBooleanAsNumber": false
											}
										}
									},
									"inputs": [
										{
											"referenceName": "DS_Briggs_MST",
											"type": "DatasetReference",
											"parameters": {}
										}
									],
									"outputs": [
										{
											"referenceName": "Briggs_MDW",
											"type": "DatasetReference",
											"parameters": {
												"schema_name": {
													"value": "@activity('Lookup_Incremental').output.firstRow.TargetStageTableSchema",
													"type": "Expression"
												},
												"table_name": {
													"value": "@activity('Lookup_Incremental').output.firstRow.TargetStageTableName",
													"type": "Expression"
												}
											}
										}
									]
								},
								{
									"name": "Start_Table_Audit1",
									"type": "Lookup",
									"dependsOn": [
										{
											"activity": "Lookup_Incremental",
											"dependencyConditions": [
												"Succeeded"
											]
										}
									],
									"policy": {
										"timeout": "7.00:00:00",
										"retry": 0,
										"retryIntervalInSeconds": 30,
										"secureOutput": false,
										"secureInput": false
									},
									"userProperties": [],
									"typeProperties": {
										"source": {
											"type": "AzureSqlSource",
											"sqlReaderStoredProcedureName": "[dbo].[proc_StartAuditLog_Briggs]",
											"storedProcedureParameters": {
												"ConfigTableID": {
													"type": "Int32",
													"value": {
														"value": "@item().ID_Inc",
														"type": "Expression"
													}
												},
												"DataFactoryName": {
													"type": "String",
													"value": {
														"value": "@pipeline().DataFactory",
														"type": "Expression"
													}
												},
												"ParentAuditID": {
													"type": "Int64",
													"value": {
														"value": "@item().ID_Inc",
														"type": "Expression"
													}
												},
												"PipelineName": {
													"type": "String",
													"value": {
														"value": "@pipeline().Pipeline",
														"type": "Expression"
													}
												},
												"PipelineRunID": {
													"type": "String",
													"value": {
														"value": "@pipeline().RunId",
														"type": "Expression"
													}
												},
												"PipelineTriggerID": {
													"type": "String",
													"value": {
														"value": "@pipeline().TriggerId",
														"type": "Expression"
													}
												},
												"PipelineTriggerName": {
													"type": "String",
													"value": {
														"value": "@pipeline().TriggerName",
														"type": "Expression"
													}
												},
												"PipelineTriggerType": {
													"type": "String",
													"value": {
														"value": "@pipeline().TriggerType",
														"type": "Expression"
													}
												},
												"Sourcedb": {
													"type": "String",
													"value": {
														"value": "@item().sourceDB",
														"type": "Expression"
													}
												},
												"sourcetable": {
													"type": "String",
													"value": {
														"value": "@item().SourcetableName",
														"type": "Expression"
													}
												}
											},
											"queryTimeout": "02:00:00",
											"partitionOption": "None"
										},
										"dataset": {
											"referenceName": "Briggs_MDW",
											"type": "DatasetReference",
											"parameters": {
												"schema_name": "dbo",
												"table_name": "user"
											}
										},
										"firstRowOnly": false
									}
								},
								{
									"name": "Success_Audit_Log1",
									"type": "SqlServerStoredProcedure",
									"dependsOn": [
										{
											"activity": "Copy_Briggs_Inc_ADLS",
											"dependencyConditions": [
												"Succeeded"
											]
										}
									],
									"policy": {
										"timeout": "7.00:00:00",
										"retry": 0,
										"retryIntervalInSeconds": 30,
										"secureOutput": false,
										"secureInput": false
									},
									"userProperties": [],
									"typeProperties": {
										"storedProcedureName": "[dbo].[proc_UpdateAuditLog_Briggs]",
										"storedProcedureParameters": {
											"ConfigTableID": {
												"value": {
													"value": "@item().ID_Inc",
													"type": "Expression"
												},
												"type": "Int32"
											},
											"RowsRead": {
												"value": {
													"value": "@activity('Copy_Briggs_Inc_ADLS').output.RowsRead",
													"type": "Expression"
												},
												"type": "Int64"
											},
											"Status": {
												"value": "Success",
												"type": "String"
											}
										}
									},
									"linkedServiceName": {
										"referenceName": "DS_MDW_SP",
										"type": "LinkedServiceReference"
									}
								},
								{
									"name": "Success_Audit_Log2",
									"type": "SqlServerStoredProcedure",
									"dependsOn": [
										{
											"activity": "Copy_Briggs_Inc_ADLS_New",
											"dependencyConditions": [
												"Succeeded"
											]
										}
									],
									"policy": {
										"timeout": "7.00:00:00",
										"retry": 0,
										"retryIntervalInSeconds": 30,
										"secureOutput": false,
										"secureInput": false
									},
									"userProperties": [],
									"typeProperties": {
										"storedProcedureName": "[dbo].[proc_UpdateAuditLog_Briggs]",
										"storedProcedureParameters": {
											"ConfigTableID": {
												"value": {
													"value": "@item().ID_Inc",
													"type": "Expression"
												},
												"type": "Int32"
											},
											"RowsRead": {
												"value": {
													"value": "@activity('Copy_Briggs_Inc_ADLS_New').output.RowsRead",
													"type": "Expression"
												},
												"type": "Int64"
											},
											"Status": {
												"value": "Success",
												"type": "String"
											}
										}
									},
									"linkedServiceName": {
										"referenceName": "DS_MDW_SP",
										"type": "LinkedServiceReference"
									}
								},
								{
									"name": "Failure_Audit_Log2",
									"type": "SqlServerStoredProcedure",
									"dependsOn": [
										{
											"activity": "Set variable1",
											"dependencyConditions": [
												"Succeeded"
											]
										}
									],
									"policy": {
										"timeout": "7.00:00:00",
										"retry": 0,
										"retryIntervalInSeconds": 30,
										"secureOutput": false,
										"secureInput": false
									},
									"userProperties": [],
									"typeProperties": {
										"storedProcedureName": "[dbo].[proc_UpdateAuditLog_Briggs]",
										"storedProcedureParameters": {
											"ConfigTableID": {
												"value": {
													"value": "@item().ID_Inc",
													"type": "Expression"
												},
												"type": "Int32"
											},
											"RowsRead": {
												"value": null,
												"type": "Int64"
											},
											"Status": {
												"value": {
													"value": "@variables('ErrorMsgInc')",
													"type": "Expression"
												},
												"type": "String"
											}
										}
									},
									"linkedServiceName": {
										"referenceName": "DS_MDW_SP",
										"type": "LinkedServiceReference"
									}
								},
								{
									"name": "Set variable1",
									"type": "SetVariable",
									"dependsOn": [
										{
											"activity": "Copy_Briggs_Inc_ADLS",
											"dependencyConditions": [
												"Failed"
											]
										},
										{
											"activity": "Copy_Briggs_Inc_ADLS_New",
											"dependencyConditions": [
												"Failed"
											]
										}
									],
									"userProperties": [],
									"typeProperties": {
										"variableName": "ErrorMsgInc",
										"value": {
											"value": "@activity('Copy_Briggs_Inc_ADLS').Error.Message",
											"type": "Expression"
										}
									}
								}
							]
						}
					},
					{
						"name": "ForEach_Full_Load",
						"type": "ForEach",
						"dependsOn": [
							{
								"activity": "Lookup2_Full",
								"dependencyConditions": [
									"Succeeded"
								]
							}
						],
						"userProperties": [],
						"typeProperties": {
							"items": {
								"value": "@activity('Lookup2_Full').output.value",
								"type": "Expression"
							},
							"activities": [
								{
									"name": "Lookup_Full",
									"type": "Lookup",
									"dependsOn": [],
									"policy": {
										"timeout": "7.00:00:00",
										"retry": 0,
										"retryIntervalInSeconds": 30,
										"secureOutput": false,
										"secureInput": false
									},
									"userProperties": [],
									"typeProperties": {
										"source": {
											"type": "AzureSqlSource",
											"sqlReaderQuery": {
												"value": "@concat('select SourceQuery=''select '' +columnList+ '' from ''+ sourceDB+''.''+SourceSchemaName+''.''+SourcetableName\n,SourceDB\n,TargetContainer\n, TargetPath, TargetFile, FileFormat,DateField,LastDate,targetstagetableschema,targetstagetablename\nfrom dbo.control_table\nwhere ID= ',item().ID_Full)",
												"type": "Expression"
											},
											"queryTimeout": "02:00:00",
											"partitionOption": "None"
										},
										"dataset": {
											"referenceName": "Briggs_MDW",
											"type": "DatasetReference",
											"parameters": {
												"schema_name": "dbo",
												"table_name": "user"
											}
										}
									}
								},
								{
									"name": "Copy_Briggs_Full_ADLS",
									"type": "Copy",
									"dependsOn": [
										{
											"activity": "Start_Table_Audit",
											"dependencyConditions": [
												"Succeeded"
											]
										}
									],
									"policy": {
										"timeout": "7.00:00:00",
										"retry": 0,
										"retryIntervalInSeconds": 30,
										"secureOutput": false,
										"secureInput": false
									},
									"userProperties": [],
									"typeProperties": {
										"source": {
											"type": "SqlServerSource",
											"sqlReaderQuery": {
												"value": "@activity('Lookup_Full').output.firstRow.SourceQuery\n",
												"type": "Expression"
											},
											"queryTimeout": "02:00:00",
											"partitionOption": "None"
										},
										"sink": {
											"type": "AzureSqlSink",
											"preCopyScript": {
												"value": "@{concat('truncate table ',activity('Lookup_Full').output.firstRow.TargetStageTableSchema,'.',activity('Lookup_Full').output.firstRow.TargetStageTableName)}",
												"type": "Expression"
											},
											"disableMetricsCollection": false
										},
										"enableStaging": false,
										"translator": {
											"type": "TabularTranslator",
											"typeConversion": true,
											"typeConversionSettings": {
												"allowDataTruncation": true,
												"treatBooleanAsNumber": false
											}
										}
									},
									"inputs": [
										{
											"referenceName": "DS_Briggs_MST",
											"type": "DatasetReference",
											"parameters": {}
										}
									],
									"outputs": [
										{
											"referenceName": "Briggs_MDW",
											"type": "DatasetReference",
											"parameters": {
												"schema_name": {
													"value": "@activity('Lookup_Full').output.firstRow.TargetStageTableSchema",
													"type": "Expression"
												},
												"table_name": {
													"value": "@activity('Lookup_Full').output.firstRow.TargetStageTableName",
													"type": "Expression"
												}
											}
										}
									]
								},
								{
									"name": "Copy_Briggs_Full_ADLS_New",
									"type": "Copy",
									"dependsOn": [
										{
											"activity": "Copy_Briggs_Full_ADLS",
											"dependencyConditions": [
												"Failed"
											]
										}
									],
									"policy": {
										"timeout": "7.00:00:00",
										"retry": 0,
										"retryIntervalInSeconds": 30,
										"secureOutput": false,
										"secureInput": false
									},
									"userProperties": [],
									"typeProperties": {
										"source": {
											"type": "SqlServerSource",
											"sqlReaderQuery": {
												"value": "@activity('Lookup_Full').output.firstRow.SourceQuery\n",
												"type": "Expression"
											},
											"queryTimeout": "02:00:00",
											"partitionOption": "None"
										},
										"sink": {
											"type": "AzureSqlSink",
											"writeBehavior": "insert",
											"sqlWriterUseTableLock": false,
											"tableOption": "autoCreate",
											"disableMetricsCollection": false
										},
										"enableStaging": false,
										"translator": {
											"type": "TabularTranslator",
											"typeConversion": true,
											"typeConversionSettings": {
												"allowDataTruncation": true,
												"treatBooleanAsNumber": false
											}
										}
									},
									"inputs": [
										{
											"referenceName": "DS_Briggs_MST",
											"type": "DatasetReference",
											"parameters": {}
										}
									],
									"outputs": [
										{
											"referenceName": "Briggs_MDW",
											"type": "DatasetReference",
											"parameters": {
												"schema_name": {
													"value": "@activity('Lookup_Full').output.firstRow.TargetStageTableSchema",
													"type": "Expression"
												},
												"table_name": {
													"value": "@activity('Lookup_Full').output.firstRow.TargetStageTableName",
													"type": "Expression"
												}
											}
										}
									]
								},
								{
									"name": "Start_Table_Audit",
									"type": "Lookup",
									"dependsOn": [
										{
											"activity": "Lookup_Full",
											"dependencyConditions": [
												"Succeeded"
											]
										}
									],
									"policy": {
										"timeout": "7.00:00:00",
										"retry": 0,
										"retryIntervalInSeconds": 30,
										"secureOutput": false,
										"secureInput": false
									},
									"userProperties": [],
									"typeProperties": {
										"source": {
											"type": "AzureSqlSource",
											"sqlReaderStoredProcedureName": "[dbo].[proc_StartAuditLog_Briggs]",
											"storedProcedureParameters": {
												"ConfigTableID": {
													"type": "Int32",
													"value": {
														"value": "@item().ID_Full",
														"type": "Expression"
													}
												},
												"DataFactoryName": {
													"type": "String",
													"value": {
														"value": "@pipeline().DataFactory",
														"type": "Expression"
													}
												},
												"ParentAuditID": {
													"type": "Int64",
													"value": {
														"value": "@item().ID_Full",
														"type": "Expression"
													}
												},
												"PipelineName": {
													"type": "String",
													"value": {
														"value": "@pipeline().Pipeline",
														"type": "Expression"
													}
												},
												"PipelineRunID": {
													"type": "String",
													"value": {
														"value": "@pipeline().RunId",
														"type": "Expression"
													}
												},
												"PipelineTriggerID": {
													"type": "String",
													"value": {
														"value": "@pipeline().TriggerId",
														"type": "Expression"
													}
												},
												"PipelineTriggerName": {
													"type": "String",
													"value": {
														"value": "@pipeline().TriggerName",
														"type": "Expression"
													}
												},
												"PipelineTriggerType": {
													"type": "String",
													"value": {
														"value": "@pipeline().TriggerType",
														"type": "Expression"
													}
												},
												"Sourcedb": {
													"type": "String",
													"value": {
														"value": "@item().sourceDB",
														"type": "Expression"
													}
												},
												"sourcetable": {
													"type": "String",
													"value": {
														"value": "@item().SourcetableName",
														"type": "Expression"
													}
												}
											},
											"queryTimeout": "02:00:00",
											"partitionOption": "None"
										},
										"dataset": {
											"referenceName": "Briggs_MDW",
											"type": "DatasetReference",
											"parameters": {
												"schema_name": "dbo",
												"table_name": "user"
											}
										},
										"firstRowOnly": false
									}
								},
								{
									"name": "Success_Audit_Log",
									"type": "SqlServerStoredProcedure",
									"dependsOn": [
										{
											"activity": "Copy_Briggs_Full_ADLS",
											"dependencyConditions": [
												"Succeeded"
											]
										}
									],
									"policy": {
										"timeout": "7.00:00:00",
										"retry": 0,
										"retryIntervalInSeconds": 30,
										"secureOutput": false,
										"secureInput": false
									},
									"userProperties": [],
									"typeProperties": {
										"storedProcedureName": "[dbo].[proc_UpdateAuditLog_Briggs]",
										"storedProcedureParameters": {
											"ConfigTableID": {
												"value": {
													"value": "@item().ID_Full",
													"type": "Expression"
												},
												"type": "Int32"
											},
											"RowsRead": {
												"value": {
													"value": "@activity('Copy_Briggs_Full_ADLS').output.RowsRead",
													"type": "Expression"
												},
												"type": "Int64"
											},
											"Status": {
												"value": "Success",
												"type": "String"
											}
										}
									},
									"linkedServiceName": {
										"referenceName": "DS_MDW_SP",
										"type": "LinkedServiceReference"
									}
								},
								{
									"name": "Success_Audit_Log_New",
									"type": "SqlServerStoredProcedure",
									"dependsOn": [
										{
											"activity": "Copy_Briggs_Full_ADLS_New",
											"dependencyConditions": [
												"Succeeded"
											]
										}
									],
									"policy": {
										"timeout": "7.00:00:00",
										"retry": 0,
										"retryIntervalInSeconds": 30,
										"secureOutput": false,
										"secureInput": false
									},
									"userProperties": [],
									"typeProperties": {
										"storedProcedureName": "[dbo].[proc_UpdateAuditLog_Briggs]",
										"storedProcedureParameters": {
											"ConfigTableID": {
												"value": {
													"value": "@item().ID_Full",
													"type": "Expression"
												},
												"type": "Int32"
											},
											"RowsRead": {
												"value": {
													"value": "@activity('Copy_Briggs_Full_ADLS_New').output.RowsRead",
													"type": "Expression"
												},
												"type": "Int64"
											},
											"Status": {
												"value": "Success",
												"type": "String"
											}
										}
									},
									"linkedServiceName": {
										"referenceName": "DS_MDW_SP",
										"type": "LinkedServiceReference"
									}
								},
								{
									"name": "Failure_Audit_Log_New",
									"type": "SqlServerStoredProcedure",
									"dependsOn": [
										{
											"activity": "Set variable2",
											"dependencyConditions": [
												"Succeeded"
											]
										}
									],
									"policy": {
										"timeout": "7.00:00:00",
										"retry": 0,
										"retryIntervalInSeconds": 30,
										"secureOutput": false,
										"secureInput": false
									},
									"userProperties": [],
									"typeProperties": {
										"storedProcedureName": "[dbo].[proc_UpdateAuditLog_Briggs]",
										"storedProcedureParameters": {
											"ConfigTableID": {
												"value": {
													"value": "@item().ID_Full",
													"type": "Expression"
												},
												"type": "Int32"
											},
											"RowsRead": {
												"value": null,
												"type": "Int64"
											},
											"Status": {
												"value": {
													"value": "@variables('ErrorMsgFull')",
													"type": "Expression"
												},
												"type": "String"
											}
										}
									},
									"linkedServiceName": {
										"referenceName": "DS_MDW_SP",
										"type": "LinkedServiceReference"
									}
								},
								{
									"name": "Set variable2",
									"type": "SetVariable",
									"dependsOn": [
										{
											"activity": "Copy_Briggs_Full_ADLS_New",
											"dependencyConditions": [
												"Failed"
											]
										},
										{
											"activity": "Copy_Briggs_Full_ADLS",
											"dependencyConditions": [
												"Failed"
											]
										}
									],
									"userProperties": [],
									"typeProperties": {
										"variableName": "ErrorMsgFull",
										"value": {
											"value": "@activity('Copy_Briggs_Full_ADLS').Error.Message",
											"type": "Expression"
										}
									}
								}
							]
						}
					},
					{
						"name": "ForEach_Proc_Inc",
						"type": "ForEach",
						"dependsOn": [
							{
								"activity": "ForEach_Incremental_Load",
								"dependencyConditions": [
									"Succeeded"
								]
							}
						],
						"userProperties": [],
						"typeProperties": {
							"items": {
								"value": "@activity('Lookup1_Incremental').output.value",
								"type": "Expression"
							},
							"activities": [
								{
									"name": "Stored procedure_Inc",
									"type": "SqlServerStoredProcedure",
									"dependsOn": [],
									"policy": {
										"timeout": "7.00:00:00",
										"retry": 0,
										"retryIntervalInSeconds": 30,
										"secureOutput": false,
										"secureInput": false
									},
									"userProperties": [],
									"typeProperties": {
										"storedProcedureName": "[dbo].[USP_Control_Table_LastDate]",
										"storedProcedureParameters": {
											"id_I_F": {
												"value": {
													"value": "@item().ID_Inc",
													"type": "Expression"
												},
												"type": "Int32"
											}
										}
									},
									"linkedServiceName": {
										"referenceName": "DS_MDW_SP",
										"type": "LinkedServiceReference"
									}
								}
							]
						}
					},
					{
						"name": "ForEach_Proc_Full",
						"type": "ForEach",
						"dependsOn": [
							{
								"activity": "ForEach_Full_Load",
								"dependencyConditions": [
									"Succeeded"
								]
							}
						],
						"userProperties": [],
						"typeProperties": {
							"items": {
								"value": "@activity('Lookup2_Full').output.value",
								"type": "Expression"
							},
							"activities": [
								{
									"name": "Stored procedure_Full",
									"type": "SqlServerStoredProcedure",
									"dependsOn": [],
									"policy": {
										"timeout": "7.00:00:00",
										"retry": 0,
										"retryIntervalInSeconds": 30,
										"secureOutput": false,
										"secureInput": false
									},
									"userProperties": [],
									"typeProperties": {
										"storedProcedureName": "[dbo].[USP_Control_Table_LastDate]",
										"storedProcedureParameters": {
											"id_I_F": {
												"value": {
													"value": "@item().ID_Full",
													"type": "Expression"
												},
												"type": "Int32"
											}
										}
									},
									"linkedServiceName": {
										"referenceName": "DS_MDW_SP",
										"type": "LinkedServiceReference"
									}
								}
							]
						}
					},
					{
						"name": "lkp_ExecStartAuditProc",
						"type": "Lookup",
						"dependsOn": [],
						"policy": {
							"timeout": "7.00:00:00",
							"retry": 0,
							"retryIntervalInSeconds": 30,
							"secureOutput": false,
							"secureInput": false
						},
						"userProperties": [],
						"typeProperties": {
							"source": {
								"type": "AzureSqlSource",
								"sqlReaderStoredProcedureName": "[dbo].[proc_StartAuditLog]",
								"storedProcedureParameters": {
									"ConfigTableID": {
										"type": "Int32",
										"value": "-1"
									},
									"DataFactoryName": {
										"type": "String",
										"value": {
											"value": "@pipeline().DataFactory",
											"type": "Expression"
										}
									},
									"ParentAuditID": {
										"type": "Int64",
										"value": "-1"
									},
									"PipelineName": {
										"type": "String",
										"value": {
											"value": "@concat(pipeline().Pipeline,' Tech Source Table Load')",
											"type": "Expression"
										}
									},
									"PipelineRunID": {
										"type": "String",
										"value": {
											"value": "@pipeline().RunId",
											"type": "Expression"
										}
									},
									"PipelineTriggerID": {
										"type": "String",
										"value": {
											"value": "@pipeline().TriggerId",
											"type": "Expression"
										}
									},
									"PipelineTriggerName": {
										"type": "String",
										"value": {
											"value": "@pipeline().TriggerName",
											"type": "Expression"
										}
									},
									"PipelineTriggerType": {
										"type": "String",
										"value": {
											"value": "@pipeline().TriggerType",
											"type": "Expression"
										}
									}
								},
								"queryTimeout": "02:00:00",
								"partitionOption": "None"
							},
							"dataset": {
								"referenceName": "Briggs_MDW",
								"type": "DatasetReference",
								"parameters": {
									"schema_name": "dbo",
									"table_name": "user"
								}
							}
						}
					},
					{
						"name": "Sp_ExecFailureAudit_Full",
						"type": "SqlServerStoredProcedure",
						"dependsOn": [
							{
								"activity": "ForEach_Full_Load",
								"dependencyConditions": [
									"Failed"
								]
							}
						],
						"policy": {
							"timeout": "7.00:00:00",
							"retry": 0,
							"retryIntervalInSeconds": 30,
							"secureOutput": false,
							"secureInput": false
						},
						"userProperties": [],
						"typeProperties": {
							"storedProcedureName": "[dbo].[proc_UpdateAuditLog]",
							"storedProcedureParameters": {
								"AuditID": {
									"value": {
										"value": "@activity('lkp_ExecStartAuditProc').output.firstRow.AuditID",
										"type": "Expression"
									},
									"type": "Int32"
								},
								"DataLakePath": {
									"value": null,
									"type": "String"
								},
								"PipelineRunID": {
									"value": {
										"value": "@pipeline().RunId",
										"type": "Expression"
									},
									"type": "String"
								},
								"RowsRead": {
									"value": null,
									"type": "Int64"
								},
								"Status": {
									"value": "Full Load Failed",
									"type": "String"
								}
							}
						},
						"linkedServiceName": {
							"referenceName": "AzureSqlDatabase1",
							"type": "LinkedServiceReference"
						}
					},
					{
						"name": "Sp_ExecSuccessAudit",
						"type": "SqlServerStoredProcedure",
						"dependsOn": [
							{
								"activity": "ForEach_Proc_Full",
								"dependencyConditions": [
									"Succeeded"
								]
							},
							{
								"activity": "ForEach_Proc_Inc",
								"dependencyConditions": [
									"Succeeded"
								]
							}
						],
						"policy": {
							"timeout": "7.00:00:00",
							"retry": 0,
							"retryIntervalInSeconds": 30,
							"secureOutput": false,
							"secureInput": false
						},
						"userProperties": [],
						"typeProperties": {
							"storedProcedureName": "[dbo].[proc_UpdateAuditLog]",
							"storedProcedureParameters": {
								"AuditID": {
									"value": {
										"value": "@activity('lkp_ExecStartAuditProc').output.firstRow.AuditID",
										"type": "Expression"
									},
									"type": "Int32"
								},
								"DataLakePath": {
									"value": null,
									"type": "String"
								},
								"RowsRead": {
									"value": null,
									"type": "Int64"
								},
								"Status": {
									"value": "Success",
									"type": "String"
								},
								"PipelineRunID": {
									"value": {
										"value": "@pipeline().RunId",
										"type": "Expression"
									},
									"type": "String"
								}
							}
						},
						"linkedServiceName": {
							"referenceName": "AzureSqlDatabase1",
							"type": "LinkedServiceReference"
						}
					},
					{
						"name": "Sp_ExecFailureAudit_Inc",
						"type": "SqlServerStoredProcedure",
						"dependsOn": [
							{
								"activity": "ForEach_Incremental_Load",
								"dependencyConditions": [
									"Failed"
								]
							}
						],
						"policy": {
							"timeout": "7.00:00:00",
							"retry": 0,
							"retryIntervalInSeconds": 30,
							"secureOutput": false,
							"secureInput": false
						},
						"userProperties": [],
						"typeProperties": {
							"storedProcedureName": "[dbo].[proc_UpdateAuditLog]",
							"storedProcedureParameters": {
								"AuditID": {
									"value": {
										"value": "@activity('lkp_ExecStartAuditProc').output.firstRow.AuditID",
										"type": "Expression"
									},
									"type": "Int32"
								},
								"DataLakePath": {
									"value": null,
									"type": "String"
								},
								"PipelineRunID": {
									"value": {
										"value": "@pipeline().RunId",
										"type": "Expression"
									},
									"type": "String"
								},
								"RowsRead": {
									"value": null,
									"type": "Int64"
								},
								"Status": {
									"value": "Incr Load Failed",
									"type": "String"
								}
							}
						},
						"linkedServiceName": {
							"referenceName": "AzureSqlDatabase1",
							"type": "LinkedServiceReference"
						}
					}
				],
				"policy": {
					"elapsedTimeMetric": {},
					"cancelAfter": {}
				},
				"variables": {
					"ErrorMsgInc": {
						"type": "String"
					},
					"ErrorMsgFull": {
						"type": "String"
					}
				},
				"folder": {
					"name": "Briggs Data Load Theme wise"
				},
				"annotations": [],
				"lastPublishTime": "2022-04-26T07:56:55Z"
			},
			"dependsOn": [
				"[concat(variables('workspaceId'), '/datasets/Briggs_MDW')]",
				"[concat(variables('workspaceId'), '/linkedServices/AzureSqlDatabase1')]",
				"[concat(variables('workspaceId'), '/datasets/DS_Briggs_MST')]",
				"[concat(variables('workspaceId'), '/linkedServices/DS_MDW_SP')]"
			]
		},
		{
			"name": "[concat(parameters('workspaceName'), '/PL_Generic_Loop_ADLS_POR')]",
			"type": "Microsoft.Synapse/workspaces/pipelines",
			"apiVersion": "2019-06-01-preview",
			"properties": {
				"activities": [
					{
						"name": "LoopThroughTables",
						"type": "ForEach",
						"dependsOn": [
							{
								"activity": "lkp_GetTableID",
								"dependencyConditions": [
									"Succeeded"
								]
							}
						],
						"userProperties": [],
						"typeProperties": {
							"items": {
								"value": "@activity('lkp_GetTableID').output.value",
								"type": "Expression"
							},
							"isSequential": false,
							"batchCount": 8,
							"activities": [
								{
									"name": "Exec PL_Generic_Copy_ADLS",
									"type": "ExecutePipeline",
									"dependsOn": [],
									"userProperties": [],
									"typeProperties": {
										"pipeline": {
											"referenceName": "PL_Generic_Copy_ADLS_POR",
											"type": "PipelineReference"
										},
										"waitOnCompletion": true,
										"parameters": {
											"IDValue": {
												"value": "@item().ID",
												"type": "Expression"
											},
											"ParentAuditID": {
												"value": "@pipeline().parameters.ParentAuditID",
												"type": "Expression"
											}
										}
									}
								},
								{
									"name": "Lkp_Failed",
									"type": "Lookup",
									"dependsOn": [
										{
											"activity": "Sp_ExecFailureAudit",
											"dependencyConditions": [
												"Succeeded"
											]
										}
									],
									"policy": {
										"timeout": "7.00:00:00",
										"retry": 0,
										"retryIntervalInSeconds": 30,
										"secureOutput": false,
										"secureInput": false
									},
									"userProperties": [],
									"typeProperties": {
										"source": {
											"type": "AzureSqlSource",
											"sqlReaderQuery": "THROW 60000,'Inner activity failed default, failure for outer activity.',1;",
											"queryTimeout": "02:00:00",
											"partitionOption": "None"
										},
										"dataset": {
											"referenceName": "Briggs_MDW",
											"type": "DatasetReference",
											"parameters": {
												"schema_name": "dbo",
												"table_name": "user"
											}
										}
									}
								},
								{
									"name": "Sp_ExecFailureAudit",
									"type": "SqlServerStoredProcedure",
									"dependsOn": [
										{
											"activity": "Exec PL_Generic_Copy_ADLS",
											"dependencyConditions": [
												"Failed"
											]
										}
									],
									"policy": {
										"timeout": "7.00:00:00",
										"retry": 0,
										"retryIntervalInSeconds": 30,
										"secureOutput": false,
										"secureInput": false
									},
									"userProperties": [],
									"typeProperties": {
										"storedProcedureName": "[dbo].[proc_UpdateAuditLog]",
										"storedProcedureParameters": {
											"AuditID": {
												"value": {
													"value": "@pipeline().parameters.ParentAuditID",
													"type": "Expression"
												},
												"type": "Int32"
											},
											"DataLakePath": {
												"value": null,
												"type": "String"
											},
											"PipelineRunID": {
												"value": {
													"value": "@pipeline().RunId",
													"type": "Expression"
												},
												"type": "String"
											},
											"RowsRead": {
												"value": null,
												"type": "Int64"
											},
											"Status": {
												"value": "Failed",
												"type": "String"
											}
										}
									},
									"linkedServiceName": {
										"referenceName": "AzureSqlDatabase1",
										"type": "LinkedServiceReference"
									}
								}
							]
						}
					},
					{
						"name": "lkp_GetTableID",
						"type": "Lookup",
						"dependsOn": [],
						"policy": {
							"timeout": "7.00:00:00",
							"retry": 0,
							"retryIntervalInSeconds": 30,
							"secureOutput": false,
							"secureInput": false
						},
						"userProperties": [],
						"typeProperties": {
							"source": {
								"type": "AzureSqlSource",
								"sqlReaderQuery": "Select Distinct ID From control_table_por Where EnableAction = 1 AND ProcessName = 'AzSQL_ADLS' \nand SourceDB = 'POR'  \norder by 1",
								"queryTimeout": "02:00:00",
								"partitionOption": "None"
							},
							"dataset": {
								"referenceName": "Briggs_MDW",
								"type": "DatasetReference",
								"parameters": {
									"schema_name": "dbo",
									"table_name": "user"
								}
							},
							"firstRowOnly": false
						}
					},
					{
						"name": "POR_Source_Table_Load",
						"type": "ExecutePipeline",
						"dependsOn": [],
						"userProperties": [],
						"typeProperties": {
							"pipeline": {
								"referenceName": "POR_Source_Table_Load",
								"type": "PipelineReference"
							},
							"waitOnCompletion": true,
							"parameters": {}
						}
					}
				],
				"policy": {
					"elapsedTimeMetric": {},
					"cancelAfter": {}
				},
				"parameters": {
					"ParentAuditID": {
						"type": "int"
					}
				},
				"folder": {
					"name": "MDP POR DataLoad"
				},
				"annotations": [],
				"lastPublishTime": "2022-03-29T07:20:03Z"
			},
			"dependsOn": [
				"[concat(variables('workspaceId'), '/datasets/Briggs_MDW')]",
				"[concat(variables('workspaceId'), '/pipelines/POR_Source_Table_Load')]",
				"[concat(variables('workspaceId'), '/pipelines/PL_Generic_Copy_ADLS_POR')]",
				"[concat(variables('workspaceId'), '/linkedServices/AzureSqlDatabase1')]"
			]
		},
		{
			"name": "[concat(parameters('workspaceName'), '/PL_Load_Dimension_Stage_Tables')]",
			"type": "Microsoft.Synapse/workspaces/pipelines",
			"apiVersion": "2019-06-01-preview",
			"properties": {
				"activities": [
					{
						"name": "Dim_Branch_v2",
						"type": "Copy",
						"dependsOn": [],
						"policy": {
							"timeout": "7.00:00:00",
							"retry": 0,
							"retryIntervalInSeconds": 30,
							"secureOutput": false,
							"secureInput": false
						},
						"userProperties": [],
						"typeProperties": {
							"source": {
								"type": "SqlServerSource",
								"sqlReaderQuery": "with p_addr_newest as(\n  select \n    ddv.displayvalue, \n    max(la.recid) 'max_loc' \n  from \n    [briggs_mst].dbo.inventlocationlogisticslocationprimary ilv \n    left join briggs_mst.dbo.logisticspostaladdressview lpa on ilv.location = lpa.location \n    inner join briggs_mst.dbo.logisticslocation la on la.recid = lpa.location \n    left join briggs_mst.dbo.inventlocation i on i.recid = ilv.inventlocation \n    left join briggs_mst.dbo.defaultdimensionview ddv on ddv.defaultdimension = i.defaultdimension \n    and ddv.dimensionattributeid = 5637145333 \n  where \n    lpa.validto >= getdate() \n    and i.inventsiteid = 'PARTS' \n    and i.inventlocationid LIKE 'P%' \n    and i.name not like '%DO NOT USE%' \n  group by \n    ddv.displayvalue\n), \np_addr as(\n  select \n    distinct ddv.displayvalue 'branch_id', \n    right(ddv.displayvalue, 2) 'branch_id_short', \n    lpa.street, \n    lpa.zipcode, \n    lpa.city, \n    lpa.state, \n    lv.isocode, \n    lpa.countryregionid, \n    lv.countrycurrencycode, \n    lpa.address, \n    il.inventlocationid, \n    lpa.timezone 'time_zone_id' \n  from \n    [briggs_mst].dbo.inventlocation il \n    inner join [briggs_mst].dbo.inventlocationlogisticslocationprimary a on il.recid = a.inventlocation \n    left join briggs_mst.dbo.logisticspostaladdressview lv on lv.location = a.location \n    and lv.validto >= getdate() \n    left join briggs_mst.dbo.defaultdimensionview ddv on ddv.defaultdimension = il.defaultdimension \n    and ddv.dimensionattributeid = 5637145333 \n    left join briggs_mst.dbo.logisticspostaladdress lpa on lpa.location = lv.location \n    and lpa.validto >= getdate() \n    inner join briggs_mst.dbo.logisticslocation la on la.recid = lpa.location \n    inner join p_addr_newest pn on pn.displayvalue = ddv.displayvalue \n    and pn.max_loc = la.recid \n  where \n    il.INVENTSITEID = 'PARTS' \n    AND il.INVENTLOCATIONID LIKE 'P%'\n) \nselect \n  distinct br.[value] 'branch_id' ----\n  , \n  dir.[name] 'branch_name' -----\n  , \n  isnull(\n    isnull(p_addr.address, pc.address), \n    'Unknown'\n  ) 'address' ---\n  , \n  isnull(\n    isnull(p_addr.street, pc.street), \n    'Unknown'\n  ) 'street' ---\n  , \n  isnull(\n    isnull(p_addr.city, pc.city), \n    'Unknown'\n  ) 'city' ---\n  , \n  isnull(\n    isnull(p_addr.state, pc.state), \n    'Unknown'\n  ) 'state' ----\n  , \n  isnull(\n    cast(\n      isnull(p_addr.zipcode, pc.zipcode) as varchar(20)\n    ), \n    'Unknown'\n  ) 'zipcode' ----\nfrom \n  [briggs_mst].[dbo].[dimattributeomcostcenter] br \n  left join briggs_mst.dbo.omoperatingunitview om on om.recid = br.[recid] \n  left join briggs_mst.dbo.dirpartytable dir on dir.partynumber = om.partynumber \n  left join p_addr on p_addr.branch_id = br.[value] \n  left join p_addr pc on pc.branch_id_short = right(br.[value], 2)",
								"queryTimeout": "02:00:00",
								"partitionOption": "None"
							},
							"sink": {
								"type": "AzureSqlSink",
								"preCopyScript": "truncate table Briggs.Stage_Dim_Branch",
								"disableMetricsCollection": false
							},
							"enableStaging": false,
							"translator": {
								"type": "TabularTranslator",
								"mappings": [
									{
										"source": {
											"name": "branch_id",
											"type": "String",
											"physicalType": "nvarchar"
										},
										"sink": {
											"name": "branch_id",
											"type": "String",
											"physicalType": "nvarchar"
										}
									},
									{
										"source": {
											"name": "branch_name",
											"type": "String",
											"physicalType": "nvarchar"
										},
										"sink": {
											"name": "branch_name",
											"type": "String",
											"physicalType": "nvarchar"
										}
									},
									{
										"source": {
											"name": "address",
											"type": "String",
											"physicalType": "nvarchar"
										},
										"sink": {
											"name": "address",
											"type": "String",
											"physicalType": "nvarchar"
										}
									},
									{
										"source": {
											"name": "street",
											"type": "String",
											"physicalType": "nvarchar"
										},
										"sink": {
											"name": "street",
											"type": "String",
											"physicalType": "nvarchar"
										}
									},
									{
										"source": {
											"name": "city",
											"type": "String",
											"physicalType": "nvarchar"
										},
										"sink": {
											"name": "city",
											"type": "String",
											"physicalType": "nvarchar"
										}
									},
									{
										"source": {
											"name": "state",
											"type": "String",
											"physicalType": "nvarchar"
										},
										"sink": {
											"name": "state",
											"type": "String",
											"physicalType": "nvarchar"
										}
									},
									{
										"source": {
											"name": "zipcode",
											"type": "String",
											"physicalType": "varchar"
										},
										"sink": {
											"name": "zipcode",
											"type": "String",
											"physicalType": "varchar"
										}
									}
								],
								"typeConversion": true,
								"typeConversionSettings": {
									"allowDataTruncation": true,
									"treatBooleanAsNumber": false
								}
							}
						},
						"inputs": [
							{
								"referenceName": "DS_BriggsAX",
								"type": "DatasetReference",
								"parameters": {}
							}
						],
						"outputs": [
							{
								"referenceName": "Briggs_MDW",
								"type": "DatasetReference",
								"parameters": {
									"schema_name": "Briggs",
									"table_name": "Stage_Dim_Branch"
								}
							}
						]
					},
					{
						"name": "Dim_CUSTOMER",
						"type": "Copy",
						"dependsOn": [
							{
								"activity": "Dim_Branch_v2",
								"dependencyConditions": [
									"Succeeded"
								]
							}
						],
						"policy": {
							"timeout": "7.00:00:00",
							"retry": 0,
							"retryIntervalInSeconds": 30,
							"secureOutput": false,
							"secureInput": false
						},
						"userProperties": [],
						"typeProperties": {
							"source": {
								"type": "SqlServerSource",
								"sqlReaderQuery": "select \n  ct.accountnum 'customer_id' ----\n  , \n  dir.name 'customer_name' ---\n  , \n  ct.accountnum + ' - ' + dir.name 'customer' ---\n  , \n  case when ct.invoiceaccount = '' then 'Bill-to' when ct.invoiceaccount <> '' then 'Ship-to' else null end 'customer_account_type' ---\n  --,isnull(cast([date_opened] as date),cast(ct.createddatetime as date)) \n  ,cast(null as date)date_account_opened----\n  , \n  rtrim(\n    ltrim(\n      case when ccg.description like 'TAA%' then ccg.description else isnull(\n        substring(\n          ccg.description, \n          charindex('-', ccg.description)+ 1, \n          len(ccg.description)\n        ), \n        'NO REP'\n      ) end\n    )\n  ) 'collections_agent' ----\n  , \n  case when ct.blocked = 0 then 'None' when ct.blocked = 3 then 'Payment' when ct.blocked = 20 then 'Stopped' when ct.blocked = 2 then 'All' else 'None' end 'account_hold_type' ---\n  , \n  cast(ct.creditmax as money) 'credit_limit' ----\n  --,isnull(sp.salesperson_name_ax,'unassigned') \n  ,'' assigned_salesperson-------\nfrom \n  briggs_mst.dbo.custtable ct \n  left join briggs_mst.dbo.dirpartytable dir on dir.recid = ct.party \n  left join briggs_mst.dbo.xap_creditcustomergroups ccg on ccg.recid = ct.creditcustomergroups",
								"queryTimeout": "02:00:00",
								"partitionOption": "None"
							},
							"sink": {
								"type": "AzureSqlSink",
								"preCopyScript": "truncate table Briggs.Stage_Dim_Customer",
								"disableMetricsCollection": false
							},
							"enableStaging": false,
							"translator": {
								"type": "TabularTranslator",
								"mappings": [
									{
										"source": {
											"name": "customer_id",
											"type": "String",
											"physicalType": "nvarchar"
										},
										"sink": {
											"name": "customer_id",
											"type": "String",
											"physicalType": "nvarchar"
										}
									},
									{
										"source": {
											"name": "customer_name",
											"type": "String",
											"physicalType": "nvarchar"
										},
										"sink": {
											"name": "customer_name",
											"type": "String",
											"physicalType": "nvarchar"
										}
									},
									{
										"source": {
											"name": "customer",
											"type": "String",
											"physicalType": "nvarchar"
										},
										"sink": {
											"name": "CUSTOMER",
											"type": "String",
											"physicalType": "nvarchar"
										}
									},
									{
										"source": {
											"name": "customer_account_type",
											"type": "String",
											"physicalType": "varchar"
										},
										"sink": {
											"name": "Customer_Account_Type",
											"type": "String",
											"physicalType": "varchar"
										}
									},
									{
										"source": {
											"name": "date_account_opened",
											"type": "DateTime",
											"physicalType": "date"
										},
										"sink": {
											"name": "Date_Account_Opened",
											"type": "DateTime",
											"physicalType": "date"
										}
									},
									{
										"source": {
											"name": "collections_agent",
											"type": "String",
											"physicalType": "nvarchar"
										},
										"sink": {
											"name": "Collections_Agent",
											"type": "String",
											"physicalType": "nvarchar"
										}
									},
									{
										"source": {
											"name": "account_hold_type",
											"type": "String",
											"physicalType": "varchar"
										},
										"sink": {
											"name": "Account_Hold_Type",
											"type": "String",
											"physicalType": "varchar"
										}
									},
									{
										"source": {
											"name": "credit_limit",
											"type": "Decimal",
											"physicalType": "money",
											"scale": 4,
											"precision": 19
										},
										"sink": {
											"name": "Credit_Limit",
											"type": "Decimal",
											"physicalType": "money",
											"scale": 4,
											"precision": 19
										}
									},
									{
										"source": {
											"name": "assigned_salesperson",
											"type": "String",
											"physicalType": "varchar"
										},
										"sink": {
											"name": "Assigned_Salesperson",
											"type": "String",
											"physicalType": "nvarchar"
										}
									}
								],
								"typeConversion": true,
								"typeConversionSettings": {
									"allowDataTruncation": true,
									"treatBooleanAsNumber": false
								}
							}
						},
						"inputs": [
							{
								"referenceName": "DS_BriggsAX",
								"type": "DatasetReference",
								"parameters": {}
							}
						],
						"outputs": [
							{
								"referenceName": "Briggs_MDW",
								"type": "DatasetReference",
								"parameters": {
									"schema_name": "Briggs",
									"table_name": "Stage_Dim_Customer"
								}
							}
						]
					},
					{
						"name": "Dim_Department",
						"type": "Copy",
						"dependsOn": [
							{
								"activity": "Dim_CUSTOMER",
								"dependencyConditions": [
									"Succeeded"
								]
							}
						],
						"policy": {
							"timeout": "7.00:00:00",
							"retry": 0,
							"retryIntervalInSeconds": 30,
							"secureOutput": false,
							"secureInput": false
						},
						"userProperties": [],
						"typeProperties": {
							"source": {
								"type": "SqlServerSource",
								"sqlReaderQuery": "select \n  o.[omoperatingunitnumber] 'department_id', \n  replace(o.[name], ' Dept', '') 'department', \n  case when o.omoperatingunitnumber like '2%' \n  and o.omoperatingunitnumber <> '28' then 'Operations' when o.omoperatingunitnumber like '3%' \n  or o.omoperatingunitnumber = '28' then 'Sales' when o.omoperatingunitnumber like '8%' then 'Support' else 'Unknown' end 'primary_function', \n  case when o.omoperatingunitnumber = '24' then 'Sales' when o.omoperatingunitnumber = '28' then 'Operations' when o.omoperatingunitnumber = '32' then 'Support' when o.omoperatingunitnumber like '2%' then 'Operations' when o.omoperatingunitnumber like '3%' then 'Sales' when o.omoperatingunitnumber like '8%' then 'Support' else 'Unknown' end 'secondary_function', \n  isnull(dir2.name, 'No Leader') 'department_head' \nfrom \n  [briggs_mst].[dbo].[omdepartmentview] o \n  left join briggs_mst.dbo.dirpartytable dir on dir.partynumber = o.partynumber \n  left join briggs_mst.dbo.hcmworker hcm on hcm.recid = dir.hcmworker \n  left join briggs_mst.dbo.dirpartytable dir2 on dir2.recid = hcm.person \nwhere \n  o.omoperatingunitnumber <> '00'",
								"queryTimeout": "02:00:00",
								"partitionOption": "None"
							},
							"sink": {
								"type": "AzureSqlSink",
								"preCopyScript": "truncate table Briggs.Stage_Dim_Department",
								"disableMetricsCollection": false
							},
							"enableStaging": false,
							"translator": {
								"type": "TabularTranslator",
								"mappings": [
									{
										"source": {
											"name": "department_id",
											"type": "String",
											"physicalType": "nvarchar"
										},
										"sink": {
											"name": "DEPARTMENT_ID",
											"type": "String",
											"physicalType": "nvarchar"
										}
									},
									{
										"source": {
											"name": "department",
											"type": "String",
											"physicalType": "nvarchar"
										},
										"sink": {
											"name": "Department",
											"type": "String",
											"physicalType": "nvarchar"
										}
									},
									{
										"source": {
											"name": "primary_function",
											"type": "String",
											"physicalType": "varchar"
										},
										"sink": {
											"name": "Primary_Function",
											"type": "String",
											"physicalType": "varchar"
										}
									},
									{
										"source": {
											"name": "secondary_function",
											"type": "String",
											"physicalType": "varchar"
										},
										"sink": {
											"name": "Secondary_Function",
											"type": "String",
											"physicalType": "varchar"
										}
									},
									{
										"source": {
											"name": "department_head",
											"type": "String",
											"physicalType": "nvarchar"
										},
										"sink": {
											"name": "Department_Head",
											"type": "String",
											"physicalType": "nvarchar"
										}
									}
								],
								"typeConversion": true,
								"typeConversionSettings": {
									"allowDataTruncation": true,
									"treatBooleanAsNumber": false
								}
							}
						},
						"inputs": [
							{
								"referenceName": "DS_BriggsAX",
								"type": "DatasetReference",
								"parameters": {}
							}
						],
						"outputs": [
							{
								"referenceName": "Briggs_MDW",
								"type": "DatasetReference",
								"parameters": {
									"schema_name": "Briggs",
									"table_name": "Stage_Dim_Department"
								}
							}
						]
					},
					{
						"name": "Dim_Employee_Current",
						"type": "Copy",
						"dependsOn": [],
						"policy": {
							"timeout": "7.00:00:00",
							"retry": 0,
							"retryIntervalInSeconds": 30,
							"secureOutput": false,
							"secureInput": false
						},
						"userProperties": [],
						"typeProperties": {
							"source": {
								"type": "SqlServerSource",
								"sqlReaderQuery": "with max_roster as(\n  select \n    max(file_date) 'last_date', \n    employee_id \n  from \n    briggsax.dbo.roster_employee \n  group by \n    employee_id\n) \nselect \n  distinct e.employee_id 'employee_id', \n  e.employee_name 'name_lfm', \n  case when e.[status] like 'Term%' then 'Terminated' when e.[Status] like 'Inact%' then 'Inactive' else e.[status] end 'employment_status', \n  isnull(db.branch, 'historical branch') 'branch_name', \n  dd.department 'department', \n  jj.categorydescription 'job_category', \n  e.[job] 'job', \n  e.last_hire_date 'last_hire_date', \n  isnull(m.Employee_Name, 'Unknown') 'supervisor_name_lfm' \nfrom \n  [briggsax].[dbo].[roster_employee] e \n  left join [briggsax].[dbo].[roster_employee] m on m.employee_id = e.supervisor_employee_id \n  and m.file_date = e.file_date \n  left join briggshr.dbo.glcodesdepartments g on cast(g.glcode as varchar) = cast(\n    e.position_ledger_code as varchar\n  ) \n  and cast(g.departmentcode as varchar) = cast(e.department as varchar) \n  left join briggshr.dbo.jobcategory jj on jj.categorycode = g.categorycode \n  inner join max_roster mm on mm.employee_id = e.employee_id \n  and mm.last_date = e.file_date \n  left join data_warehouse_tables.dbo.dim_branch db on db.branch_id = e.branch \n  left join data_warehouse_tables.dbo.dim_department dd on dd.department_id = e.department",
								"queryTimeout": "02:00:00",
								"partitionOption": "None"
							},
							"sink": {
								"type": "AzureSqlSink",
								"preCopyScript": "Truncate table Briggs.Stage_Dim_Employee_C",
								"disableMetricsCollection": false
							},
							"enableStaging": false,
							"translator": {
								"type": "TabularTranslator",
								"mappings": [
									{
										"source": {
											"name": "employee_id",
											"type": "String",
											"physicalType": "nvarchar"
										},
										"sink": {
											"name": "Employee_ID",
											"type": "String",
											"physicalType": "nvarchar"
										}
									},
									{
										"source": {
											"name": "name_lfm",
											"type": "String",
											"physicalType": "nvarchar"
										},
										"sink": {
											"name": "Name_LFM",
											"type": "String",
											"physicalType": "nvarchar"
										}
									},
									{
										"source": {
											"name": "employment_status",
											"type": "String",
											"physicalType": "nvarchar"
										},
										"sink": {
											"name": "Employment_Status",
											"type": "String",
											"physicalType": "nvarchar"
										}
									},
									{
										"source": {
											"name": "branch_name",
											"type": "String",
											"physicalType": "nvarchar"
										},
										"sink": {
											"name": "BRANCH_NAME",
											"type": "String",
											"physicalType": "nvarchar"
										}
									},
									{
										"source": {
											"name": "department",
											"type": "String",
											"physicalType": "nvarchar"
										},
										"sink": {
											"name": "Department",
											"type": "String",
											"physicalType": "nvarchar"
										}
									},
									{
										"source": {
											"name": "job_category",
											"type": "String",
											"physicalType": "nvarchar"
										},
										"sink": {
											"name": "Job_Category",
											"type": "String",
											"physicalType": "nvarchar"
										}
									},
									{
										"source": {
											"name": "job",
											"type": "String",
											"physicalType": "nvarchar"
										},
										"sink": {
											"name": "Job",
											"type": "String",
											"physicalType": "nvarchar"
										}
									},
									{
										"source": {
											"name": "last_hire_date",
											"type": "DateTime",
											"physicalType": "date"
										},
										"sink": {
											"name": "Last_Hire_Date",
											"type": "DateTime",
											"physicalType": "date"
										}
									},
									{
										"source": {
											"name": "supervisor_name_lfm",
											"type": "String",
											"physicalType": "nvarchar"
										},
										"sink": {
											"name": "Supervisor_Name_LFM",
											"type": "String",
											"physicalType": "nvarchar"
										}
									}
								],
								"typeConversion": true,
								"typeConversionSettings": {
									"allowDataTruncation": true,
									"treatBooleanAsNumber": false
								}
							}
						},
						"inputs": [
							{
								"referenceName": "DS_BriggsAX",
								"type": "DatasetReference",
								"parameters": {}
							}
						],
						"outputs": [
							{
								"referenceName": "Briggs_MDW",
								"type": "DatasetReference",
								"parameters": {
									"schema_name": "Briggs",
									"table_name": "Stage_Dim_Employee_C"
								}
							}
						]
					},
					{
						"name": "Dim_GL_Account",
						"type": "Copy",
						"dependsOn": [
							{
								"activity": "Dim_Employee_Current",
								"dependencyConditions": [
									"Succeeded"
								]
							}
						],
						"policy": {
							"timeout": "7.00:00:00",
							"retry": 0,
							"retryIntervalInSeconds": 30,
							"secureOutput": false,
							"secureInput": false
						},
						"userProperties": [],
						"typeProperties": {
							"source": {
								"type": "SqlServerSource",
								"sqlReaderQuery": "select \n  m.recid 'sk_ledger_account_bigint', \n  m.mainaccountid 'ledger_account_id', \n  m.name 'ledger_account', \n  mc.description 'description', \n  mc.accountcategory 'account_category', \n  mc.accounttype 'account_type' \nfrom \n  briggs_mst.dbo.mainaccount m \n  left join briggs_mst.dbo.mainaccountcategory mc on mc.accountcategoryref = m.accountcategoryref",
								"queryTimeout": "02:00:00",
								"partitionOption": "None"
							},
							"sink": {
								"type": "AzureSqlSink",
								"preCopyScript": "Truncate table Briggs.Stage_Dim_GL_Account",
								"disableMetricsCollection": false
							},
							"enableStaging": false,
							"translator": {
								"type": "TabularTranslator",
								"mappings": [
									{
										"source": {
											"name": "ledger_account_id",
											"type": "String",
											"physicalType": "nvarchar"
										},
										"sink": {
											"name": "Ledger_Account_ID",
											"type": "String",
											"physicalType": "nvarchar"
										}
									},
									{
										"source": {
											"name": "ledger_account",
											"type": "String",
											"physicalType": "nvarchar"
										},
										"sink": {
											"name": "Ledger_Account",
											"type": "String",
											"physicalType": "nvarchar"
										}
									},
									{
										"source": {
											"name": "description",
											"type": "String",
											"physicalType": "nvarchar"
										},
										"sink": {
											"name": "Description",
											"type": "String",
											"physicalType": "nvarchar"
										}
									},
									{
										"source": {
											"name": "account_category",
											"type": "String",
											"physicalType": "nvarchar"
										},
										"sink": {
											"name": "Account_Category",
											"type": "String",
											"physicalType": "nvarchar"
										}
									},
									{
										"source": {
											"name": "account_type",
											"type": "Int32",
											"physicalType": "int"
										},
										"sink": {
											"name": "Account_Type",
											"type": "Int32",
											"physicalType": "int"
										}
									}
								],
								"typeConversion": true,
								"typeConversionSettings": {
									"allowDataTruncation": true,
									"treatBooleanAsNumber": false
								}
							}
						},
						"inputs": [
							{
								"referenceName": "DS_BriggsAX",
								"type": "DatasetReference",
								"parameters": {}
							}
						],
						"outputs": [
							{
								"referenceName": "Briggs_MDW",
								"type": "DatasetReference",
								"parameters": {
									"schema_name": "Briggs",
									"table_name": "Stage_Dim_GL_Account"
								}
							}
						]
					},
					{
						"name": "Dim_Warehouse",
						"type": "Copy",
						"dependsOn": [
							{
								"activity": "Dim_GL_Account",
								"dependencyConditions": [
									"Succeeded"
								]
							}
						],
						"policy": {
							"timeout": "7.00:00:00",
							"retry": 0,
							"retryIntervalInSeconds": 30,
							"secureOutput": false,
							"secureInput": false
						},
						"userProperties": [],
						"typeProperties": {
							"source": {
								"type": "SqlServerSource",
								"sqlReaderQuery": "with p_addr as(\n  select \n    --distinct\n    il.inventlocationid, \n    street, \n    zipcode, \n    city, \n    state, \n    address \n  from \n    [briggs_mst].dbo.inventlocation il \n    left join [briggs_mst].dbo.inventlocationlogisticslocationprimary a on il.recid = a.inventlocation \n    left join logisticspostaladdressview lv on lv.location = a.location \n    and lv.validto >= getdate() \n  where \n    il.inventlocationid like 'P%'\n), \ne_addr as(\n  select \n    --distinct\n    il.inventlocationid, \n    street, \n    zipcode, \n    city, \n    state, \n    address \n  from \n    [briggs_mst].dbo.inventlocation il \n    left join [briggs_mst].dbo.inventlocationlogisticslocationprimary a on il.recid = a.inventlocation \n    left join logisticspostaladdressview lv on lv.location = a.location \n    and lv.validto >= getdate() \n  where \n    il.inventlocationid like 'E%'\n), \nwh as(\n  select \n    o.VALUE, \n    il.inventlocationid \n  from \n    inventlocation il \n    inner join defaultdimensionview ddv on ddv.defaultdimension = il.defaultdimension \n    and ddv.dimensionattributeid = 5637145333 \n    inner join dimattributeomcostcenter o on o.[value] = ddv.displayvalue\n), \nsvc_wip as(\n  select \n    svc.inventlocationid, \n    count(*) 'open' \n  from \n    cache_openservicedetails svc \n  group by \n    svc.inventlocationid\n), \nsls_wip as(\n  select \n    st.inventlocationid, \n    count(*) 'open' \n  from \n    salestable st \n  where \n    st.salesstatus = 2 \n  group by \n    st.inventlocationid\n) \nselect \n  a.inventlocationid 'warehouse_id' ---\n  , \n  case when a.inventsiteid = 'PARTS' then 'Parts - ' when a.INVENTSITEID = 'EQUIPMENT' then 'Equipment - ' end + br.NAME 'Warehouse' ----\n  , \n  a.inventsiteid 'site' ---\n  , \n  case when isnull(sls_wip.[Open], 0) + isnull(svc_wip.[Open], 0) = 0 then 'Inactive' else 'Active' end 'Transaction_Status' ---\n  , \n  br.[value] 'branch_id' ---\n  , \n  br.[name] 'branch' ---\n  , \n  isnull(\n    isnull(e.ADDRESS, p.ADDRESS), \n    'Unknown Address'\n  ) 'address' ---\n  , \n  isnull(\n    isnull(e.street, p.street), \n    'Unknown Address'\n  ) 'street' ---\n  , \n  isnull(\n    isnull(e.city, p.city), \n    'Unknown Address'\n  ) 'city' ---\n  , \n  isnull(\n    isnull(e.state, p.state), \n    'Unknown Address'\n  ) 'state' ---\n  , \n  isnull(\n    isnull(e.zipcode, p.zipcode), \n    'Unknown Address'\n  ) 'zip_code' ---\n  , \n  a.inventlocationidtransit 'transit_id' ----\nfrom \n  dimattributeomcostcenter br \n  left join wh on wh.[value] = br.[value] \n  left join inventlocation a on wh.[inventlocationid] = a.inventlocationid \n  left join e_addr e on e.inventlocationid = a.inventlocationid \n  left join p_addr p on p.inventlocationid = a.inventlocationid \n  left join svc_wip on svc_wip.inventlocationid = a.inventlocationid \n  left join sls_wip on sls_wip.inventlocationid = a.inventlocationid \nwhere \n  (\n    (a.inventlocationid like 'P%') \n    or (a.inventlocationid like 'E%')\n  )\n",
								"queryTimeout": "02:00:00",
								"partitionOption": "None"
							},
							"sink": {
								"type": "AzureSqlSink",
								"preCopyScript": "Truncate table Briggs.Stage_Dim_Warehouse"
							},
							"enableStaging": false,
							"translator": {
								"type": "TabularTranslator",
								"mappings": [
									{
										"source": {
											"name": "warehouse_id",
											"type": "String",
											"physicalType": "nvarchar"
										},
										"sink": {
											"name": "Warehouse_ID",
											"type": "String",
											"physicalType": "nvarchar"
										}
									},
									{
										"source": {
											"name": "Warehouse",
											"type": "String",
											"physicalType": "nvarchar"
										},
										"sink": {
											"name": "Warehouse",
											"type": "String",
											"physicalType": "nvarchar"
										}
									},
									{
										"source": {
											"name": "site",
											"type": "String",
											"physicalType": "nvarchar"
										},
										"sink": {
											"name": "Site",
											"type": "String",
											"physicalType": "nvarchar"
										}
									},
									{
										"source": {
											"name": "Transaction_Status",
											"type": "String",
											"physicalType": "varchar"
										},
										"sink": {
											"name": "Transaction_Status",
											"type": "String",
											"physicalType": "varchar"
										}
									},
									{
										"source": {
											"name": "branch_id",
											"type": "String",
											"physicalType": "nvarchar"
										},
										"sink": {
											"name": "Branch_ID",
											"type": "String",
											"physicalType": "nvarchar"
										}
									},
									{
										"source": {
											"name": "address",
											"type": "String",
											"physicalType": "nvarchar"
										},
										"sink": {
											"name": "Address",
											"type": "String",
											"physicalType": "nvarchar"
										}
									},
									{
										"source": {
											"name": "street",
											"type": "String",
											"physicalType": "nvarchar"
										},
										"sink": {
											"name": "Street",
											"type": "String",
											"physicalType": "nvarchar"
										}
									},
									{
										"source": {
											"name": "city",
											"type": "String",
											"physicalType": "nvarchar"
										},
										"sink": {
											"name": "City",
											"type": "String",
											"physicalType": "nvarchar"
										}
									},
									{
										"source": {
											"name": "state",
											"type": "String",
											"physicalType": "nvarchar"
										},
										"sink": {
											"name": "State",
											"type": "String",
											"physicalType": "nvarchar"
										}
									},
									{
										"source": {
											"name": "zip_code",
											"type": "String",
											"physicalType": "nvarchar"
										},
										"sink": {
											"name": "Zip_Code",
											"type": "String",
											"physicalType": "nvarchar"
										}
									},
									{
										"source": {
											"name": "transit_id",
											"type": "String",
											"physicalType": "nvarchar"
										},
										"sink": {
											"name": "Transit_ID",
											"type": "String",
											"physicalType": "nvarchar"
										}
									}
								],
								"typeConversion": true,
								"typeConversionSettings": {
									"allowDataTruncation": true,
									"treatBooleanAsNumber": false
								}
							}
						},
						"inputs": [
							{
								"referenceName": "Briggs_MST",
								"type": "DatasetReference",
								"parameters": {}
							}
						],
						"outputs": [
							{
								"referenceName": "Briggs_MDW",
								"type": "DatasetReference",
								"parameters": {
									"schema_name": "Briggs",
									"table_name": "Stage_Dim_Warehouse"
								}
							}
						]
					},
					{
						"name": "Dim_Territory_Salesperson_Comm",
						"type": "Copy",
						"dependsOn": [
							{
								"activity": "Dim_Warehouse",
								"dependencyConditions": [
									"Succeeded"
								]
							}
						],
						"policy": {
							"timeout": "7.00:00:00",
							"retry": 0,
							"retryIntervalInSeconds": 30,
							"secureOutput": false,
							"secureInput": false
						},
						"userProperties": [],
						"typeProperties": {
							"source": {
								"type": "SqlServerSource",
								"sqlReaderQuery": "select \n  distinct cs.territory 'territory_salesperson_id' ----\n  , \n  db.branch 'territory_salesperson_branch' -----\n  , \n  isnull(db2.branch, 'unknown') 'territory_salesperson_default_branch' ----\n  , \n  cs.division 'territory_salesperson_division' ---\n  , \n  cs.[type] 'territory_salesperson_plan' ----\nfrom \n  briggsax.dbo.commissions_salespeople cs \n  left join(\n    select \n      distinct br.[value] 'branch_id', \n      dir.[name] 'branch' \n    from \n      [briggs_mst].[dbo].[dimattributeomcostcenter] br \n      left join briggs_mst.dbo.omoperatingunitview om on om.recid = br.[recid] \n      left join briggs_mst.dbo.dirpartytable dir on dir.partynumber = om.partynumber\n  ) db on db.branch_id = cs.branch \n  left join (\n    select \n      distinct br.[value] 'branch_id', \n      dir.[name] 'branch' \n    from \n      [briggs_mst].[dbo].[dimattributeomcostcenter] br \n      left join briggs_mst.dbo.omoperatingunitview om on om.recid = br.[recid] \n      left join briggs_mst.dbo.dirpartytable dir on dir.partynumber = om.partynumber\n  ) db2 on db2.branch_id = cs.defaultbranch",
								"queryTimeout": "02:00:00",
								"partitionOption": "None"
							},
							"sink": {
								"type": "AzureSqlSink",
								"preCopyScript": "Truncate table Briggs.Stage_Dim_Territory_Salesperson",
								"disableMetricsCollection": false
							},
							"enableStaging": false,
							"translator": {
								"type": "TabularTranslator",
								"mappings": [
									{
										"source": {
											"name": "territory_salesperson_id",
											"type": "String",
											"physicalType": "nvarchar"
										},
										"sink": {
											"name": "Territory_Salesperson_ID",
											"type": "String",
											"physicalType": "nvarchar"
										}
									},
									{
										"source": {
											"name": "territory_salesperson_branch",
											"type": "String",
											"physicalType": "nvarchar"
										},
										"sink": {
											"name": "Territory_Salesperson_Branch",
											"type": "String",
											"physicalType": "nvarchar"
										}
									},
									{
										"source": {
											"name": "territory_salesperson_default_branch",
											"type": "String",
											"physicalType": "nvarchar"
										},
										"sink": {
											"name": "Territory_Salesperson_Default_Branch",
											"type": "String",
											"physicalType": "nvarchar"
										}
									},
									{
										"source": {
											"name": "territory_salesperson_division",
											"type": "String",
											"physicalType": "varchar"
										},
										"sink": {
											"name": "Territory_Salesperson_Division",
											"type": "String",
											"physicalType": "varchar"
										}
									},
									{
										"source": {
											"name": "territory_salesperson_plan",
											"type": "String",
											"physicalType": "nvarchar"
										},
										"sink": {
											"name": "Territory_Salesperson_Plan",
											"type": "String",
											"physicalType": "nvarchar"
										}
									}
								],
								"typeConversion": true,
								"typeConversionSettings": {
									"allowDataTruncation": true,
									"treatBooleanAsNumber": false
								}
							}
						},
						"inputs": [
							{
								"referenceName": "DS_BriggsAX",
								"type": "DatasetReference",
								"parameters": {}
							}
						],
						"outputs": [
							{
								"referenceName": "Briggs_MDW",
								"type": "DatasetReference",
								"parameters": {
									"schema_name": "Briggs",
									"table_name": "Stage_Dim_Territory_Salesperson"
								}
							}
						]
					},
					{
						"name": "Dim_Customer_Group",
						"type": "Copy",
						"dependsOn": [
							{
								"activity": "Dim_Department",
								"dependencyConditions": [
									"Succeeded"
								]
							}
						],
						"policy": {
							"timeout": "7.00:00:00",
							"retry": 0,
							"retryIntervalInSeconds": 30,
							"secureOutput": false,
							"secureInput": false
						},
						"userProperties": [],
						"typeProperties": {
							"source": {
								"type": "SqlServerSource",
								"sqlReaderQuery": "select distinct cg.custgroup, cg.NAME 'Customer_Group'\n\n,isnull(ccg.CUSTGROUPID,'Unknown') 'Credit_Customer_Group_ID'\n,isnull(ccg.DESCRIPTION,'Unknown') 'Credit_Customer_Group_Name'\nfrom Briggs_MST.dbo.custtable ct\nleft join briggs_mst.dbo.CUSTGROUP cg on cg.CUSTGROUP = ct.CUSTGROUP\nleft join briggs_mst.dbo.XAP_CREDITCUSTOMERGROUPS ccg on ccg.recid = ct.CREDITCUSTOMERGROUPS",
								"queryTimeout": "02:00:00",
								"partitionOption": "None"
							},
							"sink": {
								"type": "AzureSqlSink",
								"preCopyScript": "truncate table briggs.Stage_Dim_Customer_Group",
								"disableMetricsCollection": false
							},
							"enableStaging": false,
							"translator": {
								"type": "TabularTranslator",
								"mappings": [
									{
										"source": {
											"name": "custgroup",
											"type": "String",
											"physicalType": "nvarchar"
										},
										"sink": {
											"name": "custgroup",
											"type": "String",
											"physicalType": "nvarchar"
										}
									},
									{
										"source": {
											"name": "Customer_Group",
											"type": "String",
											"physicalType": "nvarchar"
										},
										"sink": {
											"name": "Customer_Group",
											"type": "String",
											"physicalType": "nvarchar"
										}
									},
									{
										"source": {
											"name": "Credit_Customer_Group_ID",
											"type": "String",
											"physicalType": "nvarchar"
										},
										"sink": {
											"name": "Credit_Customer_Group_ID",
											"type": "String",
											"physicalType": "nvarchar"
										}
									},
									{
										"source": {
											"name": "Credit_Customer_Group_Name",
											"type": "String",
											"physicalType": "nvarchar"
										},
										"sink": {
											"name": "Credit_Customer_Group_Name",
											"type": "String",
											"physicalType": "nvarchar"
										}
									}
								],
								"typeConversion": true,
								"typeConversionSettings": {
									"allowDataTruncation": true,
									"treatBooleanAsNumber": false
								}
							}
						},
						"inputs": [
							{
								"referenceName": "DS_BriggsAX",
								"type": "DatasetReference",
								"parameters": {}
							}
						],
						"outputs": [
							{
								"referenceName": "Briggs_MDW",
								"type": "DatasetReference",
								"parameters": {
									"schema_name": "Briggs",
									"table_name": "Stage_Dim_Customer_Group"
								}
							}
						]
					},
					{
						"name": "Dim_Call_Type",
						"type": "Copy",
						"dependsOn": [
							{
								"activity": "Dim_Equipment",
								"dependencyConditions": [
									"Succeeded"
								]
							}
						],
						"policy": {
							"timeout": "7.00:00:00",
							"retry": 0,
							"retryIntervalInSeconds": 30,
							"secureOutput": false,
							"secureInput": false
						},
						"userProperties": [],
						"typeProperties": {
							"source": {
								"type": "SqlServerSource",
								"sqlReaderQuery": "select \n  distinct tl.recid 'sk_call_status_bigint', \n  tt.recid 'sk_call_type_bigint', \n  tt.calltypeid 'call_type_id', \n  tl.callstatusid 'call_status_id', \n  tl.linenum 'line_num' \nfrom \n  xap_svccalltypeline tl \n  left join xap_svccalltypetable tt on tt.recid = tl.calltypeid",
								"queryTimeout": "02:00:00",
								"partitionOption": "None"
							},
							"sink": {
								"type": "AzureSqlSink",
								"preCopyScript": "Truncate table Briggs.Stage_Dim_CallType",
								"disableMetricsCollection": false
							},
							"enableStaging": false,
							"translator": {
								"type": "TabularTranslator",
								"mappings": [
									{
										"source": {
											"name": "sk_call_status_bigint",
											"type": "Int64",
											"physicalType": "bigint"
										},
										"sink": {
											"name": "SK_Call_Status_BIGINT",
											"type": "Int64",
											"physicalType": "bigint"
										}
									},
									{
										"source": {
											"name": "sk_call_type_bigint",
											"type": "Int64",
											"physicalType": "bigint"
										},
										"sink": {
											"name": "SK_Call_Type_BIGINT",
											"type": "Int64",
											"physicalType": "bigint"
										}
									},
									{
										"source": {
											"name": "call_type_id",
											"type": "String",
											"physicalType": "nvarchar"
										},
										"sink": {
											"name": "Call_Type_ID",
											"type": "String",
											"physicalType": "nvarchar"
										}
									},
									{
										"source": {
											"name": "call_status_id",
											"type": "String",
											"physicalType": "nvarchar"
										},
										"sink": {
											"name": "Call_Status_ID",
											"type": "String",
											"physicalType": "nvarchar"
										}
									},
									{
										"source": {
											"name": "line_num",
											"type": "Decimal",
											"physicalType": "decimal",
											"scale": 16,
											"precision": 32
										},
										"sink": {
											"name": "Line_Num",
											"type": "Decimal",
											"physicalType": "decimal",
											"scale": 16,
											"precision": 32
										}
									}
								],
								"typeConversion": true,
								"typeConversionSettings": {
									"allowDataTruncation": true,
									"treatBooleanAsNumber": false
								}
							}
						},
						"inputs": [
							{
								"referenceName": "DS_BriggsAX",
								"type": "DatasetReference",
								"parameters": {}
							}
						],
						"outputs": [
							{
								"referenceName": "Briggs_MDW",
								"type": "DatasetReference",
								"parameters": {
									"schema_name": "Briggs",
									"table_name": "Stage_Dim_CallType"
								}
							}
						]
					},
					{
						"name": "Dim_Equipment",
						"type": "Copy",
						"dependsOn": [
							{
								"activity": "Dim_Vendor",
								"dependencyConditions": [
									"Succeeded"
								]
							}
						],
						"policy": {
							"timeout": "7.00:00:00",
							"retry": 0,
							"retryIntervalInSeconds": 30,
							"secureOutput": false,
							"secureInput": false
						},
						"userProperties": [],
						"typeProperties": {
							"source": {
								"type": "SqlServerSource",
								"sqlReaderQuery": "select \n  distinct eq.equipmentid, \n  eqtrans.[name][equipment name], \n  i.inventlocationid warehhouse, \n  i.wmslocationid [location], \n  eq.inventserialid serial, \n  eqmake.manufacturerid make, \n  eqtype.typeid model, \n  eqtech.machinemanufactureyear, \n  eqgroup.kindid [group], \n  case when eq.fleettype = 14 then 'Like kind exchange' \n  when eq.fleettype = 13 then '13' \n  when eq.fleettype = 12 then '12' \n  when eq.fleettype = 11 then 'Cancelled' \n  when eq.fleettype = 10 then 'Vendor' \n  when eq.fleettype = 8 then 'Re-rent' \n  when eq.fleettype = 7 then 'Used lease' \n  when eq.fleettype = 6 then 'Used rental' \n  when eq.fleettype = 5 then 'Competitive' \n  when eq.fleettype = 4 then 'Customer' \n  when eq.fleettype = 3 then 'Used' \n  when eq.fleettype = 2 then 'Lease' \n  when eq.fleettype = 1 then 'Rental' \n  when eq.fleettype = 0 then 'New' end fleettype, \n  [briggs_mst].[dbo].[enum2str](\n    'XAP_AgreementStatus', eq.agreementstatus\n  ) agrementstatus, \n  [briggs_mst].[dbo].[enum2str](\n    'XAP_PhysicalStatus', eq.physicalstatus\n  ) physicalstatus, \n  eq.itemid, \n  eqclass.classid rentalclass, \n  cast(eqfin.inventoryage as int) inventoryage, \n  cast(eqtrade.rentalage as int) rentalage, \n  [briggs_mst].[dbo].[enum2str]('AssetStatus', ab.status) [vm status] --into select * from #Temp\nfrom \n  [briggs_mst].dbo.xap_equipmenttable eq ----2lakh\n  left join (\n    select \n      d.inventequipmentid, \n      d.inventlocationid, \n      d.wmslocationid \n    from \n      [briggs_mst].dbo.inventdim d \n      inner join (\n        select \n          inventequipmentid, \n          max(it.RECID) 'recid' \n        from \n          [briggs_mst].dbo.inventdim id \n          inner join [briggs_mst].dbo.xap_equipmenttable eq on eq.equipmentid = inventequipmentid \n          inner join [briggs_mst].dbo.inventtrans it on it.inventdimid = id.inventdimid \n        where \n          inventlocationid not in ('JOBSITE', 'EQTRANSIT') \n          and inventsiteid = 'EQUIPMENT' \n          and it.itemid = eq.itemid \n        group by \n          inventequipmentid\n      ) f on d.inventequipmentid = f.inventequipmentid \n      inner join [briggs_mst].dbo.inventtrans e on d.inventdimid = e.inventdimid \n      and f.recid = e.recid \n    where \n      d.inventlocationid not in ('JOBSITE', 'EQTRANSIT')\n  ) i on eq.equipmentid = i.inventequipmentid \n  left join [briggs_mst].dbo.xap_equipmenttranslation eqtrans on eqtrans.equipment = eq.recid \n  left join [briggs_mst].dbo.xap_equipmenttechnicalinfo eqtech on eqtech.equipment = eq.recid \n  left join [briggs_mst].dbo.xap_machinetype eqtype on eq.machinetype = eqtype.recid \n  left join [briggs_mst].dbo.xap_machinekind eqgroup on eqgroup.recid = eqtype.machinekind \n  left join [briggs_mst].dbo.xap_equipmenttradeinfo eqtrade on eqtrade.equipment = eq.recid \n  left join [briggs_mst].dbo.xap_renclasstable eqclass on eqclass.recid = eqtrade.defaultclass \n  left join [briggs_mst].dbo.xap_equipmentfinancetable eqfin on eqfin.equipment = eq.recid \n  left join (\n    select \n      assetid, \n      recid, \n      row_number() over (\n        partition by assetid \n        order by \n          status asc, \n          recid desc\n      ) 'rn' \n    from \n      [briggs_mst].dbo.assetbook \n    where \n      status <> 4\n  ) vm_cte on vm_cte.assetid = eq.equipmentid \n  and vm_cte.rn = 1 \n  left join [briggs_mst].dbo.assetbook ab on ab.recid = vm_cte.recid \n  left join [briggs_mst].dbo.xap_machinemanufacturer eqmake on eqtype.machinemanufacturer = eqmake.recid",
								"queryTimeout": "02:00:00",
								"partitionOption": "None"
							},
							"sink": {
								"type": "AzureSqlSink",
								"preCopyScript": "Truncate table Briggs.Stage_Dim_Equipment",
								"disableMetricsCollection": false
							},
							"enableStaging": false,
							"translator": {
								"type": "TabularTranslator",
								"mappings": [
									{
										"source": {
											"name": "equipmentid",
											"type": "String",
											"physicalType": "nvarchar"
										},
										"sink": {
											"name": "equipmentid",
											"type": "String",
											"physicalType": "varchar"
										}
									},
									{
										"source": {
											"name": "equipment name",
											"type": "String",
											"physicalType": "nvarchar"
										},
										"sink": {
											"name": "Equipment Name",
											"type": "String",
											"physicalType": "nvarchar"
										}
									},
									{
										"source": {
											"name": "warehhouse",
											"type": "String",
											"physicalType": "nvarchar"
										},
										"sink": {
											"name": "Warehhouse",
											"type": "String",
											"physicalType": "varchar"
										}
									},
									{
										"source": {
											"name": "location",
											"type": "String",
											"physicalType": "nvarchar"
										},
										"sink": {
											"name": "location",
											"type": "String",
											"physicalType": "varchar"
										}
									},
									{
										"source": {
											"name": "serial",
											"type": "String",
											"physicalType": "nvarchar"
										},
										"sink": {
											"name": "serial",
											"type": "String",
											"physicalType": "varchar"
										}
									},
									{
										"source": {
											"name": "make",
											"type": "String",
											"physicalType": "nvarchar"
										},
										"sink": {
											"name": "make",
											"type": "String",
											"physicalType": "varchar"
										}
									},
									{
										"source": {
											"name": "model",
											"type": "String",
											"physicalType": "nvarchar"
										},
										"sink": {
											"name": "model",
											"type": "String",
											"physicalType": "varchar"
										}
									},
									{
										"source": {
											"name": "machinemanufactureyear",
											"type": "Int32",
											"physicalType": "int"
										},
										"sink": {
											"name": "machinemanufactureyear",
											"type": "Int32",
											"physicalType": "int"
										}
									},
									{
										"source": {
											"name": "group",
											"type": "String",
											"physicalType": "nvarchar"
										},
										"sink": {
											"name": "group",
											"type": "String",
											"physicalType": "varchar"
										}
									},
									{
										"source": {
											"name": "fleettype",
											"type": "String",
											"physicalType": "varchar"
										},
										"sink": {
											"name": "fleettype",
											"type": "String",
											"physicalType": "varchar"
										}
									},
									{
										"source": {
											"name": "agrementstatus",
											"type": "String",
											"physicalType": "varchar"
										},
										"sink": {
											"name": "agrementstatus",
											"type": "String",
											"physicalType": "varchar"
										}
									},
									{
										"source": {
											"name": "physicalstatus",
											"type": "String",
											"physicalType": "varchar"
										},
										"sink": {
											"name": "PhysicalStatus",
											"type": "String",
											"physicalType": "varchar"
										}
									},
									{
										"source": {
											"name": "itemid",
											"type": "String",
											"physicalType": "nvarchar"
										},
										"sink": {
											"name": "ITEMID",
											"type": "String",
											"physicalType": "varchar"
										}
									},
									{
										"source": {
											"name": "rentalclass",
											"type": "String",
											"physicalType": "nvarchar"
										},
										"sink": {
											"name": "RentalClass",
											"type": "String",
											"physicalType": "varchar"
										}
									},
									{
										"source": {
											"name": "inventoryage",
											"type": "Int32",
											"physicalType": "int"
										},
										"sink": {
											"name": "INVENTORYAGE",
											"type": "Int32",
											"physicalType": "int"
										}
									},
									{
										"source": {
											"name": "rentalage",
											"type": "Int32",
											"physicalType": "int"
										},
										"sink": {
											"name": "RentalAge",
											"type": "Int32",
											"physicalType": "int"
										}
									},
									{
										"source": {
											"name": "vm status",
											"type": "String",
											"physicalType": "varchar"
										},
										"sink": {
											"name": "VM Status",
											"type": "String",
											"physicalType": "varchar"
										}
									}
								],
								"typeConversion": true,
								"typeConversionSettings": {
									"allowDataTruncation": true,
									"treatBooleanAsNumber": false
								}
							}
						},
						"inputs": [
							{
								"referenceName": "Briggs_MST",
								"type": "DatasetReference",
								"parameters": {}
							}
						],
						"outputs": [
							{
								"referenceName": "Briggs_MDW",
								"type": "DatasetReference",
								"parameters": {
									"schema_name": "Briggs",
									"table_name": "Stage_Dim_Equipment"
								}
							}
						]
					},
					{
						"name": "Dim_Vendor",
						"type": "Copy",
						"dependsOn": [
							{
								"activity": "Dim_Invoice_Account",
								"dependencyConditions": [
									"Succeeded"
								]
							}
						],
						"policy": {
							"timeout": "7.00:00:00",
							"retry": 0,
							"retryIntervalInSeconds": 30,
							"secureOutput": false,
							"secureInput": false
						},
						"userProperties": [],
						"typeProperties": {
							"source": {
								"type": "SqlServerSource",
								"sqlReaderQuery": "select \n  distinct vet.accountnum vendor_account, \n  dir.name vendor_name \nfrom \n  vendtable vet \n  left join dirpartytable dir on vet.party = dir.recid \n  /*select distinct Vendor_Account,Vendor_Name from (\n  select distinct vij.INVOICEACCOUNT Vendor_Account,dir.Name Vendor_Name from VENDINVOICEJOUR vij\n  left join VENDTABLE vet on vij.INVOICEACCOUNT=vet.ACCOUNTNUM  \n  left join DIRPARTYTABLE dir on vet.PARTY = dir.recid\n  union all\n  select distinct vij.INVOICEACCOUNT Vendor_Account,dir.Name Vendor_Name from PURCHTABLE vij\n  left join VENDTABLE vet on vij.INVOICEACCOUNT=vet.ACCOUNTNUM  \n  left join DIRPARTYTABLE dir on vet.PARTY = dir.recid) a*/",
								"queryTimeout": "02:00:00",
								"partitionOption": "None"
							},
							"sink": {
								"type": "AzureSqlSink",
								"preCopyScript": "Truncate table briggs.Stage_Dim_Vendor",
								"disableMetricsCollection": false
							},
							"enableStaging": false,
							"translator": {
								"type": "TabularTranslator",
								"mappings": [
									{
										"source": {
											"name": "vendor_account",
											"type": "String",
											"physicalType": "nvarchar"
										},
										"sink": {
											"name": "Vendor_Account",
											"type": "String",
											"physicalType": "nvarchar"
										}
									},
									{
										"source": {
											"name": "vendor_name",
											"type": "String",
											"physicalType": "nvarchar"
										},
										"sink": {
											"name": "Vendor_Name",
											"type": "String",
											"physicalType": "nvarchar"
										}
									}
								],
								"typeConversion": true,
								"typeConversionSettings": {
									"allowDataTruncation": true,
									"treatBooleanAsNumber": false
								}
							}
						},
						"inputs": [
							{
								"referenceName": "Briggs_MST",
								"type": "DatasetReference",
								"parameters": {}
							}
						],
						"outputs": [
							{
								"referenceName": "Briggs_MDW",
								"type": "DatasetReference",
								"parameters": {
									"schema_name": "Briggs",
									"table_name": "Stage_Dim_Vendor"
								}
							}
						]
					},
					{
						"name": "Dim_Invoice_Account",
						"type": "Copy",
						"dependsOn": [],
						"policy": {
							"timeout": "7.00:00:00",
							"retry": 0,
							"retryIntervalInSeconds": 30,
							"secureOutput": false,
							"secureInput": false
						},
						"userProperties": [],
						"typeProperties": {
							"source": {
								"type": "SqlServerSource",
								"sqlReaderQuery": "select \n  distinct cij.invoiceaccount, \n  dirinvoice.name 'invaccountname' \nfrom \n  custinvoicejour cij \n  left join custtable cusinvoice on cij.invoiceaccount = cusinvoice.accountnum \n  left join dirpartytable dirinvoice on cusinvoice.party = dirinvoice.recid \norder by \n  invoiceaccount",
								"queryTimeout": "02:00:00",
								"partitionOption": "None"
							},
							"sink": {
								"type": "AzureSqlSink",
								"preCopyScript": "truncate table briggs.Stage_Dim_Invoice_Acc2",
								"disableMetricsCollection": false
							},
							"enableStaging": false,
							"translator": {
								"type": "TabularTranslator",
								"mappings": [
									{
										"source": {
											"name": "invoiceaccount",
											"type": "String",
											"physicalType": "nvarchar"
										},
										"sink": {
											"name": "INVOICEACCOUNT",
											"type": "String",
											"physicalType": "nvarchar"
										}
									},
									{
										"source": {
											"name": "invaccountname",
											"type": "String",
											"physicalType": "nvarchar"
										},
										"sink": {
											"name": "InvAccountName",
											"type": "String",
											"physicalType": "nvarchar"
										}
									}
								],
								"typeConversion": true,
								"typeConversionSettings": {
									"allowDataTruncation": true,
									"treatBooleanAsNumber": false
								}
							}
						},
						"inputs": [
							{
								"referenceName": "Briggs_MST",
								"type": "DatasetReference",
								"parameters": {}
							}
						],
						"outputs": [
							{
								"referenceName": "Briggs_MDW",
								"type": "DatasetReference",
								"parameters": {
									"schema_name": "Briggs",
									"table_name": "Stage_Dim_Invoice_Acc2"
								}
							}
						]
					},
					{
						"name": "Dim_Order_Class",
						"type": "Copy",
						"dependsOn": [
							{
								"activity": "Dim_Invent_Location",
								"dependencyConditions": [
									"Succeeded"
								]
							}
						],
						"policy": {
							"timeout": "7.00:00:00",
							"retry": 0,
							"retryIntervalInSeconds": 30,
							"secureOutput": false,
							"secureInput": false
						},
						"userProperties": [],
						"typeProperties": {
							"source": {
								"type": "SqlServerSource",
								"sqlReaderQuery": "  select \n  distinct orderclassid, \n  getdate() from_date, \n  getdate() todate, \n  1 isactive \nfrom \n  briggs_mst.dbo.xap_orderclass",
								"queryTimeout": "02:00:00",
								"partitionOption": "None"
							},
							"sink": {
								"type": "AzureSqlSink",
								"preCopyScript": "truncate table briggs.Stage_Dim_Order_Class",
								"disableMetricsCollection": false
							},
							"enableStaging": false,
							"translator": {
								"type": "TabularTranslator",
								"mappings": [
									{
										"source": {
											"name": "orderclassid",
											"type": "String",
											"physicalType": "nvarchar"
										},
										"sink": {
											"name": "orderclassid",
											"type": "String",
											"physicalType": "nvarchar"
										}
									},
									{
										"source": {
											"name": "from_date",
											"type": "DateTime",
											"physicalType": "datetime"
										},
										"sink": {
											"name": "from_date",
											"type": "DateTime",
											"physicalType": "datetime"
										}
									},
									{
										"source": {
											"name": "todate",
											"type": "DateTime",
											"physicalType": "datetime"
										},
										"sink": {
											"name": "todate",
											"type": "DateTime",
											"physicalType": "datetime"
										}
									},
									{
										"source": {
											"name": "isactive",
											"type": "Int32",
											"physicalType": "int"
										},
										"sink": {
											"name": "isactive",
											"type": "Int32",
											"physicalType": "int"
										}
									}
								],
								"typeConversion": true,
								"typeConversionSettings": {
									"allowDataTruncation": true,
									"treatBooleanAsNumber": false
								}
							}
						},
						"inputs": [
							{
								"referenceName": "DS_BriggsAX",
								"type": "DatasetReference",
								"parameters": {}
							}
						],
						"outputs": [
							{
								"referenceName": "Briggs_MDW",
								"type": "DatasetReference",
								"parameters": {
									"schema_name": "Briggs",
									"table_name": "Stage_Dim_Order_Class"
								}
							}
						]
					},
					{
						"name": "Dim_Invent_Location",
						"type": "Copy",
						"dependsOn": [
							{
								"activity": "Dim_Item",
								"dependencyConditions": [
									"Succeeded"
								]
							}
						],
						"policy": {
							"timeout": "7.00:00:00",
							"retry": 0,
							"retryIntervalInSeconds": 30,
							"secureOutput": false,
							"secureInput": false
						},
						"userProperties": [],
						"typeProperties": {
							"source": {
								"type": "SqlServerSource",
								"sqlReaderQuery": "select \n  distinct inventlocationid \nfrom \n  dbo.inventlocation",
								"queryTimeout": "02:00:00",
								"partitionOption": "None"
							},
							"sink": {
								"type": "AzureSqlSink",
								"preCopyScript": "truncate table briggs.Stage_Dim_Invent_Location",
								"disableMetricsCollection": false
							},
							"enableStaging": false,
							"translator": {
								"type": "TabularTranslator",
								"mappings": [
									{
										"source": {
											"name": "inventlocationid",
											"type": "String",
											"physicalType": "nvarchar"
										},
										"sink": {
											"name": "INVENTLOCATIONID",
											"type": "String",
											"physicalType": "nvarchar"
										}
									}
								],
								"typeConversion": true,
								"typeConversionSettings": {
									"allowDataTruncation": true,
									"treatBooleanAsNumber": false
								}
							}
						},
						"inputs": [
							{
								"referenceName": "Briggs_MST",
								"type": "DatasetReference",
								"parameters": {}
							}
						],
						"outputs": [
							{
								"referenceName": "Briggs_MDW",
								"type": "DatasetReference",
								"parameters": {
									"schema_name": "Briggs",
									"table_name": "Stage_Dim_Invent_Location"
								}
							}
						]
					},
					{
						"name": "Dim_Item",
						"type": "Copy",
						"dependsOn": [
							{
								"activity": "Dim_Manufacturer",
								"dependencyConditions": [
									"Succeeded"
								]
							}
						],
						"policy": {
							"timeout": "7.00:00:00",
							"retry": 0,
							"retryIntervalInSeconds": 30,
							"secureOutput": false,
							"secureInput": false
						},
						"userProperties": [],
						"typeProperties": {
							"source": {
								"type": "SqlServerSource",
								"sqlReaderQuery": "select \n  distinct itemid \nfrom \n  dbo.projinvoiceitem",
								"queryTimeout": "02:00:00",
								"partitionOption": "None"
							},
							"sink": {
								"type": "AzureSqlSink",
								"preCopyScript": "truncate table briggs.Stage_Dim_Item",
								"disableMetricsCollection": false
							},
							"enableStaging": false,
							"translator": {
								"type": "TabularTranslator",
								"mappings": [
									{
										"source": {
											"name": "itemid",
											"type": "String",
											"physicalType": "nvarchar"
										},
										"sink": {
											"name": "ITEMID",
											"type": "String",
											"physicalType": "varchar"
										}
									}
								],
								"typeConversion": true,
								"typeConversionSettings": {
									"allowDataTruncation": true,
									"treatBooleanAsNumber": false
								}
							}
						},
						"inputs": [
							{
								"referenceName": "Briggs_MST",
								"type": "DatasetReference",
								"parameters": {}
							}
						],
						"outputs": [
							{
								"referenceName": "Briggs_MDW",
								"type": "DatasetReference",
								"parameters": {
									"schema_name": "Briggs",
									"table_name": "Stage_Dim_Item"
								}
							}
						]
					},
					{
						"name": "Dim_Manufacturer",
						"type": "Copy",
						"dependsOn": [],
						"policy": {
							"timeout": "7.00:00:00",
							"retry": 0,
							"retryIntervalInSeconds": 30,
							"secureOutput": false,
							"secureInput": false
						},
						"userProperties": [],
						"typeProperties": {
							"source": {
								"type": "SqlServerSource",
								"sqlReaderQuery": "select \n  distinct manufacturerid, \n  name \nfrom \n  dbo.xap_machinemanufacturer",
								"queryTimeout": "02:00:00",
								"partitionOption": "None"
							},
							"sink": {
								"type": "AzureSqlSink",
								"preCopyScript": "truncate table briggs.Stage_Dim_Manufacturer",
								"disableMetricsCollection": false
							},
							"enableStaging": false,
							"translator": {
								"type": "TabularTranslator",
								"mappings": [
									{
										"source": {
											"name": "manufacturerid",
											"type": "String",
											"physicalType": "nvarchar"
										},
										"sink": {
											"name": "manufacturerid",
											"type": "String",
											"physicalType": "nvarchar"
										}
									},
									{
										"source": {
											"name": "name",
											"type": "String",
											"physicalType": "nvarchar"
										},
										"sink": {
											"name": "name",
											"type": "String",
											"physicalType": "nvarchar"
										}
									}
								],
								"typeConversion": true,
								"typeConversionSettings": {
									"allowDataTruncation": true,
									"treatBooleanAsNumber": false
								}
							}
						},
						"inputs": [
							{
								"referenceName": "Briggs_MST",
								"type": "DatasetReference",
								"parameters": {}
							}
						],
						"outputs": [
							{
								"referenceName": "Briggs_MDW",
								"type": "DatasetReference",
								"parameters": {
									"schema_name": "Briggs",
									"table_name": "Stage_Dim_Manufacturer"
								}
							}
						]
					},
					{
						"name": "Stage_Dim_Rep_Col",
						"type": "Copy",
						"dependsOn": [],
						"policy": {
							"timeout": "7.00:00:00",
							"retry": 0,
							"retryIntervalInSeconds": 30,
							"secureOutput": false,
							"secureInput": false
						},
						"userProperties": [],
						"typeProperties": {
							"source": {
								"type": "SqlServerSource",
								"sqlReaderQuery": "select \n  distinct isnull(description,'NO REP') rep, \n  ltrim(\n    isnull(\n      substring(\n        description, \n        charindex('-', description)+ 1, \n        len(description)\n      ), \n      'NO REP'\n    )\n  ) collector \nfrom \n  briggs_mst.dbo.xap_creditcustomergroups",
								"queryTimeout": "02:00:00",
								"partitionOption": "None"
							},
							"sink": {
								"type": "AzureSqlSink",
								"preCopyScript": "truncate table briggs.Stage_Dim_Rep_Col",
								"disableMetricsCollection": false
							},
							"enableStaging": false,
							"translator": {
								"type": "TabularTranslator",
								"mappings": [
									{
										"source": {
											"name": "rep",
											"type": "String",
											"physicalType": "varchar"
										},
										"sink": {
											"name": "rep",
											"type": "String",
											"physicalType": "String"
										}
									},
									{
										"source": {
											"name": "collector",
											"type": "String",
											"physicalType": "varchar"
										},
										"sink": {
											"name": "collector",
											"type": "String",
											"physicalType": "String"
										}
									}
								],
								"typeConversion": true,
								"typeConversionSettings": {
									"allowDataTruncation": true,
									"treatBooleanAsNumber": false
								}
							}
						},
						"inputs": [
							{
								"referenceName": "DS_BriggsAX",
								"type": "DatasetReference",
								"parameters": {}
							}
						],
						"outputs": [
							{
								"referenceName": "Briggs_MDW",
								"type": "DatasetReference",
								"parameters": {
									"schema_name": "Briggs",
									"table_name": "Stage_Dim_Rep_Col"
								}
							}
						]
					}
				],
				"policy": {
					"elapsedTimeMetric": {},
					"cancelAfter": {}
				},
				"folder": {
					"name": "Briggs Data Load Theme wise"
				},
				"annotations": [],
				"lastPublishTime": "2022-02-17T13:04:24Z"
			},
			"dependsOn": [
				"[concat(variables('workspaceId'), '/datasets/DS_BriggsAX')]",
				"[concat(variables('workspaceId'), '/datasets/Briggs_MDW')]",
				"[concat(variables('workspaceId'), '/datasets/Briggs_MST')]"
			]
		},
		{
			"name": "[concat(parameters('workspaceName'), '/PL_MASTER_CALL_FOR_THEME')]",
			"type": "Microsoft.Synapse/workspaces/pipelines",
			"apiVersion": "2019-06-01-preview",
			"properties": {
				"activities": [
					{
						"name": "PL_Master_Briggs_AR",
						"type": "ExecutePipeline",
						"dependsOn": [
							{
								"activity": "PL_Master_Dimension_Load",
								"dependencyConditions": [
									"Succeeded",
									"Failed"
								]
							}
						],
						"userProperties": [],
						"typeProperties": {
							"pipeline": {
								"referenceName": "PL_Master_Briggs_AR",
								"type": "PipelineReference"
							},
							"waitOnCompletion": true,
							"parameters": {}
						}
					},
					{
						"name": "PL_Master_Briggs_Customer",
						"type": "ExecutePipeline",
						"dependsOn": [
							{
								"activity": "PL_Master_Briggs_AR",
								"dependencyConditions": [
									"Succeeded",
									"Failed"
								]
							}
						],
						"userProperties": [],
						"typeProperties": {
							"pipeline": {
								"referenceName": "PL_Master_Briggs_Customer",
								"type": "PipelineReference"
							},
							"waitOnCompletion": true,
							"parameters": {}
						}
					},
					{
						"name": "PL_Master_Briggs_Commission",
						"type": "ExecutePipeline",
						"dependsOn": [
							{
								"activity": "PL_Master_Briggs_Customer",
								"dependencyConditions": [
									"Succeeded",
									"Failed"
								]
							}
						],
						"userProperties": [],
						"typeProperties": {
							"pipeline": {
								"referenceName": "PL_Master_Briggs_Commission",
								"type": "PipelineReference"
							},
							"waitOnCompletion": true,
							"parameters": {}
						}
					},
					{
						"name": "PL_Master_Briggs_Equipment",
						"type": "ExecutePipeline",
						"dependsOn": [
							{
								"activity": "PL_Master_Briggs_Commission",
								"dependencyConditions": [
									"Succeeded",
									"Failed"
								]
							}
						],
						"userProperties": [],
						"typeProperties": {
							"pipeline": {
								"referenceName": "PL_Master_Briggs_Equipment",
								"type": "PipelineReference"
							},
							"waitOnCompletion": true,
							"parameters": {}
						}
					},
					{
						"name": "PL_Master_Briggs_Parts",
						"type": "ExecutePipeline",
						"dependsOn": [
							{
								"activity": "PL_Master_Briggs_Operations",
								"dependencyConditions": [
									"Succeeded",
									"Failed"
								]
							}
						],
						"userProperties": [],
						"typeProperties": {
							"pipeline": {
								"referenceName": "PL_Master_Briggs_Parts",
								"type": "PipelineReference"
							},
							"waitOnCompletion": true,
							"parameters": {}
						}
					},
					{
						"name": "PL_Master_Briggs_Rental",
						"type": "ExecutePipeline",
						"dependsOn": [
							{
								"activity": "PL_Master_Briggs_Parts",
								"dependencyConditions": [
									"Succeeded",
									"Failed"
								]
							}
						],
						"userProperties": [],
						"typeProperties": {
							"pipeline": {
								"referenceName": "PL_Master_Briggs_Rental",
								"type": "PipelineReference"
							},
							"waitOnCompletion": true,
							"parameters": {}
						}
					},
					{
						"name": "PL_Master_Briggs_AP",
						"type": "ExecutePipeline",
						"dependsOn": [
							{
								"activity": "PL_Master_Briggs_Equipment",
								"dependencyConditions": [
									"Succeeded",
									"Failed"
								]
							}
						],
						"userProperties": [],
						"typeProperties": {
							"pipeline": {
								"referenceName": "PL_Master_Briggs_AP",
								"type": "PipelineReference"
							},
							"waitOnCompletion": true,
							"parameters": {}
						}
					},
					{
						"name": "PL_Master_Briggs_Billing",
						"type": "ExecutePipeline",
						"dependsOn": [
							{
								"activity": "PL_Master_Briggs_AP",
								"dependencyConditions": [
									"Succeeded",
									"Failed"
								]
							}
						],
						"userProperties": [],
						"typeProperties": {
							"pipeline": {
								"referenceName": "PL_Master_Briggs_Billing",
								"type": "PipelineReference"
							},
							"waitOnCompletion": true,
							"parameters": {}
						}
					},
					{
						"name": "PL_Master_Briggs_Tech",
						"type": "ExecutePipeline",
						"dependsOn": [
							{
								"activity": "PL_Master_Briggs_Billing",
								"dependencyConditions": [
									"Succeeded",
									"Failed"
								]
							}
						],
						"userProperties": [],
						"typeProperties": {
							"pipeline": {
								"referenceName": "PL_Master_Briggs_Tech",
								"type": "PipelineReference"
							},
							"waitOnCompletion": true,
							"parameters": {}
						}
					},
					{
						"name": "PL_Master_Briggs_Statement",
						"type": "ExecutePipeline",
						"dependsOn": [
							{
								"activity": "PL_Master_Briggs_Tech",
								"dependencyConditions": [
									"Succeeded",
									"Failed"
								]
							}
						],
						"userProperties": [],
						"typeProperties": {
							"pipeline": {
								"referenceName": "PL_Master_Briggs_Statement",
								"type": "PipelineReference"
							},
							"waitOnCompletion": true,
							"parameters": {}
						}
					},
					{
						"name": "PL_Master_Briggs_Invoices",
						"type": "ExecutePipeline",
						"dependsOn": [
							{
								"activity": "PL_Master_Briggs_Statement",
								"dependencyConditions": [
									"Succeeded",
									"Failed"
								]
							}
						],
						"userProperties": [],
						"typeProperties": {
							"pipeline": {
								"referenceName": "PL_Master_Briggs_Invoices",
								"type": "PipelineReference"
							},
							"waitOnCompletion": true,
							"parameters": {}
						}
					},
					{
						"name": "PL_Master_Briggs_GM",
						"type": "ExecutePipeline",
						"dependsOn": [
							{
								"activity": "PL_Master_Briggs_Invoices",
								"dependencyConditions": [
									"Succeeded",
									"Failed"
								]
							}
						],
						"userProperties": [],
						"typeProperties": {
							"pipeline": {
								"referenceName": "PL_Master_Briggs_GM",
								"type": "PipelineReference"
							},
							"waitOnCompletion": true,
							"parameters": {}
						}
					},
					{
						"name": "PL_Master_Briggs_Inventory",
						"type": "ExecutePipeline",
						"dependsOn": [
							{
								"activity": "PL_Master_Briggs_GM",
								"dependencyConditions": [
									"Succeeded",
									"Failed"
								]
							}
						],
						"userProperties": [],
						"typeProperties": {
							"pipeline": {
								"referenceName": "PL_Master_Briggs_Inventory",
								"type": "PipelineReference"
							},
							"waitOnCompletion": true,
							"parameters": {}
						}
					},
					{
						"name": "PL_Master_Briggs_Operations",
						"type": "ExecutePipeline",
						"dependsOn": [
							{
								"activity": "PL_Master_Briggs_Service",
								"dependencyConditions": [
									"Succeeded",
									"Failed"
								]
							}
						],
						"userProperties": [],
						"typeProperties": {
							"pipeline": {
								"referenceName": "PL_Master_Briggs_Operations",
								"type": "PipelineReference"
							},
							"waitOnCompletion": true,
							"parameters": {}
						}
					},
					{
						"name": "PL_Master_Briggs_Service",
						"type": "ExecutePipeline",
						"dependsOn": [
							{
								"activity": "PL_Master_Briggs_Inventory",
								"dependencyConditions": [
									"Succeeded",
									"Failed"
								]
							}
						],
						"userProperties": [],
						"typeProperties": {
							"pipeline": {
								"referenceName": "PL_Master_Briggs_Service",
								"type": "PipelineReference"
							},
							"waitOnCompletion": true,
							"parameters": {}
						}
					},
					{
						"name": "PL_Master_Briggs_Misc",
						"type": "ExecutePipeline",
						"dependsOn": [
							{
								"activity": "PL_Master_Briggs_Rental",
								"dependencyConditions": [
									"Succeeded",
									"Failed"
								]
							}
						],
						"userProperties": [],
						"typeProperties": {
							"pipeline": {
								"referenceName": "PL_Master_Briggs_Misc",
								"type": "PipelineReference"
							},
							"waitOnCompletion": true,
							"parameters": {}
						}
					},
					{
						"name": "Stage_AR_Invoices_ALL",
						"type": "Copy",
						"dependsOn": [
							{
								"activity": "PL_Master_Briggs_AR",
								"dependencyConditions": [
									"Succeeded"
								]
							}
						],
						"policy": {
							"timeout": "7.00:00:00",
							"retry": 0,
							"retryIntervalInSeconds": 30,
							"secureOutput": false,
							"secureInput": false
						},
						"userProperties": [],
						"typeProperties": {
							"source": {
								"type": "SqlServerSource",
								"sqlReaderQuery": "with cte(accountnum,age)\nas(\n\tselect accountnum,datediff(day,max(cs.transdate),getdate())\n\tfrom custsettlement cs \n\twhere cs.offsettransvoucher like 'ARPAY%'\n\tgroup by accountnum\n) \nselect \nisnull(ccg.DESCRIPTION,'NO REP') 'rep',\n\t\tisnull(substring(ccg.description,charindex('-',ccg.description)+1,len(ccg.description)),'no rep') 'collector',\n\t\tct.accountnum,\n\t\tcus.paymtermid,\n\t\tcus.custgroup,\n\t\tisnull(cij.orderaccount,pij.orderaccount) 'shipto',\n\t\t[dbo].[ENUM2STR]('CustVendDisputeStatus',cd.STATUS) 'ReasonCode',\n\t\trt.reason,\n\t\trt.reasoncomment,\n\t\tdir.name 'billtoname',\n\t\tdirshipto.name 'shiptoname',\n\t\tcase\n\t\t\twhen ct.invoice = '' then ct.paymreference\n\t\t\telse ct.invoice\n\t\tend 'invoice#',\n\t\tct.custponbr 'po number',\n\t\tcase\n\t\t\twhen pij.svcinventlocationid is not null then pij.svcinventlocationid\n\t\t\twhen cij.inventlocationid is not null then cij.inventlocationid\n\t\tend 'warehouse',\n\t\tcase\n\t\t\twhen ddv.DISPLAYVALUE <> '' then ddv.DISPLAYVALUE \n\t\t\twhen ddv.DISPLAYVALUE is null and ct.invoice like '[0-9][0-9][a-z][0-9][0-9][0-9][0-9][0-9][0-9][0-9]' then '1'+ SUBSTRING(ct.INVOICE,1,2)\n\t\t\twhen ddv.DISPLAYVALUE is null and ct.invoice like 'INV%' then 'Invoices w.o. warehouse'\n\t\t\telse 'Unapplied/Misc'\n\t\tEnd 'Warehouse2',\n\t\tCASE\n\t\t\twhen ct.TRANSDATE = '2014-06-29 00:00:00.000' then ct.DOCUMENTDATE\n\t\t\telse ct.TRANSDATE\n\t\tEND 'TransDate',\n\t\tct.DUEDATE,\n\t\tdatediff(day,ct.duedate,getdate()) 'Age',\n\t\tCASE\n\t\t\twhen cij.ORDERCLASS <> 0 then  ocCIJ.ORDERCLASSID\n\t\t\twhen pij.ORDERCLASSID <> 0 then ocPIJ.ORDERCLASSID\n\t\t\twhen ct.invoice like '[0-9][0-9][a-z][0-9][0-9][0-9][0-9][0-9][0-9][0-9]' then case\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\twhen SUBSTRING(ct.INVOICE,3,1) = 'E' then 'RENTAL'\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\twhen SUBSTRING(ct.INVOICE,3,1) = 'R' then 'RENTAL'\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\twhen SUBSTRING(ct.INVOICE,3,1) = 'S' then 'SERVICE'\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\twhen SUBSTRING(ct.INVOICE,3,1) = 'P' then 'PARTS'\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t   End\n\t\tEND 'Type',\n\t\tcast(ct.AMOUNTCUR as decimal(10,2)) 'Amount',\n\t\tcast((ct.AMOUNTCUR-SETTLEAMOUNTCUR) as decimal(10,2)) 'Balance',\n\t\tcast(CASE\n\t\t\twhen datediff(day,ct.duedate,getdate()) < 1 then \tcast((ct.AMOUNTCUR-SETTLEAMOUNTCUR) as decimal(10,2))\n\t\t\telse 0.00\n\t\tEND as decimal(10,2)) 'Current',\n\t\tcast(CASE\n\t\t\twhen datediff(day,ct.duedate,getdate()) between 1 and 30 then \tcast((ct.AMOUNTCUR-SETTLEAMOUNTCUR) as decimal(10,2))\n\t\t\telse 0.00\n\t\tEND as decimal(10,2)) '1-30',\n\t\tcast(CASE\n\t\t\twhen datediff(day,ct.duedate,getdate()) between 31 and 60 then \tcast((ct.AMOUNTCUR-SETTLEAMOUNTCUR) as decimal(10,2))\n\t\t\telse 0.00\n\t\tEND as decimal(10,2)) '31-60',\n\t\tcast(CASE\n\t\t\twhen datediff(day,ct.duedate,getdate()) between 61 and 90 then \tcast((ct.AMOUNTCUR-SETTLEAMOUNTCUR) as decimal(10,2))\n\t\t\telse 0.00\n\t\tEND as decimal(10,2)) '61-90',\n\t\tcast(CASE\n\t\t\twhen datediff(day,ct.duedate,getdate()) between 91 and 150 then \tcast((ct.AMOUNTCUR-SETTLEAMOUNTCUR) as decimal(10,2))\n\t\t\telse 0.00\n\t\tEND as decimal(10,2)) '91-150',\n\t\tcast(CASE\n\t\t\twhen datediff(day,ct.duedate,getdate()) >150 then  cast((ct.AMOUNTCUR-SETTLEAMOUNTCUR) as decimal(10,2))\n\t\t\telse 0.00\n\t\tEND as decimal(10,2)) '150+',\n\t\tcast(CASE\n\t\t\twhen datediff(day,ct.duedate,getdate()) between 91 and 120 then \tcast((ct.AMOUNTCUR-SETTLEAMOUNTCUR) as decimal(10,2))\n\t\t\telse 0.00\n\t\tEND as decimal(10,2)) '91-120',\n\t\tcast(CASE\n\t\t\twhen datediff(day,ct.duedate,getdate()) between 121 and 150 then \tcast((ct.AMOUNTCUR-SETTLEAMOUNTCUR) as decimal(10,2))\n\t\t\telse 0.00\n\t\tEND as decimal(10,2)) '121-150',\n\t\tcast(CASE\n\t\t\twhen datediff(day,ct.duedate,getdate()) between 151 and 180 then \tcast((ct.AMOUNTCUR-SETTLEAMOUNTCUR) as decimal(10,2))\n\t\t\telse 0.00\n\t\tEND as decimal(10,2)) '151-180',\n\t\tcast(CASE\n\t\t\twhen datediff(day,ct.duedate,getdate()) between 181 and 240 then \tcast((ct.AMOUNTCUR-SETTLEAMOUNTCUR) as decimal(10,2))\n\t\t\telse 0.00\n\t\tEND as decimal(10,2)) '181-240',\n\t\tcast(CASE\n\t\t\twhen datediff(day,ct.duedate,getdate()) between 241 and 300 then \tcast((ct.AMOUNTCUR-SETTLEAMOUNTCUR) as decimal(10,2))\n\t\t\telse 0.00\n\t\tEND as decimal(10,2)) '241-300',\n\t\tcast(CASE\n\t\t\twhen datediff(day,ct.duedate,getdate()) between 301 and 365 then \tcast((ct.AMOUNTCUR-SETTLEAMOUNTCUR) as decimal(10,2))\n\t\t\telse 0.00\n\t\tEND as decimal(10,2)) '301-365',\n\t\tcast(CASE\n\t\t\twhen datediff(day,ct.duedate,getdate()) >= 366  then \tcast((ct.AMOUNTCUR-SETTLEAMOUNTCUR) as decimal(10,2))\n\t\t\telse 0.00\n\t\tEND as decimal(10,2)) '366+'\n\t\t,ct.amountcur,ct.settleamountcur\n\t\t,cte.age 'last pay age'\n\t\t,svc.svccallid\n\t\t,eq.equipmentid\n\t\t,eq.inventserialid\n\t\t,ct.createdby\n\t\t,replace(replace(lpa.address,char(10),''),char(13),'') 'shipto_address'\n\t\t,isnull(cijst.salesid,pij.projid) 'sale/svc'\n\t\t,rmt.rentalid\n\t\t,ct.txt\n\t\t,ct.txt 'description'\n\t\t,ljt.journalnum\n\t\t,ljt.paymmode\n\t\t,ljtt.posteddatetime\n\t\t,ljt.voucher\n\t\t,ljt.paymreference,ct.lastsettledate,ct.closed\nfrom custtrans ct\nleft join custtable cus on ct.accountnum = cus.accountnum\nleft join dirpartytable dir on dir.recid = cus.party\nleft join custtable cusshipto on cusshipto.accountnum = ct.orderaccount\nleft join dirpartytable dirshipto on dirshipto.recid = cusshipto.party\nleft join dirpartylocation dirp on dirp.isprimary = 1 and dirp.party = cusshipto.party\nleft join xap_creditcustomergroups ccg on ccg.recid= cus.creditcustomergroups\nleft join projinvoicejour pij on pij.projinvoiceid = ct.invoice and pij.ledgervoucher = ct.voucher\nleft join xap_svccalltable svc on pij.svccallid = svc.recid\nleft join custinvoicejour cij on cij.invoiceid = ct.invoice and cij.ledgervoucher = ct.voucher and cij.invoiceid <> 'deduction'\nleft join xap_orderclass occij on occij.recid = cij.orderclass \nleft join xap_orderclass ocpij on ocpij.recid = pij.orderclassid \nleft join salestable cijst on cijst.salesid = cij.salesid\nleft join cte on cte.accountnum = ct.accountnum\nleft join custdispute cd on cd.custtrans = ct.recid\nleft join reasontableref rt on rt.recid = cd.reasontableref\nleft join briggs_mst.dbo.inventlocation il on il.inventlocationid = case\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\twhen pij.svcinventlocationid is not null then pij.svcinventlocationid\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\twhen cij.inventlocationid is not null then cij.inventlocationid\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tend\nleft join briggs_mst.dbo.defaultdimensionview ddv on il.defaultdimension = ddv.defaultdimension\nleft join xap_equipmenttable eq on eq.recid = svc.equipmentid\nleft join logisticspostaladdress lpa on lpa.location = dirp.location and dbo.utc2central(lpa.validto)>=getdate()\nleft join xap_invoicescheduletable ist on ist.salesid = cij.salesid and cij.salesid <> ''\nleft join xap_renmaintable rmt on rmt.recid = ist.renmaintable\nleft join ledgerjournaltrans ljt on ljt.voucher = ct.lastsettlevoucher\nleft join ledgerjournaltable ljtt on ljtt.journalnum = ljt.journalnum\nwhere ct.duedate between getdate()-90 and getdate()\n--year(ct.duedate)>='2021' and month(ct.duedate)>'05'",
								"queryTimeout": "02:00:00",
								"partitionOption": "None"
							},
							"sink": {
								"type": "AzureSqlSink",
								"preCopyScript": "truncate table briggs.Stage_AR_Invoices_ALL",
								"disableMetricsCollection": false
							},
							"enableStaging": false,
							"translator": {
								"type": "TabularTranslator",
								"mappings": [
									{
										"source": {
											"name": "rep",
											"type": "String",
											"physicalType": "nvarchar"
										},
										"sink": {
											"name": "Rep",
											"type": "String",
											"physicalType": "nvarchar"
										}
									},
									{
										"source": {
											"name": "collector",
											"type": "String",
											"physicalType": "nvarchar"
										},
										"sink": {
											"name": "collector",
											"type": "String",
											"physicalType": "nvarchar"
										}
									},
									{
										"source": {
											"name": "accountnum",
											"type": "String",
											"physicalType": "nvarchar"
										},
										"sink": {
											"name": "ACCOUNTNUM",
											"type": "String",
											"physicalType": "nvarchar"
										}
									},
									{
										"source": {
											"name": "paymtermid",
											"type": "String",
											"physicalType": "nvarchar"
										},
										"sink": {
											"name": "PAYMTERMID",
											"type": "String",
											"physicalType": "nvarchar"
										}
									},
									{
										"source": {
											"name": "custgroup",
											"type": "String",
											"physicalType": "nvarchar"
										},
										"sink": {
											"name": "CUSTGROUP",
											"type": "String",
											"physicalType": "nvarchar"
										}
									},
									{
										"source": {
											"name": "shipto",
											"type": "String",
											"physicalType": "nvarchar"
										},
										"sink": {
											"name": "shipTo",
											"type": "String",
											"physicalType": "nvarchar"
										}
									},
									{
										"source": {
											"name": "ReasonCode",
											"type": "String",
											"physicalType": "varchar"
										},
										"sink": {
											"name": "ReasonCode",
											"type": "String",
											"physicalType": "varchar"
										}
									},
									{
										"source": {
											"name": "reason",
											"type": "String",
											"physicalType": "nvarchar"
										},
										"sink": {
											"name": "REASON",
											"type": "String",
											"physicalType": "nvarchar"
										}
									},
									{
										"source": {
											"name": "reasoncomment",
											"type": "String",
											"physicalType": "nvarchar"
										},
										"sink": {
											"name": "REASONCOMMENT",
											"type": "String",
											"physicalType": "nvarchar"
										}
									},
									{
										"source": {
											"name": "billtoname",
											"type": "String",
											"physicalType": "nvarchar"
										},
										"sink": {
											"name": "BilltoName",
											"type": "String",
											"physicalType": "nvarchar"
										}
									},
									{
										"source": {
											"name": "shiptoname",
											"type": "String",
											"physicalType": "nvarchar"
										},
										"sink": {
											"name": "Shiptoname",
											"type": "String",
											"physicalType": "nvarchar"
										}
									},
									{
										"source": {
											"name": "invoice#",
											"type": "String",
											"physicalType": "nvarchar"
										},
										"sink": {
											"name": "Invoice#",
											"type": "String",
											"physicalType": "nvarchar"
										}
									},
									{
										"source": {
											"name": "po number",
											"type": "String",
											"physicalType": "nvarchar"
										},
										"sink": {
											"name": "PO Number",
											"type": "String",
											"physicalType": "nvarchar"
										}
									},
									{
										"source": {
											"name": "warehouse",
											"type": "String",
											"physicalType": "nvarchar"
										},
										"sink": {
											"name": "Warehouse",
											"type": "String",
											"physicalType": "nvarchar"
										}
									},
									{
										"source": {
											"name": "Warehouse2",
											"type": "String",
											"physicalType": "nvarchar"
										},
										"sink": {
											"name": "Warehouse2",
											"type": "String",
											"physicalType": "nvarchar"
										}
									},
									{
										"source": {
											"name": "TransDate",
											"type": "DateTime",
											"physicalType": "datetime"
										},
										"sink": {
											"name": "TransDate",
											"type": "DateTime",
											"physicalType": "datetime"
										}
									},
									{
										"source": {
											"name": "DUEDATE",
											"type": "DateTime",
											"physicalType": "datetime"
										},
										"sink": {
											"name": "DUEDATE",
											"type": "DateTime",
											"physicalType": "datetime"
										}
									},
									{
										"source": {
											"name": "Age",
											"type": "Int32",
											"physicalType": "int"
										},
										"sink": {
											"name": "Age",
											"type": "Int32",
											"physicalType": "int"
										}
									},
									{
										"source": {
											"name": "Type",
											"type": "String",
											"physicalType": "nvarchar"
										},
										"sink": {
											"name": "Type",
											"type": "String",
											"physicalType": "nvarchar"
										}
									},
									{
										"source": {
											"name": "Amount",
											"type": "Decimal",
											"physicalType": "decimal",
											"scale": 2,
											"precision": 10
										},
										"sink": {
											"name": "Amount",
											"type": "Decimal",
											"physicalType": "decimal",
											"scale": 2,
											"precision": 10
										}
									},
									{
										"source": {
											"name": "Balance",
											"type": "Decimal",
											"physicalType": "decimal",
											"scale": 2,
											"precision": 10
										},
										"sink": {
											"name": "Balance",
											"type": "Decimal",
											"physicalType": "decimal",
											"scale": 2,
											"precision": 10
										}
									},
									{
										"source": {
											"name": "Current",
											"type": "Decimal",
											"physicalType": "decimal",
											"scale": 2,
											"precision": 10
										},
										"sink": {
											"name": "Current",
											"type": "Decimal",
											"physicalType": "decimal",
											"scale": 2,
											"precision": 10
										}
									},
									{
										"source": {
											"name": "1-30",
											"type": "Decimal",
											"physicalType": "decimal",
											"scale": 2,
											"precision": 10
										},
										"sink": {
											"name": "1-30",
											"type": "Decimal",
											"physicalType": "decimal",
											"scale": 2,
											"precision": 10
										}
									},
									{
										"source": {
											"name": "31-60",
											"type": "Decimal",
											"physicalType": "decimal",
											"scale": 2,
											"precision": 10
										},
										"sink": {
											"name": "31-60",
											"type": "Decimal",
											"physicalType": "decimal",
											"scale": 2,
											"precision": 10
										}
									},
									{
										"source": {
											"name": "61-90",
											"type": "Decimal",
											"physicalType": "decimal",
											"scale": 2,
											"precision": 10
										},
										"sink": {
											"name": "61-90",
											"type": "Decimal",
											"physicalType": "decimal",
											"scale": 2,
											"precision": 10
										}
									},
									{
										"source": {
											"name": "91-150",
											"type": "Decimal",
											"physicalType": "decimal",
											"scale": 2,
											"precision": 10
										},
										"sink": {
											"name": "91-150",
											"type": "Decimal",
											"physicalType": "decimal",
											"scale": 2,
											"precision": 10
										}
									},
									{
										"source": {
											"name": "150+",
											"type": "Decimal",
											"physicalType": "decimal",
											"scale": 2,
											"precision": 10
										},
										"sink": {
											"name": "150+",
											"type": "Decimal",
											"physicalType": "decimal",
											"scale": 2,
											"precision": 10
										}
									},
									{
										"source": {
											"name": "91-120",
											"type": "Decimal",
											"physicalType": "decimal",
											"scale": 2,
											"precision": 10
										},
										"sink": {
											"name": "91-120",
											"type": "Decimal",
											"physicalType": "decimal",
											"scale": 2,
											"precision": 10
										}
									},
									{
										"source": {
											"name": "121-150",
											"type": "Decimal",
											"physicalType": "decimal",
											"scale": 2,
											"precision": 10
										},
										"sink": {
											"name": "121-150",
											"type": "Decimal",
											"physicalType": "decimal",
											"scale": 2,
											"precision": 10
										}
									},
									{
										"source": {
											"name": "151-180",
											"type": "Decimal",
											"physicalType": "decimal",
											"scale": 2,
											"precision": 10
										},
										"sink": {
											"name": "151-180",
											"type": "Decimal",
											"physicalType": "decimal",
											"scale": 2,
											"precision": 10
										}
									},
									{
										"source": {
											"name": "181-240",
											"type": "Decimal",
											"physicalType": "decimal",
											"scale": 2,
											"precision": 10
										},
										"sink": {
											"name": "181-240",
											"type": "Decimal",
											"physicalType": "decimal",
											"scale": 2,
											"precision": 10
										}
									},
									{
										"source": {
											"name": "241-300",
											"type": "Decimal",
											"physicalType": "decimal",
											"scale": 2,
											"precision": 10
										},
										"sink": {
											"name": "241-300",
											"type": "Decimal",
											"physicalType": "decimal",
											"scale": 2,
											"precision": 10
										}
									},
									{
										"source": {
											"name": "301-365",
											"type": "Decimal",
											"physicalType": "decimal",
											"scale": 2,
											"precision": 10
										},
										"sink": {
											"name": "301-365",
											"type": "Decimal",
											"physicalType": "decimal",
											"scale": 2,
											"precision": 10
										}
									},
									{
										"source": {
											"name": "366+",
											"type": "Decimal",
											"physicalType": "decimal",
											"scale": 2,
											"precision": 10
										},
										"sink": {
											"name": "366+",
											"type": "Decimal",
											"physicalType": "decimal",
											"scale": 2,
											"precision": 10
										}
									},
									{
										"source": {
											"name": "amountcur",
											"type": "Decimal",
											"physicalType": "decimal",
											"scale": 16,
											"precision": 32
										},
										"sink": {
											"name": "AMOUNTCUR",
											"type": "Decimal",
											"physicalType": "decimal",
											"scale": 16,
											"precision": 32
										}
									},
									{
										"source": {
											"name": "settleamountcur",
											"type": "Decimal",
											"physicalType": "decimal",
											"scale": 16,
											"precision": 32
										},
										"sink": {
											"name": "SETTLEAMOUNTCUR",
											"type": "Decimal",
											"physicalType": "decimal",
											"scale": 16,
											"precision": 32
										}
									},
									{
										"source": {
											"name": "last pay age",
											"type": "Int32",
											"physicalType": "int"
										},
										"sink": {
											"name": "Last Pay Age",
											"type": "Int32",
											"physicalType": "int"
										}
									},
									{
										"source": {
											"name": "svccallid",
											"type": "String",
											"physicalType": "nvarchar"
										},
										"sink": {
											"name": "SVCCALLID",
											"type": "String",
											"physicalType": "nvarchar"
										}
									},
									{
										"source": {
											"name": "equipmentid",
											"type": "String",
											"physicalType": "nvarchar"
										},
										"sink": {
											"name": "EQUIPMENTID",
											"type": "String",
											"physicalType": "nvarchar"
										}
									},
									{
										"source": {
											"name": "inventserialid",
											"type": "String",
											"physicalType": "nvarchar"
										},
										"sink": {
											"name": "INVENTSERIALID",
											"type": "String",
											"physicalType": "nvarchar"
										}
									},
									{
										"source": {
											"name": "createdby",
											"type": "String",
											"physicalType": "nvarchar"
										},
										"sink": {
											"name": "createdby",
											"type": "String",
											"physicalType": "nvarchar"
										}
									},
									{
										"source": {
											"name": "shipto_address",
											"type": "String",
											"physicalType": "nvarchar"
										},
										"sink": {
											"name": "ShipTo_Address",
											"type": "String",
											"physicalType": "nvarchar"
										}
									},
									{
										"source": {
											"name": "sale/svc",
											"type": "String",
											"physicalType": "nvarchar"
										},
										"sink": {
											"name": "Sale/SVC",
											"type": "String",
											"physicalType": "nvarchar"
										}
									},
									{
										"source": {
											"name": "rentalid",
											"type": "String",
											"physicalType": "nvarchar"
										},
										"sink": {
											"name": "RENTALID",
											"type": "String",
											"physicalType": "nvarchar"
										}
									},
									{
										"source": {
											"name": "txt",
											"type": "String",
											"physicalType": "nvarchar"
										},
										"sink": {
											"name": "txt",
											"type": "String",
											"physicalType": "nvarchar"
										}
									},
									{
										"source": {
											"name": "description",
											"type": "String",
											"physicalType": "nvarchar"
										},
										"sink": {
											"name": "DESCRIPTION",
											"type": "String",
											"physicalType": "nvarchar"
										}
									},
									{
										"source": {
											"name": "journalnum",
											"type": "String",
											"physicalType": "nvarchar"
										},
										"sink": {
											"name": "JOURNALNUM",
											"type": "String",
											"physicalType": "nvarchar"
										}
									},
									{
										"source": {
											"name": "paymmode",
											"type": "String",
											"physicalType": "nvarchar"
										},
										"sink": {
											"name": "PAYMMODE",
											"type": "String",
											"physicalType": "nvarchar"
										}
									},
									{
										"source": {
											"name": "posteddatetime",
											"type": "DateTime",
											"physicalType": "datetime"
										},
										"sink": {
											"name": "POSTEDDATETIME",
											"type": "DateTime",
											"physicalType": "datetime"
										}
									},
									{
										"source": {
											"name": "voucher",
											"type": "String",
											"physicalType": "nvarchar"
										},
										"sink": {
											"name": "VOUCHER",
											"type": "String",
											"physicalType": "nvarchar"
										}
									},
									{
										"source": {
											"name": "paymreference",
											"type": "String",
											"physicalType": "nvarchar"
										},
										"sink": {
											"name": "PAYMREFERENCE",
											"type": "String",
											"physicalType": "nvarchar"
										}
									},
									{
										"source": {
											"name": "lastsettledate",
											"type": "DateTime",
											"physicalType": "datetime"
										},
										"sink": {
											"name": "LASTSETTLEDATE",
											"type": "DateTime",
											"physicalType": "datetime"
										}
									},
									{
										"source": {
											"name": "closed",
											"type": "DateTime",
											"physicalType": "datetime"
										},
										"sink": {
											"name": "CLOSED",
											"type": "DateTime",
											"physicalType": "datetime"
										}
									}
								],
								"typeConversion": true,
								"typeConversionSettings": {
									"allowDataTruncation": true,
									"treatBooleanAsNumber": false
								}
							}
						},
						"inputs": [
							{
								"referenceName": "Briggs_MST",
								"type": "DatasetReference",
								"parameters": {}
							}
						],
						"outputs": [
							{
								"referenceName": "Briggs_MDW",
								"type": "DatasetReference",
								"parameters": {
									"schema_name": "Briggs",
									"table_name": "Stage_AR_Invoices_ALL"
								}
							}
						]
					},
					{
						"name": "Stored procedure1",
						"type": "SqlServerStoredProcedure",
						"dependsOn": [
							{
								"activity": "Stage_AR_Invoices_ALL",
								"dependencyConditions": [
									"Succeeded"
								]
							}
						],
						"policy": {
							"timeout": "7.00:00:00",
							"retry": 0,
							"retryIntervalInSeconds": 30,
							"secureOutput": false,
							"secureInput": false
						},
						"userProperties": [],
						"typeProperties": {
							"storedProcedureName": "[Briggs].[USP_Load_Fact_AR_Invoices_ALL]"
						},
						"linkedServiceName": {
							"referenceName": "DS_MDW_SP",
							"type": "LinkedServiceReference"
						}
					},
					{
						"name": "PL_Master_Dimension_Load",
						"type": "ExecutePipeline",
						"dependsOn": [
							{
								"activity": "PL_SCALE_AZURE_SQL_DW500",
								"dependencyConditions": [
									"Succeeded"
								]
							}
						],
						"userProperties": [],
						"typeProperties": {
							"pipeline": {
								"referenceName": "PL_Master_Dimension_Load",
								"type": "PipelineReference"
							},
							"waitOnCompletion": true,
							"parameters": {}
						}
					},
					{
						"name": "PL_SCALE_AZURE_SQL_DW500",
						"type": "ExecutePipeline",
						"dependsOn": [],
						"userProperties": [],
						"typeProperties": {
							"pipeline": {
								"referenceName": "PL_SCALE_AZURE_SQL_DW",
								"type": "PipelineReference"
							},
							"waitOnCompletion": true,
							"parameters": {}
						}
					},
					{
						"name": "PL_SCALE_AZURE_SQL_DW100",
						"type": "ExecutePipeline",
						"dependsOn": [
							{
								"activity": "PL_Master_Briggs_Misc",
								"dependencyConditions": [
									"Succeeded",
									"Failed"
								]
							}
						],
						"userProperties": [],
						"typeProperties": {
							"pipeline": {
								"referenceName": "PL_SCALE_AZURE_SQL_DW",
								"type": "PipelineReference"
							},
							"waitOnCompletion": true,
							"parameters": {
								"PerformanceLevel": "DW100c"
							}
						}
					},
					{
						"name": "ErrorMail",
						"type": "Lookup",
						"dependsOn": [
							{
								"activity": "PL_SCALE_AZURE_SQL_DW100",
								"dependencyConditions": [
									"Succeeded"
								]
							}
						],
						"policy": {
							"timeout": "7.00:00:00",
							"retry": 0,
							"retryIntervalInSeconds": 30,
							"secureOutput": false,
							"secureInput": false
						},
						"userProperties": [],
						"typeProperties": {
							"source": {
								"type": "AzureSqlSource",
								"sqlReaderQuery": "select top 1 'PipelineName:- '+pipelinename+ ' ----  Status:- '+status as Details,starttime,pipelinename,auditid\n from dbo.auditlog where status not like '%Success%'  and \n format(starttime,'MM/dd/yyyy')=FORMAT (getdate(), 'MM/dd/yyyy')  and pipelinename not like '%POR%'\norder by starttime desc",
								"queryTimeout": "02:00:00",
								"partitionOption": "None"
							},
							"dataset": {
								"referenceName": "Briggs_MDW",
								"type": "DatasetReference",
								"parameters": {
									"schema_name": "dbo",
									"table_name": "user"
								}
							},
							"firstRowOnly": false
						}
					},
					{
						"name": "ForEach1",
						"type": "ForEach",
						"dependsOn": [
							{
								"activity": "ErrorMail",
								"dependencyConditions": [
									"Succeeded"
								]
							}
						],
						"userProperties": [],
						"typeProperties": {
							"items": {
								"value": "@activity('ErrorMail').output.value",
								"type": "Expression"
							},
							"isSequential": false,
							"activities": [
								{
									"name": "Web1",
									"type": "WebActivity",
									"dependsOn": [],
									"policy": {
										"timeout": "7.00:00:00",
										"retry": 0,
										"retryIntervalInSeconds": 30,
										"secureOutput": false,
										"secureInput": false
									},
									"userProperties": [],
									"typeProperties": {
										"url": "https://prod-13.centralus.logic.azure.com:443/workflows/e14fef5aeb97428fb0308d84982cc3f6/triggers/manual/paths/invoke?api-version=2016-10-01&sp=%2Ftriggers%2Fmanual%2Frun&sv=1.0&sig=5cJxMg50A3fDsG0iby7hSIbBQ-EV-Gv7wRqf6d2uOPY",
										"connectVia": {
											"referenceName": "AutoResolveIntegrationRuntime",
											"type": "IntegrationRuntimeReference"
										},
										"method": "POST",
										"headers": {},
										"body": {
											"value": "{\n    \"Pipeline\":\"@{pipeline().Pipeline}\",\n    \"DataFactoryName\" : \"@{pipeline().DataFactory}\",\n    \"Runid\" : \"@{pipeline().RunId}\"\n}",
											"type": "Expression"
										}
									}
								}
							]
						}
					}
				],
				"policy": {
					"elapsedTimeMetric": {},
					"cancelAfter": {}
				},
				"folder": {
					"name": "Briggs Data Load Theme wise"
				},
				"annotations": [],
				"lastPublishTime": "2022-05-02T06:42:59Z"
			},
			"dependsOn": [
				"[concat(variables('workspaceId'), '/pipelines/PL_Master_Briggs_AR')]",
				"[concat(variables('workspaceId'), '/pipelines/PL_Master_Briggs_Customer')]",
				"[concat(variables('workspaceId'), '/pipelines/PL_Master_Briggs_Commission')]",
				"[concat(variables('workspaceId'), '/pipelines/PL_Master_Briggs_Equipment')]",
				"[concat(variables('workspaceId'), '/pipelines/PL_Master_Briggs_Parts')]",
				"[concat(variables('workspaceId'), '/pipelines/PL_Master_Briggs_Rental')]",
				"[concat(variables('workspaceId'), '/pipelines/PL_Master_Briggs_AP')]",
				"[concat(variables('workspaceId'), '/pipelines/PL_Master_Briggs_Billing')]",
				"[concat(variables('workspaceId'), '/pipelines/PL_Master_Briggs_Tech')]",
				"[concat(variables('workspaceId'), '/pipelines/PL_Master_Briggs_Statement')]",
				"[concat(variables('workspaceId'), '/pipelines/PL_Master_Briggs_Invoices')]",
				"[concat(variables('workspaceId'), '/pipelines/PL_Master_Briggs_GM')]",
				"[concat(variables('workspaceId'), '/pipelines/PL_Master_Briggs_Inventory')]",
				"[concat(variables('workspaceId'), '/pipelines/PL_Master_Briggs_Operations')]",
				"[concat(variables('workspaceId'), '/pipelines/PL_Master_Briggs_Service')]",
				"[concat(variables('workspaceId'), '/pipelines/PL_Master_Briggs_Misc')]",
				"[concat(variables('workspaceId'), '/datasets/Briggs_MST')]",
				"[concat(variables('workspaceId'), '/datasets/Briggs_MDW')]",
				"[concat(variables('workspaceId'), '/linkedServices/DS_MDW_SP')]",
				"[concat(variables('workspaceId'), '/pipelines/PL_Master_Dimension_Load')]",
				"[concat(variables('workspaceId'), '/pipelines/PL_SCALE_AZURE_SQL_DW')]",
				"[concat(variables('workspaceId'), '/integrationRuntimes/AutoResolveIntegrationRuntime')]"
			]
		},
		{
			"name": "[concat(parameters('workspaceName'), '/PL_MASTER_LOAD_POR')]",
			"type": "Microsoft.Synapse/workspaces/pipelines",
			"apiVersion": "2019-06-01-preview",
			"properties": {
				"activities": [
					{
						"name": "Exec PL_Generic_Loop",
						"type": "ExecutePipeline",
						"dependsOn": [
							{
								"activity": "lkp_ExecStartAuditProc",
								"dependencyConditions": [
									"Succeeded"
								]
							}
						],
						"userProperties": [],
						"typeProperties": {
							"pipeline": {
								"referenceName": "PL_Generic_Loop_ADLS_POR",
								"type": "PipelineReference"
							},
							"waitOnCompletion": true,
							"parameters": {
								"ParentAuditID": {
									"value": "@activity('lkp_ExecStartAuditProc').output.firstRow.AuditID",
									"type": "Expression"
								}
							}
						}
					},
					{
						"name": "Sp_ExecSuccessAudit",
						"type": "SqlServerStoredProcedure",
						"dependsOn": [
							{
								"activity": "LOAD_POR_TEMP",
								"dependencyConditions": [
									"Succeeded"
								]
							}
						],
						"policy": {
							"timeout": "7.00:00:00",
							"retry": 0,
							"retryIntervalInSeconds": 30,
							"secureOutput": false,
							"secureInput": false
						},
						"userProperties": [],
						"typeProperties": {
							"storedProcedureName": "[dbo].[proc_UpdateAuditLog]",
							"storedProcedureParameters": {
								"AuditID": {
									"value": {
										"value": "@activity('lkp_ExecStartAuditProc').output.firstRow.AuditID",
										"type": "Expression"
									},
									"type": "Int32"
								},
								"DataLakePath": {
									"value": null,
									"type": "String"
								},
								"RowsRead": {
									"value": null,
									"type": "Int64"
								},
								"Status": {
									"value": "Success",
									"type": "String"
								},
								"PipelineRunID": {
									"value": {
										"value": "@pipeline().RunId",
										"type": "Expression"
									},
									"type": "String"
								}
							}
						},
						"linkedServiceName": {
							"referenceName": "AzureSqlDatabase1",
							"type": "LinkedServiceReference"
						}
					},
					{
						"name": "Sp_ExecFailureAudit",
						"type": "SqlServerStoredProcedure",
						"dependsOn": [
							{
								"activity": "LOAD_POR_TEMP",
								"dependencyConditions": [
									"Failed"
								]
							}
						],
						"policy": {
							"timeout": "7.00:00:00",
							"retry": 0,
							"retryIntervalInSeconds": 30,
							"secureOutput": false,
							"secureInput": false
						},
						"userProperties": [],
						"typeProperties": {
							"storedProcedureName": "[dbo].[proc_UpdateAuditLog]",
							"storedProcedureParameters": {
								"AuditID": {
									"value": {
										"value": "@activity('lkp_ExecStartAuditProc').output.firstRow.AuditID",
										"type": "Expression"
									},
									"type": "Int32"
								},
								"DataLakePath": {
									"value": null,
									"type": "String"
								},
								"PipelineRunID": {
									"value": {
										"value": "@pipeline().RunId",
										"type": "Expression"
									},
									"type": "String"
								},
								"RowsRead": {
									"value": null,
									"type": "Int64"
								},
								"Status": {
									"value": "Failed",
									"type": "String"
								}
							}
						},
						"linkedServiceName": {
							"referenceName": "AzureSqlDatabase1",
							"type": "LinkedServiceReference"
						}
					},
					{
						"name": "lkp_ExecStartAuditProc",
						"type": "Lookup",
						"dependsOn": [],
						"policy": {
							"timeout": "7.00:00:00",
							"retry": 0,
							"retryIntervalInSeconds": 30,
							"secureOutput": false,
							"secureInput": false
						},
						"userProperties": [],
						"typeProperties": {
							"source": {
								"type": "AzureSqlSource",
								"sqlReaderStoredProcedureName": "[dbo].[proc_StartAuditLog]",
								"storedProcedureParameters": {
									"ConfigTableID": {
										"type": "Int32",
										"value": "-1"
									},
									"DataFactoryName": {
										"type": "String",
										"value": {
											"value": "@pipeline().DataFactory",
											"type": "Expression"
										}
									},
									"ParentAuditID": {
										"type": "Int64",
										"value": "-1"
									},
									"PipelineName": {
										"type": "String",
										"value": {
											"value": "@pipeline().Pipeline",
											"type": "Expression"
										}
									},
									"PipelineRunID": {
										"type": "String",
										"value": {
											"value": "@pipeline().RunId",
											"type": "Expression"
										}
									},
									"PipelineTriggerID": {
										"type": "String",
										"value": {
											"value": "@pipeline().TriggerId",
											"type": "Expression"
										}
									},
									"PipelineTriggerName": {
										"type": "String",
										"value": {
											"value": "@pipeline().TriggerName",
											"type": "Expression"
										}
									},
									"PipelineTriggerType": {
										"type": "String",
										"value": {
											"value": "@pipeline().TriggerType",
											"type": "Expression"
										}
									}
								},
								"queryTimeout": "02:00:00",
								"partitionOption": "None"
							},
							"dataset": {
								"referenceName": "Briggs_MDW",
								"type": "DatasetReference",
								"parameters": {
									"schema_name": "dbo",
									"table_name": "user"
								}
							}
						}
					},
					{
						"name": "PL_POR_EXECUTIVE_STAGE_TABLES_LOAD",
						"type": "ExecutePipeline",
						"dependsOn": [
							{
								"activity": "Exec PL_Generic_Loop",
								"dependencyConditions": [
									"Succeeded"
								]
							}
						],
						"userProperties": [],
						"typeProperties": {
							"pipeline": {
								"referenceName": "PL_POR_EXECUTIVE_STAGE_TABLES_LOAD",
								"type": "PipelineReference"
							},
							"waitOnCompletion": true,
							"parameters": {}
						}
					},
					{
						"name": "LOAD_POR_TEMP",
						"type": "ExecutePipeline",
						"dependsOn": [
							{
								"activity": "PL_POR_EXECUTIVE_STAGE_TABLES_LOAD",
								"dependencyConditions": [
									"Succeeded"
								]
							}
						],
						"userProperties": [],
						"typeProperties": {
							"pipeline": {
								"referenceName": "Load_POR_TEMP",
								"type": "PipelineReference"
							},
							"waitOnCompletion": true,
							"parameters": {}
						}
					},
					{
						"name": "ErrorMail",
						"type": "Lookup",
						"dependsOn": [
							{
								"activity": "Sp_ExecFailureAudit",
								"dependencyConditions": [
									"Succeeded"
								]
							}
						],
						"policy": {
							"timeout": "7.00:00:00",
							"retry": 0,
							"retryIntervalInSeconds": 30,
							"secureOutput": false,
							"secureInput": false
						},
						"userProperties": [],
						"typeProperties": {
							"source": {
								"type": "AzureSqlSource",
								"sqlReaderQuery": "select top 1 'PipelineName:- '+pipelinename+ ' ----  Status:- '+status as Details,starttime,pipelinename,auditid\n from dbo.auditlog where status not like '%Success%'  and \n format(starttime,'MM/dd/yyyy')=FORMAT (getdate(), 'MM/dd/yyyy')  and pipelinename like '%POR%'\norder by starttime desc",
								"queryTimeout": "02:00:00",
								"partitionOption": "None"
							},
							"dataset": {
								"referenceName": "Briggs_MDW",
								"type": "DatasetReference",
								"parameters": {
									"schema_name": "dbo",
									"table_name": "user"
								}
							},
							"firstRowOnly": false
						}
					},
					{
						"name": "ForEach1",
						"type": "ForEach",
						"dependsOn": [
							{
								"activity": "ErrorMail",
								"dependencyConditions": [
									"Succeeded"
								]
							}
						],
						"userProperties": [],
						"typeProperties": {
							"items": {
								"value": "@activity('ErrorMail').output.value",
								"type": "Expression"
							},
							"isSequential": false,
							"activities": [
								{
									"name": "Web1",
									"type": "WebActivity",
									"dependsOn": [],
									"policy": {
										"timeout": "7.00:00:00",
										"retry": 0,
										"retryIntervalInSeconds": 30,
										"secureOutput": false,
										"secureInput": false
									},
									"userProperties": [],
									"typeProperties": {
										"url": "https://prod-04.centralus.logic.azure.com:443/workflows/913be55d545848e5b804a2f7dbffcae2/triggers/manual/paths/invoke?api-version=2016-10-01&sp=%2Ftriggers%2Fmanual%2Frun&sv=1.0&sig=RqqH_4dTodfE5GN4Y2AMLk1SlD8ZAfV-IgMl8XuEegM",
										"connectVia": {
											"referenceName": "AutoResolveIntegrationRuntime",
											"type": "IntegrationRuntimeReference"
										},
										"method": "POST",
										"headers": {},
										"body": {
											"value": "{\n    \"Pipeline\":\"@{pipeline().Pipeline}\",\n    \"DataFactoryName\" : \"@{pipeline().DataFactory}\",\n    \"Runid\" : \"@{pipeline().RunId}\"\n}",
											"type": "Expression"
										}
									}
								}
							]
						}
					}
				],
				"policy": {
					"elapsedTimeMetric": {},
					"cancelAfter": {}
				},
				"folder": {
					"name": "MDP POR DataLoad"
				},
				"annotations": [],
				"lastPublishTime": "2022-05-02T11:07:30Z"
			},
			"dependsOn": [
				"[concat(variables('workspaceId'), '/pipelines/PL_Generic_Loop_ADLS_POR')]",
				"[concat(variables('workspaceId'), '/linkedServices/AzureSqlDatabase1')]",
				"[concat(variables('workspaceId'), '/datasets/Briggs_MDW')]",
				"[concat(variables('workspaceId'), '/pipelines/PL_POR_EXECUTIVE_STAGE_TABLES_LOAD')]",
				"[concat(variables('workspaceId'), '/pipelines/Load_POR_TEMP')]",
				"[concat(variables('workspaceId'), '/integrationRuntimes/AutoResolveIntegrationRuntime')]"
			]
		},
		{
			"name": "[concat(parameters('workspaceName'), '/PL_Master_Briggs_AP')]",
			"type": "Microsoft.Synapse/workspaces/pipelines",
			"apiVersion": "2019-06-01-preview",
			"properties": {
				"activities": [
					{
						"name": "Execute Pipeline1",
						"type": "ExecutePipeline",
						"dependsOn": [
							{
								"activity": "lkp_ExecStartAuditProc",
								"dependencyConditions": [
									"Succeeded"
								]
							}
						],
						"userProperties": [],
						"typeProperties": {
							"pipeline": {
								"referenceName": "PL_Generic_Copy_AP",
								"type": "PipelineReference"
							},
							"waitOnCompletion": true,
							"parameters": {}
						}
					},
					{
						"name": "ReportStageProc",
						"type": "Lookup",
						"dependsOn": [
							{
								"activity": "Execute Pipeline1",
								"dependencyConditions": [
									"Succeeded"
								]
							}
						],
						"policy": {
							"timeout": "7.00:00:00",
							"retry": 0,
							"retryIntervalInSeconds": 30,
							"secureOutput": false,
							"secureInput": false
						},
						"userProperties": [],
						"typeProperties": {
							"source": {
								"type": "AzureSqlSource",
								"sqlReaderQuery": "select  * from dbo.control_table where processsequence = 2 and enableaction = 1 \nand subjectarea='Report Stage AP SP'\norder by id",
								"queryTimeout": "02:00:00",
								"partitionOption": "None"
							},
							"dataset": {
								"referenceName": "Briggs_MDW",
								"type": "DatasetReference",
								"parameters": {
									"schema_name": "dbo",
									"table_name": "user"
								}
							},
							"firstRowOnly": false
						}
					},
					{
						"name": "ForEach_Stage",
						"type": "ForEach",
						"dependsOn": [
							{
								"activity": "ReportStageProc",
								"dependencyConditions": [
									"Succeeded"
								]
							}
						],
						"userProperties": [],
						"typeProperties": {
							"items": {
								"value": "@activity('ReportStageProc').output.value",
								"type": "Expression"
							},
							"activities": [
								{
									"name": "Stored procedure1",
									"type": "SqlServerStoredProcedure",
									"dependsOn": [
										{
											"activity": "Start_Table_Audit_Stage",
											"dependencyConditions": [
												"Succeeded"
											]
										}
									],
									"policy": {
										"timeout": "7.00:00:00",
										"retry": 0,
										"retryIntervalInSeconds": 30,
										"secureOutput": false,
										"secureInput": false
									},
									"userProperties": [],
									"typeProperties": {
										"storedProcedureName": {
											"value": "@item().sourcetablename",
											"type": "Expression"
										}
									},
									"linkedServiceName": {
										"referenceName": "DS_MDW_SP",
										"type": "LinkedServiceReference"
									}
								},
								{
									"name": "Start_Table_Audit_Stage",
									"type": "Lookup",
									"dependsOn": [],
									"policy": {
										"timeout": "7.00:00:00",
										"retry": 0,
										"retryIntervalInSeconds": 30,
										"secureOutput": false,
										"secureInput": false
									},
									"userProperties": [],
									"typeProperties": {
										"source": {
											"type": "AzureSqlSource",
											"sqlReaderStoredProcedureName": "[dbo].[proc_StartAuditLog_Briggs]",
											"storedProcedureParameters": {
												"ConfigTableID": {
													"type": "Int32",
													"value": {
														"value": "@item().ID",
														"type": "Expression"
													}
												},
												"DataFactoryName": {
													"type": "String",
													"value": {
														"value": "@pipeline().DataFactory",
														"type": "Expression"
													}
												},
												"ParentAuditID": {
													"type": "Int64",
													"value": {
														"value": "@item().ID",
														"type": "Expression"
													}
												},
												"PipelineName": {
													"type": "String",
													"value": {
														"value": "@pipeline().Pipeline",
														"type": "Expression"
													}
												},
												"PipelineRunID": {
													"type": "String",
													"value": {
														"value": "@pipeline().RunId",
														"type": "Expression"
													}
												},
												"PipelineTriggerID": {
													"type": "String",
													"value": {
														"value": "@pipeline().TriggerId",
														"type": "Expression"
													}
												},
												"PipelineTriggerName": {
													"type": "String",
													"value": {
														"value": "@pipeline().TriggerName",
														"type": "Expression"
													}
												},
												"PipelineTriggerType": {
													"type": "String",
													"value": {
														"value": "@pipeline().TriggerType",
														"type": "Expression"
													}
												},
												"Sourcedb": {
													"type": "String",
													"value": {
														"value": "@item().sourceDB",
														"type": "Expression"
													}
												},
												"sourcetable": {
													"type": "String",
													"value": {
														"value": "@item().SourcetableName",
														"type": "Expression"
													}
												}
											},
											"queryTimeout": "02:00:00",
											"partitionOption": "None"
										},
										"dataset": {
											"referenceName": "Briggs_MDW",
											"type": "DatasetReference",
											"parameters": {
												"schema_name": "dbo",
												"table_name": "user"
											}
										},
										"firstRowOnly": false
									}
								},
								{
									"name": "Set variable_Stage",
									"type": "SetVariable",
									"dependsOn": [
										{
											"activity": "Stored procedure1",
											"dependencyConditions": [
												"Failed"
											]
										}
									],
									"userProperties": [],
									"typeProperties": {
										"variableName": "ErrorMsg",
										"value": {
											"value": "@activity('Stored procedure1').Error.Message",
											"type": "Expression"
										}
									}
								},
								{
									"name": "Failure_Audit_Log_Stage",
									"type": "SqlServerStoredProcedure",
									"dependsOn": [
										{
											"activity": "Set variable_Stage",
											"dependencyConditions": [
												"Succeeded"
											]
										}
									],
									"policy": {
										"timeout": "7.00:00:00",
										"retry": 0,
										"retryIntervalInSeconds": 30,
										"secureOutput": false,
										"secureInput": false
									},
									"userProperties": [],
									"typeProperties": {
										"storedProcedureName": "[dbo].[proc_UpdateAuditLog_Briggs]",
										"storedProcedureParameters": {
											"ConfigTableID": {
												"value": {
													"value": "@item().ID",
													"type": "Expression"
												},
												"type": "Int32"
											},
											"RowsRead": {
												"value": null,
												"type": "Int64"
											},
											"Status": {
												"value": {
													"value": "@variables('ErrorMsg')",
													"type": "Expression"
												},
												"type": "String"
											}
										}
									},
									"linkedServiceName": {
										"referenceName": "DS_MDW_SP",
										"type": "LinkedServiceReference"
									}
								},
								{
									"name": "Success_Audit_Log_Stage",
									"type": "SqlServerStoredProcedure",
									"dependsOn": [
										{
											"activity": "Stored procedure1",
											"dependencyConditions": [
												"Succeeded"
											]
										}
									],
									"policy": {
										"timeout": "7.00:00:00",
										"retry": 0,
										"retryIntervalInSeconds": 30,
										"secureOutput": false,
										"secureInput": false
									},
									"userProperties": [],
									"typeProperties": {
										"storedProcedureName": "[dbo].[proc_UpdateAuditLog_Briggs]",
										"storedProcedureParameters": {
											"ConfigTableID": {
												"value": {
													"value": "@item().ID",
													"type": "Expression"
												},
												"type": "Int32"
											},
											"RowsRead": {
												"value": null,
												"type": "Int64"
											},
											"Status": {
												"value": "Success",
												"type": "String"
											}
										}
									},
									"linkedServiceName": {
										"referenceName": "DS_MDW_SP",
										"type": "LinkedServiceReference"
									}
								}
							]
						}
					},
					{
						"name": "ReportFactProc",
						"type": "Lookup",
						"dependsOn": [
							{
								"activity": "ForEach_Stage",
								"dependencyConditions": [
									"Succeeded"
								]
							}
						],
						"policy": {
							"timeout": "7.00:00:00",
							"retry": 0,
							"retryIntervalInSeconds": 30,
							"secureOutput": false,
							"secureInput": false
						},
						"userProperties": [],
						"typeProperties": {
							"source": {
								"type": "AzureSqlSource",
								"sqlReaderQuery": "select  * from dbo.control_table where processsequence = 4 and enableaction = 1 \nand subjectarea='Report Fact AP SP'\norder by id",
								"queryTimeout": "02:00:00",
								"partitionOption": "None"
							},
							"dataset": {
								"referenceName": "Briggs_MDW",
								"type": "DatasetReference",
								"parameters": {
									"schema_name": "dbo",
									"table_name": "user"
								}
							},
							"firstRowOnly": false
						}
					},
					{
						"name": "ForEach_Fact",
						"type": "ForEach",
						"dependsOn": [
							{
								"activity": "ReportFactProc",
								"dependencyConditions": [
									"Succeeded"
								]
							}
						],
						"userProperties": [],
						"typeProperties": {
							"items": {
								"value": "@activity('ReportFactProc').output.value",
								"type": "Expression"
							},
							"activities": [
								{
									"name": "Stored procedure",
									"type": "SqlServerStoredProcedure",
									"dependsOn": [
										{
											"activity": "Start_Table_Audit1_Fact",
											"dependencyConditions": [
												"Succeeded"
											]
										}
									],
									"policy": {
										"timeout": "7.00:00:00",
										"retry": 0,
										"retryIntervalInSeconds": 30,
										"secureOutput": false,
										"secureInput": false
									},
									"userProperties": [],
									"typeProperties": {
										"storedProcedureName": {
											"value": "@item().sourcetablename",
											"type": "Expression"
										}
									},
									"linkedServiceName": {
										"referenceName": "DS_MDW_SP",
										"type": "LinkedServiceReference"
									}
								},
								{
									"name": "Start_Table_Audit1_Fact",
									"type": "Lookup",
									"dependsOn": [],
									"policy": {
										"timeout": "7.00:00:00",
										"retry": 0,
										"retryIntervalInSeconds": 30,
										"secureOutput": false,
										"secureInput": false
									},
									"userProperties": [],
									"typeProperties": {
										"source": {
											"type": "AzureSqlSource",
											"sqlReaderStoredProcedureName": "[dbo].[proc_StartAuditLog_Briggs]",
											"storedProcedureParameters": {
												"ConfigTableID": {
													"type": "Int32",
													"value": {
														"value": "@item().ID",
														"type": "Expression"
													}
												},
												"DataFactoryName": {
													"type": "String",
													"value": {
														"value": "@pipeline().DataFactory",
														"type": "Expression"
													}
												},
												"ParentAuditID": {
													"type": "Int64",
													"value": {
														"value": "@item().ID",
														"type": "Expression"
													}
												},
												"PipelineName": {
													"type": "String",
													"value": {
														"value": "@pipeline().Pipeline",
														"type": "Expression"
													}
												},
												"PipelineRunID": {
													"type": "String",
													"value": {
														"value": "@pipeline().RunId",
														"type": "Expression"
													}
												},
												"PipelineTriggerID": {
													"type": "String",
													"value": {
														"value": "@pipeline().TriggerId",
														"type": "Expression"
													}
												},
												"PipelineTriggerName": {
													"type": "String",
													"value": {
														"value": "@pipeline().TriggerName",
														"type": "Expression"
													}
												},
												"PipelineTriggerType": {
													"type": "String",
													"value": {
														"value": "@pipeline().TriggerType",
														"type": "Expression"
													}
												},
												"Sourcedb": {
													"type": "String",
													"value": {
														"value": "@item().sourceDB",
														"type": "Expression"
													}
												},
												"sourcetable": {
													"type": "String",
													"value": {
														"value": "@item().SourcetableName",
														"type": "Expression"
													}
												}
											},
											"queryTimeout": "02:00:00",
											"partitionOption": "None"
										},
										"dataset": {
											"referenceName": "Briggs_MDW",
											"type": "DatasetReference",
											"parameters": {
												"schema_name": "dbo",
												"table_name": "user"
											}
										},
										"firstRowOnly": false
									}
								},
								{
									"name": "Set variable1_Fact",
									"type": "SetVariable",
									"dependsOn": [
										{
											"activity": "Stored procedure",
											"dependencyConditions": [
												"Failed"
											]
										}
									],
									"userProperties": [],
									"typeProperties": {
										"variableName": "ErrorMsg",
										"value": {
											"value": "@activity('ReportStageProc').Error.Message",
											"type": "Expression"
										}
									}
								},
								{
									"name": "Failure_Audit_Log_Fact",
									"type": "SqlServerStoredProcedure",
									"dependsOn": [
										{
											"activity": "Set variable1_Fact",
											"dependencyConditions": [
												"Succeeded"
											]
										}
									],
									"policy": {
										"timeout": "7.00:00:00",
										"retry": 0,
										"retryIntervalInSeconds": 30,
										"secureOutput": false,
										"secureInput": false
									},
									"userProperties": [],
									"typeProperties": {
										"storedProcedureName": "[dbo].[proc_UpdateAuditLog_Briggs]",
										"storedProcedureParameters": {
											"ConfigTableID": {
												"value": {
													"value": "@item().ID",
													"type": "Expression"
												},
												"type": "Int32"
											},
											"RowsRead": {
												"value": null,
												"type": "Int64"
											},
											"Status": {
												"value": {
													"value": "@variables('ErrorMsg')",
													"type": "Expression"
												},
												"type": "String"
											}
										}
									},
									"linkedServiceName": {
										"referenceName": "DS_MDW_SP",
										"type": "LinkedServiceReference"
									}
								},
								{
									"name": "Success_Audit_Log2_Fact",
									"type": "SqlServerStoredProcedure",
									"dependsOn": [
										{
											"activity": "Stored procedure",
											"dependencyConditions": [
												"Succeeded"
											]
										}
									],
									"policy": {
										"timeout": "7.00:00:00",
										"retry": 0,
										"retryIntervalInSeconds": 30,
										"secureOutput": false,
										"secureInput": false
									},
									"userProperties": [],
									"typeProperties": {
										"storedProcedureName": "[dbo].[proc_UpdateAuditLog_Briggs]",
										"storedProcedureParameters": {
											"ConfigTableID": {
												"value": {
													"value": "@item().ID",
													"type": "Expression"
												},
												"type": "Int32"
											},
											"RowsRead": {
												"value": null,
												"type": "Int64"
											},
											"Status": {
												"value": "Success",
												"type": "String"
											}
										}
									},
									"linkedServiceName": {
										"referenceName": "DS_MDW_SP",
										"type": "LinkedServiceReference"
									}
								}
							]
						}
					},
					{
						"name": "lkp_ExecStartAuditProc",
						"type": "Lookup",
						"dependsOn": [],
						"policy": {
							"timeout": "7.00:00:00",
							"retry": 0,
							"retryIntervalInSeconds": 30,
							"secureOutput": false,
							"secureInput": false
						},
						"userProperties": [],
						"typeProperties": {
							"source": {
								"type": "AzureSqlSource",
								"sqlReaderStoredProcedureName": "[dbo].[proc_StartAuditLog]",
								"storedProcedureParameters": {
									"ConfigTableID": {
										"type": "Int32",
										"value": "-1"
									},
									"DataFactoryName": {
										"type": "String",
										"value": {
											"value": "@pipeline().DataFactory",
											"type": "Expression"
										}
									},
									"ParentAuditID": {
										"type": "Int64",
										"value": "-1"
									},
									"PipelineName": {
										"type": "String",
										"value": {
											"value": "@pipeline().Pipeline",
											"type": "Expression"
										}
									},
									"PipelineRunID": {
										"type": "String",
										"value": {
											"value": "@pipeline().RunId",
											"type": "Expression"
										}
									},
									"PipelineTriggerID": {
										"type": "String",
										"value": {
											"value": "@pipeline().TriggerId",
											"type": "Expression"
										}
									},
									"PipelineTriggerName": {
										"type": "String",
										"value": {
											"value": "@pipeline().TriggerName",
											"type": "Expression"
										}
									},
									"PipelineTriggerType": {
										"type": "String",
										"value": {
											"value": "@pipeline().TriggerType",
											"type": "Expression"
										}
									}
								},
								"queryTimeout": "02:00:00",
								"partitionOption": "None"
							},
							"dataset": {
								"referenceName": "Briggs_MDW",
								"type": "DatasetReference",
								"parameters": {
									"schema_name": "dbo",
									"table_name": "user"
								}
							}
						}
					},
					{
						"name": "Sp_ExecSuccessAudit",
						"type": "SqlServerStoredProcedure",
						"dependsOn": [
							{
								"activity": "ForEach_Fact",
								"dependencyConditions": [
									"Succeeded"
								]
							}
						],
						"policy": {
							"timeout": "7.00:00:00",
							"retry": 0,
							"retryIntervalInSeconds": 30,
							"secureOutput": false,
							"secureInput": false
						},
						"userProperties": [],
						"typeProperties": {
							"storedProcedureName": "[dbo].[proc_UpdateAuditLog]",
							"storedProcedureParameters": {
								"AuditID": {
									"value": {
										"value": "@activity('lkp_ExecStartAuditProc').output.firstRow.AuditID",
										"type": "Expression"
									},
									"type": "Int32"
								},
								"DataLakePath": {
									"value": null,
									"type": "String"
								},
								"RowsRead": {
									"value": null,
									"type": "Int64"
								},
								"Status": {
									"value": "Success",
									"type": "String"
								},
								"PipelineRunID": {
									"value": {
										"value": "@pipeline().RunId",
										"type": "Expression"
									},
									"type": "String"
								}
							}
						},
						"linkedServiceName": {
							"referenceName": "AzureSqlDatabase1",
							"type": "LinkedServiceReference"
						}
					},
					{
						"name": "Sp_ExecFailureAudit_Fact",
						"type": "SqlServerStoredProcedure",
						"dependsOn": [
							{
								"activity": "ForEach_Fact",
								"dependencyConditions": [
									"Failed"
								]
							}
						],
						"policy": {
							"timeout": "7.00:00:00",
							"retry": 0,
							"retryIntervalInSeconds": 30,
							"secureOutput": false,
							"secureInput": false
						},
						"userProperties": [],
						"typeProperties": {
							"storedProcedureName": "[dbo].[proc_UpdateAuditLog]",
							"storedProcedureParameters": {
								"AuditID": {
									"value": {
										"value": "@activity('lkp_ExecStartAuditProc').output.firstRow.AuditID",
										"type": "Expression"
									},
									"type": "Int32"
								},
								"DataLakePath": {
									"value": null,
									"type": "String"
								},
								"PipelineRunID": {
									"value": {
										"value": "@pipeline().RunId",
										"type": "Expression"
									},
									"type": "String"
								},
								"RowsRead": {
									"value": null,
									"type": "Int64"
								},
								"Status": {
									"value": "Fact Proc Failed",
									"type": "String"
								}
							}
						},
						"linkedServiceName": {
							"referenceName": "AzureSqlDatabase1",
							"type": "LinkedServiceReference"
						}
					},
					{
						"name": "Sp_ExecFailureAudit_Stage",
						"type": "SqlServerStoredProcedure",
						"dependsOn": [
							{
								"activity": "ForEach_Stage",
								"dependencyConditions": [
									"Failed"
								]
							}
						],
						"policy": {
							"timeout": "7.00:00:00",
							"retry": 0,
							"retryIntervalInSeconds": 30,
							"secureOutput": false,
							"secureInput": false
						},
						"userProperties": [],
						"typeProperties": {
							"storedProcedureName": "[dbo].[proc_UpdateAuditLog]",
							"storedProcedureParameters": {
								"AuditID": {
									"value": {
										"value": "@activity('lkp_ExecStartAuditProc').output.firstRow.AuditID",
										"type": "Expression"
									},
									"type": "Int32"
								},
								"DataLakePath": {
									"value": null,
									"type": "String"
								},
								"PipelineRunID": {
									"value": {
										"value": "@pipeline().RunId",
										"type": "Expression"
									},
									"type": "String"
								},
								"RowsRead": {
									"value": null,
									"type": "Int64"
								},
								"Status": {
									"value": "Stage Proc Failed",
									"type": "String"
								}
							}
						},
						"linkedServiceName": {
							"referenceName": "AzureSqlDatabase1",
							"type": "LinkedServiceReference"
						}
					},
					{
						"name": "Sp_ExecFailureAudit_TL",
						"type": "SqlServerStoredProcedure",
						"dependsOn": [
							{
								"activity": "Execute Pipeline1",
								"dependencyConditions": [
									"Failed"
								]
							}
						],
						"policy": {
							"timeout": "7.00:00:00",
							"retry": 0,
							"retryIntervalInSeconds": 30,
							"secureOutput": false,
							"secureInput": false
						},
						"userProperties": [],
						"typeProperties": {
							"storedProcedureName": "[dbo].[proc_UpdateAuditLog]",
							"storedProcedureParameters": {
								"AuditID": {
									"value": {
										"value": "@activity('lkp_ExecStartAuditProc').output.firstRow.AuditID",
										"type": "Expression"
									},
									"type": "Int32"
								},
								"DataLakePath": {
									"value": null,
									"type": "String"
								},
								"PipelineRunID": {
									"value": {
										"value": "@pipeline().RunId",
										"type": "Expression"
									},
									"type": "String"
								},
								"RowsRead": {
									"value": null,
									"type": "Int64"
								},
								"Status": {
									"value": "Copy Pipeline Failed",
									"type": "String"
								}
							}
						},
						"linkedServiceName": {
							"referenceName": "AzureSqlDatabase1",
							"type": "LinkedServiceReference"
						}
					}
				],
				"policy": {
					"elapsedTimeMetric": {},
					"cancelAfter": {}
				},
				"variables": {
					"ErrorMsg": {
						"type": "String"
					}
				},
				"folder": {
					"name": "Briggs Data Load Theme wise"
				},
				"annotations": [],
				"lastPublishTime": "2022-04-26T11:15:41Z"
			},
			"dependsOn": [
				"[concat(variables('workspaceId'), '/pipelines/PL_Generic_Copy_AP')]",
				"[concat(variables('workspaceId'), '/datasets/Briggs_MDW')]",
				"[concat(variables('workspaceId'), '/linkedServices/AzureSqlDatabase1')]",
				"[concat(variables('workspaceId'), '/linkedServices/DS_MDW_SP')]"
			]
		},
		{
			"name": "[concat(parameters('workspaceName'), '/PL_Master_Briggs_AR')]",
			"type": "Microsoft.Synapse/workspaces/pipelines",
			"apiVersion": "2019-06-01-preview",
			"properties": {
				"activities": [
					{
						"name": "Execute Pipeline1",
						"type": "ExecutePipeline",
						"dependsOn": [
							{
								"activity": "lkp_ExecStartAuditProc",
								"dependencyConditions": [
									"Succeeded"
								]
							}
						],
						"userProperties": [],
						"typeProperties": {
							"pipeline": {
								"referenceName": "PL_Generic_Copy_AR",
								"type": "PipelineReference"
							},
							"waitOnCompletion": true,
							"parameters": {}
						}
					},
					{
						"name": "ReportStageProc",
						"type": "Lookup",
						"dependsOn": [
							{
								"activity": "Execute Pipeline1",
								"dependencyConditions": [
									"Succeeded"
								]
							},
							{
								"activity": "DefaultDimensionView",
								"dependencyConditions": [
									"Succeeded"
								]
							}
						],
						"policy": {
							"timeout": "7.00:00:00",
							"retry": 0,
							"retryIntervalInSeconds": 30,
							"secureOutput": false,
							"secureInput": false
						},
						"userProperties": [],
						"typeProperties": {
							"source": {
								"type": "AzureSqlSource",
								"sqlReaderQuery": "select  * from dbo.control_table where processsequence = 2 and enableaction = 1 and subjectarea='Report Stage AR SP'\norder by id",
								"queryTimeout": "02:00:00",
								"partitionOption": "None"
							},
							"dataset": {
								"referenceName": "Briggs_MDW",
								"type": "DatasetReference",
								"parameters": {
									"schema_name": "dbo",
									"table_name": "user"
								}
							},
							"firstRowOnly": false
						}
					},
					{
						"name": "ForEach_Stage",
						"type": "ForEach",
						"dependsOn": [
							{
								"activity": "ReportStageProc",
								"dependencyConditions": [
									"Succeeded"
								]
							}
						],
						"userProperties": [],
						"typeProperties": {
							"items": {
								"value": "@activity('ReportStageProc').output.value",
								"type": "Expression"
							},
							"activities": [
								{
									"name": "Stored procedure1",
									"type": "SqlServerStoredProcedure",
									"dependsOn": [
										{
											"activity": "Start_Table_Audit_Stage",
											"dependencyConditions": [
												"Succeeded"
											]
										}
									],
									"policy": {
										"timeout": "7.00:00:00",
										"retry": 0,
										"retryIntervalInSeconds": 30,
										"secureOutput": false,
										"secureInput": false
									},
									"userProperties": [],
									"typeProperties": {
										"storedProcedureName": {
											"value": "@item().sourcetablename",
											"type": "Expression"
										}
									},
									"linkedServiceName": {
										"referenceName": "DS_MDW_SP",
										"type": "LinkedServiceReference"
									}
								},
								{
									"name": "Start_Table_Audit_Stage",
									"type": "Lookup",
									"dependsOn": [],
									"policy": {
										"timeout": "7.00:00:00",
										"retry": 0,
										"retryIntervalInSeconds": 30,
										"secureOutput": false,
										"secureInput": false
									},
									"userProperties": [],
									"typeProperties": {
										"source": {
											"type": "AzureSqlSource",
											"sqlReaderStoredProcedureName": "[dbo].[proc_StartAuditLog_Briggs]",
											"storedProcedureParameters": {
												"ConfigTableID": {
													"type": "Int32",
													"value": {
														"value": "@item().ID",
														"type": "Expression"
													}
												},
												"DataFactoryName": {
													"type": "String",
													"value": {
														"value": "@pipeline().DataFactory",
														"type": "Expression"
													}
												},
												"ParentAuditID": {
													"type": "Int64",
													"value": {
														"value": "@item().ID",
														"type": "Expression"
													}
												},
												"PipelineName": {
													"type": "String",
													"value": {
														"value": "@pipeline().Pipeline",
														"type": "Expression"
													}
												},
												"PipelineRunID": {
													"type": "String",
													"value": {
														"value": "@pipeline().RunId",
														"type": "Expression"
													}
												},
												"PipelineTriggerID": {
													"type": "String",
													"value": {
														"value": "@pipeline().TriggerId",
														"type": "Expression"
													}
												},
												"PipelineTriggerName": {
													"type": "String",
													"value": {
														"value": "@pipeline().TriggerName",
														"type": "Expression"
													}
												},
												"PipelineTriggerType": {
													"type": "String",
													"value": {
														"value": "@pipeline().TriggerType",
														"type": "Expression"
													}
												},
												"Sourcedb": {
													"type": "String",
													"value": {
														"value": "@item().sourceDB",
														"type": "Expression"
													}
												},
												"sourcetable": {
													"type": "String",
													"value": {
														"value": "@item().SourcetableName",
														"type": "Expression"
													}
												}
											},
											"queryTimeout": "02:00:00",
											"partitionOption": "None"
										},
										"dataset": {
											"referenceName": "Briggs_MDW",
											"type": "DatasetReference",
											"parameters": {
												"schema_name": "dbo",
												"table_name": "user"
											}
										},
										"firstRowOnly": false
									}
								},
								{
									"name": "Success_Audit_Log_Stage",
									"type": "SqlServerStoredProcedure",
									"dependsOn": [
										{
											"activity": "Stored procedure1",
											"dependencyConditions": [
												"Succeeded"
											]
										}
									],
									"policy": {
										"timeout": "7.00:00:00",
										"retry": 0,
										"retryIntervalInSeconds": 30,
										"secureOutput": false,
										"secureInput": false
									},
									"userProperties": [],
									"typeProperties": {
										"storedProcedureName": "[dbo].[proc_UpdateAuditLog_Briggs]",
										"storedProcedureParameters": {
											"ConfigTableID": {
												"value": {
													"value": "@item().ID",
													"type": "Expression"
												},
												"type": "Int32"
											},
											"RowsRead": {
												"value": null,
												"type": "Int64"
											},
											"Status": {
												"value": "Success",
												"type": "String"
											}
										}
									},
									"linkedServiceName": {
										"referenceName": "DS_MDW_SP",
										"type": "LinkedServiceReference"
									}
								},
								{
									"name": "Set variable_Stage",
									"type": "SetVariable",
									"dependsOn": [
										{
											"activity": "Stored procedure1",
											"dependencyConditions": [
												"Failed"
											]
										}
									],
									"userProperties": [],
									"typeProperties": {
										"variableName": "ErrorMsg",
										"value": {
											"value": "@activity('Stored procedure1').Error.Message",
											"type": "Expression"
										}
									}
								},
								{
									"name": "Failure_Audit_Log_Stage",
									"type": "SqlServerStoredProcedure",
									"dependsOn": [
										{
											"activity": "Set variable_Stage",
											"dependencyConditions": [
												"Succeeded"
											]
										}
									],
									"policy": {
										"timeout": "7.00:00:00",
										"retry": 0,
										"retryIntervalInSeconds": 30,
										"secureOutput": false,
										"secureInput": false
									},
									"userProperties": [],
									"typeProperties": {
										"storedProcedureName": "[dbo].[proc_UpdateAuditLog_Briggs]",
										"storedProcedureParameters": {
											"ConfigTableID": {
												"value": {
													"value": "@item().ID",
													"type": "Expression"
												},
												"type": "Int32"
											},
											"RowsRead": {
												"value": null,
												"type": "Int64"
											},
											"Status": {
												"value": {
													"value": "@variables('ErrorMsg')",
													"type": "Expression"
												},
												"type": "String"
											}
										}
									},
									"linkedServiceName": {
										"referenceName": "DS_MDW_SP",
										"type": "LinkedServiceReference"
									}
								}
							]
						}
					},
					{
						"name": "ReportFactProc",
						"type": "Lookup",
						"dependsOn": [
							{
								"activity": "ForEach_Stage",
								"dependencyConditions": [
									"Succeeded"
								]
							},
							{
								"activity": "Stage_AR_Invoices_Cash_Account_Pivot",
								"dependencyConditions": [
									"Succeeded"
								]
							},
							{
								"activity": "Stage_AR_Unapplied_Cash",
								"dependencyConditions": [
									"Succeeded"
								]
							}
						],
						"policy": {
							"timeout": "7.00:00:00",
							"retry": 0,
							"retryIntervalInSeconds": 30,
							"secureOutput": false,
							"secureInput": false
						},
						"userProperties": [],
						"typeProperties": {
							"source": {
								"type": "AzureSqlSource",
								"sqlReaderQuery": "select  * from dbo.control_table where processsequence = 4\nand enableaction = 1 and subjectarea='Report Fact AR SP' and id<>455\norder by id",
								"queryTimeout": "02:00:00",
								"partitionOption": "None"
							},
							"dataset": {
								"referenceName": "Briggs_MDW",
								"type": "DatasetReference",
								"parameters": {
									"schema_name": "dbo",
									"table_name": "user"
								}
							},
							"firstRowOnly": false
						}
					},
					{
						"name": "ForEach_Fact",
						"type": "ForEach",
						"dependsOn": [
							{
								"activity": "ReportFactProc",
								"dependencyConditions": [
									"Succeeded"
								]
							}
						],
						"userProperties": [],
						"typeProperties": {
							"items": {
								"value": "@activity('ReportFactProc').output.value",
								"type": "Expression"
							},
							"activities": [
								{
									"name": "Stored procedure",
									"type": "SqlServerStoredProcedure",
									"dependsOn": [
										{
											"activity": "Start_Table_Audit1_Fact",
											"dependencyConditions": [
												"Succeeded"
											]
										}
									],
									"policy": {
										"timeout": "7.00:00:00",
										"retry": 0,
										"retryIntervalInSeconds": 30,
										"secureOutput": false,
										"secureInput": false
									},
									"userProperties": [],
									"typeProperties": {
										"storedProcedureName": {
											"value": "@item().sourcetablename",
											"type": "Expression"
										}
									},
									"linkedServiceName": {
										"referenceName": "DS_MDW_SP",
										"type": "LinkedServiceReference"
									}
								},
								{
									"name": "Start_Table_Audit1_Fact",
									"type": "Lookup",
									"dependsOn": [],
									"policy": {
										"timeout": "7.00:00:00",
										"retry": 0,
										"retryIntervalInSeconds": 30,
										"secureOutput": false,
										"secureInput": false
									},
									"userProperties": [],
									"typeProperties": {
										"source": {
											"type": "AzureSqlSource",
											"sqlReaderStoredProcedureName": "[dbo].[proc_StartAuditLog_Briggs]",
											"storedProcedureParameters": {
												"ConfigTableID": {
													"type": "Int32",
													"value": {
														"value": "@item().ID",
														"type": "Expression"
													}
												},
												"DataFactoryName": {
													"type": "String",
													"value": {
														"value": "@pipeline().DataFactory",
														"type": "Expression"
													}
												},
												"ParentAuditID": {
													"type": "Int64",
													"value": {
														"value": "@item().ID",
														"type": "Expression"
													}
												},
												"PipelineName": {
													"type": "String",
													"value": {
														"value": "@pipeline().Pipeline",
														"type": "Expression"
													}
												},
												"PipelineRunID": {
													"type": "String",
													"value": {
														"value": "@pipeline().RunId",
														"type": "Expression"
													}
												},
												"PipelineTriggerID": {
													"type": "String",
													"value": {
														"value": "@pipeline().TriggerId",
														"type": "Expression"
													}
												},
												"PipelineTriggerName": {
													"type": "String",
													"value": {
														"value": "@pipeline().TriggerName",
														"type": "Expression"
													}
												},
												"PipelineTriggerType": {
													"type": "String",
													"value": {
														"value": "@pipeline().TriggerType",
														"type": "Expression"
													}
												},
												"Sourcedb": {
													"type": "String",
													"value": {
														"value": "@item().sourceDB",
														"type": "Expression"
													}
												},
												"sourcetable": {
													"type": "String",
													"value": {
														"value": "@item().SourcetableName",
														"type": "Expression"
													}
												}
											},
											"queryTimeout": "02:00:00",
											"partitionOption": "None"
										},
										"dataset": {
											"referenceName": "Briggs_MDW",
											"type": "DatasetReference",
											"parameters": {
												"schema_name": "dbo",
												"table_name": "user"
											}
										},
										"firstRowOnly": false
									}
								},
								{
									"name": "Success_Audit_Log2_Fact",
									"type": "SqlServerStoredProcedure",
									"dependsOn": [
										{
											"activity": "Stored procedure",
											"dependencyConditions": [
												"Succeeded"
											]
										}
									],
									"policy": {
										"timeout": "7.00:00:00",
										"retry": 0,
										"retryIntervalInSeconds": 30,
										"secureOutput": false,
										"secureInput": false
									},
									"userProperties": [],
									"typeProperties": {
										"storedProcedureName": "[dbo].[proc_UpdateAuditLog_Briggs]",
										"storedProcedureParameters": {
											"ConfigTableID": {
												"value": {
													"value": "@item().ID",
													"type": "Expression"
												},
												"type": "Int32"
											},
											"RowsRead": {
												"value": null,
												"type": "Int64"
											},
											"Status": {
												"value": "Success",
												"type": "String"
											}
										}
									},
									"linkedServiceName": {
										"referenceName": "DS_MDW_SP",
										"type": "LinkedServiceReference"
									}
								},
								{
									"name": "Set variable1_Fact",
									"type": "SetVariable",
									"dependsOn": [
										{
											"activity": "Stored procedure",
											"dependencyConditions": [
												"Failed"
											]
										}
									],
									"userProperties": [],
									"typeProperties": {
										"variableName": "ErrorMsg",
										"value": {
											"value": "@activity('ReportStageProc').Error.Message",
											"type": "Expression"
										}
									}
								},
								{
									"name": "Failure_Audit_Log_Fact",
									"type": "SqlServerStoredProcedure",
									"dependsOn": [
										{
											"activity": "Set variable1_Fact",
											"dependencyConditions": [
												"Succeeded"
											]
										}
									],
									"policy": {
										"timeout": "7.00:00:00",
										"retry": 0,
										"retryIntervalInSeconds": 30,
										"secureOutput": false,
										"secureInput": false
									},
									"userProperties": [],
									"typeProperties": {
										"storedProcedureName": "[dbo].[proc_UpdateAuditLog_Briggs]",
										"storedProcedureParameters": {
											"ConfigTableID": {
												"value": {
													"value": "@item().ID",
													"type": "Expression"
												},
												"type": "Int32"
											},
											"RowsRead": {
												"value": null,
												"type": "Int64"
											},
											"Status": {
												"value": {
													"value": "@variables('ErrorMsg')",
													"type": "Expression"
												},
												"type": "String"
											}
										}
									},
									"linkedServiceName": {
										"referenceName": "DS_MDW_SP",
										"type": "LinkedServiceReference"
									}
								}
							]
						}
					},
					{
						"name": "Stage_AR_Invoices_Cash_Account_Pivot",
						"type": "Copy",
						"dependsOn": [],
						"policy": {
							"timeout": "7.00:00:00",
							"retry": 0,
							"retryIntervalInSeconds": 30,
							"secureOutput": false,
							"secureInput": false
						},
						"userProperties": [],
						"typeProperties": {
							"source": {
								"type": "SqlServerSource",
								"sqlReaderQuery": "with cte(accountnum,age)\nas(\n\tselect accountnum,datediff(day,max(cs.transdate),getdate())\n\tfrom custsettlement cs \n\twhere cs.offsettransvoucher like 'ARPAY%'\n\tgroup by accountnum\n), salespeople_cte (name,branch,[type],[plan],recid,workerid,territory,salesplan,division)\nas\n(\n\tselect \n\t\tdir.name,\n\t\tleft(csp.pars,3) as 'branch',\n\t\tcspt.description 'type', \n\t\tcase \n\t\t\twhen \tcspt.salespersontype in (7,8,9) then 'A'\n\t\t\twhen \tcspt.SALESPERSONTYPE in (1,2,3) then 'B'\n\t\t\telse 'C'\n\t\tend as 'plan',\n\t\tcsp.recid,\n\t\twrker.personnelnumber,\n\t\tcsp.salesmancode,\n\t\tcspt.salespersontype,\n\t\tright(csp.pars,2) 'division'\n\tfrom  xap_crmsalesperson csp\n\t\tinner join xap_crmsalespersontype cspt on csp.salespersontype = cspt.recid\n\t\tinner join hcmworker wrker on csp.worker = wrker.recid\n\t\tinner join dirpartytable dir on wrker.person = dir.recid\n)\n\nselect  isnull(ccg.description,'NO REP') 'rep',\n\t\tisnull(substring(ccg.description,charindex('-',ccg.description)+1,len(ccg.description)),'NO REP') 'collector',\n\t\tct.accountnum account_num,\n\t\tcus.custgroup cust_group,\n\t\tisnull(cij.orderaccount,pij.orderaccount) 'ship_to',\n\t\t[dbo].[enum2str]('custvenddisputestatus',cd.status) 'reason_code',\n\t\trt.reason,\n\t\trt.reasoncomment reason_comment,\n\t\tdir.name dir_name,\n\t\tcase\n\t\t\twhen ct.invoice = '' then ct.paymreference\n\t\t\telse ct.invoice\n\t\tend 'invoice#',\n\t\tct.custponbr 'po_number',\n\t\tcase\n\t\t\twhen pij.svcinventlocationid is not null then pij.svcinventlocationid\n\t\t\twhen cij.inventlocationid is not null then cij.inventlocationid\n\t\tend 'warehouse',\n\t\tcase\n\t\t\twhen ddv.displayvalue <> '' then ddv.displayvalue \n\t\t\twhen ddv.displayvalue is null and ct.invoice like '[0-9][0-9][a-z][0-9][0-9][0-9][0-9][0-9][0-9][0-9]' then '1'+ substring(ct.invoice,1,2)\n\t\t\twhen ddv.displayvalue is null and ct.invoice like 'INV%' then 'Invoices w.o. warehouse'\n\t\t\telse 'Unapplied/Misc'\n\t\tend 'warehouse2',\n\t\tcase\n\t\t\twhen ct.transdate = '2014-06-29 00:00:00.000' then ct.documentdate\n\t\t\telse ct.transdate\n\t\tend 'trans_date',\n\t\tct.duedate,\n\t\tdatediff(day,ct.duedate,getdate()) 'age',\n\t\tcase\n\t\t\twhen cij.orderclass <> 0 then  occij.orderclassid\n\t\t\twhen pij.orderclassid <> 0 then ocpij.orderclassid\n\t\t\twhen ct.invoice like '[0-9][0-9][a-z][0-9][0-9][0-9][0-9][0-9][0-9][0-9]' then case\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\twhen substring(ct.invoice,3,1) = 'E' then 'RENTAL'\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\twhen substring(ct.invoice,3,1) = 'R' then 'RENTAL'\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\twhen substring(ct.invoice,3,1) = 'S' then 'SERVICE'\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\twhen substring(ct.invoice,3,1) = 'P' then 'PARTS'\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t   End\n\t\tEND 'type',\n\t\tcast(ct.amountcur as decimal(10,2)) 'amount',\n\t\tcast((ct.amountcur-settleamountcur) as decimal(10,2)) 'balance',\n\t\tcast(case\n\t\t\twhen datediff(day,ct.duedate,getdate()) < 1 then \tcast((ct.amountcur-settleamountcur) as decimal(10,2))\n\t\t\telse 0.00\n\t\tend as decimal(10,2)) 'current',\n\t\tcast(case\n\t\t\twhen datediff(day,ct.duedate,getdate()) between 1 and 30 then \tcast((ct.amountcur-settleamountcur) as decimal(10,2))\n\t\t\telse 0.00\n\t\tend as decimal(10,2)) '1-30',\n\t\tcast(case\n\t\t\twhen datediff(day,ct.duedate,getdate()) between 31 and 60 then \tcast((ct.amountcur-settleamountcur) as decimal(10,2))\n\t\t\telse 0.00\n\t\tend as decimal(10,2)) '31-60',\n\t\tcast(case\n\t\t\twhen datediff(day,ct.duedate,getdate()) between 61 and 90 then \tcast((ct.amountcur-settleamountcur) as decimal(10,2))\n\t\t\telse 0.00\n\t\tend as decimal(10,2)) '61-90',\n\t\tcast(case\n\t\t\twhen datediff(day,ct.duedate,getdate()) between 91 and 150 then \tcast((ct.amountcur-settleamountcur) as decimal(10,2))\n\t\t\telse 0.00\n\t\tend as decimal(10,2)) '91-150',\n\t\tcast(case\n\t\t\twhen datediff(day,ct.duedate,getdate()) >150 then  cast((ct.amountcur-settleamountcur) as decimal(10,2))\n\t\t\telse 0.00\n\t\tend as decimal(10,2)) '150+'\n\t\t,cte.age 'last_pay_age'\n\t\t,svc.svccallid svc_call_id\n\t\t,ct.createdby 'full_name'\n\t\t,case when cij.invoicedate is not null then cij.invoicedate else pij.invoicedate end 'invoicedate'\n\t\t,sp.name\nfrom custtrans ct\nleft join custtable cus on ct.accountnum = cus.accountnum\nleft join dirpartytable dir on dir.recid = cus.party\nleft join xap_creditcustomergroups ccg on ccg.recid= cus.creditcustomergroups\nleft join projinvoicejour pij on pij.projinvoiceid = ct.invoice and pij.ledgervoucher = ct.voucher\nleft join xap_svccalltable svc on pij.svccallid = svc.recid\nleft join custinvoicejour cij on cij.invoiceid = ct.invoice and cij.ledgervoucher = ct.voucher and cij.invoiceid <> 'DEDUCTION'\nleft join xap_orderclass occij on occij.recid = cij.orderclass \nleft join xap_orderclass ocpij on ocpij.recid = pij.orderclassid \nleft join salestable cijst on cijst.salesid = cij.salesid\nleft join salespeople_cte sp on sp.recid = cijst.salesperson1\nleft join cte on cte.accountnum = ct.accountnum\nleft join custdispute cd on cd.custtrans = ct.recid\nleft join reasontableref rt on rt.recid = cd.reasontableref\nleft join briggs_mst.dbo.inventlocation il on il.inventlocationid = case\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\twhen pij.svcinventlocationid is not null then pij.svcinventlocationid\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\twhen cij.inventlocationid is not null then cij.inventlocationid\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tend\nleft join briggs_mst.dbo.defaultdimensionview ddv on il.defaultdimension = ddv.defaultdimension\n--left join cte2 eqa on eqa.username = ct.createdby\nwhere cus.custgroup not in ('INTERDEPT','WARRANTY')\nand ct.closed = '1900-01-01 00:00:00.000'\nand dir.name like '%cash%'\n--and ct.invoice = 'inv0510965'\nand isnull(substring(ccg.description,charindex('-',ccg.description)+1,len(ccg.description)),'NO REP') not in ('CIB Collection Agency','Attorney','bankruptcy')",
								"queryTimeout": "02:00:00",
								"partitionOption": "None"
							},
							"sink": {
								"type": "AzureSqlSink",
								"preCopyScript": "truncate table briggs.Stage_AR_Invoices_Cash_Account_Pivot",
								"disableMetricsCollection": false
							},
							"enableStaging": false,
							"translator": {
								"type": "TabularTranslator",
								"mappings": [
									{
										"source": {
											"name": "rep",
											"type": "String",
											"physicalType": "nvarchar"
										},
										"sink": {
											"name": "rep",
											"type": "String",
											"physicalType": "String"
										}
									},
									{
										"source": {
											"name": "collector",
											"type": "String",
											"physicalType": "nvarchar"
										},
										"sink": {
											"name": "collector",
											"type": "String",
											"physicalType": "String"
										}
									},
									{
										"source": {
											"name": "account_num",
											"type": "String",
											"physicalType": "nvarchar"
										},
										"sink": {
											"name": "account_num",
											"type": "String",
											"physicalType": "String"
										}
									},
									{
										"source": {
											"name": "cust_group",
											"type": "String",
											"physicalType": "nvarchar"
										},
										"sink": {
											"name": "cust_group",
											"type": "String",
											"physicalType": "String"
										}
									},
									{
										"source": {
											"name": "ship_to",
											"type": "String",
											"physicalType": "nvarchar"
										},
										"sink": {
											"name": "ship_to",
											"type": "String",
											"physicalType": "String"
										}
									},
									{
										"source": {
											"name": "reason_code",
											"type": "String",
											"physicalType": "varchar"
										},
										"sink": {
											"name": "reason_code",
											"type": "String",
											"physicalType": "String"
										}
									},
									{
										"source": {
											"name": "reason",
											"type": "String",
											"physicalType": "nvarchar"
										},
										"sink": {
											"name": "reason",
											"type": "String",
											"physicalType": "String"
										}
									},
									{
										"source": {
											"name": "reason_comment",
											"type": "String",
											"physicalType": "nvarchar"
										},
										"sink": {
											"name": "reason_comment",
											"type": "String",
											"physicalType": "String"
										}
									},
									{
										"source": {
											"name": "dir_name",
											"type": "String",
											"physicalType": "nvarchar"
										},
										"sink": {
											"name": "dir_name",
											"type": "String",
											"physicalType": "String"
										}
									},
									{
										"source": {
											"name": "invoice#",
											"type": "String",
											"physicalType": "nvarchar"
										},
										"sink": {
											"name": "invoice#",
											"type": "String",
											"physicalType": "String"
										}
									},
									{
										"source": {
											"name": "po_number",
											"type": "String",
											"physicalType": "nvarchar"
										},
										"sink": {
											"name": "po_number",
											"type": "String",
											"physicalType": "String"
										}
									},
									{
										"source": {
											"name": "warehouse",
											"type": "String",
											"physicalType": "nvarchar"
										},
										"sink": {
											"name": "warehouse",
											"type": "String",
											"physicalType": "String"
										}
									},
									{
										"source": {
											"name": "warehouse2",
											"type": "String",
											"physicalType": "nvarchar"
										},
										"sink": {
											"name": "warehouse2",
											"type": "String",
											"physicalType": "String"
										}
									},
									{
										"source": {
											"name": "trans_date",
											"type": "DateTime",
											"physicalType": "datetime"
										},
										"sink": {
											"name": "trans_date",
											"type": "DateTime",
											"physicalType": "DateTime"
										}
									},
									{
										"source": {
											"name": "duedate",
											"type": "DateTime",
											"physicalType": "datetime"
										},
										"sink": {
											"name": "duedate",
											"type": "DateTime",
											"physicalType": "DateTime"
										}
									},
									{
										"source": {
											"name": "age",
											"type": "Int32",
											"physicalType": "int"
										},
										"sink": {
											"name": "age",
											"type": "Int32",
											"physicalType": "Int32"
										}
									},
									{
										"source": {
											"name": "type",
											"type": "String",
											"physicalType": "nvarchar"
										},
										"sink": {
											"name": "type",
											"type": "String",
											"physicalType": "String"
										}
									},
									{
										"source": {
											"name": "amount",
											"type": "Decimal",
											"physicalType": "decimal",
											"scale": 2,
											"precision": 10
										},
										"sink": {
											"name": "amount",
											"type": "Decimal",
											"physicalType": "Decimal"
										}
									},
									{
										"source": {
											"name": "balance",
											"type": "Decimal",
											"physicalType": "decimal",
											"scale": 2,
											"precision": 10
										},
										"sink": {
											"name": "balance",
											"type": "Decimal",
											"physicalType": "Decimal"
										}
									},
									{
										"source": {
											"name": "current",
											"type": "Decimal",
											"physicalType": "decimal",
											"scale": 2,
											"precision": 10
										},
										"sink": {
											"name": "current",
											"type": "Decimal",
											"physicalType": "Decimal"
										}
									},
									{
										"source": {
											"name": "1-30",
											"type": "Decimal",
											"physicalType": "decimal",
											"scale": 2,
											"precision": 10
										},
										"sink": {
											"name": "1-30",
											"type": "Decimal",
											"physicalType": "Decimal"
										}
									},
									{
										"source": {
											"name": "31-60",
											"type": "Decimal",
											"physicalType": "decimal",
											"scale": 2,
											"precision": 10
										},
										"sink": {
											"name": "31-60",
											"type": "Decimal",
											"physicalType": "Decimal"
										}
									},
									{
										"source": {
											"name": "61-90",
											"type": "Decimal",
											"physicalType": "decimal",
											"scale": 2,
											"precision": 10
										},
										"sink": {
											"name": "61-90",
											"type": "Decimal",
											"physicalType": "Decimal"
										}
									},
									{
										"source": {
											"name": "91-150",
											"type": "Decimal",
											"physicalType": "decimal",
											"scale": 2,
											"precision": 10
										},
										"sink": {
											"name": "91-150",
											"type": "Decimal",
											"physicalType": "Decimal"
										}
									},
									{
										"source": {
											"name": "150+",
											"type": "Decimal",
											"physicalType": "decimal",
											"scale": 2,
											"precision": 10
										},
										"sink": {
											"name": "150+",
											"type": "Decimal",
											"physicalType": "Decimal"
										}
									},
									{
										"source": {
											"name": "last_pay_age",
											"type": "Int32",
											"physicalType": "int"
										},
										"sink": {
											"name": "last_pay_age",
											"type": "Int32",
											"physicalType": "Int32"
										}
									},
									{
										"source": {
											"name": "svc_call_id",
											"type": "String",
											"physicalType": "nvarchar"
										},
										"sink": {
											"name": "svc_call_id",
											"type": "String",
											"physicalType": "String"
										}
									},
									{
										"source": {
											"name": "full_name",
											"type": "String",
											"physicalType": "nvarchar"
										},
										"sink": {
											"name": "full_name",
											"type": "String",
											"physicalType": "String"
										}
									},
									{
										"source": {
											"name": "invoicedate",
											"type": "DateTime",
											"physicalType": "datetime"
										},
										"sink": {
											"name": "invoicedate",
											"type": "DateTime",
											"physicalType": "DateTime"
										}
									},
									{
										"source": {
											"name": "name",
											"type": "String",
											"physicalType": "nvarchar"
										},
										"sink": {
											"name": "name",
											"type": "String",
											"physicalType": "String"
										}
									}
								],
								"typeConversion": true,
								"typeConversionSettings": {
									"allowDataTruncation": true,
									"treatBooleanAsNumber": false
								}
							}
						},
						"inputs": [
							{
								"referenceName": "Briggs_MST",
								"type": "DatasetReference",
								"parameters": {}
							}
						],
						"outputs": [
							{
								"referenceName": "Briggs_MDW",
								"type": "DatasetReference",
								"parameters": {
									"schema_name": "Briggs",
									"table_name": "Stage_AR_Invoices_Cash_Account_Pivot"
								}
							}
						]
					},
					{
						"name": "DefaultDimensionView",
						"type": "Copy",
						"dependsOn": [],
						"policy": {
							"timeout": "7.00:00:00",
							"retry": 0,
							"retryIntervalInSeconds": 30,
							"secureOutput": false,
							"secureInput": false
						},
						"userProperties": [],
						"typeProperties": {
							"source": {
								"type": "SqlServerSource",
								"sqlReaderQuery": "select * from briggs_mst.dbo.DEFAULTDIMENSIONVIEW where DIMENSIONATTRIBUTEID = '5637145333'",
								"queryTimeout": "02:00:00",
								"partitionOption": "None"
							},
							"sink": {
								"type": "AzureSqlSink",
								"preCopyScript": "truncate table bstage.DefaultDimensionView",
								"disableMetricsCollection": false
							},
							"enableStaging": false,
							"translator": {
								"type": "TabularTranslator",
								"mappings": [
									{
										"source": {
											"name": "DISPLAYVALUE",
											"type": "String",
											"physicalType": "nvarchar"
										},
										"sink": {
											"name": "DISPLAYVALUE",
											"type": "String",
											"physicalType": "nvarchar"
										}
									},
									{
										"source": {
											"name": "DEFAULTDIMENSION",
											"type": "Int64",
											"physicalType": "bigint"
										},
										"sink": {
											"name": "DEFAULTDIMENSION",
											"type": "Int64",
											"physicalType": "bigint"
										}
									},
									{
										"source": {
											"name": "PARTITION",
											"type": "Int64",
											"physicalType": "bigint"
										},
										"sink": {
											"name": "PARTITION",
											"type": "Int64",
											"physicalType": "bigint"
										}
									},
									{
										"source": {
											"name": "RECID",
											"type": "Int64",
											"physicalType": "bigint"
										},
										"sink": {
											"name": "RECID",
											"type": "Int64",
											"physicalType": "bigint"
										}
									},
									{
										"source": {
											"name": "PARTITION#2",
											"type": "Int64",
											"physicalType": "bigint"
										},
										"sink": {
											"name": "PARTITION#2",
											"type": "Int64",
											"physicalType": "bigint"
										}
									},
									{
										"source": {
											"name": "ENTITYINSTANCE",
											"type": "Int64",
											"physicalType": "bigint"
										},
										"sink": {
											"name": "ENTITYINSTANCE",
											"type": "Int64",
											"physicalType": "bigint"
										}
									},
									{
										"source": {
											"name": "PARTITION#3",
											"type": "Int64",
											"physicalType": "bigint"
										},
										"sink": {
											"name": "PARTITION#3",
											"type": "Int64",
											"physicalType": "bigint"
										}
									},
									{
										"source": {
											"name": "REPORTCOLUMNNAME",
											"type": "String",
											"physicalType": "nvarchar"
										},
										"sink": {
											"name": "REPORTCOLUMNNAME",
											"type": "String",
											"physicalType": "nvarchar"
										}
									},
									{
										"source": {
											"name": "DIMENSIONATTRIBUTEID",
											"type": "Int64",
											"physicalType": "bigint"
										},
										"sink": {
											"name": "DIMENSIONATTRIBUTEID",
											"type": "Int64",
											"physicalType": "bigint"
										}
									},
									{
										"source": {
											"name": "BACKINGENTITYTYPE",
											"type": "Int32",
											"physicalType": "int"
										},
										"sink": {
											"name": "BACKINGENTITYTYPE",
											"type": "Int32",
											"physicalType": "int"
										}
									},
									{
										"source": {
											"name": "KEYATTRIBUTE",
											"type": "Int32",
											"physicalType": "int"
										},
										"sink": {
											"name": "KEYATTRIBUTE",
											"type": "Int32",
											"physicalType": "int"
										}
									},
									{
										"source": {
											"name": "NAMEATTRIBUTE",
											"type": "Int32",
											"physicalType": "int"
										},
										"sink": {
											"name": "NAMEATTRIBUTE",
											"type": "Int32",
											"physicalType": "int"
										}
									},
									{
										"source": {
											"name": "NAME",
											"type": "String",
											"physicalType": "nvarchar"
										},
										"sink": {
											"name": "NAME",
											"type": "String",
											"physicalType": "nvarchar"
										}
									}
								],
								"typeConversion": true,
								"typeConversionSettings": {
									"allowDataTruncation": true,
									"treatBooleanAsNumber": false
								}
							}
						},
						"inputs": [
							{
								"referenceName": "Briggs_MST",
								"type": "DatasetReference",
								"parameters": {}
							}
						],
						"outputs": [
							{
								"referenceName": "Briggs_MDW",
								"type": "DatasetReference",
								"parameters": {
									"schema_name": "bstage",
									"table_name": "DefaultDimensionView"
								}
							}
						]
					},
					{
						"name": "Stage_AR_Unapplied_Cash",
						"type": "Copy",
						"dependsOn": [],
						"policy": {
							"timeout": "7.00:00:00",
							"retry": 0,
							"retryIntervalInSeconds": 30,
							"secureOutput": false,
							"secureInput": false
						},
						"userProperties": [],
						"typeProperties": {
							"source": {
								"type": "SqlServerSource",
								"sqlReaderQuery": "with cte(accountnum,age)\nas(\n\tselect ACCOUNTNUM,datediff(day,max(cs.TRANSDATE),getdate())\n\tfrom custsettlement cs \n\twhere cs.OFFSETTRANSVOUCHER like 'ARPAY%'\n\tgroup by ACCOUNTNUM\n)\n\n\nselect   isnull(ccg.DESCRIPTION,'NO REP') 'Rep',\n\t\tct.ACCOUNTNUM,\n\t\tdir.NAME,\n\t\tCASE\n\t\t\twhen ct.INVOICE = '' then ct.PAYMREFERENCE\n\t\t\telse ct.INVOICE\n\t\tEND 'Invoice#',\n\t\tct.custponbr 'PO Number',\n\t\tCASE\n\t\t\twhen pij.SVCINVENTLOCATIONID is not null then pij.SVCINVENTLOCATIONID\n\t\t\twhen cij.inventlocationid is not null then cij.inventlocationid\n\t\tEND 'Warehouse',\n\t\tCASE\n\t\t\twhen ct.TRANSDATE = '2014-06-29 00:00:00.000' then ct.DOCUMENTDATE\n\t\t\telse ct.TRANSDATE\n\t\tEND 'TransDate',\n\t\tct.DUEDATE,\n\t\tdatediff(day,ct.duedate,getdate()) 'Age',\n\t\tCASE\n\t\t\twhen cij.ORDERCLASS is null then ocPIJ.ORDERCLASSID\n\t\t\twhen pij.ORDERCLASSID is null then ocCIJ.ORDERCLASSID\n\t\tEND 'Type',\n\t\tcast(ct.AMOUNTCUR as decimal(10,2)) 'Amount',\n\t\tcast((ct.AMOUNTCUR-SETTLEAMOUNTCUR) as decimal(10,2)) 'Balance',\n\t\tcast(CASE\n\t\t\twhen datediff(day,ct.duedate,getdate()) < 1 then \tcast((ct.AMOUNTCUR-SETTLEAMOUNTCUR) as decimal(10,2))\n\t\t\telse 0.00\n\t\tEND as decimal(10,2)) 'Current',\n\t\tcast(CASE\n\t\t\twhen datediff(day,ct.duedate,getdate()) between 1 and 30 then \tcast((ct.AMOUNTCUR-SETTLEAMOUNTCUR) as decimal(10,2))\n\t\t\telse 0.00\n\t\tEND as decimal(10,2)) '1-30',\n\t\tcast(CASE\n\t\t\twhen datediff(day,ct.duedate,getdate()) between 31 and 60 then \tcast((ct.AMOUNTCUR-SETTLEAMOUNTCUR) as decimal(10,2))\n\t\t\telse 0.00\n\t\tEND as decimal(10,2)) '31-60',\n\t\tcast(CASE\n\t\t\twhen datediff(day,ct.duedate,getdate()) between 61 and 90 then \tcast((ct.AMOUNTCUR-SETTLEAMOUNTCUR) as decimal(10,2))\n\t\t\telse 0.00\n\t\tEND as decimal(10,2)) '61-90',\n\t\tcast(CASE\n\t\t\twhen datediff(day,ct.duedate,getdate()) between 91 and 150 then \tcast((ct.AMOUNTCUR-SETTLEAMOUNTCUR) as decimal(10,2))\n\t\t\telse 0.00\n\t\tEND as decimal(10,2)) '91-150',\n\t\tcast(CASE\n\t\t\twhen datediff(day,ct.duedate,getdate()) >150 then  cast((ct.AMOUNTCUR-SETTLEAMOUNTCUR) as decimal(10,2))\n\t\t\telse 0.00\n\t\tEND as decimal(10,2)) '150+'\n\t\t,cte.age 'Last Pay Age'\n\t\t,ct.TXT\n\t\t, cast(InvNotes as nvarchar(4000)) InvNotes\nfrom CUSTTRANS ct\nleft join CUSTTABLE cus on ct.ACCOUNTNUM = cus.ACCOUNTNUM\nleft join DIRPARTYTABLE dir on dir.RECID = cus.PARTY\nleft join XAP_CREDITCUSTOMERGROUPS ccg on ccg.RECID= cus.CREDITCUSTOMERGROUPS\nleft join PROJINVOICEJOUR pij on pij.PROJINVOICEID = ct.INVOICE and pij.LEDGERVOUCHER = ct.VOUCHER\nleft join CUSTINVOICEJOUR cij on cij.INVOICEID = ct.INVOICE and cij.LEDGERVOUCHER = ct.VOUCHER and cij.INVOICEID <> 'DEDUCTION'\nleft join XAP_ORDERCLASS ocCIJ on ocCIJ.RECID = cij.ORDERCLASS \nleft join XAP_ORDERCLASS ocPIJ on ocPIJ.RECID = pij.ORDERCLASSID \nleft join SALESTABLE cijST on cijST.SALESID = cij.SALESID\nleft join cte on cte.accountnum = ct.ACCOUNTNUM\nleft join [briggsax].dbo.cache_ArInvoices ar on ar.ACCOUNTNUM =  ct.accountnum and ar.TransDate = ct.TRANSDATE and ar.Amount = ct.AMOUNTCUR\nwhere ct.invoice = ''\nand ct.CLOSED = '1900-01-01 00:00:00.000'\nand ct.AMOUNTCUR  < 0",
								"queryTimeout": "02:00:00",
								"partitionOption": "None"
							},
							"sink": {
								"type": "AzureSqlSink",
								"preCopyScript": "truncate table briggs.Stage_AR_Unapplied_Cash",
								"disableMetricsCollection": false
							},
							"enableStaging": false,
							"translator": {
								"type": "TabularTranslator",
								"mappings": [
									{
										"source": {
											"name": "Rep",
											"type": "String",
											"physicalType": "nvarchar"
										},
										"sink": {
											"name": "Rep",
											"type": "String",
											"physicalType": "String"
										}
									},
									{
										"source": {
											"name": "ACCOUNTNUM",
											"type": "String",
											"physicalType": "nvarchar"
										},
										"sink": {
											"name": "ACCOUNTNUM",
											"type": "String",
											"physicalType": "String"
										}
									},
									{
										"source": {
											"name": "NAME",
											"type": "String",
											"physicalType": "nvarchar"
										},
										"sink": {
											"name": "NAME",
											"type": "String",
											"physicalType": "String"
										}
									},
									{
										"source": {
											"name": "Invoice#",
											"type": "String",
											"physicalType": "nvarchar"
										},
										"sink": {
											"name": "Invoice#",
											"type": "String",
											"physicalType": "String"
										}
									},
									{
										"source": {
											"name": "PO Number",
											"type": "String",
											"physicalType": "nvarchar"
										},
										"sink": {
											"name": "PO Number",
											"type": "String",
											"physicalType": "String"
										}
									},
									{
										"source": {
											"name": "Warehouse",
											"type": "String",
											"physicalType": "nvarchar"
										},
										"sink": {
											"name": "Warehouse",
											"type": "String",
											"physicalType": "String"
										}
									},
									{
										"source": {
											"name": "TransDate",
											"type": "DateTime",
											"physicalType": "datetime"
										},
										"sink": {
											"name": "TransDate",
											"type": "DateTime",
											"physicalType": "DateTime"
										}
									},
									{
										"source": {
											"name": "DUEDATE",
											"type": "DateTime",
											"physicalType": "datetime"
										},
										"sink": {
											"name": "DUEDATE",
											"type": "DateTime",
											"physicalType": "DateTime"
										}
									},
									{
										"source": {
											"name": "Age",
											"type": "Int32",
											"physicalType": "int"
										},
										"sink": {
											"name": "Age",
											"type": "Int32",
											"physicalType": "Int32"
										}
									},
									{
										"source": {
											"name": "Type",
											"type": "String",
											"physicalType": "nvarchar"
										},
										"sink": {
											"name": "Type",
											"type": "String",
											"physicalType": "String"
										}
									},
									{
										"source": {
											"name": "Amount",
											"type": "Decimal",
											"physicalType": "decimal",
											"scale": 2,
											"precision": 10
										},
										"sink": {
											"name": "Amount",
											"type": "Decimal",
											"physicalType": "Decimal"
										}
									},
									{
										"source": {
											"name": "Balance",
											"type": "Decimal",
											"physicalType": "decimal",
											"scale": 2,
											"precision": 10
										},
										"sink": {
											"name": "Balance",
											"type": "Decimal",
											"physicalType": "Decimal"
										}
									},
									{
										"source": {
											"name": "Current",
											"type": "Decimal",
											"physicalType": "decimal",
											"scale": 2,
											"precision": 10
										},
										"sink": {
											"name": "Current",
											"type": "Decimal",
											"physicalType": "Decimal"
										}
									},
									{
										"source": {
											"name": "1-30",
											"type": "Decimal",
											"physicalType": "decimal",
											"scale": 2,
											"precision": 10
										},
										"sink": {
											"name": "1-30",
											"type": "Decimal",
											"physicalType": "Decimal"
										}
									},
									{
										"source": {
											"name": "31-60",
											"type": "Decimal",
											"physicalType": "decimal",
											"scale": 2,
											"precision": 10
										},
										"sink": {
											"name": "31-60",
											"type": "Decimal",
											"physicalType": "Decimal"
										}
									},
									{
										"source": {
											"name": "61-90",
											"type": "Decimal",
											"physicalType": "decimal",
											"scale": 2,
											"precision": 10
										},
										"sink": {
											"name": "61-90",
											"type": "Decimal",
											"physicalType": "Decimal"
										}
									},
									{
										"source": {
											"name": "91-150",
											"type": "Decimal",
											"physicalType": "decimal",
											"scale": 2,
											"precision": 10
										},
										"sink": {
											"name": "91-150",
											"type": "Decimal",
											"physicalType": "Decimal"
										}
									},
									{
										"source": {
											"name": "150+",
											"type": "Decimal",
											"physicalType": "decimal",
											"scale": 2,
											"precision": 10
										},
										"sink": {
											"name": "150+",
											"type": "Decimal",
											"physicalType": "Decimal"
										}
									},
									{
										"source": {
											"name": "Last Pay Age",
											"type": "Int32",
											"physicalType": "int"
										},
										"sink": {
											"name": "Last Pay Age",
											"type": "Int32",
											"physicalType": "Int32"
										}
									},
									{
										"source": {
											"name": "TXT",
											"type": "String",
											"physicalType": "nvarchar"
										},
										"sink": {
											"name": "TXT",
											"type": "String",
											"physicalType": "String"
										}
									},
									{
										"source": {
											"name": "InvNotes",
											"type": "String",
											"physicalType": "nvarchar"
										},
										"sink": {
											"name": "InvNotes",
											"type": "String",
											"physicalType": "String"
										}
									}
								],
								"typeConversion": true,
								"typeConversionSettings": {
									"allowDataTruncation": true,
									"treatBooleanAsNumber": false
								}
							}
						},
						"inputs": [
							{
								"referenceName": "Briggs_MST",
								"type": "DatasetReference",
								"parameters": {}
							}
						],
						"outputs": [
							{
								"referenceName": "Briggs_MDW",
								"type": "DatasetReference",
								"parameters": {
									"schema_name": "Briggs",
									"table_name": "Stage_AR_Unapplied_Cash"
								}
							}
						]
					},
					{
						"name": "lkp_ExecStartAuditProc",
						"type": "Lookup",
						"dependsOn": [],
						"policy": {
							"timeout": "7.00:00:00",
							"retry": 0,
							"retryIntervalInSeconds": 30,
							"secureOutput": false,
							"secureInput": false
						},
						"userProperties": [],
						"typeProperties": {
							"source": {
								"type": "AzureSqlSource",
								"sqlReaderStoredProcedureName": "[dbo].[proc_StartAuditLog]",
								"storedProcedureParameters": {
									"ConfigTableID": {
										"type": "Int32",
										"value": "-1"
									},
									"DataFactoryName": {
										"type": "String",
										"value": {
											"value": "@pipeline().DataFactory",
											"type": "Expression"
										}
									},
									"ParentAuditID": {
										"type": "Int64",
										"value": "-1"
									},
									"PipelineName": {
										"type": "String",
										"value": {
											"value": "@pipeline().Pipeline",
											"type": "Expression"
										}
									},
									"PipelineRunID": {
										"type": "String",
										"value": {
											"value": "@pipeline().RunId",
											"type": "Expression"
										}
									},
									"PipelineTriggerID": {
										"type": "String",
										"value": {
											"value": "@pipeline().TriggerId",
											"type": "Expression"
										}
									},
									"PipelineTriggerName": {
										"type": "String",
										"value": {
											"value": "@pipeline().TriggerName",
											"type": "Expression"
										}
									},
									"PipelineTriggerType": {
										"type": "String",
										"value": {
											"value": "@pipeline().TriggerType",
											"type": "Expression"
										}
									}
								},
								"queryTimeout": "02:00:00",
								"partitionOption": "None"
							},
							"dataset": {
								"referenceName": "Briggs_MDW",
								"type": "DatasetReference",
								"parameters": {
									"schema_name": "dbo",
									"table_name": "user"
								}
							}
						}
					},
					{
						"name": "Sp_ExecFailureAudit_Fact",
						"type": "SqlServerStoredProcedure",
						"dependsOn": [
							{
								"activity": "ForEach_Fact",
								"dependencyConditions": [
									"Failed"
								]
							}
						],
						"policy": {
							"timeout": "7.00:00:00",
							"retry": 0,
							"retryIntervalInSeconds": 30,
							"secureOutput": false,
							"secureInput": false
						},
						"userProperties": [],
						"typeProperties": {
							"storedProcedureName": "[dbo].[proc_UpdateAuditLog]",
							"storedProcedureParameters": {
								"AuditID": {
									"value": {
										"value": "@activity('lkp_ExecStartAuditProc').output.firstRow.AuditID",
										"type": "Expression"
									},
									"type": "Int32"
								},
								"DataLakePath": {
									"value": null,
									"type": "String"
								},
								"PipelineRunID": {
									"value": {
										"value": "@pipeline().RunId",
										"type": "Expression"
									},
									"type": "String"
								},
								"RowsRead": {
									"value": null,
									"type": "Int64"
								},
								"Status": {
									"value": "Fact Proc Failed",
									"type": "String"
								}
							}
						},
						"linkedServiceName": {
							"referenceName": "AzureSqlDatabase1",
							"type": "LinkedServiceReference"
						}
					},
					{
						"name": "Sp_ExecSuccessAudit",
						"type": "SqlServerStoredProcedure",
						"dependsOn": [
							{
								"activity": "ForEach_Fact",
								"dependencyConditions": [
									"Succeeded"
								]
							}
						],
						"policy": {
							"timeout": "7.00:00:00",
							"retry": 0,
							"retryIntervalInSeconds": 30,
							"secureOutput": false,
							"secureInput": false
						},
						"userProperties": [],
						"typeProperties": {
							"storedProcedureName": "[dbo].[proc_UpdateAuditLog]",
							"storedProcedureParameters": {
								"AuditID": {
									"value": {
										"value": "@activity('lkp_ExecStartAuditProc').output.firstRow.AuditID",
										"type": "Expression"
									},
									"type": "Int32"
								},
								"DataLakePath": {
									"value": null,
									"type": "String"
								},
								"RowsRead": {
									"value": null,
									"type": "Int64"
								},
								"Status": {
									"value": "Success",
									"type": "String"
								},
								"PipelineRunID": {
									"value": {
										"value": "@pipeline().RunId",
										"type": "Expression"
									},
									"type": "String"
								}
							}
						},
						"linkedServiceName": {
							"referenceName": "AzureSqlDatabase1",
							"type": "LinkedServiceReference"
						}
					},
					{
						"name": "Sp_ExecFailureAudit_Stage",
						"type": "SqlServerStoredProcedure",
						"dependsOn": [
							{
								"activity": "ForEach_Stage",
								"dependencyConditions": [
									"Failed"
								]
							}
						],
						"policy": {
							"timeout": "7.00:00:00",
							"retry": 0,
							"retryIntervalInSeconds": 30,
							"secureOutput": false,
							"secureInput": false
						},
						"userProperties": [],
						"typeProperties": {
							"storedProcedureName": "[dbo].[proc_UpdateAuditLog]",
							"storedProcedureParameters": {
								"AuditID": {
									"value": {
										"value": "@activity('lkp_ExecStartAuditProc').output.firstRow.AuditID",
										"type": "Expression"
									},
									"type": "Int32"
								},
								"DataLakePath": {
									"value": null,
									"type": "String"
								},
								"PipelineRunID": {
									"value": {
										"value": "@pipeline().RunId",
										"type": "Expression"
									},
									"type": "String"
								},
								"RowsRead": {
									"value": null,
									"type": "Int64"
								},
								"Status": {
									"value": "Stage Proc Failed",
									"type": "String"
								}
							}
						},
						"linkedServiceName": {
							"referenceName": "AzureSqlDatabase1",
							"type": "LinkedServiceReference"
						}
					},
					{
						"name": "Sp_ExecFailureAudit_TL",
						"type": "SqlServerStoredProcedure",
						"dependsOn": [
							{
								"activity": "Execute Pipeline1",
								"dependencyConditions": [
									"Failed"
								]
							}
						],
						"policy": {
							"timeout": "7.00:00:00",
							"retry": 0,
							"retryIntervalInSeconds": 30,
							"secureOutput": false,
							"secureInput": false
						},
						"userProperties": [],
						"typeProperties": {
							"storedProcedureName": "[dbo].[proc_UpdateAuditLog]",
							"storedProcedureParameters": {
								"AuditID": {
									"value": {
										"value": "@activity('lkp_ExecStartAuditProc').output.firstRow.AuditID",
										"type": "Expression"
									},
									"type": "Int32"
								},
								"DataLakePath": {
									"value": null,
									"type": "String"
								},
								"PipelineRunID": {
									"value": {
										"value": "@pipeline().RunId",
										"type": "Expression"
									},
									"type": "String"
								},
								"RowsRead": {
									"value": null,
									"type": "Int64"
								},
								"Status": {
									"value": "Table Load Failed",
									"type": "String"
								}
							}
						},
						"linkedServiceName": {
							"referenceName": "AzureSqlDatabase1",
							"type": "LinkedServiceReference"
						}
					}
				],
				"policy": {
					"elapsedTimeMetric": {},
					"cancelAfter": {}
				},
				"variables": {
					"ErrorMsg": {
						"type": "String"
					}
				},
				"folder": {
					"name": "Briggs Data Load Theme wise"
				},
				"annotations": [],
				"lastPublishTime": "2022-04-26T12:26:47Z"
			},
			"dependsOn": [
				"[concat(variables('workspaceId'), '/pipelines/PL_Generic_Copy_AR')]",
				"[concat(variables('workspaceId'), '/datasets/Briggs_MDW')]",
				"[concat(variables('workspaceId'), '/datasets/Briggs_MST')]",
				"[concat(variables('workspaceId'), '/linkedServices/AzureSqlDatabase1')]",
				"[concat(variables('workspaceId'), '/linkedServices/DS_MDW_SP')]"
			]
		},
		{
			"name": "[concat(parameters('workspaceName'), '/PL_Master_Briggs_Billing')]",
			"type": "Microsoft.Synapse/workspaces/pipelines",
			"apiVersion": "2019-06-01-preview",
			"properties": {
				"activities": [
					{
						"name": "Execute Pipeline1",
						"type": "ExecutePipeline",
						"dependsOn": [
							{
								"activity": "lkp_ExecStartAuditProc",
								"dependencyConditions": [
									"Succeeded"
								]
							}
						],
						"userProperties": [],
						"typeProperties": {
							"pipeline": {
								"referenceName": "PL_Generic_Copy_Billing",
								"type": "PipelineReference"
							},
							"waitOnCompletion": true,
							"parameters": {}
						}
					},
					{
						"name": "ReportStageProc",
						"type": "Lookup",
						"dependsOn": [
							{
								"activity": "Execute Pipeline1",
								"dependencyConditions": [
									"Succeeded"
								]
							}
						],
						"policy": {
							"timeout": "7.00:00:00",
							"retry": 0,
							"retryIntervalInSeconds": 30,
							"secureOutput": false,
							"secureInput": false
						},
						"userProperties": [],
						"typeProperties": {
							"source": {
								"type": "AzureSqlSource",
								"sqlReaderQuery": "select  * from dbo.control_table where processsequence = 2 and enableaction = 1 \nand subjectarea='Report Stage Billing SP'\norder by id",
								"queryTimeout": "02:00:00",
								"partitionOption": "None"
							},
							"dataset": {
								"referenceName": "Briggs_MDW",
								"type": "DatasetReference",
								"parameters": {
									"schema_name": "dbo",
									"table_name": "user"
								}
							},
							"firstRowOnly": false
						}
					},
					{
						"name": "ForEach_Stage",
						"type": "ForEach",
						"dependsOn": [
							{
								"activity": "ReportStageProc",
								"dependencyConditions": [
									"Succeeded"
								]
							}
						],
						"userProperties": [],
						"typeProperties": {
							"items": {
								"value": "@activity('ReportStageProc').output.value",
								"type": "Expression"
							},
							"activities": [
								{
									"name": "Stored procedure1",
									"type": "SqlServerStoredProcedure",
									"dependsOn": [
										{
											"activity": "Start_Table_Audit_Stage",
											"dependencyConditions": [
												"Succeeded"
											]
										}
									],
									"policy": {
										"timeout": "7.00:00:00",
										"retry": 0,
										"retryIntervalInSeconds": 30,
										"secureOutput": false,
										"secureInput": false
									},
									"userProperties": [],
									"typeProperties": {
										"storedProcedureName": {
											"value": "@item().sourcetablename",
											"type": "Expression"
										}
									},
									"linkedServiceName": {
										"referenceName": "DS_MDW_SP",
										"type": "LinkedServiceReference"
									}
								},
								{
									"name": "Start_Table_Audit_Stage",
									"type": "Lookup",
									"dependsOn": [],
									"policy": {
										"timeout": "7.00:00:00",
										"retry": 0,
										"retryIntervalInSeconds": 30,
										"secureOutput": false,
										"secureInput": false
									},
									"userProperties": [],
									"typeProperties": {
										"source": {
											"type": "AzureSqlSource",
											"sqlReaderStoredProcedureName": "[dbo].[proc_StartAuditLog_Briggs]",
											"storedProcedureParameters": {
												"ConfigTableID": {
													"type": "Int32",
													"value": {
														"value": "@item().ID",
														"type": "Expression"
													}
												},
												"DataFactoryName": {
													"type": "String",
													"value": {
														"value": "@pipeline().DataFactory",
														"type": "Expression"
													}
												},
												"ParentAuditID": {
													"type": "Int64",
													"value": {
														"value": "@item().ID",
														"type": "Expression"
													}
												},
												"PipelineName": {
													"type": "String",
													"value": {
														"value": "@pipeline().Pipeline",
														"type": "Expression"
													}
												},
												"PipelineRunID": {
													"type": "String",
													"value": {
														"value": "@pipeline().RunId",
														"type": "Expression"
													}
												},
												"PipelineTriggerID": {
													"type": "String",
													"value": {
														"value": "@pipeline().TriggerId",
														"type": "Expression"
													}
												},
												"PipelineTriggerName": {
													"type": "String",
													"value": {
														"value": "@pipeline().TriggerName",
														"type": "Expression"
													}
												},
												"PipelineTriggerType": {
													"type": "String",
													"value": {
														"value": "@pipeline().TriggerType",
														"type": "Expression"
													}
												},
												"Sourcedb": {
													"type": "String",
													"value": {
														"value": "@item().sourceDB",
														"type": "Expression"
													}
												},
												"sourcetable": {
													"type": "String",
													"value": {
														"value": "@item().SourcetableName",
														"type": "Expression"
													}
												}
											},
											"queryTimeout": "02:00:00",
											"partitionOption": "None"
										},
										"dataset": {
											"referenceName": "Briggs_MDW",
											"type": "DatasetReference",
											"parameters": {
												"schema_name": "dbo",
												"table_name": "user"
											}
										},
										"firstRowOnly": false
									}
								},
								{
									"name": "Success_Audit_Log_Stage",
									"type": "SqlServerStoredProcedure",
									"dependsOn": [
										{
											"activity": "Stored procedure1",
											"dependencyConditions": [
												"Succeeded"
											]
										}
									],
									"policy": {
										"timeout": "7.00:00:00",
										"retry": 0,
										"retryIntervalInSeconds": 30,
										"secureOutput": false,
										"secureInput": false
									},
									"userProperties": [],
									"typeProperties": {
										"storedProcedureName": "[dbo].[proc_UpdateAuditLog_Briggs]",
										"storedProcedureParameters": {
											"ConfigTableID": {
												"value": {
													"value": "@item().ID",
													"type": "Expression"
												},
												"type": "Int32"
											},
											"RowsRead": {
												"value": null,
												"type": "Int64"
											},
											"Status": {
												"value": "Success",
												"type": "String"
											}
										}
									},
									"linkedServiceName": {
										"referenceName": "DS_MDW_SP",
										"type": "LinkedServiceReference"
									}
								},
								{
									"name": "Set variable_Stage",
									"type": "SetVariable",
									"dependsOn": [
										{
											"activity": "Stored procedure1",
											"dependencyConditions": [
												"Failed"
											]
										}
									],
									"userProperties": [],
									"typeProperties": {
										"variableName": "ErrorMsg",
										"value": {
											"value": "@activity('Stored procedure1').Error.Message",
											"type": "Expression"
										}
									}
								},
								{
									"name": "Failure_Audit_Log_Stage",
									"type": "SqlServerStoredProcedure",
									"dependsOn": [
										{
											"activity": "Set variable_Stage",
											"dependencyConditions": [
												"Succeeded"
											]
										}
									],
									"policy": {
										"timeout": "7.00:00:00",
										"retry": 0,
										"retryIntervalInSeconds": 30,
										"secureOutput": false,
										"secureInput": false
									},
									"userProperties": [],
									"typeProperties": {
										"storedProcedureName": "[dbo].[proc_UpdateAuditLog_Briggs]",
										"storedProcedureParameters": {
											"ConfigTableID": {
												"value": {
													"value": "@item().ID",
													"type": "Expression"
												},
												"type": "Int32"
											},
											"RowsRead": {
												"value": null,
												"type": "Int64"
											},
											"Status": {
												"value": {
													"value": "@variables('ErrorMsg')",
													"type": "Expression"
												},
												"type": "String"
											}
										}
									},
									"linkedServiceName": {
										"referenceName": "DS_MDW_SP",
										"type": "LinkedServiceReference"
									}
								}
							]
						}
					},
					{
						"name": "ReportFactProc",
						"type": "Lookup",
						"dependsOn": [
							{
								"activity": "ForEach_Stage",
								"dependencyConditions": [
									"Succeeded"
								]
							},
							{
								"activity": "Stage_SSG_Billing",
								"dependencyConditions": [
									"Succeeded"
								]
							}
						],
						"policy": {
							"timeout": "7.00:00:00",
							"retry": 0,
							"retryIntervalInSeconds": 30,
							"secureOutput": false,
							"secureInput": false
						},
						"userProperties": [],
						"typeProperties": {
							"source": {
								"type": "AzureSqlSource",
								"sqlReaderQuery": "select  * from dbo.control_table where processsequence = 4 and enableaction = 1 \nand subjectarea='Report Fact Billing SP'\norder by id",
								"queryTimeout": "02:00:00",
								"partitionOption": "None"
							},
							"dataset": {
								"referenceName": "Briggs_MDW",
								"type": "DatasetReference",
								"parameters": {
									"schema_name": "dbo",
									"table_name": "user"
								}
							},
							"firstRowOnly": false
						}
					},
					{
						"name": "ForEach_Fact",
						"type": "ForEach",
						"dependsOn": [
							{
								"activity": "ReportFactProc",
								"dependencyConditions": [
									"Succeeded"
								]
							}
						],
						"userProperties": [],
						"typeProperties": {
							"items": {
								"value": "@activity('ReportFactProc').output.value",
								"type": "Expression"
							},
							"activities": [
								{
									"name": "Stored procedure",
									"type": "SqlServerStoredProcedure",
									"dependsOn": [
										{
											"activity": "Start_Table_Audit1_Fact",
											"dependencyConditions": [
												"Succeeded"
											]
										}
									],
									"policy": {
										"timeout": "7.00:00:00",
										"retry": 0,
										"retryIntervalInSeconds": 30,
										"secureOutput": false,
										"secureInput": false
									},
									"userProperties": [],
									"typeProperties": {
										"storedProcedureName": {
											"value": "@item().sourcetablename",
											"type": "Expression"
										}
									},
									"linkedServiceName": {
										"referenceName": "DS_MDW_SP",
										"type": "LinkedServiceReference"
									}
								},
								{
									"name": "Start_Table_Audit1_Fact",
									"type": "Lookup",
									"dependsOn": [],
									"policy": {
										"timeout": "7.00:00:00",
										"retry": 0,
										"retryIntervalInSeconds": 30,
										"secureOutput": false,
										"secureInput": false
									},
									"userProperties": [],
									"typeProperties": {
										"source": {
											"type": "AzureSqlSource",
											"sqlReaderStoredProcedureName": "[dbo].[proc_StartAuditLog_Briggs]",
											"storedProcedureParameters": {
												"ConfigTableID": {
													"type": "Int32",
													"value": {
														"value": "@item().ID",
														"type": "Expression"
													}
												},
												"DataFactoryName": {
													"type": "String",
													"value": {
														"value": "@pipeline().DataFactory",
														"type": "Expression"
													}
												},
												"ParentAuditID": {
													"type": "Int64",
													"value": {
														"value": "@item().ID",
														"type": "Expression"
													}
												},
												"PipelineName": {
													"type": "String",
													"value": {
														"value": "@pipeline().Pipeline",
														"type": "Expression"
													}
												},
												"PipelineRunID": {
													"type": "String",
													"value": {
														"value": "@pipeline().RunId",
														"type": "Expression"
													}
												},
												"PipelineTriggerID": {
													"type": "String",
													"value": {
														"value": "@pipeline().TriggerId",
														"type": "Expression"
													}
												},
												"PipelineTriggerName": {
													"type": "String",
													"value": {
														"value": "@pipeline().TriggerName",
														"type": "Expression"
													}
												},
												"PipelineTriggerType": {
													"type": "String",
													"value": {
														"value": "@pipeline().TriggerType",
														"type": "Expression"
													}
												},
												"Sourcedb": {
													"type": "String",
													"value": {
														"value": "@item().sourceDB",
														"type": "Expression"
													}
												},
												"sourcetable": {
													"type": "String",
													"value": {
														"value": "@item().SourcetableName",
														"type": "Expression"
													}
												}
											},
											"queryTimeout": "02:00:00",
											"partitionOption": "None"
										},
										"dataset": {
											"referenceName": "Briggs_MDW",
											"type": "DatasetReference",
											"parameters": {
												"schema_name": "dbo",
												"table_name": "user"
											}
										},
										"firstRowOnly": false
									}
								},
								{
									"name": "Success_Audit_Log2_Fact",
									"type": "SqlServerStoredProcedure",
									"dependsOn": [
										{
											"activity": "Stored procedure",
											"dependencyConditions": [
												"Succeeded"
											]
										}
									],
									"policy": {
										"timeout": "7.00:00:00",
										"retry": 0,
										"retryIntervalInSeconds": 30,
										"secureOutput": false,
										"secureInput": false
									},
									"userProperties": [],
									"typeProperties": {
										"storedProcedureName": "[dbo].[proc_UpdateAuditLog_Briggs]",
										"storedProcedureParameters": {
											"ConfigTableID": {
												"value": {
													"value": "@item().ID",
													"type": "Expression"
												},
												"type": "Int32"
											},
											"RowsRead": {
												"value": null,
												"type": "Int64"
											},
											"Status": {
												"value": "Success",
												"type": "String"
											}
										}
									},
									"linkedServiceName": {
										"referenceName": "DS_MDW_SP",
										"type": "LinkedServiceReference"
									}
								},
								{
									"name": "Set variable1_Fact",
									"type": "SetVariable",
									"dependsOn": [
										{
											"activity": "Stored procedure",
											"dependencyConditions": [
												"Failed"
											]
										}
									],
									"userProperties": [],
									"typeProperties": {
										"variableName": "ErrorMsg",
										"value": {
											"value": "@activity('ReportStageProc').Error.Message",
											"type": "Expression"
										}
									}
								},
								{
									"name": "Failure_Audit_Log_Fact",
									"type": "SqlServerStoredProcedure",
									"dependsOn": [
										{
											"activity": "Set variable1_Fact",
											"dependencyConditions": [
												"Succeeded"
											]
										}
									],
									"policy": {
										"timeout": "7.00:00:00",
										"retry": 0,
										"retryIntervalInSeconds": 30,
										"secureOutput": false,
										"secureInput": false
									},
									"userProperties": [],
									"typeProperties": {
										"storedProcedureName": "[dbo].[proc_UpdateAuditLog_Briggs]",
										"storedProcedureParameters": {
											"ConfigTableID": {
												"value": {
													"value": "@item().ID",
													"type": "Expression"
												},
												"type": "Int32"
											},
											"RowsRead": {
												"value": null,
												"type": "Int64"
											},
											"Status": {
												"value": {
													"value": "@variables('ErrorMsg')",
													"type": "Expression"
												},
												"type": "String"
											}
										}
									},
									"linkedServiceName": {
										"referenceName": "DS_MDW_SP",
										"type": "LinkedServiceReference"
									}
								}
							]
						}
					},
					{
						"name": "Stage_SSG_Billing",
						"type": "Copy",
						"dependsOn": [],
						"policy": {
							"timeout": "7.00:00:00",
							"retry": 0,
							"retryIntervalInSeconds": 30,
							"secureOutput": false,
							"secureInput": false
						},
						"userProperties": [],
						"typeProperties": {
							"source": {
								"type": "SqlServerSource",
								"sqlReaderQuery": "select projinvoiceid proj_invoice_id\n              ,a.projid proj_id\n              ,a.ponumber po_number\n              ,a.invoiceaccount invoice_account\n\t\t\t  ,a.invoicingname invoicing_name\n\t\t\t  ,a.orderaccount order_account\n\t\t\t  ,a.deliveryname delivery_name\n              ,a.invoicedate invoice_date\n              ,a.invoiceamount invoice_amount\n              ,hcm.name \n              ,a.createddatetime created_date_time\n\t\t\t,dateadd(hh,-6,a.createddatetime) 'cst_time'\n              ,oc.orderclassid order_class_id\n\t\t\t  ,b.custgroup cust_group\n\t\t\t  ,a.svcinventlocationid svc_invent_location_id\n\t\t\t  ,hcmworkertitle.officelocation office_location\nfrom projinvoicejour a\nleft join custtable b on a.invoiceaccount = b.accountnum\ninner join custtrans ct on ct.invoice = a.projinvoiceid and ct.accountnum = a.invoiceaccount\nleft join hcmworkerdetailsview hcm on ct.approver = hcm.recid\nleft join xap_orderclass oc on ct.orderclass = oc.recid\nleft join hcmworkertitle on hcm.recid= hcmworkertitle.worker and [briggs_mst].dbo.utc2central( hcmworkertitle.validto) > getdate()\nwhere a.projinvoiceid <> ''\nand oc.orderclassid = 'SERVICE'\nand a.svcinventlocationid like 'P%'\nand year(invoicedate)>='2020'",
								"queryTimeout": "02:00:00",
								"partitionOption": "None"
							},
							"sink": {
								"type": "AzureSqlSink",
								"preCopyScript": "truncate table briggs.Stage_SSG_Billing",
								"disableMetricsCollection": false
							},
							"enableStaging": false,
							"translator": {
								"type": "TabularTranslator",
								"mappings": [
									{
										"source": {
											"name": "proj_invoice_id",
											"type": "String",
											"physicalType": "nvarchar"
										},
										"sink": {
											"name": "proj_invoice_id",
											"type": "String",
											"physicalType": "String"
										}
									},
									{
										"source": {
											"name": "proj_id",
											"type": "String",
											"physicalType": "nvarchar"
										},
										"sink": {
											"name": "proj_id",
											"type": "String",
											"physicalType": "String"
										}
									},
									{
										"source": {
											"name": "po_number",
											"type": "String",
											"physicalType": "nvarchar"
										},
										"sink": {
											"name": "po_number",
											"type": "String",
											"physicalType": "String"
										}
									},
									{
										"source": {
											"name": "invoice_account",
											"type": "String",
											"physicalType": "nvarchar"
										},
										"sink": {
											"name": "invoice_account",
											"type": "String",
											"physicalType": "String"
										}
									},
									{
										"source": {
											"name": "invoicing_name",
											"type": "String",
											"physicalType": "nvarchar"
										},
										"sink": {
											"name": "invoicing_name",
											"type": "String",
											"physicalType": "String"
										}
									},
									{
										"source": {
											"name": "order_account",
											"type": "String",
											"physicalType": "nvarchar"
										},
										"sink": {
											"name": "order_account",
											"type": "String",
											"physicalType": "String"
										}
									},
									{
										"source": {
											"name": "delivery_name",
											"type": "String",
											"physicalType": "nvarchar"
										},
										"sink": {
											"name": "delivery_name",
											"type": "String",
											"physicalType": "String"
										}
									},
									{
										"source": {
											"name": "invoice_date",
											"type": "DateTime",
											"physicalType": "datetime"
										},
										"sink": {
											"name": "invoice_date",
											"type": "DateTime",
											"physicalType": "DateTime"
										}
									},
									{
										"source": {
											"name": "invoice_amount",
											"type": "Decimal",
											"physicalType": "decimal",
											"scale": 16,
											"precision": 32
										},
										"sink": {
											"name": "invoice_amount",
											"type": "Decimal",
											"physicalType": "Decimal"
										}
									},
									{
										"source": {
											"name": "name",
											"type": "String",
											"physicalType": "nvarchar"
										},
										"sink": {
											"name": "name",
											"type": "String",
											"physicalType": "String"
										}
									},
									{
										"source": {
											"name": "created_date_time",
											"type": "DateTime",
											"physicalType": "datetime"
										},
										"sink": {
											"name": "created_date_time",
											"type": "DateTime",
											"physicalType": "DateTime"
										}
									},
									{
										"source": {
											"name": "cst_time",
											"type": "DateTime",
											"physicalType": "datetime"
										},
										"sink": {
											"name": "cst_time",
											"type": "DateTime",
											"physicalType": "DateTime"
										}
									},
									{
										"source": {
											"name": "order_class_id",
											"type": "String",
											"physicalType": "nvarchar"
										},
										"sink": {
											"name": "order_class_id",
											"type": "String",
											"physicalType": "String"
										}
									},
									{
										"source": {
											"name": "cust_group",
											"type": "String",
											"physicalType": "nvarchar"
										},
										"sink": {
											"name": "cust_group",
											"type": "String",
											"physicalType": "String"
										}
									},
									{
										"source": {
											"name": "svc_invent_location_id",
											"type": "String",
											"physicalType": "nvarchar"
										},
										"sink": {
											"name": "svc_invent_location_id",
											"type": "String",
											"physicalType": "String"
										}
									},
									{
										"source": {
											"name": "office_location",
											"type": "String",
											"physicalType": "nvarchar"
										},
										"sink": {
											"name": "office_location",
											"type": "String",
											"physicalType": "String"
										}
									}
								],
								"typeConversion": true,
								"typeConversionSettings": {
									"allowDataTruncation": true,
									"treatBooleanAsNumber": false
								}
							}
						},
						"inputs": [
							{
								"referenceName": "Briggs_MST",
								"type": "DatasetReference",
								"parameters": {}
							}
						],
						"outputs": [
							{
								"referenceName": "Briggs_MDW",
								"type": "DatasetReference",
								"parameters": {
									"schema_name": "Briggs",
									"table_name": "Stage_SSG_Billing"
								}
							}
						]
					},
					{
						"name": "lkp_ExecStartAuditProc",
						"type": "Lookup",
						"dependsOn": [],
						"policy": {
							"timeout": "7.00:00:00",
							"retry": 0,
							"retryIntervalInSeconds": 30,
							"secureOutput": false,
							"secureInput": false
						},
						"userProperties": [],
						"typeProperties": {
							"source": {
								"type": "AzureSqlSource",
								"sqlReaderStoredProcedureName": "[dbo].[proc_StartAuditLog]",
								"storedProcedureParameters": {
									"ConfigTableID": {
										"type": "Int32",
										"value": "-1"
									},
									"DataFactoryName": {
										"type": "String",
										"value": {
											"value": "@pipeline().DataFactory",
											"type": "Expression"
										}
									},
									"ParentAuditID": {
										"type": "Int64",
										"value": "-1"
									},
									"PipelineName": {
										"type": "String",
										"value": {
											"value": "@pipeline().Pipeline",
											"type": "Expression"
										}
									},
									"PipelineRunID": {
										"type": "String",
										"value": {
											"value": "@pipeline().RunId",
											"type": "Expression"
										}
									},
									"PipelineTriggerID": {
										"type": "String",
										"value": {
											"value": "@pipeline().TriggerId",
											"type": "Expression"
										}
									},
									"PipelineTriggerName": {
										"type": "String",
										"value": {
											"value": "@pipeline().TriggerName",
											"type": "Expression"
										}
									},
									"PipelineTriggerType": {
										"type": "String",
										"value": {
											"value": "@pipeline().TriggerType",
											"type": "Expression"
										}
									}
								},
								"queryTimeout": "02:00:00",
								"partitionOption": "None"
							},
							"dataset": {
								"referenceName": "Briggs_MDW",
								"type": "DatasetReference",
								"parameters": {
									"schema_name": "dbo",
									"table_name": "user"
								}
							}
						}
					},
					{
						"name": "Sp_ExecFailureAudit_Fact",
						"type": "SqlServerStoredProcedure",
						"dependsOn": [
							{
								"activity": "ForEach_Fact",
								"dependencyConditions": [
									"Failed"
								]
							}
						],
						"policy": {
							"timeout": "7.00:00:00",
							"retry": 0,
							"retryIntervalInSeconds": 30,
							"secureOutput": false,
							"secureInput": false
						},
						"userProperties": [],
						"typeProperties": {
							"storedProcedureName": "[dbo].[proc_UpdateAuditLog]",
							"storedProcedureParameters": {
								"AuditID": {
									"value": {
										"value": "@activity('lkp_ExecStartAuditProc').output.firstRow.AuditID",
										"type": "Expression"
									},
									"type": "Int32"
								},
								"DataLakePath": {
									"value": null,
									"type": "String"
								},
								"PipelineRunID": {
									"value": {
										"value": "@pipeline().RunId",
										"type": "Expression"
									},
									"type": "String"
								},
								"RowsRead": {
									"value": null,
									"type": "Int64"
								},
								"Status": {
									"value": "Fact Proc Failed",
									"type": "String"
								}
							}
						},
						"linkedServiceName": {
							"referenceName": "AzureSqlDatabase1",
							"type": "LinkedServiceReference"
						}
					},
					{
						"name": "Sp_ExecSuccessAudit",
						"type": "SqlServerStoredProcedure",
						"dependsOn": [
							{
								"activity": "ForEach_Fact",
								"dependencyConditions": [
									"Succeeded"
								]
							}
						],
						"policy": {
							"timeout": "7.00:00:00",
							"retry": 0,
							"retryIntervalInSeconds": 30,
							"secureOutput": false,
							"secureInput": false
						},
						"userProperties": [],
						"typeProperties": {
							"storedProcedureName": "[dbo].[proc_UpdateAuditLog]",
							"storedProcedureParameters": {
								"AuditID": {
									"value": {
										"value": "@activity('lkp_ExecStartAuditProc').output.firstRow.AuditID",
										"type": "Expression"
									},
									"type": "Int32"
								},
								"DataLakePath": {
									"value": null,
									"type": "String"
								},
								"RowsRead": {
									"value": null,
									"type": "Int64"
								},
								"Status": {
									"value": "Success",
									"type": "String"
								},
								"PipelineRunID": {
									"value": {
										"value": "@pipeline().RunId",
										"type": "Expression"
									},
									"type": "String"
								}
							}
						},
						"linkedServiceName": {
							"referenceName": "AzureSqlDatabase1",
							"type": "LinkedServiceReference"
						}
					},
					{
						"name": "Sp_ExecFailureAudit_Stage",
						"type": "SqlServerStoredProcedure",
						"dependsOn": [
							{
								"activity": "ForEach_Stage",
								"dependencyConditions": [
									"Failed"
								]
							}
						],
						"policy": {
							"timeout": "7.00:00:00",
							"retry": 0,
							"retryIntervalInSeconds": 30,
							"secureOutput": false,
							"secureInput": false
						},
						"userProperties": [],
						"typeProperties": {
							"storedProcedureName": "[dbo].[proc_UpdateAuditLog]",
							"storedProcedureParameters": {
								"AuditID": {
									"value": {
										"value": "@activity('lkp_ExecStartAuditProc').output.firstRow.AuditID",
										"type": "Expression"
									},
									"type": "Int32"
								},
								"DataLakePath": {
									"value": null,
									"type": "String"
								},
								"PipelineRunID": {
									"value": {
										"value": "@pipeline().RunId",
										"type": "Expression"
									},
									"type": "String"
								},
								"RowsRead": {
									"value": null,
									"type": "Int64"
								},
								"Status": {
									"value": "Stage Proc Failed",
									"type": "String"
								}
							}
						},
						"linkedServiceName": {
							"referenceName": "AzureSqlDatabase1",
							"type": "LinkedServiceReference"
						}
					},
					{
						"name": "Sp_ExecFailureAudit_TL",
						"type": "SqlServerStoredProcedure",
						"dependsOn": [
							{
								"activity": "Execute Pipeline1",
								"dependencyConditions": [
									"Failed"
								]
							}
						],
						"policy": {
							"timeout": "7.00:00:00",
							"retry": 0,
							"retryIntervalInSeconds": 30,
							"secureOutput": false,
							"secureInput": false
						},
						"userProperties": [],
						"typeProperties": {
							"storedProcedureName": "[dbo].[proc_UpdateAuditLog]",
							"storedProcedureParameters": {
								"AuditID": {
									"value": {
										"value": "@activity('lkp_ExecStartAuditProc').output.firstRow.AuditID",
										"type": "Expression"
									},
									"type": "Int32"
								},
								"DataLakePath": {
									"value": null,
									"type": "String"
								},
								"PipelineRunID": {
									"value": {
										"value": "@pipeline().RunId",
										"type": "Expression"
									},
									"type": "String"
								},
								"RowsRead": {
									"value": null,
									"type": "Int64"
								},
								"Status": {
									"value": "Table Load Failed",
									"type": "String"
								}
							}
						},
						"linkedServiceName": {
							"referenceName": "AzureSqlDatabase1",
							"type": "LinkedServiceReference"
						}
					}
				],
				"policy": {
					"elapsedTimeMetric": {},
					"cancelAfter": {}
				},
				"variables": {
					"ErrorMsg": {
						"type": "String"
					}
				},
				"folder": {
					"name": "Briggs Data Load Theme wise"
				},
				"annotations": [],
				"lastPublishTime": "2022-04-26T12:26:52Z"
			},
			"dependsOn": [
				"[concat(variables('workspaceId'), '/pipelines/PL_Generic_Copy_Billing')]",
				"[concat(variables('workspaceId'), '/datasets/Briggs_MDW')]",
				"[concat(variables('workspaceId'), '/datasets/Briggs_MST')]",
				"[concat(variables('workspaceId'), '/linkedServices/AzureSqlDatabase1')]",
				"[concat(variables('workspaceId'), '/linkedServices/DS_MDW_SP')]"
			]
		},
		{
			"name": "[concat(parameters('workspaceName'), '/PL_Master_Briggs_Commission')]",
			"type": "Microsoft.Synapse/workspaces/pipelines",
			"apiVersion": "2019-06-01-preview",
			"properties": {
				"activities": [
					{
						"name": "Execute Pipeline1",
						"type": "ExecutePipeline",
						"dependsOn": [
							{
								"activity": "lkp_ExecStartAuditProc",
								"dependencyConditions": [
									"Succeeded"
								]
							}
						],
						"userProperties": [],
						"typeProperties": {
							"pipeline": {
								"referenceName": "PL_Generic_Copy_Commission",
								"type": "PipelineReference"
							},
							"waitOnCompletion": true,
							"parameters": {}
						}
					},
					{
						"name": "ReportStageProc",
						"type": "Lookup",
						"dependsOn": [
							{
								"activity": "Execute Pipeline1",
								"dependencyConditions": [
									"Succeeded"
								]
							}
						],
						"policy": {
							"timeout": "7.00:00:00",
							"retry": 0,
							"retryIntervalInSeconds": 30,
							"secureOutput": false,
							"secureInput": false
						},
						"userProperties": [],
						"typeProperties": {
							"source": {
								"type": "AzureSqlSource",
								"sqlReaderQuery": "select  * from dbo.control_table where processsequence = 2 and enableaction = 1 \nand subjectarea='Report Stage Commission SP'\norder by id",
								"queryTimeout": "02:00:00",
								"partitionOption": "None"
							},
							"dataset": {
								"referenceName": "Briggs_MDW",
								"type": "DatasetReference",
								"parameters": {
									"schema_name": "dbo",
									"table_name": "user"
								}
							},
							"firstRowOnly": false
						}
					},
					{
						"name": "ForEach_Stage",
						"type": "ForEach",
						"dependsOn": [
							{
								"activity": "ReportStageProc",
								"dependencyConditions": [
									"Succeeded"
								]
							}
						],
						"userProperties": [],
						"typeProperties": {
							"items": {
								"value": "@activity('ReportStageProc').output.value",
								"type": "Expression"
							},
							"activities": [
								{
									"name": "Stored procedure1",
									"type": "SqlServerStoredProcedure",
									"dependsOn": [
										{
											"activity": "Start_Table_Audit_Stage",
											"dependencyConditions": [
												"Succeeded"
											]
										}
									],
									"policy": {
										"timeout": "7.00:00:00",
										"retry": 0,
										"retryIntervalInSeconds": 30,
										"secureOutput": false,
										"secureInput": false
									},
									"userProperties": [],
									"typeProperties": {
										"storedProcedureName": {
											"value": "@item().sourcetablename",
											"type": "Expression"
										}
									},
									"linkedServiceName": {
										"referenceName": "DS_MDW_SP",
										"type": "LinkedServiceReference"
									}
								},
								{
									"name": "Start_Table_Audit_Stage",
									"type": "Lookup",
									"dependsOn": [],
									"policy": {
										"timeout": "7.00:00:00",
										"retry": 0,
										"retryIntervalInSeconds": 30,
										"secureOutput": false,
										"secureInput": false
									},
									"userProperties": [],
									"typeProperties": {
										"source": {
											"type": "AzureSqlSource",
											"sqlReaderStoredProcedureName": "[dbo].[proc_StartAuditLog_Briggs]",
											"storedProcedureParameters": {
												"ConfigTableID": {
													"type": "Int32",
													"value": {
														"value": "@item().ID",
														"type": "Expression"
													}
												},
												"DataFactoryName": {
													"type": "String",
													"value": {
														"value": "@pipeline().DataFactory",
														"type": "Expression"
													}
												},
												"ParentAuditID": {
													"type": "Int64",
													"value": {
														"value": "@item().ID",
														"type": "Expression"
													}
												},
												"PipelineName": {
													"type": "String",
													"value": {
														"value": "@pipeline().Pipeline",
														"type": "Expression"
													}
												},
												"PipelineRunID": {
													"type": "String",
													"value": {
														"value": "@pipeline().RunId",
														"type": "Expression"
													}
												},
												"PipelineTriggerID": {
													"type": "String",
													"value": {
														"value": "@pipeline().TriggerId",
														"type": "Expression"
													}
												},
												"PipelineTriggerName": {
													"type": "String",
													"value": {
														"value": "@pipeline().TriggerName",
														"type": "Expression"
													}
												},
												"PipelineTriggerType": {
													"type": "String",
													"value": {
														"value": "@pipeline().TriggerType",
														"type": "Expression"
													}
												},
												"Sourcedb": {
													"type": "String",
													"value": {
														"value": "@item().sourceDB",
														"type": "Expression"
													}
												},
												"sourcetable": {
													"type": "String",
													"value": {
														"value": "@item().SourcetableName",
														"type": "Expression"
													}
												}
											},
											"queryTimeout": "02:00:00",
											"partitionOption": "None"
										},
										"dataset": {
											"referenceName": "Briggs_MDW",
											"type": "DatasetReference",
											"parameters": {
												"schema_name": "dbo",
												"table_name": "user"
											}
										},
										"firstRowOnly": false
									}
								},
								{
									"name": "Success_Audit_Log_Stage",
									"type": "SqlServerStoredProcedure",
									"dependsOn": [
										{
											"activity": "Stored procedure1",
											"dependencyConditions": [
												"Succeeded"
											]
										}
									],
									"policy": {
										"timeout": "7.00:00:00",
										"retry": 0,
										"retryIntervalInSeconds": 30,
										"secureOutput": false,
										"secureInput": false
									},
									"userProperties": [],
									"typeProperties": {
										"storedProcedureName": "[dbo].[proc_UpdateAuditLog_Briggs]",
										"storedProcedureParameters": {
											"ConfigTableID": {
												"value": {
													"value": "@item().ID",
													"type": "Expression"
												},
												"type": "Int32"
											},
											"RowsRead": {
												"value": null,
												"type": "Int64"
											},
											"Status": {
												"value": "Success",
												"type": "String"
											}
										}
									},
									"linkedServiceName": {
										"referenceName": "DS_MDW_SP",
										"type": "LinkedServiceReference"
									}
								},
								{
									"name": "Set variable_Stage",
									"type": "SetVariable",
									"dependsOn": [
										{
											"activity": "Stored procedure1",
											"dependencyConditions": [
												"Failed"
											]
										}
									],
									"userProperties": [],
									"typeProperties": {
										"variableName": "ErrorMsg",
										"value": {
											"value": "@activity('Stored procedure1').Error.Message",
											"type": "Expression"
										}
									}
								},
								{
									"name": "Failure_Audit_Log_Stage",
									"type": "SqlServerStoredProcedure",
									"dependsOn": [
										{
											"activity": "Set variable_Stage",
											"dependencyConditions": [
												"Succeeded"
											]
										}
									],
									"policy": {
										"timeout": "7.00:00:00",
										"retry": 0,
										"retryIntervalInSeconds": 30,
										"secureOutput": false,
										"secureInput": false
									},
									"userProperties": [],
									"typeProperties": {
										"storedProcedureName": "[dbo].[proc_UpdateAuditLog_Briggs]",
										"storedProcedureParameters": {
											"ConfigTableID": {
												"value": {
													"value": "@item().ID",
													"type": "Expression"
												},
												"type": "Int32"
											},
											"RowsRead": {
												"value": null,
												"type": "Int64"
											},
											"Status": {
												"value": {
													"value": "@variables('ErrorMsg')",
													"type": "Expression"
												},
												"type": "String"
											}
										}
									},
									"linkedServiceName": {
										"referenceName": "DS_MDW_SP",
										"type": "LinkedServiceReference"
									}
								}
							]
						}
					},
					{
						"name": "ReportFactProc",
						"type": "Lookup",
						"dependsOn": [
							{
								"activity": "ForEach_Stage",
								"dependencyConditions": [
									"Succeeded"
								]
							}
						],
						"policy": {
							"timeout": "7.00:00:00",
							"retry": 0,
							"retryIntervalInSeconds": 30,
							"secureOutput": false,
							"secureInput": false
						},
						"userProperties": [],
						"typeProperties": {
							"source": {
								"type": "AzureSqlSource",
								"sqlReaderQuery": "select  * from dbo.control_table where processsequence = 4 and enableaction = 1 and subjectarea='Report Fact Commission SP'\norder by id",
								"queryTimeout": "02:00:00",
								"partitionOption": "None"
							},
							"dataset": {
								"referenceName": "Briggs_MDW",
								"type": "DatasetReference",
								"parameters": {
									"schema_name": "dbo",
									"table_name": "user"
								}
							},
							"firstRowOnly": false
						}
					},
					{
						"name": "ForEach_Fact",
						"type": "ForEach",
						"dependsOn": [
							{
								"activity": "ReportFactProc",
								"dependencyConditions": [
									"Succeeded"
								]
							}
						],
						"userProperties": [],
						"typeProperties": {
							"items": {
								"value": "@activity('ReportFactProc').output.value",
								"type": "Expression"
							},
							"activities": [
								{
									"name": "Stored procedure",
									"type": "SqlServerStoredProcedure",
									"dependsOn": [
										{
											"activity": "Start_Table_Audit1_Fact",
											"dependencyConditions": [
												"Succeeded"
											]
										}
									],
									"policy": {
										"timeout": "7.00:00:00",
										"retry": 0,
										"retryIntervalInSeconds": 30,
										"secureOutput": false,
										"secureInput": false
									},
									"userProperties": [],
									"typeProperties": {
										"storedProcedureName": {
											"value": "@item().sourcetablename",
											"type": "Expression"
										}
									},
									"linkedServiceName": {
										"referenceName": "DS_MDW_SP",
										"type": "LinkedServiceReference"
									}
								},
								{
									"name": "Start_Table_Audit1_Fact",
									"type": "Lookup",
									"dependsOn": [],
									"policy": {
										"timeout": "7.00:00:00",
										"retry": 0,
										"retryIntervalInSeconds": 30,
										"secureOutput": false,
										"secureInput": false
									},
									"userProperties": [],
									"typeProperties": {
										"source": {
											"type": "AzureSqlSource",
											"sqlReaderStoredProcedureName": "[dbo].[proc_StartAuditLog_Briggs]",
											"storedProcedureParameters": {
												"ConfigTableID": {
													"type": "Int32",
													"value": {
														"value": "@item().ID",
														"type": "Expression"
													}
												},
												"DataFactoryName": {
													"type": "String",
													"value": {
														"value": "@pipeline().DataFactory",
														"type": "Expression"
													}
												},
												"ParentAuditID": {
													"type": "Int64",
													"value": {
														"value": "@item().ID",
														"type": "Expression"
													}
												},
												"PipelineName": {
													"type": "String",
													"value": {
														"value": "@pipeline().Pipeline",
														"type": "Expression"
													}
												},
												"PipelineRunID": {
													"type": "String",
													"value": {
														"value": "@pipeline().RunId",
														"type": "Expression"
													}
												},
												"PipelineTriggerID": {
													"type": "String",
													"value": {
														"value": "@pipeline().TriggerId",
														"type": "Expression"
													}
												},
												"PipelineTriggerName": {
													"type": "String",
													"value": {
														"value": "@pipeline().TriggerName",
														"type": "Expression"
													}
												},
												"PipelineTriggerType": {
													"type": "String",
													"value": {
														"value": "@pipeline().TriggerType",
														"type": "Expression"
													}
												},
												"Sourcedb": {
													"type": "String",
													"value": {
														"value": "@item().sourceDB",
														"type": "Expression"
													}
												},
												"sourcetable": {
													"type": "String",
													"value": {
														"value": "@item().SourcetableName",
														"type": "Expression"
													}
												}
											},
											"queryTimeout": "02:00:00",
											"partitionOption": "None"
										},
										"dataset": {
											"referenceName": "Briggs_MDW",
											"type": "DatasetReference",
											"parameters": {
												"schema_name": "dbo",
												"table_name": "user"
											}
										},
										"firstRowOnly": false
									}
								},
								{
									"name": "Success_Audit_Log2_Fact",
									"type": "SqlServerStoredProcedure",
									"dependsOn": [
										{
											"activity": "Stored procedure",
											"dependencyConditions": [
												"Succeeded"
											]
										}
									],
									"policy": {
										"timeout": "7.00:00:00",
										"retry": 0,
										"retryIntervalInSeconds": 30,
										"secureOutput": false,
										"secureInput": false
									},
									"userProperties": [],
									"typeProperties": {
										"storedProcedureName": "[dbo].[proc_UpdateAuditLog_Briggs]",
										"storedProcedureParameters": {
											"ConfigTableID": {
												"value": {
													"value": "@item().ID",
													"type": "Expression"
												},
												"type": "Int32"
											},
											"RowsRead": {
												"value": null,
												"type": "Int64"
											},
											"Status": {
												"value": "Success",
												"type": "String"
											}
										}
									},
									"linkedServiceName": {
										"referenceName": "DS_MDW_SP",
										"type": "LinkedServiceReference"
									}
								},
								{
									"name": "Set variable1_Fact",
									"type": "SetVariable",
									"dependsOn": [
										{
											"activity": "Stored procedure",
											"dependencyConditions": [
												"Failed"
											]
										}
									],
									"userProperties": [],
									"typeProperties": {
										"variableName": "ErrorMsg",
										"value": {
											"value": "@activity('ReportStageProc').Error.Message",
											"type": "Expression"
										}
									}
								},
								{
									"name": "Failure_Audit_Log_Fact",
									"type": "SqlServerStoredProcedure",
									"dependsOn": [
										{
											"activity": "Set variable1_Fact",
											"dependencyConditions": [
												"Succeeded"
											]
										}
									],
									"policy": {
										"timeout": "7.00:00:00",
										"retry": 0,
										"retryIntervalInSeconds": 30,
										"secureOutput": false,
										"secureInput": false
									},
									"userProperties": [],
									"typeProperties": {
										"storedProcedureName": "[dbo].[proc_UpdateAuditLog_Briggs]",
										"storedProcedureParameters": {
											"ConfigTableID": {
												"value": {
													"value": "@item().ID",
													"type": "Expression"
												},
												"type": "Int32"
											},
											"RowsRead": {
												"value": null,
												"type": "Int64"
											},
											"Status": {
												"value": {
													"value": "@variables('ErrorMsg')",
													"type": "Expression"
												},
												"type": "String"
											}
										}
									},
									"linkedServiceName": {
										"referenceName": "DS_MDW_SP",
										"type": "LinkedServiceReference"
									}
								}
							]
						}
					},
					{
						"name": "lkp_ExecStartAuditProc",
						"type": "Lookup",
						"dependsOn": [],
						"policy": {
							"timeout": "7.00:00:00",
							"retry": 0,
							"retryIntervalInSeconds": 30,
							"secureOutput": false,
							"secureInput": false
						},
						"userProperties": [],
						"typeProperties": {
							"source": {
								"type": "AzureSqlSource",
								"sqlReaderStoredProcedureName": "[dbo].[proc_StartAuditLog]",
								"storedProcedureParameters": {
									"ConfigTableID": {
										"type": "Int32",
										"value": "-1"
									},
									"DataFactoryName": {
										"type": "String",
										"value": {
											"value": "@pipeline().DataFactory",
											"type": "Expression"
										}
									},
									"ParentAuditID": {
										"type": "Int64",
										"value": "-1"
									},
									"PipelineName": {
										"type": "String",
										"value": {
											"value": "@pipeline().Pipeline",
											"type": "Expression"
										}
									},
									"PipelineRunID": {
										"type": "String",
										"value": {
											"value": "@pipeline().RunId",
											"type": "Expression"
										}
									},
									"PipelineTriggerID": {
										"type": "String",
										"value": {
											"value": "@pipeline().TriggerId",
											"type": "Expression"
										}
									},
									"PipelineTriggerName": {
										"type": "String",
										"value": {
											"value": "@pipeline().TriggerName",
											"type": "Expression"
										}
									},
									"PipelineTriggerType": {
										"type": "String",
										"value": {
											"value": "@pipeline().TriggerType",
											"type": "Expression"
										}
									}
								},
								"queryTimeout": "02:00:00",
								"partitionOption": "None"
							},
							"dataset": {
								"referenceName": "Briggs_MDW",
								"type": "DatasetReference",
								"parameters": {
									"schema_name": "dbo",
									"table_name": "user"
								}
							}
						}
					},
					{
						"name": "Sp_ExecFailureAudit_Fact",
						"type": "SqlServerStoredProcedure",
						"dependsOn": [
							{
								"activity": "ForEach_Fact",
								"dependencyConditions": [
									"Failed"
								]
							}
						],
						"policy": {
							"timeout": "7.00:00:00",
							"retry": 0,
							"retryIntervalInSeconds": 30,
							"secureOutput": false,
							"secureInput": false
						},
						"userProperties": [],
						"typeProperties": {
							"storedProcedureName": "[dbo].[proc_UpdateAuditLog]",
							"storedProcedureParameters": {
								"AuditID": {
									"value": {
										"value": "@activity('lkp_ExecStartAuditProc').output.firstRow.AuditID",
										"type": "Expression"
									},
									"type": "Int32"
								},
								"DataLakePath": {
									"value": null,
									"type": "String"
								},
								"PipelineRunID": {
									"value": {
										"value": "@pipeline().RunId",
										"type": "Expression"
									},
									"type": "String"
								},
								"RowsRead": {
									"value": null,
									"type": "Int64"
								},
								"Status": {
									"value": "Fact Proc Failed",
									"type": "String"
								}
							}
						},
						"linkedServiceName": {
							"referenceName": "AzureSqlDatabase1",
							"type": "LinkedServiceReference"
						}
					},
					{
						"name": "Sp_ExecSuccessAudit",
						"type": "SqlServerStoredProcedure",
						"dependsOn": [
							{
								"activity": "ForEach_Fact",
								"dependencyConditions": [
									"Succeeded"
								]
							}
						],
						"policy": {
							"timeout": "7.00:00:00",
							"retry": 0,
							"retryIntervalInSeconds": 30,
							"secureOutput": false,
							"secureInput": false
						},
						"userProperties": [],
						"typeProperties": {
							"storedProcedureName": "[dbo].[proc_UpdateAuditLog]",
							"storedProcedureParameters": {
								"AuditID": {
									"value": {
										"value": "@activity('lkp_ExecStartAuditProc').output.firstRow.AuditID",
										"type": "Expression"
									},
									"type": "Int32"
								},
								"DataLakePath": {
									"value": null,
									"type": "String"
								},
								"RowsRead": {
									"value": null,
									"type": "Int64"
								},
								"Status": {
									"value": "Success",
									"type": "String"
								},
								"PipelineRunID": {
									"value": {
										"value": "@pipeline().RunId",
										"type": "Expression"
									},
									"type": "String"
								}
							}
						},
						"linkedServiceName": {
							"referenceName": "AzureSqlDatabase1",
							"type": "LinkedServiceReference"
						}
					},
					{
						"name": "Sp_ExecFailureAudit_Stage",
						"type": "SqlServerStoredProcedure",
						"dependsOn": [
							{
								"activity": "ForEach_Stage",
								"dependencyConditions": [
									"Failed"
								]
							}
						],
						"policy": {
							"timeout": "7.00:00:00",
							"retry": 0,
							"retryIntervalInSeconds": 30,
							"secureOutput": false,
							"secureInput": false
						},
						"userProperties": [],
						"typeProperties": {
							"storedProcedureName": "[dbo].[proc_UpdateAuditLog]",
							"storedProcedureParameters": {
								"AuditID": {
									"value": {
										"value": "@activity('lkp_ExecStartAuditProc').output.firstRow.AuditID",
										"type": "Expression"
									},
									"type": "Int32"
								},
								"DataLakePath": {
									"value": null,
									"type": "String"
								},
								"PipelineRunID": {
									"value": {
										"value": "@pipeline().RunId",
										"type": "Expression"
									},
									"type": "String"
								},
								"RowsRead": {
									"value": null,
									"type": "Int64"
								},
								"Status": {
									"value": "Stage Proc Failed",
									"type": "String"
								}
							}
						},
						"linkedServiceName": {
							"referenceName": "AzureSqlDatabase1",
							"type": "LinkedServiceReference"
						}
					},
					{
						"name": "Sp_ExecFailureAudit_TL",
						"type": "SqlServerStoredProcedure",
						"dependsOn": [
							{
								"activity": "Execute Pipeline1",
								"dependencyConditions": [
									"Failed"
								]
							}
						],
						"policy": {
							"timeout": "7.00:00:00",
							"retry": 0,
							"retryIntervalInSeconds": 30,
							"secureOutput": false,
							"secureInput": false
						},
						"userProperties": [],
						"typeProperties": {
							"storedProcedureName": "[dbo].[proc_UpdateAuditLog]",
							"storedProcedureParameters": {
								"AuditID": {
									"value": {
										"value": "@activity('lkp_ExecStartAuditProc').output.firstRow.AuditID",
										"type": "Expression"
									},
									"type": "Int32"
								},
								"DataLakePath": {
									"value": null,
									"type": "String"
								},
								"PipelineRunID": {
									"value": {
										"value": "@pipeline().RunId",
										"type": "Expression"
									},
									"type": "String"
								},
								"RowsRead": {
									"value": null,
									"type": "Int64"
								},
								"Status": {
									"value": "Table Laod Failed",
									"type": "String"
								}
							}
						},
						"linkedServiceName": {
							"referenceName": "AzureSqlDatabase1",
							"type": "LinkedServiceReference"
						}
					}
				],
				"policy": {
					"elapsedTimeMetric": {},
					"cancelAfter": {}
				},
				"variables": {
					"ErrorMsg": {
						"type": "String"
					}
				},
				"folder": {
					"name": "Briggs Data Load Theme wise"
				},
				"annotations": [],
				"lastPublishTime": "2022-04-26T12:27:00Z"
			},
			"dependsOn": [
				"[concat(variables('workspaceId'), '/pipelines/PL_Generic_Copy_Commission')]",
				"[concat(variables('workspaceId'), '/datasets/Briggs_MDW')]",
				"[concat(variables('workspaceId'), '/linkedServices/AzureSqlDatabase1')]",
				"[concat(variables('workspaceId'), '/linkedServices/DS_MDW_SP')]"
			]
		},
		{
			"name": "[concat(parameters('workspaceName'), '/PL_Master_Briggs_Customer')]",
			"type": "Microsoft.Synapse/workspaces/pipelines",
			"apiVersion": "2019-06-01-preview",
			"properties": {
				"activities": [
					{
						"name": "Execute Pipeline1",
						"type": "ExecutePipeline",
						"dependsOn": [
							{
								"activity": "lkp_ExecStartAuditProc",
								"dependencyConditions": [
									"Succeeded"
								]
							}
						],
						"userProperties": [],
						"typeProperties": {
							"pipeline": {
								"referenceName": "PL_Generic_Copy_Customer",
								"type": "PipelineReference"
							},
							"waitOnCompletion": true,
							"parameters": {}
						}
					},
					{
						"name": "ReportStageProc",
						"type": "Lookup",
						"dependsOn": [
							{
								"activity": "Execute Pipeline1",
								"dependencyConditions": [
									"Succeeded"
								]
							}
						],
						"policy": {
							"timeout": "7.00:00:00",
							"retry": 0,
							"retryIntervalInSeconds": 30,
							"secureOutput": false,
							"secureInput": false
						},
						"userProperties": [],
						"typeProperties": {
							"source": {
								"type": "AzureSqlSource",
								"sqlReaderQuery": "select  * from dbo.control_table where processsequence = 2 and enableaction = 1 and subjectarea='Report Stage Customer SP'\norder by id",
								"queryTimeout": "02:00:00",
								"partitionOption": "None"
							},
							"dataset": {
								"referenceName": "Briggs_MDW",
								"type": "DatasetReference",
								"parameters": {
									"schema_name": "dbo",
									"table_name": "user"
								}
							},
							"firstRowOnly": false
						}
					},
					{
						"name": "ForEach_Stage",
						"type": "ForEach",
						"dependsOn": [
							{
								"activity": "ReportStageProc",
								"dependencyConditions": [
									"Succeeded"
								]
							}
						],
						"userProperties": [],
						"typeProperties": {
							"items": {
								"value": "@activity('ReportStageProc').output.value",
								"type": "Expression"
							},
							"activities": [
								{
									"name": "Stored procedure1",
									"type": "SqlServerStoredProcedure",
									"dependsOn": [
										{
											"activity": "Start_Table_Audit_Stage",
											"dependencyConditions": [
												"Succeeded"
											]
										}
									],
									"policy": {
										"timeout": "7.00:00:00",
										"retry": 0,
										"retryIntervalInSeconds": 30,
										"secureOutput": false,
										"secureInput": false
									},
									"userProperties": [],
									"typeProperties": {
										"storedProcedureName": {
											"value": "@item().sourcetablename",
											"type": "Expression"
										}
									},
									"linkedServiceName": {
										"referenceName": "DS_MDW_SP",
										"type": "LinkedServiceReference"
									}
								},
								{
									"name": "Start_Table_Audit_Stage",
									"type": "Lookup",
									"dependsOn": [],
									"policy": {
										"timeout": "7.00:00:00",
										"retry": 0,
										"retryIntervalInSeconds": 30,
										"secureOutput": false,
										"secureInput": false
									},
									"userProperties": [],
									"typeProperties": {
										"source": {
											"type": "AzureSqlSource",
											"sqlReaderStoredProcedureName": "[dbo].[proc_StartAuditLog_Briggs]",
											"storedProcedureParameters": {
												"ConfigTableID": {
													"type": "Int32",
													"value": {
														"value": "@item().ID",
														"type": "Expression"
													}
												},
												"DataFactoryName": {
													"type": "String",
													"value": {
														"value": "@pipeline().DataFactory",
														"type": "Expression"
													}
												},
												"ParentAuditID": {
													"type": "Int64",
													"value": {
														"value": "@item().ID",
														"type": "Expression"
													}
												},
												"PipelineName": {
													"type": "String",
													"value": {
														"value": "@pipeline().Pipeline",
														"type": "Expression"
													}
												},
												"PipelineRunID": {
													"type": "String",
													"value": {
														"value": "@pipeline().RunId",
														"type": "Expression"
													}
												},
												"PipelineTriggerID": {
													"type": "String",
													"value": {
														"value": "@pipeline().TriggerId",
														"type": "Expression"
													}
												},
												"PipelineTriggerName": {
													"type": "String",
													"value": {
														"value": "@pipeline().TriggerName",
														"type": "Expression"
													}
												},
												"PipelineTriggerType": {
													"type": "String",
													"value": {
														"value": "@pipeline().TriggerType",
														"type": "Expression"
													}
												},
												"Sourcedb": {
													"type": "String",
													"value": {
														"value": "@item().sourceDB",
														"type": "Expression"
													}
												},
												"sourcetable": {
													"type": "String",
													"value": {
														"value": "@item().SourcetableName",
														"type": "Expression"
													}
												}
											},
											"queryTimeout": "02:00:00",
											"partitionOption": "None"
										},
										"dataset": {
											"referenceName": "Briggs_MDW",
											"type": "DatasetReference",
											"parameters": {
												"schema_name": "dbo",
												"table_name": "user"
											}
										},
										"firstRowOnly": false
									}
								},
								{
									"name": "Success_Audit_Log_Stage",
									"type": "SqlServerStoredProcedure",
									"dependsOn": [
										{
											"activity": "Stored procedure1",
											"dependencyConditions": [
												"Succeeded"
											]
										}
									],
									"policy": {
										"timeout": "7.00:00:00",
										"retry": 0,
										"retryIntervalInSeconds": 30,
										"secureOutput": false,
										"secureInput": false
									},
									"userProperties": [],
									"typeProperties": {
										"storedProcedureName": "[dbo].[proc_UpdateAuditLog_Briggs]",
										"storedProcedureParameters": {
											"ConfigTableID": {
												"value": {
													"value": "@item().ID",
													"type": "Expression"
												},
												"type": "Int32"
											},
											"RowsRead": {
												"value": null,
												"type": "Int64"
											},
											"Status": {
												"value": "Success",
												"type": "String"
											}
										}
									},
									"linkedServiceName": {
										"referenceName": "DS_MDW_SP",
										"type": "LinkedServiceReference"
									}
								},
								{
									"name": "Set variable_Stage",
									"type": "SetVariable",
									"dependsOn": [
										{
											"activity": "Stored procedure1",
											"dependencyConditions": [
												"Failed"
											]
										}
									],
									"userProperties": [],
									"typeProperties": {
										"variableName": "ErrorMsg",
										"value": {
											"value": "@activity('Stored procedure1').Error.Message",
											"type": "Expression"
										}
									}
								},
								{
									"name": "Failure_Audit_Log_Stage",
									"type": "SqlServerStoredProcedure",
									"dependsOn": [
										{
											"activity": "Set variable_Stage",
											"dependencyConditions": [
												"Succeeded"
											]
										}
									],
									"policy": {
										"timeout": "7.00:00:00",
										"retry": 0,
										"retryIntervalInSeconds": 30,
										"secureOutput": false,
										"secureInput": false
									},
									"userProperties": [],
									"typeProperties": {
										"storedProcedureName": "[dbo].[proc_UpdateAuditLog_Briggs]",
										"storedProcedureParameters": {
											"ConfigTableID": {
												"value": {
													"value": "@item().ID",
													"type": "Expression"
												},
												"type": "Int32"
											},
											"RowsRead": {
												"value": null,
												"type": "Int64"
											},
											"Status": {
												"value": {
													"value": "@variables('ErrorMsg')",
													"type": "Expression"
												},
												"type": "String"
											}
										}
									},
									"linkedServiceName": {
										"referenceName": "DS_MDW_SP",
										"type": "LinkedServiceReference"
									}
								}
							]
						}
					},
					{
						"name": "ReportFactProc",
						"type": "Lookup",
						"dependsOn": [
							{
								"activity": "ForEach_Stage",
								"dependencyConditions": [
									"Succeeded"
								]
							}
						],
						"policy": {
							"timeout": "7.00:00:00",
							"retry": 0,
							"retryIntervalInSeconds": 30,
							"secureOutput": false,
							"secureInput": false
						},
						"userProperties": [],
						"typeProperties": {
							"source": {
								"type": "AzureSqlSource",
								"sqlReaderQuery": "select  * from dbo.control_table where processsequence = 4 and enableaction = 1 and subjectarea='Report Fact Customer SP'\norder by id",
								"queryTimeout": "02:00:00",
								"partitionOption": "None"
							},
							"dataset": {
								"referenceName": "Briggs_MDW",
								"type": "DatasetReference",
								"parameters": {
									"schema_name": "dbo",
									"table_name": "user"
								}
							},
							"firstRowOnly": false
						}
					},
					{
						"name": "ForEach_Fact",
						"type": "ForEach",
						"dependsOn": [
							{
								"activity": "ReportFactProc",
								"dependencyConditions": [
									"Succeeded"
								]
							}
						],
						"userProperties": [],
						"typeProperties": {
							"items": {
								"value": "@activity('ReportFactProc').output.value",
								"type": "Expression"
							},
							"activities": [
								{
									"name": "Stored procedure",
									"type": "SqlServerStoredProcedure",
									"dependsOn": [
										{
											"activity": "Start_Table_Audit1_Fact",
											"dependencyConditions": [
												"Succeeded"
											]
										}
									],
									"policy": {
										"timeout": "7.00:00:00",
										"retry": 0,
										"retryIntervalInSeconds": 30,
										"secureOutput": false,
										"secureInput": false
									},
									"userProperties": [],
									"typeProperties": {
										"storedProcedureName": {
											"value": "@item().sourcetablename",
											"type": "Expression"
										}
									},
									"linkedServiceName": {
										"referenceName": "DS_MDW_SP",
										"type": "LinkedServiceReference"
									}
								},
								{
									"name": "Start_Table_Audit1_Fact",
									"type": "Lookup",
									"dependsOn": [],
									"policy": {
										"timeout": "7.00:00:00",
										"retry": 0,
										"retryIntervalInSeconds": 30,
										"secureOutput": false,
										"secureInput": false
									},
									"userProperties": [],
									"typeProperties": {
										"source": {
											"type": "AzureSqlSource",
											"sqlReaderStoredProcedureName": "[dbo].[proc_StartAuditLog_Briggs]",
											"storedProcedureParameters": {
												"ConfigTableID": {
													"type": "Int32",
													"value": {
														"value": "@item().ID",
														"type": "Expression"
													}
												},
												"DataFactoryName": {
													"type": "String",
													"value": {
														"value": "@pipeline().DataFactory",
														"type": "Expression"
													}
												},
												"ParentAuditID": {
													"type": "Int64",
													"value": {
														"value": "@item().ID",
														"type": "Expression"
													}
												},
												"PipelineName": {
													"type": "String",
													"value": {
														"value": "@pipeline().Pipeline",
														"type": "Expression"
													}
												},
												"PipelineRunID": {
													"type": "String",
													"value": {
														"value": "@pipeline().RunId",
														"type": "Expression"
													}
												},
												"PipelineTriggerID": {
													"type": "String",
													"value": {
														"value": "@pipeline().TriggerId",
														"type": "Expression"
													}
												},
												"PipelineTriggerName": {
													"type": "String",
													"value": {
														"value": "@pipeline().TriggerName",
														"type": "Expression"
													}
												},
												"PipelineTriggerType": {
													"type": "String",
													"value": {
														"value": "@pipeline().TriggerType",
														"type": "Expression"
													}
												},
												"Sourcedb": {
													"type": "String",
													"value": {
														"value": "@item().sourceDB",
														"type": "Expression"
													}
												},
												"sourcetable": {
													"type": "String",
													"value": {
														"value": "@item().SourcetableName",
														"type": "Expression"
													}
												}
											},
											"queryTimeout": "02:00:00",
											"partitionOption": "None"
										},
										"dataset": {
											"referenceName": "Briggs_MDW",
											"type": "DatasetReference",
											"parameters": {
												"schema_name": "dbo",
												"table_name": "user"
											}
										},
										"firstRowOnly": false
									}
								},
								{
									"name": "Success_Audit_Log2_Fact",
									"type": "SqlServerStoredProcedure",
									"dependsOn": [
										{
											"activity": "Stored procedure",
											"dependencyConditions": [
												"Succeeded"
											]
										}
									],
									"policy": {
										"timeout": "7.00:00:00",
										"retry": 0,
										"retryIntervalInSeconds": 30,
										"secureOutput": false,
										"secureInput": false
									},
									"userProperties": [],
									"typeProperties": {
										"storedProcedureName": "[dbo].[proc_UpdateAuditLog_Briggs]",
										"storedProcedureParameters": {
											"ConfigTableID": {
												"value": {
													"value": "@item().ID",
													"type": "Expression"
												},
												"type": "Int32"
											},
											"RowsRead": {
												"value": null,
												"type": "Int64"
											},
											"Status": {
												"value": "Success",
												"type": "String"
											}
										}
									},
									"linkedServiceName": {
										"referenceName": "DS_MDW_SP",
										"type": "LinkedServiceReference"
									}
								},
								{
									"name": "Set variable1_Fact",
									"type": "SetVariable",
									"dependsOn": [
										{
											"activity": "Stored procedure",
											"dependencyConditions": [
												"Failed"
											]
										}
									],
									"userProperties": [],
									"typeProperties": {
										"variableName": "ErrorMsg",
										"value": {
											"value": "@activity('ReportStageProc').Error.Message",
											"type": "Expression"
										}
									}
								},
								{
									"name": "Failure_Audit_Log_Fact",
									"type": "SqlServerStoredProcedure",
									"dependsOn": [
										{
											"activity": "Set variable1_Fact",
											"dependencyConditions": [
												"Succeeded"
											]
										}
									],
									"policy": {
										"timeout": "7.00:00:00",
										"retry": 0,
										"retryIntervalInSeconds": 30,
										"secureOutput": false,
										"secureInput": false
									},
									"userProperties": [],
									"typeProperties": {
										"storedProcedureName": "[dbo].[proc_UpdateAuditLog_Briggs]",
										"storedProcedureParameters": {
											"ConfigTableID": {
												"value": {
													"value": "@item().ID",
													"type": "Expression"
												},
												"type": "Int32"
											},
											"RowsRead": {
												"value": null,
												"type": "Int64"
											},
											"Status": {
												"value": {
													"value": "@variables('ErrorMsg')",
													"type": "Expression"
												},
												"type": "String"
											}
										}
									},
									"linkedServiceName": {
										"referenceName": "DS_MDW_SP",
										"type": "LinkedServiceReference"
									}
								}
							]
						}
					},
					{
						"name": "lkp_ExecStartAuditProc",
						"type": "Lookup",
						"dependsOn": [],
						"policy": {
							"timeout": "7.00:00:00",
							"retry": 0,
							"retryIntervalInSeconds": 30,
							"secureOutput": false,
							"secureInput": false
						},
						"userProperties": [],
						"typeProperties": {
							"source": {
								"type": "AzureSqlSource",
								"sqlReaderStoredProcedureName": "[dbo].[proc_StartAuditLog]",
								"storedProcedureParameters": {
									"ConfigTableID": {
										"type": "Int32",
										"value": "-1"
									},
									"DataFactoryName": {
										"type": "String",
										"value": {
											"value": "@pipeline().DataFactory",
											"type": "Expression"
										}
									},
									"ParentAuditID": {
										"type": "Int64",
										"value": "-1"
									},
									"PipelineName": {
										"type": "String",
										"value": {
											"value": "@pipeline().Pipeline",
											"type": "Expression"
										}
									},
									"PipelineRunID": {
										"type": "String",
										"value": {
											"value": "@pipeline().RunId",
											"type": "Expression"
										}
									},
									"PipelineTriggerID": {
										"type": "String",
										"value": {
											"value": "@pipeline().TriggerId",
											"type": "Expression"
										}
									},
									"PipelineTriggerName": {
										"type": "String",
										"value": {
											"value": "@pipeline().TriggerName",
											"type": "Expression"
										}
									},
									"PipelineTriggerType": {
										"type": "String",
										"value": {
											"value": "@pipeline().TriggerType",
											"type": "Expression"
										}
									}
								},
								"queryTimeout": "02:00:00",
								"partitionOption": "None"
							},
							"dataset": {
								"referenceName": "Briggs_MDW",
								"type": "DatasetReference",
								"parameters": {
									"schema_name": "dbo",
									"table_name": "user"
								}
							}
						}
					},
					{
						"name": "Sp_ExecFailureAudit_Fact",
						"type": "SqlServerStoredProcedure",
						"dependsOn": [
							{
								"activity": "ForEach_Fact",
								"dependencyConditions": [
									"Failed"
								]
							}
						],
						"policy": {
							"timeout": "7.00:00:00",
							"retry": 0,
							"retryIntervalInSeconds": 30,
							"secureOutput": false,
							"secureInput": false
						},
						"userProperties": [],
						"typeProperties": {
							"storedProcedureName": "[dbo].[proc_UpdateAuditLog]",
							"storedProcedureParameters": {
								"AuditID": {
									"value": {
										"value": "@activity('lkp_ExecStartAuditProc').output.firstRow.AuditID",
										"type": "Expression"
									},
									"type": "Int32"
								},
								"DataLakePath": {
									"value": null,
									"type": "String"
								},
								"PipelineRunID": {
									"value": {
										"value": "@pipeline().RunId",
										"type": "Expression"
									},
									"type": "String"
								},
								"RowsRead": {
									"value": null,
									"type": "Int64"
								},
								"Status": {
									"value": "Fact Proc Failed",
									"type": "String"
								}
							}
						},
						"linkedServiceName": {
							"referenceName": "AzureSqlDatabase1",
							"type": "LinkedServiceReference"
						}
					},
					{
						"name": "Sp_ExecSuccessAudit",
						"type": "SqlServerStoredProcedure",
						"dependsOn": [
							{
								"activity": "ForEach_Fact",
								"dependencyConditions": [
									"Succeeded"
								]
							}
						],
						"policy": {
							"timeout": "7.00:00:00",
							"retry": 0,
							"retryIntervalInSeconds": 30,
							"secureOutput": false,
							"secureInput": false
						},
						"userProperties": [],
						"typeProperties": {
							"storedProcedureName": "[dbo].[proc_UpdateAuditLog]",
							"storedProcedureParameters": {
								"AuditID": {
									"value": {
										"value": "@activity('lkp_ExecStartAuditProc').output.firstRow.AuditID",
										"type": "Expression"
									},
									"type": "Int32"
								},
								"DataLakePath": {
									"value": null,
									"type": "String"
								},
								"RowsRead": {
									"value": null,
									"type": "Int64"
								},
								"Status": {
									"value": "Success",
									"type": "String"
								},
								"PipelineRunID": {
									"value": {
										"value": "@pipeline().RunId",
										"type": "Expression"
									},
									"type": "String"
								}
							}
						},
						"linkedServiceName": {
							"referenceName": "AzureSqlDatabase1",
							"type": "LinkedServiceReference"
						}
					},
					{
						"name": "Sp_ExecFailureAudit_Stage",
						"type": "SqlServerStoredProcedure",
						"dependsOn": [
							{
								"activity": "ForEach_Stage",
								"dependencyConditions": [
									"Failed"
								]
							}
						],
						"policy": {
							"timeout": "7.00:00:00",
							"retry": 0,
							"retryIntervalInSeconds": 30,
							"secureOutput": false,
							"secureInput": false
						},
						"userProperties": [],
						"typeProperties": {
							"storedProcedureName": "[dbo].[proc_UpdateAuditLog]",
							"storedProcedureParameters": {
								"AuditID": {
									"value": {
										"value": "@activity('lkp_ExecStartAuditProc').output.firstRow.AuditID",
										"type": "Expression"
									},
									"type": "Int32"
								},
								"DataLakePath": {
									"value": null,
									"type": "String"
								},
								"PipelineRunID": {
									"value": {
										"value": "@pipeline().RunId",
										"type": "Expression"
									},
									"type": "String"
								},
								"RowsRead": {
									"value": null,
									"type": "Int64"
								},
								"Status": {
									"value": "Stage Proc Failed",
									"type": "String"
								}
							}
						},
						"linkedServiceName": {
							"referenceName": "AzureSqlDatabase1",
							"type": "LinkedServiceReference"
						}
					},
					{
						"name": "Sp_ExecFailureAudit_TL",
						"type": "SqlServerStoredProcedure",
						"dependsOn": [
							{
								"activity": "Execute Pipeline1",
								"dependencyConditions": [
									"Failed"
								]
							}
						],
						"policy": {
							"timeout": "7.00:00:00",
							"retry": 0,
							"retryIntervalInSeconds": 30,
							"secureOutput": false,
							"secureInput": false
						},
						"userProperties": [],
						"typeProperties": {
							"storedProcedureName": "[dbo].[proc_UpdateAuditLog]",
							"storedProcedureParameters": {
								"AuditID": {
									"value": {
										"value": "@activity('lkp_ExecStartAuditProc').output.firstRow.AuditID",
										"type": "Expression"
									},
									"type": "Int32"
								},
								"DataLakePath": {
									"value": null,
									"type": "String"
								},
								"PipelineRunID": {
									"value": {
										"value": "@pipeline().RunId",
										"type": "Expression"
									},
									"type": "String"
								},
								"RowsRead": {
									"value": null,
									"type": "Int64"
								},
								"Status": {
									"value": "Table Load Failed",
									"type": "String"
								}
							}
						},
						"linkedServiceName": {
							"referenceName": "AzureSqlDatabase1",
							"type": "LinkedServiceReference"
						}
					}
				],
				"policy": {
					"elapsedTimeMetric": {},
					"cancelAfter": {}
				},
				"variables": {
					"ErrorMsg": {
						"type": "String"
					}
				},
				"folder": {
					"name": "Briggs Data Load Theme wise"
				},
				"annotations": [],
				"lastPublishTime": "2022-04-26T12:27:06Z"
			},
			"dependsOn": [
				"[concat(variables('workspaceId'), '/pipelines/PL_Generic_Copy_Customer')]",
				"[concat(variables('workspaceId'), '/datasets/Briggs_MDW')]",
				"[concat(variables('workspaceId'), '/linkedServices/AzureSqlDatabase1')]",
				"[concat(variables('workspaceId'), '/linkedServices/DS_MDW_SP')]"
			]
		},
		{
			"name": "[concat(parameters('workspaceName'), '/PL_Master_Briggs_Equipment')]",
			"type": "Microsoft.Synapse/workspaces/pipelines",
			"apiVersion": "2019-06-01-preview",
			"properties": {
				"activities": [
					{
						"name": "Execute Pipeline1",
						"type": "ExecutePipeline",
						"dependsOn": [
							{
								"activity": "lkp_ExecStartAuditProc",
								"dependencyConditions": [
									"Succeeded"
								]
							}
						],
						"userProperties": [],
						"typeProperties": {
							"pipeline": {
								"referenceName": "PL_Generic_Copy_Equipment",
								"type": "PipelineReference"
							},
							"waitOnCompletion": true,
							"parameters": {}
						}
					},
					{
						"name": "ReportStageProc",
						"type": "Lookup",
						"dependsOn": [
							{
								"activity": "Execute Pipeline1",
								"dependencyConditions": [
									"Succeeded"
								]
							}
						],
						"policy": {
							"timeout": "7.00:00:00",
							"retry": 0,
							"retryIntervalInSeconds": 30,
							"secureOutput": false,
							"secureInput": false
						},
						"userProperties": [],
						"typeProperties": {
							"source": {
								"type": "AzureSqlSource",
								"sqlReaderQuery": "select  * from dbo.control_table where processsequence = 2 and enableaction = 1 \nand subjectarea='Report Stage Equipment SP'\norder by id",
								"queryTimeout": "02:00:00",
								"partitionOption": "None"
							},
							"dataset": {
								"referenceName": "Briggs_MDW",
								"type": "DatasetReference",
								"parameters": {
									"schema_name": "dbo",
									"table_name": "user"
								}
							},
							"firstRowOnly": false
						}
					},
					{
						"name": "ForEach_Stage",
						"type": "ForEach",
						"dependsOn": [
							{
								"activity": "ReportStageProc",
								"dependencyConditions": [
									"Succeeded"
								]
							}
						],
						"userProperties": [],
						"typeProperties": {
							"items": {
								"value": "@activity('ReportStageProc').output.value",
								"type": "Expression"
							},
							"activities": [
								{
									"name": "Stored procedure1",
									"type": "SqlServerStoredProcedure",
									"dependsOn": [
										{
											"activity": "Start_Table_Audit_Stage",
											"dependencyConditions": [
												"Succeeded"
											]
										}
									],
									"policy": {
										"timeout": "7.00:00:00",
										"retry": 0,
										"retryIntervalInSeconds": 30,
										"secureOutput": false,
										"secureInput": false
									},
									"userProperties": [],
									"typeProperties": {
										"storedProcedureName": {
											"value": "@item().sourcetablename",
											"type": "Expression"
										}
									},
									"linkedServiceName": {
										"referenceName": "DS_MDW_SP",
										"type": "LinkedServiceReference"
									}
								},
								{
									"name": "Start_Table_Audit_Stage",
									"type": "Lookup",
									"dependsOn": [],
									"policy": {
										"timeout": "7.00:00:00",
										"retry": 0,
										"retryIntervalInSeconds": 30,
										"secureOutput": false,
										"secureInput": false
									},
									"userProperties": [],
									"typeProperties": {
										"source": {
											"type": "AzureSqlSource",
											"sqlReaderStoredProcedureName": "[dbo].[proc_StartAuditLog_Briggs]",
											"storedProcedureParameters": {
												"ConfigTableID": {
													"type": "Int32",
													"value": {
														"value": "@item().ID",
														"type": "Expression"
													}
												},
												"DataFactoryName": {
													"type": "String",
													"value": {
														"value": "@pipeline().DataFactory",
														"type": "Expression"
													}
												},
												"ParentAuditID": {
													"type": "Int64",
													"value": {
														"value": "@item().ID",
														"type": "Expression"
													}
												},
												"PipelineName": {
													"type": "String",
													"value": {
														"value": "@pipeline().Pipeline",
														"type": "Expression"
													}
												},
												"PipelineRunID": {
													"type": "String",
													"value": {
														"value": "@pipeline().RunId",
														"type": "Expression"
													}
												},
												"PipelineTriggerID": {
													"type": "String",
													"value": {
														"value": "@pipeline().TriggerId",
														"type": "Expression"
													}
												},
												"PipelineTriggerName": {
													"type": "String",
													"value": {
														"value": "@pipeline().TriggerName",
														"type": "Expression"
													}
												},
												"PipelineTriggerType": {
													"type": "String",
													"value": {
														"value": "@pipeline().TriggerType",
														"type": "Expression"
													}
												},
												"Sourcedb": {
													"type": "String",
													"value": {
														"value": "@item().sourceDB",
														"type": "Expression"
													}
												},
												"sourcetable": {
													"type": "String",
													"value": {
														"value": "@item().SourcetableName",
														"type": "Expression"
													}
												}
											},
											"queryTimeout": "02:00:00",
											"partitionOption": "None"
										},
										"dataset": {
											"referenceName": "Briggs_MDW",
											"type": "DatasetReference",
											"parameters": {
												"schema_name": "dbo",
												"table_name": "user"
											}
										},
										"firstRowOnly": false
									}
								},
								{
									"name": "Set variable_Stage",
									"type": "SetVariable",
									"dependsOn": [
										{
											"activity": "Stored procedure1",
											"dependencyConditions": [
												"Failed"
											]
										}
									],
									"userProperties": [],
									"typeProperties": {
										"variableName": "ErrorMsg",
										"value": {
											"value": "@activity('Stored procedure1').Error.Message",
											"type": "Expression"
										}
									}
								},
								{
									"name": "Failure_Audit_Log_Stage",
									"type": "SqlServerStoredProcedure",
									"dependsOn": [
										{
											"activity": "Set variable_Stage",
											"dependencyConditions": [
												"Succeeded"
											]
										}
									],
									"policy": {
										"timeout": "7.00:00:00",
										"retry": 0,
										"retryIntervalInSeconds": 30,
										"secureOutput": false,
										"secureInput": false
									},
									"userProperties": [],
									"typeProperties": {
										"storedProcedureName": "[dbo].[proc_UpdateAuditLog_Briggs]",
										"storedProcedureParameters": {
											"ConfigTableID": {
												"value": {
													"value": "@item().ID",
													"type": "Expression"
												},
												"type": "Int32"
											},
											"RowsRead": {
												"value": null,
												"type": "Int64"
											},
											"Status": {
												"value": {
													"value": "@variables('ErrorMsg')",
													"type": "Expression"
												},
												"type": "String"
											}
										}
									},
									"linkedServiceName": {
										"referenceName": "DS_MDW_SP",
										"type": "LinkedServiceReference"
									}
								},
								{
									"name": "Success_Audit_Log_Stage",
									"type": "SqlServerStoredProcedure",
									"dependsOn": [
										{
											"activity": "Stored procedure1",
											"dependencyConditions": [
												"Succeeded"
											]
										}
									],
									"policy": {
										"timeout": "7.00:00:00",
										"retry": 0,
										"retryIntervalInSeconds": 30,
										"secureOutput": false,
										"secureInput": false
									},
									"userProperties": [],
									"typeProperties": {
										"storedProcedureName": "[dbo].[proc_UpdateAuditLog_Briggs]",
										"storedProcedureParameters": {
											"ConfigTableID": {
												"value": {
													"value": "@item().ID",
													"type": "Expression"
												},
												"type": "Int32"
											},
											"RowsRead": {
												"value": null,
												"type": "Int64"
											},
											"Status": {
												"value": "Success",
												"type": "String"
											}
										}
									},
									"linkedServiceName": {
										"referenceName": "DS_MDW_SP",
										"type": "LinkedServiceReference"
									}
								}
							]
						}
					},
					{
						"name": "ReportFactProc",
						"type": "Lookup",
						"dependsOn": [
							{
								"activity": "ForEach_Stage",
								"dependencyConditions": [
									"Succeeded"
								]
							},
							{
								"activity": "Stage Equipment VM does not match Fin Dim",
								"dependencyConditions": [
									"Succeeded"
								]
							},
							{
								"activity": "Stage_Equipment_Pipeline_Backlog",
								"dependencyConditions": [
									"Succeeded"
								]
							},
							{
								"activity": "Stage_Equipment_Invoice_Search",
								"dependencyConditions": [
									"Succeeded"
								]
							},
							{
								"activity": "Stage_Equipment_PO",
								"dependencyConditions": [
									"Succeeded"
								]
							}
						],
						"policy": {
							"timeout": "7.00:00:00",
							"retry": 0,
							"retryIntervalInSeconds": 30,
							"secureOutput": false,
							"secureInput": false
						},
						"userProperties": [],
						"typeProperties": {
							"source": {
								"type": "AzureSqlSource",
								"sqlReaderQuery": "select  * from dbo.control_table where processsequence = 4 and enableaction = 1 \nand subjectarea='Report Fact Equipment SP'\norder by id",
								"queryTimeout": "02:00:00",
								"partitionOption": "None"
							},
							"dataset": {
								"referenceName": "Briggs_MDW",
								"type": "DatasetReference",
								"parameters": {
									"schema_name": "dbo",
									"table_name": "user"
								}
							},
							"firstRowOnly": false
						}
					},
					{
						"name": "ForEach_Fact",
						"type": "ForEach",
						"dependsOn": [
							{
								"activity": "ReportFactProc",
								"dependencyConditions": [
									"Succeeded"
								]
							}
						],
						"userProperties": [],
						"typeProperties": {
							"items": {
								"value": "@activity('ReportFactProc').output.value",
								"type": "Expression"
							},
							"activities": [
								{
									"name": "Stored procedure",
									"type": "SqlServerStoredProcedure",
									"dependsOn": [
										{
											"activity": "Start_Table_Audit1_Fact",
											"dependencyConditions": [
												"Succeeded"
											]
										}
									],
									"policy": {
										"timeout": "7.00:00:00",
										"retry": 0,
										"retryIntervalInSeconds": 30,
										"secureOutput": false,
										"secureInput": false
									},
									"userProperties": [],
									"typeProperties": {
										"storedProcedureName": {
											"value": "@item().sourcetablename",
											"type": "Expression"
										}
									},
									"linkedServiceName": {
										"referenceName": "DS_MDW_SP",
										"type": "LinkedServiceReference"
									}
								},
								{
									"name": "Start_Table_Audit1_Fact",
									"type": "Lookup",
									"dependsOn": [],
									"policy": {
										"timeout": "7.00:00:00",
										"retry": 0,
										"retryIntervalInSeconds": 30,
										"secureOutput": false,
										"secureInput": false
									},
									"userProperties": [],
									"typeProperties": {
										"source": {
											"type": "AzureSqlSource",
											"sqlReaderStoredProcedureName": "[dbo].[proc_StartAuditLog_Briggs]",
											"storedProcedureParameters": {
												"ConfigTableID": {
													"type": "Int32",
													"value": {
														"value": "@item().ID",
														"type": "Expression"
													}
												},
												"DataFactoryName": {
													"type": "String",
													"value": {
														"value": "@pipeline().DataFactory",
														"type": "Expression"
													}
												},
												"ParentAuditID": {
													"type": "Int64",
													"value": {
														"value": "@item().ID",
														"type": "Expression"
													}
												},
												"PipelineName": {
													"type": "String",
													"value": {
														"value": "@pipeline().Pipeline",
														"type": "Expression"
													}
												},
												"PipelineRunID": {
													"type": "String",
													"value": {
														"value": "@pipeline().RunId",
														"type": "Expression"
													}
												},
												"PipelineTriggerID": {
													"type": "String",
													"value": {
														"value": "@pipeline().TriggerId",
														"type": "Expression"
													}
												},
												"PipelineTriggerName": {
													"type": "String",
													"value": {
														"value": "@pipeline().TriggerName",
														"type": "Expression"
													}
												},
												"PipelineTriggerType": {
													"type": "String",
													"value": {
														"value": "@pipeline().TriggerType",
														"type": "Expression"
													}
												},
												"Sourcedb": {
													"type": "String",
													"value": {
														"value": "@item().sourceDB",
														"type": "Expression"
													}
												},
												"sourcetable": {
													"type": "String",
													"value": {
														"value": "@item().SourcetableName",
														"type": "Expression"
													}
												}
											},
											"queryTimeout": "02:00:00",
											"partitionOption": "None"
										},
										"dataset": {
											"referenceName": "Briggs_MDW",
											"type": "DatasetReference",
											"parameters": {
												"schema_name": "dbo",
												"table_name": "user"
											}
										},
										"firstRowOnly": false
									}
								},
								{
									"name": "Set variable1_Fact",
									"type": "SetVariable",
									"dependsOn": [
										{
											"activity": "Stored procedure",
											"dependencyConditions": [
												"Failed"
											]
										}
									],
									"userProperties": [],
									"typeProperties": {
										"variableName": "ErrorMsg",
										"value": {
											"value": "@activity('ReportStageProc').Error.Message",
											"type": "Expression"
										}
									}
								},
								{
									"name": "Failure_Audit_Log_Fact",
									"type": "SqlServerStoredProcedure",
									"dependsOn": [
										{
											"activity": "Set variable1_Fact",
											"dependencyConditions": [
												"Succeeded"
											]
										}
									],
									"policy": {
										"timeout": "7.00:00:00",
										"retry": 0,
										"retryIntervalInSeconds": 30,
										"secureOutput": false,
										"secureInput": false
									},
									"userProperties": [],
									"typeProperties": {
										"storedProcedureName": "[dbo].[proc_UpdateAuditLog_Briggs]",
										"storedProcedureParameters": {
											"ConfigTableID": {
												"value": {
													"value": "@item().ID",
													"type": "Expression"
												},
												"type": "Int32"
											},
											"RowsRead": {
												"value": null,
												"type": "Int64"
											},
											"Status": {
												"value": {
													"value": "@variables('ErrorMsg')",
													"type": "Expression"
												},
												"type": "String"
											}
										}
									},
									"linkedServiceName": {
										"referenceName": "DS_MDW_SP",
										"type": "LinkedServiceReference"
									}
								},
								{
									"name": "Success_Audit_Log2_Fact",
									"type": "SqlServerStoredProcedure",
									"dependsOn": [
										{
											"activity": "Stored procedure",
											"dependencyConditions": [
												"Succeeded"
											]
										}
									],
									"policy": {
										"timeout": "7.00:00:00",
										"retry": 0,
										"retryIntervalInSeconds": 30,
										"secureOutput": false,
										"secureInput": false
									},
									"userProperties": [],
									"typeProperties": {
										"storedProcedureName": "[dbo].[proc_UpdateAuditLog_Briggs]",
										"storedProcedureParameters": {
											"ConfigTableID": {
												"value": {
													"value": "@item().ID",
													"type": "Expression"
												},
												"type": "Int32"
											},
											"RowsRead": {
												"value": null,
												"type": "Int64"
											},
											"Status": {
												"value": "Success",
												"type": "String"
											}
										}
									},
									"linkedServiceName": {
										"referenceName": "DS_MDW_SP",
										"type": "LinkedServiceReference"
									}
								}
							]
						}
					},
					{
						"name": "Stage_Equipment GP Split",
						"type": "Copy",
						"dependsOn": [],
						"policy": {
							"timeout": "7.00:00:00",
							"retry": 0,
							"retryIntervalInSeconds": 30,
							"secureOutput": false,
							"secureInput": false
						},
						"userProperties": [],
						"typeProperties": {
							"source": {
								"type": "SqlServerSource",
								"sqlReaderQuery": "select distinct pij.PROJINVOICEID,cij.invoiceid,st.INVENTLOCATIONID,\n\tst.SALESID,[dbo].[ENUM2STR]('SALESSTATUS',st.SALESSTATUS) 'AgrementStatus',\n\tcij.INVOICEDATE,st.INVOICEACCOUNT 'Acct #',dir.NAME 'Acct Name',\n\tsvc.SVCCALLID,gjae.TRANSACTIONCURRENCYAMOUNT,gje.SUBLEDGERVOUCHER,eq.EQUIPMENTID,\n\teq.INVENTSERIALID,make.MANUFACTURERID,model.TYPEID\n\tfrom GENERALJOURNALENTRY gje \n\tinner join GENERALJOURNALACCOUNTENTRY gjae on gje.RECID = gjae.GENERALJOURNALENTRY\n\tinner join PROJINVOICEJOUR pij on gje.SUBLEDGERVOUCHER = pij.LEDGERVOUCHER\n\tinner join XAP_SVCCALLTABLE svc on svc.RECID = pij.SVCCALLID\n\tinner join XAP_SVCSEGMENTTABLE svcSeg on svcSeg.SVCCALLID = svc.RECID\n\tinner join XAP_EQUIPMENTTABLE eq on eq.RECID = svcSeg.EQUIPMENTID\n\tinner join XAP_MACHINEMANUFACTURER make on eq.MACHINEMANUFACTURER = make.RECID\n\tinner join XAP_MACHINETYPE model on model.RECID = eq.MACHINETYPE\n\tleft join SALESLINE sl on sl.EQUIPMENTID = eq.EQUIPMENTID\n\tleft join SALESTABLE st on sl.SALESID = st.SALESID\n\tleft join CUSTTABLE cus on cus.ACCOUNTNUM = st.INVOICEACCOUNT\n\tleft join DIRPARTYTABLE dir on dir.RECID = cus.party\n\tleft join CUSTINVOICEJOUR cij on cij.SALESID = st.SALESID\n\twhere gjae.LEDGERACCOUNT like '211254%'",
								"queryTimeout": "02:00:00",
								"partitionOption": "None"
							},
							"sink": {
								"type": "AzureSqlSink",
								"preCopyScript": "Truncate table briggs.Stage_Equipment_GP_Split",
								"disableMetricsCollection": false
							},
							"enableStaging": false,
							"translator": {
								"type": "TabularTranslator",
								"mappings": [
									{
										"source": {
											"name": "PROJINVOICEID",
											"type": "String",
											"physicalType": "nvarchar"
										},
										"sink": {
											"name": "PROJINVOICEID",
											"type": "String",
											"physicalType": "String"
										}
									},
									{
										"source": {
											"name": "invoiceid",
											"type": "String",
											"physicalType": "nvarchar"
										},
										"sink": {
											"name": "invoiceid",
											"type": "String",
											"physicalType": "String"
										}
									},
									{
										"source": {
											"name": "INVENTLOCATIONID",
											"type": "String",
											"physicalType": "nvarchar"
										},
										"sink": {
											"name": "INVENTLOCATIONID",
											"type": "String",
											"physicalType": "String"
										}
									},
									{
										"source": {
											"name": "SALESID",
											"type": "String",
											"physicalType": "nvarchar"
										},
										"sink": {
											"name": "SALESID",
											"type": "String",
											"physicalType": "String"
										}
									},
									{
										"source": {
											"name": "AgrementStatus",
											"type": "String",
											"physicalType": "varchar"
										},
										"sink": {
											"name": "AgrementStatus",
											"type": "String",
											"physicalType": "String"
										}
									},
									{
										"source": {
											"name": "INVOICEDATE",
											"type": "DateTime",
											"physicalType": "datetime"
										},
										"sink": {
											"name": "INVOICEDATE",
											"type": "DateTime",
											"physicalType": "DateTime"
										}
									},
									{
										"source": {
											"name": "Acct #",
											"type": "String",
											"physicalType": "nvarchar"
										},
										"sink": {
											"name": "Acct #",
											"type": "String",
											"physicalType": "String"
										}
									},
									{
										"source": {
											"name": "Acct Name",
											"type": "String",
											"physicalType": "nvarchar"
										},
										"sink": {
											"name": "Acct Name",
											"type": "String",
											"physicalType": "String"
										}
									},
									{
										"source": {
											"name": "SVCCALLID",
											"type": "String",
											"physicalType": "nvarchar"
										},
										"sink": {
											"name": "SVCCALLID",
											"type": "String",
											"physicalType": "String"
										}
									},
									{
										"source": {
											"name": "TRANSACTIONCURRENCYAMOUNT",
											"type": "Decimal",
											"physicalType": "decimal",
											"scale": 16,
											"precision": 32
										},
										"sink": {
											"name": "TRANSACTIONCURRENCYAMOUNT",
											"type": "Decimal",
											"physicalType": "Decimal"
										}
									},
									{
										"source": {
											"name": "SUBLEDGERVOUCHER",
											"type": "String",
											"physicalType": "nvarchar"
										},
										"sink": {
											"name": "SUBLEDGERVOUCHER",
											"type": "String",
											"physicalType": "String"
										}
									},
									{
										"source": {
											"name": "EQUIPMENTID",
											"type": "String",
											"physicalType": "nvarchar"
										},
										"sink": {
											"name": "EQUIPMENTID",
											"type": "String",
											"physicalType": "String"
										}
									},
									{
										"source": {
											"name": "INVENTSERIALID",
											"type": "String",
											"physicalType": "nvarchar"
										},
										"sink": {
											"name": "INVENTSERIALID",
											"type": "String",
											"physicalType": "String"
										}
									},
									{
										"source": {
											"name": "MANUFACTURERID",
											"type": "String",
											"physicalType": "nvarchar"
										},
										"sink": {
											"name": "MANUFACTURERID",
											"type": "String",
											"physicalType": "String"
										}
									},
									{
										"source": {
											"name": "TYPEID",
											"type": "String",
											"physicalType": "nvarchar"
										},
										"sink": {
											"name": "TYPEID",
											"type": "String",
											"physicalType": "String"
										}
									}
								],
								"typeConversion": true,
								"typeConversionSettings": {
									"allowDataTruncation": true,
									"treatBooleanAsNumber": false
								}
							}
						},
						"inputs": [
							{
								"referenceName": "Briggs_MST",
								"type": "DatasetReference",
								"parameters": {}
							}
						],
						"outputs": [
							{
								"referenceName": "Briggs_MDW",
								"type": "DatasetReference",
								"parameters": {
									"schema_name": "Briggs",
									"table_name": "Stage_Equipment_GP_Split"
								}
							}
						]
					},
					{
						"name": "Stage_Equipment_PO",
						"type": "Copy",
						"dependsOn": [],
						"policy": {
							"timeout": "7.00:00:00",
							"retry": 0,
							"retryIntervalInSeconds": 30,
							"secureOutput": false,
							"secureInput": false
						},
						"userProperties": [],
						"typeProperties": {
							"source": {
								"type": "SqlServerSource",
								"sqlReaderQuery": "select \n\tddvBranch.DISPLAYVALUE 'belongsto'\n\t,pt.INVENTLOCATIONID 'branch'\n\t,ddvDivision.DISPLAYVALUE 'division'\n\t,oc.ORDERCLASSID\n\t,eq.EQUIPMENTID\n\t,eq.INVENTSERIALID \n\t,make.MANUFACTURERID 'eqMake'\n\t,model.TYPEID 'eqModel'\n\t,eqTech.MACHINEMANUFACTUREYEAR 'eqYear'\n\t,eqGroup.KINDID 'eqGroup'\n\t,[dbo].[ENUM2STR]('xap_fleettype',eq.FLEETTYPE) 'fleetType'\n\t,eq.ITEMID\n\t,pl.NAME\n\t,[dbo].[ENUM2STR]('XAP_AgreementStatus',eq.AGREEMENTSTATUS) 'agreementStatus'\n\t,[dbo].[ENUM2STR]('XAP_PhysicalStatus',eq.PHYSICALSTATUS) 'physicalStatus'\n\t,pt.PURCHID\n\t,[dbo].[ENUM2STR]('PurchStatus',pt.PURCHSTATUS)  'poStatus'\n\t,pt.ORDERACCOUNT 'Vendor #'\n\t,dir.name 'Vendor Name'\n\t,pt.VENDORREF 'Vendor Ref'\n\t,pl.TAXGROUP\n\t,pl.PURCHUNIT\n\t,cast(pl.PURCHPRICE as decimal(10,2)) 'PURCHPRICE'\n\t,cast(pl.LINEDISC as decimal(10,2)) 'LINEDISC'\n\t,cast(pl.LINEPERCENT  as decimal(10,2)) 'LINEPERCENT'\n\t,cast(pl.LINEAMOUNT  as decimal(10,2)) 'LINEAMOUNT'\n\t,pl.CREATEDDATETIME\n\t,eq.MANUFACTUREDATE\n\t,eq.ESTIMATEDRECEIPTDATE\n\t,eq.RECEIVEDDATE\n\t,wrkerName.NAME 'Orderer'\n\t,pl.INVENTREFID\n\t,cust.accountnum\n\t,custName.NAME 'Cust Name',pt.CREATEDDATETIME Created_Date_Time_Fil\nfrom PURCHLINE pl\n\tinner join PURCHTABLE pt on pl.PURCHID = pt.PURCHID\n\tleft join defaultdimensionview ddvBranch on ddvBranch.DEFAULTDIMENSION = pt.DEFAULTDIMENSION and ddvBranch.DIMENSIONATTRIBUTEID = 5637145333\n\tleft join defaultdimensionview ddvDivision on ddvDivision.DEFAULTDIMENSION = pt.DEFAULTDIMENSION and ddvDivision.DIMENSIONATTRIBUTEID = 5637145328\n\tleft join VENDTABLE vt on vt.accountnum = pt.orderaccount\n\tleft join DIRPARTYTABLE dir on vt.party = dir.recid\n\tleft join XAP_ORDERCLASS oc on pt.ORDERCLASSRECID = oc.RECID\n\tleft join XAP_EQUIPMENTTABLE eq on eq.EQUIPMENTID = isnull(pl.EQUIPMENTID,pt.EQUIPMENTID)\n\tleft join XAP_MACHINEMANUFACTURER make on eq.MACHINEMANUFACTURER = make.RECID\n\tleft join XAP_MACHINETYPE model on model.RECID = eq.MACHINETYPE\n\tleft join XAP_EQUIPMENTTECHNICALINFO eqTech on eqTech.EQUIPMENT = eq.RECID\n\tleft join XAP_MACHINEKIND eqGroup on eqGroup.RECID = model.MACHINEKIND\n\tinner join HCMWORKER wrker on pt.WORKERPURCHPLACER = wrker.RECID\n\tinner join DIRPARTYTABLE wrkerName on wrker.PERSON = wrkerName.RECID\n\tleft join SALESTABLE st on st.SALESID = pl.INVENTREFID\n\tleft join CUSTTABLE cust on cust.accountnum = st.CUSTACCOUNT\n\tleft join DIRPARTYTABLE custName on custName.RECID = cust.party\nwhere oc.ORDERCLASSID = 'EQUIPMENT'\n  and pt.PURCHSTATUS <> 4",
								"queryTimeout": "02:00:00",
								"partitionOption": "None"
							},
							"sink": {
								"type": "AzureSqlSink",
								"preCopyScript": "Truncate table briggs.Stage_Equipment_PO",
								"disableMetricsCollection": false
							},
							"enableStaging": false,
							"translator": {
								"type": "TabularTranslator",
								"mappings": [
									{
										"source": {
											"name": "belongsto",
											"type": "String",
											"physicalType": "nvarchar"
										},
										"sink": {
											"name": "belongsto",
											"type": "String",
											"physicalType": "String"
										}
									},
									{
										"source": {
											"name": "branch",
											"type": "String",
											"physicalType": "nvarchar"
										},
										"sink": {
											"name": "branch",
											"type": "String",
											"physicalType": "String"
										}
									},
									{
										"source": {
											"name": "division",
											"type": "String",
											"physicalType": "nvarchar"
										},
										"sink": {
											"name": "division",
											"type": "String",
											"physicalType": "String"
										}
									},
									{
										"source": {
											"name": "ORDERCLASSID",
											"type": "String",
											"physicalType": "nvarchar"
										},
										"sink": {
											"name": "ORDERCLASSID",
											"type": "String",
											"physicalType": "String"
										}
									},
									{
										"source": {
											"name": "EQUIPMENTID",
											"type": "String",
											"physicalType": "nvarchar"
										},
										"sink": {
											"name": "EQUIPMENTID",
											"type": "String",
											"physicalType": "String"
										}
									},
									{
										"source": {
											"name": "INVENTSERIALID",
											"type": "String",
											"physicalType": "nvarchar"
										},
										"sink": {
											"name": "INVENTSERIALID",
											"type": "String",
											"physicalType": "String"
										}
									},
									{
										"source": {
											"name": "eqMake",
											"type": "String",
											"physicalType": "nvarchar"
										},
										"sink": {
											"name": "eqMake",
											"type": "String",
											"physicalType": "String"
										}
									},
									{
										"source": {
											"name": "eqModel",
											"type": "String",
											"physicalType": "nvarchar"
										},
										"sink": {
											"name": "eqModel",
											"type": "String",
											"physicalType": "String"
										}
									},
									{
										"source": {
											"name": "eqYear",
											"type": "Int32",
											"physicalType": "int"
										},
										"sink": {
											"name": "eqYear",
											"type": "Int32",
											"physicalType": "Int32"
										}
									},
									{
										"source": {
											"name": "eqGroup",
											"type": "String",
											"physicalType": "nvarchar"
										},
										"sink": {
											"name": "eqGroup",
											"type": "String",
											"physicalType": "String"
										}
									},
									{
										"source": {
											"name": "fleetType",
											"type": "String",
											"physicalType": "varchar"
										},
										"sink": {
											"name": "fleetType",
											"type": "String",
											"physicalType": "String"
										}
									},
									{
										"source": {
											"name": "ITEMID",
											"type": "String",
											"physicalType": "nvarchar"
										},
										"sink": {
											"name": "ITEMID",
											"type": "String",
											"physicalType": "String"
										}
									},
									{
										"source": {
											"name": "NAME",
											"type": "String",
											"physicalType": "nvarchar"
										},
										"sink": {
											"name": "NAME",
											"type": "String",
											"physicalType": "String"
										}
									},
									{
										"source": {
											"name": "agreementStatus",
											"type": "String",
											"physicalType": "varchar"
										},
										"sink": {
											"name": "agreementStatus",
											"type": "String",
											"physicalType": "String"
										}
									},
									{
										"source": {
											"name": "physicalStatus",
											"type": "String",
											"physicalType": "varchar"
										},
										"sink": {
											"name": "physicalStatus",
											"type": "String",
											"physicalType": "String"
										}
									},
									{
										"source": {
											"name": "PURCHID",
											"type": "String",
											"physicalType": "nvarchar"
										},
										"sink": {
											"name": "PURCHID",
											"type": "String",
											"physicalType": "String"
										}
									},
									{
										"source": {
											"name": "poStatus",
											"type": "String",
											"physicalType": "varchar"
										},
										"sink": {
											"name": "poStatus",
											"type": "String",
											"physicalType": "String"
										}
									},
									{
										"source": {
											"name": "Vendor #",
											"type": "String",
											"physicalType": "nvarchar"
										},
										"sink": {
											"name": "Vendor #",
											"type": "String",
											"physicalType": "String"
										}
									},
									{
										"source": {
											"name": "Vendor Name",
											"type": "String",
											"physicalType": "nvarchar"
										},
										"sink": {
											"name": "Vendor Name",
											"type": "String",
											"physicalType": "String"
										}
									},
									{
										"source": {
											"name": "Vendor Ref",
											"type": "String",
											"physicalType": "nvarchar"
										},
										"sink": {
											"name": "Vendor Ref",
											"type": "String",
											"physicalType": "String"
										}
									},
									{
										"source": {
											"name": "TAXGROUP",
											"type": "String",
											"physicalType": "nvarchar"
										},
										"sink": {
											"name": "TAXGROUP",
											"type": "String",
											"physicalType": "String"
										}
									},
									{
										"source": {
											"name": "PURCHUNIT",
											"type": "String",
											"physicalType": "nvarchar"
										},
										"sink": {
											"name": "PURCHUNIT",
											"type": "String",
											"physicalType": "String"
										}
									},
									{
										"source": {
											"name": "PURCHPRICE",
											"type": "Decimal",
											"physicalType": "decimal",
											"scale": 2,
											"precision": 10
										},
										"sink": {
											"name": "PURCHPRICE",
											"type": "Decimal",
											"physicalType": "Decimal"
										}
									},
									{
										"source": {
											"name": "LINEDISC",
											"type": "Decimal",
											"physicalType": "decimal",
											"scale": 2,
											"precision": 10
										},
										"sink": {
											"name": "LINEDISC",
											"type": "Decimal",
											"physicalType": "Decimal"
										}
									},
									{
										"source": {
											"name": "LINEPERCENT",
											"type": "Decimal",
											"physicalType": "decimal",
											"scale": 2,
											"precision": 10
										},
										"sink": {
											"name": "LINEPERCENT",
											"type": "Decimal",
											"physicalType": "Decimal"
										}
									},
									{
										"source": {
											"name": "LINEAMOUNT",
											"type": "Decimal",
											"physicalType": "decimal",
											"scale": 2,
											"precision": 10
										},
										"sink": {
											"name": "LINEAMOUNT",
											"type": "Decimal",
											"physicalType": "Decimal"
										}
									},
									{
										"source": {
											"name": "CREATEDDATETIME",
											"type": "DateTime",
											"physicalType": "datetime"
										},
										"sink": {
											"name": "CREATEDDATETIME",
											"type": "DateTime",
											"physicalType": "DateTime"
										}
									},
									{
										"source": {
											"name": "MANUFACTUREDATE",
											"type": "DateTime",
											"physicalType": "datetime"
										},
										"sink": {
											"name": "MANUFACTUREDATE",
											"type": "DateTime",
											"physicalType": "DateTime"
										}
									},
									{
										"source": {
											"name": "ESTIMATEDRECEIPTDATE",
											"type": "DateTime",
											"physicalType": "datetime"
										},
										"sink": {
											"name": "ESTIMATEDRECEIPTDATE",
											"type": "DateTime",
											"physicalType": "DateTime"
										}
									},
									{
										"source": {
											"name": "RECEIVEDDATE",
											"type": "DateTime",
											"physicalType": "datetime"
										},
										"sink": {
											"name": "RECEIVEDDATE",
											"type": "DateTime",
											"physicalType": "DateTime"
										}
									},
									{
										"source": {
											"name": "Orderer",
											"type": "String",
											"physicalType": "nvarchar"
										},
										"sink": {
											"name": "Orderer",
											"type": "String",
											"physicalType": "String"
										}
									},
									{
										"source": {
											"name": "INVENTREFID",
											"type": "String",
											"physicalType": "nvarchar"
										},
										"sink": {
											"name": "INVENTREFID",
											"type": "String",
											"physicalType": "String"
										}
									},
									{
										"source": {
											"name": "accountnum",
											"type": "String",
											"physicalType": "nvarchar"
										},
										"sink": {
											"name": "accountnum",
											"type": "String",
											"physicalType": "String"
										}
									},
									{
										"source": {
											"name": "Cust Name",
											"type": "String",
											"physicalType": "nvarchar"
										},
										"sink": {
											"name": "Cust Name",
											"type": "String",
											"physicalType": "String"
										}
									},
									{
										"source": {
											"name": "Created_Date_Time_Fil",
											"type": "DateTime",
											"physicalType": "datetime"
										},
										"sink": {
											"name": "Created_Date_Time_Fil",
											"type": "DateTime",
											"physicalType": "DateTime"
										}
									}
								],
								"typeConversion": true,
								"typeConversionSettings": {
									"allowDataTruncation": true,
									"treatBooleanAsNumber": false
								}
							}
						},
						"inputs": [
							{
								"referenceName": "Briggs_MST",
								"type": "DatasetReference",
								"parameters": {}
							}
						],
						"outputs": [
							{
								"referenceName": "Briggs_MDW",
								"type": "DatasetReference",
								"parameters": {
									"schema_name": "Briggs",
									"table_name": "Stage_Equipment_PO"
								}
							}
						]
					},
					{
						"name": "Stage Equipment VM does not match Fin Dim",
						"type": "Copy",
						"dependsOn": [
							{
								"activity": "Stage_Equipment_On_Rent",
								"dependencyConditions": [
									"Succeeded"
								]
							}
						],
						"policy": {
							"timeout": "7.00:00:00",
							"retry": 0,
							"retryIntervalInSeconds": 30,
							"secureOutput": false,
							"secureInput": false
						},
						"userProperties": [],
						"typeProperties": {
							"source": {
								"type": "SqlServerSource",
								"sqlReaderQuery": "with valuemodel_Cte(assetid,DEFAULTDIMENSION,recid,rownum)\nas\n(\n\tselect ASSETID,DEFAULTDIMENSION,recid, row_number()over (partition by assetid order by recid desc) 'rn'\n\tfrom ASSETBOOK\n), valuemodel_old_Cte(assetid,DEFAULTDIMENSION,recid,rownum)\nas\n(\n\tselect ASSETID,DEFAULTDIMENSION,recid, row_number()over (partition by assetid order by recid asc) 'rn'\n\tfrom ASSETBOOK\n)\n\n\nselect\teq.EQUIPMENTID\n\t\n\t\t,ddv2.DISPLAYVALUE 'Eq Branch'\n\t\t,fleet.BATCHTEMPLATEID 'Feet'\n\t\t,ab1.BOOKID 'Old Asset BookId'\n\t\t,ab1.assetgroup 'Old Asset Group'\n\t\t,ddv3.DISPLAYVALUE 'Old VM Branch'\n\t\t,abb1.BOOKID 'New Asset BookId'\n\t\t,abb1.assetgroup 'New Asset Group'\n\t\t,ddv.DISPLAYVALUE 'New VM Branch'\n\t\t,[dbo].ENUM2STR('xap_agreementstatus', eq.agreementstatus) 'Agreement Status'\n\t\t,[dbo].ENUM2STR('xap_physicalstatus', eq.physicalstatus) 'Physical Status',\n\t\tFORMAT (getdate(), 'MM/dd/yyyy hh:mm:ss') Refresh_Date\nfrom XAP_EQUIPMENTTABLE eq\nINNER JOIN DEFAULTDIMENSIONVIEW ddv2 on ddv2.DEFAULTDIMENSION = eq.DEFAULTDIMENSION and ddv2.DIMENSIONATTRIBUTEID = 5637145333\n\t\tINNER JOIN XAP_MACHINEMANUFACTURER eqMake on eq.MACHINEMANUFACTURER = eqMake.RECID\n\t\tINNER JOIN XAP_MACHINETYPE eqModel on eq.MACHINETYPE = eqModel.RECID\nINNER JOIN valuemodel_Cte ab on ab.ASSETID = eq.EQUIPMENTID and ab.rownum = 1\nINNER JOIN DEFAULTDIMENSIONVIEW ddv on ddv.DEFAULTDIMENSION = ab.DEFAULTDIMENSION and ddv.DIMENSIONATTRIBUTEID = 5637145333\nleft join XAP_FLEETBATCHRELATION fleet on fleet.FLEETTYPE = eq.FLEETTYPE and fleet.DATAAREAID = 'BRG'\nleft join assetbook ab1 on ab1.recid = ab.recid\n\nleft JOIN valuemodel_old_Cte abb on abb.ASSETID = eq.EQUIPMENTID and abb.rownum = 1\nleft join assetbook abb1 on abb1.recid = abb.recid\nINNER JOIN DEFAULTDIMENSIONVIEW ddv3 on ddv3.DEFAULTDIMENSION = abb.DEFAULTDIMENSION and ddv3.DIMENSIONATTRIBUTEID = 5637145333\nwhere  ddv.DISPLAYVALUE <> ddv2.DISPLAYVALUE\nand fleet.BATCHTEMPLATEID  <> 'Customer'",
								"queryTimeout": "02:00:00",
								"partitionOption": "None"
							},
							"sink": {
								"type": "AzureSqlSink",
								"preCopyScript": "Truncate table briggs.Stage_Equipment_VM",
								"disableMetricsCollection": false
							},
							"enableStaging": false,
							"translator": {
								"type": "TabularTranslator",
								"mappings": [
									{
										"source": {
											"name": "EQUIPMENTID",
											"type": "String",
											"physicalType": "nvarchar"
										},
										"sink": {
											"name": "EQUIPMENTID",
											"type": "String",
											"physicalType": "nvarchar"
										}
									},
									{
										"source": {
											"name": "Eq Branch",
											"type": "String",
											"physicalType": "nvarchar"
										},
										"sink": {
											"name": "Eq Branch",
											"type": "String",
											"physicalType": "nvarchar"
										}
									},
									{
										"source": {
											"name": "Feet",
											"type": "String",
											"physicalType": "nvarchar"
										},
										"sink": {
											"name": "Feet",
											"type": "String",
											"physicalType": "nvarchar"
										}
									},
									{
										"source": {
											"name": "Old Asset BookId",
											"type": "String",
											"physicalType": "nvarchar"
										},
										"sink": {
											"name": "Old Asset BookId",
											"type": "String",
											"physicalType": "nvarchar"
										}
									},
									{
										"source": {
											"name": "Old Asset Group",
											"type": "String",
											"physicalType": "nvarchar"
										},
										"sink": {
											"name": "Old Asset Group",
											"type": "String",
											"physicalType": "nvarchar"
										}
									},
									{
										"source": {
											"name": "Old VM Branch",
											"type": "String",
											"physicalType": "nvarchar"
										},
										"sink": {
											"name": "Old VM Branch",
											"type": "String",
											"physicalType": "nvarchar"
										}
									},
									{
										"source": {
											"name": "New Asset BookId",
											"type": "String",
											"physicalType": "nvarchar"
										},
										"sink": {
											"name": "New Asset BookId",
											"type": "String",
											"physicalType": "nvarchar"
										}
									},
									{
										"source": {
											"name": "New Asset Group",
											"type": "String",
											"physicalType": "nvarchar"
										},
										"sink": {
											"name": "New Asset Group",
											"type": "String",
											"physicalType": "nvarchar"
										}
									},
									{
										"source": {
											"name": "New VM Branch",
											"type": "String",
											"physicalType": "nvarchar"
										},
										"sink": {
											"name": "New VM Branch",
											"type": "String",
											"physicalType": "nvarchar"
										}
									},
									{
										"source": {
											"name": "Agreement Status",
											"type": "String",
											"physicalType": "varchar"
										},
										"sink": {
											"name": "Agreement Status",
											"type": "String",
											"physicalType": "varchar"
										}
									},
									{
										"source": {
											"name": "Physical Status",
											"type": "String",
											"physicalType": "varchar"
										},
										"sink": {
											"name": "Physical Status",
											"type": "String",
											"physicalType": "varchar"
										}
									},
									{
										"source": {
											"name": "Refresh_Date",
											"type": "String",
											"physicalType": "nvarchar"
										},
										"sink": {
											"name": "Refresh_Date",
											"type": "String",
											"physicalType": "nvarchar"
										}
									}
								],
								"typeConversion": true,
								"typeConversionSettings": {
									"allowDataTruncation": true,
									"treatBooleanAsNumber": false
								}
							}
						},
						"inputs": [
							{
								"referenceName": "Briggs_MST",
								"type": "DatasetReference",
								"parameters": {}
							}
						],
						"outputs": [
							{
								"referenceName": "Briggs_MDW",
								"type": "DatasetReference",
								"parameters": {
									"schema_name": "Briggs",
									"table_name": "Stage_Equipment_VM"
								}
							}
						]
					},
					{
						"name": "Stage_Equipment_Invoice_Search",
						"type": "Copy",
						"dependsOn": [],
						"policy": {
							"timeout": "7.00:00:00",
							"retry": 0,
							"retryIntervalInSeconds": 30,
							"secureOutput": false,
							"secureInput": false
						},
						"userProperties": [],
						"typeProperties": {
							"source": {
								"type": "SqlServerSource",
								"sqlReaderQuery": "Declare @cte table (\n\tunit_num varchar(30),\n\tprice real,\n\tacct varchar(20),\n\tinvoiceid varchar(20))\n\n;Declare @contact table (\n\tcustnumber varchar(20)\n\t,fullname varchar(100)\n\t,phone varchar(100)\n\t,email varchar(100))\n\n\ninsert into @cte\n\tselect finEq.DISPLAYVALUE,sum(a.TRANSACTIONCURRENCYAMOUNT),finAcct.DISPLAYVALUE,b.DOCUMENTNUMBER\n\tfrom GENERALJOURNALACCOUNTENTRY a \n\tinner join GENERALJOURNALENTRY b on a.GENERALJOURNALENTRY = b.RECID \n\tinner join DIMENSIONATTRIBUTELEVELVALUEVIEW finEq \n\t\t\ton\tfinEq.VALUECOMBINATIONRECID = a.LEDGERDIMENSION \n\t\t\tand finEq.DIMENSIONATTRIBUTE = 5637145329\n\tinner join DIMENSIONATTRIBUTELEVELVALUEVIEW finAcct \n\t\t\ton finAcct.VALUECOMBINATIONRECID = a.LEDGERDIMENSION \n\t\t\tand finAcct.DIMENSIONATTRIBUTE = 5637144583 \n\t\t\tand finAcct.DISPLAYVALUE in ('400100','400110','400120','400130','400131','500100','500110','500120','500125','500126')\n\n\tgroup by finEq.DISPLAYVALUE,finAcct.DISPLAYVALUE,b.DOCUMENTNUMBER\n\t\n\t\n\t\n\n;insert into @contact\n\tselect\n\tsc.CUSTACCOUNT\n\t,case when sc.AUTHORIZERNAME = '' then sc.CONTACTPERSONNAME\n\t\telse sc.AUTHORIZERNAME end as 'Authorizer Contact'\n\t,sc.AUTHORIZERPHONE\n\t,sc.AUTHORIZEREMAIL\n\tfrom XAP_SVCCALLTABLE sc\n\tinner join \n\t(select\n\tsct.CUSTACCOUNT 'acct'\n\t,max(sct.CREATEDDATETIME) 'max_date'\n\tfrom XAP_SVCCALLTABLE sct\n\tleft join XAP_SVCCALLTYPETABLE sctype on sctype.RECID = sct.CALLTYPEID\n\twhere sct.AUTHORIZER <> '' OR sct.AUTHORIZERNAME <> ''\n\tand sctype.CALLTYPEID in ('Fleet','GM','PM','Quote / Dispatch', 'Quote / CCR', 'Regular', 'Tires', 'Warranty')\n\t--and sct.CUSTACCOUNT = 'C2032883'\n\tgroup by sct.CUSTACCOUNT\n\t) a on a.acct = sc.CUSTACCOUNT and a.max_date = sc.CREATEDDATETIME\n\n\n\n;with SalesPeople_CTE (name,branch,[type],[plan],recid,WorkerId,territory,salesplan)\nas\n(\n\tSELECT \n\t\tdir.name,\n\t\tcsp.PARS as 'branch',\n\t\tcspt.description 'Type', \n\t\tcase \n\t\t\twhen \tcspt.SALESPERSONTYPE in (7,8,9) then 'A'\n\t\t\twhen \tcspt.SALESPERSONTYPE in (1,2,3) then 'B'\n\t\t\telse 'C'\n\t\tend as 'plan',\n\t\tcsp.RECID,\n\t\twrker.PERSONNELNUMBER,\n\t\tcsp.SALESMANCODE,\n\t\tcspt.SALESPERSONTYPE\n\t\t\n\tFROM  XAP_CRMSALESPERSON csp\n\t\tINNER JOIN XAP_CRMSALESPERSONTYPE cspt on csp.SALESPERSONTYPE = cspt.RECID and cspt.dataareaid = 'brg' and cspt.partition = 5637144576\n\t\tINNER JOIN HCMWORKER wrker on csp.WORKER = wrker.RECID\n\t\tINNER JOIN DIRPARTYTABLE dir on wrker.PERSON = dir.RECID\n\t\twhere  csp.dataareaid = 'brg' and csp.partition = 5637144576\n)\n\nselect isnull(salesperson.name,'*NO SALESPERSON*') 'SalesPerson1' ,\n\tsalesperson.branch,\n\tsalesperson.[type],\n\tsalesperson.[plan],\n\tsalesperson.WorkerId,\n\tsalesperson.territory,\n\tsalesperson.salesplan,\n--/SalesPerson\n\tcit.ORIGSALESID,\n\tcij.INVOICEID,\n\tinvBranch.DISPLAYVALUE 'InvoiceBranch',\n\tcij.ORDERACCOUNT,\n\tdirOrder.NAME 'OrderCustName',\n\tcij.INVOICEACCOUNT,\n\tdirInvoice.NAME 'InvCustName',\n\toc.ORDERCLASSID,\n\tcit.LINENUM,\n\t--cit.qty,\n\teq.EQUIPMENTID,\n\tinvdim.INVENTBATCHID,\n\tcast(isnull(eqPrice.price,0)*-1 as decimal(20,2)) 'SalePrice',\n\tcast(isnull(eqCost.price,0)as decimal(20,2)) 'AcqPrice',\n\tcast((isnull(eqPrice.price,0) *-1) - isnull(eqCost.price,0)as decimal(20,2)) 'GP',\n\teq.INVENTSERIALID 'serial',\n\teqMake.MANUFACTURERID 'make',\n\teqType.TYPEID 'model',\n\teq.ITEMID,\n\teq.orderdate,\n\tcit.INVOICEDATE\n\t,cast(eqFin.ADDITIONALCOST as decimal(10,2)) 'estPurchPrice'\n\t,cast(eqFin.NEWPRICE  as decimal(10,2)) 'estNewPrice'\n\t,cast((eqFin.NEWPRICE - eqFin.ADDITIONALCOST) as decimal(10,2)) 'estGP'\n\t,eqTech.MACHINEMANUFACTUREYEAR\n\t,replace(replace(lpa.STREET,char(10),''),char(13),'') 'Street'\n\t,lpa.CITY\n\t,lpa.STATE\n\t,lpa.ZIPCODE\n\t,case when crmterr.ZipCode is null then 'Out of Territory' else 'In Territory' end as 'Footprint Status'\n\t,tbl_con.fullname 'Svc Authorizer-Contact'\n\t,tbl_con.phone 'Auth Phone'\n\t,tbl_con.email 'Auth E-mail' \nFROM CUSTINVOICETRANS cit\n\tINNER JOIN  CUSTINVOICEJOUR cij on cit.INVOICEID = cij.INVOICEID\n\tINNER JOIN XAP_ORDERCLASS oc on cij.ORDERCLASS = oc.RECID\n\tLEFT JOIN SalesPeople_CTE salesperson on cij.SALESPERSON1 = salesperson.RECID\n\tLEFT JOIN XAP_INVOICESCHEDULELINE isl  on isl.RECID =cit.INVOICESCHEDULELINE\n\tLEFT JOIN XAP_EQUIPMENTTABLE eq on cit.EQUIPMENT = eq.RECID\n\t\tLEFT JOIN XAP_MACHINETYPE eqType on  eq.MACHINETYPE = eqType.RECID\n\t\tLEFT JOIN XAP_MACHINEMANUFACTURER eqMake on eqType.MACHINEMANUFACTURER = eqMake.RECID\n\t\tLEFT join XAP_FLEETBATCHRELATION fleettype on fleettype.FLEETTYPE = eq.FLEETTYPE and fleettype.DATAAREAID = cit.DATAAREAID\n\tLEFT JOIN XAP_RENREVENUECATEGORYTABLE renrev on cit.SALESCATEGORY = renrev.SALESCATEGORY\n\tLEFT JOIN @cte eqCost on eqCost.unit_num = eq.EQUIPMENTID and eqCost.invoiceid = cit.INVOICEID and eqCost.acct like '5%'\n\tLEFT JOIN inventdim invdim on invdim.INVENTDIMID = cit.INVENTDIMID\n\tLEFT JOIN @cte eqPrice on eqPrice.unit_num = eq.EQUIPMENTID and eqPrice.invoiceid = cit.INVOICEID and eqPrice.acct like '4%'\n\tLEFT JOIN SALESTABLE salesTable on cij.SALESID = salesTable.SALESID\n\tLEFT JOIN DEFAULTDIMENSIONVIEW invBranch on invBranch.DEFAULTDIMENSION = salesTable.DEFAULTDIMENSION and invBranch.DIMENSIONATTRIBUTEID = 5637145333\n\tLEFT JOIN custtable cusOrder on cij.ORDERACCOUNT = cusOrder.accountnum\n\tLEFT JOIN custtable cusInvoice on cij.INVOICEACCOUNT = cusInvoice.accountnum\n\tLEFT JOIN DIRPARTYTABLE dirOrder on cusOrder.PARTY = dirOrder.RECID\n\tLEFT JOIN DIRPARTYTABLE dirInvoice on cusInvoice.PARTY = dirInvoice.RECID\n\tLEFT join XAP_EQUIPMENTFINANCETABLE eqFin on eqFin.EQUIPMENT = eq.RECID\n\tleft join XAP_EQUIPMENTTECHNICALINFO eqTech on eqTech.EQUIPMENT = eq.RECID\n\tleft join LOGISTICSPOSTALADDRESS lpa on cit.DELIVERYPOSTALADDRESS = lpa.RECID\n\tLEFT JOIN\n\t\t(select distinct\n\t\t\ttar.ZipCode\n\t\t\tfrom BriggsAX.dbo.CRM_TerritoryAssignmentRules tar\n\t\t\twhere tar.crmstatus = 0) crmterr on crmterr.ZipCode = left(lpa.ZipCode,5)\n\tLEFT JOIN @contact tbl_con on tbl_con.custnumber = cij.ORDERACCOUNT\n\twhere oc.ORDERCLASSID = 'EQUIPMENT' \n\tand eq.EQUIPMENTID is not null",
								"queryTimeout": "02:00:00",
								"partitionOption": "None"
							},
							"sink": {
								"type": "AzureSqlSink",
								"preCopyScript": "truncate table briggs.Stage_Equipment_Invoice_Search",
								"disableMetricsCollection": false
							},
							"enableStaging": false,
							"translator": {
								"type": "TabularTranslator",
								"mappings": [
									{
										"source": {
											"name": "SalesPerson1",
											"type": "String",
											"physicalType": "nvarchar"
										},
										"sink": {
											"name": "SalesPerson1",
											"type": "String",
											"physicalType": "String"
										}
									},
									{
										"source": {
											"name": "branch",
											"type": "Int32",
											"physicalType": "int"
										},
										"sink": {
											"name": "branch",
											"type": "Int32",
											"physicalType": "Int32"
										}
									},
									{
										"source": {
											"name": "type",
											"type": "String",
											"physicalType": "nvarchar"
										},
										"sink": {
											"name": "type",
											"type": "String",
											"physicalType": "String"
										}
									},
									{
										"source": {
											"name": "plan",
											"type": "String",
											"physicalType": "varchar"
										},
										"sink": {
											"name": "plan",
											"type": "String",
											"physicalType": "String"
										}
									},
									{
										"source": {
											"name": "WorkerId",
											"type": "String",
											"physicalType": "nvarchar"
										},
										"sink": {
											"name": "WorkerId",
											"type": "String",
											"physicalType": "String"
										}
									},
									{
										"source": {
											"name": "territory",
											"type": "String",
											"physicalType": "nvarchar"
										},
										"sink": {
											"name": "territory",
											"type": "String",
											"physicalType": "String"
										}
									},
									{
										"source": {
											"name": "salesplan",
											"type": "String",
											"physicalType": "nvarchar"
										},
										"sink": {
											"name": "salesplan",
											"type": "String",
											"physicalType": "String"
										}
									},
									{
										"source": {
											"name": "ORIGSALESID",
											"type": "String",
											"physicalType": "nvarchar"
										},
										"sink": {
											"name": "ORIGSALESID",
											"type": "String",
											"physicalType": "String"
										}
									},
									{
										"source": {
											"name": "INVOICEID",
											"type": "String",
											"physicalType": "nvarchar"
										},
										"sink": {
											"name": "INVOICEID",
											"type": "String",
											"physicalType": "String"
										}
									},
									{
										"source": {
											"name": "InvoiceBranch",
											"type": "String",
											"physicalType": "nvarchar"
										},
										"sink": {
											"name": "InvoiceBranch",
											"type": "String",
											"physicalType": "String"
										}
									},
									{
										"source": {
											"name": "ORDERACCOUNT",
											"type": "String",
											"physicalType": "nvarchar"
										},
										"sink": {
											"name": "ORDERACCOUNT",
											"type": "String",
											"physicalType": "String"
										}
									},
									{
										"source": {
											"name": "OrderCustName",
											"type": "String",
											"physicalType": "nvarchar"
										},
										"sink": {
											"name": "OrderCustName",
											"type": "String",
											"physicalType": "String"
										}
									},
									{
										"source": {
											"name": "INVOICEACCOUNT",
											"type": "String",
											"physicalType": "nvarchar"
										},
										"sink": {
											"name": "INVOICEACCOUNT",
											"type": "String",
											"physicalType": "String"
										}
									},
									{
										"source": {
											"name": "InvCustName",
											"type": "String",
											"physicalType": "nvarchar"
										},
										"sink": {
											"name": "InvCustName",
											"type": "String",
											"physicalType": "String"
										}
									},
									{
										"source": {
											"name": "ORDERCLASSID",
											"type": "String",
											"physicalType": "nvarchar"
										},
										"sink": {
											"name": "ORDERCLASSID",
											"type": "String",
											"physicalType": "String"
										}
									},
									{
										"source": {
											"name": "LINENUM",
											"type": "Decimal",
											"physicalType": "decimal",
											"scale": 16,
											"precision": 32
										},
										"sink": {
											"name": "LINENUM",
											"type": "Decimal",
											"physicalType": "Decimal"
										}
									},
									{
										"source": {
											"name": "EQUIPMENTID",
											"type": "String",
											"physicalType": "nvarchar"
										},
										"sink": {
											"name": "EQUIPMENTID",
											"type": "String",
											"physicalType": "String"
										}
									},
									{
										"source": {
											"name": "INVENTBATCHID",
											"type": "String",
											"physicalType": "nvarchar"
										},
										"sink": {
											"name": "INVENTBATCHID",
											"type": "String",
											"physicalType": "String"
										}
									},
									{
										"source": {
											"name": "SalePrice",
											"type": "Decimal",
											"physicalType": "decimal",
											"scale": 2,
											"precision": 20
										},
										"sink": {
											"name": "SalePrice",
											"type": "Decimal",
											"physicalType": "Decimal"
										}
									},
									{
										"source": {
											"name": "AcqPrice",
											"type": "Decimal",
											"physicalType": "decimal",
											"scale": 2,
											"precision": 20
										},
										"sink": {
											"name": "AcqPrice",
											"type": "Decimal",
											"physicalType": "Decimal"
										}
									},
									{
										"source": {
											"name": "GP",
											"type": "Decimal",
											"physicalType": "decimal",
											"scale": 2,
											"precision": 20
										},
										"sink": {
											"name": "GP",
											"type": "Decimal",
											"physicalType": "Decimal"
										}
									},
									{
										"source": {
											"name": "serial",
											"type": "String",
											"physicalType": "nvarchar"
										},
										"sink": {
											"name": "serial",
											"type": "String",
											"physicalType": "String"
										}
									},
									{
										"source": {
											"name": "make",
											"type": "String",
											"physicalType": "nvarchar"
										},
										"sink": {
											"name": "make",
											"type": "String",
											"physicalType": "String"
										}
									},
									{
										"source": {
											"name": "model",
											"type": "String",
											"physicalType": "nvarchar"
										},
										"sink": {
											"name": "model",
											"type": "String",
											"physicalType": "String"
										}
									},
									{
										"source": {
											"name": "ITEMID",
											"type": "String",
											"physicalType": "nvarchar"
										},
										"sink": {
											"name": "ITEMID",
											"type": "String",
											"physicalType": "String"
										}
									},
									{
										"source": {
											"name": "orderdate",
											"type": "DateTime",
											"physicalType": "datetime"
										},
										"sink": {
											"name": "orderdate",
											"type": "DateTime",
											"physicalType": "DateTime"
										}
									},
									{
										"source": {
											"name": "INVOICEDATE",
											"type": "DateTime",
											"physicalType": "datetime"
										},
										"sink": {
											"name": "INVOICEDATE",
											"type": "DateTime",
											"physicalType": "DateTime"
										}
									},
									{
										"source": {
											"name": "estPurchPrice",
											"type": "Decimal",
											"physicalType": "decimal",
											"scale": 2,
											"precision": 10
										},
										"sink": {
											"name": "estPurchPrice",
											"type": "Decimal",
											"physicalType": "Decimal"
										}
									},
									{
										"source": {
											"name": "estNewPrice",
											"type": "Decimal",
											"physicalType": "decimal",
											"scale": 2,
											"precision": 10
										},
										"sink": {
											"name": "estNewPrice",
											"type": "Decimal",
											"physicalType": "Decimal"
										}
									},
									{
										"source": {
											"name": "estGP",
											"type": "Decimal",
											"physicalType": "decimal",
											"scale": 2,
											"precision": 10
										},
										"sink": {
											"name": "estGP",
											"type": "Decimal",
											"physicalType": "Decimal"
										}
									},
									{
										"source": {
											"name": "MACHINEMANUFACTUREYEAR",
											"type": "Int32",
											"physicalType": "int"
										},
										"sink": {
											"name": "MACHINEMANUFACTUREYEAR",
											"type": "Int32",
											"physicalType": "Int32"
										}
									},
									{
										"source": {
											"name": "Street",
											"type": "String",
											"physicalType": "nvarchar"
										},
										"sink": {
											"name": "Street",
											"type": "String",
											"physicalType": "String"
										}
									},
									{
										"source": {
											"name": "CITY",
											"type": "String",
											"physicalType": "nvarchar"
										},
										"sink": {
											"name": "CITY",
											"type": "String",
											"physicalType": "String"
										}
									},
									{
										"source": {
											"name": "STATE",
											"type": "String",
											"physicalType": "nvarchar"
										},
										"sink": {
											"name": "STATE",
											"type": "String",
											"physicalType": "String"
										}
									},
									{
										"source": {
											"name": "ZIPCODE",
											"type": "String",
											"physicalType": "nvarchar"
										},
										"sink": {
											"name": "ZIPCODE",
											"type": "String",
											"physicalType": "String"
										}
									},
									{
										"source": {
											"name": "Footprint Status",
											"type": "String",
											"physicalType": "varchar"
										},
										"sink": {
											"name": "Footprint Status",
											"type": "String",
											"physicalType": "String"
										}
									},
									{
										"source": {
											"name": "Svc Authorizer-Contact",
											"type": "String",
											"physicalType": "varchar"
										},
										"sink": {
											"name": "Svc Authorizer-Contact",
											"type": "String",
											"physicalType": "String"
										}
									},
									{
										"source": {
											"name": "Auth Phone",
											"type": "String",
											"physicalType": "varchar"
										},
										"sink": {
											"name": "Auth Phone",
											"type": "String",
											"physicalType": "String"
										}
									},
									{
										"source": {
											"name": "Auth E-mail",
											"type": "String",
											"physicalType": "varchar"
										},
										"sink": {
											"name": "Auth E-mail",
											"type": "String",
											"physicalType": "String"
										}
									}
								],
								"typeConversion": true,
								"typeConversionSettings": {
									"allowDataTruncation": true,
									"treatBooleanAsNumber": false
								}
							}
						},
						"inputs": [
							{
								"referenceName": "Briggs_MST",
								"type": "DatasetReference",
								"parameters": {}
							}
						],
						"outputs": [
							{
								"referenceName": "Briggs_MDW",
								"type": "DatasetReference",
								"parameters": {
									"schema_name": "Briggs",
									"table_name": "Stage_Equipment_Invoice_Search"
								}
							}
						]
					},
					{
						"name": "Stage_Equipment_Pipeline_Backlog",
						"type": "Copy",
						"dependsOn": [
							{
								"activity": "Stage_Equipment GP Split",
								"dependencyConditions": [
									"Succeeded"
								]
							}
						],
						"policy": {
							"timeout": "7.00:00:00",
							"retry": 0,
							"retryIntervalInSeconds": 30,
							"secureOutput": false,
							"secureInput": false
						},
						"userProperties": [],
						"typeProperties": {
							"source": {
								"type": "SqlServerSource",
								"sqlReaderQuery": "\nwith SalesPeople_CTE (name,branch,[type],[plan],recid,WorkerId,territory,salesplan)\nas\n(\n\tSELECT \n\t\tdir.name,\n\t\tcsp.PARS as 'branch',\n\t\tcspt.description 'Type', \n\t\tcase \n\t\t\twhen \tcspt.SALESPERSONTYPE in (7,8,9) then 'A'\n\t\t\twhen \tcspt.SALESPERSONTYPE in (1,2,3) then 'B'\n\t\t\telse 'C'\n\t\tend as 'plan',\n\t\tcsp.RECID,\n\t\twrker.PERSONNELNUMBER,\n\t\tcsp.SALESMANCODE,\n\t\tcspt.SALESPERSONTYPE\n\t\t\n\tFROM  XAP_CRMSALESPERSON csp\n\t\tINNER JOIN XAP_CRMSALESPERSONTYPE cspt on csp.SALESPERSONTYPE = cspt.RECID\n\t\tINNER JOIN HCMWORKER wrker on csp.WORKER = wrker.RECID\n\t\tINNER JOIN DIRPARTYTABLE dir on wrker.PERSON = dir.RECID\n),svcCte(svcid,eqid)\nas(\n\tselect  min(svcTbl.SVCCALLID)\n\t\t\t,svcTbl.EQUIPMENTID\n\tfrom XAP_SVCCALLTABLE svcTbl\n\tinner join XAP_SVCCALLTYPETABLE svcType on svcTbl.CALLTYPEID = svcType.RECID\n\twhere svcType.CALLTYPEID in ('MAKEREADY','DIRECTSHIP','SHIP OUT')\n\tand svcTbl.EQUIPMENTID <> 0\n\tand svcTbl.CALLOPENSTATUS = 1\n\tgroup by svcTbl.EQUIPMENTID\n),labor_cte\nas(\n\tselect svcCAll.PROJID\n\t,min(pjt.TRANSDATE)'mindate'\n\t,max(pjt.TRANSDATE)'maxdate'\n\tfrom ProjJournalTrans pjt\n\tinner join XAP_SVCSEGMENTTABLE svcSeg on svcSeg.PROJID = pjt.PROJID\n\tinner join XAP_SVCCALLTABLE svcCall on svcCall.RECID = svcSeg.SVCCALLID\n\tleft join projjournaltable pj on pj.JOURNALID = pjt.JOURNALID\n\twhere pj.POSTED = 1\n\tgroup by svcCAll.PROJID\n),last_status as (\n\tselect SVCCALLID 'SvcRecId',max(recid) 'HistRecid'\n\tfrom XAP_SVCCALLHISTORY a\n\twhere a.CHANGETYPE = 2\n\tgroup by SVCCALLID\n)\n\nselect \n\t\tddv.DISPLAYVALUE 'Branch'\n\t\t,st.SALESID\n\t\t,ct.ACCOUNTNUM\n\t\t,dir.NAME\n\t\t,eq.equipmentid Equipment_id\n\t\t,eq.INVENTSERIALID\n,make.MANUFACTURERID\n\t\t,make.MANUFACTURERID 'Make'\n\t\t,model.TYPEID 'Model'\n\t\t,eq.ITEMID\n\t\t,isnull(invdim.INVENTBATCHID,fleettype.BATCHTEMPLATEID) 'Fleet'\n\t\t,fleettype.BATCHTEMPLATEID 'Fleet2'\n\t\t,case when eq.ORDERDATE = '1900-01-01 00:00:00.000' then ''\n\t\t\t else eq.ORDERDATE\n\t\tend 'ORDERDATE'\n\t\t,case when eq.ESTIMATEDRECEIPTDATE = '1900-01-01 00:00:00.000' then ''\n\t\t\t else eq.ESTIMATEDRECEIPTDATE\n\t\tend 'ESTIMATEDRECEIPTDATE'\n\t\t,case when eq.RECEIVEDDATE = '1900-01-01 00:00:00.000' then ''\n\t\t\t else eq.RECEIVEDDATE\n\t\tend 'RECEIVEDDATE'\n\t\t,case when eq.DELIVERYDATE = '1900-01-01 00:00:00.000' then ''\n\t\t\t else eq.DELIVERYDATE\n\t\tend 'DELIVERYDATE'\n\t\t,case\n\t\t\twhen eq.deliverydate <> '1900-01-01 00:00:00.000' then eq.deliverydate\n\t\t\twhen eq.RECEIVEDDATE <> '1900-01-01 00:00:00.000' then case when ddv.DISPLAYVALUE = '106' then dateadd(day,28,eq.RECEIVEDDATE)  else dateadd(day,14,eq.RECEIVEDDATE) end\n\t\t\telse  case when ddv.DISPLAYVALUE = '106' then dateadd(day,28,eq.ESTIMATEDRECEIPTDATE) else dateadd(day,14,eq.ESTIMATEDRECEIPTDATE) end\n\t\t End 'Est_Invoicedate'\n\t\t ,\n\t\t case\n\t\t\twhen eq.deliverydate <> '1900-01-01 00:00:00.000' then eq.deliverydate\n\t\t\twhen eq.RECEIVEDDATE <> '1900-01-01 00:00:00.000' then dateadd(day,14,eq.RECEIVEDDATE)\n\t\t\telse dateadd(day,14,eq.ESTIMATEDRECEIPTDATE)\n\t\t End 'Est_Invoicedate_Salesperson'\n\t\t ,st.ShippingDateRequested 'Est_Invoicedate_GJ'\n\t\t ,sp1.name 'Sales_Person1'\n\t\t ,isnull(sp2.name,'') 'Sales_Person2'\n\t\t,cast(eqFin.ADDITIONALCOST as decimal(10,2)) 'PurchPrice'\n\t\t,cast(eqFin.NEWPRICE  as decimal(10,2)) 'NewPrice'\n\t\t,cast((eqFin.NEWPRICE - eqFin.ADDITIONALCOST) as decimal(10,2)) 'GP'\n\t\t,cast(isnull(comRates.Commission,0) as varchar) + '%-' + isnull(comRates.[type],'NONE') 'Commission_%'\n\t\t,cast(isnull(case \n\t\t\twhen comRates.[type] = 'GP' then (comRates.Commission/100) * (isnull(eqFin.NEWPRICE,0) - isnull(eqFin.ADDITIONALCOST ,0))\n\t\t\twhen comRates.[type] = 'SP' then (comRates.Commission/100) * (eqFin.NEWPRICE )\n\t\tend ,0)  as decimal(10,2)) 'Commission_Payment'\n\t\t,svcCte.svcid\n\t\t,sct.CALLSTATUSID\n\t\t,callType.CALLTYPEID\n\t\t,left(eqTrade.CATUSEDEQNOTE,50) 'Note'\n\t\t,lpa.ZIPCODE 'zip'\n\t\t,replace(replace(lpa.ADDRESS,char(10),' '),char(13),' ') 'ADDRESS'\n\t\t,eqTech.EXTERNALREFERENCE\n\t\t,month(case when eq.ORDERDATE = '1900-01-01 00:00:00.000' then ''\n\t\t\t else eq.ORDERDATE\n\t\tend) 'BookingMonth'\n\t\t,Year(case when eq.ORDERDATE = '1900-01-01 00:00:00.000' then ''\n\t\t\t else eq.ORDERDATE\n\t\tend) 'BookingYear'\n\t\t,DATEPART(QUARTER,(case when eq.ORDERDATE = '1900-01-01 00:00:00.000' then ''\n\t\t\t else eq.ORDERDATE\n\t\tend)) 'BookingQuarter'\n\t\t,ll.mindate\n\t\t,ll.maxdate\n\t\t,makereadyClose.maxCloseDate\n\t\t,st.createddatetime\n\t\t,svcHist.CREATEDDATETIME 'Last Status Change'\n\t\t,dirBt.Name 'InvoiceName'\n\t\t,bt.accountnum 'InvoiceNum',eq.fleettype,oc.ORDERCLASSID,st.SALESSTATUS,st.DATAAREAID , st.PARTITION,\n\t\tct.custgroup\n\t\t\nfrom SALESTABLE st\n\t\tinner join SALESLINE sl on st.SALESID = sl.SALESID --and sl.DATAAREAID = 'BRG' and sl.PARTITION = 5637144576\n\t\tinner join XAP_EQUIPMENTTABLE eq on sl.EQUIPMENTID = eq.EQUIPMENTID --and eq.DATAAREAID = 'BRG' and eq.PARTITION = 5637144576\n\t\tLEFT join XAP_EQUIPMENTFINANCETABLE eqFin on eqFin.EQUIPMENT = eq.RECID --and eqFin.DATAAREAID = 'BRG' and eqFin.PARTITION = 5637144576\n\t\tinner join XAP_FLEETBATCHRELATION fleettype on fleettype.FLEETTYPE = eq.FLEETTYPE and fleettype.DATAAREAID = 'BRG'\n\t\tLEFT join XAP_ORDERCLASS oc on oc.RECID = st.ORDERCLASSRECID --and oc.DATAAREAID = 'BRG' and oc.PARTITION = 5637144576\n\t\tleft join XAP_EQUIPMENTTRADEINFO eqTrade on eqTrade.EQUIPMENT = eq.RECID --and eqTrade.DATAAREAID = 'BRG' and eqTrade.PARTITION = 5637144576\n\t\tleft join XAP_EQUIPMENTTECHNICALINFO eqTech on eqTech.EQUIPMENT = eq.RECID --and eqTech.DATAAREAID = 'BRG' and eqTech.PARTITION = 5637144576\n\t\tLEFT join DEFAULTDIMENSIONVIEW ddv on st.DEFAULTDIMENSION = ddv.DEFAULTDIMENSION and ddv.DIMENSIONATTRIBUTEID =5637145333\n\t\tLEFT join XAP_MACHINEMANUFACTURER make on make.RECID = eq.MACHINEMANUFACTURER --and make.DATAAREAID = 'BRG' and make.PARTITION = 5637144576\n\t\tLEFT join XAP_MACHINETYPE model on model.RECID = eq.MACHINETYPE --and model.DATAAREAID = 'BRG' and model.PARTITION = 5637144576\n\t\tLEFT join SalesPeople_CTE sp1 on sp1.recid = st.SALESPERSON1\n\t\tLEFT join SalesPeople_CTE sp2 on sp2.recid = st.SALESPERSON2\n\t\tLEFT join CUSTTABLE ct on ct.accountnum = st.CUSTACCOUNT --and ct.DATAAREAID = 'BRG' and ct.PARTITION = 5637144576\n\t\tLEFT join CUSTTABLE bt on bt.accountnum = st.INVOICEACCOUNT and bt.DATAAREAID = 'BRG' and bt.PARTITION = 5637144576\n\t\tLEFT join DIRPARTYTABLE dir on dir.RECID = ct.PARTY \n\t\tLEFT join DIRPARTYTABLE dirBt on dirBt.RECID = bt.PARTY \n\t\tLEFT JOIN rrcommissionrates comRates on comRates.item_number = eq.ITEMID \n\t\t\t\t\t\t\t\t\t\t\tand comRates.fleet_type = fleettype.BATCHTEMPLATEID \n\t\t\t\t\t\t\t\t\t\t\tand comRates.orderclass = oc.ORDERCLASSID \n\t\t\t\t\t\t\t\t\t\t\tand comRates.[plan] = sp1.[plan]\n\t\tleft join svcCte svcCte on svcCte.eqid = eq.RECID\n\t\tleft join XAP_SVCCALLTABLE svcT on svcT.SVCCALLID = svcCte.svcid\n\t\tleft join XAP_SVCCALLTYPELINE sct on sct.CALLTYPEID = svcT.CALLTYPEID and sct.RECID = svcT.CALLSTATUS\n\t\tleft join XAP_SVCCALLTYPETABLE callType on svcT.CALLTYPEID = callType.recid\n\t\tleft join DIRPARTYLOCATION dip on dip.PARTY = dir.RECID and dip.ISPRIMARY = 1\n\t\tleft join LOGISTICSPOSTALADDRESS lpa on lpa.LOCATION = dip.LOCATION and lpa.VALIDTO > getdate()\n\t\tleft join [briggs_mst].dbo.CUSTINVOICETRANS cit on cit.EQUIPMENT = eq.RECID\n\t\tLEFT JOIN [briggs_mst].dbo.inventdim invdim on invdim.INVENTDIMID = cit.INVENTDIMID\n\t\tleft join labor_cte ll on ll.PROJID = svcCte.svcid\n\t\tleft join last_status ls on ls.SvcRecId = svcT.recid\n\t\tleft join XAP_SVCCALLHISTORY svcHist on svcHist.RECID = ls.HistRecid\n\t\tleft join (select  max (pij.invoicedate) 'maxCloseDate'\n                            ,pij.svcCallid 'svcCallId'\n                            from PROJINVOICEJOUR pij \n                            group by pij.svcCallid) makereadyClose on makereadyClose.svcCallId = svcT.RECID",
								"queryTimeout": "02:00:00",
								"partitionOption": "None"
							},
							"sink": {
								"type": "AzureSqlSink",
								"preCopyScript": "truncate table briggs.Stage_Equipment_Pipeline_Backlog",
								"disableMetricsCollection": false
							},
							"enableStaging": false,
							"translator": {
								"type": "TabularTranslator",
								"mappings": [
									{
										"source": {
											"name": "Branch",
											"type": "String",
											"physicalType": "nvarchar"
										},
										"sink": {
											"name": "Branch",
											"type": "String",
											"physicalType": "nvarchar"
										}
									},
									{
										"source": {
											"name": "SALESID",
											"type": "String",
											"physicalType": "nvarchar"
										},
										"sink": {
											"name": "SALESID",
											"type": "String",
											"physicalType": "nvarchar"
										}
									},
									{
										"source": {
											"name": "ACCOUNTNUM",
											"type": "String",
											"physicalType": "nvarchar"
										},
										"sink": {
											"name": "ACCOUNTNUM",
											"type": "String",
											"physicalType": "nvarchar"
										}
									},
									{
										"source": {
											"name": "NAME",
											"type": "String",
											"physicalType": "nvarchar"
										},
										"sink": {
											"name": "NAME",
											"type": "String",
											"physicalType": "nvarchar"
										}
									},
									{
										"source": {
											"name": "Equipment_id",
											"type": "String",
											"physicalType": "nvarchar"
										},
										"sink": {
											"name": "Equipment_id",
											"type": "String",
											"physicalType": "nvarchar"
										}
									},
									{
										"source": {
											"name": "INVENTSERIALID",
											"type": "String",
											"physicalType": "nvarchar"
										},
										"sink": {
											"name": "INVENTSERIALID",
											"type": "String",
											"physicalType": "nvarchar"
										}
									},
									{
										"source": {
											"name": "MANUFACTURERID",
											"type": "String",
											"physicalType": "nvarchar"
										},
										"sink": {
											"name": "MANUFACTURERID",
											"type": "String",
											"physicalType": "nvarchar"
										}
									},
									{
										"source": {
											"name": "Make",
											"type": "String",
											"physicalType": "nvarchar"
										},
										"sink": {
											"name": "Make",
											"type": "String",
											"physicalType": "nvarchar"
										}
									},
									{
										"source": {
											"name": "Model",
											"type": "String",
											"physicalType": "nvarchar"
										},
										"sink": {
											"name": "Model",
											"type": "String",
											"physicalType": "nvarchar"
										}
									},
									{
										"source": {
											"name": "ITEMID",
											"type": "String",
											"physicalType": "nvarchar"
										},
										"sink": {
											"name": "ITEMID",
											"type": "String",
											"physicalType": "nvarchar"
										}
									},
									{
										"source": {
											"name": "Fleet",
											"type": "String",
											"physicalType": "nvarchar"
										},
										"sink": {
											"name": "Fleet",
											"type": "String",
											"physicalType": "nvarchar"
										}
									},
									{
										"source": {
											"name": "Fleet2",
											"type": "String",
											"physicalType": "nvarchar"
										},
										"sink": {
											"name": "Fleet2",
											"type": "String",
											"physicalType": "nvarchar"
										}
									},
									{
										"source": {
											"name": "ORDERDATE",
											"type": "DateTime",
											"physicalType": "datetime"
										},
										"sink": {
											"name": "ORDERDATE",
											"type": "DateTime",
											"physicalType": "datetime"
										}
									},
									{
										"source": {
											"name": "ESTIMATEDRECEIPTDATE",
											"type": "DateTime",
											"physicalType": "datetime"
										},
										"sink": {
											"name": "ESTIMATEDRECEIPTDATE",
											"type": "DateTime",
											"physicalType": "datetime"
										}
									},
									{
										"source": {
											"name": "RECEIVEDDATE",
											"type": "DateTime",
											"physicalType": "datetime"
										},
										"sink": {
											"name": "RECEIVEDDATE",
											"type": "DateTime",
											"physicalType": "datetime"
										}
									},
									{
										"source": {
											"name": "DELIVERYDATE",
											"type": "DateTime",
											"physicalType": "datetime"
										},
										"sink": {
											"name": "DELIVERYDATE",
											"type": "DateTime",
											"physicalType": "datetime"
										}
									},
									{
										"source": {
											"name": "Est_Invoicedate",
											"type": "DateTime",
											"physicalType": "datetime"
										},
										"sink": {
											"name": "Est_Invoicedate",
											"type": "DateTime",
											"physicalType": "datetime"
										}
									},
									{
										"source": {
											"name": "Est_Invoicedate_Salesperson",
											"type": "DateTime",
											"physicalType": "datetime"
										},
										"sink": {
											"name": "Est_Invoicedate_Salesperson",
											"type": "DateTime",
											"physicalType": "datetime"
										}
									},
									{
										"source": {
											"name": "Est_Invoicedate_GJ",
											"type": "DateTime",
											"physicalType": "datetime"
										},
										"sink": {
											"name": "Est_Invoicedate_GJ",
											"type": "DateTime",
											"physicalType": "datetime"
										}
									},
									{
										"source": {
											"name": "Sales_Person1",
											"type": "String",
											"physicalType": "nvarchar"
										},
										"sink": {
											"name": "Sales_Person1",
											"type": "String",
											"physicalType": "nvarchar"
										}
									},
									{
										"source": {
											"name": "Sales_Person2",
											"type": "String",
											"physicalType": "nvarchar"
										},
										"sink": {
											"name": "Sales_Person2",
											"type": "String",
											"physicalType": "nvarchar"
										}
									},
									{
										"source": {
											"name": "PurchPrice",
											"type": "Decimal",
											"physicalType": "decimal",
											"scale": 2,
											"precision": 10
										},
										"sink": {
											"name": "PurchPrice",
											"type": "Decimal",
											"physicalType": "decimal",
											"scale": 2,
											"precision": 10
										}
									},
									{
										"source": {
											"name": "NewPrice",
											"type": "Decimal",
											"physicalType": "decimal",
											"scale": 2,
											"precision": 10
										},
										"sink": {
											"name": "NewPrice",
											"type": "Decimal",
											"physicalType": "decimal",
											"scale": 2,
											"precision": 10
										}
									},
									{
										"source": {
											"name": "GP",
											"type": "Decimal",
											"physicalType": "decimal",
											"scale": 2,
											"precision": 10
										},
										"sink": {
											"name": "GP",
											"type": "Decimal",
											"physicalType": "decimal",
											"scale": 2,
											"precision": 10
										}
									},
									{
										"source": {
											"name": "Commission_%",
											"type": "String",
											"physicalType": "varchar"
										},
										"sink": {
											"name": "Commission_%",
											"type": "String",
											"physicalType": "varchar"
										}
									},
									{
										"source": {
											"name": "Commission_Payment",
											"type": "Decimal",
											"physicalType": "decimal",
											"scale": 2,
											"precision": 10
										},
										"sink": {
											"name": "Commission_Payment",
											"type": "Decimal",
											"physicalType": "decimal",
											"scale": 2,
											"precision": 10
										}
									},
									{
										"source": {
											"name": "svcid",
											"type": "String",
											"physicalType": "nvarchar"
										},
										"sink": {
											"name": "svcid",
											"type": "String",
											"physicalType": "nvarchar"
										}
									},
									{
										"source": {
											"name": "CALLSTATUSID",
											"type": "String",
											"physicalType": "nvarchar"
										},
										"sink": {
											"name": "CALLSTATUSID",
											"type": "String",
											"physicalType": "nvarchar"
										}
									},
									{
										"source": {
											"name": "CALLTYPEID",
											"type": "String",
											"physicalType": "nvarchar"
										},
										"sink": {
											"name": "CALLTYPEID",
											"type": "String",
											"physicalType": "nvarchar"
										}
									},
									{
										"source": {
											"name": "Note",
											"type": "String",
											"physicalType": "nvarchar"
										},
										"sink": {
											"name": "Note",
											"type": "String",
											"physicalType": "nvarchar"
										}
									},
									{
										"source": {
											"name": "zip",
											"type": "String",
											"physicalType": "nvarchar"
										},
										"sink": {
											"name": "zip",
											"type": "String",
											"physicalType": "nvarchar"
										}
									},
									{
										"source": {
											"name": "ADDRESS",
											"type": "String",
											"physicalType": "nvarchar"
										},
										"sink": {
											"name": "ADDRESS",
											"type": "String",
											"physicalType": "nvarchar"
										}
									},
									{
										"source": {
											"name": "EXTERNALREFERENCE",
											"type": "String",
											"physicalType": "nvarchar"
										},
										"sink": {
											"name": "EXTERNALREFERENCE",
											"type": "String",
											"physicalType": "nvarchar"
										}
									},
									{
										"source": {
											"name": "BookingMonth",
											"type": "Int32",
											"physicalType": "int"
										},
										"sink": {
											"name": "BookingMonth",
											"type": "Int32",
											"physicalType": "int"
										}
									},
									{
										"source": {
											"name": "BookingYear",
											"type": "Int32",
											"physicalType": "int"
										},
										"sink": {
											"name": "BookingYear",
											"type": "Int32",
											"physicalType": "int"
										}
									},
									{
										"source": {
											"name": "BookingQuarter",
											"type": "Int32",
											"physicalType": "int"
										},
										"sink": {
											"name": "BookingQuarter",
											"type": "Int32",
											"physicalType": "int"
										}
									},
									{
										"source": {
											"name": "mindate",
											"type": "DateTime",
											"physicalType": "datetime"
										},
										"sink": {
											"name": "mindate",
											"type": "DateTime",
											"physicalType": "datetime"
										}
									},
									{
										"source": {
											"name": "maxdate",
											"type": "DateTime",
											"physicalType": "datetime"
										},
										"sink": {
											"name": "maxdate",
											"type": "DateTime",
											"physicalType": "datetime"
										}
									},
									{
										"source": {
											"name": "maxCloseDate",
											"type": "DateTime",
											"physicalType": "datetime"
										},
										"sink": {
											"name": "maxCloseDate",
											"type": "DateTime",
											"physicalType": "datetime"
										}
									},
									{
										"source": {
											"name": "createddatetime",
											"type": "DateTime",
											"physicalType": "datetime"
										},
										"sink": {
											"name": "createddatetime",
											"type": "DateTime",
											"physicalType": "datetime"
										}
									},
									{
										"source": {
											"name": "Last Status Change",
											"type": "DateTime",
											"physicalType": "datetime"
										},
										"sink": {
											"name": "Last Status Change",
											"type": "DateTime",
											"physicalType": "datetime"
										}
									},
									{
										"source": {
											"name": "InvoiceName",
											"type": "String",
											"physicalType": "nvarchar"
										},
										"sink": {
											"name": "InvoiceName",
											"type": "String",
											"physicalType": "nvarchar"
										}
									},
									{
										"source": {
											"name": "InvoiceNum",
											"type": "String",
											"physicalType": "nvarchar"
										},
										"sink": {
											"name": "InvoiceNum",
											"type": "String",
											"physicalType": "nvarchar"
										}
									},
									{
										"source": {
											"name": "fleettype",
											"type": "Int32",
											"physicalType": "int"
										},
										"sink": {
											"name": "fleettype",
											"type": "Int32",
											"physicalType": "int"
										}
									},
									{
										"source": {
											"name": "ORDERCLASSID",
											"type": "String",
											"physicalType": "nvarchar"
										},
										"sink": {
											"name": "ORDERCLASSID",
											"type": "String",
											"physicalType": "nvarchar"
										}
									},
									{
										"source": {
											"name": "SALESSTATUS",
											"type": "Int32",
											"physicalType": "int"
										},
										"sink": {
											"name": "SALESSTATUS",
											"type": "Int32",
											"physicalType": "int"
										}
									},
									{
										"source": {
											"name": "DATAAREAID",
											"type": "String",
											"physicalType": "nvarchar"
										},
										"sink": {
											"name": "DATAAREAID",
											"type": "String",
											"physicalType": "nvarchar"
										}
									},
									{
										"source": {
											"name": "PARTITION",
											"type": "Int64",
											"physicalType": "bigint"
										},
										"sink": {
											"name": "PARTITION",
											"type": "Int64",
											"physicalType": "bigint"
										}
									},
									{
										"source": {
											"name": "custgroup",
											"type": "String",
											"physicalType": "nvarchar"
										},
										"sink": {
											"name": "custgroup",
											"type": "String",
											"physicalType": "nvarchar"
										}
									}
								],
								"typeConversion": true,
								"typeConversionSettings": {
									"allowDataTruncation": true,
									"treatBooleanAsNumber": false
								}
							}
						},
						"inputs": [
							{
								"referenceName": "Briggs_MST",
								"type": "DatasetReference",
								"parameters": {}
							}
						],
						"outputs": [
							{
								"referenceName": "Briggs_MDW",
								"type": "DatasetReference",
								"parameters": {
									"schema_name": "Briggs",
									"table_name": "Stage_Equipment_Pipeline_Backlog"
								}
							}
						]
					},
					{
						"name": "Stage_Equipment_On_Rent",
						"type": "Copy",
						"dependsOn": [],
						"policy": {
							"timeout": "7.00:00:00",
							"retry": 0,
							"retryIntervalInSeconds": 30,
							"secureOutput": false,
							"secureInput": false
						},
						"userProperties": [],
						"typeProperties": {
							"source": {
								"type": "SqlServerSource",
								"sqlReaderQuery": "select * from briggsax.dbo.Briggs_ReportEqOnRentBySalesPerson ",
								"queryTimeout": "02:00:00",
								"partitionOption": "None"
							},
							"sink": {
								"type": "AzureSqlSink",
								"preCopyScript": "truncate table briggs.Stage_Equipment_On_Rent",
								"disableMetricsCollection": false
							},
							"enableStaging": false,
							"translator": {
								"type": "TabularTranslator",
								"mappings": [
									{
										"source": {
											"name": "RENTALID",
											"type": "String",
											"physicalType": "nvarchar"
										},
										"sink": {
											"name": "RENTALID",
											"type": "String",
											"physicalType": "String"
										}
									},
									{
										"source": {
											"name": "CUSTOMERPO",
											"type": "String",
											"physicalType": "nvarchar"
										},
										"sink": {
											"name": "CUSTOMERPO",
											"type": "String",
											"physicalType": "String"
										}
									},
									{
										"source": {
											"name": "CONTRACTSTATUS",
											"type": "Int32",
											"physicalType": "int"
										},
										"sink": {
											"name": "CONTRACTSTATUS",
											"type": "Int32",
											"physicalType": "Int32"
										}
									},
									{
										"source": {
											"name": "CONTRACT_STATUS_DESC",
											"type": "String",
											"physicalType": "varchar"
										},
										"sink": {
											"name": "CONTRACT_STATUS_DESC",
											"type": "String",
											"physicalType": "String"
										}
									},
									{
										"source": {
											"name": "SALESPERSONNAME",
											"type": "String",
											"physicalType": "nvarchar"
										},
										"sink": {
											"name": "SALESPERSONNAME",
											"type": "String",
											"physicalType": "String"
										}
									},
									{
										"source": {
											"name": "SALESMANCODE",
											"type": "String",
											"physicalType": "nvarchar"
										},
										"sink": {
											"name": "SALESMANCODE",
											"type": "String",
											"physicalType": "String"
										}
									},
									{
										"source": {
											"name": "NO_OF_UNITS_PER_SALESPERSON",
											"type": "Int32",
											"physicalType": "int"
										},
										"sink": {
											"name": "NO_OF_UNITS_PER_SALESPERSON",
											"type": "Int32",
											"physicalType": "Int32"
										}
									},
									{
										"source": {
											"name": "INVOICING_DATE",
											"type": "DateTime",
											"physicalType": "datetime"
										},
										"sink": {
											"name": "INVOICING_DATE",
											"type": "DateTime",
											"physicalType": "DateTime"
										}
									},
									{
										"source": {
											"name": "startdatetime",
											"type": "DateTime",
											"physicalType": "datetime"
										},
										"sink": {
											"name": "startdatetime",
											"type": "DateTime",
											"physicalType": "DateTime"
										}
									},
									{
										"source": {
											"name": "TEMPLATELINEID",
											"type": "String",
											"physicalType": "nvarchar"
										},
										"sink": {
											"name": "TEMPLATELINEID",
											"type": "String",
											"physicalType": "String"
										}
									},
									{
										"source": {
											"name": "ADDRESS_ON_CONTRACT",
											"type": "String",
											"physicalType": "nvarchar"
										},
										"sink": {
											"name": "ADDRESS_ON_CONTRACT",
											"type": "String",
											"physicalType": "String"
										}
									},
									{
										"source": {
											"name": "City",
											"type": "String",
											"physicalType": "nvarchar"
										},
										"sink": {
											"name": "City",
											"type": "String",
											"physicalType": "String"
										}
									},
									{
										"source": {
											"name": "STATE",
											"type": "String",
											"physicalType": "nvarchar"
										},
										"sink": {
											"name": "STATE",
											"type": "String",
											"physicalType": "String"
										}
									},
									{
										"source": {
											"name": "COUNTY",
											"type": "String",
											"physicalType": "nvarchar"
										},
										"sink": {
											"name": "COUNTY",
											"type": "String",
											"physicalType": "String"
										}
									},
									{
										"source": {
											"name": "ZIPCODE",
											"type": "String",
											"physicalType": "nvarchar"
										},
										"sink": {
											"name": "ZIPCODE",
											"type": "String",
											"physicalType": "String"
										}
									},
									{
										"source": {
											"name": "EQUIPMENTID",
											"type": "String",
											"physicalType": "nvarchar"
										},
										"sink": {
											"name": "EQUIPMENTID",
											"type": "String",
											"physicalType": "String"
										}
									},
									{
										"source": {
											"name": "INVENTSERIALID",
											"type": "String",
											"physicalType": "nvarchar"
										},
										"sink": {
											"name": "INVENTSERIALID",
											"type": "String",
											"physicalType": "String"
										}
									},
									{
										"source": {
											"name": "make",
											"type": "String",
											"physicalType": "nvarchar"
										},
										"sink": {
											"name": "make",
											"type": "String",
											"physicalType": "String"
										}
									},
									{
										"source": {
											"name": "model",
											"type": "String",
											"physicalType": "nvarchar"
										},
										"sink": {
											"name": "model",
											"type": "String",
											"physicalType": "String"
										}
									},
									{
										"source": {
											"name": "MACHINEMANUFACTUREYEAR",
											"type": "Int32",
											"physicalType": "int"
										},
										"sink": {
											"name": "MACHINEMANUFACTUREYEAR",
											"type": "Int32",
											"physicalType": "Int32"
										}
									},
									{
										"source": {
											"name": "ORDERACCOUNTNAME",
											"type": "String",
											"physicalType": "nvarchar"
										},
										"sink": {
											"name": "ORDERACCOUNTNAME",
											"type": "String",
											"physicalType": "String"
										}
									},
									{
										"source": {
											"name": "INVOICEACCOUNTNAME",
											"type": "String",
											"physicalType": "nvarchar"
										},
										"sink": {
											"name": "INVOICEACCOUNTNAME",
											"type": "String",
											"physicalType": "String"
										}
									},
									{
										"source": {
											"name": "inventlocation",
											"type": "String",
											"physicalType": "nvarchar"
										},
										"sink": {
											"name": "inventlocation",
											"type": "String",
											"physicalType": "String"
										}
									},
									{
										"source": {
											"name": "ORDERACCOUNT",
											"type": "String",
											"physicalType": "nvarchar"
										},
										"sink": {
											"name": "ORDERACCOUNT",
											"type": "String",
											"physicalType": "String"
										}
									},
									{
										"source": {
											"name": "INVOICEACCOUNT",
											"type": "String",
											"physicalType": "nvarchar"
										},
										"sink": {
											"name": "INVOICEACCOUNT",
											"type": "String",
											"physicalType": "String"
										}
									},
									{
										"source": {
											"name": "INVOICEFROM",
											"type": "DateTime",
											"physicalType": "datetime"
										},
										"sink": {
											"name": "INVOICEFROM",
											"type": "DateTime",
											"physicalType": "DateTime"
										}
									},
									{
										"source": {
											"name": "INVOICEUNTIL",
											"type": "DateTime",
											"physicalType": "datetime"
										},
										"sink": {
											"name": "INVOICEUNTIL",
											"type": "DateTime",
											"physicalType": "DateTime"
										}
									},
									{
										"source": {
											"name": "CALLOFFDATE",
											"type": "DateTime",
											"physicalType": "datetime"
										},
										"sink": {
											"name": "CALLOFFDATE",
											"type": "DateTime",
											"physicalType": "DateTime"
										}
									},
									{
										"source": {
											"name": "DailyAmount",
											"type": "Decimal",
											"physicalType": "decimal",
											"scale": 16,
											"precision": 32
										},
										"sink": {
											"name": "DailyAmount",
											"type": "Decimal",
											"physicalType": "Decimal"
										}
									},
									{
										"source": {
											"name": "MonthlyAmount",
											"type": "Decimal",
											"physicalType": "decimal",
											"scale": 16,
											"precision": 32
										},
										"sink": {
											"name": "MonthlyAmount",
											"type": "Decimal",
											"physicalType": "Decimal"
										}
									},
									{
										"source": {
											"name": "MonthCalAmount",
											"type": "Decimal",
											"physicalType": "decimal",
											"scale": 16,
											"precision": 32
										},
										"sink": {
											"name": "MonthCalAmount",
											"type": "Decimal",
											"physicalType": "Decimal"
										}
									},
									{
										"source": {
											"name": "WeeklyAmount",
											"type": "Decimal",
											"physicalType": "decimal",
											"scale": 16,
											"precision": 32
										},
										"sink": {
											"name": "WeeklyAmount",
											"type": "Decimal",
											"physicalType": "Decimal"
										}
									},
									{
										"source": {
											"name": "OvertimeAmount",
											"type": "Decimal",
											"physicalType": "decimal",
											"scale": 16,
											"precision": 32
										},
										"sink": {
											"name": "OvertimeAmount",
											"type": "Decimal",
											"physicalType": "Decimal"
										}
									},
									{
										"source": {
											"name": "SupplementalAmount",
											"type": "Decimal",
											"physicalType": "decimal",
											"scale": 16,
											"precision": 32
										},
										"sink": {
											"name": "SupplementalAmount",
											"type": "Decimal",
											"physicalType": "Decimal"
										}
									},
									{
										"source": {
											"name": "OWNING_BRANCH",
											"type": "String",
											"physicalType": "nvarchar"
										},
										"sink": {
											"name": "OWNING_BRANCH",
											"type": "String",
											"physicalType": "String"
										}
									},
									{
										"source": {
											"name": "FINANCIALDIMENSIONBRANCH",
											"type": "String",
											"physicalType": "nvarchar"
										},
										"sink": {
											"name": "FINANCIALDIMENSIONBRANCH",
											"type": "String",
											"physicalType": "String"
										}
									},
									{
										"source": {
											"name": "fleettype",
											"type": "String",
											"physicalType": "nvarchar"
										},
										"sink": {
											"name": "fleettype",
											"type": "String",
											"physicalType": "String"
										}
									},
									{
										"source": {
											"name": "DaysSinceLastPm",
											"type": "Int32",
											"physicalType": "int"
										},
										"sink": {
											"name": "DaysSinceLastPm",
											"type": "Int32",
											"physicalType": "Int32"
										}
									}
								],
								"typeConversion": true,
								"typeConversionSettings": {
									"allowDataTruncation": true,
									"treatBooleanAsNumber": false
								}
							}
						},
						"inputs": [
							{
								"referenceName": "Briggs_MST",
								"type": "DatasetReference",
								"parameters": {}
							}
						],
						"outputs": [
							{
								"referenceName": "Briggs_MDW",
								"type": "DatasetReference",
								"parameters": {
									"schema_name": "Briggs",
									"table_name": "Stage_Equipment_On_Rent"
								}
							}
						]
					},
					{
						"name": "lkp_ExecStartAuditProc",
						"type": "Lookup",
						"dependsOn": [],
						"policy": {
							"timeout": "7.00:00:00",
							"retry": 0,
							"retryIntervalInSeconds": 30,
							"secureOutput": false,
							"secureInput": false
						},
						"userProperties": [],
						"typeProperties": {
							"source": {
								"type": "AzureSqlSource",
								"sqlReaderStoredProcedureName": "[dbo].[proc_StartAuditLog]",
								"storedProcedureParameters": {
									"ConfigTableID": {
										"type": "Int32",
										"value": "-1"
									},
									"DataFactoryName": {
										"type": "String",
										"value": {
											"value": "@pipeline().DataFactory",
											"type": "Expression"
										}
									},
									"ParentAuditID": {
										"type": "Int64",
										"value": "-1"
									},
									"PipelineName": {
										"type": "String",
										"value": {
											"value": "@pipeline().Pipeline",
											"type": "Expression"
										}
									},
									"PipelineRunID": {
										"type": "String",
										"value": {
											"value": "@pipeline().RunId",
											"type": "Expression"
										}
									},
									"PipelineTriggerID": {
										"type": "String",
										"value": {
											"value": "@pipeline().TriggerId",
											"type": "Expression"
										}
									},
									"PipelineTriggerName": {
										"type": "String",
										"value": {
											"value": "@pipeline().TriggerName",
											"type": "Expression"
										}
									},
									"PipelineTriggerType": {
										"type": "String",
										"value": {
											"value": "@pipeline().TriggerType",
											"type": "Expression"
										}
									}
								},
								"queryTimeout": "02:00:00",
								"partitionOption": "None"
							},
							"dataset": {
								"referenceName": "Briggs_MDW",
								"type": "DatasetReference",
								"parameters": {
									"schema_name": "dbo",
									"table_name": "user"
								}
							}
						}
					},
					{
						"name": "Sp_ExecFailureAudit_Fact",
						"type": "SqlServerStoredProcedure",
						"dependsOn": [
							{
								"activity": "ForEach_Fact",
								"dependencyConditions": [
									"Failed"
								]
							}
						],
						"policy": {
							"timeout": "7.00:00:00",
							"retry": 0,
							"retryIntervalInSeconds": 30,
							"secureOutput": false,
							"secureInput": false
						},
						"userProperties": [],
						"typeProperties": {
							"storedProcedureName": "[dbo].[proc_UpdateAuditLog]",
							"storedProcedureParameters": {
								"AuditID": {
									"value": {
										"value": "@activity('lkp_ExecStartAuditProc').output.firstRow.AuditID",
										"type": "Expression"
									},
									"type": "Int32"
								},
								"DataLakePath": {
									"value": null,
									"type": "String"
								},
								"PipelineRunID": {
									"value": {
										"value": "@pipeline().RunId",
										"type": "Expression"
									},
									"type": "String"
								},
								"RowsRead": {
									"value": null,
									"type": "Int64"
								},
								"Status": {
									"value": "Fact Proc Failed",
									"type": "String"
								}
							}
						},
						"linkedServiceName": {
							"referenceName": "AzureSqlDatabase1",
							"type": "LinkedServiceReference"
						}
					},
					{
						"name": "Sp_ExecSuccessAudit",
						"type": "SqlServerStoredProcedure",
						"dependsOn": [
							{
								"activity": "ForEach_Fact",
								"dependencyConditions": [
									"Succeeded"
								]
							}
						],
						"policy": {
							"timeout": "7.00:00:00",
							"retry": 0,
							"retryIntervalInSeconds": 30,
							"secureOutput": false,
							"secureInput": false
						},
						"userProperties": [],
						"typeProperties": {
							"storedProcedureName": "[dbo].[proc_UpdateAuditLog]",
							"storedProcedureParameters": {
								"AuditID": {
									"value": {
										"value": "@activity('lkp_ExecStartAuditProc').output.firstRow.AuditID",
										"type": "Expression"
									},
									"type": "Int32"
								},
								"DataLakePath": {
									"value": null,
									"type": "String"
								},
								"RowsRead": {
									"value": null,
									"type": "Int64"
								},
								"Status": {
									"value": "Success",
									"type": "String"
								},
								"PipelineRunID": {
									"value": {
										"value": "@pipeline().RunId",
										"type": "Expression"
									},
									"type": "String"
								}
							}
						},
						"linkedServiceName": {
							"referenceName": "AzureSqlDatabase1",
							"type": "LinkedServiceReference"
						}
					},
					{
						"name": "Sp_ExecFailureAudit_Stage",
						"type": "SqlServerStoredProcedure",
						"dependsOn": [
							{
								"activity": "ForEach_Stage",
								"dependencyConditions": [
									"Failed"
								]
							}
						],
						"policy": {
							"timeout": "7.00:00:00",
							"retry": 0,
							"retryIntervalInSeconds": 30,
							"secureOutput": false,
							"secureInput": false
						},
						"userProperties": [],
						"typeProperties": {
							"storedProcedureName": "[dbo].[proc_UpdateAuditLog]",
							"storedProcedureParameters": {
								"AuditID": {
									"value": {
										"value": "@activity('lkp_ExecStartAuditProc').output.firstRow.AuditID",
										"type": "Expression"
									},
									"type": "Int32"
								},
								"DataLakePath": {
									"value": null,
									"type": "String"
								},
								"PipelineRunID": {
									"value": {
										"value": "@pipeline().RunId",
										"type": "Expression"
									},
									"type": "String"
								},
								"RowsRead": {
									"value": null,
									"type": "Int64"
								},
								"Status": {
									"value": "Stage Proc Failed",
									"type": "String"
								}
							}
						},
						"linkedServiceName": {
							"referenceName": "AzureSqlDatabase1",
							"type": "LinkedServiceReference"
						}
					},
					{
						"name": "Sp_ExecFailureAudit_TL",
						"type": "SqlServerStoredProcedure",
						"dependsOn": [
							{
								"activity": "Execute Pipeline1",
								"dependencyConditions": [
									"Failed"
								]
							}
						],
						"policy": {
							"timeout": "7.00:00:00",
							"retry": 0,
							"retryIntervalInSeconds": 30,
							"secureOutput": false,
							"secureInput": false
						},
						"userProperties": [],
						"typeProperties": {
							"storedProcedureName": "[dbo].[proc_UpdateAuditLog]",
							"storedProcedureParameters": {
								"AuditID": {
									"value": {
										"value": "@activity('lkp_ExecStartAuditProc').output.firstRow.AuditID",
										"type": "Expression"
									},
									"type": "Int32"
								},
								"DataLakePath": {
									"value": null,
									"type": "String"
								},
								"PipelineRunID": {
									"value": {
										"value": "@pipeline().RunId",
										"type": "Expression"
									},
									"type": "String"
								},
								"RowsRead": {
									"value": null,
									"type": "Int64"
								},
								"Status": {
									"value": "Table Load Failed",
									"type": "String"
								}
							}
						},
						"linkedServiceName": {
							"referenceName": "AzureSqlDatabase1",
							"type": "LinkedServiceReference"
						}
					}
				],
				"policy": {
					"elapsedTimeMetric": {},
					"cancelAfter": {}
				},
				"variables": {
					"ErrorMsg": {
						"type": "String"
					}
				},
				"folder": {
					"name": "Briggs Data Load Theme wise"
				},
				"annotations": [],
				"lastPublishTime": "2022-04-26T12:27:13Z"
			},
			"dependsOn": [
				"[concat(variables('workspaceId'), '/pipelines/PL_Generic_Copy_Equipment')]",
				"[concat(variables('workspaceId'), '/datasets/Briggs_MDW')]",
				"[concat(variables('workspaceId'), '/datasets/Briggs_MST')]",
				"[concat(variables('workspaceId'), '/linkedServices/AzureSqlDatabase1')]",
				"[concat(variables('workspaceId'), '/linkedServices/DS_MDW_SP')]"
			]
		},
		{
			"name": "[concat(parameters('workspaceName'), '/PL_Master_Briggs_GM')]",
			"type": "Microsoft.Synapse/workspaces/pipelines",
			"apiVersion": "2019-06-01-preview",
			"properties": {
				"activities": [
					{
						"name": "Execute Pipeline1",
						"type": "ExecutePipeline",
						"dependsOn": [
							{
								"activity": "lkp_ExecStartAuditProc",
								"dependencyConditions": [
									"Succeeded"
								]
							}
						],
						"userProperties": [],
						"typeProperties": {
							"pipeline": {
								"referenceName": "PL_Generic_Copy_GM",
								"type": "PipelineReference"
							},
							"waitOnCompletion": true,
							"parameters": {}
						}
					},
					{
						"name": "ReportStageProc",
						"type": "Lookup",
						"dependsOn": [
							{
								"activity": "Execute Pipeline1",
								"dependencyConditions": [
									"Succeeded"
								]
							}
						],
						"policy": {
							"timeout": "7.00:00:00",
							"retry": 0,
							"retryIntervalInSeconds": 30,
							"secureOutput": false,
							"secureInput": false
						},
						"userProperties": [],
						"typeProperties": {
							"source": {
								"type": "AzureSqlSource",
								"sqlReaderQuery": "select  * from dbo.control_table where processsequence = 2 and enableaction = 1 \nand subjectarea='Report Stage GM SP'\norder by id",
								"queryTimeout": "02:00:00",
								"partitionOption": "None"
							},
							"dataset": {
								"referenceName": "Briggs_MDW",
								"type": "DatasetReference",
								"parameters": {
									"schema_name": "dbo",
									"table_name": "user"
								}
							},
							"firstRowOnly": false
						}
					},
					{
						"name": "ForEach_Stage",
						"type": "ForEach",
						"dependsOn": [
							{
								"activity": "ReportStageProc",
								"dependencyConditions": [
									"Succeeded"
								]
							}
						],
						"userProperties": [],
						"typeProperties": {
							"items": {
								"value": "@activity('ReportStageProc').output.value",
								"type": "Expression"
							},
							"activities": [
								{
									"name": "Stored procedure1",
									"type": "SqlServerStoredProcedure",
									"dependsOn": [
										{
											"activity": "Start_Table_Audit_Stage",
											"dependencyConditions": [
												"Succeeded"
											]
										}
									],
									"policy": {
										"timeout": "7.00:00:00",
										"retry": 0,
										"retryIntervalInSeconds": 30,
										"secureOutput": false,
										"secureInput": false
									},
									"userProperties": [],
									"typeProperties": {
										"storedProcedureName": {
											"value": "@item().sourcetablename",
											"type": "Expression"
										}
									},
									"linkedServiceName": {
										"referenceName": "DS_MDW_SP",
										"type": "LinkedServiceReference"
									}
								},
								{
									"name": "Start_Table_Audit_Stage",
									"type": "Lookup",
									"dependsOn": [],
									"policy": {
										"timeout": "7.00:00:00",
										"retry": 0,
										"retryIntervalInSeconds": 30,
										"secureOutput": false,
										"secureInput": false
									},
									"userProperties": [],
									"typeProperties": {
										"source": {
											"type": "AzureSqlSource",
											"sqlReaderStoredProcedureName": "[dbo].[proc_StartAuditLog_Briggs]",
											"storedProcedureParameters": {
												"ConfigTableID": {
													"type": "Int32",
													"value": {
														"value": "@item().ID",
														"type": "Expression"
													}
												},
												"DataFactoryName": {
													"type": "String",
													"value": {
														"value": "@pipeline().DataFactory",
														"type": "Expression"
													}
												},
												"ParentAuditID": {
													"type": "Int64",
													"value": {
														"value": "@item().ID",
														"type": "Expression"
													}
												},
												"PipelineName": {
													"type": "String",
													"value": {
														"value": "@pipeline().Pipeline",
														"type": "Expression"
													}
												},
												"PipelineRunID": {
													"type": "String",
													"value": {
														"value": "@pipeline().RunId",
														"type": "Expression"
													}
												},
												"PipelineTriggerID": {
													"type": "String",
													"value": {
														"value": "@pipeline().TriggerId",
														"type": "Expression"
													}
												},
												"PipelineTriggerName": {
													"type": "String",
													"value": {
														"value": "@pipeline().TriggerName",
														"type": "Expression"
													}
												},
												"PipelineTriggerType": {
													"type": "String",
													"value": {
														"value": "@pipeline().TriggerType",
														"type": "Expression"
													}
												},
												"Sourcedb": {
													"type": "String",
													"value": {
														"value": "@item().sourceDB",
														"type": "Expression"
													}
												},
												"sourcetable": {
													"type": "String",
													"value": {
														"value": "@item().SourcetableName",
														"type": "Expression"
													}
												}
											},
											"queryTimeout": "02:00:00",
											"partitionOption": "None"
										},
										"dataset": {
											"referenceName": "Briggs_MDW",
											"type": "DatasetReference",
											"parameters": {
												"schema_name": "dbo",
												"table_name": "user"
											}
										},
										"firstRowOnly": false
									}
								},
								{
									"name": "Set variable_Stage",
									"type": "SetVariable",
									"dependsOn": [
										{
											"activity": "Stored procedure1",
											"dependencyConditions": [
												"Failed"
											]
										}
									],
									"userProperties": [],
									"typeProperties": {
										"variableName": "ErrorMsg",
										"value": {
											"value": "@activity('Stored procedure1').Error.Message",
											"type": "Expression"
										}
									}
								},
								{
									"name": "Failure_Audit_Log_Stage",
									"type": "SqlServerStoredProcedure",
									"dependsOn": [
										{
											"activity": "Set variable_Stage",
											"dependencyConditions": [
												"Succeeded"
											]
										}
									],
									"policy": {
										"timeout": "7.00:00:00",
										"retry": 0,
										"retryIntervalInSeconds": 30,
										"secureOutput": false,
										"secureInput": false
									},
									"userProperties": [],
									"typeProperties": {
										"storedProcedureName": "[dbo].[proc_UpdateAuditLog_Briggs]",
										"storedProcedureParameters": {
											"ConfigTableID": {
												"value": {
													"value": "@item().ID",
													"type": "Expression"
												},
												"type": "Int32"
											},
											"RowsRead": {
												"value": null,
												"type": "Int64"
											},
											"Status": {
												"value": {
													"value": "@variables('ErrorMsg')",
													"type": "Expression"
												},
												"type": "String"
											}
										}
									},
									"linkedServiceName": {
										"referenceName": "DS_MDW_SP",
										"type": "LinkedServiceReference"
									}
								},
								{
									"name": "Success_Audit_Log_Stage",
									"type": "SqlServerStoredProcedure",
									"dependsOn": [
										{
											"activity": "Stored procedure1",
											"dependencyConditions": [
												"Succeeded"
											]
										}
									],
									"policy": {
										"timeout": "7.00:00:00",
										"retry": 0,
										"retryIntervalInSeconds": 30,
										"secureOutput": false,
										"secureInput": false
									},
									"userProperties": [],
									"typeProperties": {
										"storedProcedureName": "[dbo].[proc_UpdateAuditLog_Briggs]",
										"storedProcedureParameters": {
											"ConfigTableID": {
												"value": {
													"value": "@item().ID",
													"type": "Expression"
												},
												"type": "Int32"
											},
											"RowsRead": {
												"value": null,
												"type": "Int64"
											},
											"Status": {
												"value": "Success",
												"type": "String"
											}
										}
									},
									"linkedServiceName": {
										"referenceName": "DS_MDW_SP",
										"type": "LinkedServiceReference"
									}
								}
							]
						}
					},
					{
						"name": "ReportFactProc",
						"type": "Lookup",
						"dependsOn": [
							{
								"activity": "ForEach_Stage",
								"dependencyConditions": [
									"Succeeded"
								]
							}
						],
						"policy": {
							"timeout": "7.00:00:00",
							"retry": 0,
							"retryIntervalInSeconds": 30,
							"secureOutput": false,
							"secureInput": false
						},
						"userProperties": [],
						"typeProperties": {
							"source": {
								"type": "AzureSqlSource",
								"sqlReaderQuery": "select  * from dbo.control_table where processsequence = 4 and enableaction = 1 \nand subjectarea='Report Fact GM SP'\norder by id",
								"queryTimeout": "02:00:00",
								"partitionOption": "None"
							},
							"dataset": {
								"referenceName": "Briggs_MDW",
								"type": "DatasetReference",
								"parameters": {
									"schema_name": "dbo",
									"table_name": "user"
								}
							},
							"firstRowOnly": false
						}
					},
					{
						"name": "ForEach_Fact",
						"type": "ForEach",
						"dependsOn": [
							{
								"activity": "ReportFactProc",
								"dependencyConditions": [
									"Succeeded"
								]
							}
						],
						"userProperties": [],
						"typeProperties": {
							"items": {
								"value": "@activity('ReportFactProc').output.value",
								"type": "Expression"
							},
							"activities": [
								{
									"name": "Stored procedure",
									"type": "SqlServerStoredProcedure",
									"dependsOn": [
										{
											"activity": "Start_Table_Audit1_Fact",
											"dependencyConditions": [
												"Succeeded"
											]
										}
									],
									"policy": {
										"timeout": "7.00:00:00",
										"retry": 0,
										"retryIntervalInSeconds": 30,
										"secureOutput": false,
										"secureInput": false
									},
									"userProperties": [],
									"typeProperties": {
										"storedProcedureName": {
											"value": "@item().sourcetablename",
											"type": "Expression"
										}
									},
									"linkedServiceName": {
										"referenceName": "DS_MDW_SP",
										"type": "LinkedServiceReference"
									}
								},
								{
									"name": "Start_Table_Audit1_Fact",
									"type": "Lookup",
									"dependsOn": [],
									"policy": {
										"timeout": "7.00:00:00",
										"retry": 0,
										"retryIntervalInSeconds": 30,
										"secureOutput": false,
										"secureInput": false
									},
									"userProperties": [],
									"typeProperties": {
										"source": {
											"type": "AzureSqlSource",
											"sqlReaderStoredProcedureName": "[dbo].[proc_StartAuditLog_Briggs]",
											"storedProcedureParameters": {
												"ConfigTableID": {
													"type": "Int32",
													"value": {
														"value": "@item().ID",
														"type": "Expression"
													}
												},
												"DataFactoryName": {
													"type": "String",
													"value": {
														"value": "@pipeline().DataFactory",
														"type": "Expression"
													}
												},
												"ParentAuditID": {
													"type": "Int64",
													"value": {
														"value": "@item().ID",
														"type": "Expression"
													}
												},
												"PipelineName": {
													"type": "String",
													"value": {
														"value": "@pipeline().Pipeline",
														"type": "Expression"
													}
												},
												"PipelineRunID": {
													"type": "String",
													"value": {
														"value": "@pipeline().RunId",
														"type": "Expression"
													}
												},
												"PipelineTriggerID": {
													"type": "String",
													"value": {
														"value": "@pipeline().TriggerId",
														"type": "Expression"
													}
												},
												"PipelineTriggerName": {
													"type": "String",
													"value": {
														"value": "@pipeline().TriggerName",
														"type": "Expression"
													}
												},
												"PipelineTriggerType": {
													"type": "String",
													"value": {
														"value": "@pipeline().TriggerType",
														"type": "Expression"
													}
												},
												"Sourcedb": {
													"type": "String",
													"value": {
														"value": "@item().sourceDB",
														"type": "Expression"
													}
												},
												"sourcetable": {
													"type": "String",
													"value": {
														"value": "@item().SourcetableName",
														"type": "Expression"
													}
												}
											},
											"queryTimeout": "02:00:00",
											"partitionOption": "None"
										},
										"dataset": {
											"referenceName": "Briggs_MDW",
											"type": "DatasetReference",
											"parameters": {
												"schema_name": "dbo",
												"table_name": "user"
											}
										},
										"firstRowOnly": false
									}
								},
								{
									"name": "Set variable1_Fact",
									"type": "SetVariable",
									"dependsOn": [
										{
											"activity": "Stored procedure",
											"dependencyConditions": [
												"Failed"
											]
										}
									],
									"userProperties": [],
									"typeProperties": {
										"variableName": "ErrorMsg",
										"value": {
											"value": "@activity('ReportStageProc').Error.Message",
											"type": "Expression"
										}
									}
								},
								{
									"name": "Failure_Audit_Log_Fact",
									"type": "SqlServerStoredProcedure",
									"dependsOn": [
										{
											"activity": "Set variable1_Fact",
											"dependencyConditions": [
												"Succeeded"
											]
										}
									],
									"policy": {
										"timeout": "7.00:00:00",
										"retry": 0,
										"retryIntervalInSeconds": 30,
										"secureOutput": false,
										"secureInput": false
									},
									"userProperties": [],
									"typeProperties": {
										"storedProcedureName": "[dbo].[proc_UpdateAuditLog_Briggs]",
										"storedProcedureParameters": {
											"ConfigTableID": {
												"value": {
													"value": "@item().ID",
													"type": "Expression"
												},
												"type": "Int32"
											},
											"RowsRead": {
												"value": null,
												"type": "Int64"
											},
											"Status": {
												"value": {
													"value": "@variables('ErrorMsg')",
													"type": "Expression"
												},
												"type": "String"
											}
										}
									},
									"linkedServiceName": {
										"referenceName": "DS_MDW_SP",
										"type": "LinkedServiceReference"
									}
								},
								{
									"name": "Success_Audit_Log2_Fact",
									"type": "SqlServerStoredProcedure",
									"dependsOn": [
										{
											"activity": "Stored procedure",
											"dependencyConditions": [
												"Succeeded"
											]
										}
									],
									"policy": {
										"timeout": "7.00:00:00",
										"retry": 0,
										"retryIntervalInSeconds": 30,
										"secureOutput": false,
										"secureInput": false
									},
									"userProperties": [],
									"typeProperties": {
										"storedProcedureName": "[dbo].[proc_UpdateAuditLog_Briggs]",
										"storedProcedureParameters": {
											"ConfigTableID": {
												"value": {
													"value": "@item().ID",
													"type": "Expression"
												},
												"type": "Int32"
											},
											"RowsRead": {
												"value": null,
												"type": "Int64"
											},
											"Status": {
												"value": "Success",
												"type": "String"
											}
										}
									},
									"linkedServiceName": {
										"referenceName": "DS_MDW_SP",
										"type": "LinkedServiceReference"
									}
								}
							]
						}
					},
					{
						"name": "lkp_ExecStartAuditProc",
						"type": "Lookup",
						"dependsOn": [],
						"policy": {
							"timeout": "7.00:00:00",
							"retry": 0,
							"retryIntervalInSeconds": 30,
							"secureOutput": false,
							"secureInput": false
						},
						"userProperties": [],
						"typeProperties": {
							"source": {
								"type": "AzureSqlSource",
								"sqlReaderStoredProcedureName": "[dbo].[proc_StartAuditLog]",
								"storedProcedureParameters": {
									"ConfigTableID": {
										"type": "Int32",
										"value": "-1"
									},
									"DataFactoryName": {
										"type": "String",
										"value": {
											"value": "@pipeline().DataFactory",
											"type": "Expression"
										}
									},
									"ParentAuditID": {
										"type": "Int64",
										"value": "-1"
									},
									"PipelineName": {
										"type": "String",
										"value": {
											"value": "@pipeline().Pipeline",
											"type": "Expression"
										}
									},
									"PipelineRunID": {
										"type": "String",
										"value": {
											"value": "@pipeline().RunId",
											"type": "Expression"
										}
									},
									"PipelineTriggerID": {
										"type": "String",
										"value": {
											"value": "@pipeline().TriggerId",
											"type": "Expression"
										}
									},
									"PipelineTriggerName": {
										"type": "String",
										"value": {
											"value": "@pipeline().TriggerName",
											"type": "Expression"
										}
									},
									"PipelineTriggerType": {
										"type": "String",
										"value": {
											"value": "@pipeline().TriggerType",
											"type": "Expression"
										}
									}
								},
								"queryTimeout": "02:00:00",
								"partitionOption": "None"
							},
							"dataset": {
								"referenceName": "Briggs_MDW",
								"type": "DatasetReference",
								"parameters": {
									"schema_name": "dbo",
									"table_name": "user"
								}
							}
						}
					},
					{
						"name": "Sp_ExecFailureAudit_Fact",
						"type": "SqlServerStoredProcedure",
						"dependsOn": [
							{
								"activity": "ForEach_Fact",
								"dependencyConditions": [
									"Failed"
								]
							}
						],
						"policy": {
							"timeout": "7.00:00:00",
							"retry": 0,
							"retryIntervalInSeconds": 30,
							"secureOutput": false,
							"secureInput": false
						},
						"userProperties": [],
						"typeProperties": {
							"storedProcedureName": "[dbo].[proc_UpdateAuditLog]",
							"storedProcedureParameters": {
								"AuditID": {
									"value": {
										"value": "@activity('lkp_ExecStartAuditProc').output.firstRow.AuditID",
										"type": "Expression"
									},
									"type": "Int32"
								},
								"DataLakePath": {
									"value": null,
									"type": "String"
								},
								"PipelineRunID": {
									"value": {
										"value": "@pipeline().RunId",
										"type": "Expression"
									},
									"type": "String"
								},
								"RowsRead": {
									"value": null,
									"type": "Int64"
								},
								"Status": {
									"value": "Fact Proc Failed",
									"type": "String"
								}
							}
						},
						"linkedServiceName": {
							"referenceName": "AzureSqlDatabase1",
							"type": "LinkedServiceReference"
						}
					},
					{
						"name": "Sp_ExecSuccessAudit",
						"type": "SqlServerStoredProcedure",
						"dependsOn": [
							{
								"activity": "ForEach_Fact",
								"dependencyConditions": [
									"Succeeded"
								]
							}
						],
						"policy": {
							"timeout": "7.00:00:00",
							"retry": 0,
							"retryIntervalInSeconds": 30,
							"secureOutput": false,
							"secureInput": false
						},
						"userProperties": [],
						"typeProperties": {
							"storedProcedureName": "[dbo].[proc_UpdateAuditLog]",
							"storedProcedureParameters": {
								"AuditID": {
									"value": {
										"value": "@activity('lkp_ExecStartAuditProc').output.firstRow.AuditID",
										"type": "Expression"
									},
									"type": "Int32"
								},
								"DataLakePath": {
									"value": null,
									"type": "String"
								},
								"RowsRead": {
									"value": null,
									"type": "Int64"
								},
								"Status": {
									"value": "Success",
									"type": "String"
								},
								"PipelineRunID": {
									"value": {
										"value": "@pipeline().RunId",
										"type": "Expression"
									},
									"type": "String"
								}
							}
						},
						"linkedServiceName": {
							"referenceName": "AzureSqlDatabase1",
							"type": "LinkedServiceReference"
						}
					},
					{
						"name": "Sp_ExecFailureAudit_Stage",
						"type": "SqlServerStoredProcedure",
						"dependsOn": [
							{
								"activity": "ForEach_Stage",
								"dependencyConditions": [
									"Failed"
								]
							}
						],
						"policy": {
							"timeout": "7.00:00:00",
							"retry": 0,
							"retryIntervalInSeconds": 30,
							"secureOutput": false,
							"secureInput": false
						},
						"userProperties": [],
						"typeProperties": {
							"storedProcedureName": "[dbo].[proc_UpdateAuditLog]",
							"storedProcedureParameters": {
								"AuditID": {
									"value": {
										"value": "@activity('lkp_ExecStartAuditProc').output.firstRow.AuditID",
										"type": "Expression"
									},
									"type": "Int32"
								},
								"DataLakePath": {
									"value": null,
									"type": "String"
								},
								"PipelineRunID": {
									"value": {
										"value": "@pipeline().RunId",
										"type": "Expression"
									},
									"type": "String"
								},
								"RowsRead": {
									"value": null,
									"type": "Int64"
								},
								"Status": {
									"value": "Stage Proc Failed",
									"type": "String"
								}
							}
						},
						"linkedServiceName": {
							"referenceName": "AzureSqlDatabase1",
							"type": "LinkedServiceReference"
						}
					},
					{
						"name": "Sp_ExecFailureAudit_TL",
						"type": "SqlServerStoredProcedure",
						"dependsOn": [
							{
								"activity": "Execute Pipeline1",
								"dependencyConditions": [
									"Failed"
								]
							}
						],
						"policy": {
							"timeout": "7.00:00:00",
							"retry": 0,
							"retryIntervalInSeconds": 30,
							"secureOutput": false,
							"secureInput": false
						},
						"userProperties": [],
						"typeProperties": {
							"storedProcedureName": "[dbo].[proc_UpdateAuditLog]",
							"storedProcedureParameters": {
								"AuditID": {
									"value": {
										"value": "@activity('lkp_ExecStartAuditProc').output.firstRow.AuditID",
										"type": "Expression"
									},
									"type": "Int32"
								},
								"DataLakePath": {
									"value": null,
									"type": "String"
								},
								"PipelineRunID": {
									"value": {
										"value": "@pipeline().RunId",
										"type": "Expression"
									},
									"type": "String"
								},
								"RowsRead": {
									"value": null,
									"type": "Int64"
								},
								"Status": {
									"value": "Table Load Failed",
									"type": "String"
								}
							}
						},
						"linkedServiceName": {
							"referenceName": "AzureSqlDatabase1",
							"type": "LinkedServiceReference"
						}
					}
				],
				"policy": {
					"elapsedTimeMetric": {},
					"cancelAfter": {}
				},
				"variables": {
					"ErrorMsg": {
						"type": "String"
					}
				},
				"folder": {
					"name": "Briggs Data Load Theme wise"
				},
				"annotations": [],
				"lastPublishTime": "2022-04-27T10:31:44Z"
			},
			"dependsOn": [
				"[concat(variables('workspaceId'), '/pipelines/PL_Generic_Copy_GM')]",
				"[concat(variables('workspaceId'), '/datasets/Briggs_MDW')]",
				"[concat(variables('workspaceId'), '/linkedServices/AzureSqlDatabase1')]",
				"[concat(variables('workspaceId'), '/linkedServices/DS_MDW_SP')]"
			]
		},
		{
			"name": "[concat(parameters('workspaceName'), '/PL_Master_Briggs_Inventory')]",
			"type": "Microsoft.Synapse/workspaces/pipelines",
			"apiVersion": "2019-06-01-preview",
			"properties": {
				"activities": [
					{
						"name": "Execute Pipeline1",
						"type": "ExecutePipeline",
						"dependsOn": [
							{
								"activity": "lkp_ExecStartAuditProc",
								"dependencyConditions": [
									"Succeeded"
								]
							}
						],
						"userProperties": [],
						"typeProperties": {
							"pipeline": {
								"referenceName": "PL_Generic_Copy_Inventory",
								"type": "PipelineReference"
							},
							"waitOnCompletion": true,
							"parameters": {}
						}
					},
					{
						"name": "ReportStageProc",
						"type": "Lookup",
						"dependsOn": [
							{
								"activity": "Execute Pipeline1",
								"dependencyConditions": [
									"Succeeded"
								]
							}
						],
						"policy": {
							"timeout": "7.00:00:00",
							"retry": 0,
							"retryIntervalInSeconds": 30,
							"secureOutput": false,
							"secureInput": false
						},
						"userProperties": [],
						"typeProperties": {
							"source": {
								"type": "AzureSqlSource",
								"sqlReaderQuery": "select  * from dbo.control_table where processsequence = 2 and enableaction = 1 \nand subjectarea='Report Stage Inventory SP'\norder by id",
								"queryTimeout": "02:00:00",
								"partitionOption": "None"
							},
							"dataset": {
								"referenceName": "Briggs_MDW",
								"type": "DatasetReference",
								"parameters": {
									"schema_name": "dbo",
									"table_name": "user"
								}
							},
							"firstRowOnly": false
						}
					},
					{
						"name": "ForEach_Stage",
						"type": "ForEach",
						"dependsOn": [
							{
								"activity": "ReportStageProc",
								"dependencyConditions": [
									"Succeeded"
								]
							}
						],
						"userProperties": [],
						"typeProperties": {
							"items": {
								"value": "@activity('ReportStageProc').output.value",
								"type": "Expression"
							},
							"activities": [
								{
									"name": "Stored procedure1",
									"type": "SqlServerStoredProcedure",
									"dependsOn": [
										{
											"activity": "Start_Table_Audit_Stage",
											"dependencyConditions": [
												"Succeeded"
											]
										}
									],
									"policy": {
										"timeout": "7.00:00:00",
										"retry": 0,
										"retryIntervalInSeconds": 30,
										"secureOutput": false,
										"secureInput": false
									},
									"userProperties": [],
									"typeProperties": {
										"storedProcedureName": {
											"value": "@item().sourcetablename",
											"type": "Expression"
										}
									},
									"linkedServiceName": {
										"referenceName": "DS_MDW_SP",
										"type": "LinkedServiceReference"
									}
								},
								{
									"name": "Start_Table_Audit_Stage",
									"type": "Lookup",
									"dependsOn": [],
									"policy": {
										"timeout": "7.00:00:00",
										"retry": 0,
										"retryIntervalInSeconds": 30,
										"secureOutput": false,
										"secureInput": false
									},
									"userProperties": [],
									"typeProperties": {
										"source": {
											"type": "AzureSqlSource",
											"sqlReaderStoredProcedureName": "[dbo].[proc_StartAuditLog_Briggs]",
											"storedProcedureParameters": {
												"ConfigTableID": {
													"type": "Int32",
													"value": {
														"value": "@item().ID",
														"type": "Expression"
													}
												},
												"DataFactoryName": {
													"type": "String",
													"value": {
														"value": "@pipeline().DataFactory",
														"type": "Expression"
													}
												},
												"ParentAuditID": {
													"type": "Int64",
													"value": {
														"value": "@item().ID",
														"type": "Expression"
													}
												},
												"PipelineName": {
													"type": "String",
													"value": {
														"value": "@pipeline().Pipeline",
														"type": "Expression"
													}
												},
												"PipelineRunID": {
													"type": "String",
													"value": {
														"value": "@pipeline().RunId",
														"type": "Expression"
													}
												},
												"PipelineTriggerID": {
													"type": "String",
													"value": {
														"value": "@pipeline().TriggerId",
														"type": "Expression"
													}
												},
												"PipelineTriggerName": {
													"type": "String",
													"value": {
														"value": "@pipeline().TriggerName",
														"type": "Expression"
													}
												},
												"PipelineTriggerType": {
													"type": "String",
													"value": {
														"value": "@pipeline().TriggerType",
														"type": "Expression"
													}
												},
												"Sourcedb": {
													"type": "String",
													"value": {
														"value": "@item().sourceDB",
														"type": "Expression"
													}
												},
												"sourcetable": {
													"type": "String",
													"value": {
														"value": "@item().SourcetableName",
														"type": "Expression"
													}
												}
											},
											"queryTimeout": "02:00:00",
											"partitionOption": "None"
										},
										"dataset": {
											"referenceName": "Briggs_MDW",
											"type": "DatasetReference",
											"parameters": {
												"schema_name": "dbo",
												"table_name": "user"
											}
										},
										"firstRowOnly": false
									}
								},
								{
									"name": "Set variable_Stage",
									"type": "SetVariable",
									"dependsOn": [
										{
											"activity": "Stored procedure1",
											"dependencyConditions": [
												"Failed"
											]
										}
									],
									"userProperties": [],
									"typeProperties": {
										"variableName": "ErrorMsg",
										"value": {
											"value": "@activity('Stored procedure1').Error.Message",
											"type": "Expression"
										}
									}
								},
								{
									"name": "Failure_Audit_Log_Stage",
									"type": "SqlServerStoredProcedure",
									"dependsOn": [
										{
											"activity": "Set variable_Stage",
											"dependencyConditions": [
												"Succeeded"
											]
										}
									],
									"policy": {
										"timeout": "7.00:00:00",
										"retry": 0,
										"retryIntervalInSeconds": 30,
										"secureOutput": false,
										"secureInput": false
									},
									"userProperties": [],
									"typeProperties": {
										"storedProcedureName": "[dbo].[proc_UpdateAuditLog_Briggs]",
										"storedProcedureParameters": {
											"ConfigTableID": {
												"value": {
													"value": "@item().ID",
													"type": "Expression"
												},
												"type": "Int32"
											},
											"RowsRead": {
												"value": null,
												"type": "Int64"
											},
											"Status": {
												"value": {
													"value": "@variables('ErrorMsg')",
													"type": "Expression"
												},
												"type": "String"
											}
										}
									},
									"linkedServiceName": {
										"referenceName": "DS_MDW_SP",
										"type": "LinkedServiceReference"
									}
								},
								{
									"name": "Success_Audit_Log_Stage",
									"type": "SqlServerStoredProcedure",
									"dependsOn": [
										{
											"activity": "Stored procedure1",
											"dependencyConditions": [
												"Succeeded"
											]
										}
									],
									"policy": {
										"timeout": "7.00:00:00",
										"retry": 0,
										"retryIntervalInSeconds": 30,
										"secureOutput": false,
										"secureInput": false
									},
									"userProperties": [],
									"typeProperties": {
										"storedProcedureName": "[dbo].[proc_UpdateAuditLog_Briggs]",
										"storedProcedureParameters": {
											"ConfigTableID": {
												"value": {
													"value": "@item().ID",
													"type": "Expression"
												},
												"type": "Int32"
											},
											"RowsRead": {
												"value": null,
												"type": "Int64"
											},
											"Status": {
												"value": "Success",
												"type": "String"
											}
										}
									},
									"linkedServiceName": {
										"referenceName": "DS_MDW_SP",
										"type": "LinkedServiceReference"
									}
								}
							]
						}
					},
					{
						"name": "ReportFactProc",
						"type": "Lookup",
						"dependsOn": [
							{
								"activity": "ForEach_Stage",
								"dependencyConditions": [
									"Succeeded"
								]
							}
						],
						"policy": {
							"timeout": "7.00:00:00",
							"retry": 0,
							"retryIntervalInSeconds": 30,
							"secureOutput": false,
							"secureInput": false
						},
						"userProperties": [],
						"typeProperties": {
							"source": {
								"type": "AzureSqlSource",
								"sqlReaderQuery": "select  * from dbo.control_table where processsequence = 4 and enableaction = 1 \nand subjectarea='Report Fact Inventory SP'\norder by id",
								"queryTimeout": "02:00:00",
								"partitionOption": "None"
							},
							"dataset": {
								"referenceName": "Briggs_MDW",
								"type": "DatasetReference",
								"parameters": {
									"schema_name": "dbo",
									"table_name": "user"
								}
							},
							"firstRowOnly": false
						}
					},
					{
						"name": "ForEach_Fact",
						"type": "ForEach",
						"dependsOn": [
							{
								"activity": "ReportFactProc",
								"dependencyConditions": [
									"Succeeded"
								]
							}
						],
						"userProperties": [],
						"typeProperties": {
							"items": {
								"value": "@activity('ReportFactProc').output.value",
								"type": "Expression"
							},
							"activities": [
								{
									"name": "Stored procedure",
									"type": "SqlServerStoredProcedure",
									"dependsOn": [
										{
											"activity": "Start_Table_Audit1_Fact",
											"dependencyConditions": [
												"Succeeded"
											]
										}
									],
									"policy": {
										"timeout": "7.00:00:00",
										"retry": 0,
										"retryIntervalInSeconds": 30,
										"secureOutput": false,
										"secureInput": false
									},
									"userProperties": [],
									"typeProperties": {
										"storedProcedureName": {
											"value": "@item().sourcetablename",
											"type": "Expression"
										}
									},
									"linkedServiceName": {
										"referenceName": "DS_MDW_SP",
										"type": "LinkedServiceReference"
									}
								},
								{
									"name": "Start_Table_Audit1_Fact",
									"type": "Lookup",
									"dependsOn": [],
									"policy": {
										"timeout": "7.00:00:00",
										"retry": 0,
										"retryIntervalInSeconds": 30,
										"secureOutput": false,
										"secureInput": false
									},
									"userProperties": [],
									"typeProperties": {
										"source": {
											"type": "AzureSqlSource",
											"sqlReaderStoredProcedureName": "[dbo].[proc_StartAuditLog_Briggs]",
											"storedProcedureParameters": {
												"ConfigTableID": {
													"type": "Int32",
													"value": {
														"value": "@item().ID",
														"type": "Expression"
													}
												},
												"DataFactoryName": {
													"type": "String",
													"value": {
														"value": "@pipeline().DataFactory",
														"type": "Expression"
													}
												},
												"ParentAuditID": {
													"type": "Int64",
													"value": {
														"value": "@item().ID",
														"type": "Expression"
													}
												},
												"PipelineName": {
													"type": "String",
													"value": {
														"value": "@pipeline().Pipeline",
														"type": "Expression"
													}
												},
												"PipelineRunID": {
													"type": "String",
													"value": {
														"value": "@pipeline().RunId",
														"type": "Expression"
													}
												},
												"PipelineTriggerID": {
													"type": "String",
													"value": {
														"value": "@pipeline().TriggerId",
														"type": "Expression"
													}
												},
												"PipelineTriggerName": {
													"type": "String",
													"value": {
														"value": "@pipeline().TriggerName",
														"type": "Expression"
													}
												},
												"PipelineTriggerType": {
													"type": "String",
													"value": {
														"value": "@pipeline().TriggerType",
														"type": "Expression"
													}
												},
												"Sourcedb": {
													"type": "String",
													"value": {
														"value": "@item().sourceDB",
														"type": "Expression"
													}
												},
												"sourcetable": {
													"type": "String",
													"value": {
														"value": "@item().SourcetableName",
														"type": "Expression"
													}
												}
											},
											"queryTimeout": "02:00:00",
											"partitionOption": "None"
										},
										"dataset": {
											"referenceName": "Briggs_MDW",
											"type": "DatasetReference",
											"parameters": {
												"schema_name": "dbo",
												"table_name": "user"
											}
										},
										"firstRowOnly": false
									}
								},
								{
									"name": "Set variable1_Fact",
									"type": "SetVariable",
									"dependsOn": [
										{
											"activity": "Stored procedure",
											"dependencyConditions": [
												"Failed"
											]
										}
									],
									"userProperties": [],
									"typeProperties": {
										"variableName": "ErrorMsg",
										"value": {
											"value": "@activity('ReportStageProc').Error.Message",
											"type": "Expression"
										}
									}
								},
								{
									"name": "Failure_Audit_Log_Fact",
									"type": "SqlServerStoredProcedure",
									"dependsOn": [
										{
											"activity": "Set variable1_Fact",
											"dependencyConditions": [
												"Succeeded"
											]
										}
									],
									"policy": {
										"timeout": "7.00:00:00",
										"retry": 0,
										"retryIntervalInSeconds": 30,
										"secureOutput": false,
										"secureInput": false
									},
									"userProperties": [],
									"typeProperties": {
										"storedProcedureName": "[dbo].[proc_UpdateAuditLog_Briggs]",
										"storedProcedureParameters": {
											"ConfigTableID": {
												"value": {
													"value": "@item().ID",
													"type": "Expression"
												},
												"type": "Int32"
											},
											"RowsRead": {
												"value": null,
												"type": "Int64"
											},
											"Status": {
												"value": {
													"value": "@variables('ErrorMsg')",
													"type": "Expression"
												},
												"type": "String"
											}
										}
									},
									"linkedServiceName": {
										"referenceName": "DS_MDW_SP",
										"type": "LinkedServiceReference"
									}
								},
								{
									"name": "Success_Audit_Log2_Fact",
									"type": "SqlServerStoredProcedure",
									"dependsOn": [
										{
											"activity": "Stored procedure",
											"dependencyConditions": [
												"Succeeded"
											]
										}
									],
									"policy": {
										"timeout": "7.00:00:00",
										"retry": 0,
										"retryIntervalInSeconds": 30,
										"secureOutput": false,
										"secureInput": false
									},
									"userProperties": [],
									"typeProperties": {
										"storedProcedureName": "[dbo].[proc_UpdateAuditLog_Briggs]",
										"storedProcedureParameters": {
											"ConfigTableID": {
												"value": {
													"value": "@item().ID",
													"type": "Expression"
												},
												"type": "Int32"
											},
											"RowsRead": {
												"value": null,
												"type": "Int64"
											},
											"Status": {
												"value": "Success",
												"type": "String"
											}
										}
									},
									"linkedServiceName": {
										"referenceName": "DS_MDW_SP",
										"type": "LinkedServiceReference"
									}
								}
							]
						}
					},
					{
						"name": "lkp_ExecStartAuditProc",
						"type": "Lookup",
						"dependsOn": [],
						"policy": {
							"timeout": "7.00:00:00",
							"retry": 0,
							"retryIntervalInSeconds": 30,
							"secureOutput": false,
							"secureInput": false
						},
						"userProperties": [],
						"typeProperties": {
							"source": {
								"type": "AzureSqlSource",
								"sqlReaderStoredProcedureName": "[dbo].[proc_StartAuditLog]",
								"storedProcedureParameters": {
									"ConfigTableID": {
										"type": "Int32",
										"value": "-1"
									},
									"DataFactoryName": {
										"type": "String",
										"value": {
											"value": "@pipeline().DataFactory",
											"type": "Expression"
										}
									},
									"ParentAuditID": {
										"type": "Int64",
										"value": "-1"
									},
									"PipelineName": {
										"type": "String",
										"value": {
											"value": "@pipeline().Pipeline",
											"type": "Expression"
										}
									},
									"PipelineRunID": {
										"type": "String",
										"value": {
											"value": "@pipeline().RunId",
											"type": "Expression"
										}
									},
									"PipelineTriggerID": {
										"type": "String",
										"value": {
											"value": "@pipeline().TriggerId",
											"type": "Expression"
										}
									},
									"PipelineTriggerName": {
										"type": "String",
										"value": {
											"value": "@pipeline().TriggerName",
											"type": "Expression"
										}
									},
									"PipelineTriggerType": {
										"type": "String",
										"value": {
											"value": "@pipeline().TriggerType",
											"type": "Expression"
										}
									}
								},
								"queryTimeout": "02:00:00",
								"partitionOption": "None"
							},
							"dataset": {
								"referenceName": "Briggs_MDW",
								"type": "DatasetReference",
								"parameters": {
									"schema_name": "dbo",
									"table_name": "user"
								}
							}
						}
					},
					{
						"name": "Sp_ExecFailureAudit_Fact",
						"type": "SqlServerStoredProcedure",
						"dependsOn": [
							{
								"activity": "ForEach_Fact",
								"dependencyConditions": [
									"Failed"
								]
							}
						],
						"policy": {
							"timeout": "7.00:00:00",
							"retry": 0,
							"retryIntervalInSeconds": 30,
							"secureOutput": false,
							"secureInput": false
						},
						"userProperties": [],
						"typeProperties": {
							"storedProcedureName": "[dbo].[proc_UpdateAuditLog]",
							"storedProcedureParameters": {
								"AuditID": {
									"value": {
										"value": "@activity('lkp_ExecStartAuditProc').output.firstRow.AuditID",
										"type": "Expression"
									},
									"type": "Int32"
								},
								"DataLakePath": {
									"value": null,
									"type": "String"
								},
								"PipelineRunID": {
									"value": {
										"value": "@pipeline().RunId",
										"type": "Expression"
									},
									"type": "String"
								},
								"RowsRead": {
									"value": null,
									"type": "Int64"
								},
								"Status": {
									"value": "Fact Proc Failed",
									"type": "String"
								}
							}
						},
						"linkedServiceName": {
							"referenceName": "AzureSqlDatabase1",
							"type": "LinkedServiceReference"
						}
					},
					{
						"name": "Sp_ExecSuccessAudit",
						"type": "SqlServerStoredProcedure",
						"dependsOn": [
							{
								"activity": "ForEach_Fact",
								"dependencyConditions": [
									"Succeeded"
								]
							}
						],
						"policy": {
							"timeout": "7.00:00:00",
							"retry": 0,
							"retryIntervalInSeconds": 30,
							"secureOutput": false,
							"secureInput": false
						},
						"userProperties": [],
						"typeProperties": {
							"storedProcedureName": "[dbo].[proc_UpdateAuditLog]",
							"storedProcedureParameters": {
								"AuditID": {
									"value": {
										"value": "@activity('lkp_ExecStartAuditProc').output.firstRow.AuditID",
										"type": "Expression"
									},
									"type": "Int32"
								},
								"DataLakePath": {
									"value": null,
									"type": "String"
								},
								"RowsRead": {
									"value": null,
									"type": "Int64"
								},
								"Status": {
									"value": "Success",
									"type": "String"
								},
								"PipelineRunID": {
									"value": {
										"value": "@pipeline().RunId",
										"type": "Expression"
									},
									"type": "String"
								}
							}
						},
						"linkedServiceName": {
							"referenceName": "AzureSqlDatabase1",
							"type": "LinkedServiceReference"
						}
					},
					{
						"name": "Sp_ExecFailureAudit_Stage",
						"type": "SqlServerStoredProcedure",
						"dependsOn": [
							{
								"activity": "ForEach_Stage",
								"dependencyConditions": [
									"Failed"
								]
							}
						],
						"policy": {
							"timeout": "7.00:00:00",
							"retry": 0,
							"retryIntervalInSeconds": 30,
							"secureOutput": false,
							"secureInput": false
						},
						"userProperties": [],
						"typeProperties": {
							"storedProcedureName": "[dbo].[proc_UpdateAuditLog]",
							"storedProcedureParameters": {
								"AuditID": {
									"value": {
										"value": "@activity('lkp_ExecStartAuditProc').output.firstRow.AuditID",
										"type": "Expression"
									},
									"type": "Int32"
								},
								"DataLakePath": {
									"value": null,
									"type": "String"
								},
								"PipelineRunID": {
									"value": {
										"value": "@pipeline().RunId",
										"type": "Expression"
									},
									"type": "String"
								},
								"RowsRead": {
									"value": null,
									"type": "Int64"
								},
								"Status": {
									"value": "Stage Proc Failed",
									"type": "String"
								}
							}
						},
						"linkedServiceName": {
							"referenceName": "AzureSqlDatabase1",
							"type": "LinkedServiceReference"
						}
					},
					{
						"name": "Sp_ExecFailureAudit_TL",
						"type": "SqlServerStoredProcedure",
						"dependsOn": [
							{
								"activity": "Execute Pipeline1",
								"dependencyConditions": [
									"Failed"
								]
							}
						],
						"policy": {
							"timeout": "7.00:00:00",
							"retry": 0,
							"retryIntervalInSeconds": 30,
							"secureOutput": false,
							"secureInput": false
						},
						"userProperties": [],
						"typeProperties": {
							"storedProcedureName": "[dbo].[proc_UpdateAuditLog]",
							"storedProcedureParameters": {
								"AuditID": {
									"value": {
										"value": "@activity('lkp_ExecStartAuditProc').output.firstRow.AuditID",
										"type": "Expression"
									},
									"type": "Int32"
								},
								"DataLakePath": {
									"value": null,
									"type": "String"
								},
								"PipelineRunID": {
									"value": {
										"value": "@pipeline().RunId",
										"type": "Expression"
									},
									"type": "String"
								},
								"RowsRead": {
									"value": null,
									"type": "Int64"
								},
								"Status": {
									"value": "Table load Failed",
									"type": "String"
								}
							}
						},
						"linkedServiceName": {
							"referenceName": "AzureSqlDatabase1",
							"type": "LinkedServiceReference"
						}
					}
				],
				"policy": {
					"elapsedTimeMetric": {},
					"cancelAfter": {}
				},
				"variables": {
					"ErrorMsg": {
						"type": "String"
					}
				},
				"folder": {
					"name": "Briggs Data Load Theme wise"
				},
				"annotations": [],
				"lastPublishTime": "2022-04-27T10:31:53Z"
			},
			"dependsOn": [
				"[concat(variables('workspaceId'), '/pipelines/PL_Generic_Copy_Inventory')]",
				"[concat(variables('workspaceId'), '/datasets/Briggs_MDW')]",
				"[concat(variables('workspaceId'), '/linkedServices/AzureSqlDatabase1')]",
				"[concat(variables('workspaceId'), '/linkedServices/DS_MDW_SP')]"
			]
		},
		{
			"name": "[concat(parameters('workspaceName'), '/PL_Master_Briggs_Invoices')]",
			"type": "Microsoft.Synapse/workspaces/pipelines",
			"apiVersion": "2019-06-01-preview",
			"properties": {
				"activities": [
					{
						"name": "Execute Pipeline1",
						"type": "ExecutePipeline",
						"dependsOn": [
							{
								"activity": "lkp_ExecStartAuditProc",
								"dependencyConditions": [
									"Succeeded"
								]
							}
						],
						"userProperties": [],
						"typeProperties": {
							"pipeline": {
								"referenceName": "PL_Generic_Copy_Invoices",
								"type": "PipelineReference"
							},
							"waitOnCompletion": true,
							"parameters": {}
						}
					},
					{
						"name": "ReportStageProc",
						"type": "Lookup",
						"dependsOn": [
							{
								"activity": "Execute Pipeline1",
								"dependencyConditions": [
									"Succeeded"
								]
							}
						],
						"policy": {
							"timeout": "7.00:00:00",
							"retry": 0,
							"retryIntervalInSeconds": 30,
							"secureOutput": false,
							"secureInput": false
						},
						"userProperties": [],
						"typeProperties": {
							"source": {
								"type": "AzureSqlSource",
								"sqlReaderQuery": "select  * from dbo.control_table where processsequence = 2 and enableaction = 1 \nand subjectarea='Report Stage Invoices SP'\norder by id",
								"queryTimeout": "02:00:00",
								"partitionOption": "None"
							},
							"dataset": {
								"referenceName": "Briggs_MDW",
								"type": "DatasetReference",
								"parameters": {
									"schema_name": "dbo",
									"table_name": "user"
								}
							},
							"firstRowOnly": false
						}
					},
					{
						"name": "ForEach_Stage",
						"type": "ForEach",
						"dependsOn": [
							{
								"activity": "ReportStageProc",
								"dependencyConditions": [
									"Succeeded"
								]
							}
						],
						"userProperties": [],
						"typeProperties": {
							"items": {
								"value": "@activity('ReportStageProc').output.value",
								"type": "Expression"
							},
							"activities": [
								{
									"name": "Stored procedure1",
									"type": "SqlServerStoredProcedure",
									"dependsOn": [
										{
											"activity": "Start_Table_Audit_Stage",
											"dependencyConditions": [
												"Succeeded"
											]
										}
									],
									"policy": {
										"timeout": "7.00:00:00",
										"retry": 0,
										"retryIntervalInSeconds": 30,
										"secureOutput": false,
										"secureInput": false
									},
									"userProperties": [],
									"typeProperties": {
										"storedProcedureName": {
											"value": "@item().sourcetablename",
											"type": "Expression"
										}
									},
									"linkedServiceName": {
										"referenceName": "DS_MDW_SP",
										"type": "LinkedServiceReference"
									}
								},
								{
									"name": "Start_Table_Audit_Stage",
									"type": "Lookup",
									"dependsOn": [],
									"policy": {
										"timeout": "7.00:00:00",
										"retry": 0,
										"retryIntervalInSeconds": 30,
										"secureOutput": false,
										"secureInput": false
									},
									"userProperties": [],
									"typeProperties": {
										"source": {
											"type": "AzureSqlSource",
											"sqlReaderStoredProcedureName": "[dbo].[proc_StartAuditLog_Briggs]",
											"storedProcedureParameters": {
												"ConfigTableID": {
													"type": "Int32",
													"value": {
														"value": "@item().ID",
														"type": "Expression"
													}
												},
												"DataFactoryName": {
													"type": "String",
													"value": {
														"value": "@pipeline().DataFactory",
														"type": "Expression"
													}
												},
												"ParentAuditID": {
													"type": "Int64",
													"value": {
														"value": "@item().ID",
														"type": "Expression"
													}
												},
												"PipelineName": {
													"type": "String",
													"value": {
														"value": "@pipeline().Pipeline",
														"type": "Expression"
													}
												},
												"PipelineRunID": {
													"type": "String",
													"value": {
														"value": "@pipeline().RunId",
														"type": "Expression"
													}
												},
												"PipelineTriggerID": {
													"type": "String",
													"value": {
														"value": "@pipeline().TriggerId",
														"type": "Expression"
													}
												},
												"PipelineTriggerName": {
													"type": "String",
													"value": {
														"value": "@pipeline().TriggerName",
														"type": "Expression"
													}
												},
												"PipelineTriggerType": {
													"type": "String",
													"value": {
														"value": "@pipeline().TriggerType",
														"type": "Expression"
													}
												},
												"Sourcedb": {
													"type": "String",
													"value": {
														"value": "@item().sourceDB",
														"type": "Expression"
													}
												},
												"sourcetable": {
													"type": "String",
													"value": {
														"value": "@item().SourcetableName",
														"type": "Expression"
													}
												}
											},
											"queryTimeout": "02:00:00",
											"partitionOption": "None"
										},
										"dataset": {
											"referenceName": "Briggs_MDW",
											"type": "DatasetReference",
											"parameters": {
												"schema_name": "dbo",
												"table_name": "user"
											}
										},
										"firstRowOnly": false
									}
								},
								{
									"name": "Success_Audit_Log_Stage",
									"type": "SqlServerStoredProcedure",
									"dependsOn": [
										{
											"activity": "Stored procedure1",
											"dependencyConditions": [
												"Succeeded"
											]
										}
									],
									"policy": {
										"timeout": "7.00:00:00",
										"retry": 0,
										"retryIntervalInSeconds": 30,
										"secureOutput": false,
										"secureInput": false
									},
									"userProperties": [],
									"typeProperties": {
										"storedProcedureName": "[dbo].[proc_UpdateAuditLog_Briggs]",
										"storedProcedureParameters": {
											"ConfigTableID": {
												"value": {
													"value": "@item().ID",
													"type": "Expression"
												},
												"type": "Int32"
											},
											"RowsRead": {
												"value": null,
												"type": "Int64"
											},
											"Status": {
												"value": "Success",
												"type": "String"
											}
										}
									},
									"linkedServiceName": {
										"referenceName": "DS_MDW_SP",
										"type": "LinkedServiceReference"
									}
								},
								{
									"name": "Set variable_Stage",
									"type": "SetVariable",
									"dependsOn": [
										{
											"activity": "Stored procedure1",
											"dependencyConditions": [
												"Failed"
											]
										}
									],
									"userProperties": [],
									"typeProperties": {
										"variableName": "ErrorMsg",
										"value": {
											"value": "@activity('Stored procedure1').Error.Message",
											"type": "Expression"
										}
									}
								},
								{
									"name": "Failure_Audit_Log_Stage",
									"type": "SqlServerStoredProcedure",
									"dependsOn": [
										{
											"activity": "Set variable_Stage",
											"dependencyConditions": [
												"Succeeded"
											]
										}
									],
									"policy": {
										"timeout": "7.00:00:00",
										"retry": 0,
										"retryIntervalInSeconds": 30,
										"secureOutput": false,
										"secureInput": false
									},
									"userProperties": [],
									"typeProperties": {
										"storedProcedureName": "[dbo].[proc_UpdateAuditLog_Briggs]",
										"storedProcedureParameters": {
											"ConfigTableID": {
												"value": {
													"value": "@item().ID",
													"type": "Expression"
												},
												"type": "Int32"
											},
											"RowsRead": {
												"value": null,
												"type": "Int64"
											},
											"Status": {
												"value": {
													"value": "@variables('ErrorMsg')",
													"type": "Expression"
												},
												"type": "String"
											}
										}
									},
									"linkedServiceName": {
										"referenceName": "DS_MDW_SP",
										"type": "LinkedServiceReference"
									}
								}
							]
						}
					},
					{
						"name": "ReportFactProc",
						"type": "Lookup",
						"dependsOn": [
							{
								"activity": "ForEach_Stage",
								"dependencyConditions": [
									"Succeeded"
								]
							},
							{
								"activity": "Stage_Battery_Sales",
								"dependencyConditions": [
									"Succeeded"
								]
							}
						],
						"policy": {
							"timeout": "7.00:00:00",
							"retry": 0,
							"retryIntervalInSeconds": 30,
							"secureOutput": false,
							"secureInput": false
						},
						"userProperties": [],
						"typeProperties": {
							"source": {
								"type": "AzureSqlSource",
								"sqlReaderQuery": "select  * from dbo.control_table where processsequence = 4 and enableaction = 1 \nand subjectarea='Report Fact Invoices SP'\norder by id",
								"queryTimeout": "02:00:00",
								"partitionOption": "None"
							},
							"dataset": {
								"referenceName": "Briggs_MDW",
								"type": "DatasetReference",
								"parameters": {
									"schema_name": "dbo",
									"table_name": "user"
								}
							},
							"firstRowOnly": false
						}
					},
					{
						"name": "ForEach_Fact",
						"type": "ForEach",
						"dependsOn": [
							{
								"activity": "ReportFactProc",
								"dependencyConditions": [
									"Succeeded"
								]
							}
						],
						"userProperties": [],
						"typeProperties": {
							"items": {
								"value": "@activity('ReportFactProc').output.value",
								"type": "Expression"
							},
							"activities": [
								{
									"name": "Stored procedure",
									"type": "SqlServerStoredProcedure",
									"dependsOn": [
										{
											"activity": "Start_Table_Audit1_Fact",
											"dependencyConditions": [
												"Succeeded"
											]
										}
									],
									"policy": {
										"timeout": "7.00:00:00",
										"retry": 0,
										"retryIntervalInSeconds": 30,
										"secureOutput": false,
										"secureInput": false
									},
									"userProperties": [],
									"typeProperties": {
										"storedProcedureName": {
											"value": "@item().sourcetablename",
											"type": "Expression"
										}
									},
									"linkedServiceName": {
										"referenceName": "DS_MDW_SP",
										"type": "LinkedServiceReference"
									}
								},
								{
									"name": "Start_Table_Audit1_Fact",
									"type": "Lookup",
									"dependsOn": [],
									"policy": {
										"timeout": "7.00:00:00",
										"retry": 0,
										"retryIntervalInSeconds": 30,
										"secureOutput": false,
										"secureInput": false
									},
									"userProperties": [],
									"typeProperties": {
										"source": {
											"type": "AzureSqlSource",
											"sqlReaderStoredProcedureName": "[dbo].[proc_StartAuditLog_Briggs]",
											"storedProcedureParameters": {
												"ConfigTableID": {
													"type": "Int32",
													"value": {
														"value": "@item().ID",
														"type": "Expression"
													}
												},
												"DataFactoryName": {
													"type": "String",
													"value": {
														"value": "@pipeline().DataFactory",
														"type": "Expression"
													}
												},
												"ParentAuditID": {
													"type": "Int64",
													"value": {
														"value": "@item().ID",
														"type": "Expression"
													}
												},
												"PipelineName": {
													"type": "String",
													"value": {
														"value": "@pipeline().Pipeline",
														"type": "Expression"
													}
												},
												"PipelineRunID": {
													"type": "String",
													"value": {
														"value": "@pipeline().RunId",
														"type": "Expression"
													}
												},
												"PipelineTriggerID": {
													"type": "String",
													"value": {
														"value": "@pipeline().TriggerId",
														"type": "Expression"
													}
												},
												"PipelineTriggerName": {
													"type": "String",
													"value": {
														"value": "@pipeline().TriggerName",
														"type": "Expression"
													}
												},
												"PipelineTriggerType": {
													"type": "String",
													"value": {
														"value": "@pipeline().TriggerType",
														"type": "Expression"
													}
												},
												"Sourcedb": {
													"type": "String",
													"value": {
														"value": "@item().sourceDB",
														"type": "Expression"
													}
												},
												"sourcetable": {
													"type": "String",
													"value": {
														"value": "@item().SourcetableName",
														"type": "Expression"
													}
												}
											},
											"queryTimeout": "02:00:00",
											"partitionOption": "None"
										},
										"dataset": {
											"referenceName": "Briggs_MDW",
											"type": "DatasetReference",
											"parameters": {
												"schema_name": "dbo",
												"table_name": "user"
											}
										},
										"firstRowOnly": false
									}
								},
								{
									"name": "Success_Audit_Log2_Fact",
									"type": "SqlServerStoredProcedure",
									"dependsOn": [
										{
											"activity": "Stored procedure",
											"dependencyConditions": [
												"Succeeded"
											]
										}
									],
									"policy": {
										"timeout": "7.00:00:00",
										"retry": 0,
										"retryIntervalInSeconds": 30,
										"secureOutput": false,
										"secureInput": false
									},
									"userProperties": [],
									"typeProperties": {
										"storedProcedureName": "[dbo].[proc_UpdateAuditLog_Briggs]",
										"storedProcedureParameters": {
											"ConfigTableID": {
												"value": {
													"value": "@item().ID",
													"type": "Expression"
												},
												"type": "Int32"
											},
											"RowsRead": {
												"value": null,
												"type": "Int64"
											},
											"Status": {
												"value": "Success",
												"type": "String"
											}
										}
									},
									"linkedServiceName": {
										"referenceName": "DS_MDW_SP",
										"type": "LinkedServiceReference"
									}
								},
								{
									"name": "Set variable1_Fact",
									"type": "SetVariable",
									"dependsOn": [
										{
											"activity": "Stored procedure",
											"dependencyConditions": [
												"Failed"
											]
										}
									],
									"userProperties": [],
									"typeProperties": {
										"variableName": "ErrorMsg",
										"value": {
											"value": "@activity('ReportStageProc').Error.Message",
											"type": "Expression"
										}
									}
								},
								{
									"name": "Failure_Audit_Log_Fact",
									"type": "SqlServerStoredProcedure",
									"dependsOn": [
										{
											"activity": "Set variable1_Fact",
											"dependencyConditions": [
												"Succeeded"
											]
										}
									],
									"policy": {
										"timeout": "7.00:00:00",
										"retry": 0,
										"retryIntervalInSeconds": 30,
										"secureOutput": false,
										"secureInput": false
									},
									"userProperties": [],
									"typeProperties": {
										"storedProcedureName": "[dbo].[proc_UpdateAuditLog_Briggs]",
										"storedProcedureParameters": {
											"ConfigTableID": {
												"value": {
													"value": "@item().ID",
													"type": "Expression"
												},
												"type": "Int32"
											},
											"RowsRead": {
												"value": null,
												"type": "Int64"
											},
											"Status": {
												"value": {
													"value": "@variables('ErrorMsg')",
													"type": "Expression"
												},
												"type": "String"
											}
										}
									},
									"linkedServiceName": {
										"referenceName": "DS_MDW_SP",
										"type": "LinkedServiceReference"
									}
								}
							]
						}
					},
					{
						"name": "Stage_Battery_Sales",
						"type": "Copy",
						"dependsOn": [],
						"policy": {
							"timeout": "7.00:00:00",
							"retry": 0,
							"retryIntervalInSeconds": 30,
							"secureOutput": false,
							"secureInput": false
						},
						"userProperties": [],
						"typeProperties": {
							"source": {
								"type": "SqlServerSource",
								"sqlReaderQuery": "\nselect sl.SALESID sales_id\n\t\t,sl.INVENTREFID invent_ref_id\n\t\t,replace(replace(replace(sl.ITEMID,char(10),''),char(13),''),char(9),'') 'item_id'\n\t\t,sos.sos\n\t\t,sl.SALESQTY sales_qty\n\t\t,id.INVENTLOCATIONID invent_location_id\n\t\t,ddv.DISPLAYVALUE 'fin_branch'\n\t\t,svc.SVCCALLID svc_call_id\n\t\t,isnull(cij.INVOICEID,pij.PROJINVOICEID) 'invoice_id'\n\t\t,case \n\t\t\twhen st.SALESSTATUS = 2 then 'Delivered'\n\t\t\twhen st.SALESSTATUS = 3 then 'Invoiced'\n\t\tEnd 'sales_status'\n\t\t,sl.CREATEDDATETIME created_date_time\n\t\t,isnull(cij.invoicedate,pij.INVOICEDATE) 'invoice_date'\n\t\t,svcTypeTable.CALLTYPEID call_type_id\n\t\t,replace(replace(replace(sl.NAME,char(10),''),char(13),''),char(9),'') 'description'\n\t\t,pp.PARTPRICEGROUPID part_price_group_id\n\t\t,listprice.price 'list_price'\n\t\t,sl.SALESPRICE 'sale_price'\n\t\t,sl.COSTPRICE 'cost_price'\n\t\t,listprice.price * sl.SALESQTY 'extended_list_price'\n\t\t,sl.LINEAMOUNT 'extended_sale_price'\n\t\t,sl.COSTPRICE * sl.SALESQTY 'extended_cost'\n\t\t,sl.LINEAMOUNT-(sl.COSTPRICE * sl.SALESQTY) 'profit'\n\t\t,case\n\t\t\twhen sl.COSTPRICE * sl.SALESQTY <> 0 then (sl.LINEAMOUNT-(sl.COSTPRICE * sl.SALESQTY))/(sl.COSTPRICE * sl.SALESQTY)\n\t\t\telse '0'\n\t\tEnd 'markup'\n\t\t,case\n\t\t\twhen sl.LINEAMOUNT <> 0 then (sl.LINEAMOUNT-(sl.COSTPRICE * sl.SALESQTY))/(sl.LINEAMOUNT)\n\t\t\telse '0'\n\t\tEnd 'margin'\nfrom SALESLINE sl \nleft join XAP_SOURCEOFSUPPLY sos on sos.RECID = sl.SOSRECID\nleft join SALESTABLE st on st.SALESID = sl.SALESID\nleft join INVENTDIM id on sl.INVENTDIMID = id.INVENTDIMID\nleft join INVENTITEMLOCATION iil on iil.ITEMID = sl.ITEMID and iil.COUNTGROUPID = id.INVENTLOCATIONID\nleft join DEFAULTDIMENSIONVIEW ddv on ddv.DEFAULTDIMENSION = st.DEFAULTDIMENSION and ddv.DIMENSIONATTRIBUTEID = 5637145333\nleft join XAP_SVCCALLTABLE svc on svc.RECID = st.SVCCALLRECID\nleft join XAP_SVCCALLTYPETABLE svcTypeTable ON svc.CALLTYPEID = svcTypeTable.RECID\nleft join XAP_PARTPRICEGROUP pp on pp.RECID = st.PARTPRICEGROUPRECID\nleft join INVENTTABLEMODULE listprice on listprice.ITEMID = sl.ITEMID and MODULETYPE = 2\nleft join CUSTINVOICEJOUR cij on cij.SALESID = st.SALESID\nleft join (\tselect ddv.DISPLAYVALUE,a.INVOICEDATE,a.PROJINVOICEID from [briggs_mst].dbo.PROJINVOICEJOUR a\n\t\t\tleft join [briggs_mst].dbo.DEFAULTDIMENSIONVIEW ddv on ddv.DEFAULTDIMENSION = a.DEFAULTDIMENSION and ddv.DIMENSIONATTRIBUTEID = 5637145334) pij\n\t\t\ton pij.DISPLAYVALUE = st.PROJID\nwhere sos.RECID is not null\n\t--and sl.CREATEDDATETIME < '1/1/2018'\n\tand year(isnull(cij.invoicedate,pij.INVOICEDATE) )>='2020'-- between @startdate and @enddate\n\tand id.INVENTLOCATIONID like 'PTX%'\n\tand sl.ITEMID in ('550153956YALE','550027204YALE','150105670YALE','150113688YALE','150113684YALE','150113627YALE','150024862YALE','150113828YALE','T-110BATT','24-60BATT','3181082HYS','150024128YALE','582081261YALE','150113639YALE')\n\t--and pp.PARTPRICEGROUPID = 'STANDARD'\n\toption (recompile)",
								"queryTimeout": "02:00:00",
								"partitionOption": "None"
							},
							"sink": {
								"type": "AzureSqlSink",
								"preCopyScript": "truncate table briggs.Stage_Battery_Sales",
								"disableMetricsCollection": false
							},
							"enableStaging": false,
							"translator": {
								"type": "TabularTranslator",
								"mappings": [
									{
										"source": {
											"name": "sales_id",
											"type": "String",
											"physicalType": "nvarchar"
										},
										"sink": {
											"name": "sales_id",
											"type": "String",
											"physicalType": "nvarchar"
										}
									},
									{
										"source": {
											"name": "invent_ref_id",
											"type": "String",
											"physicalType": "nvarchar"
										},
										"sink": {
											"name": "invent_ref_id",
											"type": "String",
											"physicalType": "nvarchar"
										}
									},
									{
										"source": {
											"name": "item_id",
											"type": "String",
											"physicalType": "nvarchar"
										},
										"sink": {
											"name": "item_id",
											"type": "String",
											"physicalType": "nvarchar"
										}
									},
									{
										"source": {
											"name": "sos",
											"type": "String",
											"physicalType": "nvarchar"
										},
										"sink": {
											"name": "sos",
											"type": "String",
											"physicalType": "nvarchar"
										}
									},
									{
										"source": {
											"name": "sales_qty",
											"type": "Decimal",
											"physicalType": "decimal",
											"scale": 16,
											"precision": 32
										},
										"sink": {
											"name": "sales_qty",
											"type": "Decimal",
											"physicalType": "decimal",
											"scale": 16,
											"precision": 32
										}
									},
									{
										"source": {
											"name": "invent_location_id",
											"type": "String",
											"physicalType": "nvarchar"
										},
										"sink": {
											"name": "invent_location_id",
											"type": "String",
											"physicalType": "nvarchar"
										}
									},
									{
										"source": {
											"name": "fin_branch",
											"type": "String",
											"physicalType": "nvarchar"
										},
										"sink": {
											"name": "fin_branch",
											"type": "String",
											"physicalType": "nvarchar"
										}
									},
									{
										"source": {
											"name": "svc_call_id",
											"type": "String",
											"physicalType": "nvarchar"
										},
										"sink": {
											"name": "svc_call_id",
											"type": "String",
											"physicalType": "nvarchar"
										}
									},
									{
										"source": {
											"name": "invoice_id",
											"type": "String",
											"physicalType": "nvarchar"
										},
										"sink": {
											"name": "invoice_id",
											"type": "String",
											"physicalType": "nvarchar"
										}
									},
									{
										"source": {
											"name": "sales_status",
											"type": "String",
											"physicalType": "varchar"
										},
										"sink": {
											"name": "sales_status",
											"type": "String",
											"physicalType": "varchar"
										}
									},
									{
										"source": {
											"name": "created_date_time",
											"type": "DateTime",
											"physicalType": "datetime"
										},
										"sink": {
											"name": "created_date_time",
											"type": "DateTime",
											"physicalType": "datetime"
										}
									},
									{
										"source": {
											"name": "invoice_date",
											"type": "DateTime",
											"physicalType": "datetime"
										},
										"sink": {
											"name": "invoice_date",
											"type": "DateTime",
											"physicalType": "datetime"
										}
									},
									{
										"source": {
											"name": "call_type_id",
											"type": "String",
											"physicalType": "nvarchar"
										},
										"sink": {
											"name": "call_type_id",
											"type": "String",
											"physicalType": "nvarchar"
										}
									},
									{
										"source": {
											"name": "description",
											"type": "String",
											"physicalType": "nvarchar"
										},
										"sink": {
											"name": "description",
											"type": "String",
											"physicalType": "nvarchar"
										}
									},
									{
										"source": {
											"name": "part_price_group_id",
											"type": "String",
											"physicalType": "nvarchar"
										},
										"sink": {
											"name": "part_price_group_id",
											"type": "String",
											"physicalType": "nvarchar"
										}
									},
									{
										"source": {
											"name": "list_price",
											"type": "Decimal",
											"physicalType": "decimal",
											"scale": 16,
											"precision": 32
										},
										"sink": {
											"name": "list_price",
											"type": "Decimal",
											"physicalType": "decimal",
											"scale": 16,
											"precision": 32
										}
									},
									{
										"source": {
											"name": "sale_price",
											"type": "Decimal",
											"physicalType": "decimal",
											"scale": 16,
											"precision": 32
										},
										"sink": {
											"name": "sale_price",
											"type": "Decimal",
											"physicalType": "decimal",
											"scale": 16,
											"precision": 32
										}
									},
									{
										"source": {
											"name": "cost_price",
											"type": "Decimal",
											"physicalType": "decimal",
											"scale": 16,
											"precision": 32
										},
										"sink": {
											"name": "cost_price",
											"type": "Decimal",
											"physicalType": "decimal",
											"scale": 16,
											"precision": 32
										}
									},
									{
										"source": {
											"name": "extended_list_price",
											"type": "Decimal",
											"physicalType": "decimal",
											"scale": 6,
											"precision": 38
										},
										"sink": {
											"name": "extended_list_price",
											"type": "Decimal",
											"physicalType": "decimal",
											"scale": 6,
											"precision": 38
										}
									},
									{
										"source": {
											"name": "extended_sale_price",
											"type": "Decimal",
											"physicalType": "decimal",
											"scale": 16,
											"precision": 32
										},
										"sink": {
											"name": "extended_sale_price",
											"type": "Decimal",
											"physicalType": "decimal",
											"scale": 16,
											"precision": 32
										}
									},
									{
										"source": {
											"name": "extended_cost",
											"type": "Decimal",
											"physicalType": "decimal",
											"scale": 6,
											"precision": 38
										},
										"sink": {
											"name": "extended_cost",
											"type": "Decimal",
											"physicalType": "decimal",
											"scale": 6,
											"precision": 38
										}
									},
									{
										"source": {
											"name": "profit",
											"type": "Decimal",
											"physicalType": "decimal",
											"scale": 6,
											"precision": 38
										},
										"sink": {
											"name": "profit",
											"type": "Decimal",
											"physicalType": "decimal",
											"scale": 6,
											"precision": 38
										}
									},
									{
										"source": {
											"name": "markup",
											"type": "Decimal",
											"physicalType": "decimal",
											"scale": 6,
											"precision": 38
										},
										"sink": {
											"name": "markup",
											"type": "Decimal",
											"physicalType": "decimal",
											"scale": 6,
											"precision": 38
										}
									},
									{
										"source": {
											"name": "margin",
											"type": "Decimal",
											"physicalType": "decimal",
											"scale": 6,
											"precision": 38
										},
										"sink": {
											"name": "margin",
											"type": "Decimal",
											"physicalType": "decimal",
											"scale": 6,
											"precision": 38
										}
									}
								],
								"typeConversion": true,
								"typeConversionSettings": {
									"allowDataTruncation": true,
									"treatBooleanAsNumber": false
								}
							}
						},
						"inputs": [
							{
								"referenceName": "Briggs_MST",
								"type": "DatasetReference",
								"parameters": {}
							}
						],
						"outputs": [
							{
								"referenceName": "Briggs_MDW",
								"type": "DatasetReference",
								"parameters": {
									"schema_name": "Briggs",
									"table_name": "Stage_Battery_Sales"
								}
							}
						]
					},
					{
						"name": "Sp_ExecFailureAudit_Fact",
						"type": "SqlServerStoredProcedure",
						"dependsOn": [
							{
								"activity": "ForEach_Fact",
								"dependencyConditions": [
									"Failed"
								]
							}
						],
						"policy": {
							"timeout": "7.00:00:00",
							"retry": 0,
							"retryIntervalInSeconds": 30,
							"secureOutput": false,
							"secureInput": false
						},
						"userProperties": [],
						"typeProperties": {
							"storedProcedureName": "[dbo].[proc_UpdateAuditLog]",
							"storedProcedureParameters": {
								"AuditID": {
									"value": {
										"value": "@activity('lkp_ExecStartAuditProc').output.firstRow.AuditID",
										"type": "Expression"
									},
									"type": "Int32"
								},
								"DataLakePath": {
									"value": null,
									"type": "String"
								},
								"PipelineRunID": {
									"value": {
										"value": "@pipeline().RunId",
										"type": "Expression"
									},
									"type": "String"
								},
								"RowsRead": {
									"value": null,
									"type": "Int64"
								},
								"Status": {
									"value": "Fact Proc Failed",
									"type": "String"
								}
							}
						},
						"linkedServiceName": {
							"referenceName": "AzureSqlDatabase1",
							"type": "LinkedServiceReference"
						}
					},
					{
						"name": "Sp_ExecSuccessAudit",
						"type": "SqlServerStoredProcedure",
						"dependsOn": [
							{
								"activity": "ForEach_Fact",
								"dependencyConditions": [
									"Succeeded"
								]
							}
						],
						"policy": {
							"timeout": "7.00:00:00",
							"retry": 0,
							"retryIntervalInSeconds": 30,
							"secureOutput": false,
							"secureInput": false
						},
						"userProperties": [],
						"typeProperties": {
							"storedProcedureName": "[dbo].[proc_UpdateAuditLog]",
							"storedProcedureParameters": {
								"AuditID": {
									"value": {
										"value": "@activity('lkp_ExecStartAuditProc').output.firstRow.AuditID",
										"type": "Expression"
									},
									"type": "Int32"
								},
								"DataLakePath": {
									"value": null,
									"type": "String"
								},
								"RowsRead": {
									"value": null,
									"type": "Int64"
								},
								"Status": {
									"value": "Success",
									"type": "String"
								},
								"PipelineRunID": {
									"value": {
										"value": "@pipeline().RunId",
										"type": "Expression"
									},
									"type": "String"
								}
							}
						},
						"linkedServiceName": {
							"referenceName": "AzureSqlDatabase1",
							"type": "LinkedServiceReference"
						}
					},
					{
						"name": "lkp_ExecStartAuditProc",
						"type": "Lookup",
						"dependsOn": [],
						"policy": {
							"timeout": "7.00:00:00",
							"retry": 0,
							"retryIntervalInSeconds": 30,
							"secureOutput": false,
							"secureInput": false
						},
						"userProperties": [],
						"typeProperties": {
							"source": {
								"type": "AzureSqlSource",
								"sqlReaderStoredProcedureName": "[dbo].[proc_StartAuditLog]",
								"storedProcedureParameters": {
									"ConfigTableID": {
										"type": "Int32",
										"value": "-1"
									},
									"DataFactoryName": {
										"type": "String",
										"value": {
											"value": "@pipeline().DataFactory",
											"type": "Expression"
										}
									},
									"ParentAuditID": {
										"type": "Int64",
										"value": "-1"
									},
									"PipelineName": {
										"type": "String",
										"value": {
											"value": "@pipeline().Pipeline",
											"type": "Expression"
										}
									},
									"PipelineRunID": {
										"type": "String",
										"value": {
											"value": "@pipeline().RunId",
											"type": "Expression"
										}
									},
									"PipelineTriggerID": {
										"type": "String",
										"value": {
											"value": "@pipeline().TriggerId",
											"type": "Expression"
										}
									},
									"PipelineTriggerName": {
										"type": "String",
										"value": {
											"value": "@pipeline().TriggerName",
											"type": "Expression"
										}
									},
									"PipelineTriggerType": {
										"type": "String",
										"value": {
											"value": "@pipeline().TriggerType",
											"type": "Expression"
										}
									}
								},
								"queryTimeout": "02:00:00",
								"partitionOption": "None"
							},
							"dataset": {
								"referenceName": "Briggs_MDW",
								"type": "DatasetReference",
								"parameters": {
									"schema_name": "dbo",
									"table_name": "user"
								}
							}
						}
					},
					{
						"name": "Sp_ExecFailureAudit_Stage",
						"type": "SqlServerStoredProcedure",
						"dependsOn": [
							{
								"activity": "ForEach_Stage",
								"dependencyConditions": [
									"Failed"
								]
							}
						],
						"policy": {
							"timeout": "7.00:00:00",
							"retry": 0,
							"retryIntervalInSeconds": 30,
							"secureOutput": false,
							"secureInput": false
						},
						"userProperties": [],
						"typeProperties": {
							"storedProcedureName": "[dbo].[proc_UpdateAuditLog]",
							"storedProcedureParameters": {
								"AuditID": {
									"value": {
										"value": "@activity('lkp_ExecStartAuditProc').output.firstRow.AuditID",
										"type": "Expression"
									},
									"type": "Int32"
								},
								"DataLakePath": {
									"value": null,
									"type": "String"
								},
								"PipelineRunID": {
									"value": {
										"value": "@pipeline().RunId",
										"type": "Expression"
									},
									"type": "String"
								},
								"RowsRead": {
									"value": null,
									"type": "Int64"
								},
								"Status": {
									"value": "Stage Proc Failed",
									"type": "String"
								}
							}
						},
						"linkedServiceName": {
							"referenceName": "AzureSqlDatabase1",
							"type": "LinkedServiceReference"
						}
					},
					{
						"name": "Sp_ExecFailureAudit_TL",
						"type": "SqlServerStoredProcedure",
						"dependsOn": [
							{
								"activity": "Execute Pipeline1",
								"dependencyConditions": [
									"Failed"
								]
							}
						],
						"policy": {
							"timeout": "7.00:00:00",
							"retry": 0,
							"retryIntervalInSeconds": 30,
							"secureOutput": false,
							"secureInput": false
						},
						"userProperties": [],
						"typeProperties": {
							"storedProcedureName": "[dbo].[proc_UpdateAuditLog]",
							"storedProcedureParameters": {
								"AuditID": {
									"value": {
										"value": "@activity('lkp_ExecStartAuditProc').output.firstRow.AuditID",
										"type": "Expression"
									},
									"type": "Int32"
								},
								"DataLakePath": {
									"value": null,
									"type": "String"
								},
								"PipelineRunID": {
									"value": {
										"value": "@pipeline().RunId",
										"type": "Expression"
									},
									"type": "String"
								},
								"RowsRead": {
									"value": null,
									"type": "Int64"
								},
								"Status": {
									"value": "Table Load Failed",
									"type": "String"
								}
							}
						},
						"linkedServiceName": {
							"referenceName": "AzureSqlDatabase1",
							"type": "LinkedServiceReference"
						}
					}
				],
				"policy": {
					"elapsedTimeMetric": {},
					"cancelAfter": {}
				},
				"variables": {
					"ErrorMsg": {
						"type": "String"
					}
				},
				"folder": {
					"name": "Briggs Data Load Theme wise"
				},
				"annotations": [],
				"lastPublishTime": "2022-04-27T10:31:50Z"
			},
			"dependsOn": [
				"[concat(variables('workspaceId'), '/pipelines/PL_Generic_Copy_Invoices')]",
				"[concat(variables('workspaceId'), '/datasets/Briggs_MDW')]",
				"[concat(variables('workspaceId'), '/datasets/Briggs_MST')]",
				"[concat(variables('workspaceId'), '/linkedServices/AzureSqlDatabase1')]",
				"[concat(variables('workspaceId'), '/linkedServices/DS_MDW_SP')]"
			]
		},
		{
			"name": "[concat(parameters('workspaceName'), '/PL_Master_Briggs_Misc')]",
			"type": "Microsoft.Synapse/workspaces/pipelines",
			"apiVersion": "2019-06-01-preview",
			"properties": {
				"activities": [
					{
						"name": "PL_Generic_Copy_Misc",
						"type": "ExecutePipeline",
						"dependsOn": [
							{
								"activity": "lkp_ExecStartAuditProc",
								"dependencyConditions": [
									"Succeeded"
								]
							}
						],
						"userProperties": [],
						"typeProperties": {
							"pipeline": {
								"referenceName": "PL_Generic_Copy_Misc",
								"type": "PipelineReference"
							},
							"waitOnCompletion": true,
							"parameters": {}
						}
					},
					{
						"name": "ReportStageProc",
						"type": "Lookup",
						"dependsOn": [
							{
								"activity": "PL_Generic_Copy_Misc",
								"dependencyConditions": [
									"Succeeded"
								]
							}
						],
						"policy": {
							"timeout": "7.00:00:00",
							"retry": 0,
							"retryIntervalInSeconds": 30,
							"secureOutput": false,
							"secureInput": false
						},
						"userProperties": [],
						"typeProperties": {
							"source": {
								"type": "AzureSqlSource",
								"sqlReaderQuery": "select  * from dbo.control_table where processsequence = 2 and enableaction = 1 \nand subjectarea='Report Stage Misc SP'\norder by id",
								"queryTimeout": "02:00:00",
								"partitionOption": "None"
							},
							"dataset": {
								"referenceName": "Briggs_MDW",
								"type": "DatasetReference",
								"parameters": {
									"schema_name": "dbo",
									"table_name": "user"
								}
							},
							"firstRowOnly": false
						}
					},
					{
						"name": "ForEach_Stage",
						"type": "ForEach",
						"dependsOn": [
							{
								"activity": "ReportStageProc",
								"dependencyConditions": [
									"Succeeded"
								]
							}
						],
						"userProperties": [],
						"typeProperties": {
							"items": {
								"value": "@activity('ReportStageProc').output.value",
								"type": "Expression"
							},
							"activities": [
								{
									"name": "Stored procedure1",
									"type": "SqlServerStoredProcedure",
									"dependsOn": [
										{
											"activity": "Start_Table_Audit_Stage",
											"dependencyConditions": [
												"Succeeded"
											]
										}
									],
									"policy": {
										"timeout": "7.00:00:00",
										"retry": 0,
										"retryIntervalInSeconds": 30,
										"secureOutput": false,
										"secureInput": false
									},
									"userProperties": [],
									"typeProperties": {
										"storedProcedureName": {
											"value": "@item().sourcetablename",
											"type": "Expression"
										}
									},
									"linkedServiceName": {
										"referenceName": "DS_MDW_SP",
										"type": "LinkedServiceReference"
									}
								},
								{
									"name": "Start_Table_Audit_Stage",
									"type": "Lookup",
									"dependsOn": [],
									"policy": {
										"timeout": "7.00:00:00",
										"retry": 0,
										"retryIntervalInSeconds": 30,
										"secureOutput": false,
										"secureInput": false
									},
									"userProperties": [],
									"typeProperties": {
										"source": {
											"type": "AzureSqlSource",
											"sqlReaderStoredProcedureName": "[dbo].[proc_StartAuditLog_Briggs]",
											"storedProcedureParameters": {
												"ConfigTableID": {
													"type": "Int32",
													"value": {
														"value": "@item().ID",
														"type": "Expression"
													}
												},
												"DataFactoryName": {
													"type": "String",
													"value": {
														"value": "@pipeline().DataFactory",
														"type": "Expression"
													}
												},
												"ParentAuditID": {
													"type": "Int64",
													"value": {
														"value": "@item().ID",
														"type": "Expression"
													}
												},
												"PipelineName": {
													"type": "String",
													"value": {
														"value": "@pipeline().Pipeline",
														"type": "Expression"
													}
												},
												"PipelineRunID": {
													"type": "String",
													"value": {
														"value": "@pipeline().RunId",
														"type": "Expression"
													}
												},
												"PipelineTriggerID": {
													"type": "String",
													"value": {
														"value": "@pipeline().TriggerId",
														"type": "Expression"
													}
												},
												"PipelineTriggerName": {
													"type": "String",
													"value": {
														"value": "@pipeline().TriggerName",
														"type": "Expression"
													}
												},
												"PipelineTriggerType": {
													"type": "String",
													"value": {
														"value": "@pipeline().TriggerType",
														"type": "Expression"
													}
												},
												"Sourcedb": {
													"type": "String",
													"value": {
														"value": "@item().sourceDB",
														"type": "Expression"
													}
												},
												"sourcetable": {
													"type": "String",
													"value": {
														"value": "@item().SourcetableName",
														"type": "Expression"
													}
												}
											},
											"queryTimeout": "02:00:00",
											"partitionOption": "None"
										},
										"dataset": {
											"referenceName": "Briggs_MDW",
											"type": "DatasetReference",
											"parameters": {
												"schema_name": "dbo",
												"table_name": "user"
											}
										},
										"firstRowOnly": false
									}
								},
								{
									"name": "Set variable_Stage",
									"type": "SetVariable",
									"dependsOn": [
										{
											"activity": "Stored procedure1",
											"dependencyConditions": [
												"Failed"
											]
										}
									],
									"userProperties": [],
									"typeProperties": {
										"variableName": "ErrorMsg",
										"value": {
											"value": "@activity('Stored procedure1').Error.Message",
											"type": "Expression"
										}
									}
								},
								{
									"name": "Failure_Audit_Log_Stage",
									"type": "SqlServerStoredProcedure",
									"dependsOn": [
										{
											"activity": "Set variable_Stage",
											"dependencyConditions": [
												"Succeeded"
											]
										}
									],
									"policy": {
										"timeout": "7.00:00:00",
										"retry": 0,
										"retryIntervalInSeconds": 30,
										"secureOutput": false,
										"secureInput": false
									},
									"userProperties": [],
									"typeProperties": {
										"storedProcedureName": "[dbo].[proc_UpdateAuditLog_Briggs]",
										"storedProcedureParameters": {
											"ConfigTableID": {
												"value": {
													"value": "@item().ID",
													"type": "Expression"
												},
												"type": "Int32"
											},
											"RowsRead": {
												"value": null,
												"type": "Int64"
											},
											"Status": {
												"value": {
													"value": "@variables('ErrorMsg')",
													"type": "Expression"
												},
												"type": "String"
											}
										}
									},
									"linkedServiceName": {
										"referenceName": "DS_MDW_SP",
										"type": "LinkedServiceReference"
									}
								},
								{
									"name": "Success_Audit_Log_Stage",
									"type": "SqlServerStoredProcedure",
									"dependsOn": [
										{
											"activity": "Stored procedure1",
											"dependencyConditions": [
												"Succeeded"
											]
										}
									],
									"policy": {
										"timeout": "7.00:00:00",
										"retry": 0,
										"retryIntervalInSeconds": 30,
										"secureOutput": false,
										"secureInput": false
									},
									"userProperties": [],
									"typeProperties": {
										"storedProcedureName": "[dbo].[proc_UpdateAuditLog_Briggs]",
										"storedProcedureParameters": {
											"ConfigTableID": {
												"value": {
													"value": "@item().ID",
													"type": "Expression"
												},
												"type": "Int32"
											},
											"RowsRead": {
												"value": null,
												"type": "Int64"
											},
											"Status": {
												"value": "Success",
												"type": "String"
											}
										}
									},
									"linkedServiceName": {
										"referenceName": "DS_MDW_SP",
										"type": "LinkedServiceReference"
									}
								}
							]
						}
					},
					{
						"name": "ReportFactProc",
						"type": "Lookup",
						"dependsOn": [
							{
								"activity": "ForEach_Stage",
								"dependencyConditions": [
									"Succeeded"
								]
							}
						],
						"policy": {
							"timeout": "7.00:00:00",
							"retry": 0,
							"retryIntervalInSeconds": 30,
							"secureOutput": false,
							"secureInput": false
						},
						"userProperties": [],
						"typeProperties": {
							"source": {
								"type": "AzureSqlSource",
								"sqlReaderQuery": "select  * from dbo.control_table where processsequence = 4 and enableaction = 1 \nand subjectarea='Report Fact Misc SP'\norder by id",
								"queryTimeout": "02:00:00",
								"partitionOption": "None"
							},
							"dataset": {
								"referenceName": "Briggs_MDW",
								"type": "DatasetReference",
								"parameters": {
									"schema_name": "dbo",
									"table_name": "user"
								}
							},
							"firstRowOnly": false
						}
					},
					{
						"name": "ForEach_Fact",
						"type": "ForEach",
						"dependsOn": [
							{
								"activity": "ReportFactProc",
								"dependencyConditions": [
									"Succeeded"
								]
							}
						],
						"userProperties": [],
						"typeProperties": {
							"items": {
								"value": "@activity('ReportFactProc').output.value",
								"type": "Expression"
							},
							"activities": [
								{
									"name": "Stored procedure",
									"type": "SqlServerStoredProcedure",
									"dependsOn": [
										{
											"activity": "Start_Table_Audit1_Fact",
											"dependencyConditions": [
												"Succeeded"
											]
										}
									],
									"policy": {
										"timeout": "7.00:00:00",
										"retry": 0,
										"retryIntervalInSeconds": 30,
										"secureOutput": false,
										"secureInput": false
									},
									"userProperties": [],
									"typeProperties": {
										"storedProcedureName": {
											"value": "@item().sourcetablename",
											"type": "Expression"
										}
									},
									"linkedServiceName": {
										"referenceName": "DS_MDW_SP",
										"type": "LinkedServiceReference"
									}
								},
								{
									"name": "Start_Table_Audit1_Fact",
									"type": "Lookup",
									"dependsOn": [],
									"policy": {
										"timeout": "7.00:00:00",
										"retry": 0,
										"retryIntervalInSeconds": 30,
										"secureOutput": false,
										"secureInput": false
									},
									"userProperties": [],
									"typeProperties": {
										"source": {
											"type": "AzureSqlSource",
											"sqlReaderStoredProcedureName": "[dbo].[proc_StartAuditLog_Briggs]",
											"storedProcedureParameters": {
												"ConfigTableID": {
													"type": "Int32",
													"value": {
														"value": "@item().ID",
														"type": "Expression"
													}
												},
												"DataFactoryName": {
													"type": "String",
													"value": {
														"value": "@pipeline().DataFactory",
														"type": "Expression"
													}
												},
												"ParentAuditID": {
													"type": "Int64",
													"value": {
														"value": "@item().ID",
														"type": "Expression"
													}
												},
												"PipelineName": {
													"type": "String",
													"value": {
														"value": "@pipeline().Pipeline",
														"type": "Expression"
													}
												},
												"PipelineRunID": {
													"type": "String",
													"value": {
														"value": "@pipeline().RunId",
														"type": "Expression"
													}
												},
												"PipelineTriggerID": {
													"type": "String",
													"value": {
														"value": "@pipeline().TriggerId",
														"type": "Expression"
													}
												},
												"PipelineTriggerName": {
													"type": "String",
													"value": {
														"value": "@pipeline().TriggerName",
														"type": "Expression"
													}
												},
												"PipelineTriggerType": {
													"type": "String",
													"value": {
														"value": "@pipeline().TriggerType",
														"type": "Expression"
													}
												},
												"Sourcedb": {
													"type": "String",
													"value": {
														"value": "@item().sourceDB",
														"type": "Expression"
													}
												},
												"sourcetable": {
													"type": "String",
													"value": {
														"value": "@item().SourcetableName",
														"type": "Expression"
													}
												}
											},
											"queryTimeout": "02:00:00",
											"partitionOption": "None"
										},
										"dataset": {
											"referenceName": "Briggs_MDW",
											"type": "DatasetReference",
											"parameters": {
												"schema_name": "dbo",
												"table_name": "user"
											}
										},
										"firstRowOnly": false
									}
								},
								{
									"name": "Set variable1_Fact",
									"type": "SetVariable",
									"dependsOn": [
										{
											"activity": "Stored procedure",
											"dependencyConditions": [
												"Failed"
											]
										}
									],
									"userProperties": [],
									"typeProperties": {
										"variableName": "ErrorMsg",
										"value": {
											"value": "@activity('ReportStageProc').Error.Message",
											"type": "Expression"
										}
									}
								},
								{
									"name": "Failure_Audit_Log_Fact",
									"type": "SqlServerStoredProcedure",
									"dependsOn": [
										{
											"activity": "Set variable1_Fact",
											"dependencyConditions": [
												"Succeeded"
											]
										}
									],
									"policy": {
										"timeout": "7.00:00:00",
										"retry": 0,
										"retryIntervalInSeconds": 30,
										"secureOutput": false,
										"secureInput": false
									},
									"userProperties": [],
									"typeProperties": {
										"storedProcedureName": "[dbo].[proc_UpdateAuditLog_Briggs]",
										"storedProcedureParameters": {
											"ConfigTableID": {
												"value": {
													"value": "@item().ID",
													"type": "Expression"
												},
												"type": "Int32"
											},
											"RowsRead": {
												"value": null,
												"type": "Int64"
											},
											"Status": {
												"value": {
													"value": "@variables('ErrorMsg')",
													"type": "Expression"
												},
												"type": "String"
											}
										}
									},
									"linkedServiceName": {
										"referenceName": "DS_MDW_SP",
										"type": "LinkedServiceReference"
									}
								},
								{
									"name": "Success_Audit_Log2_Fact",
									"type": "SqlServerStoredProcedure",
									"dependsOn": [
										{
											"activity": "Stored procedure",
											"dependencyConditions": [
												"Succeeded"
											]
										}
									],
									"policy": {
										"timeout": "7.00:00:00",
										"retry": 0,
										"retryIntervalInSeconds": 30,
										"secureOutput": false,
										"secureInput": false
									},
									"userProperties": [],
									"typeProperties": {
										"storedProcedureName": "[dbo].[proc_UpdateAuditLog_Briggs]",
										"storedProcedureParameters": {
											"ConfigTableID": {
												"value": {
													"value": "@item().ID",
													"type": "Expression"
												},
												"type": "Int32"
											},
											"RowsRead": {
												"value": null,
												"type": "Int64"
											},
											"Status": {
												"value": "Success",
												"type": "String"
											}
										}
									},
									"linkedServiceName": {
										"referenceName": "DS_MDW_SP",
										"type": "LinkedServiceReference"
									}
								}
							]
						}
					},
					{
						"name": "Sp_ExecFailureAudit_Fact",
						"type": "SqlServerStoredProcedure",
						"dependsOn": [
							{
								"activity": "ForEach_Fact",
								"dependencyConditions": [
									"Failed"
								]
							}
						],
						"policy": {
							"timeout": "7.00:00:00",
							"retry": 0,
							"retryIntervalInSeconds": 30,
							"secureOutput": false,
							"secureInput": false
						},
						"userProperties": [],
						"typeProperties": {
							"storedProcedureName": "[dbo].[proc_UpdateAuditLog]",
							"storedProcedureParameters": {
								"AuditID": {
									"value": {
										"value": "@activity('lkp_ExecStartAuditProc').output.firstRow.AuditID",
										"type": "Expression"
									},
									"type": "Int32"
								},
								"DataLakePath": {
									"value": null,
									"type": "String"
								},
								"PipelineRunID": {
									"value": {
										"value": "@pipeline().RunId",
										"type": "Expression"
									},
									"type": "String"
								},
								"RowsRead": {
									"value": null,
									"type": "Int64"
								},
								"Status": {
									"value": "Fact Proc Failed",
									"type": "String"
								}
							}
						},
						"linkedServiceName": {
							"referenceName": "AzureSqlDatabase1",
							"type": "LinkedServiceReference"
						}
					},
					{
						"name": "Sp_ExecSuccessAudit",
						"type": "SqlServerStoredProcedure",
						"dependsOn": [
							{
								"activity": "ForEach_Fact",
								"dependencyConditions": [
									"Succeeded"
								]
							}
						],
						"policy": {
							"timeout": "7.00:00:00",
							"retry": 0,
							"retryIntervalInSeconds": 30,
							"secureOutput": false,
							"secureInput": false
						},
						"userProperties": [],
						"typeProperties": {
							"storedProcedureName": "[dbo].[proc_UpdateAuditLog]",
							"storedProcedureParameters": {
								"AuditID": {
									"value": {
										"value": "@activity('lkp_ExecStartAuditProc').output.firstRow.AuditID",
										"type": "Expression"
									},
									"type": "Int32"
								},
								"DataLakePath": {
									"value": null,
									"type": "String"
								},
								"RowsRead": {
									"value": null,
									"type": "Int64"
								},
								"Status": {
									"value": "Success",
									"type": "String"
								},
								"PipelineRunID": {
									"value": {
										"value": "@pipeline().RunId",
										"type": "Expression"
									},
									"type": "String"
								}
							}
						},
						"linkedServiceName": {
							"referenceName": "AzureSqlDatabase1",
							"type": "LinkedServiceReference"
						}
					},
					{
						"name": "lkp_ExecStartAuditProc",
						"type": "Lookup",
						"dependsOn": [],
						"policy": {
							"timeout": "7.00:00:00",
							"retry": 0,
							"retryIntervalInSeconds": 30,
							"secureOutput": false,
							"secureInput": false
						},
						"userProperties": [],
						"typeProperties": {
							"source": {
								"type": "AzureSqlSource",
								"sqlReaderStoredProcedureName": "[dbo].[proc_StartAuditLog]",
								"storedProcedureParameters": {
									"ConfigTableID": {
										"type": "Int32",
										"value": "-1"
									},
									"DataFactoryName": {
										"type": "String",
										"value": {
											"value": "@pipeline().DataFactory",
											"type": "Expression"
										}
									},
									"ParentAuditID": {
										"type": "Int64",
										"value": "-1"
									},
									"PipelineName": {
										"type": "String",
										"value": {
											"value": "@pipeline().Pipeline",
											"type": "Expression"
										}
									},
									"PipelineRunID": {
										"type": "String",
										"value": {
											"value": "@pipeline().RunId",
											"type": "Expression"
										}
									},
									"PipelineTriggerID": {
										"type": "String",
										"value": {
											"value": "@pipeline().TriggerId",
											"type": "Expression"
										}
									},
									"PipelineTriggerName": {
										"type": "String",
										"value": {
											"value": "@pipeline().TriggerName",
											"type": "Expression"
										}
									},
									"PipelineTriggerType": {
										"type": "String",
										"value": {
											"value": "@pipeline().TriggerType",
											"type": "Expression"
										}
									}
								},
								"queryTimeout": "02:00:00",
								"partitionOption": "None"
							},
							"dataset": {
								"referenceName": "Briggs_MDW",
								"type": "DatasetReference",
								"parameters": {
									"schema_name": "dbo",
									"table_name": "user"
								}
							}
						}
					},
					{
						"name": "Sp_ExecFailureAudit_Stage",
						"type": "SqlServerStoredProcedure",
						"dependsOn": [
							{
								"activity": "ForEach_Stage",
								"dependencyConditions": [
									"Failed"
								]
							}
						],
						"policy": {
							"timeout": "7.00:00:00",
							"retry": 0,
							"retryIntervalInSeconds": 30,
							"secureOutput": false,
							"secureInput": false
						},
						"userProperties": [],
						"typeProperties": {
							"storedProcedureName": "[dbo].[proc_UpdateAuditLog]",
							"storedProcedureParameters": {
								"AuditID": {
									"value": {
										"value": "@activity('lkp_ExecStartAuditProc').output.firstRow.AuditID",
										"type": "Expression"
									},
									"type": "Int32"
								},
								"DataLakePath": {
									"value": null,
									"type": "String"
								},
								"PipelineRunID": {
									"value": {
										"value": "@pipeline().RunId",
										"type": "Expression"
									},
									"type": "String"
								},
								"RowsRead": {
									"value": null,
									"type": "Int64"
								},
								"Status": {
									"value": "Stage Proc Failed",
									"type": "String"
								}
							}
						},
						"linkedServiceName": {
							"referenceName": "AzureSqlDatabase1",
							"type": "LinkedServiceReference"
						}
					},
					{
						"name": "Sp_ExecFailureAudit_TL",
						"type": "SqlServerStoredProcedure",
						"dependsOn": [
							{
								"activity": "PL_Generic_Copy_Misc",
								"dependencyConditions": [
									"Failed"
								]
							}
						],
						"policy": {
							"timeout": "7.00:00:00",
							"retry": 0,
							"retryIntervalInSeconds": 30,
							"secureOutput": false,
							"secureInput": false
						},
						"userProperties": [],
						"typeProperties": {
							"storedProcedureName": "[dbo].[proc_UpdateAuditLog]",
							"storedProcedureParameters": {
								"AuditID": {
									"value": {
										"value": "@activity('lkp_ExecStartAuditProc').output.firstRow.AuditID",
										"type": "Expression"
									},
									"type": "Int32"
								},
								"DataLakePath": {
									"value": null,
									"type": "String"
								},
								"PipelineRunID": {
									"value": {
										"value": "@pipeline().RunId",
										"type": "Expression"
									},
									"type": "String"
								},
								"RowsRead": {
									"value": null,
									"type": "Int64"
								},
								"Status": {
									"value": {
										"value": "@concat('Table Laod Failed',activity('PL_Generic_Copy_Misc').output)",
										"type": "Expression"
									},
									"type": "String"
								}
							}
						},
						"linkedServiceName": {
							"referenceName": "AzureSqlDatabase1",
							"type": "LinkedServiceReference"
						}
					}
				],
				"policy": {
					"elapsedTimeMetric": {},
					"cancelAfter": {}
				},
				"variables": {
					"ErrorMsg": {
						"type": "String"
					}
				},
				"folder": {
					"name": "Briggs Data Load Theme wise"
				},
				"annotations": [],
				"lastPublishTime": "2022-05-02T11:12:32Z"
			},
			"dependsOn": [
				"[concat(variables('workspaceId'), '/pipelines/PL_Generic_Copy_Misc')]",
				"[concat(variables('workspaceId'), '/datasets/Briggs_MDW')]",
				"[concat(variables('workspaceId'), '/linkedServices/AzureSqlDatabase1')]",
				"[concat(variables('workspaceId'), '/linkedServices/DS_MDW_SP')]"
			]
		},
		{
			"name": "[concat(parameters('workspaceName'), '/PL_Master_Briggs_Operations')]",
			"type": "Microsoft.Synapse/workspaces/pipelines",
			"apiVersion": "2019-06-01-preview",
			"properties": {
				"activities": [
					{
						"name": "Execute Pipeline1",
						"type": "ExecutePipeline",
						"dependsOn": [
							{
								"activity": "lkp_ExecStartAuditProc",
								"dependencyConditions": [
									"Succeeded"
								]
							}
						],
						"userProperties": [],
						"typeProperties": {
							"pipeline": {
								"referenceName": "PL_Generic_Copy_Operations",
								"type": "PipelineReference"
							},
							"waitOnCompletion": true,
							"parameters": {}
						}
					},
					{
						"name": "ReportStageProc",
						"type": "Lookup",
						"dependsOn": [
							{
								"activity": "Execute Pipeline1",
								"dependencyConditions": [
									"Succeeded"
								]
							}
						],
						"policy": {
							"timeout": "7.00:00:00",
							"retry": 0,
							"retryIntervalInSeconds": 30,
							"secureOutput": false,
							"secureInput": false
						},
						"userProperties": [],
						"typeProperties": {
							"source": {
								"type": "AzureSqlSource",
								"sqlReaderQuery": "select  * from dbo.control_table where processsequence = 2 and enableaction = 1 \nand subjectarea='Report Stage Operations SP'\norder by id",
								"queryTimeout": "02:00:00",
								"partitionOption": "None"
							},
							"dataset": {
								"referenceName": "Briggs_MDW",
								"type": "DatasetReference",
								"parameters": {
									"schema_name": "dbo",
									"table_name": "user"
								}
							},
							"firstRowOnly": false
						}
					},
					{
						"name": "ForEach_Stage",
						"type": "ForEach",
						"dependsOn": [
							{
								"activity": "ReportStageProc",
								"dependencyConditions": [
									"Succeeded"
								]
							}
						],
						"userProperties": [],
						"typeProperties": {
							"items": {
								"value": "@activity('ReportStageProc').output.value",
								"type": "Expression"
							},
							"activities": [
								{
									"name": "Stored procedure1",
									"type": "SqlServerStoredProcedure",
									"dependsOn": [
										{
											"activity": "Start_Table_Audit_Stage",
											"dependencyConditions": [
												"Succeeded"
											]
										}
									],
									"policy": {
										"timeout": "7.00:00:00",
										"retry": 0,
										"retryIntervalInSeconds": 30,
										"secureOutput": false,
										"secureInput": false
									},
									"userProperties": [],
									"typeProperties": {
										"storedProcedureName": {
											"value": "@item().sourcetablename",
											"type": "Expression"
										}
									},
									"linkedServiceName": {
										"referenceName": "DS_MDW_SP",
										"type": "LinkedServiceReference"
									}
								},
								{
									"name": "Start_Table_Audit_Stage",
									"type": "Lookup",
									"dependsOn": [],
									"policy": {
										"timeout": "7.00:00:00",
										"retry": 0,
										"retryIntervalInSeconds": 30,
										"secureOutput": false,
										"secureInput": false
									},
									"userProperties": [],
									"typeProperties": {
										"source": {
											"type": "AzureSqlSource",
											"sqlReaderStoredProcedureName": "[dbo].[proc_StartAuditLog_Briggs]",
											"storedProcedureParameters": {
												"ConfigTableID": {
													"type": "Int32",
													"value": {
														"value": "@item().ID",
														"type": "Expression"
													}
												},
												"DataFactoryName": {
													"type": "String",
													"value": {
														"value": "@pipeline().DataFactory",
														"type": "Expression"
													}
												},
												"ParentAuditID": {
													"type": "Int64",
													"value": {
														"value": "@item().ID",
														"type": "Expression"
													}
												},
												"PipelineName": {
													"type": "String",
													"value": {
														"value": "@pipeline().Pipeline",
														"type": "Expression"
													}
												},
												"PipelineRunID": {
													"type": "String",
													"value": {
														"value": "@pipeline().RunId",
														"type": "Expression"
													}
												},
												"PipelineTriggerID": {
													"type": "String",
													"value": {
														"value": "@pipeline().TriggerId",
														"type": "Expression"
													}
												},
												"PipelineTriggerName": {
													"type": "String",
													"value": {
														"value": "@pipeline().TriggerName",
														"type": "Expression"
													}
												},
												"PipelineTriggerType": {
													"type": "String",
													"value": {
														"value": "@pipeline().TriggerType",
														"type": "Expression"
													}
												},
												"Sourcedb": {
													"type": "String",
													"value": {
														"value": "@item().sourceDB",
														"type": "Expression"
													}
												},
												"sourcetable": {
													"type": "String",
													"value": {
														"value": "@item().SourcetableName",
														"type": "Expression"
													}
												}
											},
											"queryTimeout": "02:00:00",
											"partitionOption": "None"
										},
										"dataset": {
											"referenceName": "Briggs_MDW",
											"type": "DatasetReference",
											"parameters": {
												"schema_name": "dbo",
												"table_name": "user"
											}
										},
										"firstRowOnly": false
									}
								},
								{
									"name": "Set variable_Stage",
									"type": "SetVariable",
									"dependsOn": [
										{
											"activity": "Stored procedure1",
											"dependencyConditions": [
												"Failed"
											]
										}
									],
									"userProperties": [],
									"typeProperties": {
										"variableName": "ErrorMsg",
										"value": {
											"value": "@activity('Stored procedure1').Error.Message",
											"type": "Expression"
										}
									}
								},
								{
									"name": "Failure_Audit_Log_Stage",
									"type": "SqlServerStoredProcedure",
									"dependsOn": [
										{
											"activity": "Set variable_Stage",
											"dependencyConditions": [
												"Succeeded"
											]
										}
									],
									"policy": {
										"timeout": "7.00:00:00",
										"retry": 0,
										"retryIntervalInSeconds": 30,
										"secureOutput": false,
										"secureInput": false
									},
									"userProperties": [],
									"typeProperties": {
										"storedProcedureName": "[dbo].[proc_UpdateAuditLog_Briggs]",
										"storedProcedureParameters": {
											"ConfigTableID": {
												"value": {
													"value": "@item().ID",
													"type": "Expression"
												},
												"type": "Int32"
											},
											"RowsRead": {
												"value": null,
												"type": "Int64"
											},
											"Status": {
												"value": {
													"value": "@variables('ErrorMsg')",
													"type": "Expression"
												},
												"type": "String"
											}
										}
									},
									"linkedServiceName": {
										"referenceName": "DS_MDW_SP",
										"type": "LinkedServiceReference"
									}
								},
								{
									"name": "Success_Audit_Log_Stage",
									"type": "SqlServerStoredProcedure",
									"dependsOn": [
										{
											"activity": "Stored procedure1",
											"dependencyConditions": [
												"Succeeded"
											]
										}
									],
									"policy": {
										"timeout": "7.00:00:00",
										"retry": 0,
										"retryIntervalInSeconds": 30,
										"secureOutput": false,
										"secureInput": false
									},
									"userProperties": [],
									"typeProperties": {
										"storedProcedureName": "[dbo].[proc_UpdateAuditLog_Briggs]",
										"storedProcedureParameters": {
											"ConfigTableID": {
												"value": {
													"value": "@item().ID",
													"type": "Expression"
												},
												"type": "Int32"
											},
											"RowsRead": {
												"value": null,
												"type": "Int64"
											},
											"Status": {
												"value": "Success",
												"type": "String"
											}
										}
									},
									"linkedServiceName": {
										"referenceName": "DS_MDW_SP",
										"type": "LinkedServiceReference"
									}
								}
							]
						}
					},
					{
						"name": "ReportFactProc",
						"type": "Lookup",
						"dependsOn": [
							{
								"activity": "ForEach_Stage",
								"dependencyConditions": [
									"Succeeded"
								]
							}
						],
						"policy": {
							"timeout": "7.00:00:00",
							"retry": 0,
							"retryIntervalInSeconds": 30,
							"secureOutput": false,
							"secureInput": false
						},
						"userProperties": [],
						"typeProperties": {
							"source": {
								"type": "AzureSqlSource",
								"sqlReaderQuery": "select  * from dbo.control_table where processsequence = 4 and enableaction = 1 \nand subjectarea='Report Fact Operations SP'\norder by id",
								"queryTimeout": "02:00:00",
								"partitionOption": "None"
							},
							"dataset": {
								"referenceName": "Briggs_MDW",
								"type": "DatasetReference",
								"parameters": {
									"schema_name": "dbo",
									"table_name": "user"
								}
							},
							"firstRowOnly": false
						}
					},
					{
						"name": "ForEach_Fact",
						"type": "ForEach",
						"dependsOn": [
							{
								"activity": "ReportFactProc",
								"dependencyConditions": [
									"Succeeded"
								]
							}
						],
						"userProperties": [],
						"typeProperties": {
							"items": {
								"value": "@activity('ReportFactProc').output.value",
								"type": "Expression"
							},
							"activities": [
								{
									"name": "Stored procedure",
									"type": "SqlServerStoredProcedure",
									"dependsOn": [
										{
											"activity": "Start_Table_Audit1_Fact",
											"dependencyConditions": [
												"Succeeded"
											]
										}
									],
									"policy": {
										"timeout": "7.00:00:00",
										"retry": 0,
										"retryIntervalInSeconds": 30,
										"secureOutput": false,
										"secureInput": false
									},
									"userProperties": [],
									"typeProperties": {
										"storedProcedureName": {
											"value": "@item().sourcetablename",
											"type": "Expression"
										}
									},
									"linkedServiceName": {
										"referenceName": "DS_MDW_SP",
										"type": "LinkedServiceReference"
									}
								},
								{
									"name": "Start_Table_Audit1_Fact",
									"type": "Lookup",
									"dependsOn": [],
									"policy": {
										"timeout": "7.00:00:00",
										"retry": 0,
										"retryIntervalInSeconds": 30,
										"secureOutput": false,
										"secureInput": false
									},
									"userProperties": [],
									"typeProperties": {
										"source": {
											"type": "AzureSqlSource",
											"sqlReaderStoredProcedureName": "[dbo].[proc_StartAuditLog_Briggs]",
											"storedProcedureParameters": {
												"ConfigTableID": {
													"type": "Int32",
													"value": {
														"value": "@item().ID",
														"type": "Expression"
													}
												},
												"DataFactoryName": {
													"type": "String",
													"value": {
														"value": "@pipeline().DataFactory",
														"type": "Expression"
													}
												},
												"ParentAuditID": {
													"type": "Int64",
													"value": {
														"value": "@item().ID",
														"type": "Expression"
													}
												},
												"PipelineName": {
													"type": "String",
													"value": {
														"value": "@pipeline().Pipeline",
														"type": "Expression"
													}
												},
												"PipelineRunID": {
													"type": "String",
													"value": {
														"value": "@pipeline().RunId",
														"type": "Expression"
													}
												},
												"PipelineTriggerID": {
													"type": "String",
													"value": {
														"value": "@pipeline().TriggerId",
														"type": "Expression"
													}
												},
												"PipelineTriggerName": {
													"type": "String",
													"value": {
														"value": "@pipeline().TriggerName",
														"type": "Expression"
													}
												},
												"PipelineTriggerType": {
													"type": "String",
													"value": {
														"value": "@pipeline().TriggerType",
														"type": "Expression"
													}
												},
												"Sourcedb": {
													"type": "String",
													"value": {
														"value": "@item().sourceDB",
														"type": "Expression"
													}
												},
												"sourcetable": {
													"type": "String",
													"value": {
														"value": "@item().SourcetableName",
														"type": "Expression"
													}
												}
											},
											"queryTimeout": "02:00:00",
											"partitionOption": "None"
										},
										"dataset": {
											"referenceName": "Briggs_MDW",
											"type": "DatasetReference",
											"parameters": {
												"schema_name": "dbo",
												"table_name": "user"
											}
										},
										"firstRowOnly": false
									}
								},
								{
									"name": "Set variable1_Fact",
									"type": "SetVariable",
									"dependsOn": [
										{
											"activity": "Stored procedure",
											"dependencyConditions": [
												"Failed"
											]
										}
									],
									"userProperties": [],
									"typeProperties": {
										"variableName": "ErrorMsg",
										"value": {
											"value": "@activity('ReportStageProc').Error.Message",
											"type": "Expression"
										}
									}
								},
								{
									"name": "Failure_Audit_Log_Fact",
									"type": "SqlServerStoredProcedure",
									"dependsOn": [
										{
											"activity": "Set variable1_Fact",
											"dependencyConditions": [
												"Succeeded"
											]
										}
									],
									"policy": {
										"timeout": "7.00:00:00",
										"retry": 0,
										"retryIntervalInSeconds": 30,
										"secureOutput": false,
										"secureInput": false
									},
									"userProperties": [],
									"typeProperties": {
										"storedProcedureName": "[dbo].[proc_UpdateAuditLog_Briggs]",
										"storedProcedureParameters": {
											"ConfigTableID": {
												"value": {
													"value": "@item().ID",
													"type": "Expression"
												},
												"type": "Int32"
											},
											"RowsRead": {
												"value": null,
												"type": "Int64"
											},
											"Status": {
												"value": {
													"value": "@variables('ErrorMsg')",
													"type": "Expression"
												},
												"type": "String"
											}
										}
									},
									"linkedServiceName": {
										"referenceName": "DS_MDW_SP",
										"type": "LinkedServiceReference"
									}
								},
								{
									"name": "Success_Audit_Log2_Fact",
									"type": "SqlServerStoredProcedure",
									"dependsOn": [
										{
											"activity": "Stored procedure",
											"dependencyConditions": [
												"Succeeded"
											]
										}
									],
									"policy": {
										"timeout": "7.00:00:00",
										"retry": 0,
										"retryIntervalInSeconds": 30,
										"secureOutput": false,
										"secureInput": false
									},
									"userProperties": [],
									"typeProperties": {
										"storedProcedureName": "[dbo].[proc_UpdateAuditLog_Briggs]",
										"storedProcedureParameters": {
											"ConfigTableID": {
												"value": {
													"value": "@item().ID",
													"type": "Expression"
												},
												"type": "Int32"
											},
											"RowsRead": {
												"value": null,
												"type": "Int64"
											},
											"Status": {
												"value": "Success",
												"type": "String"
											}
										}
									},
									"linkedServiceName": {
										"referenceName": "DS_MDW_SP",
										"type": "LinkedServiceReference"
									}
								}
							]
						}
					},
					{
						"name": "Sp_ExecFailureAudit_Fact",
						"type": "SqlServerStoredProcedure",
						"dependsOn": [
							{
								"activity": "ForEach_Fact",
								"dependencyConditions": [
									"Failed"
								]
							}
						],
						"policy": {
							"timeout": "7.00:00:00",
							"retry": 0,
							"retryIntervalInSeconds": 30,
							"secureOutput": false,
							"secureInput": false
						},
						"userProperties": [],
						"typeProperties": {
							"storedProcedureName": "[dbo].[proc_UpdateAuditLog]",
							"storedProcedureParameters": {
								"AuditID": {
									"value": {
										"value": "@activity('lkp_ExecStartAuditProc').output.firstRow.AuditID",
										"type": "Expression"
									},
									"type": "Int32"
								},
								"DataLakePath": {
									"value": null,
									"type": "String"
								},
								"PipelineRunID": {
									"value": {
										"value": "@pipeline().RunId",
										"type": "Expression"
									},
									"type": "String"
								},
								"RowsRead": {
									"value": null,
									"type": "Int64"
								},
								"Status": {
									"value": "Fact Proc Failed",
									"type": "String"
								}
							}
						},
						"linkedServiceName": {
							"referenceName": "AzureSqlDatabase1",
							"type": "LinkedServiceReference"
						}
					},
					{
						"name": "Sp_ExecSuccessAudit",
						"type": "SqlServerStoredProcedure",
						"dependsOn": [
							{
								"activity": "ForEach_Fact",
								"dependencyConditions": [
									"Succeeded"
								]
							}
						],
						"policy": {
							"timeout": "7.00:00:00",
							"retry": 0,
							"retryIntervalInSeconds": 30,
							"secureOutput": false,
							"secureInput": false
						},
						"userProperties": [],
						"typeProperties": {
							"storedProcedureName": "[dbo].[proc_UpdateAuditLog]",
							"storedProcedureParameters": {
								"AuditID": {
									"value": {
										"value": "@activity('lkp_ExecStartAuditProc').output.firstRow.AuditID",
										"type": "Expression"
									},
									"type": "Int32"
								},
								"DataLakePath": {
									"value": null,
									"type": "String"
								},
								"RowsRead": {
									"value": null,
									"type": "Int64"
								},
								"Status": {
									"value": "Success",
									"type": "String"
								},
								"PipelineRunID": {
									"value": {
										"value": "@pipeline().RunId",
										"type": "Expression"
									},
									"type": "String"
								}
							}
						},
						"linkedServiceName": {
							"referenceName": "AzureSqlDatabase1",
							"type": "LinkedServiceReference"
						}
					},
					{
						"name": "lkp_ExecStartAuditProc",
						"type": "Lookup",
						"dependsOn": [],
						"policy": {
							"timeout": "7.00:00:00",
							"retry": 0,
							"retryIntervalInSeconds": 30,
							"secureOutput": false,
							"secureInput": false
						},
						"userProperties": [],
						"typeProperties": {
							"source": {
								"type": "AzureSqlSource",
								"sqlReaderStoredProcedureName": "[dbo].[proc_StartAuditLog]",
								"storedProcedureParameters": {
									"ConfigTableID": {
										"type": "Int32",
										"value": "-1"
									},
									"DataFactoryName": {
										"type": "String",
										"value": {
											"value": "@pipeline().DataFactory",
											"type": "Expression"
										}
									},
									"ParentAuditID": {
										"type": "Int64",
										"value": "-1"
									},
									"PipelineName": {
										"type": "String",
										"value": {
											"value": "@pipeline().Pipeline",
											"type": "Expression"
										}
									},
									"PipelineRunID": {
										"type": "String",
										"value": {
											"value": "@pipeline().RunId",
											"type": "Expression"
										}
									},
									"PipelineTriggerID": {
										"type": "String",
										"value": {
											"value": "@pipeline().TriggerId",
											"type": "Expression"
										}
									},
									"PipelineTriggerName": {
										"type": "String",
										"value": {
											"value": "@pipeline().TriggerName",
											"type": "Expression"
										}
									},
									"PipelineTriggerType": {
										"type": "String",
										"value": {
											"value": "@pipeline().TriggerType",
											"type": "Expression"
										}
									}
								},
								"queryTimeout": "02:00:00",
								"partitionOption": "None"
							},
							"dataset": {
								"referenceName": "Briggs_MDW",
								"type": "DatasetReference",
								"parameters": {
									"schema_name": "dbo",
									"table_name": "user"
								}
							}
						}
					},
					{
						"name": "Sp_ExecFailureAudit_Stage",
						"type": "SqlServerStoredProcedure",
						"dependsOn": [
							{
								"activity": "ForEach_Stage",
								"dependencyConditions": [
									"Failed"
								]
							}
						],
						"policy": {
							"timeout": "7.00:00:00",
							"retry": 0,
							"retryIntervalInSeconds": 30,
							"secureOutput": false,
							"secureInput": false
						},
						"userProperties": [],
						"typeProperties": {
							"storedProcedureName": "[dbo].[proc_UpdateAuditLog]",
							"storedProcedureParameters": {
								"AuditID": {
									"value": {
										"value": "@activity('lkp_ExecStartAuditProc').output.firstRow.AuditID",
										"type": "Expression"
									},
									"type": "Int32"
								},
								"DataLakePath": {
									"value": null,
									"type": "String"
								},
								"PipelineRunID": {
									"value": {
										"value": "@pipeline().RunId",
										"type": "Expression"
									},
									"type": "String"
								},
								"RowsRead": {
									"value": null,
									"type": "Int64"
								},
								"Status": {
									"value": "Stage Proc Failed",
									"type": "String"
								}
							}
						},
						"linkedServiceName": {
							"referenceName": "AzureSqlDatabase1",
							"type": "LinkedServiceReference"
						}
					},
					{
						"name": "Sp_ExecFailureAudit_TL",
						"type": "SqlServerStoredProcedure",
						"dependsOn": [
							{
								"activity": "Execute Pipeline1",
								"dependencyConditions": [
									"Failed"
								]
							}
						],
						"policy": {
							"timeout": "7.00:00:00",
							"retry": 0,
							"retryIntervalInSeconds": 30,
							"secureOutput": false,
							"secureInput": false
						},
						"userProperties": [],
						"typeProperties": {
							"storedProcedureName": "[dbo].[proc_UpdateAuditLog]",
							"storedProcedureParameters": {
								"AuditID": {
									"value": {
										"value": "@activity('lkp_ExecStartAuditProc').output.firstRow.AuditID",
										"type": "Expression"
									},
									"type": "Int32"
								},
								"DataLakePath": {
									"value": null,
									"type": "String"
								},
								"PipelineRunID": {
									"value": {
										"value": "@pipeline().RunId",
										"type": "Expression"
									},
									"type": "String"
								},
								"RowsRead": {
									"value": null,
									"type": "Int64"
								},
								"Status": {
									"value": "Table Load Proc Failed",
									"type": "String"
								}
							}
						},
						"linkedServiceName": {
							"referenceName": "AzureSqlDatabase1",
							"type": "LinkedServiceReference"
						}
					}
				],
				"policy": {
					"elapsedTimeMetric": {},
					"cancelAfter": {}
				},
				"variables": {
					"ErrorMsg": {
						"type": "String"
					}
				},
				"folder": {
					"name": "Briggs Data Load Theme wise"
				},
				"annotations": [],
				"lastPublishTime": "2022-04-27T13:14:11Z"
			},
			"dependsOn": [
				"[concat(variables('workspaceId'), '/pipelines/PL_Generic_Copy_Operations')]",
				"[concat(variables('workspaceId'), '/datasets/Briggs_MDW')]",
				"[concat(variables('workspaceId'), '/linkedServices/AzureSqlDatabase1')]",
				"[concat(variables('workspaceId'), '/linkedServices/DS_MDW_SP')]"
			]
		},
		{
			"name": "[concat(parameters('workspaceName'), '/PL_Master_Briggs_Parquet_Load')]",
			"type": "Microsoft.Synapse/workspaces/pipelines",
			"apiVersion": "2019-06-01-preview",
			"properties": {
				"activities": [
					{
						"name": "Lookup1_Incremental",
						"type": "Lookup",
						"dependsOn": [],
						"policy": {
							"timeout": "7.00:00:00",
							"retry": 0,
							"retryIntervalInSeconds": 30,
							"secureOutput": false,
							"secureInput": false
						},
						"userProperties": [],
						"typeProperties": {
							"source": {
								"type": "AzureSqlSource",
								"sqlReaderQuery": "Select  ID ID_Inc From dbo.control_table Where ProcessName = 'AzSQL_ADLS'  \nAND DataLoadType = 'Incremental'  and EnableAction = 1  \n and id <> 253 \norder by 1 ",
								"queryTimeout": "02:00:00",
								"partitionOption": "None"
							},
							"dataset": {
								"referenceName": "Briggs_MDW",
								"type": "DatasetReference",
								"parameters": {
									"schema_name": "dbo",
									"table_name": "user"
								}
							},
							"firstRowOnly": false
						}
					},
					{
						"name": "ForEach_Incremental_Load",
						"type": "ForEach",
						"dependsOn": [
							{
								"activity": "Lookup1_Incremental",
								"dependencyConditions": [
									"Succeeded"
								]
							}
						],
						"userProperties": [],
						"typeProperties": {
							"items": {
								"value": "@activity('Lookup1_Incremental').output.value",
								"type": "Expression"
							},
							"activities": [
								{
									"name": "Lookup_Incremental",
									"type": "Lookup",
									"dependsOn": [],
									"policy": {
										"timeout": "7.00:00:00",
										"retry": 0,
										"retryIntervalInSeconds": 30,
										"secureOutput": false,
										"secureInput": false
									},
									"userProperties": [],
									"typeProperties": {
										"source": {
											"type": "AzureSqlSource",
											"sqlReaderQuery": {
												"value": "@concat('select SourceQuery=''select '' +columnList+ '' from ''+ sourceDB+''.''+SourceSchemaName+''.''+SourcetableName + '' where \ncast(''+DateField+'' as date) >=''''''+lastdateparquet+''''''''\n,SourceDB\n,TargetContainer\n, TargetPath, TargetFile, FileFormat,DateField,lastdateparquet,targetstagetableschema,targetstagetablename\nfrom dbo.control_table\nwhere ID= ',item().ID_Inc)",
												"type": "Expression"
											},
											"queryTimeout": "02:00:00",
											"partitionOption": "None"
										},
										"dataset": {
											"referenceName": "Briggs_MDW",
											"type": "DatasetReference",
											"parameters": {
												"schema_name": "dbo",
												"table_name": "user"
											}
										}
									}
								},
								{
									"name": "Copy_BriggsMST_ADLS",
									"type": "Copy",
									"dependsOn": [
										{
											"activity": "Lookup_Incremental",
											"dependencyConditions": [
												"Succeeded"
											]
										}
									],
									"policy": {
										"timeout": "7.00:00:00",
										"retry": 0,
										"retryIntervalInSeconds": 30,
										"secureOutput": false,
										"secureInput": false
									},
									"userProperties": [],
									"typeProperties": {
										"source": {
											"type": "SqlServerSource",
											"sqlReaderQuery": {
												"value": "@activity('Lookup_Incremental').output.firstRow.SourceQuery\n",
												"type": "Expression"
											},
											"queryTimeout": "02:00:00",
											"partitionOption": "None"
										},
										"sink": {
											"type": "ParquetSink",
											"storeSettings": {
												"type": "AzureBlobStorageWriteSettings"
											},
											"formatSettings": {
												"type": "ParquetWriteSettings"
											}
										},
										"enableStaging": false,
										"translator": {
											"type": "TabularTranslator",
											"typeConversion": true,
											"typeConversionSettings": {
												"allowDataTruncation": true,
												"treatBooleanAsNumber": false
											}
										}
									},
									"inputs": [
										{
											"referenceName": "DS_Briggs_MST",
											"type": "DatasetReference",
											"parameters": {}
										}
									],
									"outputs": [
										{
											"referenceName": "DS_ADLS_Parquet_1",
											"type": "DatasetReference",
											"parameters": {
												"ContainerName": {
													"value": "@activity('Lookup_Incremental').output.firstRow.TargetContainer",
													"type": "Expression"
												},
												"Path": {
													"value": "@activity('Lookup_Incremental').output.firstRow.TargetPath",
													"type": "Expression"
												},
												"FileName": {
													"value": "@concat(activity('Lookup_Incremental').output.firstRow.TargetFile,'_',formatDateTime(utcnow(),'yyyyMMdd'),'.',activity('Lookup_Incremental').output.firstRow.FileFormat)",
													"type": "Expression"
												}
											}
										}
									]
								}
							]
						}
					},
					{
						"name": "Lookup2_Full",
						"type": "Lookup",
						"dependsOn": [],
						"policy": {
							"timeout": "7.00:00:00",
							"retry": 0,
							"retryIntervalInSeconds": 30,
							"secureOutput": false,
							"secureInput": false
						},
						"userProperties": [],
						"typeProperties": {
							"source": {
								"type": "AzureSqlSource",
								"sqlReaderQuery": "Select Distinct ID ID_Full From dbo.control_table Where ProcessName = 'AzSQL_ADLS'  \nAND DataLoadType = 'Full'  and EnableAction = 1 \norder by 1 ",
								"queryTimeout": "02:00:00",
								"partitionOption": "None"
							},
							"dataset": {
								"referenceName": "Briggs_MDW",
								"type": "DatasetReference",
								"parameters": {
									"schema_name": "dbo",
									"table_name": "user"
								}
							},
							"firstRowOnly": false
						}
					},
					{
						"name": "ForEach_Full_Load",
						"type": "ForEach",
						"dependsOn": [
							{
								"activity": "Lookup2_Full",
								"dependencyConditions": [
									"Succeeded"
								]
							}
						],
						"userProperties": [],
						"typeProperties": {
							"items": {
								"value": "@activity('Lookup2_Full').output.value",
								"type": "Expression"
							},
							"activities": [
								{
									"name": "Lookup_Full",
									"type": "Lookup",
									"dependsOn": [],
									"policy": {
										"timeout": "7.00:00:00",
										"retry": 0,
										"retryIntervalInSeconds": 30,
										"secureOutput": false,
										"secureInput": false
									},
									"userProperties": [],
									"typeProperties": {
										"source": {
											"type": "AzureSqlSource",
											"sqlReaderQuery": {
												"value": "@concat('select SourceQuery=''select '' +columnList+ '' from ''+ sourceDB+''.''+SourceSchemaName+''.''+SourcetableName\n,SourceDB\n,TargetContainer\n, TargetPath, TargetFile, FileFormat,DateField,lastdateparquet,targetstagetableschema,targetstagetablename\nfrom dbo.control_table\nwhere ID= ',item().ID_Full)",
												"type": "Expression"
											},
											"queryTimeout": "02:00:00",
											"partitionOption": "None"
										},
										"dataset": {
											"referenceName": "Briggs_MDW",
											"type": "DatasetReference",
											"parameters": {
												"schema_name": "dbo",
												"table_name": "user"
											}
										}
									}
								},
								{
									"name": "Copy_BriggsMST_ADLS_copy1",
									"type": "Copy",
									"dependsOn": [
										{
											"activity": "Lookup_Full",
											"dependencyConditions": [
												"Succeeded"
											]
										}
									],
									"policy": {
										"timeout": "7.00:00:00",
										"retry": 0,
										"retryIntervalInSeconds": 30,
										"secureOutput": false,
										"secureInput": false
									},
									"userProperties": [],
									"typeProperties": {
										"source": {
											"type": "SqlServerSource",
											"sqlReaderQuery": {
												"value": "@activity('Lookup_Full').output.firstRow.SourceQuery\n",
												"type": "Expression"
											},
											"queryTimeout": "02:00:00",
											"partitionOption": "None"
										},
										"sink": {
											"type": "ParquetSink",
											"storeSettings": {
												"type": "AzureBlobStorageWriteSettings"
											},
											"formatSettings": {
												"type": "ParquetWriteSettings"
											}
										},
										"enableStaging": false,
										"translator": {
											"type": "TabularTranslator",
											"typeConversion": true,
											"typeConversionSettings": {
												"allowDataTruncation": true,
												"treatBooleanAsNumber": false
											}
										}
									},
									"inputs": [
										{
											"referenceName": "DS_Briggs_MST",
											"type": "DatasetReference",
											"parameters": {}
										}
									],
									"outputs": [
										{
											"referenceName": "DS_ADLS_Parquet_1",
											"type": "DatasetReference",
											"parameters": {
												"ContainerName": {
													"value": "@activity('Lookup_Full').output.firstRow.TargetContainer",
													"type": "Expression"
												},
												"Path": {
													"value": "@activity('Lookup_Full').output.firstRow.TargetPath",
													"type": "Expression"
												},
												"FileName": {
													"value": "@concat(activity('Lookup_Full').output.firstRow.TargetFile,'.',activity('Lookup_Full').output.firstRow.FileFormat)",
													"type": "Expression"
												}
											}
										}
									]
								}
							]
						}
					},
					{
						"name": "Stored procedure1",
						"type": "SqlServerStoredProcedure",
						"dependsOn": [
							{
								"activity": "ForEach_Incremental_Load",
								"dependencyConditions": [
									"Succeeded"
								]
							}
						],
						"policy": {
							"timeout": "7.00:00:00",
							"retry": 0,
							"retryIntervalInSeconds": 30,
							"secureOutput": false,
							"secureInput": false
						},
						"userProperties": [],
						"typeProperties": {
							"storedProcedureName": "[dbo].[USP_Control_Table_LastDateParquet]"
						},
						"linkedServiceName": {
							"referenceName": "DS_MDW_SP",
							"type": "LinkedServiceReference"
						}
					}
				],
				"policy": {
					"elapsedTimeMetric": {},
					"cancelAfter": {}
				},
				"folder": {
					"name": "Briggs Data Load in Azure DataLake"
				},
				"annotations": [],
				"lastPublishTime": "2022-02-17T13:13:02Z"
			},
			"dependsOn": [
				"[concat(variables('workspaceId'), '/datasets/Briggs_MDW')]",
				"[concat(variables('workspaceId'), '/linkedServices/DS_MDW_SP')]",
				"[concat(variables('workspaceId'), '/datasets/DS_Briggs_MST')]",
				"[concat(variables('workspaceId'), '/datasets/DS_ADLS_Parquet_1')]"
			]
		},
		{
			"name": "[concat(parameters('workspaceName'), '/PL_Master_Briggs_Parts')]",
			"type": "Microsoft.Synapse/workspaces/pipelines",
			"apiVersion": "2019-06-01-preview",
			"properties": {
				"activities": [
					{
						"name": "Execute Pipeline1",
						"type": "ExecutePipeline",
						"dependsOn": [
							{
								"activity": "lkp_ExecStartAuditProc",
								"dependencyConditions": [
									"Succeeded"
								]
							}
						],
						"userProperties": [],
						"typeProperties": {
							"pipeline": {
								"referenceName": "PL_Generic_Copy_Parts",
								"type": "PipelineReference"
							},
							"waitOnCompletion": true,
							"parameters": {}
						}
					},
					{
						"name": "ReportStageProc",
						"type": "Lookup",
						"dependsOn": [
							{
								"activity": "Execute Pipeline1",
								"dependencyConditions": [
									"Succeeded"
								]
							}
						],
						"policy": {
							"timeout": "7.00:00:00",
							"retry": 0,
							"retryIntervalInSeconds": 30,
							"secureOutput": false,
							"secureInput": false
						},
						"userProperties": [],
						"typeProperties": {
							"source": {
								"type": "AzureSqlSource",
								"sqlReaderQuery": "select  * from dbo.control_table where processsequence = 2 and enableaction = 1 \nand subjectarea='Report Stage Part SP'\norder by id",
								"queryTimeout": "02:00:00",
								"partitionOption": "None"
							},
							"dataset": {
								"referenceName": "Briggs_MDW",
								"type": "DatasetReference",
								"parameters": {
									"schema_name": "dbo",
									"table_name": "user"
								}
							},
							"firstRowOnly": false
						}
					},
					{
						"name": "ForEach_Stage",
						"type": "ForEach",
						"dependsOn": [
							{
								"activity": "ReportStageProc",
								"dependencyConditions": [
									"Succeeded"
								]
							}
						],
						"userProperties": [],
						"typeProperties": {
							"items": {
								"value": "@activity('ReportStageProc').output.value",
								"type": "Expression"
							},
							"activities": [
								{
									"name": "Stored procedure1",
									"type": "SqlServerStoredProcedure",
									"dependsOn": [
										{
											"activity": "Start_Table_Audit_Stage",
											"dependencyConditions": [
												"Succeeded"
											]
										}
									],
									"policy": {
										"timeout": "7.00:00:00",
										"retry": 0,
										"retryIntervalInSeconds": 30,
										"secureOutput": false,
										"secureInput": false
									},
									"userProperties": [],
									"typeProperties": {
										"storedProcedureName": {
											"value": "@item().sourcetablename",
											"type": "Expression"
										}
									},
									"linkedServiceName": {
										"referenceName": "DS_MDW_SP",
										"type": "LinkedServiceReference"
									}
								},
								{
									"name": "Start_Table_Audit_Stage",
									"type": "Lookup",
									"dependsOn": [],
									"policy": {
										"timeout": "7.00:00:00",
										"retry": 0,
										"retryIntervalInSeconds": 30,
										"secureOutput": false,
										"secureInput": false
									},
									"userProperties": [],
									"typeProperties": {
										"source": {
											"type": "AzureSqlSource",
											"sqlReaderStoredProcedureName": "[dbo].[proc_StartAuditLog_Briggs]",
											"storedProcedureParameters": {
												"ConfigTableID": {
													"type": "Int32",
													"value": {
														"value": "@item().ID",
														"type": "Expression"
													}
												},
												"DataFactoryName": {
													"type": "String",
													"value": {
														"value": "@pipeline().DataFactory",
														"type": "Expression"
													}
												},
												"ParentAuditID": {
													"type": "Int64",
													"value": {
														"value": "@item().ID",
														"type": "Expression"
													}
												},
												"PipelineName": {
													"type": "String",
													"value": {
														"value": "@pipeline().Pipeline",
														"type": "Expression"
													}
												},
												"PipelineRunID": {
													"type": "String",
													"value": {
														"value": "@pipeline().RunId",
														"type": "Expression"
													}
												},
												"PipelineTriggerID": {
													"type": "String",
													"value": {
														"value": "@pipeline().TriggerId",
														"type": "Expression"
													}
												},
												"PipelineTriggerName": {
													"type": "String",
													"value": {
														"value": "@pipeline().TriggerName",
														"type": "Expression"
													}
												},
												"PipelineTriggerType": {
													"type": "String",
													"value": {
														"value": "@pipeline().TriggerType",
														"type": "Expression"
													}
												},
												"Sourcedb": {
													"type": "String",
													"value": {
														"value": "@item().sourceDB",
														"type": "Expression"
													}
												},
												"sourcetable": {
													"type": "String",
													"value": {
														"value": "@item().SourcetableName",
														"type": "Expression"
													}
												}
											},
											"queryTimeout": "02:00:00",
											"partitionOption": "None"
										},
										"dataset": {
											"referenceName": "Briggs_MDW",
											"type": "DatasetReference",
											"parameters": {
												"schema_name": "dbo",
												"table_name": "user"
											}
										},
										"firstRowOnly": false
									}
								},
								{
									"name": "Set variable_Stage",
									"type": "SetVariable",
									"dependsOn": [
										{
											"activity": "Stored procedure1",
											"dependencyConditions": [
												"Failed"
											]
										}
									],
									"userProperties": [],
									"typeProperties": {
										"variableName": "ErrorMsg",
										"value": {
											"value": "@activity('Stored procedure1').Error.Message",
											"type": "Expression"
										}
									}
								},
								{
									"name": "Failure_Audit_Log_Stage",
									"type": "SqlServerStoredProcedure",
									"dependsOn": [
										{
											"activity": "Set variable_Stage",
											"dependencyConditions": [
												"Succeeded"
											]
										}
									],
									"policy": {
										"timeout": "7.00:00:00",
										"retry": 0,
										"retryIntervalInSeconds": 30,
										"secureOutput": false,
										"secureInput": false
									},
									"userProperties": [],
									"typeProperties": {
										"storedProcedureName": "[dbo].[proc_UpdateAuditLog_Briggs]",
										"storedProcedureParameters": {
											"ConfigTableID": {
												"value": {
													"value": "@item().ID",
													"type": "Expression"
												},
												"type": "Int32"
											},
											"RowsRead": {
												"value": null,
												"type": "Int64"
											},
											"Status": {
												"value": {
													"value": "@variables('ErrorMsg')",
													"type": "Expression"
												},
												"type": "String"
											}
										}
									},
									"linkedServiceName": {
										"referenceName": "DS_MDW_SP",
										"type": "LinkedServiceReference"
									}
								},
								{
									"name": "Success_Audit_Log_Stage",
									"type": "SqlServerStoredProcedure",
									"dependsOn": [
										{
											"activity": "Stored procedure1",
											"dependencyConditions": [
												"Succeeded"
											]
										}
									],
									"policy": {
										"timeout": "7.00:00:00",
										"retry": 0,
										"retryIntervalInSeconds": 30,
										"secureOutput": false,
										"secureInput": false
									},
									"userProperties": [],
									"typeProperties": {
										"storedProcedureName": "[dbo].[proc_UpdateAuditLog_Briggs]",
										"storedProcedureParameters": {
											"ConfigTableID": {
												"value": {
													"value": "@item().ID",
													"type": "Expression"
												},
												"type": "Int32"
											},
											"RowsRead": {
												"value": null,
												"type": "Int64"
											},
											"Status": {
												"value": "Success",
												"type": "String"
											}
										}
									},
									"linkedServiceName": {
										"referenceName": "DS_MDW_SP",
										"type": "LinkedServiceReference"
									}
								}
							]
						}
					},
					{
						"name": "ReportFactProc",
						"type": "Lookup",
						"dependsOn": [
							{
								"activity": "ForEach_Stage",
								"dependencyConditions": [
									"Succeeded"
								]
							},
							{
								"activity": "Stage_Parts_Sold_Margin_Cost_Of_Goods",
								"dependencyConditions": [
									"Succeeded"
								]
							},
							{
								"activity": "Stage_Part_Fill_Rate",
								"dependencyConditions": [
									"Succeeded"
								]
							},
							{
								"activity": "Stage_Parts_LCM_Year_End_Inventory",
								"dependencyConditions": [
									"Succeeded"
								]
							}
						],
						"policy": {
							"timeout": "7.00:00:00",
							"retry": 0,
							"retryIntervalInSeconds": 30,
							"secureOutput": false,
							"secureInput": false
						},
						"userProperties": [],
						"typeProperties": {
							"source": {
								"type": "AzureSqlSource",
								"sqlReaderQuery": "select  * from dbo.control_table where processsequence = 4 and enableaction = 1 \nand subjectarea='Report Fact Part SP'\norder by id",
								"queryTimeout": "02:00:00",
								"partitionOption": "None"
							},
							"dataset": {
								"referenceName": "Briggs_MDW",
								"type": "DatasetReference",
								"parameters": {
									"schema_name": "dbo",
									"table_name": "user"
								}
							},
							"firstRowOnly": false
						}
					},
					{
						"name": "ForEach_Fact",
						"type": "ForEach",
						"dependsOn": [
							{
								"activity": "ReportFactProc",
								"dependencyConditions": [
									"Succeeded"
								]
							}
						],
						"userProperties": [],
						"typeProperties": {
							"items": {
								"value": "@activity('ReportFactProc').output.value",
								"type": "Expression"
							},
							"batchCount": 5,
							"activities": [
								{
									"name": "Stored procedure",
									"type": "SqlServerStoredProcedure",
									"dependsOn": [
										{
											"activity": "Start_Table_Audit1_Fact",
											"dependencyConditions": [
												"Succeeded"
											]
										}
									],
									"policy": {
										"timeout": "7.00:00:00",
										"retry": 0,
										"retryIntervalInSeconds": 30,
										"secureOutput": false,
										"secureInput": false
									},
									"userProperties": [],
									"typeProperties": {
										"storedProcedureName": {
											"value": "@item().sourcetablename",
											"type": "Expression"
										}
									},
									"linkedServiceName": {
										"referenceName": "DS_MDW_SP",
										"type": "LinkedServiceReference"
									}
								},
								{
									"name": "Start_Table_Audit1_Fact",
									"type": "Lookup",
									"dependsOn": [],
									"policy": {
										"timeout": "7.00:00:00",
										"retry": 0,
										"retryIntervalInSeconds": 30,
										"secureOutput": false,
										"secureInput": false
									},
									"userProperties": [],
									"typeProperties": {
										"source": {
											"type": "AzureSqlSource",
											"sqlReaderStoredProcedureName": "[dbo].[proc_StartAuditLog_Briggs]",
											"storedProcedureParameters": {
												"ConfigTableID": {
													"type": "Int32",
													"value": {
														"value": "@item().ID",
														"type": "Expression"
													}
												},
												"DataFactoryName": {
													"type": "String",
													"value": {
														"value": "@pipeline().DataFactory",
														"type": "Expression"
													}
												},
												"ParentAuditID": {
													"type": "Int64",
													"value": {
														"value": "@item().ID",
														"type": "Expression"
													}
												},
												"PipelineName": {
													"type": "String",
													"value": {
														"value": "@pipeline().Pipeline",
														"type": "Expression"
													}
												},
												"PipelineRunID": {
													"type": "String",
													"value": {
														"value": "@pipeline().RunId",
														"type": "Expression"
													}
												},
												"PipelineTriggerID": {
													"type": "String",
													"value": {
														"value": "@pipeline().TriggerId",
														"type": "Expression"
													}
												},
												"PipelineTriggerName": {
													"type": "String",
													"value": {
														"value": "@pipeline().TriggerName",
														"type": "Expression"
													}
												},
												"PipelineTriggerType": {
													"type": "String",
													"value": {
														"value": "@pipeline().TriggerType",
														"type": "Expression"
													}
												},
												"Sourcedb": {
													"type": "String",
													"value": {
														"value": "@item().sourceDB",
														"type": "Expression"
													}
												},
												"sourcetable": {
													"type": "String",
													"value": {
														"value": "@item().SourcetableName",
														"type": "Expression"
													}
												}
											},
											"queryTimeout": "02:00:00",
											"partitionOption": "None"
										},
										"dataset": {
											"referenceName": "Briggs_MDW",
											"type": "DatasetReference",
											"parameters": {
												"schema_name": "dbo",
												"table_name": "user"
											}
										},
										"firstRowOnly": false
									}
								},
								{
									"name": "Set variable1_Fact",
									"type": "SetVariable",
									"dependsOn": [
										{
											"activity": "Stored procedure",
											"dependencyConditions": [
												"Failed"
											]
										}
									],
									"userProperties": [],
									"typeProperties": {
										"variableName": "ErrorMsg",
										"value": {
											"value": "@activity('ReportStageProc').Error.Message",
											"type": "Expression"
										}
									}
								},
								{
									"name": "Failure_Audit_Log_Fact",
									"type": "SqlServerStoredProcedure",
									"dependsOn": [
										{
											"activity": "Set variable1_Fact",
											"dependencyConditions": [
												"Succeeded"
											]
										}
									],
									"policy": {
										"timeout": "7.00:00:00",
										"retry": 0,
										"retryIntervalInSeconds": 30,
										"secureOutput": false,
										"secureInput": false
									},
									"userProperties": [],
									"typeProperties": {
										"storedProcedureName": "[dbo].[proc_UpdateAuditLog_Briggs]",
										"storedProcedureParameters": {
											"ConfigTableID": {
												"value": {
													"value": "@item().ID",
													"type": "Expression"
												},
												"type": "Int32"
											},
											"RowsRead": {
												"value": null,
												"type": "Int64"
											},
											"Status": {
												"value": {
													"value": "@variables('ErrorMsg')",
													"type": "Expression"
												},
												"type": "String"
											}
										}
									},
									"linkedServiceName": {
										"referenceName": "DS_MDW_SP",
										"type": "LinkedServiceReference"
									}
								},
								{
									"name": "Success_Audit_Log2_Fact",
									"type": "SqlServerStoredProcedure",
									"dependsOn": [
										{
											"activity": "Stored procedure",
											"dependencyConditions": [
												"Succeeded"
											]
										}
									],
									"policy": {
										"timeout": "7.00:00:00",
										"retry": 0,
										"retryIntervalInSeconds": 30,
										"secureOutput": false,
										"secureInput": false
									},
									"userProperties": [],
									"typeProperties": {
										"storedProcedureName": "[dbo].[proc_UpdateAuditLog_Briggs]",
										"storedProcedureParameters": {
											"ConfigTableID": {
												"value": {
													"value": "@item().ID",
													"type": "Expression"
												},
												"type": "Int32"
											},
											"RowsRead": {
												"value": null,
												"type": "Int64"
											},
											"Status": {
												"value": "Success",
												"type": "String"
											}
										}
									},
									"linkedServiceName": {
										"referenceName": "DS_MDW_SP",
										"type": "LinkedServiceReference"
									}
								}
							]
						}
					},
					{
						"name": "Stage_Parts_LCM_Year_End_Inventory",
						"type": "Copy",
						"dependsOn": [],
						"policy": {
							"timeout": "7.00:00:00",
							"retry": 0,
							"retryIntervalInSeconds": 30,
							"secureOutput": false,
							"secureInput": false
						},
						"userProperties": [],
						"typeProperties": {
							"source": {
								"type": "SqlServerSource",
								"sqlReaderQuery": "\n--declare @cte_poprice table ( itemid varchar(30), recid varchar(30))\n--declare @cte_popricewhs table ( itemid varchar(30), warehouse varchar(20), recid varchar(30))\n--declare @cte_recipetdate table ( itemid  varchar(30), reciptdate date, warehouse varchar(30))\n--declare @cte_lasttransdate table ( itemid  varchar(30), warehouse varchar(30), transdate date)\n--declare @cte_lasttransdatecounting table ( itemid  varchar(30), warehouse varchar(30), transdate date)\n\n\n\n with  cte_poprice as (\n    select pl.itemid itemid, \n            max ( pl.recid ) recid\n        from purchline pl\n   -- inner join salesline sl\n     --       on sl.salesid = pl.inventrefid\n        where pl.purchstatus in (2,3) \n\t\t\t--and sl.salesstatus in (2,3) \n    group by pl.itemid \n )\n\n, cte_popricewhs as (\n    select pl.itemid itemid,\n\t\t\tid.inventlocationid warehouse,\n            max ( pl.recid ) recid\n        from purchline pl\n\t\tleft join inventdim id on id.inventdimid = pl.inventdimid\n   -- inner join salesline sl\n     --       on sl.salesid = pl.inventrefid\n        where pl.purchstatus in (2,3) \n\t\t\t--and sl.salesstatus in (2,3) \n    group by pl.itemid ,id.inventlocationid\n),\ncte_recipetdate as (\n   select pl.itemid,\n               max ( vps.deliverydate ) reciptdate,\n               id.inventlocationid warehouse\n          from [briggs_mst].dbo.purchline pl\n     left join [briggs_mst].dbo.vendpackingsliptrans vps\n            on vps.origpurchid = pl.purchid\n           and pl.inventtransid = vps.inventtransid\n     left join [briggs_mst].dbo.inventdim id\n            on id.inventdimid = vps.inventdimid\n         where pl.purchstatus in (2,3)\n      group by pl.itemid,\n               id.inventlocationid \n )\n--insert into @cte_lastsaledate\n-- select it.itemid,\n--              id.inventlocationid,\n--              max ( it.recid )\n--         from [briggs_mst].dbo.inventtrans it\n--    left join [briggs_mst].dbo.inventdim id\n--           on it.inventdimid = id.inventdimid\n--    left join [briggs_mst].dbo.inventtransorigin ito\n--           on it.inventtransorigin = ito.recid\n--        where it.statusissue <> 0\n--          and ito.referencecategory = 0   \n--     group by it.itemid,\n--              id.inventlocationid \n,cte_lasttransdate  as (\nselect it.itemid itemid,\n              id.inventlocationid warehouse,\n              max ( it.datephysical ) transdate\n         from [briggs_mst].dbo.inventtrans it\n    left join [briggs_mst].dbo.inventdim id\n           on it.inventdimid = id.inventdimid\n    left join [briggs_mst].dbo.inventtransorigin ito\n           on it.inventtransorigin = ito.recid\n        where ( it.statusissue <> 0 or it.statusreceipt <> 0 )\n          and ito.referencecategory not in (5, 6, 13)\n     group by it.itemid,\n              id.inventlocationid\n ),\ncte_lasttransdatecounting   as (\nselect it.itemid itemid,\n              id.inventlocationid warehouse,\n              min ( it.datephysical ) transdate\n         from [briggs_mst].dbo.inventtrans it\n    left join [briggs_mst].dbo.inventdim id\n           on it.inventdimid = id.inventdimid\n    left join [briggs_mst].dbo.inventtransorigin ito\n           on it.inventtransorigin = ito.recid\n        where ( it.statusissue <> 0 or it.statusreceipt <> 0 )\n     group by it.itemid,\n              id.inventlocationid \n )\n\n\nselect distinct\nreplace ( invtable.itemid, char(13), '' ) 'item_id',\nreplace ( replace ( replace ( eco.NAME, char(10), '' ),\n                                        char(13), '' ),\n                                        char(9),  '' ) 'name',\ninvdim.inventsiteid invent_site_id,\ninvdim.inventlocationid invent_location_id,\ninvdim.wmslocationid wms_location_id,\ncast ( isnull ( ( ( invsum.postedqty  +\n                    invsum.received   -\n                    invsum.deducted   +\n                    invsum.registered -\n                    invsum.picked       ) ), 0 )\n       as decimal(10,2) ) 'avail_phys',\ncast ( invMod.price as decimal(10,2) ) 'cost',\ncast ( ( ( invsum.POSTEDQTY  +\n           invsum.RECEIVED   -\n           invsum.DEDUCTED   +\n           invsum.REGISTERED -\n           invsum.PICKED       ) ) * invMod.price\n       as decimal(10,2) ) 'extended_cost',\ninvLoc.cellid cell_id,\ncast ( invsum.RESERVPHYSICAL as int ) 'reserv_physical',\nsos.sos,\ncase\n     when invloc.WMSLOCATIONIDDEFAULTISSUE = invdim.WMSLOCATIONID\n          then 'Yes'\n          else invloc.WMSLOCATIONIDDEFAULTISSUE\n end 'default_bin',\n[Briggs_MST].[dbo].[ENUM2STR]\n             ( 'XAP_StockedStatus', invLoc.STOCKEDSTATUS ) 'stocked_status',\nddv.displayvalue display_value,\nisnull ( npritem2.RETURNABLE, 1 ) 'returnable',\ninvloc.calcminimum calc_minimum,\ninvloc.calcmaximum calc_maximum,\nisnull ( case\n \n              when purprice.purchprice is not null\n               and purprice.purchprice > 0\n               and nprprice1.price     is not null\n               and nprprice1.price     > 0   \n               and invmod.price        is not null\n               and invmod.price        > 0     \n               and nprprice1.price     <= invmod.price\n               and purprice.purchprice <= nprprice1.price\n              then cast ( purprice.purchprice as decimal(10,2) )\n \n              when purprice.purchprice is not null\n               and purprice.purchprice > 0   \n               and nprprice1.price     is not null\n               and nprprice1.price     > 0    \n               and invmod.price        is not null\n               and invmod.price        > 0   \n               and nprprice1.price     <= invmod.price\n               and nprprice1.price     <= purprice.purchprice\n              then cast ( nprprice1.price as decimal(10,2) )\n \n              when purprice.purchprice is not null\n               and purprice.purchprice > 0    \n               and nprprice1.price     is not null\n               and nprprice1.price     > 0   \n               and invmod.price        is not null\n               and invmod.price        > 0     \n               and invmod.price        <= nprprice1.price\n               and purprice.purchprice <= invmod.price\n              then cast ( purprice.purchprice as decimal(10,2) )\n \n              when purprice.purchprice is not null\n               and purprice.purchprice > 0       \n               and nprprice1.price     is not null\n               and nprprice1.price     > 0     \n               and invmod.price        is not null\n               and invmod.price        > 0      \n               and invmod.price        <= nprprice1.price\n               and invmod.price        <= purprice.purchprice\n              then cast ( invmod.price as decimal(10,2) )\n \n              when purprice.purchprice is not null\n               and purprice.purchprice > 0    \n               and nprprice1.price     is not null\n               and nprprice1.price     > 0     \n               and isnull ( invmod.price, 0 ) = 0     \n               and purprice.purchprice <= nprprice1.price\n              then cast ( purprice.purchprice as decimal(10,2) )\n \n              when purprice.purchprice is not null\n               and purprice.purchprice > 0    \n               and nprprice1.price     is not null\n               and nprprice1.price     > 0    \n               and isnull ( invmod.price, 0 ) = 0   \n               and nprprice1.price     <= purprice.purchprice\n              then cast ( nprprice1.price as decimal(10,2) )\n \n              when purprice.purchprice is not null\n               and purprice.purchprice > 0   \n               and isnull ( nprprice1.price, 0 ) = 0  \n               and invmod.price        is not null\n               and invmod.price        > 0   \n               and purprice.purchprice <= invmod.price\n              then cast ( purprice.purchprice as decimal(10,2) )\n \n \n              when purprice.purchprice is not null\n               and purprice.purchprice > 0    \n               and isnull ( nprprice1.price, 0 ) = 0    \n               and invmod.price        is not null\n               and invmod.price        > 0    \n               and invmod.price        <= purprice.purchprice\n              then cast ( invmod.price as decimal(10,2) )\n \n              when purprice.purchprice is not null\n               and purprice.purchprice > 0       \n               and isnull ( nprprice1.price, 0 ) = 0   \n               and isnull ( invmod.price,    0 ) = 0    \n              then cast ( purprice.purchprice as decimal(10,2) )\n \n              when isnull ( purprice.purchprice, 0 ) = 0   \n               and nprprice1.price is not null\n               and nprprice1.price > 0     \n               and invmod.price    is not null\n               and invmod.price    > 0     \n               and nprprice1.price <= invmod.price\n              then cast ( nprprice1.price as decimal(10,2) )\n \n              when isnull ( purprice.purchprice, 0 ) = 0  \n               and nprprice1.price is not null\n               and nprprice1.price > 0     \n               and invmod.price    is not null\n               and invmod.price    > 0     \n               and invmod.price    <= nprprice1.price\n              then cast ( invmod.price as decimal(10,2) )\n \n              when isnull ( purprice.purchprice, 0 ) = 0  \n               and nprprice1.price is not null\n               and nprprice1.price > 0     \n               and isnull ( invmod.price,        0 ) = 0  \n              then cast ( nprprice1.price as decimal(10,2) )\n \n              when isnull ( purprice.purchprice, 0 ) = 0  \n               and isnull ( nprprice1.price,     0 ) = 0  \n               and invmod.price is not null\n               and invmod.price > 0    \n              then cast ( invmod.price as decimal(10,2) )\n \n              when isnull ( purprice.purchprice, 0 ) = 0  \n               and isnull ( nprprice1.price,     0 ) = 0   \n               and isnull ( invmod.price,        0 ) = 0   \n               and invmod2.price is not null\n               and invmod2.price > 0    \n              then cast ( invmod2.price as decimal(10,2) )\n \n         end, 0 ) 'price_used',\ncast ( isnull ( nprPrice1.PRICE,     0 ) as decimal(10,2) ) 'dealer_net_price',\ncast ( isnull ( invMod2.PRICE,       0 ) as decimal(10,2) ) 'manage_cost_price',\ncast ( isnull ( purPrice.PURCHPRICE, 0 ) as decimal(10,2) ) 'purch_price',\ncase\n     when ltd.transdate is null or ltd.transdate = dateadd ( day, 0, 0 )\n          then case\n                    when ltd2.transdate = dateadd ( day, 0, 0 )\n                         then null else ltd2.transdate\n                end\n          else ltd.transdate\n end 'trans_date',\ncte_RecipetDate.reciptdate receipt_date,\n--case\n--     when ittt.DATEPHYSICAL = dateadd ( day, 0, 0 )\n--          then null else ittt.DATEPHYSICAL\n-- end 'Last Sale Date',\ninvsum.closed\n \nfrom       [briggs_mst].dbo.inventtable invtable  \ninner join [briggs_mst].dbo.inventsum invsum\n        on invtable.itemid = invsum.itemid\ninner join [briggs_mst].dbo.inventdim invdim\n        on invdim.inventdimid = invsum.inventdimid\ninner join [briggs_mst].dbo.inventtablemodule invmod   \n        on invmod.itemid = invtable.itemid\n       and invmod.moduletype = 1 and invmod.dataareaid = 'BRG'\ninner join [briggs_mst].dbo.inventtablemodule invmod2     \n        on invmod2.itemid = invtable.itemid\n       and invmod2.moduletype = 0 and invmod2.dataareaid = 'BRG'\nleft join [briggs_mst].dbo.inventitemlocation invloc\n\t\t\t\t\t\t\t\t\t\t\t\ton invloc.itemid = invtable.itemid\n\t\t\t\t\t\t\t\t\t\t\t   and invloc.countgroupid = invdim.inventlocationid\n\t\t\t\t\t\t\t\t\t\t\t\tand isnull(invloc.inventdimid,'') <> 'AllBlank'\ninner join [briggs_mst].dbo.xap_npritem npritem\n        on npritem.product = invtable.product\n       and npritem.itemdataareaid = 'brg'\nleft join [briggs_mst].dbo.xap_npritem npritem2\n        on npritem2.product = invtable.product\n       and npritem2.itemdataareaid = 'dat'\ninner join [briggs_mst].dbo.xap_sourceofsupply sos\n        on sos.recid = npritem.sosrecid\nleft join [briggs_mst].dbo.ecoresproducttranslation eco\n        on eco.product = invtable.product\ninner join [briggs_mst].dbo.inventmodelgroupitem imgi\n        on imgi.itemid = invtable.itemid\n       and imgi.itemdataareaid = 'brg'\ninner join [briggs_mst].dbo.inventmodelgroup img\n        on imgi.modelgroupid = img.modelgroupid\nleft join [briggs_mst].dbo.inventlocation il\n        on il.inventlocationid = invdim.inventlocationid\nleft join [briggs_mst].dbo.defaultdimensionview ddv\n        on ddv.defaultdimension = il.defaultdimension and ddv.dimensionattributeid = 5637145333\nleft join cte_poprice ctepo\n        on ctepo.itemid = invtable.itemid\n\nleft join [briggs_mst].dbo.xap_nprprice nprprice1 \n        on nprprice1.itemid = invtable.itemid\n       and nprprice1.itemdataareaid = 'brg'\n       and nprprice1.moduletype =1\n       and nprprice1.validto > getdate()\n--left join [briggs_mst].dbo.xap_nprprice nprprice2   \n--        on nprprice2.itemid = invtable.itemid\n--       and nprprice2.itemdataareaid = 'brg'\n--       and nprprice2.moduletype = 2\n--       and nprprice2.validto > getdate()\nleft join cte_recipetdate cte_recipetdate\n        on cte_recipetdate.itemid = invtable.itemid\n       and cte_recipetdate.warehouse = invdim.inventlocationid\n--left join @cte_lastsaledate cte_lastsaledate\n--        on cte_lastsaledate.itemid = invtable.itemid\n--       and cte_lastsaledate.warehouse = invdim.inventlocationid\n--left join [briggs_mst].dbo.inventtrans ittt\n--        on ittt.recid = cte_lastsaledate.recid\nleft join cte_lasttransdate ltd\n        on ltd.itemid = invtable.itemid\n       and ltd.warehouse = invdim.inventlocationid \nleft join cte_lasttransdatecounting ltd2\n        on ltd2.itemid = invtable.itemid\n       and ltd2.warehouse = invdim.inventlocationid \nleft join cte_popricewhs ctepow on ctepow.itemid = invtable.itemid and ctepow.warehouse = invdim.inventlocationid\nleft join purchline purprice        \n        on purprice.recid = case when invdim.inventsiteid = 'Parts' then ctepow.recid else ctepo.recid end\nwhere img.stockedproduct = 1\n  and invdim.inventsiteid in ( 'PARTS', 'VAN', 'CON' )\n  and invdim.wmslocationid <> ''\n  and  invsum.closed = 0\n  and sos.sos not in ( 'HYSWARR', 'YALEWARR' )\n  and nprprice1.currencycode <> ''",
								"queryTimeout": "02:00:00",
								"partitionOption": "None"
							},
							"sink": {
								"type": "AzureSqlSink",
								"preCopyScript": "truncate table briggs.Stage_Parts_LCM_Year_End_Inventory",
								"disableMetricsCollection": false
							},
							"enableStaging": false,
							"translator": {
								"type": "TabularTranslator",
								"mappings": [
									{
										"source": {
											"name": "item_id",
											"type": "String",
											"physicalType": "nvarchar"
										},
										"sink": {
											"name": "item_id",
											"type": "String",
											"physicalType": "nvarchar"
										}
									},
									{
										"source": {
											"name": "name",
											"type": "String",
											"physicalType": "nvarchar"
										},
										"sink": {
											"name": "name",
											"type": "String",
											"physicalType": "nvarchar"
										}
									},
									{
										"source": {
											"name": "invent_site_id",
											"type": "String",
											"physicalType": "nvarchar"
										},
										"sink": {
											"name": "invent_site_id",
											"type": "String",
											"physicalType": "nvarchar"
										}
									},
									{
										"source": {
											"name": "invent_location_id",
											"type": "String",
											"physicalType": "nvarchar"
										},
										"sink": {
											"name": "invent_location_id",
											"type": "String",
											"physicalType": "nvarchar"
										}
									},
									{
										"source": {
											"name": "wms_location_id",
											"type": "String",
											"physicalType": "nvarchar"
										},
										"sink": {
											"name": "wms_location_id",
											"type": "String",
											"physicalType": "nvarchar"
										}
									},
									{
										"source": {
											"name": "avail_phys",
											"type": "Decimal",
											"physicalType": "decimal",
											"scale": 2,
											"precision": 10
										},
										"sink": {
											"name": "avail_phys",
											"type": "Decimal",
											"physicalType": "decimal",
											"scale": 2,
											"precision": 10
										}
									},
									{
										"source": {
											"name": "cost",
											"type": "Decimal",
											"physicalType": "decimal",
											"scale": 2,
											"precision": 10
										},
										"sink": {
											"name": "cost",
											"type": "Decimal",
											"physicalType": "decimal",
											"scale": 2,
											"precision": 10
										}
									},
									{
										"source": {
											"name": "extended_cost",
											"type": "Decimal",
											"physicalType": "decimal",
											"scale": 2,
											"precision": 10
										},
										"sink": {
											"name": "extended_cost",
											"type": "Decimal",
											"physicalType": "decimal",
											"scale": 2,
											"precision": 10
										}
									},
									{
										"source": {
											"name": "cell_id",
											"type": "String",
											"physicalType": "nvarchar"
										},
										"sink": {
											"name": "cell_id",
											"type": "String",
											"physicalType": "nvarchar"
										}
									},
									{
										"source": {
											"name": "reserv_physical",
											"type": "Int32",
											"physicalType": "int"
										},
										"sink": {
											"name": "reserv_physical",
											"type": "Int32",
											"physicalType": "int"
										}
									},
									{
										"source": {
											"name": "sos",
											"type": "String",
											"physicalType": "nvarchar"
										},
										"sink": {
											"name": "sos",
											"type": "String",
											"physicalType": "nvarchar"
										}
									},
									{
										"source": {
											"name": "default_bin",
											"type": "String",
											"physicalType": "nvarchar"
										},
										"sink": {
											"name": "default_bin",
											"type": "String",
											"physicalType": "nvarchar"
										}
									},
									{
										"source": {
											"name": "stocked_status",
											"type": "String",
											"physicalType": "varchar"
										},
										"sink": {
											"name": "stocked_status",
											"type": "String",
											"physicalType": "varchar"
										}
									},
									{
										"source": {
											"name": "display_value",
											"type": "String",
											"physicalType": "nvarchar"
										},
										"sink": {
											"name": "display_value",
											"type": "String",
											"physicalType": "nvarchar"
										}
									},
									{
										"source": {
											"name": "returnable",
											"type": "Int32",
											"physicalType": "int"
										},
										"sink": {
											"name": "returnable",
											"type": "Int32",
											"physicalType": "int"
										}
									},
									{
										"source": {
											"name": "calc_minimum",
											"type": "Int32",
											"physicalType": "int"
										},
										"sink": {
											"name": "calc_minimum",
											"type": "Int32",
											"physicalType": "int"
										}
									},
									{
										"source": {
											"name": "calc_maximum",
											"type": "Int32",
											"physicalType": "int"
										},
										"sink": {
											"name": "calc_maximum",
											"type": "Int32",
											"physicalType": "int"
										}
									},
									{
										"source": {
											"name": "price_used",
											"type": "Decimal",
											"physicalType": "decimal",
											"scale": 2,
											"precision": 10
										},
										"sink": {
											"name": "price_used",
											"type": "Decimal",
											"physicalType": "decimal",
											"scale": 2,
											"precision": 10
										}
									},
									{
										"source": {
											"name": "dealer_net_price",
											"type": "Decimal",
											"physicalType": "decimal",
											"scale": 2,
											"precision": 10
										},
										"sink": {
											"name": "dealer_net_price",
											"type": "Decimal",
											"physicalType": "decimal",
											"scale": 2,
											"precision": 10
										}
									},
									{
										"source": {
											"name": "manage_cost_price",
											"type": "Decimal",
											"physicalType": "decimal",
											"scale": 2,
											"precision": 10
										},
										"sink": {
											"name": "manage_cost_price",
											"type": "Decimal",
											"physicalType": "decimal",
											"scale": 2,
											"precision": 10
										}
									},
									{
										"source": {
											"name": "purch_price",
											"type": "Decimal",
											"physicalType": "decimal",
											"scale": 2,
											"precision": 10
										},
										"sink": {
											"name": "purch_price",
											"type": "Decimal",
											"physicalType": "decimal",
											"scale": 2,
											"precision": 10
										}
									},
									{
										"source": {
											"name": "trans_date",
											"type": "DateTime",
											"physicalType": "datetime"
										},
										"sink": {
											"name": "trans_date",
											"type": "DateTime",
											"physicalType": "date"
										}
									},
									{
										"source": {
											"name": "receipt_date",
											"type": "DateTime",
											"physicalType": "datetime"
										},
										"sink": {
											"name": "receipt_date",
											"type": "DateTime",
											"physicalType": "date"
										}
									},
									{
										"source": {
											"name": "closed",
											"type": "Int32",
											"physicalType": "int"
										},
										"sink": {
											"name": "closed",
											"type": "Int32",
											"physicalType": "int"
										}
									}
								],
								"typeConversion": true,
								"typeConversionSettings": {
									"allowDataTruncation": true,
									"treatBooleanAsNumber": false
								}
							}
						},
						"inputs": [
							{
								"referenceName": "Briggs_MST",
								"type": "DatasetReference",
								"parameters": {}
							}
						],
						"outputs": [
							{
								"referenceName": "Briggs_MDW",
								"type": "DatasetReference",
								"parameters": {
									"schema_name": "Briggs",
									"table_name": "Stage_Parts_LCM_Year_End_Inventory"
								}
							}
						]
					},
					{
						"name": "Stage_Parts_Sold_Margin_Cost_Of_Goods",
						"type": "Copy",
						"dependsOn": [],
						"policy": {
							"timeout": "7.00:00:00",
							"retry": 0,
							"retryIntervalInSeconds": 30,
							"secureOutput": false,
							"secureInput": false
						},
						"userProperties": [],
						"typeProperties": {
							"source": {
								"type": "SqlServerSource",
								"sqlReaderQuery": "select sl.SALESID sales_id\n\t\t,sl.INVENTREFID invent_ref_id\n\t\t,sl.ITEMID item_id\n\t\t,sos.sos\n\t\t,sl.SALESQTY sales_qty\n\t\t,id.INVENTLOCATIONID invent_location_id\n\t\t,ddv.DISPLAYVALUE 'fin_branch'\n\t\t,svc.SVCCALLID svc_call_id\n\t\t,sl.CREATEDDATETIME created_date_time\n\t\t,svcTypeTable.CALLTYPEID call_type_id\n\t\t,replace(replace(sl.NAME,char(10),''),char(13),'') 'description'\n\t\t,pp.PARTPRICEGROUPID part_price_group_id\n\t\t,listprice.price 'list_price'\n\t\t,sl.salesprice 'sale_price'\n\t\t,sl.costprice 'cost_price'\n\t\t,listprice.price * sl.salesqty 'extended_list_price'\n\t\t,sl.lineamount 'extended_sale_price'\n\t\t,sl.costprice * sl.salesqty 'extended_cost'\n\t\t,sl.lineamount-(sl.costprice * sl.salesqty) 'profit'\n\t\t,case\n\t\t\twhen sl.COSTPRICE * sl.SALESQTY <> 0 then (sl.LINEAMOUNT-(sl.COSTPRICE * sl.SALESQTY))/(sl.COSTPRICE * sl.SALESQTY)\n\t\t\telse '0'\n\t\tEnd 'markup'\n\t\t,case\n\t\t\twhen sl.LINEAMOUNT <> 0 then (sl.LINEAMOUNT-(sl.COSTPRICE * sl.SALESQTY))/(sl.LINEAMOUNT)\n\t\t\telse '0'\n\t\tEnd 'margin',\n\t\tcij.INVOICEDATE invoice_date,\n\t\tcij.invoiceid invoice_id,\n\t\tst.CUSTACCOUNT cust_account,\n\t\tst.INVOICEACCOUNT invoice_account,\n\t\tst.DELIVERYNAME delivery_name,\n\t\tdir.NAME 'st_name',\n\t\tsl.createdby created_by,\n\t\t\n\t\t\n\t\t--ddv.DISPLAYVALUE 'finBranch',\nid.INVENTLOCATIONID 'warehouse',\ncase \n\twhen sl.SALESSTATUS = 1 then 'Open'\n\twhen sl.SALESSTATUS = 2 then 'Delivered'\n\twhen sl.SALESSTATUS = 3 then 'Invoiced'\nEnd 'status',\nsl.salesid 'sal_order',\nsvc.svccallid  'svc_order',\nsvctypetable.calltypeid 'svc_calltype',\nisnull(svc.invoiceaccount,st.invoiceaccount)  'bill_to',\nisnull(svc.custaccount,st.custaccount)   'ship_to',\n--sos.SOS,\n--sl.ITEMID,\nsl.NAME 'description_goods',\nsl.SALESQTY 'quantity',\ncast(sl.COSTPRICE as decimal(10,2)) 'cost_goods',\ncast((sl.COSTPRICE * sl.SALESQTY) as decimal(10,2)) 'ext_cost_goods',\ncast(sl.LINEAMOUNT as decimal(10,2)) 'line_amount',\n--cast((sl.SALESPRICE * sl.SALESQTY) as decimal(10,2)) 'Ext Sale',\nsl.INVENTREFID 'p.o',\ncase\n     when sl.INVENTREFID  like 'pur%' or sl.INVENTREFID like 'trj%'\n          then 1\n          else 0\n END 'line_b_ord',\ncase\n     when sl.INVENTREFID not like 'pur%' and sl.INVENTREFID not like 'trj%'\n          then 1\n          else 0\n END 'line_stock',\nsl.CREATEDDATETIME 'line_created',\nsl.recid rec_id,sl.SALESSTATUS sales_status\n\t\t\nfrom SALESLINE sl \nleft join XAP_SOURCEOFSUPPLY sos on sos.RECID = sl.SOSRECID\nleft join SALESTABLE st on st.SALESID = sl.SALESID\nleft join INVENTDIM id on sl.INVENTDIMID = id.INVENTDIMID\nleft join INVENTITEMLOCATION iil on iil.ITEMID = sl.ITEMID and iil.COUNTGROUPID = id.INVENTLOCATIONID\nleft join DEFAULTDIMENSIONVIEW ddv on ddv.DEFAULTDIMENSION = st.DEFAULTDIMENSION and ddv.DIMENSIONATTRIBUTEID = 5637145333\nleft join XAP_SVCCALLTABLE svc on svc.RECID = st.SVCCALLRECID\nleft join XAP_SVCCALLTYPETABLE svcTypeTable ON svc.CALLTYPEID = svcTypeTable.RECID\n\nleft join XAP_PARTPRICEGROUP pp on pp.RECID = st.PARTPRICEGROUPRECID\nleft join INVENTTABLEMODULE listprice on listprice.ITEMID = sl.ITEMID and MODULETYPE = 2\nleft join dbo.custinvoicejour as cij on cij.salesid = st.salesid\nleft join CUSTTABLE ct on ct.accountnum = st.INVOICEACCOUNT\nleft join dirpartytable dir on dir.RECID = ct.PARTY\nwhere sos.RECID is not null\n\tand st.SALESSTATUS in (1,2,3)\n\tand (year(sl.CREATEDDATETIME)>='2020'\n\tor year(cij.INVOICEDATE)>='2020')",
								"queryTimeout": "02:00:00",
								"partitionOption": "None"
							},
							"sink": {
								"type": "AzureSqlSink",
								"preCopyScript": "truncate table briggs.Stage_Parts_Sold_Margin_Cost_Of_Goods",
								"disableMetricsCollection": false
							},
							"enableStaging": false,
							"translator": {
								"type": "TabularTranslator",
								"mappings": [
									{
										"source": {
											"name": "sales_id",
											"type": "String",
											"physicalType": "nvarchar"
										},
										"sink": {
											"name": "sales_id",
											"type": "String",
											"physicalType": "String"
										}
									},
									{
										"source": {
											"name": "invent_ref_id",
											"type": "String",
											"physicalType": "nvarchar"
										},
										"sink": {
											"name": "invent_ref_id",
											"type": "String",
											"physicalType": "String"
										}
									},
									{
										"source": {
											"name": "item_id",
											"type": "String",
											"physicalType": "nvarchar"
										},
										"sink": {
											"name": "item_id",
											"type": "String",
											"physicalType": "String"
										}
									},
									{
										"source": {
											"name": "sos",
											"type": "String",
											"physicalType": "nvarchar"
										},
										"sink": {
											"name": "sos",
											"type": "String",
											"physicalType": "String"
										}
									},
									{
										"source": {
											"name": "sales_qty",
											"type": "Decimal",
											"physicalType": "decimal",
											"scale": 16,
											"precision": 32
										},
										"sink": {
											"name": "sales_qty",
											"type": "Decimal",
											"physicalType": "Decimal"
										}
									},
									{
										"source": {
											"name": "invent_location_id",
											"type": "String",
											"physicalType": "nvarchar"
										},
										"sink": {
											"name": "invent_location_id",
											"type": "String",
											"physicalType": "String"
										}
									},
									{
										"source": {
											"name": "fin_branch",
											"type": "String",
											"physicalType": "nvarchar"
										},
										"sink": {
											"name": "fin_branch",
											"type": "String",
											"physicalType": "String"
										}
									},
									{
										"source": {
											"name": "svc_call_id",
											"type": "String",
											"physicalType": "nvarchar"
										},
										"sink": {
											"name": "svc_call_id",
											"type": "String",
											"physicalType": "String"
										}
									},
									{
										"source": {
											"name": "created_date_time",
											"type": "DateTime",
											"physicalType": "datetime"
										},
										"sink": {
											"name": "created_date_time",
											"type": "DateTime",
											"physicalType": "DateTime"
										}
									},
									{
										"source": {
											"name": "call_type_id",
											"type": "String",
											"physicalType": "nvarchar"
										},
										"sink": {
											"name": "call_type_id",
											"type": "String",
											"physicalType": "String"
										}
									},
									{
										"source": {
											"name": "description",
											"type": "String",
											"physicalType": "nvarchar"
										},
										"sink": {
											"name": "description",
											"type": "String",
											"physicalType": "String"
										}
									},
									{
										"source": {
											"name": "part_price_group_id",
											"type": "String",
											"physicalType": "nvarchar"
										},
										"sink": {
											"name": "part_price_group_id",
											"type": "String",
											"physicalType": "String"
										}
									},
									{
										"source": {
											"name": "list_price",
											"type": "Decimal",
											"physicalType": "decimal",
											"scale": 16,
											"precision": 32
										},
										"sink": {
											"name": "list_price",
											"type": "Decimal",
											"physicalType": "Decimal"
										}
									},
									{
										"source": {
											"name": "sale_price",
											"type": "Decimal",
											"physicalType": "decimal",
											"scale": 16,
											"precision": 32
										},
										"sink": {
											"name": "sale_price",
											"type": "Decimal",
											"physicalType": "Decimal"
										}
									},
									{
										"source": {
											"name": "cost_price",
											"type": "Decimal",
											"physicalType": "decimal",
											"scale": 16,
											"precision": 32
										},
										"sink": {
											"name": "cost_price",
											"type": "Decimal",
											"physicalType": "Decimal"
										}
									},
									{
										"source": {
											"name": "extended_list_price",
											"type": "Decimal",
											"physicalType": "decimal",
											"scale": 6,
											"precision": 38
										},
										"sink": {
											"name": "extended_list_price",
											"type": "Decimal",
											"physicalType": "Decimal"
										}
									},
									{
										"source": {
											"name": "extended_sale_price",
											"type": "Decimal",
											"physicalType": "decimal",
											"scale": 16,
											"precision": 32
										},
										"sink": {
											"name": "extended_sale_price",
											"type": "Decimal",
											"physicalType": "Decimal"
										}
									},
									{
										"source": {
											"name": "extended_cost",
											"type": "Decimal",
											"physicalType": "decimal",
											"scale": 6,
											"precision": 38
										},
										"sink": {
											"name": "extended_cost",
											"type": "Decimal",
											"physicalType": "Decimal"
										}
									},
									{
										"source": {
											"name": "profit",
											"type": "Decimal",
											"physicalType": "decimal",
											"scale": 6,
											"precision": 38
										},
										"sink": {
											"name": "profit",
											"type": "Decimal",
											"physicalType": "Decimal"
										}
									},
									{
										"source": {
											"name": "markup",
											"type": "Decimal",
											"physicalType": "decimal",
											"scale": 6,
											"precision": 38
										},
										"sink": {
											"name": "markup",
											"type": "Decimal",
											"physicalType": "Decimal"
										}
									},
									{
										"source": {
											"name": "margin",
											"type": "Decimal",
											"physicalType": "decimal",
											"scale": 6,
											"precision": 38
										},
										"sink": {
											"name": "margin",
											"type": "Decimal",
											"physicalType": "Decimal"
										}
									},
									{
										"source": {
											"name": "invoice_date",
											"type": "DateTime",
											"physicalType": "datetime"
										},
										"sink": {
											"name": "invoice_date",
											"type": "DateTime",
											"physicalType": "DateTime"
										}
									},
									{
										"source": {
											"name": "invoice_id",
											"type": "String",
											"physicalType": "nvarchar"
										},
										"sink": {
											"name": "invoice_id",
											"type": "String",
											"physicalType": "String"
										}
									},
									{
										"source": {
											"name": "cust_account",
											"type": "String",
											"physicalType": "nvarchar"
										},
										"sink": {
											"name": "cust_account",
											"type": "String",
											"physicalType": "String"
										}
									},
									{
										"source": {
											"name": "invoice_account",
											"type": "String",
											"physicalType": "nvarchar"
										},
										"sink": {
											"name": "invoice_account",
											"type": "String",
											"physicalType": "String"
										}
									},
									{
										"source": {
											"name": "delivery_name",
											"type": "String",
											"physicalType": "nvarchar"
										},
										"sink": {
											"name": "delivery_name",
											"type": "String",
											"physicalType": "String"
										}
									},
									{
										"source": {
											"name": "st_name",
											"type": "String",
											"physicalType": "nvarchar"
										},
										"sink": {
											"name": "st_name",
											"type": "String",
											"physicalType": "String"
										}
									},
									{
										"source": {
											"name": "created_by",
											"type": "String",
											"physicalType": "nvarchar"
										},
										"sink": {
											"name": "created_by",
											"type": "String",
											"physicalType": "String"
										}
									},
									{
										"source": {
											"name": "warehouse",
											"type": "String",
											"physicalType": "nvarchar"
										},
										"sink": {
											"name": "warehouse",
											"type": "String",
											"physicalType": "String"
										}
									},
									{
										"source": {
											"name": "status",
											"type": "String",
											"physicalType": "varchar"
										},
										"sink": {
											"name": "status",
											"type": "String",
											"physicalType": "String"
										}
									},
									{
										"source": {
											"name": "sal_order",
											"type": "String",
											"physicalType": "nvarchar"
										},
										"sink": {
											"name": "sal_order",
											"type": "String",
											"physicalType": "String"
										}
									},
									{
										"source": {
											"name": "svc_order",
											"type": "String",
											"physicalType": "nvarchar"
										},
										"sink": {
											"name": "svc_order",
											"type": "String",
											"physicalType": "String"
										}
									},
									{
										"source": {
											"name": "svc_calltype",
											"type": "String",
											"physicalType": "nvarchar"
										},
										"sink": {
											"name": "svc_calltype",
											"type": "String",
											"physicalType": "String"
										}
									},
									{
										"source": {
											"name": "bill_to",
											"type": "String",
											"physicalType": "nvarchar"
										},
										"sink": {
											"name": "bill_to",
											"type": "String",
											"physicalType": "String"
										}
									},
									{
										"source": {
											"name": "ship_to",
											"type": "String",
											"physicalType": "nvarchar"
										},
										"sink": {
											"name": "ship_to",
											"type": "String",
											"physicalType": "String"
										}
									},
									{
										"source": {
											"name": "description_goods",
											"type": "String",
											"physicalType": "nvarchar"
										},
										"sink": {
											"name": "description_goods",
											"type": "String",
											"physicalType": "String"
										}
									},
									{
										"source": {
											"name": "quantity",
											"type": "Decimal",
											"physicalType": "decimal",
											"scale": 16,
											"precision": 32
										},
										"sink": {
											"name": "quantity",
											"type": "Decimal",
											"physicalType": "Decimal"
										}
									},
									{
										"source": {
											"name": "cost_goods",
											"type": "Decimal",
											"physicalType": "decimal",
											"scale": 2,
											"precision": 10
										},
										"sink": {
											"name": "cost_goods",
											"type": "Decimal",
											"physicalType": "Decimal"
										}
									},
									{
										"source": {
											"name": "ext_cost_goods",
											"type": "Decimal",
											"physicalType": "decimal",
											"scale": 2,
											"precision": 10
										},
										"sink": {
											"name": "ext_cost_goods",
											"type": "Decimal",
											"physicalType": "Decimal"
										}
									},
									{
										"source": {
											"name": "line_amount",
											"type": "Decimal",
											"physicalType": "decimal",
											"scale": 2,
											"precision": 10
										},
										"sink": {
											"name": "line_amount",
											"type": "Decimal",
											"physicalType": "Decimal"
										}
									},
									{
										"source": {
											"name": "p.o",
											"type": "String",
											"physicalType": "nvarchar"
										},
										"sink": {
											"name": "p.o",
											"type": "String",
											"physicalType": "String"
										}
									},
									{
										"source": {
											"name": "line_b_ord",
											"type": "Int32",
											"physicalType": "int"
										},
										"sink": {
											"name": "line_b_ord",
											"type": "Int32",
											"physicalType": "Int32"
										}
									},
									{
										"source": {
											"name": "line_stock",
											"type": "Int32",
											"physicalType": "int"
										},
										"sink": {
											"name": "line_stock",
											"type": "Int32",
											"physicalType": "Int32"
										}
									},
									{
										"source": {
											"name": "line_created",
											"type": "DateTime",
											"physicalType": "datetime"
										},
										"sink": {
											"name": "line_created",
											"type": "DateTime",
											"physicalType": "DateTime"
										}
									},
									{
										"source": {
											"name": "rec_id",
											"type": "Int64",
											"physicalType": "bigint"
										},
										"sink": {
											"name": "rec_id",
											"type": "Int64",
											"physicalType": "Int64"
										}
									},
									{
										"source": {
											"name": "sales_status",
											"type": "Int32",
											"physicalType": "int"
										},
										"sink": {
											"name": "sales_status",
											"type": "Int32",
											"physicalType": "Int32"
										}
									}
								],
								"typeConversion": true,
								"typeConversionSettings": {
									"allowDataTruncation": true,
									"treatBooleanAsNumber": false
								}
							}
						},
						"inputs": [
							{
								"referenceName": "Briggs_MST",
								"type": "DatasetReference",
								"parameters": {}
							}
						],
						"outputs": [
							{
								"referenceName": "Briggs_MDW",
								"type": "DatasetReference",
								"parameters": {
									"schema_name": "Briggs",
									"table_name": "Stage_Parts_Sold_Margin_Cost_Of_Goods"
								}
							}
						]
					},
					{
						"name": "Stage_Part_Fill_Rate",
						"type": "Copy",
						"dependsOn": [],
						"policy": {
							"timeout": "7.00:00:00",
							"retry": 0,
							"retryIntervalInSeconds": 30,
							"secureOutput": false,
							"secureInput": false
						},
						"userProperties": [],
						"typeProperties": {
							"source": {
								"type": "SqlServerSource",
								"sqlReaderQuery": "--declare @startdate varchar(10) = '2017-02',\n--@enddate varchar(10) = '2017-02',\n--@branch varchar(10) = '107',\n--@orderclass varchar(100)  = 'parts',\n--@svcType varchar(100) = 'None'-- 'PM'\n\n\nselect fr.*\n\t\t,cast(fr.Demand as int) 'display_demand'\n\t\t,cast(fr.Calls as int) 'display_calls'\n\t\t,ic.CELLID cell_id\n\t\t,case when ic.CELLID like 'AA%' then 1 else 2 end 'sort'\nfrom ( select\nddv.DISPLAYVALUE 'fin_branch',\nid.INVENTLOCATIONID 'warehouse',\ncase \n\twhen sl.SALESSTATUS = 1 then 'Open'\n\twhen sl.SALESSTATUS = 2 then 'Delivered'\n\twhen sl.SALESSTATUS = 3 then 'Invoiced'\nEnd 'status',\nsl.SALESID 'sal_order',\nsvc.SVCCALLID  'svc_order',\nsvcTypeTable.CALLTYPEID 'svc_call_type',\nisnull(svc.INVOICEACCOUNT,st.INVOICEACCOUNT)  'bill_to',\nisnull(svc.CUSTACCOUNT,st.CUSTACCOUNT)   'ship_to',\nsos.SOS sos,\nsl.ITEMID item_id,\nsl.NAME 'description',\ncast(sl.COSTPRICE as decimal(10,2)) 'cost',\nsl.SALESQTY 'quantity',\ncast((sl.COSTPRICE * sl.SALESQTY) as decimal(10,2)) 'ext_cost',\nsl.INVENTREFID 'po',\ncase\n     when sl.INVENTREFID <> ''\n          then 1\n          else 0\n END 'line_b_ord',\ncase\n     when sl.INVENTREFID = ''\n          then 1\n          else 0\n END 'line_stock',\nsl.CREATEDDATETIME 'line_created',\nsl.RECID 'line_rec_id',\nsum(cd.call) 'calls',\nsum(cd.demand) 'demand',\nst.PROJID  proj_id\n\n \nfrom       SALESLINE sl\ninner join XAP_SOURCEOFSUPPLY sos\n        on sos.RECID = sl.SOSRECID\nleft join SALESTABLE st\n        on st.SALESID = sl.SALESID\nleft join INVENTDIM id\n        on sl.INVENTDIMID = id.INVENTDIMID\nleft join DEFAULTDIMENSIONVIEW ddv\n        on ddv.DEFAULTDIMENSION = sl.DEFAULTDIMENSION\n       and ddv.DIMENSIONATTRIBUTEID = 5637145333\nleft join XAP_SVCCALLTABLE svc\n        on svc.RECID = st.SVCCALLRECID\nleft join XAP_SVCCALLTYPETABLE svcTypeTable\n        on svc.CALLTYPEID = svcTypeTable.RECID\nleft join XAP_CALLDEMAND cd\n        on cd.itemid = sl.itemid\n       and cd.inventlocationid = id.inventlocationid\n       and cd.TRANSDATE <=\n              cast ( year(sl.CREATEDDATETIME) as varchar(10) ) +\n              Replace ( Str ( cast ( month(sl.CREATEDDATETIME) as varchar(10) ), 2 ),\n                        ' ', '0' )\n       and cd.TRANSDATE >=\n              cast ( ( year(sl.CREATEDDATETIME) -1 ) as varchar(10) ) +\n              Replace ( Str ( cast ( month(sl.CREATEDDATETIME) as varchar(10) ), 2 ),\n                        ' ', '0' )\n \nwhere sos.RECID is not null\n  and sl.SALESSTATUS in (1,2,3)\n  and year(sl.CREATEDDATETIME)>='2021'\n      --between cast(@startdate + '-01' as date)\n          --and dateadd ( dd, -1, DATEADD ( m, +1, cast (@enddate + '-01' as date) ) )\n  --and ddv.DISPLAYVALUE in (@branch)\n  and sl.SALESQTY > 0\n  and sos.SOS not in ('HYSWARR','YALEWARR','RCON','TSRV')\n  and id.INVENTLOCATIONID like 'p%'\n  and id.INVENTLOCATIONID not in ('PTXWACO','PTXWFAL','PBEFLEET','PTXELP','PTXLUBB','PTXMEDL','PTXODSS')\n  --and st.PROJID like case \n\t--\t\t\t\twhen @orderclass = 'service' then 'S%'\n\t--\t\t\t\twhen @orderclass = 'all' then '%' \n\t--\t\t\t\twhen @orderclass = 'parts' then ''\n\t--\t\t\tend\n  --and (('None' in (@svcType)) or  ('All' in (@svcType)) or svcTypeTable.CALLTYPEID in (@svcType))\ngroup by\nddv.DISPLAYVALUE,\nid.INVENTLOCATIONID,\nsl.SALESSTATUS,\nsl.SALESID,\nsvc.SVCCALLID,\nsvcTypeTable.CALLTYPEID,\nisnull(svc.INVOICEACCOUNT,st.INVOICEACCOUNT) ,\nisnull(svc.CUSTACCOUNT,st.CUSTACCOUNT) , \nsos.SOS,\nsl.ITEMID,\nsl.NAME,\ncast(sl.COSTPRICE as decimal(10,2)),\nsl.SALESQTY,\nsl.INVENTREFID,\ncast((sl.COSTPRICE * sl.SALESQTY) as decimal(10,2)),\ncase\n     when sl.INVENTREFID <> ''\n          then 1\n          else 0\n END,\ncase\n     when sl.INVENTREFID = ''\n          then 1\n          else 0\n END,\nsl.CREATEDDATETIME,sl.RECID,st.PROJID ) fr\n \nleft join XAP_SOURCEOFSUPPLY sos\n       on sos.SOS = fr.SOS\nleft join XAP_INVENTCLASSIFICATION ic\n        on ic.ITEMACTIVITY = 1\n       and ic.SOSRECID = sos.RECID\n       and ic.INVENTLOCATIONID = fr.Warehouse\n       and case\n                when isnull ( fr.Demand, 0 ) >  0\n                 and isnull ( fr.Calls,  0 ) <= 0\n                     then 1\n                when isnull ( fr.Calls,  0 ) <= 0\n                     then 0 \n                else fr.Calls\n            end\n            between ic.CALLFROM and ic.CALLTO\n       and round(case\n                when isnull ( fr.Demand, 0 ) >  0\n                 and isnull ( fr.Calls,  0 ) <= 0\n                     then fr.Demand/1\n                when isnull ( fr.Calls,  0 ) <= 0\n                     then 0\n                when isnull ( fr.Demand, 0 ) <= 0\n                     then 0\n                else fr.Demand/fr.Calls\n            end * fr.Cost,2)\n            between ic.PRICEFROM and ic.PRICETO\n\noption (recompile)\n",
								"queryTimeout": "02:00:00",
								"partitionOption": "None"
							},
							"sink": {
								"type": "AzureSqlSink",
								"preCopyScript": "truncate table briggs.Stage_Part_Fill_Rate",
								"disableMetricsCollection": false
							},
							"enableStaging": false,
							"translator": {
								"type": "TabularTranslator",
								"mappings": [
									{
										"source": {
											"name": "fin_branch",
											"type": "String",
											"physicalType": "nvarchar"
										},
										"sink": {
											"name": "fin_branch",
											"type": "String",
											"physicalType": "String"
										}
									},
									{
										"source": {
											"name": "warehouse",
											"type": "String",
											"physicalType": "nvarchar"
										},
										"sink": {
											"name": "warehouse",
											"type": "String",
											"physicalType": "String"
										}
									},
									{
										"source": {
											"name": "status",
											"type": "String",
											"physicalType": "varchar"
										},
										"sink": {
											"name": "status",
											"type": "String",
											"physicalType": "String"
										}
									},
									{
										"source": {
											"name": "sal_order",
											"type": "String",
											"physicalType": "nvarchar"
										},
										"sink": {
											"name": "sal_order",
											"type": "String",
											"physicalType": "String"
										}
									},
									{
										"source": {
											"name": "svc_order",
											"type": "String",
											"physicalType": "nvarchar"
										},
										"sink": {
											"name": "svc_order",
											"type": "String",
											"physicalType": "String"
										}
									},
									{
										"source": {
											"name": "svc_call_type",
											"type": "String",
											"physicalType": "nvarchar"
										},
										"sink": {
											"name": "svc_call_type",
											"type": "String",
											"physicalType": "String"
										}
									},
									{
										"source": {
											"name": "bill_to",
											"type": "String",
											"physicalType": "nvarchar"
										},
										"sink": {
											"name": "bill_to",
											"type": "String",
											"physicalType": "String"
										}
									},
									{
										"source": {
											"name": "ship_to",
											"type": "String",
											"physicalType": "nvarchar"
										},
										"sink": {
											"name": "ship_to",
											"type": "String",
											"physicalType": "String"
										}
									},
									{
										"source": {
											"name": "sos",
											"type": "String",
											"physicalType": "nvarchar"
										},
										"sink": {
											"name": "sos",
											"type": "String",
											"physicalType": "String"
										}
									},
									{
										"source": {
											"name": "item_id",
											"type": "String",
											"physicalType": "nvarchar"
										},
										"sink": {
											"name": "item_id",
											"type": "String",
											"physicalType": "String"
										}
									},
									{
										"source": {
											"name": "description",
											"type": "String",
											"physicalType": "nvarchar"
										},
										"sink": {
											"name": "description",
											"type": "String",
											"physicalType": "String"
										}
									},
									{
										"source": {
											"name": "cost",
											"type": "Decimal",
											"physicalType": "decimal",
											"scale": 2,
											"precision": 10
										},
										"sink": {
											"name": "cost",
											"type": "Decimal",
											"physicalType": "Decimal"
										}
									},
									{
										"source": {
											"name": "quantity",
											"type": "Decimal",
											"physicalType": "decimal",
											"scale": 16,
											"precision": 32
										},
										"sink": {
											"name": "quantity",
											"type": "Decimal",
											"physicalType": "Decimal"
										}
									},
									{
										"source": {
											"name": "ext_cost",
											"type": "Decimal",
											"physicalType": "decimal",
											"scale": 2,
											"precision": 10
										},
										"sink": {
											"name": "ext_cost",
											"type": "Decimal",
											"physicalType": "Decimal"
										}
									},
									{
										"source": {
											"name": "po",
											"type": "String",
											"physicalType": "nvarchar"
										},
										"sink": {
											"name": "po",
											"type": "String",
											"physicalType": "String"
										}
									},
									{
										"source": {
											"name": "line_b_ord",
											"type": "Int32",
											"physicalType": "int"
										},
										"sink": {
											"name": "line_b_ord",
											"type": "Int32",
											"physicalType": "Int32"
										}
									},
									{
										"source": {
											"name": "line_stock",
											"type": "Int32",
											"physicalType": "int"
										},
										"sink": {
											"name": "line_stock",
											"type": "Int32",
											"physicalType": "Int32"
										}
									},
									{
										"source": {
											"name": "line_created",
											"type": "DateTime",
											"physicalType": "datetime"
										},
										"sink": {
											"name": "line_created",
											"type": "DateTime",
											"physicalType": "DateTime"
										}
									},
									{
										"source": {
											"name": "line_rec_id",
											"type": "Int64",
											"physicalType": "bigint"
										},
										"sink": {
											"name": "line_rec_id",
											"type": "Int64",
											"physicalType": "Int64"
										}
									},
									{
										"source": {
											"name": "calls",
											"type": "Int32",
											"physicalType": "int"
										},
										"sink": {
											"name": "calls",
											"type": "Int32",
											"physicalType": "Int32"
										}
									},
									{
										"source": {
											"name": "demand",
											"type": "Decimal",
											"physicalType": "decimal",
											"scale": 16,
											"precision": 38
										},
										"sink": {
											"name": "demand",
											"type": "Decimal",
											"physicalType": "Decimal"
										}
									},
									{
										"source": {
											"name": "proj_id",
											"type": "String",
											"physicalType": "nvarchar"
										},
										"sink": {
											"name": "proj_id",
											"type": "String",
											"physicalType": "String"
										}
									},
									{
										"source": {
											"name": "display_demand",
											"type": "Int32",
											"physicalType": "int"
										},
										"sink": {
											"name": "display_demand",
											"type": "Int32",
											"physicalType": "Int32"
										}
									},
									{
										"source": {
											"name": "display_calls",
											"type": "Int32",
											"physicalType": "int"
										},
										"sink": {
											"name": "display_calls",
											"type": "Int32",
											"physicalType": "Int32"
										}
									},
									{
										"source": {
											"name": "cell_id",
											"type": "String",
											"physicalType": "nvarchar"
										},
										"sink": {
											"name": "cell_id",
											"type": "String",
											"physicalType": "String"
										}
									},
									{
										"source": {
											"name": "sort",
											"type": "Int32",
											"physicalType": "int"
										},
										"sink": {
											"name": "sort",
											"type": "Int32",
											"physicalType": "Int32"
										}
									}
								],
								"typeConversion": true,
								"typeConversionSettings": {
									"allowDataTruncation": true,
									"treatBooleanAsNumber": false
								}
							}
						},
						"inputs": [
							{
								"referenceName": "Briggs_MST",
								"type": "DatasetReference",
								"parameters": {}
							}
						],
						"outputs": [
							{
								"referenceName": "Briggs_MDW",
								"type": "DatasetReference",
								"parameters": {
									"schema_name": "Briggs",
									"table_name": "Stage_Part_Fill_Rate"
								}
							}
						]
					},
					{
						"name": "Sp_ExecFailureAudit_Fact",
						"type": "SqlServerStoredProcedure",
						"dependsOn": [
							{
								"activity": "ForEach_Fact",
								"dependencyConditions": [
									"Failed"
								]
							}
						],
						"policy": {
							"timeout": "7.00:00:00",
							"retry": 0,
							"retryIntervalInSeconds": 30,
							"secureOutput": false,
							"secureInput": false
						},
						"userProperties": [],
						"typeProperties": {
							"storedProcedureName": "[dbo].[proc_UpdateAuditLog]",
							"storedProcedureParameters": {
								"AuditID": {
									"value": {
										"value": "@activity('lkp_ExecStartAuditProc').output.firstRow.AuditID",
										"type": "Expression"
									},
									"type": "Int32"
								},
								"DataLakePath": {
									"value": null,
									"type": "String"
								},
								"PipelineRunID": {
									"value": {
										"value": "@pipeline().RunId",
										"type": "Expression"
									},
									"type": "String"
								},
								"RowsRead": {
									"value": null,
									"type": "Int64"
								},
								"Status": {
									"value": "Fact Proc Failed",
									"type": "String"
								}
							}
						},
						"linkedServiceName": {
							"referenceName": "AzureSqlDatabase1",
							"type": "LinkedServiceReference"
						}
					},
					{
						"name": "Sp_ExecSuccessAudit",
						"type": "SqlServerStoredProcedure",
						"dependsOn": [
							{
								"activity": "ForEach_Fact",
								"dependencyConditions": [
									"Succeeded"
								]
							}
						],
						"policy": {
							"timeout": "7.00:00:00",
							"retry": 0,
							"retryIntervalInSeconds": 30,
							"secureOutput": false,
							"secureInput": false
						},
						"userProperties": [],
						"typeProperties": {
							"storedProcedureName": "[dbo].[proc_UpdateAuditLog]",
							"storedProcedureParameters": {
								"AuditID": {
									"value": {
										"value": "@activity('lkp_ExecStartAuditProc').output.firstRow.AuditID",
										"type": "Expression"
									},
									"type": "Int32"
								},
								"DataLakePath": {
									"value": null,
									"type": "String"
								},
								"RowsRead": {
									"value": null,
									"type": "Int64"
								},
								"Status": {
									"value": "Success",
									"type": "String"
								},
								"PipelineRunID": {
									"value": {
										"value": "@pipeline().RunId",
										"type": "Expression"
									},
									"type": "String"
								}
							}
						},
						"linkedServiceName": {
							"referenceName": "AzureSqlDatabase1",
							"type": "LinkedServiceReference"
						}
					},
					{
						"name": "lkp_ExecStartAuditProc",
						"type": "Lookup",
						"dependsOn": [],
						"policy": {
							"timeout": "7.00:00:00",
							"retry": 0,
							"retryIntervalInSeconds": 30,
							"secureOutput": false,
							"secureInput": false
						},
						"userProperties": [],
						"typeProperties": {
							"source": {
								"type": "AzureSqlSource",
								"sqlReaderStoredProcedureName": "[dbo].[proc_StartAuditLog]",
								"storedProcedureParameters": {
									"ConfigTableID": {
										"type": "Int32",
										"value": "-1"
									},
									"DataFactoryName": {
										"type": "String",
										"value": {
											"value": "@pipeline().DataFactory",
											"type": "Expression"
										}
									},
									"ParentAuditID": {
										"type": "Int64",
										"value": "-1"
									},
									"PipelineName": {
										"type": "String",
										"value": {
											"value": "@pipeline().Pipeline",
											"type": "Expression"
										}
									},
									"PipelineRunID": {
										"type": "String",
										"value": {
											"value": "@pipeline().RunId",
											"type": "Expression"
										}
									},
									"PipelineTriggerID": {
										"type": "String",
										"value": {
											"value": "@pipeline().TriggerId",
											"type": "Expression"
										}
									},
									"PipelineTriggerName": {
										"type": "String",
										"value": {
											"value": "@pipeline().TriggerName",
											"type": "Expression"
										}
									},
									"PipelineTriggerType": {
										"type": "String",
										"value": {
											"value": "@pipeline().TriggerType",
											"type": "Expression"
										}
									}
								},
								"queryTimeout": "02:00:00",
								"partitionOption": "None"
							},
							"dataset": {
								"referenceName": "Briggs_MDW",
								"type": "DatasetReference",
								"parameters": {
									"schema_name": "dbo",
									"table_name": "user"
								}
							}
						}
					},
					{
						"name": "Sp_ExecFailureAudit_Stage",
						"type": "SqlServerStoredProcedure",
						"dependsOn": [
							{
								"activity": "ForEach_Stage",
								"dependencyConditions": [
									"Failed"
								]
							}
						],
						"policy": {
							"timeout": "7.00:00:00",
							"retry": 0,
							"retryIntervalInSeconds": 30,
							"secureOutput": false,
							"secureInput": false
						},
						"userProperties": [],
						"typeProperties": {
							"storedProcedureName": "[dbo].[proc_UpdateAuditLog]",
							"storedProcedureParameters": {
								"AuditID": {
									"value": {
										"value": "@activity('lkp_ExecStartAuditProc').output.firstRow.AuditID",
										"type": "Expression"
									},
									"type": "Int32"
								},
								"DataLakePath": {
									"value": null,
									"type": "String"
								},
								"PipelineRunID": {
									"value": {
										"value": "@pipeline().RunId",
										"type": "Expression"
									},
									"type": "String"
								},
								"RowsRead": {
									"value": null,
									"type": "Int64"
								},
								"Status": {
									"value": "Stage Proc Failed",
									"type": "String"
								}
							}
						},
						"linkedServiceName": {
							"referenceName": "AzureSqlDatabase1",
							"type": "LinkedServiceReference"
						}
					},
					{
						"name": "Sp_ExecFailureAudit_TL",
						"type": "SqlServerStoredProcedure",
						"dependsOn": [
							{
								"activity": "Execute Pipeline1",
								"dependencyConditions": [
									"Failed"
								]
							}
						],
						"policy": {
							"timeout": "7.00:00:00",
							"retry": 0,
							"retryIntervalInSeconds": 30,
							"secureOutput": false,
							"secureInput": false
						},
						"userProperties": [],
						"typeProperties": {
							"storedProcedureName": "[dbo].[proc_UpdateAuditLog]",
							"storedProcedureParameters": {
								"AuditID": {
									"value": {
										"value": "@activity('lkp_ExecStartAuditProc').output.firstRow.AuditID",
										"type": "Expression"
									},
									"type": "Int32"
								},
								"DataLakePath": {
									"value": null,
									"type": "String"
								},
								"PipelineRunID": {
									"value": {
										"value": "@pipeline().RunId",
										"type": "Expression"
									},
									"type": "String"
								},
								"RowsRead": {
									"value": null,
									"type": "Int64"
								},
								"Status": {
									"value": "Table Load Failed",
									"type": "String"
								}
							}
						},
						"linkedServiceName": {
							"referenceName": "AzureSqlDatabase1",
							"type": "LinkedServiceReference"
						}
					}
				],
				"policy": {
					"elapsedTimeMetric": {},
					"cancelAfter": {}
				},
				"variables": {
					"ErrorMsg": {
						"type": "String"
					}
				},
				"folder": {
					"name": "Briggs Data Load Theme wise"
				},
				"annotations": [],
				"lastPublishTime": "2022-04-27T13:14:06Z"
			},
			"dependsOn": [
				"[concat(variables('workspaceId'), '/pipelines/PL_Generic_Copy_Parts')]",
				"[concat(variables('workspaceId'), '/datasets/Briggs_MDW')]",
				"[concat(variables('workspaceId'), '/datasets/Briggs_MST')]",
				"[concat(variables('workspaceId'), '/linkedServices/AzureSqlDatabase1')]",
				"[concat(variables('workspaceId'), '/linkedServices/DS_MDW_SP')]"
			]
		},
		{
			"name": "[concat(parameters('workspaceName'), '/PL_Master_Briggs_Rental')]",
			"type": "Microsoft.Synapse/workspaces/pipelines",
			"apiVersion": "2019-06-01-preview",
			"properties": {
				"activities": [
					{
						"name": "Execute Pipeline1",
						"type": "ExecutePipeline",
						"dependsOn": [
							{
								"activity": "lkp_ExecStartAuditProc",
								"dependencyConditions": [
									"Succeeded"
								]
							}
						],
						"userProperties": [],
						"typeProperties": {
							"pipeline": {
								"referenceName": "PL_Generic_Copy_Rental",
								"type": "PipelineReference"
							},
							"waitOnCompletion": true,
							"parameters": {}
						}
					},
					{
						"name": "ReportStageProc",
						"type": "Lookup",
						"dependsOn": [
							{
								"activity": "Execute Pipeline1",
								"dependencyConditions": [
									"Succeeded"
								]
							}
						],
						"policy": {
							"timeout": "7.00:00:00",
							"retry": 0,
							"retryIntervalInSeconds": 30,
							"secureOutput": false,
							"secureInput": false
						},
						"userProperties": [],
						"typeProperties": {
							"source": {
								"type": "AzureSqlSource",
								"sqlReaderQuery": "select  * from dbo.control_table where processsequence = 2 and enableaction = 1 and subjectarea='Report Stage Rental SP'\norder by id",
								"queryTimeout": "02:00:00",
								"partitionOption": "None"
							},
							"dataset": {
								"referenceName": "Briggs_MDW",
								"type": "DatasetReference",
								"parameters": {
									"schema_name": "dbo",
									"table_name": "user"
								}
							},
							"firstRowOnly": false
						}
					},
					{
						"name": "ForEach_Stage",
						"type": "ForEach",
						"dependsOn": [
							{
								"activity": "ReportStageProc",
								"dependencyConditions": [
									"Succeeded"
								]
							}
						],
						"userProperties": [],
						"typeProperties": {
							"items": {
								"value": "@activity('ReportStageProc').output.value",
								"type": "Expression"
							},
							"activities": [
								{
									"name": "Stored procedure1",
									"type": "SqlServerStoredProcedure",
									"dependsOn": [
										{
											"activity": "Start_Table_Audit_Stage",
											"dependencyConditions": [
												"Succeeded"
											]
										}
									],
									"policy": {
										"timeout": "7.00:00:00",
										"retry": 0,
										"retryIntervalInSeconds": 30,
										"secureOutput": false,
										"secureInput": false
									},
									"userProperties": [],
									"typeProperties": {
										"storedProcedureName": {
											"value": "@item().sourcetablename",
											"type": "Expression"
										}
									},
									"linkedServiceName": {
										"referenceName": "DS_MDW_SP",
										"type": "LinkedServiceReference"
									}
								},
								{
									"name": "Start_Table_Audit_Stage",
									"type": "Lookup",
									"dependsOn": [],
									"policy": {
										"timeout": "7.00:00:00",
										"retry": 0,
										"retryIntervalInSeconds": 30,
										"secureOutput": false,
										"secureInput": false
									},
									"userProperties": [],
									"typeProperties": {
										"source": {
											"type": "AzureSqlSource",
											"sqlReaderStoredProcedureName": "[dbo].[proc_StartAuditLog_Briggs]",
											"storedProcedureParameters": {
												"ConfigTableID": {
													"type": "Int32",
													"value": {
														"value": "@item().ID",
														"type": "Expression"
													}
												},
												"DataFactoryName": {
													"type": "String",
													"value": {
														"value": "@pipeline().DataFactory",
														"type": "Expression"
													}
												},
												"ParentAuditID": {
													"type": "Int64",
													"value": {
														"value": "@item().ID",
														"type": "Expression"
													}
												},
												"PipelineName": {
													"type": "String",
													"value": {
														"value": "@pipeline().Pipeline",
														"type": "Expression"
													}
												},
												"PipelineRunID": {
													"type": "String",
													"value": {
														"value": "@pipeline().RunId",
														"type": "Expression"
													}
												},
												"PipelineTriggerID": {
													"type": "String",
													"value": {
														"value": "@pipeline().TriggerId",
														"type": "Expression"
													}
												},
												"PipelineTriggerName": {
													"type": "String",
													"value": {
														"value": "@pipeline().TriggerName",
														"type": "Expression"
													}
												},
												"PipelineTriggerType": {
													"type": "String",
													"value": {
														"value": "@pipeline().TriggerType",
														"type": "Expression"
													}
												},
												"Sourcedb": {
													"type": "String",
													"value": {
														"value": "@item().sourceDB",
														"type": "Expression"
													}
												},
												"sourcetable": {
													"type": "String",
													"value": {
														"value": "@item().SourcetableName",
														"type": "Expression"
													}
												}
											},
											"queryTimeout": "02:00:00",
											"partitionOption": "None"
										},
										"dataset": {
											"referenceName": "Briggs_MDW",
											"type": "DatasetReference",
											"parameters": {
												"schema_name": "dbo",
												"table_name": "user"
											}
										},
										"firstRowOnly": false
									}
								},
								{
									"name": "Set variable_Stage",
									"type": "SetVariable",
									"dependsOn": [
										{
											"activity": "Stored procedure1",
											"dependencyConditions": [
												"Failed"
											]
										}
									],
									"userProperties": [],
									"typeProperties": {
										"variableName": "ErrorMsg",
										"value": {
											"value": "@activity('Stored procedure1').Error.Message",
											"type": "Expression"
										}
									}
								},
								{
									"name": "Failure_Audit_Log_Stage",
									"type": "SqlServerStoredProcedure",
									"dependsOn": [
										{
											"activity": "Set variable_Stage",
											"dependencyConditions": [
												"Succeeded"
											]
										}
									],
									"policy": {
										"timeout": "7.00:00:00",
										"retry": 0,
										"retryIntervalInSeconds": 30,
										"secureOutput": false,
										"secureInput": false
									},
									"userProperties": [],
									"typeProperties": {
										"storedProcedureName": "[dbo].[proc_UpdateAuditLog_Briggs]",
										"storedProcedureParameters": {
											"ConfigTableID": {
												"value": {
													"value": "@item().ID",
													"type": "Expression"
												},
												"type": "Int32"
											},
											"RowsRead": {
												"value": null,
												"type": "Int64"
											},
											"Status": {
												"value": {
													"value": "@variables('ErrorMsg')",
													"type": "Expression"
												},
												"type": "String"
											}
										}
									},
									"linkedServiceName": {
										"referenceName": "DS_MDW_SP",
										"type": "LinkedServiceReference"
									}
								},
								{
									"name": "Success_Audit_Log_Stage",
									"type": "SqlServerStoredProcedure",
									"dependsOn": [
										{
											"activity": "Stored procedure1",
											"dependencyConditions": [
												"Succeeded"
											]
										}
									],
									"policy": {
										"timeout": "7.00:00:00",
										"retry": 0,
										"retryIntervalInSeconds": 30,
										"secureOutput": false,
										"secureInput": false
									},
									"userProperties": [],
									"typeProperties": {
										"storedProcedureName": "[dbo].[proc_UpdateAuditLog_Briggs]",
										"storedProcedureParameters": {
											"ConfigTableID": {
												"value": {
													"value": "@item().ID",
													"type": "Expression"
												},
												"type": "Int32"
											},
											"RowsRead": {
												"value": null,
												"type": "Int64"
											},
											"Status": {
												"value": "Success",
												"type": "String"
											}
										}
									},
									"linkedServiceName": {
										"referenceName": "DS_MDW_SP",
										"type": "LinkedServiceReference"
									}
								}
							]
						}
					},
					{
						"name": "ReportFactProc",
						"type": "Lookup",
						"dependsOn": [
							{
								"activity": "ForEach_Stage",
								"dependencyConditions": [
									"Succeeded"
								]
							},
							{
								"activity": "Stage_Rental_Discount",
								"dependencyConditions": [
									"Succeeded"
								]
							}
						],
						"policy": {
							"timeout": "7.00:00:00",
							"retry": 0,
							"retryIntervalInSeconds": 30,
							"secureOutput": false,
							"secureInput": false
						},
						"userProperties": [],
						"typeProperties": {
							"source": {
								"type": "AzureSqlSource",
								"sqlReaderQuery": "select  * from dbo.control_table where processsequence = 4 and enableaction = 1 and subjectarea='Report Fact Rental SP'\norder by id",
								"queryTimeout": "02:00:00",
								"partitionOption": "None"
							},
							"dataset": {
								"referenceName": "Briggs_MDW",
								"type": "DatasetReference",
								"parameters": {
									"schema_name": "dbo",
									"table_name": "user"
								}
							},
							"firstRowOnly": false
						}
					},
					{
						"name": "ForEach_Fact",
						"type": "ForEach",
						"dependsOn": [
							{
								"activity": "ReportFactProc",
								"dependencyConditions": [
									"Succeeded"
								]
							},
							{
								"activity": "Stage_Re_Rent_PO_Tracking_Active",
								"dependencyConditions": [
									"Succeeded"
								]
							}
						],
						"userProperties": [],
						"typeProperties": {
							"items": {
								"value": "@activity('ReportFactProc').output.value",
								"type": "Expression"
							},
							"activities": [
								{
									"name": "Stored procedure",
									"type": "SqlServerStoredProcedure",
									"dependsOn": [
										{
											"activity": "Start_Table_Audit1_Fact",
											"dependencyConditions": [
												"Succeeded"
											]
										}
									],
									"policy": {
										"timeout": "7.00:00:00",
										"retry": 0,
										"retryIntervalInSeconds": 30,
										"secureOutput": false,
										"secureInput": false
									},
									"userProperties": [],
									"typeProperties": {
										"storedProcedureName": {
											"value": "@item().sourcetablename",
											"type": "Expression"
										}
									},
									"linkedServiceName": {
										"referenceName": "DS_MDW_SP",
										"type": "LinkedServiceReference"
									}
								},
								{
									"name": "Start_Table_Audit1_Fact",
									"type": "Lookup",
									"dependsOn": [],
									"policy": {
										"timeout": "7.00:00:00",
										"retry": 0,
										"retryIntervalInSeconds": 30,
										"secureOutput": false,
										"secureInput": false
									},
									"userProperties": [],
									"typeProperties": {
										"source": {
											"type": "AzureSqlSource",
											"sqlReaderStoredProcedureName": "[dbo].[proc_StartAuditLog_Briggs]",
											"storedProcedureParameters": {
												"ConfigTableID": {
													"type": "Int32",
													"value": {
														"value": "@item().ID",
														"type": "Expression"
													}
												},
												"DataFactoryName": {
													"type": "String",
													"value": {
														"value": "@pipeline().DataFactory",
														"type": "Expression"
													}
												},
												"ParentAuditID": {
													"type": "Int64",
													"value": {
														"value": "@item().ID",
														"type": "Expression"
													}
												},
												"PipelineName": {
													"type": "String",
													"value": {
														"value": "@pipeline().Pipeline",
														"type": "Expression"
													}
												},
												"PipelineRunID": {
													"type": "String",
													"value": {
														"value": "@pipeline().RunId",
														"type": "Expression"
													}
												},
												"PipelineTriggerID": {
													"type": "String",
													"value": {
														"value": "@pipeline().TriggerId",
														"type": "Expression"
													}
												},
												"PipelineTriggerName": {
													"type": "String",
													"value": {
														"value": "@pipeline().TriggerName",
														"type": "Expression"
													}
												},
												"PipelineTriggerType": {
													"type": "String",
													"value": {
														"value": "@pipeline().TriggerType",
														"type": "Expression"
													}
												},
												"Sourcedb": {
													"type": "String",
													"value": {
														"value": "@item().sourceDB",
														"type": "Expression"
													}
												},
												"sourcetable": {
													"type": "String",
													"value": {
														"value": "@item().SourcetableName",
														"type": "Expression"
													}
												}
											},
											"queryTimeout": "02:00:00",
											"partitionOption": "None"
										},
										"dataset": {
											"referenceName": "Briggs_MDW",
											"type": "DatasetReference",
											"parameters": {
												"schema_name": "dbo",
												"table_name": "user"
											}
										},
										"firstRowOnly": false
									}
								},
								{
									"name": "Set variable1_Fact",
									"type": "SetVariable",
									"dependsOn": [
										{
											"activity": "Stored procedure",
											"dependencyConditions": [
												"Failed"
											]
										}
									],
									"userProperties": [],
									"typeProperties": {
										"variableName": "ErrorMsg",
										"value": {
											"value": "@activity('ReportStageProc').Error.Message",
											"type": "Expression"
										}
									}
								},
								{
									"name": "Failure_Audit_Log_Fact",
									"type": "SqlServerStoredProcedure",
									"dependsOn": [
										{
											"activity": "Set variable1_Fact",
											"dependencyConditions": [
												"Succeeded"
											]
										}
									],
									"policy": {
										"timeout": "7.00:00:00",
										"retry": 0,
										"retryIntervalInSeconds": 30,
										"secureOutput": false,
										"secureInput": false
									},
									"userProperties": [],
									"typeProperties": {
										"storedProcedureName": "[dbo].[proc_UpdateAuditLog_Briggs]",
										"storedProcedureParameters": {
											"ConfigTableID": {
												"value": {
													"value": "@item().ID",
													"type": "Expression"
												},
												"type": "Int32"
											},
											"RowsRead": {
												"value": null,
												"type": "Int64"
											},
											"Status": {
												"value": {
													"value": "@variables('ErrorMsg')",
													"type": "Expression"
												},
												"type": "String"
											}
										}
									},
									"linkedServiceName": {
										"referenceName": "DS_MDW_SP",
										"type": "LinkedServiceReference"
									}
								},
								{
									"name": "Success_Audit_Log2_Fact",
									"type": "SqlServerStoredProcedure",
									"dependsOn": [
										{
											"activity": "Stored procedure",
											"dependencyConditions": [
												"Succeeded"
											]
										}
									],
									"policy": {
										"timeout": "7.00:00:00",
										"retry": 0,
										"retryIntervalInSeconds": 30,
										"secureOutput": false,
										"secureInput": false
									},
									"userProperties": [],
									"typeProperties": {
										"storedProcedureName": "[dbo].[proc_UpdateAuditLog_Briggs]",
										"storedProcedureParameters": {
											"ConfigTableID": {
												"value": {
													"value": "@item().ID",
													"type": "Expression"
												},
												"type": "Int32"
											},
											"RowsRead": {
												"value": null,
												"type": "Int64"
											},
											"Status": {
												"value": "Success",
												"type": "String"
											}
										}
									},
									"linkedServiceName": {
										"referenceName": "DS_MDW_SP",
										"type": "LinkedServiceReference"
									}
								}
							]
						}
					},
					{
						"name": "Stage_Rental_Discount",
						"type": "Copy",
						"dependsOn": [],
						"policy": {
							"timeout": "7.00:00:00",
							"retry": 0,
							"retryIntervalInSeconds": 30,
							"secureOutput": false,
							"secureInput": false
						},
						"userProperties": [],
						"typeProperties": {
							"source": {
								"type": "SqlServerSource",
								"sqlReaderQuery": "with Eq_Cost_cte(unit_num,dollars)\nas\n(\n\tselect finEq.DISPLAYVALUE,sum(a.TRANSACTIONCURRENCYAMOUNT)--,finAcct.DISPLAYVALUE\n\tfrom GENERALJOURNALACCOUNTENTRY a \n\tinner join GENERALJOURNALENTRY b on a.GENERALJOURNALENTRY = b.RECID\n\tinner join DIMENSIONATTRIBUTELEVELVALUEVIEW finEq \n\t\t\ton\tfinEq.VALUECOMBINATIONRECID = a.LEDGERDIMENSION \n\t\t\tand finEq.DIMENSIONATTRIBUTE = 5637145329\n\tinner join DIMENSIONATTRIBUTELEVELVALUEVIEW finAcct \n\t\t\ton finAcct.VALUECOMBINATIONRECID = a.LEDGERDIMENSION \n\t\t\tand finAcct.DIMENSIONATTRIBUTE = 5637144583 \n\t\t\tand finAcct.DISPLAYVALUE in ('122100','113105','113100','113107','122110','122000')\n\tgroup by finEq.DISPLAYVALUE--,finAcct.DISPLAYVALUE\n\n),Eq_Cost_UsedRental_cte(unit_num,dollars)\nas\n(\n\tselect finEq.DISPLAYVALUE,sum(a.TRANSACTIONCURRENCYAMOUNT)--,finAcct.DISPLAYVALUE\n\tfrom GENERALJOURNALACCOUNTENTRY a \n\tinner join GENERALJOURNALENTRY b on a.GENERALJOURNALENTRY = b.RECID\n\tinner join DIMENSIONATTRIBUTELEVELVALUEVIEW finEq \n\t\t\ton\tfinEq.VALUECOMBINATIONRECID = a.LEDGERDIMENSION \n\t\t\tand finEq.DIMENSIONATTRIBUTE = 5637145329\n\tinner join DIMENSIONATTRIBUTELEVELVALUEVIEW finAcct \n\t\t\ton finAcct.VALUECOMBINATIONRECID = a.LEDGERDIMENSION \n\t\t\tand finAcct.DIMENSIONATTRIBUTE = 5637144583 \n\t\t\tand finAcct.DISPLAYVALUE in ('122100','113105','113100','113107','122110')\n\twhere a.LEDGERCATEGORY = 0\n\tgroup by finEq.DISPLAYVALUE--,finAcct.DISPLAYVALUE\n\n)\n\nSELECT distinct\n\tsalesperson.[type],\n\tsalesperson.territory,\n\tsalesperson.branch,\n\tsalesperson.WorkerId worker_id,\n    isnull(salesperson.name,'*NO SALESPERSON*') 'SalesPerson1' ,\n\teq.ITEMID item_id,\n\tinvBranch.DISPLAYVALUE 'invoice_branch',\n\toc.ORDERCLASSID order_class_id,\n\tcij.INVOICEID invoice_id,\n\tfleettype.BATCHTEMPLATEID batch_template_id,\n\trenTable.rentalid rental_id,\n\tcit.LINENUM line_num,\n\trmld.INVOICEFROM invoice_from,\n\tcase when rmld.INVOICEUNTIL = dateadd(dd,0,0) then '' else rmld.INVOICEUNTIL end 'invoice_until',\n\t--rmld.STARTDATETIME,\n\t--rmld.ENDDATETIME,\n\tisl.VALIDFROM valid_from,\n\tisl.VALIDTO valid_to,\n\tdatediff(dd,isl.VALIDFROM,isl.VALIDTO) 'days_billed',\n\trt.TEMPLATEID template_id,\n\t1 'qty',\n\tcast (cit.LINEAMOUNTMST as decimal(20,2)) 'sale_price',\n\tcase \n\t\twhen fleettype.BATCHTEMPLATEID = 'Used rental' then cast(eqCostUsedRental.dollars as decimal(10,2)) \n\t\telse cast(eqCost.dollars as decimal(10,2)) \n\tEnd 'acq_cost',\n\tcit.INVOICEDATE invoice_date,\n\tsalesperson.[plan],\n\tcij.ORDERACCOUNT order_account,\n\tdirOrder.NAME 'order_cust_name',\n\tcij.INVOICEACCOUNT invoice_account,\n\tdirInvoice.NAME 'inv_cust_name',\n\teq.EQUIPMENTID equipment_id,\n\teq.INVENTSERIALID 'serial',\n\teqMake.NAME 'make',\n\teqType.TYPEID 'model',\n\tshipToAddy.zipcode,\n\tisnull(cast(case \n\t\t\t\t\t\twhen rmp.brcstatus = 2 then rrpActiveBRC.rateamount\n\t\t\t\t\t\telse rrpActive.rateamount\n\t\t\t\t\tend as decimal(10,2)),0) 'book_rate'\n\t,case \n\t\t\twhen rmp.brcstatus = 2 then 'BEST RATE CALC'\n\t\t\telse pct.NAME\n\t end 'period'\n\t ,eqBranch.DISPLAYVALUE 'eq_belongs_too'\n\t ,rmd.ESTRETURN est_return\n\t ,rct.classid class_id\nFROM [Briggs_Mst].dbo.CUSTINVOICETRANS cit\n\tINNER JOIN  [Briggs_Mst].dbo.CUSTINVOICEJOUR cij on cit.INVOICEID = cij.INVOICEID\n\tINNER JOIN [Briggs_Mst].dbo.XAP_ORDERCLASS oc on cij.ORDERCLASS = oc.RECID\n\tLEFT JOIN [briggsax].[dbo].[Commissions_SalesPeople] salesperson on cij.SALESPERSON1 = salesperson.RECID\n\tLEFT JOIN [briggsax].[dbo].[Commissions_SalesPeople] salesperson2 on cij.SALESPERSON2 = salesperson2.RECID\n\tLEFT JOIN [Briggs_Mst].dbo.XAP_INVOICESCHEDULELINE isl  on isl.RECID =cit.INVOICESCHEDULELINE\n\tLEFT JOIN [Briggs_Mst].dbo.XAP_EQUIPMENTTABLE eq on isl.EQUIPMENTID = eq.RECID\n \tLEFT JOIN [Briggs_Mst].dbo.DEFAULTDIMENSIONVIEW eqBranch on eqBranch.DEFAULTDIMENSION = eq.DEFAULTDIMENSION and eqBranch.DIMENSIONATTRIBUTEID = 5637145333\n\t\tLEFT JOIN [Briggs_Mst].dbo.XAP_MACHINETYPE eqType on  eq.MACHINETYPE = eqType.RECID\n\t\tLEFT JOIN [Briggs_Mst].dbo.XAP_MACHINEMANUFACTURER eqMake on eqType.MACHINEMANUFACTURER = eqMake.RECID\n\t\tLEFT join [Briggs_Mst].dbo.XAP_FLEETBATCHRELATION fleettype on fleettype.FLEETTYPE = eq.FLEETTYPE and fleettype.DATAAREAID = cit.DATAAREAID\n\tLEFT JOIN [Briggs_Mst].dbo.PURCHLINE on eq.EQUIPMENTID = PURCHLINE.EQUIPMENTID\n\tLEFT JOIN [Briggs_Mst].dbo.XAP_RENREVENUECATEGORYTABLE renrev on cit.SALESCATEGORY = renrev.SALESCATEGORY\n\tLEFT JOIN [Briggs_Mst].dbo.inventdim invdim on invdim.INVENTDIMID = cit.INVENTDIMID\n\tLEFT JOIN [briggsax].dbo.commission_rates comRates on comRates.item_number = eq.ITEMID \n\t\t\t\t\t\t\t\t\t\t\tand comRates.fleet_type = fleettype.BATCHTEMPLATEID\n\t\t\t\t\t\t\t\t\t\t\tand comRates.orderclass = oc.ORDERCLASSID \n\t\t\t\t\t\t\t\t\t\t\tand comRates.[plan] = salesperson.[plan]\n\tLEFT JOIN [Briggs_Mst].dbo.XAP_RENMAINLINE renLine on renLine.RECID = isl.RENMAINLINE\n\tLEFT JOIN [Briggs_Mst].dbo.XAP_RENMAINTABLE renTable on renline.MAINTABLEREFRECID = renTable.RECID\n\tLEFT JOIN [Briggs_Mst].dbo.DEFAULTDIMENSIONVIEW invBranch on invBranch.DEFAULTDIMENSION = renTable.DIMENSION and invBranch.DIMENSIONATTRIBUTEID = 5637145333\n\n\tLEFT JOIN [Briggs_Mst].dbo.custtable cusOrder on cij.ORDERACCOUNT = cusOrder.accountnum\n\tLEFT JOIN [Briggs_Mst].dbo.custtable cusInvoice on cij.INVOICEACCOUNT = cusInvoice.accountnum\n\tLEFT JOIN [Briggs_Mst].dbo.DIRPARTYTABLE dirOrder on cusOrder.PARTY = dirOrder.RECID\n\tLEFT JOIN [Briggs_Mst].dbo.DIRPARTYTABLE dirInvoice on cusInvoice.PARTY = dirInvoice.RECID\n\tleft join [Briggs_Mst].dbo.LOGISTICSPOSTALADDRESS shipToAddy on shipToAddy.RECID = cij.DELIVERYPOSTALADDRESS \n\tleft join [Briggs_mst].dbo.XAP_RENMAINLINEINVOICEINFO renLineInf on renLineInf.MAINLINEREFRECID = renline.RECID\n\tleft join [Briggs_mst].dbo.XAP_EQUIPMENTTRADEINFO eqTrade on eqTrade.EQUIPMENT = eq.RECID\n\tleft join [Briggs_mst].dbo.XAP_RENCLASSTABLE rct on rct.RECID = eqTrade.DEFAULTCLASS\n\tleft join [Briggs_mst].dbo.xap_renmainprice rmp on rmp.recid = isl.renmainprice\n\tleft join [Briggs_mst].dbo.XAP_RenBestRateCalculator rbrc on rbrc.line = renline.recid\n\tleft join [Briggs_mst].dbo.XAP_RENMAINLINEDATE rmld on rmld.MAINLINEREFRECID = renLine.RECID\n\tleft join [Briggs_mst].dbo.XAP_RENRATECONFIG rrc4 on rrc4.ACCOUNTRELATION = '' and rrc4.APPLICATION = renLineInf.APPLICATION and rrc4.SHIFT = renLineInf.SHIFT and rrc4.STORE = renLineInf.STORE and rrc4.CLASSRELATION = rct.CLASSID and rrc4.DIVISION = 0 and rrc4.TYPE = 0 and rrc4.ACCOUNTCODE = 2 and rrc4.CLASSCODE = 0\n\tleft join [Briggs_mst].dbo.XAP_RENRATEPRICE rrp4M on rrp4M.RATECONFIG = rrc4.RECID  and rrp4M.PERIOD = 5637144578\n\tleft join [Briggs_mst].dbo.XAP_RENRATEPRICE rrp4M2 on rrp4M2.RATECONFIG = rrc4.RECID  and rrp4M2.PERIOD = 5637144579\n\tleft join [Briggs_mst].dbo.XAP_RENRATEPRICE rrp4D on rrp4D.RATECONFIG = rrc4.RECID and rrp4D.PERIOD = 5637146076\n\tleft join [Briggs_mst].dbo.XAP_RENRATEPRICE rrp4W on rrp4W.RATECONFIG = rrc4.RECID and rrp4W.PERIOD = 5637146077\n\tleft join [Briggs_mst].dbo.XAP_RENRATEPRICE rrp4O on rrp4O.RATECONFIG = rrc4.RECID and rrp4O.PERIOD = 5637144582\n\tleft join [Briggs_mst].dbo.XAP_RENRATEPRICE rrpActive on rrpActive.RATECONFIG = rrc4.RECID and rrpActive.PERIOD = rmp.PERIOD\n\tleft join [Briggs_mst].dbo.XAP_RENRATEPRICE rrpActiveBRC on rrpActiveBRC.RATECONFIG = rrc4.RECID and rrpActiveBRC.PERIOD = case \n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\twhen rbrc.[MONTHS] <> 0 then 5637144578\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\twhen rbrc.[WEEKS] <> 0 then 5637146077\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\twhen rbrc.[DAYS] <> 0 then 5637146076\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t  end \n\tleft join [Briggs_mst].dbo.XAP_PERIODCODETABLE pct on pct.RECID = rrpActive.PERIOD\n\tLEFT JOIN Eq_Cost_cte eqCost on eq.EQUIPMENTID = eqCost.unit_num\n\tLEFT JOIN Eq_Cost_UsedRental_cte  eqCostUsedRental on eq.EQUIPMENTID = eqCostUsedRental.unit_num\n\tleft join XAP_RenTemplate rt on rt.RECID = renTable.RENTALTEMPLATE\n\tleft join XAP_RenMainDate rmd on rmd.MAINTABLEREFRECID = renTable.RECID\n\twhere oc.ORDERCLASSID = 'RENTAL' \n\tand eq.EQUIPMENTID is not null\n\tand cij.INVOICEID <>''\n\tand cij.INVOICEID like 'INV%'\n\tand fleettype.BATCHTEMPLATEID <> 're-rent'\n\tand fleettype.BATCHTEMPLATEID <> 'lease'\n\tand year(cit.invoicedate)>='2020'",
								"queryTimeout": "02:00:00",
								"partitionOption": "None"
							},
							"sink": {
								"type": "AzureSqlSink",
								"preCopyScript": "truncate table briggs.Stage_Rental_Discount",
								"disableMetricsCollection": false
							},
							"enableStaging": false,
							"translator": {
								"type": "TabularTranslator",
								"mappings": [
									{
										"source": {
											"name": "type",
											"type": "String",
											"physicalType": "nvarchar"
										},
										"sink": {
											"name": "type",
											"type": "String",
											"physicalType": "String"
										}
									},
									{
										"source": {
											"name": "territory",
											"type": "String",
											"physicalType": "nvarchar"
										},
										"sink": {
											"name": "territory",
											"type": "String",
											"physicalType": "String"
										}
									},
									{
										"source": {
											"name": "branch",
											"type": "String",
											"physicalType": "varchar"
										},
										"sink": {
											"name": "branch",
											"type": "String",
											"physicalType": "String"
										}
									},
									{
										"source": {
											"name": "worker_id",
											"type": "String",
											"physicalType": "nvarchar"
										},
										"sink": {
											"name": "worker_id",
											"type": "String",
											"physicalType": "String"
										}
									},
									{
										"source": {
											"name": "SalesPerson1",
											"type": "String",
											"physicalType": "nvarchar"
										},
										"sink": {
											"name": "SalesPerson1",
											"type": "String",
											"physicalType": "String"
										}
									},
									{
										"source": {
											"name": "item_id",
											"type": "String",
											"physicalType": "nvarchar"
										},
										"sink": {
											"name": "item_id",
											"type": "String",
											"physicalType": "String"
										}
									},
									{
										"source": {
											"name": "invoice_branch",
											"type": "String",
											"physicalType": "nvarchar"
										},
										"sink": {
											"name": "invoice_branch",
											"type": "String",
											"physicalType": "String"
										}
									},
									{
										"source": {
											"name": "order_class_id",
											"type": "String",
											"physicalType": "nvarchar"
										},
										"sink": {
											"name": "order_class_id",
											"type": "String",
											"physicalType": "String"
										}
									},
									{
										"source": {
											"name": "invoice_id",
											"type": "String",
											"physicalType": "nvarchar"
										},
										"sink": {
											"name": "invoice_id",
											"type": "String",
											"physicalType": "String"
										}
									},
									{
										"source": {
											"name": "batch_template_id",
											"type": "String",
											"physicalType": "nvarchar"
										},
										"sink": {
											"name": "batch_template_id",
											"type": "String",
											"physicalType": "String"
										}
									},
									{
										"source": {
											"name": "rental_id",
											"type": "String",
											"physicalType": "nvarchar"
										},
										"sink": {
											"name": "rental_id",
											"type": "String",
											"physicalType": "String"
										}
									},
									{
										"source": {
											"name": "line_num",
											"type": "Decimal",
											"physicalType": "decimal",
											"scale": 16,
											"precision": 32
										},
										"sink": {
											"name": "line_num",
											"type": "Decimal",
											"physicalType": "Decimal"
										}
									},
									{
										"source": {
											"name": "invoice_from",
											"type": "DateTime",
											"physicalType": "datetime"
										},
										"sink": {
											"name": "invoice_from",
											"type": "DateTime",
											"physicalType": "DateTime"
										}
									},
									{
										"source": {
											"name": "invoice_until",
											"type": "DateTime",
											"physicalType": "datetime"
										},
										"sink": {
											"name": "invoice_until",
											"type": "DateTime",
											"physicalType": "DateTime"
										}
									},
									{
										"source": {
											"name": "valid_from",
											"type": "DateTime",
											"physicalType": "datetime"
										},
										"sink": {
											"name": "valid_from",
											"type": "DateTime",
											"physicalType": "DateTime"
										}
									},
									{
										"source": {
											"name": "valid_to",
											"type": "DateTime",
											"physicalType": "datetime"
										},
										"sink": {
											"name": "valid_to",
											"type": "DateTime",
											"physicalType": "DateTime"
										}
									},
									{
										"source": {
											"name": "days_billed",
											"type": "Int32",
											"physicalType": "int"
										},
										"sink": {
											"name": "days_billed",
											"type": "Int32",
											"physicalType": "Int32"
										}
									},
									{
										"source": {
											"name": "template_id",
											"type": "String",
											"physicalType": "nvarchar"
										},
										"sink": {
											"name": "template_id",
											"type": "String",
											"physicalType": "String"
										}
									},
									{
										"source": {
											"name": "qty",
											"type": "Int32",
											"physicalType": "int"
										},
										"sink": {
											"name": "qty",
											"type": "Int32",
											"physicalType": "Int32"
										}
									},
									{
										"source": {
											"name": "sale_price",
											"type": "Decimal",
											"physicalType": "decimal",
											"scale": 2,
											"precision": 20
										},
										"sink": {
											"name": "sale_price",
											"type": "Decimal",
											"physicalType": "Decimal"
										}
									},
									{
										"source": {
											"name": "acq_cost",
											"type": "Decimal",
											"physicalType": "decimal",
											"scale": 2,
											"precision": 10
										},
										"sink": {
											"name": "acq_cost",
											"type": "Decimal",
											"physicalType": "Decimal"
										}
									},
									{
										"source": {
											"name": "invoice_date",
											"type": "DateTime",
											"physicalType": "datetime"
										},
										"sink": {
											"name": "invoice_date",
											"type": "DateTime",
											"physicalType": "DateTime"
										}
									},
									{
										"source": {
											"name": "plan",
											"type": "String",
											"physicalType": "varchar"
										},
										"sink": {
											"name": "plan",
											"type": "String",
											"physicalType": "String"
										}
									},
									{
										"source": {
											"name": "order_account",
											"type": "String",
											"physicalType": "nvarchar"
										},
										"sink": {
											"name": "order_account",
											"type": "String",
											"physicalType": "String"
										}
									},
									{
										"source": {
											"name": "order_cust_name",
											"type": "String",
											"physicalType": "nvarchar"
										},
										"sink": {
											"name": "order_cust_name",
											"type": "String",
											"physicalType": "String"
										}
									},
									{
										"source": {
											"name": "invoice_account",
											"type": "String",
											"physicalType": "nvarchar"
										},
										"sink": {
											"name": "invoice_account",
											"type": "String",
											"physicalType": "String"
										}
									},
									{
										"source": {
											"name": "inv_cust_name",
											"type": "String",
											"physicalType": "nvarchar"
										},
										"sink": {
											"name": "inv_cust_name",
											"type": "String",
											"physicalType": "String"
										}
									},
									{
										"source": {
											"name": "equipment_id",
											"type": "String",
											"physicalType": "nvarchar"
										},
										"sink": {
											"name": "equipment_id",
											"type": "String",
											"physicalType": "String"
										}
									},
									{
										"source": {
											"name": "serial",
											"type": "String",
											"physicalType": "nvarchar"
										},
										"sink": {
											"name": "serial",
											"type": "String",
											"physicalType": "String"
										}
									},
									{
										"source": {
											"name": "make",
											"type": "String",
											"physicalType": "nvarchar"
										},
										"sink": {
											"name": "make",
											"type": "String",
											"physicalType": "String"
										}
									},
									{
										"source": {
											"name": "model",
											"type": "String",
											"physicalType": "nvarchar"
										},
										"sink": {
											"name": "model",
											"type": "String",
											"physicalType": "String"
										}
									},
									{
										"source": {
											"name": "zipcode",
											"type": "String",
											"physicalType": "nvarchar"
										},
										"sink": {
											"name": "zipcode",
											"type": "String",
											"physicalType": "String"
										}
									},
									{
										"source": {
											"name": "book_rate",
											"type": "Decimal",
											"physicalType": "decimal",
											"scale": 2,
											"precision": 10
										},
										"sink": {
											"name": "book_rate",
											"type": "Decimal",
											"physicalType": "Decimal"
										}
									},
									{
										"source": {
											"name": "period",
											"type": "String",
											"physicalType": "nvarchar"
										},
										"sink": {
											"name": "period",
											"type": "String",
											"physicalType": "String"
										}
									},
									{
										"source": {
											"name": "eq_belongs_too",
											"type": "String",
											"physicalType": "nvarchar"
										},
										"sink": {
											"name": "eq_belongs_too",
											"type": "String",
											"physicalType": "String"
										}
									},
									{
										"source": {
											"name": "est_return",
											"type": "DateTime",
											"physicalType": "datetime"
										},
										"sink": {
											"name": "est_return",
											"type": "DateTime",
											"physicalType": "DateTime"
										}
									},
									{
										"source": {
											"name": "class_id",
											"type": "String",
											"physicalType": "nvarchar"
										},
										"sink": {
											"name": "class_id",
											"type": "String",
											"physicalType": "String"
										}
									}
								],
								"typeConversion": true,
								"typeConversionSettings": {
									"allowDataTruncation": true,
									"treatBooleanAsNumber": false
								}
							}
						},
						"inputs": [
							{
								"referenceName": "Briggs_MST",
								"type": "DatasetReference",
								"parameters": {}
							}
						],
						"outputs": [
							{
								"referenceName": "Briggs_MDW",
								"type": "DatasetReference",
								"parameters": {
									"schema_name": "Briggs",
									"table_name": "Stage_Rental_Discount"
								}
							}
						]
					},
					{
						"name": "Stage_Re_Rent_PO_Tracking_Active",
						"type": "Copy",
						"dependsOn": [],
						"policy": {
							"timeout": "7.00:00:00",
							"retry": 0,
							"retryIntervalInSeconds": 30,
							"secureOutput": false,
							"secureInput": false
						},
						"userProperties": [],
						"typeProperties": {
							"source": {
								"type": "SqlServerSource",
								"sqlReaderQuery": "if object_id('tempdb..#ttable2') is not null \ndrop \n  table #ttable2\n  if object_id('tempdb..#temp1') is not null \ndrop \n  table #temp1\n  if object_id('tempdb..#temp2') is not null \ndrop \n  table #temp2\n  if object_id('tempdb..#temp3') is not null \ndrop \n  table #temp3\nselect \n  id.inventequipmentid, \n  vpj.purchid, \n  vpj.deliverydate, \n  month(vpj.deliverydate) 'month', \n  year(vpj.deliverydate) 'year' into #temp1\nfrom \n  dbo.vendpackingsliptrans vpt \n  inner join dbo.vendpackingslipjour vpj on vpt.vendpackingslipjour = vpj.recid \n  and vpj.dataareaid = 'brg' \n  and vpj.partition = 5637144576 \n  inner join dbo.inventdim id on id.inventdimid = vpt.inventdimid \n  and id.dataareaid = 'brg' \n  and id.partition = 5637144576 \nwhere \n  vpt.dataareaid = 'brg' \n  and vpt.partition = 5637144576 \n  and id.inventequipmentid <> '' \n  create clustered index ix_purchid on #temp1 (purchid,inventequipmentid);\nselect \n  vij.purchid, \n  id.inventequipmentid, \n  vij.invoicedate, \n  vij.ledgervoucher, \n  vit.lineamount into #temp2\nfrom \n  dbo.vendinvoicejour vij \n  inner join dbo.vendinvoicetrans vit on vit.invoiceid = vij.invoiceid \n  and vit.createddatetime = vit.createddatetime \n  and vit.dataareaid = 'brg' \n  and vit.partition = 5637144576 \n  left join dbo.inventdim id on vit.inventdimid = id.inventdimid \n  and id.dataareaid = 'brg' \n  and id.partition = 5637144576 \nwhere \n  vij.dataareaid = 'brg' \n  and vij.partition = 5637144576 \n  and id.inventequipmentid <> '' \n  create clustered index ix_purchid on #temp2 (purchid,inventequipmentid);\nselect \n  id.inventequipmentid, \n  vpj.purchid, \n  max(vpj.deliverydate) 'lastdate', \n  count(*) 'count' into #temp3\nfrom \n  dbo.vendpackingsliptrans vpt \n  inner join dbo.vendpackingslipjour vpj on vpt.vendpackingslipjour = vpj.recid \n  and vpj.dataareaid = 'brg' \n  and vpj.partition = 5637144576 \n  inner join dbo.inventdim id on id.inventdimid = vpt.inventdimid \n  and id.dataareaid = 'brg' \n  and id.partition = 5637144576 \nwhere \n  vpt.dataareaid = 'brg' \n  and vpt.partition = 5637144576 \n  and id.inventequipmentid <> '' \n  and vpj.deliverydate between dateadd(\n    month, \n    datediff(\n      month, \n      0, \n      getdate()\n    ), \n    0\n  ) \n  and getdate() \ngroup by \n  id.inventequipmentid, \n  vpj.purchid \n  create clustered index ix_purchid on #temp3 (purchid,inventequipmentid);\nselect \n  * into #ttable2 \nfrom \n  (\n    select \n      id.inventlocationid, \n      id.inventequipmentid, \n      rmt.rentalid, \n      pt.purchid, \n      pt.invoiceaccount + ' - ' + pt.purchname as 'invoiceaccount', \n      pt.orderaccount + ' - ' + pt.deliveryname as 'vendoraccount' --,dbo.enum2str('versioningdocumentstate', pt.documentstate) 'approval status'\n      --,dbo.enum2str('purchstatus', pl.purchstatus)  'purchstatus'\n      , \n      ds.[approvalstatus] 'approval status', \n      ps.purchstatus, \n      pl.createddatetime, \n      t1.deliverydate, \n      t2.invoicedate, \n      t2.ledgervoucher, \n      dir.name, \n      t2.lineamount 'total amount', \n      pl.createdby, \n      pl.lineamount, \n      t1.month, \n      t1.year, \n      t3.count 'reciept count', \n      t3.lastdate 'last reciept date' \n    from \n      dbo.purchline pl \n      left join dbo.purchtable pt on pl.purchid = pt.purchid \n      and pt.dataareaid = 'brg' \n      and pt.partition = 5637144576 \n      left join dbo.inventdim id on pl.inventdimid = id.inventdimid \n      and id.dataareaid = 'brg' \n      and id.partition = 5637144576 \n      left join dbo.xap_renmaintable rmt on rmt.recid = pt.renmaintable \n      and rmt.dataareaid = 'brg' \n      and rmt.partition = 5637144576 \n      left join #temp1 t1 on t1.inventequipmentid = id.inventequipmentid and pt.purchid = t1.purchid \n      left join #temp2 t2 on t2.inventequipmentid = id.inventequipmentid and t2.purchid = pt.purchid\n      left join #temp3 t3 on t3.inventequipmentid = id.inventequipmentid and t3.purchid = pt.purchid\n      left join dbo.hcmworker wrker on wrker.recid = pt.workerpurchplacer \n      and wrker.partition = 5637144576 \n      left join dirpartytable dir on dir.recid = wrker.person \n      left join briggsAX.dbo.[ref_documentstate] ds on ds.documentstateid = pt.documentstate \n      left join briggsAX.dbo.[ref_purchstatus] ps on ps.purchstatusid = pl.purchstatus \n    where \n      pl.dataareaid = 'brg' \n      and pl.partition = 5637144576 \n      and pl.itemid = 'eqrerentcost'\n  ) a \n  create clustered index ix_rentalid on #ttable2 (rentalid,inventequipmentid);\n\n\nselect \n  distinct rmt.inventlocation invent_location, \n  ddveq.displayvalue eq_belongs_to, \n  ddvcontract.displayvalue contract_belongs_to, \n  rt.templateid template_id, \n  rmt.rentalid rental_id --  ,dbo.enum2str('xap_rencontractstatus', rmt.contractstatus) 'contract status'\n  , \n  cs.contractstatus contract_status, \n  ct.accountnum 'rent_account', \n  dir.name 'rent_account_name', \n  ct2.accountnum 'invoice_account#', \n  dir2.name 'invoice_account_name', \n  rmld.startdatetime contract_state_date, \n  rmld.enddatetime contract_end_date, \n  rmld.estreturn contract_est_return_date, \n  eq.equipmentid equipment_id, \n  eq.inventserialid invent_serial_id --  ,dbo.enum2str('xap_renmainlinestatus', rml.linestatus) 'line status'\n  , \n  ls.linestatus 'line_status', \n  make.[manufacturerid] 'make', \n  model.typeid 'model', \n  fleet.batchtemplateid 'fleet_type', \n  rct.classid 'rental_class', \n  datediff(\n    dd, \n    rmld.startdatetime, \n    getdate()\n  ) 'days_open', \n  csp.salesmancode salesman_code, \n  spdir.name 'salesperson', \n  case when pctactive.periodid = 'brc' then 'brc (' + cast(\n    rbrc.days as varchar(10)\n  ) + ' days, ' + cast(\n    rbrc.weeks as varchar(10)\n  ) + ' weeks, ' + cast(\n    rbrc.months as varchar(10)\n  ) + ' months)' else pctactive.periodid end 'period_id', \n  rim.invmethodid inv_method_id, \n  rmpday.amount actuals_day, \n  rmpweek.amount actuals_week, \n  rmpmonth.amount actuals_month --,rrpday.rateamount 'book day'\n  --,rrpweek.rateamount 'book week'\n  --,rrpmonth.rateamount 'book month'\n  , \n  case when pctactive.periodid = 'brc' then (rbrc.days * rbrc.dailyrate) + (rbrc.weeks * rbrc.weeklyrate) + (rbrc.months * rbrc.monthlyrate) else case when pctactive.periodid = 'daily' then rmpday.amount when pctactive.periodid = 'weekly' then rmpweek.amount else rmpmonth.amount end end actual_used --,case when pctactive.periodid = 'brc' then (rbrc.days * rrpday.rateamount) + (rbrc.weeks * rrpweek.rateamount) + (rbrc.months * rrpmonth.rateamount) \n  --  else case \n  --      when pctactive.periodid = 'daily' then rrpday.rateamount\n  --      when pctactive.periodid = 'weekly' then rrpweek.rateamount\n  --      else rrpmonth.rateamount\n  --     end\n  --end 'book used'\n  , \n  case when reneq.classtable <> eqtrade.defaultclass then 'yes' else 'no' end 'substitution', \n  tt.inventlocationid po_invent_location_id, \n  tt.inventequipmentid po_invent_equipment_id, \n  tt.rentalid po_rental_id, \n  tt.purchid 'po_purch_id', \n  tt.invoiceaccount po_invoice_account, \n  tt.vendoraccount po_vendor_account, \n  tt.[approval status] po_approval_status, \n  tt.purchstatus po_purch_status, \n  tt.createddatetime po_created_date_time, \n  tt.deliverydate po_delivery_date, \n  tt.invoicedate po_invoice_date, \n  tt.ledgervoucher po_ledger_voucher, \n  tt.name po_name, \n  tt.[total amount] po_total_amount, \n  tt.createdby po_created_by, \n  tt.lineamount po_line_amount, \n  tt.[reciept count] receipt_count, \n  tt.[last reciept date] reciept_last, \n  case when tt.lineamount is not null then (\n    case when pctactive.periodid = 'brc' then (rbrc.days * rbrc.dailyrate) + (rbrc.weeks * rbrc.weeklyrate) + (rbrc.months * rbrc.monthlyrate) else case when pctactive.periodid = 'daily' then rmpday.amount when pctactive.periodid = 'weekly' then rmpweek.amount else rmpmonth.amount end end - tt.lineamount\n  ) end amount1, \n  case when pctactive.periodid = 'brc' then nullif(\n    (rbrc.days * rbrc.dailyrate) + (rbrc.weeks * rbrc.weeklyrate) + (rbrc.months * rbrc.monthlyrate), \n    0\n  ) else case when pctactive.periodid = 'daily' then nullif(rmpday.amount, 0) when pctactive.periodid = 'weekly' then nullif(rmpweek.amount, 0) else nullif(rmpmonth.amount, 0) end end amount2, \n  reneq.askingprice asking_price, \n  reneq.classtable class_table, \n  reneq.closedby closed_by, \n  reneq.closeddatetime closed_date_time, \n  reneq.closeddatetimetzid closed_date_time_tzid, \n  reneq.deliverydate delivery_date, \n  reneq.enddatetime end_date_time, \n  reneq.enddatetimetzid end_date_time_tzid, \n  reneq.endfuel end_fuel, \n  reneq.endsmu end_smu, \n  reneq.equipment equipment, \n  reneq.estreturn est_return, \n  reneq.invoicefrom invoice_from, \n  reneq.invoiceuntil invoice_until, \n  reneq.mainline main_line, \n  reneq.maintable main_table, \n  reneq.pickupdate pickup_date, \n  reneq.primeproduct prime_product, \n  reneq.reservation, \n  reneq.revenuepct revenue_pct, \n  reneq.startdatetime start_date_time, \n  reneq.startdatetimetzid start_date_time_tzid, \n  reneq.startfuel start_fuel, \n  reneq.startsmu start_smu, \n  reneq.[status], \n  reneq.replacedeqonmainline replaced_eq_on_mainline, \n  reneq.revsplitforswappedeq [rev_split_for_swapped_eq], \n  reneq.maintype main_type, \n  reneq.createddatetime created_date_time, \n  reneq.createdby created_by, \n  reneq.dataareaid data_area_id, \n  reneq.recversion rec_version, \n  reneq.[partition], \n  reneq.recid rec_id \nfrom \n  dbo.xap_renmainline rml \n  left join dbo.xap_renmaintable rmt on rml.maintablerefrecid = rmt.recid \n  and rmt.dataareaid = 'brg' \n  and rmt.partition = 5637144576 \n  inner join dbo.xap_reneqonmainline reneq on reneq.mainline = rml.recid \n  and reneq.dataareaid = 'brg' \n  and reneq.partition = 5637144576 \n  inner join dbo.xap_equipmenttable eq on eq.recid = reneq.equipment \n  and eq.dataareaid = 'brg' \n  and eq.partition = 5637144576 \n  left join dbo.xap_equipmenttradeinfo eqtrade on eqtrade.equipment = eq.recid \n  and eqtrade.dataareaid = 'brg' \n  and eqtrade.partition = 5637144576 \n  left join dbo.xap_renmainprice rmpday on rmpday.mainlinerefrecid = rml.recid \n  and rmpday.period = 5637146076 \n  and rmpday.dataareaid = 'brg' \n  and rmpday.partition = 5637144576 \n  left join dbo.xap_renmainprice rmpweek on rmpweek.mainlinerefrecid = rml.recid \n  and rmpweek.period = 5637146077 \n  and rmpweek.dataareaid = 'brg' \n  and rmpweek.partition = 5637144576 \n  left join dbo.xap_renmainprice rmpmonth on rmpmonth.mainlinerefrecid = rml.recid \n  and rmpmonth.period = 5637144578 \n  and rmpmonth.dataareaid = 'brg' \n  and rmpmonth.partition = 5637144576 \n  left join dbo.xap_renmainlineinvoiceinfo rmlii on rmlii.mainlinerefrecid = rml.recid \n  and rmlii.dataareaid = 'brg' \n  and rmlii.partition = 5637144576 \n  left join dbo.xap_renclasstable rct on rct.recid = eqtrade.defaultclass \n  and rct.dataareaid = 'brg' \n  and rct.partition = 5637144576 \n  left join dbo.xap_renrateconfig rrc on rrc.application = rmlii.application \n  and rrc.shift = rmlii.shift \n  and rrc.store = rmlii.store \n  and rrc.classrelation = rct.classid \n  left join dbo.xap_renrateprice rrpday on rrpday.rateconfig = rrc.recid \n  and rrpday.period = 5637146076 \n  and rrpday.dataareaid = 'brg' \n  and rrpday.partition = 5637144576 \n  left join dbo.xap_renrateprice rrpweek on rrpweek.rateconfig = rrc.recid \n  and rrpweek.period = 5637146077 \n  and rrpweek.dataareaid = 'brg' \n  and rrpweek.partition = 5637144576 \n  left join dbo.xap_renrateprice rrpmonth on rrpmonth.rateconfig = rrc.recid \n  and rrpmonth.period = 5637144578 \n  and rrpmonth.dataareaid = 'brg' \n  and rrpmonth.partition = 5637144576 \n  left join dbo.defaultdimensionview ddveq on ddveq.defaultdimension = eq.defaultdimension \n  and ddveq.dimensionattributeid = 5637145333 \n  left join dbo.defaultdimensionview ddvcontract on ddvcontract.defaultdimension = rmt.dimension \n  and ddvcontract.dimensionattributeid = 5637145333 \n  left join dbo.xap_fleetbatchrelation fleet on eq.fleettype = fleet.fleettype \n  and fleet.dataareaid = 'brg' \n  left join dbo.xap_renmainlinedate rmld on rmld.mainlinerefrecid = rml.recid \n  and rmld.dataareaid = 'brg' \n  and rmld.partition = 5637144576 \n  left join dbo.custtable ct on rmt.custaccount = ct.accountnum \n  and ct.dataareaid = 'brg' \n  and ct.partition = 5637144576 \n  left join dbo.custtable ct2 on rmt.invoiceaccount = ct2.accountnum \n  and ct2.dataareaid = 'brg' \n  and ct2.partition = 5637144576 \n  left join dbo.dirpartytable dir on dir.recid = ct.party \n  and dir.partition = 5637144576 \n  left join dbo.dirpartytable dir2 on dir2.recid = ct2.party \n  left join dbo.xap_renmaincontactinfo rmci on rmci.maintablerefrecid = rmt.recid \n  and rmci.dataareaid = 'brg' \n  and rmci.partition = 5637144576 \n  left join dbo.xap_crmsalesperson csp on csp.recid = rmci.salesrep1 \n  and csp.dataareaid = 'brg' \n  and csp.partition = 5637144576 \n  left join dbo.hcmworker wrker on csp.worker = wrker.recid \n  and wrker.partition = 5637144576 \n  left join dbo.dirpartytable spdir on spdir.recid = wrker.person \n  left join dbo.xap_renmainprice rmpactive on rmpactive.mainlinerefrecid = rml.recid \n  and rmpactive.invoicestatus in (0, 2) \n  left join dbo.xap_periodcodetable pctactive on pctactive.recid = rmpactive.period \n  and pctactive.dataareaid = 'brg' \n  and pctactive.partition = 5637144576 \n  left join dbo.xap_rentemplate rt on rt.recid = rmt.rentaltemplate \n  and rt.dataareaid = 'brg' \n  and rt.partition = 5637144576 \n  left join dbo.xap_reninvoicemethod rim on rim.recid = rt.invmethod \n  and rim.dataareaid = 'brg' \n  and rim.partition = 5637144576 \n  left join dbo.[xap_machinetype] model on model.recid = eq.machinetype \n  and model.dataareaid = 'brg' \n  and model.partition = 5637144576 \n  left join dbo.[xap_machinemanufacturer] make on make.recid = model.[machinemanufacturer] \n  and make.dataareaid = 'brg' \n  and make.partition = 5637144576 \n  left join dbo.xap_renbestratecalculator rbrc on rbrc.line = rml.recid \n  and rbrc.dataareaid = 'brg' \n  and rbrc.partition = 5637144576 \n  left join #ttable2 tt on tt.inventequipmentid = eq.equipmentid and tt.rentalid = rmt.rentalid\n  left join briggsAX.dbo.[ref_linestatus] ls on ls.linestatusid = rml.linestatus \n  left join briggsAX.dbo.ref_contractstatus cs on cs.contractstatusid = rmt.contractstatus \nwhere \n  rml.dataareaid = 'brg' \n  and rml.partition = 5637144576 --and rmt.inventlocation in (@branch)\n  and rmt.contractstatus in (0, 1, 9) \n  and rml.linestatus = 0 \n  and reneq.[status] = 0 \n  and eq.fleettype = 8 --and rmt.rentalid= 'str000189'",
								"queryTimeout": "02:00:00",
								"partitionOption": "None"
							},
							"sink": {
								"type": "AzureSqlSink",
								"preCopyScript": "Truncate table Briggs.Stage_Re_Rent_PO_Tracking_Active",
								"writeBehavior": "insert",
								"sqlWriterUseTableLock": false,
								"disableMetricsCollection": false
							},
							"enableStaging": false,
							"translator": {
								"type": "TabularTranslator",
								"typeConversion": true,
								"typeConversionSettings": {
									"allowDataTruncation": true,
									"treatBooleanAsNumber": false
								}
							}
						},
						"inputs": [
							{
								"referenceName": "Briggs_MST",
								"type": "DatasetReference",
								"parameters": {}
							}
						],
						"outputs": [
							{
								"referenceName": "Briggs_MDW",
								"type": "DatasetReference",
								"parameters": {
									"schema_name": "Briggs",
									"table_name": "Stage_Re_Rent_PO_Tracking_Active"
								}
							}
						]
					},
					{
						"name": "Sp_ExecFailureAudit_Fact",
						"type": "SqlServerStoredProcedure",
						"dependsOn": [
							{
								"activity": "ForEach_Fact",
								"dependencyConditions": [
									"Failed"
								]
							}
						],
						"policy": {
							"timeout": "7.00:00:00",
							"retry": 0,
							"retryIntervalInSeconds": 30,
							"secureOutput": false,
							"secureInput": false
						},
						"userProperties": [],
						"typeProperties": {
							"storedProcedureName": "[dbo].[proc_UpdateAuditLog]",
							"storedProcedureParameters": {
								"AuditID": {
									"value": {
										"value": "@activity('lkp_ExecStartAuditProc').output.firstRow.AuditID",
										"type": "Expression"
									},
									"type": "Int32"
								},
								"DataLakePath": {
									"value": null,
									"type": "String"
								},
								"PipelineRunID": {
									"value": {
										"value": "@pipeline().RunId",
										"type": "Expression"
									},
									"type": "String"
								},
								"RowsRead": {
									"value": null,
									"type": "Int64"
								},
								"Status": {
									"value": "Fact Proc Failed",
									"type": "String"
								}
							}
						},
						"linkedServiceName": {
							"referenceName": "AzureSqlDatabase1",
							"type": "LinkedServiceReference"
						}
					},
					{
						"name": "Sp_ExecSuccessAudit",
						"type": "SqlServerStoredProcedure",
						"dependsOn": [
							{
								"activity": "ForEach_Fact",
								"dependencyConditions": [
									"Succeeded"
								]
							}
						],
						"policy": {
							"timeout": "7.00:00:00",
							"retry": 0,
							"retryIntervalInSeconds": 30,
							"secureOutput": false,
							"secureInput": false
						},
						"userProperties": [],
						"typeProperties": {
							"storedProcedureName": "[dbo].[proc_UpdateAuditLog]",
							"storedProcedureParameters": {
								"AuditID": {
									"value": {
										"value": "@activity('lkp_ExecStartAuditProc').output.firstRow.AuditID",
										"type": "Expression"
									},
									"type": "Int32"
								},
								"DataLakePath": {
									"value": null,
									"type": "String"
								},
								"RowsRead": {
									"value": null,
									"type": "Int64"
								},
								"Status": {
									"value": "Success",
									"type": "String"
								},
								"PipelineRunID": {
									"value": {
										"value": "@pipeline().RunId",
										"type": "Expression"
									},
									"type": "String"
								}
							}
						},
						"linkedServiceName": {
							"referenceName": "AzureSqlDatabase1",
							"type": "LinkedServiceReference"
						}
					},
					{
						"name": "lkp_ExecStartAuditProc",
						"type": "Lookup",
						"dependsOn": [],
						"policy": {
							"timeout": "7.00:00:00",
							"retry": 0,
							"retryIntervalInSeconds": 30,
							"secureOutput": false,
							"secureInput": false
						},
						"userProperties": [],
						"typeProperties": {
							"source": {
								"type": "AzureSqlSource",
								"sqlReaderStoredProcedureName": "[dbo].[proc_StartAuditLog]",
								"storedProcedureParameters": {
									"ConfigTableID": {
										"type": "Int32",
										"value": "-1"
									},
									"DataFactoryName": {
										"type": "String",
										"value": {
											"value": "@pipeline().DataFactory",
											"type": "Expression"
										}
									},
									"ParentAuditID": {
										"type": "Int64",
										"value": "-1"
									},
									"PipelineName": {
										"type": "String",
										"value": {
											"value": "@pipeline().Pipeline",
											"type": "Expression"
										}
									},
									"PipelineRunID": {
										"type": "String",
										"value": {
											"value": "@pipeline().RunId",
											"type": "Expression"
										}
									},
									"PipelineTriggerID": {
										"type": "String",
										"value": {
											"value": "@pipeline().TriggerId",
											"type": "Expression"
										}
									},
									"PipelineTriggerName": {
										"type": "String",
										"value": {
											"value": "@pipeline().TriggerName",
											"type": "Expression"
										}
									},
									"PipelineTriggerType": {
										"type": "String",
										"value": {
											"value": "@pipeline().TriggerType",
											"type": "Expression"
										}
									}
								},
								"queryTimeout": "02:00:00",
								"partitionOption": "None"
							},
							"dataset": {
								"referenceName": "Briggs_MDW",
								"type": "DatasetReference",
								"parameters": {
									"schema_name": "dbo",
									"table_name": "user"
								}
							}
						}
					},
					{
						"name": "Sp_ExecFailureAudit_Stage",
						"type": "SqlServerStoredProcedure",
						"dependsOn": [
							{
								"activity": "ForEach_Stage",
								"dependencyConditions": [
									"Failed"
								]
							}
						],
						"policy": {
							"timeout": "7.00:00:00",
							"retry": 0,
							"retryIntervalInSeconds": 30,
							"secureOutput": false,
							"secureInput": false
						},
						"userProperties": [],
						"typeProperties": {
							"storedProcedureName": "[dbo].[proc_UpdateAuditLog]",
							"storedProcedureParameters": {
								"AuditID": {
									"value": {
										"value": "@activity('lkp_ExecStartAuditProc').output.firstRow.AuditID",
										"type": "Expression"
									},
									"type": "Int32"
								},
								"DataLakePath": {
									"value": null,
									"type": "String"
								},
								"PipelineRunID": {
									"value": {
										"value": "@pipeline().RunId",
										"type": "Expression"
									},
									"type": "String"
								},
								"RowsRead": {
									"value": null,
									"type": "Int64"
								},
								"Status": {
									"value": "Stage Proc Failed",
									"type": "String"
								}
							}
						},
						"linkedServiceName": {
							"referenceName": "AzureSqlDatabase1",
							"type": "LinkedServiceReference"
						}
					},
					{
						"name": "Sp_ExecFailureAudit_TL",
						"type": "SqlServerStoredProcedure",
						"dependsOn": [
							{
								"activity": "Execute Pipeline1",
								"dependencyConditions": [
									"Failed"
								]
							}
						],
						"policy": {
							"timeout": "7.00:00:00",
							"retry": 0,
							"retryIntervalInSeconds": 30,
							"secureOutput": false,
							"secureInput": false
						},
						"userProperties": [],
						"typeProperties": {
							"storedProcedureName": "[dbo].[proc_UpdateAuditLog]",
							"storedProcedureParameters": {
								"AuditID": {
									"value": {
										"value": "@activity('lkp_ExecStartAuditProc').output.firstRow.AuditID",
										"type": "Expression"
									},
									"type": "Int32"
								},
								"DataLakePath": {
									"value": null,
									"type": "String"
								},
								"PipelineRunID": {
									"value": {
										"value": "@pipeline().RunId",
										"type": "Expression"
									},
									"type": "String"
								},
								"RowsRead": {
									"value": null,
									"type": "Int64"
								},
								"Status": {
									"value": "Table Load Failed",
									"type": "String"
								}
							}
						},
						"linkedServiceName": {
							"referenceName": "AzureSqlDatabase1",
							"type": "LinkedServiceReference"
						}
					}
				],
				"policy": {
					"elapsedTimeMetric": {},
					"cancelAfter": {}
				},
				"variables": {
					"ErrorMsg": {
						"type": "String"
					}
				},
				"folder": {
					"name": "Briggs Data Load Theme wise"
				},
				"annotations": [],
				"lastPublishTime": "2022-05-02T13:11:04Z"
			},
			"dependsOn": [
				"[concat(variables('workspaceId'), '/pipelines/PL_Generic_Copy_Rental')]",
				"[concat(variables('workspaceId'), '/datasets/Briggs_MDW')]",
				"[concat(variables('workspaceId'), '/datasets/Briggs_MST')]",
				"[concat(variables('workspaceId'), '/linkedServices/AzureSqlDatabase1')]",
				"[concat(variables('workspaceId'), '/linkedServices/DS_MDW_SP')]"
			]
		},
		{
			"name": "[concat(parameters('workspaceName'), '/PL_Master_Briggs_Service')]",
			"type": "Microsoft.Synapse/workspaces/pipelines",
			"apiVersion": "2019-06-01-preview",
			"properties": {
				"activities": [
					{
						"name": "Execute Pipeline1",
						"type": "ExecutePipeline",
						"dependsOn": [
							{
								"activity": "lkp_ExecStartAuditProc",
								"dependencyConditions": [
									"Succeeded"
								]
							}
						],
						"userProperties": [],
						"typeProperties": {
							"pipeline": {
								"referenceName": "PL_Generic_Copy_Service",
								"type": "PipelineReference"
							},
							"waitOnCompletion": true,
							"parameters": {}
						}
					},
					{
						"name": "ReportStageProc",
						"type": "Lookup",
						"dependsOn": [
							{
								"activity": "Execute Pipeline1",
								"dependencyConditions": [
									"Succeeded"
								]
							}
						],
						"policy": {
							"timeout": "7.00:00:00",
							"retry": 0,
							"retryIntervalInSeconds": 30,
							"secureOutput": false,
							"secureInput": false
						},
						"userProperties": [],
						"typeProperties": {
							"source": {
								"type": "AzureSqlSource",
								"sqlReaderQuery": "select  * from dbo.control_table where processsequence = 2 and enableaction = 1 \nand subjectarea='Report Stage Service SP'\norder by id",
								"queryTimeout": "02:00:00",
								"partitionOption": "None"
							},
							"dataset": {
								"referenceName": "Briggs_MDW",
								"type": "DatasetReference",
								"parameters": {
									"schema_name": "dbo",
									"table_name": "user"
								}
							},
							"firstRowOnly": false
						}
					},
					{
						"name": "ForEach_Stage",
						"type": "ForEach",
						"dependsOn": [
							{
								"activity": "ReportStageProc",
								"dependencyConditions": [
									"Succeeded"
								]
							}
						],
						"userProperties": [],
						"typeProperties": {
							"items": {
								"value": "@activity('ReportStageProc').output.value",
								"type": "Expression"
							},
							"activities": [
								{
									"name": "Stored procedure1",
									"type": "SqlServerStoredProcedure",
									"dependsOn": [
										{
											"activity": "Start_Table_Audit_Stage",
											"dependencyConditions": [
												"Succeeded"
											]
										}
									],
									"policy": {
										"timeout": "7.00:00:00",
										"retry": 0,
										"retryIntervalInSeconds": 30,
										"secureOutput": false,
										"secureInput": false
									},
									"userProperties": [],
									"typeProperties": {
										"storedProcedureName": {
											"value": "@item().sourcetablename",
											"type": "Expression"
										}
									},
									"linkedServiceName": {
										"referenceName": "DS_MDW_SP",
										"type": "LinkedServiceReference"
									}
								},
								{
									"name": "Start_Table_Audit_Stage",
									"type": "Lookup",
									"dependsOn": [],
									"policy": {
										"timeout": "7.00:00:00",
										"retry": 0,
										"retryIntervalInSeconds": 30,
										"secureOutput": false,
										"secureInput": false
									},
									"userProperties": [],
									"typeProperties": {
										"source": {
											"type": "AzureSqlSource",
											"sqlReaderStoredProcedureName": "[dbo].[proc_StartAuditLog_Briggs]",
											"storedProcedureParameters": {
												"ConfigTableID": {
													"type": "Int32",
													"value": {
														"value": "@item().ID",
														"type": "Expression"
													}
												},
												"DataFactoryName": {
													"type": "String",
													"value": {
														"value": "@pipeline().DataFactory",
														"type": "Expression"
													}
												},
												"ParentAuditID": {
													"type": "Int64",
													"value": {
														"value": "@item().ID",
														"type": "Expression"
													}
												},
												"PipelineName": {
													"type": "String",
													"value": {
														"value": "@pipeline().Pipeline",
														"type": "Expression"
													}
												},
												"PipelineRunID": {
													"type": "String",
													"value": {
														"value": "@pipeline().RunId",
														"type": "Expression"
													}
												},
												"PipelineTriggerID": {
													"type": "String",
													"value": {
														"value": "@pipeline().TriggerId",
														"type": "Expression"
													}
												},
												"PipelineTriggerName": {
													"type": "String",
													"value": {
														"value": "@pipeline().TriggerName",
														"type": "Expression"
													}
												},
												"PipelineTriggerType": {
													"type": "String",
													"value": {
														"value": "@pipeline().TriggerType",
														"type": "Expression"
													}
												},
												"Sourcedb": {
													"type": "String",
													"value": {
														"value": "@item().sourceDB",
														"type": "Expression"
													}
												},
												"sourcetable": {
													"type": "String",
													"value": {
														"value": "@item().SourcetableName",
														"type": "Expression"
													}
												}
											},
											"queryTimeout": "02:00:00",
											"partitionOption": "None"
										},
										"dataset": {
											"referenceName": "Briggs_MDW",
											"type": "DatasetReference",
											"parameters": {
												"schema_name": "dbo",
												"table_name": "user"
											}
										},
										"firstRowOnly": false
									}
								},
								{
									"name": "Set variable_Stage",
									"type": "SetVariable",
									"dependsOn": [
										{
											"activity": "Stored procedure1",
											"dependencyConditions": [
												"Failed"
											]
										}
									],
									"userProperties": [],
									"typeProperties": {
										"variableName": "ErrorMsg",
										"value": {
											"value": "@activity('Stored procedure1').Error.Message",
											"type": "Expression"
										}
									}
								},
								{
									"name": "Failure_Audit_Log_Stage",
									"type": "SqlServerStoredProcedure",
									"dependsOn": [
										{
											"activity": "Set variable_Stage",
											"dependencyConditions": [
												"Succeeded"
											]
										}
									],
									"policy": {
										"timeout": "7.00:00:00",
										"retry": 0,
										"retryIntervalInSeconds": 30,
										"secureOutput": false,
										"secureInput": false
									},
									"userProperties": [],
									"typeProperties": {
										"storedProcedureName": "[dbo].[proc_UpdateAuditLog_Briggs]",
										"storedProcedureParameters": {
											"ConfigTableID": {
												"value": {
													"value": "@item().ID",
													"type": "Expression"
												},
												"type": "Int32"
											},
											"RowsRead": {
												"value": null,
												"type": "Int64"
											},
											"Status": {
												"value": {
													"value": "@variables('ErrorMsg')",
													"type": "Expression"
												},
												"type": "String"
											}
										}
									},
									"linkedServiceName": {
										"referenceName": "DS_MDW_SP",
										"type": "LinkedServiceReference"
									}
								},
								{
									"name": "Success_Audit_Log_Stage",
									"type": "SqlServerStoredProcedure",
									"dependsOn": [
										{
											"activity": "Stored procedure1",
											"dependencyConditions": [
												"Succeeded"
											]
										}
									],
									"policy": {
										"timeout": "7.00:00:00",
										"retry": 0,
										"retryIntervalInSeconds": 30,
										"secureOutput": false,
										"secureInput": false
									},
									"userProperties": [],
									"typeProperties": {
										"storedProcedureName": "[dbo].[proc_UpdateAuditLog_Briggs]",
										"storedProcedureParameters": {
											"ConfigTableID": {
												"value": {
													"value": "@item().ID",
													"type": "Expression"
												},
												"type": "Int32"
											},
											"RowsRead": {
												"value": null,
												"type": "Int64"
											},
											"Status": {
												"value": "Success",
												"type": "String"
											}
										}
									},
									"linkedServiceName": {
										"referenceName": "DS_MDW_SP",
										"type": "LinkedServiceReference"
									}
								}
							]
						}
					},
					{
						"name": "ReportFactProc",
						"type": "Lookup",
						"dependsOn": [
							{
								"activity": "ForEach_Stage",
								"dependencyConditions": [
									"Succeeded"
								]
							}
						],
						"policy": {
							"timeout": "7.00:00:00",
							"retry": 0,
							"retryIntervalInSeconds": 30,
							"secureOutput": false,
							"secureInput": false
						},
						"userProperties": [],
						"typeProperties": {
							"source": {
								"type": "AzureSqlSource",
								"sqlReaderQuery": "select  * from dbo.control_table where processsequence = 4 and enableaction = 1 \nand subjectarea='Report Fact Service SP'\norder by id",
								"queryTimeout": "02:00:00",
								"partitionOption": "None"
							},
							"dataset": {
								"referenceName": "Briggs_MDW",
								"type": "DatasetReference",
								"parameters": {
									"schema_name": "dbo",
									"table_name": "user"
								}
							},
							"firstRowOnly": false
						}
					},
					{
						"name": "ForEach_Fact",
						"type": "ForEach",
						"dependsOn": [
							{
								"activity": "ReportFactProc",
								"dependencyConditions": [
									"Succeeded"
								]
							},
							{
								"activity": "Stage_Service_History_By_Make",
								"dependencyConditions": [
									"Succeeded"
								]
							}
						],
						"userProperties": [],
						"typeProperties": {
							"items": {
								"value": "@activity('ReportFactProc').output.value",
								"type": "Expression"
							},
							"activities": [
								{
									"name": "Stored procedure",
									"type": "SqlServerStoredProcedure",
									"dependsOn": [
										{
											"activity": "Start_Table_Audit1_Fact",
											"dependencyConditions": [
												"Succeeded"
											]
										}
									],
									"policy": {
										"timeout": "7.00:00:00",
										"retry": 0,
										"retryIntervalInSeconds": 30,
										"secureOutput": false,
										"secureInput": false
									},
									"userProperties": [],
									"typeProperties": {
										"storedProcedureName": {
											"value": "@item().sourcetablename",
											"type": "Expression"
										}
									},
									"linkedServiceName": {
										"referenceName": "DS_MDW_SP",
										"type": "LinkedServiceReference"
									}
								},
								{
									"name": "Start_Table_Audit1_Fact",
									"type": "Lookup",
									"dependsOn": [],
									"policy": {
										"timeout": "7.00:00:00",
										"retry": 0,
										"retryIntervalInSeconds": 30,
										"secureOutput": false,
										"secureInput": false
									},
									"userProperties": [],
									"typeProperties": {
										"source": {
											"type": "AzureSqlSource",
											"sqlReaderStoredProcedureName": "[dbo].[proc_StartAuditLog_Briggs]",
											"storedProcedureParameters": {
												"ConfigTableID": {
													"type": "Int32",
													"value": {
														"value": "@item().ID",
														"type": "Expression"
													}
												},
												"DataFactoryName": {
													"type": "String",
													"value": {
														"value": "@pipeline().DataFactory",
														"type": "Expression"
													}
												},
												"ParentAuditID": {
													"type": "Int64",
													"value": {
														"value": "@item().ID",
														"type": "Expression"
													}
												},
												"PipelineName": {
													"type": "String",
													"value": {
														"value": "@pipeline().Pipeline",
														"type": "Expression"
													}
												},
												"PipelineRunID": {
													"type": "String",
													"value": {
														"value": "@pipeline().RunId",
														"type": "Expression"
													}
												},
												"PipelineTriggerID": {
													"type": "String",
													"value": {
														"value": "@pipeline().TriggerId",
														"type": "Expression"
													}
												},
												"PipelineTriggerName": {
													"type": "String",
													"value": {
														"value": "@pipeline().TriggerName",
														"type": "Expression"
													}
												},
												"PipelineTriggerType": {
													"type": "String",
													"value": {
														"value": "@pipeline().TriggerType",
														"type": "Expression"
													}
												},
												"Sourcedb": {
													"type": "String",
													"value": {
														"value": "@item().sourceDB",
														"type": "Expression"
													}
												},
												"sourcetable": {
													"type": "String",
													"value": {
														"value": "@item().SourcetableName",
														"type": "Expression"
													}
												}
											},
											"queryTimeout": "02:00:00",
											"partitionOption": "None"
										},
										"dataset": {
											"referenceName": "Briggs_MDW",
											"type": "DatasetReference",
											"parameters": {
												"schema_name": "dbo",
												"table_name": "user"
											}
										},
										"firstRowOnly": false
									}
								},
								{
									"name": "Set variable1_Fact",
									"type": "SetVariable",
									"dependsOn": [
										{
											"activity": "Stored procedure",
											"dependencyConditions": [
												"Failed"
											]
										}
									],
									"userProperties": [],
									"typeProperties": {
										"variableName": "ErrorMsg",
										"value": {
											"value": "@activity('ReportStageProc').Error.Message",
											"type": "Expression"
										}
									}
								},
								{
									"name": "Failure_Audit_Log_Fact",
									"type": "SqlServerStoredProcedure",
									"dependsOn": [
										{
											"activity": "Set variable1_Fact",
											"dependencyConditions": [
												"Succeeded"
											]
										}
									],
									"policy": {
										"timeout": "7.00:00:00",
										"retry": 0,
										"retryIntervalInSeconds": 30,
										"secureOutput": false,
										"secureInput": false
									},
									"userProperties": [],
									"typeProperties": {
										"storedProcedureName": "[dbo].[proc_UpdateAuditLog_Briggs]",
										"storedProcedureParameters": {
											"ConfigTableID": {
												"value": {
													"value": "@item().ID",
													"type": "Expression"
												},
												"type": "Int32"
											},
											"RowsRead": {
												"value": null,
												"type": "Int64"
											},
											"Status": {
												"value": {
													"value": "@variables('ErrorMsg')",
													"type": "Expression"
												},
												"type": "String"
											}
										}
									},
									"linkedServiceName": {
										"referenceName": "DS_MDW_SP",
										"type": "LinkedServiceReference"
									}
								},
								{
									"name": "Success_Audit_Log2_Fact",
									"type": "SqlServerStoredProcedure",
									"dependsOn": [
										{
											"activity": "Stored procedure",
											"dependencyConditions": [
												"Succeeded"
											]
										}
									],
									"policy": {
										"timeout": "7.00:00:00",
										"retry": 0,
										"retryIntervalInSeconds": 30,
										"secureOutput": false,
										"secureInput": false
									},
									"userProperties": [],
									"typeProperties": {
										"storedProcedureName": "[dbo].[proc_UpdateAuditLog_Briggs]",
										"storedProcedureParameters": {
											"ConfigTableID": {
												"value": {
													"value": "@item().ID",
													"type": "Expression"
												},
												"type": "Int32"
											},
											"RowsRead": {
												"value": null,
												"type": "Int64"
											},
											"Status": {
												"value": "Success",
												"type": "String"
											}
										}
									},
									"linkedServiceName": {
										"referenceName": "DS_MDW_SP",
										"type": "LinkedServiceReference"
									}
								}
							]
						}
					},
					{
						"name": "Stage_Service_History_By_Make",
						"type": "Copy",
						"dependsOn": [],
						"policy": {
							"timeout": "7.00:00:00",
							"retry": 0,
							"retryIntervalInSeconds": 30,
							"secureOutput": false,
							"secureInput": false
						},
						"userProperties": [],
						"typeProperties": {
							"source": {
								"type": "SqlServerSource",
								"sqlReaderQuery": "declare @hours as table(\n\n\t\tinvoiceid nvarchar(25)\n\t\t,qty int\n)\n\ninsert into @hours\n\nselect \npij.projinvoiceid\n,sum(emp.qty) 'qty'\nfrom  PROJINVOICEJOUR pij \ninner join projinvoiceempl emp on emp.projinvoiceid = pij.projinvoiceid\nwhere year(pij.INVOICEDATE)>='2020'-- between '2020-01-01' and '2022-02-01' --@startdate and @enddate\ngroup by pij.projinvoiceid;\n\n;with labor_cte(projid,money,date)\nas(\n\tselect PROJID,sum(LINEAMOUNT),max(PROJINVOICEEMPL.TRANSDATE)\n\tfrom PROJINVOICEEMPL\n\tgroup by PROJID\n),parts_cte(projid,money)\nas(\n\t\tselect svcCAll.PROJID,sum(pit.LINEAMOUNT) from PROJINVOICEITEM pit\n\tinner join XAP_SVCSEGMENTTABLE svcSeg on svcSeg.PROJID = pit.PROJID\n\tinner join XAP_SVCCALLTABLE svcCall on svcCall.RECID = svcSeg.SVCCALLID\n\tinner join ECORESPRODUCT eco on eco.displayproductnumber = pit.itemid\n\tinner join XAP_NPRITEM npr on eco.RECID = npr.PRODUCT and npr.ITEMDATAAREAID = 'BRG'\n\twhere (SOSRECID <> 0 or pit.ITEMID like '%sublet%')\n\tgroup by  svcCAll.PROJID\n),gm_cte(recid,equipmentid)\nas(\n\tselect max(svcT.RECID),svcL.EQUIPMENTID\n\tfrom XAP_SVCCONTRACTLINE svcL \n\tinner join XAP_SVCCONTRACTTABLE svcT on svcL.CONTRACTID = svcT.RECID\n\twhere svcL.EQUIPMENTID is not null \n\tand svcL.EQUIPMENTID <> 0\n\tand svcL.CONTRACTSTATUS = 1\n\tand svcT.CALLTYPEID = 5637144582\n\tgroup by svcL.EQUIPMENTID\n\n),smu_cte(recid,svcid)\nas(\nselect max(recid),DOCUMENTREFERENCE\n from  XAP_EQUIPMENTUSAGEHISTORY a \n where a.SOURCE = 3\n group by DOCUMENTREFERENCE\n\n),lastlabor_cte(projid,money,date)\nas(\n\tselect svcCAll.PROJID\n\t,sum(QTY* SALESPRICE) 'amount'\n\t,max(pjt.TRANSDATE)'date'\n\tfrom ProjJournalTrans pjt\n\tinner join XAP_SVCSEGMENTTABLE svcSeg on svcSeg.PROJID = pjt.PROJID\n\tinner join XAP_SVCCALLTABLE svcCall on svcCall.RECID = svcSeg.SVCCALLID\n\tgroup by svcCAll.PROJID\n)\n\n\n\nselect distinct\t\n\t\tsvc.inventlocationid\n\t\t,pij.invoiceaccount 'bill_to_number'\n\t\t,dirbt.name 'bill_to_name'\n\t\t,invcust.custgroup\n\t\t,svc.custaccount\n\t\t,svc.custname\n--\t\t,svctype.callstatusid, \n        ,svctypetable.calltypeid\n\t\t,pij.projinvoiceid\n\t\t,pij.invoicedate\n\t\t,eq.equipmentid\n\t\t,eq.inventserialid\n\t\t,make.manufacturerid\n\t\t,model.typeid\n\t\t,cast(isnull(labor_cte.money,0.00)as decimal(10,2)) 'labor'\n\t\t,cast(isnull(parts_cte.money,0.00) as decimal(10,2)) 'parts'\n\t\t,cast(pij.INVOICEAMOUNT-((isnull(labor_cte.money,0.00) + isnull(parts_cte.money,0.00) + (pij.SUMTAX))) as decimal(10,2)) 'misc'\n\t\t,cast(pij.SUMTAX as decimal(10,2)) 'tax'\n\t\t,cast(pij.INVOICEAMOUNT as decimal(10,2)) 'invoiceamount'\n\t\t,cast(replace(replace(substring(svc.SUBJECT + ' ' + svcComment.INCIDENT,1,40),char(10),''),char(13),'')as nvarchar(4000))   'comment_preview'\n\t\t,cast(replace(replace(svc.SUBJECT + ' ' + svcComment.INCIDENT,char(10),''),char(13),'') as nvarchar(4000)) 'comments'\n\t\t,case \n\t\t\twhen invCust.CUSTGROUP like 'REV%' then 0\n\t\t\twhen invCust.CUSTGROUP = 'WARRANTY' then 1\n\t\t\twhen invCust.CUSTGROUP = 'INTERDEPT' then 2\n\t\t\telse 10\n\t\tend 'sort'\n\t\t,svc.svccallid\n\t\t,smu.meterreading\n\t\t,smu.createddatetime\n\t\t,svc.createddatetime 'svccreatedate'\n\t\t,svc.ponumber\n\t\t,wrker.personnelnumber\n\t\t,labor_cte.date\n\t\t,ddv.displayvalue\n\t\t,ddv.dimensionattributeid\n\t\t,svchours.qty 'hours'\nFROM dbo.XAP_SVCCALLTABLE svc \nLEFT JOIN dbo.XAP_SVCCALLREASONCODES svcReason ON svc.CALLREASONCODE = svcReason.RECID \nLEFT JOIN dbo.XAP_SVCCALLTYPETABLE svcTypeTable ON svc.CALLTYPEID = svcTypeTable.RECID \nLEFT JOIN dbo.XAP_SVCCALLTYPELINE svcType ON svc.CALLSTATUS = svcType.RECID\nleft join parts_cte on parts_cte.projid = svc.SVCCALLID\nleft join xap_equipmenttable eq on eq.recid = svc.equipmentid\nleft join XAP_MACHINEMANUFACTURER make on eq.MACHINEMANUFACTURER = make.RECID\nleft join XAP_MACHINETYPE model on eq.MACHINETYPE= model.RECID\ninner join PROJINVOICEJOUR pij on pij.SVCCALLID = svc.RECID\nleft join CUSTTABLE invCust on invCust.ACCOUNTNUM = pij.INVOICEACCOUNT\nleft join DIRPARTYTABLE dirBT on dirBT.RECID = invCust.PARTY\nleft join XAP_SVCREPORTINGTABLE svcComment on svcComment.RECID = svc.REPORTINGTABLEREFERENCE\nleft join XAP_SVCSEGMENTTABLE svcSeg on svcSeg.SVCCALLID = svc.RECID\nLEFT join labor_cte on labor_cte.projid = svcSeg.PROJID\nleft join smu_cte on smu_cte.svcid = svc.RECID\nleft join XAP_EQUIPMENTUSAGEHISTORY smu on smu.SOURCE =3 and smu.RECID = smu_cte.recid\nleft join HCMWORKER wrker on wrker.recid = svc.WORKERID\nleft join DEFAULTDIMENSIONVIEW ddv on ddv.DEFAULTDIMENSION = pij.DEFAULTDIMENSION and ddv.DIMENSIONATTRIBUTEID = 5637145333\nleft join @hours svchours on svchours.invoiceid = pij.projinvoiceid\nWHERE        \nyear(pij.INVOICEDATE)>='2020'--- between '2020-01-01' and '2022-02-01' --@startdate and @enddate\n--and  ddv.DISPLAYVALUE in (@branch)\n--and make.MANUFACTURERID in (@make)\n--and invCust.CUSTGROUP in (@custgroup)",
								"queryTimeout": "02:00:00",
								"partitionOption": "None"
							},
							"sink": {
								"type": "AzureSqlSink",
								"preCopyScript": "truncate table briggs.Stage_Service_History_By_Make",
								"disableMetricsCollection": false
							},
							"enableStaging": false,
							"translator": {
								"type": "TabularTranslator",
								"mappings": [
									{
										"source": {
											"name": "inventlocationid",
											"type": "String",
											"physicalType": "nvarchar"
										},
										"sink": {
											"name": "INVENTLOCATIONID",
											"type": "String",
											"physicalType": "varchar"
										}
									},
									{
										"source": {
											"name": "bill_to_number",
											"type": "String",
											"physicalType": "nvarchar"
										},
										"sink": {
											"name": "Bill_To_Number",
											"type": "String",
											"physicalType": "varchar"
										}
									},
									{
										"source": {
											"name": "bill_to_name",
											"type": "String",
											"physicalType": "nvarchar"
										},
										"sink": {
											"name": "Bill_To_Name",
											"type": "String",
											"physicalType": "varchar"
										}
									},
									{
										"source": {
											"name": "custgroup",
											"type": "String",
											"physicalType": "nvarchar"
										},
										"sink": {
											"name": "CUSTGROUP",
											"type": "String",
											"physicalType": "varchar"
										}
									},
									{
										"source": {
											"name": "custaccount",
											"type": "String",
											"physicalType": "nvarchar"
										},
										"sink": {
											"name": "CUSTACCOUNT",
											"type": "String",
											"physicalType": "varchar"
										}
									},
									{
										"source": {
											"name": "custname",
											"type": "String",
											"physicalType": "nvarchar"
										},
										"sink": {
											"name": "CUSTNAME",
											"type": "String",
											"physicalType": "varchar"
										}
									},
									{
										"source": {
											"name": "calltypeid",
											"type": "String",
											"physicalType": "nvarchar"
										},
										"sink": {
											"name": "CALLTYPEID",
											"type": "String",
											"physicalType": "varchar"
										}
									},
									{
										"source": {
											"name": "projinvoiceid",
											"type": "String",
											"physicalType": "nvarchar"
										},
										"sink": {
											"name": "PROJINVOICEID",
											"type": "String",
											"physicalType": "varchar"
										}
									},
									{
										"source": {
											"name": "invoicedate",
											"type": "DateTime",
											"physicalType": "datetime"
										},
										"sink": {
											"name": "INVOICEDATE",
											"type": "DateTime",
											"physicalType": "datetime2"
										}
									},
									{
										"source": {
											"name": "equipmentid",
											"type": "String",
											"physicalType": "nvarchar"
										},
										"sink": {
											"name": "equipmentid",
											"type": "String",
											"physicalType": "varchar"
										}
									},
									{
										"source": {
											"name": "inventserialid",
											"type": "String",
											"physicalType": "nvarchar"
										},
										"sink": {
											"name": "INVENTSERIALID",
											"type": "String",
											"physicalType": "varchar"
										}
									},
									{
										"source": {
											"name": "manufacturerid",
											"type": "String",
											"physicalType": "nvarchar"
										},
										"sink": {
											"name": "MANUFACTURERID",
											"type": "String",
											"physicalType": "varchar"
										}
									},
									{
										"source": {
											"name": "typeid",
											"type": "String",
											"physicalType": "nvarchar"
										},
										"sink": {
											"name": "TYPEID",
											"type": "String",
											"physicalType": "varchar"
										}
									},
									{
										"source": {
											"name": "labor",
											"type": "Decimal",
											"physicalType": "decimal",
											"scale": 2,
											"precision": 10
										},
										"sink": {
											"name": "Labor",
											"type": "Decimal",
											"physicalType": "decimal",
											"scale": 2,
											"precision": 10
										}
									},
									{
										"source": {
											"name": "parts",
											"type": "Decimal",
											"physicalType": "decimal",
											"scale": 2,
											"precision": 10
										},
										"sink": {
											"name": "Parts",
											"type": "Decimal",
											"physicalType": "decimal",
											"scale": 2,
											"precision": 10
										}
									},
									{
										"source": {
											"name": "misc",
											"type": "Decimal",
											"physicalType": "decimal",
											"scale": 2,
											"precision": 10
										},
										"sink": {
											"name": "Misc",
											"type": "Decimal",
											"physicalType": "decimal",
											"scale": 2,
											"precision": 10
										}
									},
									{
										"source": {
											"name": "tax",
											"type": "Decimal",
											"physicalType": "decimal",
											"scale": 2,
											"precision": 10
										},
										"sink": {
											"name": "Tax",
											"type": "Decimal",
											"physicalType": "decimal",
											"scale": 2,
											"precision": 10
										}
									},
									{
										"source": {
											"name": "invoiceamount",
											"type": "Decimal",
											"physicalType": "decimal",
											"scale": 2,
											"precision": 10
										},
										"sink": {
											"name": "INVOICEAMOUNT",
											"type": "Decimal",
											"physicalType": "decimal",
											"scale": 2,
											"precision": 10
										}
									},
									{
										"source": {
											"name": "comment_preview",
											"type": "String",
											"physicalType": "nvarchar"
										},
										"sink": {
											"name": "Comment_Preview",
											"type": "String",
											"physicalType": "varchar"
										}
									},
									{
										"source": {
											"name": "comments",
											"type": "String",
											"physicalType": "nvarchar"
										},
										"sink": {
											"name": "Comments",
											"type": "String",
											"physicalType": "varchar"
										}
									},
									{
										"source": {
											"name": "sort",
											"type": "Int32",
											"physicalType": "int"
										},
										"sink": {
											"name": "sort",
											"type": "Int32",
											"physicalType": "int"
										}
									},
									{
										"source": {
											"name": "svccallid",
											"type": "String",
											"physicalType": "nvarchar"
										},
										"sink": {
											"name": "SVCCALLID",
											"type": "String",
											"physicalType": "varchar"
										}
									},
									{
										"source": {
											"name": "meterreading",
											"type": "Decimal",
											"physicalType": "decimal",
											"scale": 16,
											"precision": 32
										},
										"sink": {
											"name": "METERREADING",
											"type": "Decimal",
											"physicalType": "decimal",
											"scale": 16,
											"precision": 32
										}
									},
									{
										"source": {
											"name": "createddatetime",
											"type": "DateTime",
											"physicalType": "datetime"
										},
										"sink": {
											"name": "CREATEDDATETIME",
											"type": "DateTime",
											"physicalType": "datetime2"
										}
									},
									{
										"source": {
											"name": "svccreatedate",
											"type": "DateTime",
											"physicalType": "datetime"
										},
										"sink": {
											"name": "svcCreateDate",
											"type": "DateTime",
											"physicalType": "datetime2"
										}
									},
									{
										"source": {
											"name": "ponumber",
											"type": "String",
											"physicalType": "nvarchar"
										},
										"sink": {
											"name": "PONUMBER",
											"type": "String",
											"physicalType": "varchar"
										}
									},
									{
										"source": {
											"name": "personnelnumber",
											"type": "String",
											"physicalType": "nvarchar"
										},
										"sink": {
											"name": "PERSONNELNUMBER",
											"type": "String",
											"physicalType": "varchar"
										}
									},
									{
										"source": {
											"name": "date",
											"type": "DateTime",
											"physicalType": "datetime"
										},
										"sink": {
											"name": "date",
											"type": "DateTime",
											"physicalType": "datetime2"
										}
									},
									{
										"source": {
											"name": "displayvalue",
											"type": "String",
											"physicalType": "nvarchar"
										},
										"sink": {
											"name": "DISPLAYVALUE",
											"type": "String",
											"physicalType": "varchar"
										}
									},
									{
										"source": {
											"name": "dimensionattributeid",
											"type": "Int64",
											"physicalType": "bigint"
										},
										"sink": {
											"name": "DIMENSIONATTRIBUTEID",
											"type": "Int64",
											"physicalType": "bigint"
										}
									},
									{
										"source": {
											"name": "hours",
											"type": "Int32",
											"physicalType": "int"
										},
										"sink": {
											"name": "Hours",
											"type": "Int32",
											"physicalType": "int"
										}
									}
								],
								"typeConversion": true,
								"typeConversionSettings": {
									"allowDataTruncation": true,
									"treatBooleanAsNumber": false
								}
							}
						},
						"inputs": [
							{
								"referenceName": "Briggs_MST",
								"type": "DatasetReference",
								"parameters": {}
							}
						],
						"outputs": [
							{
								"referenceName": "Briggs_MDW",
								"type": "DatasetReference",
								"parameters": {
									"schema_name": "Briggs",
									"table_name": "Stage_Service_History_By_Make"
								}
							}
						]
					},
					{
						"name": "Sp_ExecFailureAudit_Fact",
						"type": "SqlServerStoredProcedure",
						"dependsOn": [
							{
								"activity": "ForEach_Fact",
								"dependencyConditions": [
									"Failed"
								]
							}
						],
						"policy": {
							"timeout": "7.00:00:00",
							"retry": 0,
							"retryIntervalInSeconds": 30,
							"secureOutput": false,
							"secureInput": false
						},
						"userProperties": [],
						"typeProperties": {
							"storedProcedureName": "[dbo].[proc_UpdateAuditLog]",
							"storedProcedureParameters": {
								"AuditID": {
									"value": {
										"value": "@activity('lkp_ExecStartAuditProc').output.firstRow.AuditID",
										"type": "Expression"
									},
									"type": "Int32"
								},
								"DataLakePath": {
									"value": null,
									"type": "String"
								},
								"PipelineRunID": {
									"value": {
										"value": "@pipeline().RunId",
										"type": "Expression"
									},
									"type": "String"
								},
								"RowsRead": {
									"value": null,
									"type": "Int64"
								},
								"Status": {
									"value": "Fact Proc Failed",
									"type": "String"
								}
							}
						},
						"linkedServiceName": {
							"referenceName": "AzureSqlDatabase1",
							"type": "LinkedServiceReference"
						}
					},
					{
						"name": "Sp_ExecSuccessAudit",
						"type": "SqlServerStoredProcedure",
						"dependsOn": [
							{
								"activity": "ForEach_Fact",
								"dependencyConditions": [
									"Succeeded"
								]
							}
						],
						"policy": {
							"timeout": "7.00:00:00",
							"retry": 0,
							"retryIntervalInSeconds": 30,
							"secureOutput": false,
							"secureInput": false
						},
						"userProperties": [],
						"typeProperties": {
							"storedProcedureName": "[dbo].[proc_UpdateAuditLog]",
							"storedProcedureParameters": {
								"AuditID": {
									"value": {
										"value": "@activity('lkp_ExecStartAuditProc').output.firstRow.AuditID",
										"type": "Expression"
									},
									"type": "Int32"
								},
								"DataLakePath": {
									"value": null,
									"type": "String"
								},
								"RowsRead": {
									"value": null,
									"type": "Int64"
								},
								"Status": {
									"value": "Success",
									"type": "String"
								},
								"PipelineRunID": {
									"value": {
										"value": "@pipeline().RunId",
										"type": "Expression"
									},
									"type": "String"
								}
							}
						},
						"linkedServiceName": {
							"referenceName": "AzureSqlDatabase1",
							"type": "LinkedServiceReference"
						}
					},
					{
						"name": "lkp_ExecStartAuditProc",
						"type": "Lookup",
						"dependsOn": [],
						"policy": {
							"timeout": "7.00:00:00",
							"retry": 0,
							"retryIntervalInSeconds": 30,
							"secureOutput": false,
							"secureInput": false
						},
						"userProperties": [],
						"typeProperties": {
							"source": {
								"type": "AzureSqlSource",
								"sqlReaderStoredProcedureName": "[dbo].[proc_StartAuditLog]",
								"storedProcedureParameters": {
									"ConfigTableID": {
										"type": "Int32",
										"value": "-1"
									},
									"DataFactoryName": {
										"type": "String",
										"value": {
											"value": "@pipeline().DataFactory",
											"type": "Expression"
										}
									},
									"ParentAuditID": {
										"type": "Int64",
										"value": "-1"
									},
									"PipelineName": {
										"type": "String",
										"value": {
											"value": "@pipeline().Pipeline",
											"type": "Expression"
										}
									},
									"PipelineRunID": {
										"type": "String",
										"value": {
											"value": "@pipeline().RunId",
											"type": "Expression"
										}
									},
									"PipelineTriggerID": {
										"type": "String",
										"value": {
											"value": "@pipeline().TriggerId",
											"type": "Expression"
										}
									},
									"PipelineTriggerName": {
										"type": "String",
										"value": {
											"value": "@pipeline().TriggerName",
											"type": "Expression"
										}
									},
									"PipelineTriggerType": {
										"type": "String",
										"value": {
											"value": "@pipeline().TriggerType",
											"type": "Expression"
										}
									}
								},
								"queryTimeout": "02:00:00",
								"partitionOption": "None"
							},
							"dataset": {
								"referenceName": "Briggs_MDW",
								"type": "DatasetReference",
								"parameters": {
									"schema_name": "dbo",
									"table_name": "user"
								}
							}
						}
					},
					{
						"name": "Sp_ExecFailureAudit_Stage",
						"type": "SqlServerStoredProcedure",
						"dependsOn": [
							{
								"activity": "ForEach_Stage",
								"dependencyConditions": [
									"Failed"
								]
							}
						],
						"policy": {
							"timeout": "7.00:00:00",
							"retry": 0,
							"retryIntervalInSeconds": 30,
							"secureOutput": false,
							"secureInput": false
						},
						"userProperties": [],
						"typeProperties": {
							"storedProcedureName": "[dbo].[proc_UpdateAuditLog]",
							"storedProcedureParameters": {
								"AuditID": {
									"value": {
										"value": "@activity('lkp_ExecStartAuditProc').output.firstRow.AuditID",
										"type": "Expression"
									},
									"type": "Int32"
								},
								"DataLakePath": {
									"value": null,
									"type": "String"
								},
								"PipelineRunID": {
									"value": {
										"value": "@pipeline().RunId",
										"type": "Expression"
									},
									"type": "String"
								},
								"RowsRead": {
									"value": null,
									"type": "Int64"
								},
								"Status": {
									"value": "Stage Proc Failed",
									"type": "String"
								}
							}
						},
						"linkedServiceName": {
							"referenceName": "AzureSqlDatabase1",
							"type": "LinkedServiceReference"
						}
					},
					{
						"name": "Sp_ExecFailureAudit_TL",
						"type": "SqlServerStoredProcedure",
						"dependsOn": [
							{
								"activity": "Execute Pipeline1",
								"dependencyConditions": [
									"Failed"
								]
							}
						],
						"policy": {
							"timeout": "7.00:00:00",
							"retry": 0,
							"retryIntervalInSeconds": 30,
							"secureOutput": false,
							"secureInput": false
						},
						"userProperties": [],
						"typeProperties": {
							"storedProcedureName": "[dbo].[proc_UpdateAuditLog]",
							"storedProcedureParameters": {
								"AuditID": {
									"value": {
										"value": "@activity('lkp_ExecStartAuditProc').output.firstRow.AuditID",
										"type": "Expression"
									},
									"type": "Int32"
								},
								"DataLakePath": {
									"value": null,
									"type": "String"
								},
								"PipelineRunID": {
									"value": {
										"value": "@pipeline().RunId",
										"type": "Expression"
									},
									"type": "String"
								},
								"RowsRead": {
									"value": null,
									"type": "Int64"
								},
								"Status": {
									"value": "Table Load Failed",
									"type": "String"
								}
							}
						},
						"linkedServiceName": {
							"referenceName": "AzureSqlDatabase1",
							"type": "LinkedServiceReference"
						}
					}
				],
				"policy": {
					"elapsedTimeMetric": {},
					"cancelAfter": {}
				},
				"variables": {
					"ErrorMsg": {
						"type": "String"
					}
				},
				"folder": {
					"name": "Briggs Data Load Theme wise"
				},
				"annotations": [],
				"lastPublishTime": "2022-04-28T04:31:21Z"
			},
			"dependsOn": [
				"[concat(variables('workspaceId'), '/pipelines/PL_Generic_Copy_Service')]",
				"[concat(variables('workspaceId'), '/datasets/Briggs_MDW')]",
				"[concat(variables('workspaceId'), '/datasets/Briggs_MST')]",
				"[concat(variables('workspaceId'), '/linkedServices/AzureSqlDatabase1')]",
				"[concat(variables('workspaceId'), '/linkedServices/DS_MDW_SP')]"
			]
		},
		{
			"name": "[concat(parameters('workspaceName'), '/PL_Master_Briggs_Statement')]",
			"type": "Microsoft.Synapse/workspaces/pipelines",
			"apiVersion": "2019-06-01-preview",
			"properties": {
				"activities": [
					{
						"name": "Execute Pipeline1",
						"type": "ExecutePipeline",
						"dependsOn": [
							{
								"activity": "lkp_ExecStartAuditProc",
								"dependencyConditions": [
									"Succeeded"
								]
							}
						],
						"userProperties": [],
						"typeProperties": {
							"pipeline": {
								"referenceName": "PL_Generic_Copy_Statement",
								"type": "PipelineReference"
							},
							"waitOnCompletion": true,
							"parameters": {}
						}
					},
					{
						"name": "ReportStageProc",
						"type": "Lookup",
						"dependsOn": [
							{
								"activity": "Execute Pipeline1",
								"dependencyConditions": [
									"Succeeded"
								]
							}
						],
						"policy": {
							"timeout": "7.00:00:00",
							"retry": 0,
							"retryIntervalInSeconds": 30,
							"secureOutput": false,
							"secureInput": false
						},
						"userProperties": [],
						"typeProperties": {
							"source": {
								"type": "AzureSqlSource",
								"sqlReaderQuery": "select  * from dbo.control_table where processsequence = 2 and enableaction = 1 \nand subjectarea='Report Stage Statement SP'\norder by id",
								"queryTimeout": "02:00:00",
								"partitionOption": "None"
							},
							"dataset": {
								"referenceName": "Briggs_MDW",
								"type": "DatasetReference",
								"parameters": {
									"schema_name": "dbo",
									"table_name": "user"
								}
							},
							"firstRowOnly": false
						}
					},
					{
						"name": "ForEach_Stage",
						"type": "ForEach",
						"dependsOn": [
							{
								"activity": "ReportStageProc",
								"dependencyConditions": [
									"Succeeded"
								]
							}
						],
						"userProperties": [],
						"typeProperties": {
							"items": {
								"value": "@activity('ReportStageProc').output.value",
								"type": "Expression"
							},
							"activities": [
								{
									"name": "Stored procedure1",
									"type": "SqlServerStoredProcedure",
									"dependsOn": [
										{
											"activity": "Start_Table_Audit_Stage",
											"dependencyConditions": [
												"Succeeded"
											]
										}
									],
									"policy": {
										"timeout": "7.00:00:00",
										"retry": 0,
										"retryIntervalInSeconds": 30,
										"secureOutput": false,
										"secureInput": false
									},
									"userProperties": [],
									"typeProperties": {
										"storedProcedureName": {
											"value": "@item().sourcetablename",
											"type": "Expression"
										}
									},
									"linkedServiceName": {
										"referenceName": "DS_MDW_SP",
										"type": "LinkedServiceReference"
									}
								},
								{
									"name": "Start_Table_Audit_Stage",
									"type": "Lookup",
									"dependsOn": [],
									"policy": {
										"timeout": "7.00:00:00",
										"retry": 0,
										"retryIntervalInSeconds": 30,
										"secureOutput": false,
										"secureInput": false
									},
									"userProperties": [],
									"typeProperties": {
										"source": {
											"type": "AzureSqlSource",
											"sqlReaderStoredProcedureName": "[dbo].[proc_StartAuditLog_Briggs]",
											"storedProcedureParameters": {
												"ConfigTableID": {
													"type": "Int32",
													"value": {
														"value": "@item().ID",
														"type": "Expression"
													}
												},
												"DataFactoryName": {
													"type": "String",
													"value": {
														"value": "@pipeline().DataFactory",
														"type": "Expression"
													}
												},
												"ParentAuditID": {
													"type": "Int64",
													"value": {
														"value": "@item().ID",
														"type": "Expression"
													}
												},
												"PipelineName": {
													"type": "String",
													"value": {
														"value": "@pipeline().Pipeline",
														"type": "Expression"
													}
												},
												"PipelineRunID": {
													"type": "String",
													"value": {
														"value": "@pipeline().RunId",
														"type": "Expression"
													}
												},
												"PipelineTriggerID": {
													"type": "String",
													"value": {
														"value": "@pipeline().TriggerId",
														"type": "Expression"
													}
												},
												"PipelineTriggerName": {
													"type": "String",
													"value": {
														"value": "@pipeline().TriggerName",
														"type": "Expression"
													}
												},
												"PipelineTriggerType": {
													"type": "String",
													"value": {
														"value": "@pipeline().TriggerType",
														"type": "Expression"
													}
												},
												"Sourcedb": {
													"type": "String",
													"value": {
														"value": "@item().sourceDB",
														"type": "Expression"
													}
												},
												"sourcetable": {
													"type": "String",
													"value": {
														"value": "@item().SourcetableName",
														"type": "Expression"
													}
												}
											},
											"queryTimeout": "02:00:00",
											"partitionOption": "None"
										},
										"dataset": {
											"referenceName": "Briggs_MDW",
											"type": "DatasetReference",
											"parameters": {
												"schema_name": "dbo",
												"table_name": "user"
											}
										},
										"firstRowOnly": false
									}
								},
								{
									"name": "Set variable_Stage",
									"type": "SetVariable",
									"dependsOn": [
										{
											"activity": "Stored procedure1",
											"dependencyConditions": [
												"Failed"
											]
										}
									],
									"userProperties": [],
									"typeProperties": {
										"variableName": "ErrorMsg",
										"value": {
											"value": "@activity('Stored procedure1').Error.Message",
											"type": "Expression"
										}
									}
								},
								{
									"name": "Failure_Audit_Log_Stage",
									"type": "SqlServerStoredProcedure",
									"dependsOn": [
										{
											"activity": "Set variable_Stage",
											"dependencyConditions": [
												"Succeeded"
											]
										}
									],
									"policy": {
										"timeout": "7.00:00:00",
										"retry": 0,
										"retryIntervalInSeconds": 30,
										"secureOutput": false,
										"secureInput": false
									},
									"userProperties": [],
									"typeProperties": {
										"storedProcedureName": "[dbo].[proc_UpdateAuditLog_Briggs]",
										"storedProcedureParameters": {
											"ConfigTableID": {
												"value": {
													"value": "@item().ID",
													"type": "Expression"
												},
												"type": "Int32"
											},
											"RowsRead": {
												"value": null,
												"type": "Int64"
											},
											"Status": {
												"value": {
													"value": "@variables('ErrorMsg')",
													"type": "Expression"
												},
												"type": "String"
											}
										}
									},
									"linkedServiceName": {
										"referenceName": "DS_MDW_SP",
										"type": "LinkedServiceReference"
									}
								},
								{
									"name": "Success_Audit_Log_Stage",
									"type": "SqlServerStoredProcedure",
									"dependsOn": [
										{
											"activity": "Stored procedure1",
											"dependencyConditions": [
												"Succeeded"
											]
										}
									],
									"policy": {
										"timeout": "7.00:00:00",
										"retry": 0,
										"retryIntervalInSeconds": 30,
										"secureOutput": false,
										"secureInput": false
									},
									"userProperties": [],
									"typeProperties": {
										"storedProcedureName": "[dbo].[proc_UpdateAuditLog_Briggs]",
										"storedProcedureParameters": {
											"ConfigTableID": {
												"value": {
													"value": "@item().ID",
													"type": "Expression"
												},
												"type": "Int32"
											},
											"RowsRead": {
												"value": null,
												"type": "Int64"
											},
											"Status": {
												"value": "Success",
												"type": "String"
											}
										}
									},
									"linkedServiceName": {
										"referenceName": "DS_MDW_SP",
										"type": "LinkedServiceReference"
									}
								}
							]
						}
					},
					{
						"name": "ReportFactProc",
						"type": "Lookup",
						"dependsOn": [
							{
								"activity": "ForEach_Stage",
								"dependencyConditions": [
									"Succeeded"
								]
							},
							{
								"activity": "Stage_Transfer_Order",
								"dependencyConditions": [
									"Succeeded"
								]
							}
						],
						"policy": {
							"timeout": "7.00:00:00",
							"retry": 0,
							"retryIntervalInSeconds": 30,
							"secureOutput": false,
							"secureInput": false
						},
						"userProperties": [],
						"typeProperties": {
							"source": {
								"type": "AzureSqlSource",
								"sqlReaderQuery": "select  * from dbo.control_table where processsequence = 4 and enableaction = 1 \nand subjectarea='Report Fact Statement SP'\norder by id",
								"queryTimeout": "02:00:00",
								"partitionOption": "None"
							},
							"dataset": {
								"referenceName": "Briggs_MDW",
								"type": "DatasetReference",
								"parameters": {
									"schema_name": "dbo",
									"table_name": "user"
								}
							},
							"firstRowOnly": false
						}
					},
					{
						"name": "ForEach_Fact",
						"type": "ForEach",
						"dependsOn": [
							{
								"activity": "ReportFactProc",
								"dependencyConditions": [
									"Succeeded"
								]
							}
						],
						"userProperties": [],
						"typeProperties": {
							"items": {
								"value": "@activity('ReportFactProc').output.value",
								"type": "Expression"
							},
							"activities": [
								{
									"name": "Stored procedure",
									"type": "SqlServerStoredProcedure",
									"dependsOn": [
										{
											"activity": "Start_Table_Audit1_Fact",
											"dependencyConditions": [
												"Succeeded"
											]
										}
									],
									"policy": {
										"timeout": "7.00:00:00",
										"retry": 0,
										"retryIntervalInSeconds": 30,
										"secureOutput": false,
										"secureInput": false
									},
									"userProperties": [],
									"typeProperties": {
										"storedProcedureName": {
											"value": "@item().sourcetablename",
											"type": "Expression"
										}
									},
									"linkedServiceName": {
										"referenceName": "DS_MDW_SP",
										"type": "LinkedServiceReference"
									}
								},
								{
									"name": "Start_Table_Audit1_Fact",
									"type": "Lookup",
									"dependsOn": [],
									"policy": {
										"timeout": "7.00:00:00",
										"retry": 0,
										"retryIntervalInSeconds": 30,
										"secureOutput": false,
										"secureInput": false
									},
									"userProperties": [],
									"typeProperties": {
										"source": {
											"type": "AzureSqlSource",
											"sqlReaderStoredProcedureName": "[dbo].[proc_StartAuditLog_Briggs]",
											"storedProcedureParameters": {
												"ConfigTableID": {
													"type": "Int32",
													"value": {
														"value": "@item().ID",
														"type": "Expression"
													}
												},
												"DataFactoryName": {
													"type": "String",
													"value": {
														"value": "@pipeline().DataFactory",
														"type": "Expression"
													}
												},
												"ParentAuditID": {
													"type": "Int64",
													"value": {
														"value": "@item().ID",
														"type": "Expression"
													}
												},
												"PipelineName": {
													"type": "String",
													"value": {
														"value": "@pipeline().Pipeline",
														"type": "Expression"
													}
												},
												"PipelineRunID": {
													"type": "String",
													"value": {
														"value": "@pipeline().RunId",
														"type": "Expression"
													}
												},
												"PipelineTriggerID": {
													"type": "String",
													"value": {
														"value": "@pipeline().TriggerId",
														"type": "Expression"
													}
												},
												"PipelineTriggerName": {
													"type": "String",
													"value": {
														"value": "@pipeline().TriggerName",
														"type": "Expression"
													}
												},
												"PipelineTriggerType": {
													"type": "String",
													"value": {
														"value": "@pipeline().TriggerType",
														"type": "Expression"
													}
												},
												"Sourcedb": {
													"type": "String",
													"value": {
														"value": "@item().sourceDB",
														"type": "Expression"
													}
												},
												"sourcetable": {
													"type": "String",
													"value": {
														"value": "@item().SourcetableName",
														"type": "Expression"
													}
												}
											},
											"queryTimeout": "02:00:00",
											"partitionOption": "None"
										},
										"dataset": {
											"referenceName": "Briggs_MDW",
											"type": "DatasetReference",
											"parameters": {
												"schema_name": "dbo",
												"table_name": "user"
											}
										},
										"firstRowOnly": false
									}
								},
								{
									"name": "Set variable1_Fact",
									"type": "SetVariable",
									"dependsOn": [
										{
											"activity": "Stored procedure",
											"dependencyConditions": [
												"Failed"
											]
										}
									],
									"userProperties": [],
									"typeProperties": {
										"variableName": "ErrorMsg",
										"value": {
											"value": "@activity('ReportStageProc').Error.Message",
											"type": "Expression"
										}
									}
								},
								{
									"name": "Failure_Audit_Log_Fact",
									"type": "SqlServerStoredProcedure",
									"dependsOn": [
										{
											"activity": "Set variable1_Fact",
											"dependencyConditions": [
												"Succeeded"
											]
										}
									],
									"policy": {
										"timeout": "7.00:00:00",
										"retry": 0,
										"retryIntervalInSeconds": 30,
										"secureOutput": false,
										"secureInput": false
									},
									"userProperties": [],
									"typeProperties": {
										"storedProcedureName": "[dbo].[proc_UpdateAuditLog_Briggs]",
										"storedProcedureParameters": {
											"ConfigTableID": {
												"value": {
													"value": "@item().ID",
													"type": "Expression"
												},
												"type": "Int32"
											},
											"RowsRead": {
												"value": null,
												"type": "Int64"
											},
											"Status": {
												"value": {
													"value": "@variables('ErrorMsg')",
													"type": "Expression"
												},
												"type": "String"
											}
										}
									},
									"linkedServiceName": {
										"referenceName": "DS_MDW_SP",
										"type": "LinkedServiceReference"
									}
								},
								{
									"name": "Success_Audit_Log2_Fact",
									"type": "SqlServerStoredProcedure",
									"dependsOn": [
										{
											"activity": "Stored procedure",
											"dependencyConditions": [
												"Succeeded"
											]
										}
									],
									"policy": {
										"timeout": "7.00:00:00",
										"retry": 0,
										"retryIntervalInSeconds": 30,
										"secureOutput": false,
										"secureInput": false
									},
									"userProperties": [],
									"typeProperties": {
										"storedProcedureName": "[dbo].[proc_UpdateAuditLog_Briggs]",
										"storedProcedureParameters": {
											"ConfigTableID": {
												"value": {
													"value": "@item().ID",
													"type": "Expression"
												},
												"type": "Int32"
											},
											"RowsRead": {
												"value": null,
												"type": "Int64"
											},
											"Status": {
												"value": "Success",
												"type": "String"
											}
										}
									},
									"linkedServiceName": {
										"referenceName": "DS_MDW_SP",
										"type": "LinkedServiceReference"
									}
								}
							]
						}
					},
					{
						"name": "Stage_Transfer_Order",
						"type": "Copy",
						"dependsOn": [],
						"policy": {
							"timeout": "7.00:00:00",
							"retry": 0,
							"retryIntervalInSeconds": 30,
							"secureOutput": false,
							"secureInput": false
						},
						"userProperties": [],
						"typeProperties": {
							"source": {
								"type": "SqlServerSource",
								"sqlReaderQuery": "----TRANSFER_ORDER\nselect itt.transferid transfer_id\n\t\t,itt.inventlocationidfrom invent_location_id_from\n\t\t,itt.inventlocationidto invent_location_id_to\n\t\t,dbo.ENUM2STR('InventTransferStatus',itt.transferstatus) 'status'\n\t\t--,itt.SHIPDATE\n\t\t--,itt.RECEIVEDATE\n\t\t,itl.linenum line_num\n\t\t,itl.itemid item_id\n\t\t,id.wmslocationid wms_location_id\n\t\t,itl.qtytransfer qty_transfer\n\t\t,itl.shipdate ship_date\n\t\t,itl.receivedate receive_date\n\t\t,cast(invMod.price as decimal(10,2)) 'cost'\n\t\t,cast(invMod.price as decimal(10,2)) * itl.QTYTRANSFER 'ext_cost'\nfrom INVENTTRANSFERTABLE itt\nleft join INVENTTRANSFERLINE itl on itt.TRANSFERID = itl.TRANSFERID\nleft join INVENTDIM id on id.INVENTDIMID = itl.INVENTDIMID\ninner join [Briggs_Mst].dbo.INVENTTABLEMODULE invMod on invMod.itemid = itl.itemid and invMod.moduletype = 1 \nwhere itt.TRANSFERSTATUS = 2\nand year(itt.RECEIVEDATE)>='2019'-- between @startdate and @enddate",
								"queryTimeout": "02:00:00",
								"partitionOption": "None"
							},
							"sink": {
								"type": "AzureSqlSink",
								"preCopyScript": "truncate table briggs.Stage_Transfer_Order",
								"disableMetricsCollection": false
							},
							"enableStaging": false,
							"translator": {
								"type": "TabularTranslator",
								"mappings": [
									{
										"source": {
											"name": "transfer_id",
											"type": "String",
											"physicalType": "nvarchar"
										},
										"sink": {
											"name": "transfer_id",
											"type": "String",
											"physicalType": "String"
										}
									},
									{
										"source": {
											"name": "invent_location_id_from",
											"type": "String",
											"physicalType": "nvarchar"
										},
										"sink": {
											"name": "invent_location_id_from",
											"type": "String",
											"physicalType": "String"
										}
									},
									{
										"source": {
											"name": "invent_location_id_to",
											"type": "String",
											"physicalType": "nvarchar"
										},
										"sink": {
											"name": "invent_location_id_to",
											"type": "String",
											"physicalType": "String"
										}
									},
									{
										"source": {
											"name": "status",
											"type": "String",
											"physicalType": "varchar"
										},
										"sink": {
											"name": "status",
											"type": "String",
											"physicalType": "String"
										}
									},
									{
										"source": {
											"name": "line_num",
											"type": "Decimal",
											"physicalType": "decimal",
											"scale": 16,
											"precision": 32
										},
										"sink": {
											"name": "line_num",
											"type": "Decimal",
											"physicalType": "Decimal"
										}
									},
									{
										"source": {
											"name": "item_id",
											"type": "String",
											"physicalType": "nvarchar"
										},
										"sink": {
											"name": "item_id",
											"type": "String",
											"physicalType": "String"
										}
									},
									{
										"source": {
											"name": "wms_location_id",
											"type": "String",
											"physicalType": "nvarchar"
										},
										"sink": {
											"name": "wms_location_id",
											"type": "String",
											"physicalType": "String"
										}
									},
									{
										"source": {
											"name": "qty_transfer",
											"type": "Decimal",
											"physicalType": "decimal",
											"scale": 16,
											"precision": 32
										},
										"sink": {
											"name": "qty_transfer",
											"type": "Decimal",
											"physicalType": "Decimal"
										}
									},
									{
										"source": {
											"name": "ship_date",
											"type": "DateTime",
											"physicalType": "datetime"
										},
										"sink": {
											"name": "ship_date",
											"type": "DateTime",
											"physicalType": "DateTime"
										}
									},
									{
										"source": {
											"name": "receive_date",
											"type": "DateTime",
											"physicalType": "datetime"
										},
										"sink": {
											"name": "receive_date",
											"type": "DateTime",
											"physicalType": "DateTime"
										}
									},
									{
										"source": {
											"name": "cost",
											"type": "Decimal",
											"physicalType": "decimal",
											"scale": 2,
											"precision": 10
										},
										"sink": {
											"name": "cost",
											"type": "Decimal",
											"physicalType": "Decimal"
										}
									},
									{
										"source": {
											"name": "ext_cost",
											"type": "Decimal",
											"physicalType": "decimal",
											"scale": 13,
											"precision": 38
										},
										"sink": {
											"name": "ext_cost",
											"type": "Decimal",
											"physicalType": "Decimal"
										}
									}
								],
								"typeConversion": true,
								"typeConversionSettings": {
									"allowDataTruncation": true,
									"treatBooleanAsNumber": false
								}
							}
						},
						"inputs": [
							{
								"referenceName": "Briggs_MST",
								"type": "DatasetReference",
								"parameters": {}
							}
						],
						"outputs": [
							{
								"referenceName": "Briggs_MDW",
								"type": "DatasetReference",
								"parameters": {
									"schema_name": "Briggs",
									"table_name": "Stage_Transfer_Order"
								}
							}
						]
					},
					{
						"name": "lkp_ExecStartAuditProc",
						"type": "Lookup",
						"dependsOn": [],
						"policy": {
							"timeout": "7.00:00:00",
							"retry": 0,
							"retryIntervalInSeconds": 30,
							"secureOutput": false,
							"secureInput": false
						},
						"userProperties": [],
						"typeProperties": {
							"source": {
								"type": "AzureSqlSource",
								"sqlReaderStoredProcedureName": "[dbo].[proc_StartAuditLog]",
								"storedProcedureParameters": {
									"ConfigTableID": {
										"type": "Int32",
										"value": "-1"
									},
									"DataFactoryName": {
										"type": "String",
										"value": {
											"value": "@pipeline().DataFactory",
											"type": "Expression"
										}
									},
									"ParentAuditID": {
										"type": "Int64",
										"value": "-1"
									},
									"PipelineName": {
										"type": "String",
										"value": {
											"value": "@pipeline().Pipeline",
											"type": "Expression"
										}
									},
									"PipelineRunID": {
										"type": "String",
										"value": {
											"value": "@pipeline().RunId",
											"type": "Expression"
										}
									},
									"PipelineTriggerID": {
										"type": "String",
										"value": {
											"value": "@pipeline().TriggerId",
											"type": "Expression"
										}
									},
									"PipelineTriggerName": {
										"type": "String",
										"value": {
											"value": "@pipeline().TriggerName",
											"type": "Expression"
										}
									},
									"PipelineTriggerType": {
										"type": "String",
										"value": {
											"value": "@pipeline().TriggerType",
											"type": "Expression"
										}
									}
								},
								"queryTimeout": "02:00:00",
								"partitionOption": "None"
							},
							"dataset": {
								"referenceName": "Briggs_MDW",
								"type": "DatasetReference",
								"parameters": {
									"schema_name": "dbo",
									"table_name": "user"
								}
							}
						}
					},
					{
						"name": "Sp_ExecFailureAudit_Fact",
						"type": "SqlServerStoredProcedure",
						"dependsOn": [
							{
								"activity": "ForEach_Fact",
								"dependencyConditions": [
									"Failed"
								]
							}
						],
						"policy": {
							"timeout": "7.00:00:00",
							"retry": 0,
							"retryIntervalInSeconds": 30,
							"secureOutput": false,
							"secureInput": false
						},
						"userProperties": [],
						"typeProperties": {
							"storedProcedureName": "[dbo].[proc_UpdateAuditLog]",
							"storedProcedureParameters": {
								"AuditID": {
									"value": {
										"value": "@activity('lkp_ExecStartAuditProc').output.firstRow.AuditID",
										"type": "Expression"
									},
									"type": "Int32"
								},
								"DataLakePath": {
									"value": null,
									"type": "String"
								},
								"PipelineRunID": {
									"value": {
										"value": "@pipeline().RunId",
										"type": "Expression"
									},
									"type": "String"
								},
								"RowsRead": {
									"value": null,
									"type": "Int64"
								},
								"Status": {
									"value": "Fact Proc Failed",
									"type": "String"
								}
							}
						},
						"linkedServiceName": {
							"referenceName": "AzureSqlDatabase1",
							"type": "LinkedServiceReference"
						}
					},
					{
						"name": "Sp_ExecSuccessAudit",
						"type": "SqlServerStoredProcedure",
						"dependsOn": [
							{
								"activity": "ForEach_Fact",
								"dependencyConditions": [
									"Succeeded"
								]
							}
						],
						"policy": {
							"timeout": "7.00:00:00",
							"retry": 0,
							"retryIntervalInSeconds": 30,
							"secureOutput": false,
							"secureInput": false
						},
						"userProperties": [],
						"typeProperties": {
							"storedProcedureName": "[dbo].[proc_UpdateAuditLog]",
							"storedProcedureParameters": {
								"AuditID": {
									"value": {
										"value": "@activity('lkp_ExecStartAuditProc').output.firstRow.AuditID",
										"type": "Expression"
									},
									"type": "Int32"
								},
								"DataLakePath": {
									"value": null,
									"type": "String"
								},
								"RowsRead": {
									"value": null,
									"type": "Int64"
								},
								"Status": {
									"value": "Success",
									"type": "String"
								},
								"PipelineRunID": {
									"value": {
										"value": "@pipeline().RunId",
										"type": "Expression"
									},
									"type": "String"
								}
							}
						},
						"linkedServiceName": {
							"referenceName": "AzureSqlDatabase1",
							"type": "LinkedServiceReference"
						}
					},
					{
						"name": "Sp_ExecFailureAudit_Stage",
						"type": "SqlServerStoredProcedure",
						"dependsOn": [
							{
								"activity": "ForEach_Stage",
								"dependencyConditions": [
									"Failed"
								]
							}
						],
						"policy": {
							"timeout": "7.00:00:00",
							"retry": 0,
							"retryIntervalInSeconds": 30,
							"secureOutput": false,
							"secureInput": false
						},
						"userProperties": [],
						"typeProperties": {
							"storedProcedureName": "[dbo].[proc_UpdateAuditLog]",
							"storedProcedureParameters": {
								"AuditID": {
									"value": {
										"value": "@activity('lkp_ExecStartAuditProc').output.firstRow.AuditID",
										"type": "Expression"
									},
									"type": "Int32"
								},
								"DataLakePath": {
									"value": null,
									"type": "String"
								},
								"PipelineRunID": {
									"value": {
										"value": "@pipeline().RunId",
										"type": "Expression"
									},
									"type": "String"
								},
								"RowsRead": {
									"value": null,
									"type": "Int64"
								},
								"Status": {
									"value": "Stage Proc Failed",
									"type": "String"
								}
							}
						},
						"linkedServiceName": {
							"referenceName": "AzureSqlDatabase1",
							"type": "LinkedServiceReference"
						}
					},
					{
						"name": "Sp_ExecFailureAudit_TL",
						"type": "SqlServerStoredProcedure",
						"dependsOn": [
							{
								"activity": "Execute Pipeline1",
								"dependencyConditions": [
									"Failed"
								]
							}
						],
						"policy": {
							"timeout": "7.00:00:00",
							"retry": 0,
							"retryIntervalInSeconds": 30,
							"secureOutput": false,
							"secureInput": false
						},
						"userProperties": [],
						"typeProperties": {
							"storedProcedureName": "[dbo].[proc_UpdateAuditLog]",
							"storedProcedureParameters": {
								"AuditID": {
									"value": {
										"value": "@activity('lkp_ExecStartAuditProc').output.firstRow.AuditID",
										"type": "Expression"
									},
									"type": "Int32"
								},
								"DataLakePath": {
									"value": null,
									"type": "String"
								},
								"PipelineRunID": {
									"value": {
										"value": "@pipeline().RunId",
										"type": "Expression"
									},
									"type": "String"
								},
								"RowsRead": {
									"value": null,
									"type": "Int64"
								},
								"Status": {
									"value": "Table Load Failed",
									"type": "String"
								}
							}
						},
						"linkedServiceName": {
							"referenceName": "AzureSqlDatabase1",
							"type": "LinkedServiceReference"
						}
					}
				],
				"policy": {
					"elapsedTimeMetric": {},
					"cancelAfter": {}
				},
				"variables": {
					"ErrorMsg": {
						"type": "String"
					}
				},
				"folder": {
					"name": "Briggs Data Load Theme wise"
				},
				"annotations": [],
				"lastPublishTime": "2022-04-28T04:31:06Z"
			},
			"dependsOn": [
				"[concat(variables('workspaceId'), '/pipelines/PL_Generic_Copy_Statement')]",
				"[concat(variables('workspaceId'), '/datasets/Briggs_MDW')]",
				"[concat(variables('workspaceId'), '/datasets/Briggs_MST')]",
				"[concat(variables('workspaceId'), '/linkedServices/AzureSqlDatabase1')]",
				"[concat(variables('workspaceId'), '/linkedServices/DS_MDW_SP')]"
			]
		},
		{
			"name": "[concat(parameters('workspaceName'), '/PL_Master_Briggs_Tech')]",
			"type": "Microsoft.Synapse/workspaces/pipelines",
			"apiVersion": "2019-06-01-preview",
			"properties": {
				"activities": [
					{
						"name": "Execute Pipeline1",
						"type": "ExecutePipeline",
						"dependsOn": [
							{
								"activity": "lkp_ExecStartAuditProc",
								"dependencyConditions": [
									"Succeeded"
								]
							}
						],
						"userProperties": [],
						"typeProperties": {
							"pipeline": {
								"referenceName": "PL_Generic_Copy_Tech",
								"type": "PipelineReference"
							},
							"waitOnCompletion": true,
							"parameters": {}
						}
					},
					{
						"name": "ReportStageProc",
						"type": "Lookup",
						"dependsOn": [
							{
								"activity": "Execute Pipeline1",
								"dependencyConditions": [
									"Succeeded"
								]
							}
						],
						"policy": {
							"timeout": "7.00:00:00",
							"retry": 0,
							"retryIntervalInSeconds": 30,
							"secureOutput": false,
							"secureInput": false
						},
						"userProperties": [],
						"typeProperties": {
							"source": {
								"type": "AzureSqlSource",
								"sqlReaderQuery": "select  * from dbo.control_table where processsequence = 2 and enableaction = 1 \nand subjectarea='Report Stage Tech SP'\norder by id",
								"queryTimeout": "02:00:00",
								"partitionOption": "None"
							},
							"dataset": {
								"referenceName": "Briggs_MDW",
								"type": "DatasetReference",
								"parameters": {
									"schema_name": "dbo",
									"table_name": "user"
								}
							},
							"firstRowOnly": false
						}
					},
					{
						"name": "ForEach_Stage",
						"type": "ForEach",
						"dependsOn": [
							{
								"activity": "ReportStageProc",
								"dependencyConditions": [
									"Succeeded"
								]
							}
						],
						"userProperties": [],
						"typeProperties": {
							"items": {
								"value": "@activity('ReportStageProc').output.value",
								"type": "Expression"
							},
							"activities": [
								{
									"name": "Stored procedure1",
									"type": "SqlServerStoredProcedure",
									"dependsOn": [
										{
											"activity": "Start_Table_Audit_Stage",
											"dependencyConditions": [
												"Succeeded"
											]
										}
									],
									"policy": {
										"timeout": "7.00:00:00",
										"retry": 0,
										"retryIntervalInSeconds": 30,
										"secureOutput": false,
										"secureInput": false
									},
									"userProperties": [],
									"typeProperties": {
										"storedProcedureName": {
											"value": "@item().sourcetablename",
											"type": "Expression"
										}
									},
									"linkedServiceName": {
										"referenceName": "DS_MDW_SP",
										"type": "LinkedServiceReference"
									}
								},
								{
									"name": "Start_Table_Audit_Stage",
									"type": "Lookup",
									"dependsOn": [],
									"policy": {
										"timeout": "7.00:00:00",
										"retry": 0,
										"retryIntervalInSeconds": 30,
										"secureOutput": false,
										"secureInput": false
									},
									"userProperties": [],
									"typeProperties": {
										"source": {
											"type": "AzureSqlSource",
											"sqlReaderStoredProcedureName": "[dbo].[proc_StartAuditLog_Briggs]",
											"storedProcedureParameters": {
												"ConfigTableID": {
													"type": "Int32",
													"value": {
														"value": "@item().ID",
														"type": "Expression"
													}
												},
												"DataFactoryName": {
													"type": "String",
													"value": {
														"value": "@pipeline().DataFactory",
														"type": "Expression"
													}
												},
												"ParentAuditID": {
													"type": "Int64",
													"value": {
														"value": "@item().ID",
														"type": "Expression"
													}
												},
												"PipelineName": {
													"type": "String",
													"value": {
														"value": "@pipeline().Pipeline",
														"type": "Expression"
													}
												},
												"PipelineRunID": {
													"type": "String",
													"value": {
														"value": "@pipeline().RunId",
														"type": "Expression"
													}
												},
												"PipelineTriggerID": {
													"type": "String",
													"value": {
														"value": "@pipeline().TriggerId",
														"type": "Expression"
													}
												},
												"PipelineTriggerName": {
													"type": "String",
													"value": {
														"value": "@pipeline().TriggerName",
														"type": "Expression"
													}
												},
												"PipelineTriggerType": {
													"type": "String",
													"value": {
														"value": "@pipeline().TriggerType",
														"type": "Expression"
													}
												},
												"Sourcedb": {
													"type": "String",
													"value": {
														"value": "@item().sourceDB",
														"type": "Expression"
													}
												},
												"sourcetable": {
													"type": "String",
													"value": {
														"value": "@item().SourcetableName",
														"type": "Expression"
													}
												}
											},
											"queryTimeout": "02:00:00",
											"partitionOption": "None"
										},
										"dataset": {
											"referenceName": "Briggs_MDW",
											"type": "DatasetReference",
											"parameters": {
												"schema_name": "dbo",
												"table_name": "user"
											}
										},
										"firstRowOnly": false
									}
								},
								{
									"name": "Set variable_Stage",
									"type": "SetVariable",
									"dependsOn": [
										{
											"activity": "Stored procedure1",
											"dependencyConditions": [
												"Failed"
											]
										}
									],
									"userProperties": [],
									"typeProperties": {
										"variableName": "ErrorMsg",
										"value": {
											"value": "@activity('Stored procedure1').Error.Message",
											"type": "Expression"
										}
									}
								},
								{
									"name": "Failure_Audit_Log_Stage",
									"type": "SqlServerStoredProcedure",
									"dependsOn": [
										{
											"activity": "Set variable_Stage",
											"dependencyConditions": [
												"Succeeded"
											]
										}
									],
									"policy": {
										"timeout": "7.00:00:00",
										"retry": 0,
										"retryIntervalInSeconds": 30,
										"secureOutput": false,
										"secureInput": false
									},
									"userProperties": [],
									"typeProperties": {
										"storedProcedureName": "[dbo].[proc_UpdateAuditLog_Briggs]",
										"storedProcedureParameters": {
											"ConfigTableID": {
												"value": {
													"value": "@item().ID",
													"type": "Expression"
												},
												"type": "Int32"
											},
											"RowsRead": {
												"value": null,
												"type": "Int64"
											},
											"Status": {
												"value": {
													"value": "@variables('ErrorMsg')",
													"type": "Expression"
												},
												"type": "String"
											}
										}
									},
									"linkedServiceName": {
										"referenceName": "DS_MDW_SP",
										"type": "LinkedServiceReference"
									}
								},
								{
									"name": "Success_Audit_Log_Stage",
									"type": "SqlServerStoredProcedure",
									"dependsOn": [
										{
											"activity": "Stored procedure1",
											"dependencyConditions": [
												"Succeeded"
											]
										}
									],
									"policy": {
										"timeout": "7.00:00:00",
										"retry": 0,
										"retryIntervalInSeconds": 30,
										"secureOutput": false,
										"secureInput": false
									},
									"userProperties": [],
									"typeProperties": {
										"storedProcedureName": "[dbo].[proc_UpdateAuditLog_Briggs]",
										"storedProcedureParameters": {
											"ConfigTableID": {
												"value": {
													"value": "@item().ID",
													"type": "Expression"
												},
												"type": "Int32"
											},
											"RowsRead": {
												"value": null,
												"type": "Int64"
											},
											"Status": {
												"value": "Success",
												"type": "String"
											}
										}
									},
									"linkedServiceName": {
										"referenceName": "DS_MDW_SP",
										"type": "LinkedServiceReference"
									}
								}
							]
						}
					},
					{
						"name": "ReportFactProc",
						"type": "Lookup",
						"dependsOn": [
							{
								"activity": "ForEach_Stage",
								"dependencyConditions": [
									"Succeeded"
								]
							},
							{
								"activity": "Stage_Tech_Mobility_Metrics",
								"dependencyConditions": [
									"Succeeded"
								]
							},
							{
								"activity": "Stage_Tech_Time_Invoiced",
								"dependencyConditions": [
									"Succeeded"
								]
							}
						],
						"policy": {
							"timeout": "7.00:00:00",
							"retry": 0,
							"retryIntervalInSeconds": 30,
							"secureOutput": false,
							"secureInput": false
						},
						"userProperties": [],
						"typeProperties": {
							"source": {
								"type": "AzureSqlSource",
								"sqlReaderQuery": "select  * from dbo.control_table where processsequence = 4 and enableaction = 1 \nand subjectarea='Report Fact Tech SP'\norder by id",
								"queryTimeout": "02:00:00",
								"partitionOption": "None"
							},
							"dataset": {
								"referenceName": "Briggs_MDW",
								"type": "DatasetReference",
								"parameters": {
									"schema_name": "dbo",
									"table_name": "user"
								}
							},
							"firstRowOnly": false
						}
					},
					{
						"name": "ForEach_Fact",
						"type": "ForEach",
						"dependsOn": [
							{
								"activity": "ReportFactProc",
								"dependencyConditions": [
									"Succeeded"
								]
							}
						],
						"userProperties": [],
						"typeProperties": {
							"items": {
								"value": "@activity('ReportFactProc').output.value",
								"type": "Expression"
							},
							"activities": [
								{
									"name": "Stored procedure",
									"type": "SqlServerStoredProcedure",
									"dependsOn": [
										{
											"activity": "Start_Table_Audit1_Fact",
											"dependencyConditions": [
												"Succeeded"
											]
										}
									],
									"policy": {
										"timeout": "7.00:00:00",
										"retry": 0,
										"retryIntervalInSeconds": 30,
										"secureOutput": false,
										"secureInput": false
									},
									"userProperties": [],
									"typeProperties": {
										"storedProcedureName": {
											"value": "@item().sourcetablename",
											"type": "Expression"
										}
									},
									"linkedServiceName": {
										"referenceName": "DS_MDW_SP",
										"type": "LinkedServiceReference"
									}
								},
								{
									"name": "Start_Table_Audit1_Fact",
									"type": "Lookup",
									"dependsOn": [],
									"policy": {
										"timeout": "7.00:00:00",
										"retry": 0,
										"retryIntervalInSeconds": 30,
										"secureOutput": false,
										"secureInput": false
									},
									"userProperties": [],
									"typeProperties": {
										"source": {
											"type": "AzureSqlSource",
											"sqlReaderStoredProcedureName": "[dbo].[proc_StartAuditLog_Briggs]",
											"storedProcedureParameters": {
												"ConfigTableID": {
													"type": "Int32",
													"value": {
														"value": "@item().ID",
														"type": "Expression"
													}
												},
												"DataFactoryName": {
													"type": "String",
													"value": {
														"value": "@pipeline().DataFactory",
														"type": "Expression"
													}
												},
												"ParentAuditID": {
													"type": "Int64",
													"value": {
														"value": "@item().ID",
														"type": "Expression"
													}
												},
												"PipelineName": {
													"type": "String",
													"value": {
														"value": "@pipeline().Pipeline",
														"type": "Expression"
													}
												},
												"PipelineRunID": {
													"type": "String",
													"value": {
														"value": "@pipeline().RunId",
														"type": "Expression"
													}
												},
												"PipelineTriggerID": {
													"type": "String",
													"value": {
														"value": "@pipeline().TriggerId",
														"type": "Expression"
													}
												},
												"PipelineTriggerName": {
													"type": "String",
													"value": {
														"value": "@pipeline().TriggerName",
														"type": "Expression"
													}
												},
												"PipelineTriggerType": {
													"type": "String",
													"value": {
														"value": "@pipeline().TriggerType",
														"type": "Expression"
													}
												},
												"Sourcedb": {
													"type": "String",
													"value": {
														"value": "@item().sourceDB",
														"type": "Expression"
													}
												},
												"sourcetable": {
													"type": "String",
													"value": {
														"value": "@item().SourcetableName",
														"type": "Expression"
													}
												}
											},
											"queryTimeout": "02:00:00",
											"partitionOption": "None"
										},
										"dataset": {
											"referenceName": "Briggs_MDW",
											"type": "DatasetReference",
											"parameters": {
												"schema_name": "dbo",
												"table_name": "user"
											}
										},
										"firstRowOnly": false
									}
								},
								{
									"name": "Set variable1_Fact",
									"type": "SetVariable",
									"dependsOn": [
										{
											"activity": "Stored procedure",
											"dependencyConditions": [
												"Failed"
											]
										}
									],
									"userProperties": [],
									"typeProperties": {
										"variableName": "ErrorMsg",
										"value": {
											"value": "@activity('ReportStageProc').Error.Message",
											"type": "Expression"
										}
									}
								},
								{
									"name": "Failure_Audit_Log_Fact",
									"type": "SqlServerStoredProcedure",
									"dependsOn": [
										{
											"activity": "Set variable1_Fact",
											"dependencyConditions": [
												"Succeeded"
											]
										}
									],
									"policy": {
										"timeout": "7.00:00:00",
										"retry": 0,
										"retryIntervalInSeconds": 30,
										"secureOutput": false,
										"secureInput": false
									},
									"userProperties": [],
									"typeProperties": {
										"storedProcedureName": "[dbo].[proc_UpdateAuditLog_Briggs]",
										"storedProcedureParameters": {
											"ConfigTableID": {
												"value": {
													"value": "@item().ID",
													"type": "Expression"
												},
												"type": "Int32"
											},
											"RowsRead": {
												"value": null,
												"type": "Int64"
											},
											"Status": {
												"value": {
													"value": "@variables('ErrorMsg')",
													"type": "Expression"
												},
												"type": "String"
											}
										}
									},
									"linkedServiceName": {
										"referenceName": "DS_MDW_SP",
										"type": "LinkedServiceReference"
									}
								},
								{
									"name": "Success_Audit_Log2_Fact",
									"type": "SqlServerStoredProcedure",
									"dependsOn": [
										{
											"activity": "Stored procedure",
											"dependencyConditions": [
												"Succeeded"
											]
										}
									],
									"policy": {
										"timeout": "7.00:00:00",
										"retry": 0,
										"retryIntervalInSeconds": 30,
										"secureOutput": false,
										"secureInput": false
									},
									"userProperties": [],
									"typeProperties": {
										"storedProcedureName": "[dbo].[proc_UpdateAuditLog_Briggs]",
										"storedProcedureParameters": {
											"ConfigTableID": {
												"value": {
													"value": "@item().ID",
													"type": "Expression"
												},
												"type": "Int32"
											},
											"RowsRead": {
												"value": null,
												"type": "Int64"
											},
											"Status": {
												"value": "Success",
												"type": "String"
											}
										}
									},
									"linkedServiceName": {
										"referenceName": "DS_MDW_SP",
										"type": "LinkedServiceReference"
									}
								}
							]
						}
					},
					{
						"name": "Stage_Tech_Time_Invoiced",
						"type": "Copy",
						"dependsOn": [],
						"policy": {
							"timeout": "7.00:00:00",
							"retry": 0,
							"retryIntervalInSeconds": 30,
							"secureOutput": false,
							"secureInput": false
						},
						"userProperties": [],
						"typeProperties": {
							"source": {
								"type": "SqlServerSource",
								"sqlReaderQuery": "with split_table as (\n  select \n    svc.svccallid svccallid, \n    wrker.personnelnumber tech, \n    sum(pet.qty)/ isnull(tothours.hours, 1) split \n  from \n    projjournaltrans pet \n    left join hcmworker wrker on pet.worker = wrker.recid \n    left join xap_svcsegmenttable svcseg on svcseg.segmentid = pet.projid \n    left join xap_svccalltable svc on svc.recid = svcseg.svccallid \n    left join (\n      select \n        pet.projid, \n        sum(pet.qty) 'hours' \n      from \n        projjournaltrans pet \n        left join hcmworker wrker on pet.worker = wrker.recid \n      group by \n        pet.projid\n    ) tothours on tothours.projid = pet.projid \n  where \n    tothours.hours <> 0 \n    and svc.recid is not null \n  group by \n    svc.svccallid, \n    wrker.personnelnumber, \n    tothours.hours\n), \ngl(voucher, dollars, accountingdate) as(\n  select \n    gje.subledgervoucher AS 'voucher', \n    sum(gjae.accountingcurrencyamount) dollars, \n    gje.accountingdate \n  from \n    generaljournalentry gje \n    inner join generaljournalaccountentry gjae on gje.recid = gjae.generaljournalentry \n    inner join dimensionattributevaluegroupcombination davgc on gjae.ledgerdimension = davgc.dimensionattributevaluecombination \n    and davgc.ordinal = 2 \n    inner join dimensionattributevaluecombination davc on davc.recid = davgc.dimensionattributevaluecombination --and    davc.accountstructure = 5637152077    \n    inner join mainaccount ma on ma.recid = davc.mainaccount \n  where \n    substring(davc.displayvalue, 8, 2) = '20' --and substring(davc.displayvalue,11,3) = @branch\n    and year(gje.accountingdate)>= '2020' --- between @startdate and @enddate\n    and ma.mainaccountid in (\n      400300, 400301, 400302, 400310, 621000, \n      621001, 621002, 621010\n    ) \n    and gje.subledgervoucher not like 'YE%' \n  group by \n    gje.subledgervoucher, \n    gje.accountingdate\n), \nlabor_cte(projid, money, hours) as(\n  select \n    projinvoiceid, \n    sum(lineamount), \n    sum(qty) \n  from \n    projinvoiceempl \n  group by \n    projinvoiceid\n), \nparts_cte(projid, money) as(\n  select \n    projinvoiceid, \n    sum(pit.lineamount) \n  from \n    projinvoiceitem pit \n  group by \n    pit.projinvoiceid\n), \nmisc_cte(projid, money) as(\n  select \n    projinvoiceid, \n    sum(lineamount) \n  from \n    projinvoicecost \n  group by \n    projinvoiceid\n), \nflat_cte_labor(segment, dollars) as(\n  select \n    projinvoiceid, \n    sum(lineamount) \n  from \n    projinvoicerevenue \n  where \n    categoryid like 'SRV%' \n  group by \n    projinvoiceid\n), \nflat_cte_parts(segment, dollars) as(\n  select \n    projinvoiceid, \n    sum(lineamount) \n  from \n    projinvoicerevenue \n  where \n    categoryid like 'PTS%' \n  group by \n    PROJINVOICEID\n) \nselect \n  pij.projinvoiceid proj_invoice_id, \n  gl.voucher, \n  pij.invoicedate invoice_date, \n  svc.svccallid svc_call_id, \n  svctypetable.calltypeid call_type_id, \n  dir.name 'tech', \n  htitle.titleid title_id, \n  hcm.officelocation office_location, \n  wrker.personnelnumber personnel_number, \n  billto.custgroup 'bill_to_group', \n  billto.accountnum 'bill_to#', \n  dirbt.name ' bill_to_name', \n  shipto.accountnum 'ship_to#', \n  dirst.name 'ship_to_name', \n  cast(\n    isnull(\n      labor_cte.hours * splits_cte.split, \n      0\n    ) as decimal(10, 2)\n  ) 'hours', \n  (gl.dollars *-1)* splits_cte.split 'gl_labor_dollars', \n  splits_cte.split 'split_percent', \n  case when billto.custgroup <> 'INTERDEPT' then (\n    cast(\n      isnull(parts_cte.money, 0.00)+ isnull(flat_cte_parts.dollars, 0) as decimal(10, 2)\n    )* splits_cte.split\n  ) else 0 end 'parts_charged', \n  cast(\n    isnull(\n      misc_cte.money * splits_cte.split, \n      0.00\n    ) as decimal(10, 2)\n  ) 'misc_charged', \n  case when billto.custgroup <> 'INTERDEPT' then pij.invoiceamount else 0 end 'invoice_amount', \n  svc.inventlocationid invent_location_id, \n  gl.accountingdate accounting_date \nfrom \n  gl \n  left join projinvoicejour pij on pij.ledgervoucher = gl.voucher \n  left join xap_svccalltable svc on svc.recid = pij.svccallid \n  left join split_table splits_cte on splits_cte.svccallid = svc.svccallid \n  left join hcmworker wrker on wrker.personnelnumber = splits_cte.tech --left join hcmworker wrker on svc.wrkctrid = wrker.personnelnumber\n  left join hcmworkertitle hcm on hcm.worker = wrker.recid \n  and dbo.utc2central(hcm.validto) >= getdate() \n  left join hcmtitle htitle on hcm.title = htitle.recid \n  left join dirpartytable dir on wrker.person = dir.recid \n  left join custtable billto on billto.accountnum = pij.invoiceaccount \n  left join dirpartytable dirbt on dirbt.recid = billto.party \n  left join custtable shipto on shipto.accountnum = pij.orderaccount \n  left join dirpartytable dirst on dirst.recid = shipto.party \n  left join labor_cte on labor_cte.projid = pij.projinvoiceid \n  left join parts_cte on parts_cte.projid = pij.projinvoiceid \n  left join misc_cte on misc_cte.projid = pij.projinvoiceid \n  left join flat_cte_labor on flat_cte_labor.segment = pij.projinvoiceid \n  left join flat_cte_parts on flat_cte_parts.segment = pij.projinvoiceid \n  left join dbo.xap_svccalltypetable svctypetable on svc.calltypeid = svctypetable.recid \nwhere \n  pij.projinvoiceid is not null\n",
								"queryTimeout": "02:00:00",
								"partitionOption": "None"
							},
							"sink": {
								"type": "AzureSqlSink",
								"preCopyScript": "truncate table briggs.Stage_Tech_Time_Invoiced",
								"disableMetricsCollection": false
							},
							"enableStaging": false,
							"translator": {
								"type": "TabularTranslator",
								"mappings": [
									{
										"source": {
											"name": "proj_invoice_id",
											"type": "String",
											"physicalType": "nvarchar"
										},
										"sink": {
											"name": "proj_invoice_id",
											"type": "String",
											"physicalType": "String"
										}
									},
									{
										"source": {
											"name": "voucher",
											"type": "String",
											"physicalType": "nvarchar"
										},
										"sink": {
											"name": "voucher",
											"type": "String",
											"physicalType": "String"
										}
									},
									{
										"source": {
											"name": "invoice_date",
											"type": "DateTime",
											"physicalType": "datetime"
										},
										"sink": {
											"name": "invoice_date",
											"type": "DateTime",
											"physicalType": "DateTime"
										}
									},
									{
										"source": {
											"name": "svc_call_id",
											"type": "String",
											"physicalType": "nvarchar"
										},
										"sink": {
											"name": "svc_call_id",
											"type": "String",
											"physicalType": "String"
										}
									},
									{
										"source": {
											"name": "call_type_id",
											"type": "String",
											"physicalType": "nvarchar"
										},
										"sink": {
											"name": "call_type_id",
											"type": "String",
											"physicalType": "String"
										}
									},
									{
										"source": {
											"name": "tech",
											"type": "String",
											"physicalType": "nvarchar"
										},
										"sink": {
											"name": "tech",
											"type": "String",
											"physicalType": "String"
										}
									},
									{
										"source": {
											"name": "title_id",
											"type": "String",
											"physicalType": "nvarchar"
										},
										"sink": {
											"name": "title_id",
											"type": "String",
											"physicalType": "String"
										}
									},
									{
										"source": {
											"name": "office_location",
											"type": "String",
											"physicalType": "nvarchar"
										},
										"sink": {
											"name": "office_location",
											"type": "String",
											"physicalType": "String"
										}
									},
									{
										"source": {
											"name": "personnel_number",
											"type": "String",
											"physicalType": "nvarchar"
										},
										"sink": {
											"name": "personnel_number",
											"type": "String",
											"physicalType": "String"
										}
									},
									{
										"source": {
											"name": "bill_to_group",
											"type": "String",
											"physicalType": "nvarchar"
										},
										"sink": {
											"name": "bill_to_group",
											"type": "String",
											"physicalType": "String"
										}
									},
									{
										"source": {
											"name": "bill_to#",
											"type": "String",
											"physicalType": "nvarchar"
										},
										"sink": {
											"name": "bill_to#",
											"type": "String",
											"physicalType": "String"
										}
									},
									{
										"source": {
											"name": " bill_to_name",
											"type": "String",
											"physicalType": "nvarchar"
										},
										"sink": {
											"name": " bill_to_name",
											"type": "String",
											"physicalType": "String"
										}
									},
									{
										"source": {
											"name": "ship_to#",
											"type": "String",
											"physicalType": "nvarchar"
										},
										"sink": {
											"name": "ship_to#",
											"type": "String",
											"physicalType": "String"
										}
									},
									{
										"source": {
											"name": "ship_to_name",
											"type": "String",
											"physicalType": "nvarchar"
										},
										"sink": {
											"name": "ship_to_name",
											"type": "String",
											"physicalType": "String"
										}
									},
									{
										"source": {
											"name": "hours",
											"type": "Decimal",
											"physicalType": "decimal",
											"scale": 2,
											"precision": 10
										},
										"sink": {
											"name": "hours",
											"type": "Decimal",
											"physicalType": "Decimal"
										}
									},
									{
										"source": {
											"name": "gl_labor_dollars",
											"type": "Decimal",
											"physicalType": "decimal",
											"scale": 6,
											"precision": 38
										},
										"sink": {
											"name": "gl_labor_dollars",
											"type": "Decimal",
											"physicalType": "Decimal"
										}
									},
									{
										"source": {
											"name": "split_percent",
											"type": "Decimal",
											"physicalType": "decimal",
											"scale": 6,
											"precision": 38
										},
										"sink": {
											"name": "split_percent",
											"type": "Decimal",
											"physicalType": "Decimal"
										}
									},
									{
										"source": {
											"name": "parts_charged",
											"type": "Decimal",
											"physicalType": "decimal",
											"scale": 6,
											"precision": 38
										},
										"sink": {
											"name": "parts_charged",
											"type": "Decimal",
											"physicalType": "Decimal"
										}
									},
									{
										"source": {
											"name": "misc_charged",
											"type": "Decimal",
											"physicalType": "decimal",
											"scale": 2,
											"precision": 10
										},
										"sink": {
											"name": "misc_charged",
											"type": "Decimal",
											"physicalType": "Decimal"
										}
									},
									{
										"source": {
											"name": "invoice_amount",
											"type": "Decimal",
											"physicalType": "decimal",
											"scale": 16,
											"precision": 32
										},
										"sink": {
											"name": "invoice_amount",
											"type": "Decimal",
											"physicalType": "Decimal"
										}
									},
									{
										"source": {
											"name": "invent_location_id",
											"type": "String",
											"physicalType": "nvarchar"
										},
										"sink": {
											"name": "invent_location_id",
											"type": "String",
											"physicalType": "String"
										}
									},
									{
										"source": {
											"name": "accounting_date",
											"type": "DateTime",
											"physicalType": "datetime"
										},
										"sink": {
											"name": "accounting_date",
											"type": "DateTime",
											"physicalType": "DateTime"
										}
									}
								],
								"typeConversion": true,
								"typeConversionSettings": {
									"allowDataTruncation": true,
									"treatBooleanAsNumber": false
								}
							}
						},
						"inputs": [
							{
								"referenceName": "Briggs_MST",
								"type": "DatasetReference",
								"parameters": {}
							}
						],
						"outputs": [
							{
								"referenceName": "Briggs_MDW",
								"type": "DatasetReference",
								"parameters": {
									"schema_name": "Briggs",
									"table_name": "Stage_Tech_Time_Invoiced"
								}
							}
						]
					},
					{
						"name": "Stage_Tech_Mobility_Metrics",
						"type": "Copy",
						"dependsOn": [],
						"policy": {
							"timeout": "7.00:00:00",
							"retry": 0,
							"retryIntervalInSeconds": 30,
							"secureOutput": false,
							"secureInput": false
						},
						"userProperties": [],
						"typeProperties": {
							"source": {
								"type": "SqlServerSource",
								"sqlReaderQuery": "with cteUploadsPerDay as (\n  select \n    wrker.personnelnumber worker, \n    cast(dr.createddatetime as date) 'date', \n    sum(\n      case when dt.typeid = 'm-EqDmgImg' then 1 else 0 end\n    ) 'eq_dmg_img', \n    sum(\n      case when dt.typeid = 'm-EqImg' then 1 else 0 end\n    ) 'eq_img', \n    sum(\n      case when dt.typeid = 'm-Misc' then 1 else 0 end\n    ) 'misc', \n    sum(\n      case when dt.typeid = 'm-Receipt' then 1 else 0 end\n    ) 'receipt', \n    sum(\n      case when dt.typeid = 'm-SignedDo' then 1 else 0 end\n    ) 'signed_do', \n    sum(\n      case when dt.typeid = 'm-Warranty' then 1 else 0 end\n    ) 'warranty', \n    sum(\n      case when dt.typeid = 'm-PCARD' then 1 else 0 end\n    ) 'p_card', \n    sum(\n      case when dt.typeid = 'm-Quote' then 1 else 0 end\n    ) 'quote' \n  from \n    docuref dr \n    left join docuvalue da on dr.valuerecid = da.recid \n    left join xap_svccalltable svc on svc.recid = dr.refrecid \n    left join docutype dt on dr.typeid = dt.typeid \n    left join hcmworker wrker on svc.wrkctrid = wrker.personnelnumber \n  where \n    dr.reftableid = 108664 \n    and dt.typegroup = 6 \n    and year(dr.createddatetime)>= '2020' --and dbo.utc2central(dr.createddatetime) between @_startdate and @_enddate\n  group by \n    wrker.personnelnumber, \n    cast(dr.createddatetime as date)\n), \ncteHoursPostedPerDay as (\n  select \n    wrker.personnelnumber worker, \n    dir.name [name], \n    left(wrkt.officelocation, 3) [location], \n    pet.projtransdate [date], \n    sum(pet.qty) 'total_hours', \n    sum(\n      case when pjt.DESCRIPTION = 'Mobile generated hour posting' then pet.qty else 0 End\n    ) 'mobile_hours', \n    count(\n      distinct case when pjt.DESCRIPTION = 'Mobile generated hour posting' then pjt.journalid else null end\n    ) 'postings' \n  from \n    projjournaltrans pet \n    left join projjournaltable pjt on pet.journalid = pjt.journalid \n    left join hcmworker wrker on pet.worker = wrker.recid \n    left join briggs_mst.dbo.dirpartytable dir on wrker.person = dir.recid \n    left join hcmworkertitle wrkt on wrkt.worker = wrker.recid \n    and wrkt.validto > getdate() \n  where \n    year(pet.projtransdate)>= '2020' -- between @_startdate and @_enddate\n  group by \n    wrker.personnelnumber, \n    dir.name, \n    pet.projtransdate, \n    wrkt.officelocation \n  having \n    sum(pet.qty)<> 0\n), \ncteNotesStatus as (\n  select \n    wrker.personnelnumber worker, \n    cast(createdatetime as date) 'date', \n    sum(\n      case when [action] = 'AddsNotesToServiceCall' then 1 else 0 end\n    ) 'Notes_Posted', \n    sum(\n      case when [action] = 'UpdateServiceCallStatus' then 1 else 0 end\n    ) 'Status_Updates', \n    sum(\n      case when [action] = 'AddServiceCalloutCharge' then 1 else 0 end\n    ) 'Call_out_Adds' \n  from \n    [briggsax].[dbo].[cw_apilog] a \n    left join [briggsax].[dbo].[briggs_adusers] r on a.[user] = r.username \n    left join briggs_mst.dbo.logisticselectronicaddress email on email.locator = r.email \n    and email.type = 2 \n    left join briggs_mst.dbo.dirpartylocation dirl on dirl.location = email.location \n    left join briggs_mst.dbo.hcmworker wrker on wrker.person = dirl.party \n  where \n    year(a.createdatetime)>= '2020' --cast(a.createdatetime as date) >  @_startdate and  cast(a.createdatetime as date) < @_enddate\n    and httptype = 1 --and action in ('addsnotestoservicecall','updateservicecallstatus')\n  group by \n    wrker.personnelnumber, \n    cast(createdatetime as date)\n) \nselect \n  hrs.*, \n  upld.signed_do, \n  upld.eq_img, \n  upld.eq_dmg_img, \n  upld.misc, \n  upld.receipt, \n  upld.warranty, \n  upld.p_card, \n  upld.quote, \n  ns.notes_posted, \n  ns.status_updates, \n  ns.call_out_adds \nfrom \n  cteHoursPostedPerDay hrs \n  left join cteUploadsPerDay upld on hrs.worker = upld.worker \n  and hrs.date = upld.date \n  left join cteNotesStatus ns on ns.worker = hrs.worker \n  and ns.date = hrs.date",
								"queryTimeout": "02:00:00",
								"partitionOption": "None"
							},
							"sink": {
								"type": "AzureSqlSink",
								"preCopyScript": "truncate table briggs.Stage_Tech_Mobility_Metrics",
								"disableMetricsCollection": false
							},
							"enableStaging": false,
							"translator": {
								"type": "TabularTranslator",
								"mappings": [
									{
										"source": {
											"name": "worker",
											"type": "String",
											"physicalType": "nvarchar"
										},
										"sink": {
											"name": "worker",
											"type": "String",
											"physicalType": "String"
										}
									},
									{
										"source": {
											"name": "name",
											"type": "String",
											"physicalType": "nvarchar"
										},
										"sink": {
											"name": "name",
											"type": "String",
											"physicalType": "String"
										}
									},
									{
										"source": {
											"name": "location",
											"type": "String",
											"physicalType": "nvarchar"
										},
										"sink": {
											"name": "location",
											"type": "String",
											"physicalType": "String"
										}
									},
									{
										"source": {
											"name": "date",
											"type": "DateTime",
											"physicalType": "datetime"
										},
										"sink": {
											"name": "date",
											"type": "DateTime",
											"physicalType": "DateTime"
										}
									},
									{
										"source": {
											"name": "total_hours",
											"type": "Decimal",
											"physicalType": "decimal",
											"scale": 16,
											"precision": 38
										},
										"sink": {
											"name": "total_hours",
											"type": "Decimal",
											"physicalType": "Decimal"
										}
									},
									{
										"source": {
											"name": "mobile_hours",
											"type": "Decimal",
											"physicalType": "decimal",
											"scale": 16,
											"precision": 38
										},
										"sink": {
											"name": "mobile_hours",
											"type": "Decimal",
											"physicalType": "Decimal"
										}
									},
									{
										"source": {
											"name": "postings",
											"type": "Int32",
											"physicalType": "int"
										},
										"sink": {
											"name": "postings",
											"type": "Int32",
											"physicalType": "Int32"
										}
									},
									{
										"source": {
											"name": "signed_do",
											"type": "Int32",
											"physicalType": "int"
										},
										"sink": {
											"name": "signed_do",
											"type": "Int32",
											"physicalType": "Int32"
										}
									},
									{
										"source": {
											"name": "eq_img",
											"type": "Int32",
											"physicalType": "int"
										},
										"sink": {
											"name": "eq_img",
											"type": "Int32",
											"physicalType": "Int32"
										}
									},
									{
										"source": {
											"name": "eq_dmg_img",
											"type": "Int32",
											"physicalType": "int"
										},
										"sink": {
											"name": "eq_dmg_img",
											"type": "Int32",
											"physicalType": "Int32"
										}
									},
									{
										"source": {
											"name": "misc",
											"type": "Int32",
											"physicalType": "int"
										},
										"sink": {
											"name": "misc",
											"type": "Int32",
											"physicalType": "Int32"
										}
									},
									{
										"source": {
											"name": "receipt",
											"type": "Int32",
											"physicalType": "int"
										},
										"sink": {
											"name": "receipt",
											"type": "Int32",
											"physicalType": "Int32"
										}
									},
									{
										"source": {
											"name": "warranty",
											"type": "Int32",
											"physicalType": "int"
										},
										"sink": {
											"name": "warranty",
											"type": "Int32",
											"physicalType": "Int32"
										}
									},
									{
										"source": {
											"name": "p_card",
											"type": "Int32",
											"physicalType": "int"
										},
										"sink": {
											"name": "p_card",
											"type": "Int32",
											"physicalType": "Int32"
										}
									},
									{
										"source": {
											"name": "quote",
											"type": "Int32",
											"physicalType": "int"
										},
										"sink": {
											"name": "quote",
											"type": "Int32",
											"physicalType": "Int32"
										}
									},
									{
										"source": {
											"name": "notes_posted",
											"type": "Int32",
											"physicalType": "int"
										},
										"sink": {
											"name": "notes_posted",
											"type": "Int32",
											"physicalType": "Int32"
										}
									},
									{
										"source": {
											"name": "status_updates",
											"type": "Int32",
											"physicalType": "int"
										},
										"sink": {
											"name": "status_updates",
											"type": "Int32",
											"physicalType": "Int32"
										}
									},
									{
										"source": {
											"name": "call_out_adds",
											"type": "Int32",
											"physicalType": "int"
										},
										"sink": {
											"name": "call_out_adds",
											"type": "Int32",
											"physicalType": "Int32"
										}
									}
								],
								"typeConversion": true,
								"typeConversionSettings": {
									"allowDataTruncation": true,
									"treatBooleanAsNumber": false
								}
							}
						},
						"inputs": [
							{
								"referenceName": "Briggs_MST",
								"type": "DatasetReference",
								"parameters": {}
							}
						],
						"outputs": [
							{
								"referenceName": "Briggs_MDW",
								"type": "DatasetReference",
								"parameters": {
									"schema_name": "Briggs",
									"table_name": "Stage_Tech_Mobility_Metrics"
								}
							}
						]
					},
					{
						"name": "lkp_ExecStartAuditProc",
						"type": "Lookup",
						"dependsOn": [],
						"policy": {
							"timeout": "7.00:00:00",
							"retry": 0,
							"retryIntervalInSeconds": 30,
							"secureOutput": false,
							"secureInput": false
						},
						"userProperties": [],
						"typeProperties": {
							"source": {
								"type": "AzureSqlSource",
								"sqlReaderStoredProcedureName": "[dbo].[proc_StartAuditLog]",
								"storedProcedureParameters": {
									"ConfigTableID": {
										"type": "Int32",
										"value": "-1"
									},
									"DataFactoryName": {
										"type": "String",
										"value": {
											"value": "@pipeline().DataFactory",
											"type": "Expression"
										}
									},
									"ParentAuditID": {
										"type": "Int64",
										"value": "-1"
									},
									"PipelineName": {
										"type": "String",
										"value": {
											"value": "@pipeline().Pipeline",
											"type": "Expression"
										}
									},
									"PipelineRunID": {
										"type": "String",
										"value": {
											"value": "@pipeline().RunId",
											"type": "Expression"
										}
									},
									"PipelineTriggerID": {
										"type": "String",
										"value": {
											"value": "@pipeline().TriggerId",
											"type": "Expression"
										}
									},
									"PipelineTriggerName": {
										"type": "String",
										"value": {
											"value": "@pipeline().TriggerName",
											"type": "Expression"
										}
									},
									"PipelineTriggerType": {
										"type": "String",
										"value": {
											"value": "@pipeline().TriggerType",
											"type": "Expression"
										}
									}
								},
								"queryTimeout": "02:00:00",
								"partitionOption": "None"
							},
							"dataset": {
								"referenceName": "Briggs_MDW",
								"type": "DatasetReference",
								"parameters": {
									"schema_name": "dbo",
									"table_name": "user"
								}
							}
						}
					},
					{
						"name": "Sp_ExecFailureAudit_Fact",
						"type": "SqlServerStoredProcedure",
						"dependsOn": [
							{
								"activity": "ForEach_Fact",
								"dependencyConditions": [
									"Failed"
								]
							}
						],
						"policy": {
							"timeout": "7.00:00:00",
							"retry": 0,
							"retryIntervalInSeconds": 30,
							"secureOutput": false,
							"secureInput": false
						},
						"userProperties": [],
						"typeProperties": {
							"storedProcedureName": "[dbo].[proc_UpdateAuditLog]",
							"storedProcedureParameters": {
								"AuditID": {
									"value": {
										"value": "@activity('lkp_ExecStartAuditProc').output.firstRow.AuditID",
										"type": "Expression"
									},
									"type": "Int32"
								},
								"DataLakePath": {
									"value": null,
									"type": "String"
								},
								"PipelineRunID": {
									"value": {
										"value": "@pipeline().RunId",
										"type": "Expression"
									},
									"type": "String"
								},
								"RowsRead": {
									"value": null,
									"type": "Int64"
								},
								"Status": {
									"value": "Fact Proc Failed",
									"type": "String"
								}
							}
						},
						"linkedServiceName": {
							"referenceName": "AzureSqlDatabase1",
							"type": "LinkedServiceReference"
						}
					},
					{
						"name": "Sp_ExecSuccessAudit",
						"type": "SqlServerStoredProcedure",
						"dependsOn": [
							{
								"activity": "ForEach_Fact",
								"dependencyConditions": [
									"Succeeded"
								]
							}
						],
						"policy": {
							"timeout": "7.00:00:00",
							"retry": 0,
							"retryIntervalInSeconds": 30,
							"secureOutput": false,
							"secureInput": false
						},
						"userProperties": [],
						"typeProperties": {
							"storedProcedureName": "[dbo].[proc_UpdateAuditLog]",
							"storedProcedureParameters": {
								"AuditID": {
									"value": {
										"value": "@activity('lkp_ExecStartAuditProc').output.firstRow.AuditID",
										"type": "Expression"
									},
									"type": "Int32"
								},
								"DataLakePath": {
									"value": null,
									"type": "String"
								},
								"RowsRead": {
									"value": null,
									"type": "Int64"
								},
								"Status": {
									"value": "Success",
									"type": "String"
								},
								"PipelineRunID": {
									"value": {
										"value": "@pipeline().RunId",
										"type": "Expression"
									},
									"type": "String"
								}
							}
						},
						"linkedServiceName": {
							"referenceName": "AzureSqlDatabase1",
							"type": "LinkedServiceReference"
						}
					},
					{
						"name": "Sp_ExecFailureAudit_Stage",
						"type": "SqlServerStoredProcedure",
						"dependsOn": [
							{
								"activity": "ForEach_Stage",
								"dependencyConditions": [
									"Failed"
								]
							}
						],
						"policy": {
							"timeout": "7.00:00:00",
							"retry": 0,
							"retryIntervalInSeconds": 30,
							"secureOutput": false,
							"secureInput": false
						},
						"userProperties": [],
						"typeProperties": {
							"storedProcedureName": "[dbo].[proc_UpdateAuditLog]",
							"storedProcedureParameters": {
								"AuditID": {
									"value": {
										"value": "@activity('lkp_ExecStartAuditProc').output.firstRow.AuditID",
										"type": "Expression"
									},
									"type": "Int32"
								},
								"DataLakePath": {
									"value": null,
									"type": "String"
								},
								"PipelineRunID": {
									"value": {
										"value": "@pipeline().RunId",
										"type": "Expression"
									},
									"type": "String"
								},
								"RowsRead": {
									"value": null,
									"type": "Int64"
								},
								"Status": {
									"value": "Stage Proc Failed",
									"type": "String"
								}
							}
						},
						"linkedServiceName": {
							"referenceName": "AzureSqlDatabase1",
							"type": "LinkedServiceReference"
						}
					},
					{
						"name": "Sp_ExecFailureAudit_TL",
						"type": "SqlServerStoredProcedure",
						"dependsOn": [
							{
								"activity": "Execute Pipeline1",
								"dependencyConditions": [
									"Failed"
								]
							}
						],
						"policy": {
							"timeout": "7.00:00:00",
							"retry": 0,
							"retryIntervalInSeconds": 30,
							"secureOutput": false,
							"secureInput": false
						},
						"userProperties": [],
						"typeProperties": {
							"storedProcedureName": "[dbo].[proc_UpdateAuditLog]",
							"storedProcedureParameters": {
								"AuditID": {
									"value": {
										"value": "@activity('lkp_ExecStartAuditProc').output.firstRow.AuditID",
										"type": "Expression"
									},
									"type": "Int32"
								},
								"DataLakePath": {
									"value": null,
									"type": "String"
								},
								"PipelineRunID": {
									"value": {
										"value": "@pipeline().RunId",
										"type": "Expression"
									},
									"type": "String"
								},
								"RowsRead": {
									"value": null,
									"type": "Int64"
								},
								"Status": {
									"value": "Table Load Failed",
									"type": "String"
								}
							}
						},
						"linkedServiceName": {
							"referenceName": "AzureSqlDatabase1",
							"type": "LinkedServiceReference"
						}
					}
				],
				"policy": {
					"elapsedTimeMetric": {},
					"cancelAfter": {}
				},
				"variables": {
					"ErrorMsg": {
						"type": "String"
					}
				},
				"folder": {
					"name": "Briggs Data Load Theme wise"
				},
				"annotations": [],
				"lastPublishTime": "2022-04-28T04:31:13Z"
			},
			"dependsOn": [
				"[concat(variables('workspaceId'), '/pipelines/PL_Generic_Copy_Tech')]",
				"[concat(variables('workspaceId'), '/datasets/Briggs_MDW')]",
				"[concat(variables('workspaceId'), '/datasets/Briggs_MST')]",
				"[concat(variables('workspaceId'), '/linkedServices/AzureSqlDatabase1')]",
				"[concat(variables('workspaceId'), '/linkedServices/DS_MDW_SP')]"
			]
		},
		{
			"name": "[concat(parameters('workspaceName'), '/PL_Master_Dimension_Load')]",
			"type": "Microsoft.Synapse/workspaces/pipelines",
			"apiVersion": "2019-06-01-preview",
			"properties": {
				"activities": [
					{
						"name": "PL_Load_Dimension_Stage_Tables",
						"type": "ExecutePipeline",
						"dependsOn": [],
						"userProperties": [],
						"typeProperties": {
							"pipeline": {
								"referenceName": "PL_Load_Dimension_Stage_Tables",
								"type": "PipelineReference"
							},
							"waitOnCompletion": true,
							"parameters": {}
						}
					},
					{
						"name": "DimensionProc",
						"type": "Lookup",
						"dependsOn": [
							{
								"activity": "PL_Load_Dimension_Stage_Tables",
								"dependencyConditions": [
									"Succeeded"
								]
							}
						],
						"policy": {
							"timeout": "7.00:00:00",
							"retry": 0,
							"retryIntervalInSeconds": 30,
							"secureOutput": false,
							"secureInput": false
						},
						"userProperties": [],
						"typeProperties": {
							"source": {
								"type": "AzureSqlSource",
								"sqlReaderQuery": "select sourcetablename from dbo.control_table where processsequence=3 and enableaction=1",
								"queryTimeout": "02:00:00",
								"partitionOption": "None"
							},
							"dataset": {
								"referenceName": "Briggs_MDW",
								"type": "DatasetReference",
								"parameters": {
									"schema_name": "dbo",
									"table_name": "user"
								}
							},
							"firstRowOnly": false
						}
					},
					{
						"name": "ForEach1",
						"type": "ForEach",
						"dependsOn": [
							{
								"activity": "DimensionProc",
								"dependencyConditions": [
									"Succeeded"
								]
							}
						],
						"userProperties": [],
						"typeProperties": {
							"items": {
								"value": "@activity('DimensionProc').output.value",
								"type": "Expression"
							},
							"activities": [
								{
									"name": "Stored procedure1",
									"type": "SqlServerStoredProcedure",
									"dependsOn": [],
									"policy": {
										"timeout": "7.00:00:00",
										"retry": 0,
										"retryIntervalInSeconds": 30,
										"secureOutput": false,
										"secureInput": false
									},
									"userProperties": [],
									"typeProperties": {
										"storedProcedureName": {
											"value": "@item().sourcetablename",
											"type": "Expression"
										}
									},
									"linkedServiceName": {
										"referenceName": "DS_MDW_SP",
										"type": "LinkedServiceReference"
									}
								}
							]
						}
					}
				],
				"policy": {
					"elapsedTimeMetric": {},
					"cancelAfter": {}
				},
				"folder": {
					"name": "Briggs Data Load Theme wise"
				},
				"annotations": [],
				"lastPublishTime": "2022-02-17T13:04:47Z"
			},
			"dependsOn": [
				"[concat(variables('workspaceId'), '/pipelines/PL_Load_Dimension_Stage_Tables')]",
				"[concat(variables('workspaceId'), '/datasets/Briggs_MDW')]",
				"[concat(variables('workspaceId'), '/linkedServices/DS_MDW_SP')]"
			]
		},
		{
			"name": "[concat(parameters('workspaceName'), '/PL_Master_Netsuite_Source1')]",
			"type": "Microsoft.Synapse/workspaces/pipelines",
			"apiVersion": "2019-06-01-preview",
			"properties": {
				"activities": [
					{
						"name": "Lookup1",
						"type": "Lookup",
						"dependsOn": [
							{
								"activity": "lkp_ExecStartAuditProc",
								"dependencyConditions": [
									"Succeeded"
								]
							}
						],
						"policy": {
							"timeout": "7.00:00:00",
							"retry": 0,
							"retryIntervalInSeconds": 30,
							"secureOutput": false,
							"secureInput": false
						},
						"userProperties": [],
						"typeProperties": {
							"source": {
								"type": "AzureSqlSource",
								"sqlReaderQuery": "select top 5 * from dbo.control_table_por where sourcedb='Netsuite'  and enableaction=1\nand (last_refresh_date is null or format(last_refresh_date,'dd-MM-yyyy')<>format(getdate(),'dd-MM-yyyy'))\norder by id",
								"queryTimeout": "02:00:00",
								"partitionOption": "None"
							},
							"dataset": {
								"referenceName": "Briggs_MDW",
								"type": "DatasetReference",
								"parameters": {
									"schema_name": "dbo",
									"table_name": "user"
								}
							},
							"firstRowOnly": false
						}
					},
					{
						"name": "Table Load",
						"type": "ForEach",
						"dependsOn": [
							{
								"activity": "Lookup1",
								"dependencyConditions": [
									"Succeeded"
								]
							}
						],
						"userProperties": [],
						"typeProperties": {
							"items": {
								"value": "@activity('Lookup1').output.value",
								"type": "Expression"
							},
							"activities": [
								{
									"name": "Copy data",
									"type": "Copy",
									"dependsOn": [
										{
											"activity": "Start_Table_Audit1",
											"dependencyConditions": [
												"Succeeded"
											]
										}
									],
									"policy": {
										"timeout": "7.00:00:00",
										"retry": 0,
										"retryIntervalInSeconds": 30,
										"secureOutput": false,
										"secureInput": false
									},
									"userProperties": [],
									"typeProperties": {
										"source": {
											"type": "OdbcSource",
											"query": {
												"value": "@activity('Lookup2').output.firstRow.SourceQuery",
												"type": "Expression"
											},
											"queryTimeout": "02:00:00"
										},
										"sink": {
											"type": "AzureSqlSink",
											"preCopyScript": {
												"value": "@{concat('truncate table ',activity('Lookup2').output.firstRow.TargetStageTableSchema,'.',activity('Lookup2').output.firstRow.TargetStageTableName)}",
												"type": "Expression"
											},
											"writeBehavior": "insert",
											"sqlWriterUseTableLock": false,
											"disableMetricsCollection": false
										},
										"enableStaging": false,
										"translator": {
											"type": "TabularTranslator",
											"typeConversion": true,
											"typeConversionSettings": {
												"allowDataTruncation": true,
												"treatBooleanAsNumber": false
											}
										}
									},
									"inputs": [
										{
											"referenceName": "OdbcTable1",
											"type": "DatasetReference",
											"parameters": {}
										}
									],
									"outputs": [
										{
											"referenceName": "Briggs_MDW",
											"type": "DatasetReference",
											"parameters": {
												"schema_name": {
													"value": "@activity('Lookup2').output.firstRow.TargetStageTableSchema",
													"type": "Expression"
												},
												"table_name": {
													"value": "@activity('Lookup2').output.firstRow.TargetStageTableName",
													"type": "Expression"
												}
											}
										}
									]
								},
								{
									"name": "Lookup2",
									"type": "Lookup",
									"dependsOn": [],
									"policy": {
										"timeout": "7.00:00:00",
										"retry": 0,
										"retryIntervalInSeconds": 30,
										"secureOutput": false,
										"secureInput": false
									},
									"userProperties": [],
									"typeProperties": {
										"source": {
											"type": "AzureSqlSource",
											"sqlReaderQuery": {
												"value": "@concat('Select Distinct SourceDB , SourceQuery = ''Select ''+ColumnList+'' From ''+SourceTableName, TargetContainer, TargetPath, TargetFile, FileFormat,TargetStageTableSchema,\tTargetStageTableName\nFrom [dbo].[control_table_por]\nWhere ID = ',item().ID)",
												"type": "Expression"
											},
											"queryTimeout": "02:00:00",
											"partitionOption": "None"
										},
										"dataset": {
											"referenceName": "Briggs_MDW",
											"type": "DatasetReference",
											"parameters": {
												"schema_name": "dbo",
												"table_name": "user"
											}
										},
										"firstRowOnly": true
									}
								},
								{
									"name": "Copy data_New",
									"type": "Copy",
									"dependsOn": [
										{
											"activity": "Copy data",
											"dependencyConditions": [
												"Failed"
											]
										}
									],
									"policy": {
										"timeout": "7.00:00:00",
										"retry": 0,
										"retryIntervalInSeconds": 30,
										"secureOutput": false,
										"secureInput": false
									},
									"userProperties": [],
									"typeProperties": {
										"source": {
											"type": "OdbcSource",
											"query": {
												"value": "@activity('Lookup2').output.firstRow.SourceQuery",
												"type": "Expression"
											},
											"queryTimeout": "02:00:00"
										},
										"sink": {
											"type": "AzureSqlSink",
											"writeBehavior": "insert",
											"sqlWriterUseTableLock": false,
											"tableOption": "autoCreate",
											"disableMetricsCollection": false
										},
										"enableStaging": false,
										"translator": {
											"type": "TabularTranslator",
											"typeConversion": true,
											"typeConversionSettings": {
												"allowDataTruncation": true,
												"treatBooleanAsNumber": false
											}
										}
									},
									"inputs": [
										{
											"referenceName": "OdbcTable1",
											"type": "DatasetReference",
											"parameters": {}
										}
									],
									"outputs": [
										{
											"referenceName": "Briggs_MDW",
											"type": "DatasetReference",
											"parameters": {
												"schema_name": {
													"value": "@activity('Lookup2').output.firstRow.TargetStageTableSchema",
													"type": "Expression"
												},
												"table_name": {
													"value": "@activity('Lookup2').output.firstRow.TargetStageTableName",
													"type": "Expression"
												}
											}
										}
									]
								},
								{
									"name": "Start_Table_Audit1",
									"type": "Lookup",
									"dependsOn": [
										{
											"activity": "Lookup2",
											"dependencyConditions": [
												"Succeeded"
											]
										}
									],
									"policy": {
										"timeout": "7.00:00:00",
										"retry": 0,
										"retryIntervalInSeconds": 30,
										"secureOutput": false,
										"secureInput": false
									},
									"userProperties": [],
									"typeProperties": {
										"source": {
											"type": "AzureSqlSource",
											"sqlReaderStoredProcedureName": "[dbo].[proc_UpdateAuditLog_Briggs]",
											"storedProcedureParameters": {
												"ConfigTableID": {
													"type": "Int32",
													"value": {
														"value": "@item().ID",
														"type": "Expression"
													}
												},
												"DataFactoryName": {
													"type": "String",
													"value": {
														"value": "@pipeline().DataFactory",
														"type": "Expression"
													}
												},
												"ParentAuditID": {
													"type": "Int64",
													"value": {
														"value": "@item().ID",
														"type": "Expression"
													}
												},
												"PipelineName": {
													"type": "String",
													"value": {
														"value": "@pipeline().Pipeline",
														"type": "Expression"
													}
												},
												"PipelineRunID": {
													"type": "String",
													"value": {
														"value": "@pipeline().RunId",
														"type": "Expression"
													}
												},
												"PipelineTriggerID": {
													"type": "String",
													"value": {
														"value": "@pipeline().TriggerId",
														"type": "Expression"
													}
												},
												"PipelineTriggerName": {
													"type": "String",
													"value": {
														"value": "@pipeline().TriggerName",
														"type": "Expression"
													}
												},
												"PipelineTriggerType": {
													"type": "String",
													"value": {
														"value": "@pipeline().TriggerType",
														"type": "Expression"
													}
												},
												"Sourcedb": {
													"type": "String",
													"value": {
														"value": "@item().sourceDB",
														"type": "Expression"
													}
												},
												"sourcetable": {
													"type": "String",
													"value": {
														"value": "@item().SourcetableName",
														"type": "Expression"
													}
												}
											},
											"queryTimeout": "02:00:00",
											"partitionOption": "None"
										},
										"dataset": {
											"referenceName": "Briggs_MDW",
											"type": "DatasetReference",
											"parameters": {
												"schema_name": "dbo",
												"table_name": "user"
											}
										},
										"firstRowOnly": false
									}
								},
								{
									"name": "Success_Audit_Log1",
									"type": "SqlServerStoredProcedure",
									"dependsOn": [
										{
											"activity": "Copy data",
											"dependencyConditions": [
												"Succeeded"
											]
										}
									],
									"policy": {
										"timeout": "7.00:00:00",
										"retry": 0,
										"retryIntervalInSeconds": 30,
										"secureOutput": false,
										"secureInput": false
									},
									"userProperties": [],
									"typeProperties": {
										"storedProcedureName": "[dbo].[proc_UpdateAuditLog_Briggs]",
										"storedProcedureParameters": {
											"ConfigTableID": {
												"value": {
													"value": "@item().ID",
													"type": "Expression"
												},
												"type": "Int32"
											},
											"RowsRead": {
												"value": {
													"value": "@activity('Copy data').output.RowsRead",
													"type": "Expression"
												},
												"type": "Int64"
											},
											"Status": {
												"value": "Success",
												"type": "String"
											}
										}
									},
									"linkedServiceName": {
										"referenceName": "DS_MDW_SP",
										"type": "LinkedServiceReference"
									}
								},
								{
									"name": "Success_Audit_Log2",
									"type": "SqlServerStoredProcedure",
									"dependsOn": [
										{
											"activity": "Copy data_New",
											"dependencyConditions": [
												"Succeeded"
											]
										}
									],
									"policy": {
										"timeout": "7.00:00:00",
										"retry": 0,
										"retryIntervalInSeconds": 30,
										"secureOutput": false,
										"secureInput": false
									},
									"userProperties": [],
									"typeProperties": {
										"storedProcedureName": "[dbo].[proc_UpdateAuditLog_Briggs]",
										"storedProcedureParameters": {
											"ConfigTableID": {
												"value": {
													"value": "@item().ID",
													"type": "Expression"
												},
												"type": "Int32"
											},
											"RowsRead": {
												"value": {
													"value": "@activity('Copy data_New').output.RowsRead",
													"type": "Expression"
												},
												"type": "Int64"
											},
											"Status": {
												"value": "Success",
												"type": "String"
											}
										}
									},
									"linkedServiceName": {
										"referenceName": "DS_MDW_SP",
										"type": "LinkedServiceReference"
									}
								},
								{
									"name": "Failure_Audit_Log2",
									"type": "SqlServerStoredProcedure",
									"dependsOn": [
										{
											"activity": "Set variable1",
											"dependencyConditions": [
												"Succeeded"
											]
										}
									],
									"policy": {
										"timeout": "7.00:00:00",
										"retry": 0,
										"retryIntervalInSeconds": 30,
										"secureOutput": false,
										"secureInput": false
									},
									"userProperties": [],
									"typeProperties": {
										"storedProcedureName": "[dbo].[proc_UpdateAuditLog_Briggs]",
										"storedProcedureParameters": {
											"ConfigTableID": {
												"value": {
													"value": "@item().ID",
													"type": "Expression"
												},
												"type": "Int32"
											},
											"RowsRead": {
												"value": null,
												"type": "Int64"
											},
											"Status": {
												"value": {
													"value": "@variables('ErrorMsg')",
													"type": "Expression"
												},
												"type": "String"
											}
										}
									},
									"linkedServiceName": {
										"referenceName": "DS_MDW_SP",
										"type": "LinkedServiceReference"
									}
								},
								{
									"name": "Set variable1",
									"type": "SetVariable",
									"dependsOn": [
										{
											"activity": "Copy data",
											"dependencyConditions": [
												"Failed"
											]
										},
										{
											"activity": "Copy data_New",
											"dependencyConditions": [
												"Failed"
											]
										}
									],
									"userProperties": [],
									"typeProperties": {
										"variableName": "ErrorMsg",
										"value": {
											"value": "@activity('Copy data_New').Error.Message",
											"type": "Expression"
										}
									}
								}
							]
						}
					},
					{
						"name": "lkp_ExecStartAuditProc",
						"type": "Lookup",
						"dependsOn": [],
						"policy": {
							"timeout": "7.00:00:00",
							"retry": 0,
							"retryIntervalInSeconds": 30,
							"secureOutput": false,
							"secureInput": false
						},
						"userProperties": [],
						"typeProperties": {
							"source": {
								"type": "AzureSqlSource",
								"sqlReaderStoredProcedureName": "[dbo].[proc_StartAuditLog]",
								"storedProcedureParameters": {
									"ConfigTableID": {
										"type": "Int32",
										"value": "-1"
									},
									"DataFactoryName": {
										"type": "String",
										"value": {
											"value": "@pipeline().DataFactory",
											"type": "Expression"
										}
									},
									"ParentAuditID": {
										"type": "Int64",
										"value": "-1"
									},
									"PipelineName": {
										"type": "String",
										"value": {
											"value": "@concat(pipeline().Pipeline,' Billing Source Table Load')",
											"type": "Expression"
										}
									},
									"PipelineRunID": {
										"type": "String",
										"value": {
											"value": "@pipeline().RunId",
											"type": "Expression"
										}
									},
									"PipelineTriggerID": {
										"type": "String",
										"value": {
											"value": "@pipeline().TriggerId",
											"type": "Expression"
										}
									},
									"PipelineTriggerName": {
										"type": "String",
										"value": {
											"value": "@pipeline().TriggerName",
											"type": "Expression"
										}
									},
									"PipelineTriggerType": {
										"type": "String",
										"value": {
											"value": "@pipeline().TriggerType",
											"type": "Expression"
										}
									}
								},
								"queryTimeout": "02:00:00",
								"partitionOption": "None"
							},
							"dataset": {
								"referenceName": "Briggs_MDW",
								"type": "DatasetReference",
								"parameters": {
									"schema_name": "dbo",
									"table_name": "user"
								}
							}
						}
					},
					{
						"name": "Sp_ExecSuccessAudit",
						"type": "SqlServerStoredProcedure",
						"dependsOn": [
							{
								"activity": "Table Load",
								"dependencyConditions": [
									"Succeeded"
								]
							}
						],
						"policy": {
							"timeout": "7.00:00:00",
							"retry": 0,
							"retryIntervalInSeconds": 30,
							"secureOutput": false,
							"secureInput": false
						},
						"userProperties": [],
						"typeProperties": {
							"storedProcedureName": "[dbo].[proc_UpdateAuditLog]",
							"storedProcedureParameters": {
								"AuditID": {
									"value": {
										"value": "@activity('lkp_ExecStartAuditProc').output.firstRow.AuditID",
										"type": "Expression"
									},
									"type": "Int32"
								},
								"DataLakePath": {
									"value": null,
									"type": "String"
								},
								"RowsRead": {
									"value": null,
									"type": "Int64"
								},
								"Status": {
									"value": "Success",
									"type": "String"
								},
								"PipelineRunID": {
									"value": {
										"value": "@pipeline().RunId",
										"type": "Expression"
									},
									"type": "String"
								}
							}
						},
						"linkedServiceName": {
							"referenceName": "AzureSqlDatabase1",
							"type": "LinkedServiceReference"
						}
					},
					{
						"name": "Sp_ExecFailureAudit",
						"type": "SqlServerStoredProcedure",
						"dependsOn": [
							{
								"activity": "Table Load",
								"dependencyConditions": [
									"Failed"
								]
							}
						],
						"policy": {
							"timeout": "7.00:00:00",
							"retry": 0,
							"retryIntervalInSeconds": 30,
							"secureOutput": false,
							"secureInput": false
						},
						"userProperties": [],
						"typeProperties": {
							"storedProcedureName": "[dbo].[proc_UpdateAuditLog]",
							"storedProcedureParameters": {
								"AuditID": {
									"value": {
										"value": "@activity('lkp_ExecStartAuditProc').output.firstRow.AuditID",
										"type": "Expression"
									},
									"type": "Int32"
								},
								"DataLakePath": {
									"value": null,
									"type": "String"
								},
								"PipelineRunID": {
									"value": {
										"value": "@pipeline().RunId",
										"type": "Expression"
									},
									"type": "String"
								},
								"RowsRead": {
									"value": null,
									"type": "Int64"
								},
								"Status": {
									"value": "Table Load Failed",
									"type": "String"
								}
							}
						},
						"linkedServiceName": {
							"referenceName": "AzureSqlDatabase1",
							"type": "LinkedServiceReference"
						}
					}
				],
				"policy": {
					"elapsedTimeMetric": {},
					"cancelAfter": {}
				},
				"variables": {
					"ErrorMsg": {
						"type": "String"
					}
				},
				"folder": {
					"name": "Netsuite"
				},
				"annotations": [],
				"lastPublishTime": "2022-04-29T07:50:01Z"
			},
			"dependsOn": [
				"[concat(variables('workspaceId'), '/datasets/Briggs_MDW')]",
				"[concat(variables('workspaceId'), '/linkedServices/AzureSqlDatabase1')]",
				"[concat(variables('workspaceId'), '/datasets/OdbcTable1')]",
				"[concat(variables('workspaceId'), '/linkedServices/DS_MDW_SP')]"
			]
		},
		{
			"name": "[concat(parameters('workspaceName'), '/PL_POR_EXECUTIVE_STAGE_TABLES_LOAD')]",
			"type": "Microsoft.Synapse/workspaces/pipelines",
			"apiVersion": "2019-06-01-preview",
			"properties": {
				"activities": [
					{
						"name": "EXECUTIVE_DASHBOARD_STAGE",
						"type": "Copy",
						"dependsOn": [],
						"policy": {
							"timeout": "7.00:00:00",
							"retry": 0,
							"retryIntervalInSeconds": 30,
							"secureOutput": false,
							"secureInput": false
						},
						"userProperties": [],
						"typeProperties": {
							"source": {
								"type": "SqlServerSource",
								"sqlReaderQuery": "with [BI_VW_Items_SerializedFleet_CTE] as  (SELECT\nITF.BoughtUsed\n,ITF.[Qty]\n,ItemQty.DDT\n,ItemQty.Trans_Date\n, ItemQty.TypeName\n,CustomerType,[Customer Number],[Contract No],[Contract Date]\n,ItemQty.[KEY]\n,ItemQty.[TXTY]\n,ItemQty.TransContract\n, ItemQty.[OnRent]\n, ItemQty.[OffRent]\n, ItemQty.[IRO]\n, ItemQty.[IMO]\n, ItemQty.[ISO]\n, iif(ITF.QTY - (ItemQty.[OnRent] + ItemQty.[OffRent] + ItemQty.[IRO]) is null, ITF.Qty, ITF.QTY - (ItemQty.[OnRent] + ItemQty.[OffRent] + ItemQty.[IRO])) AS [Ready]\n, ITF.[KEY] AS [ItemKey]\n, ITF.[Name] AS [ItemName]\n, ITF.[Qty] AS [ItemQty]\n, ITF.[QYOT] AS [QtyOut]\n, ITF.[Type] AS [ItemType]\n, ITF.[Num] AS [ItemNum]\n, ITF.[CNTR] AS [ItemCntr]\n, ITF.[PURP] AS [ItemPurp]\n, ITF.[CurrentStore]\n, ITF.[HomeStore]\n, ITF.[Header] AS [ItemHeader]\n, ITF.[ReplacementCost] AS [ItemReplaceCost]\n, ITF.[BulkItem]\n, ITF.[Inactive]\n, ITF_h.[KEY] AS [HeaderKey]\n, ITF_h.[Name] AS [HeaderName]\n, ITF_h.[Num] AS [HeaderNum]\n, ITF_h.[ReplacementCost] AS [HeaderReplaceCost]\n, PF.[STORE_NAME] AS [CurrentStoreName]\n, ITC.[Name] AS [CategoryName]\n, ITF.[Category] AS [CategoryNumber]\n, ITD.[DivisionName]\n, ITC.[DivisionNumber] as [DivisionNumber]\n, ITF_OEC.OEC AS [OEC]\n\nFROM (((((ItemFile ITF\nLEFT JOIN ItemFile AS ITF_h ON ITF.[Header] = ITF_h.[KEY])\nLEFT JOIN ParameterFile PF ON ITF.[CurrentStore] = PF.[Store])\nLEFT JOIN ItemCategory ITC ON ITF.[Category] = ITC.[Category])\nLEFT JOIN ItemDivision ITD on ITC.[DivisionNumber] = ITD.[DivisionNumber])\nLEFT JOIN (\n\nSELECT  CASE WHEN t.PYMT = 'E' THEN 'Account' ELSE 'Cash' END AS CustomerType\n, cf.[CNUM] AS [Customer Number]\n, cf.[Name] AS [Customer Name]\n, t.[CNTR] AS [Contract No]\n, t.[DATE] AS [Contract Date]\n,TI.[TXTY]\n,TI.[ITEM],TI.DDT,T.[Date] as Trans_Date,ItemType.TypeDescrip as TypeName,CF.[KEY],T.CNTR AS TransContract,\nsum(iif(Left(TI.[CNTR],1)<>'r' and (not(TI.[TXTY] In ('RR','RX')) or TI.[TXTY] = 'RH' and TI.[DDT] > getdate()),[TI].[Qty],0)) AS OnRent,\nsum(iif(Left(TI.[CNTR],1)<>'r' and TI.[TXTY] = 'RH' and TI.[DDT] <= getdate(),[TI].[Qty],0)) AS OffRent,\nsum(iif(Left(TI.[CNTR],1)='r' and Not(TI.[TXTY] In ('RR','RX')),[TI].[Qty],0)) AS IRO,\nsum(iif(Left(TI.[CNTR],1)='r' and TI.[TXTY] In ('RR','RX'),[TI].[Qty],0)) AS IMO,\nsum(iif(cf.[KEY] LIKE 'REPAIRS-SERV%' and TI.SUBF = 1,TI.Qty,0)) AS ISO\nFROM ((TransactionItems TI\nINNER JOIN Transactions T ON TI.[CNTR] = T.[CNTR])\nINNER JOIN ItemFile ITF ON TI.[Item] = ITF.[Num]\nLEFT JOIN ItemType  ON ITF.TYPE = ItemType.Type)\nINNER JOIN CustomerFile CF ON T.[CUSN] = CF.[CNUM]\nWHERE Left(TI.[CNTR],1) Not In ('c','f','l','q','t','w') AND\nLeft(TI.[TXTY],1) = 'R' and\nLeft(T.[STAT],1) = 'O' and\nITF.Qty < 99000\nGROUP BY TI.[ITEM],TI.DDT,ItemType.TypeDescrip,CF.[CNUM],T.CNTR,T.[Date], \nt.PYMT \n, cf.[Key]\n, cf.[Name]\n, t.[CNTR]\n, t.[DATE] \n,TI.[TXTY]\n) AS ItemQty ON ITF.[Num] = ItemQty.[Item])\nLEFT JOIN (SELECT [ItemNumber] ,sum(([QuantityPurchased] - [QuantitySold]) * ([PriceEach] + [ExtraCharges])) AS OEC\nFROM [ItemPurchaseDetail]\nWHERE [Disposed] = 0\nGROUP BY [ItemNumber]) AS ITF_OEC ON ITF.[NUM] = ITF_OEC.[ItemNumber]\nWHERE not(ITF.[TYPE] in ('b','e','f','i','k','m','n','o','p','s','v','w'))\nAND ITF.Qty < 90000)\n\n\n-- select top 10 * from TransactionItems\n\n, final as (\nSELECT \nDDT,\nTrans_Date,\nitemkey\n,ItemName\n,CurrentStore\n,CurrentStoreName\n,CategoryName\n,CASE WHEN left(TypeName,5) = 'Sales' then '' \nWHEN [KEY] like 'Repairs-Maint' then '  *In Maint'\nWHEN trim(TransContract) = '' or (TransContract) IS NULL then '  Ready to Rent'\nWHEN left(TransContract,1) = 'r' then '  *In Repair'\nWHEN left(TransContract,1) = 't' then '  *In Transfer'\nELSE '  *On Rent' END AS [Status]\n\n\n,sum(OEC) as OEC\n,sum(OnRent) as OnRent\n, SUM(Ready * OEC) AS [AvailableOEC]\n, SUM(IRO * OEC) AS [InRepairOEC]\n, SUM(OffRent * OEC) AS [OffRentOEC]\n, SUM(OnRent * OEC) AS [OnRentOEC]\n, SUM(ItemQty * OEC) AS [TotalQtyOEC]\n, SUM(Ready) AS [AvailableQty]\n, SUM(IRO) AS [InRepairQty]\n, SUM(OffRent) AS [OffRentQty]\n, SUM(OnRent) AS [OnRentQty]\n, SUM(ItemQty) AS TotalItemQty\n,sum( case when VW.BoughtUsed = 0 then (Ready * OEC) else 0 end ) as New_Equipment\n,sum( case when VW.BoughtUsed = 1 then (Ready * OEC) else 0 end ) as Used_Equipment\n,getdate() AS [Snapshot_Date]\n,CustomerType,[Customer Number],[Contract No],[Contract Date]\n,[TXTY]\nFROM\n[BI_VW_Items_SerializedFleet_CTE] AS VW \nLEFT OUTER JOIN [ItemFile_TR] AS ITF_TR ON VW.[ItemNum] = ITF_TR.[NUM] AND ITF_TR.[Inactive] = 0\nLEFT OUTER JOIN [ItemCategory_TR] ITC_TR ON VW.[CategoryNumber] = ITC_TR.[Category] AND ITC_TR.[Inactive] = 0 \nLEFT OUTER JOIN [ItemDivision_TR] ITD_TR on VW.[DivisionNumber] = ITD_TR.[DivisionNumber] AND ITD_TR.[Inactive] = 0 \nWHERE\nVW.[Inactive] = 0 AND VW.[BulkItem] = 0\n--and CurrentStore=106\ngroup by DDT,itemkey,Trans_Date\n,ItemName\n,CurrentStore\n,CurrentStoreName\n,CategoryName,CustomerType,[Customer Number],[Contract No],[Contract Date]\n,CASE WHEN left(TypeName,5) = 'Sales' then '' \nWHEN [KEY] like 'Repairs-Maint' then '  *In Maint'\nWHEN trim(TransContract) = '' or (TransContract) IS NULL then '  Ready to Rent'\nWHEN left(TransContract,1) = 'r' then '  *In Repair'\nWHEN left(TransContract,1) = 't' then '  *In Transfer'\nELSE '  *On Rent' END\n,[TXTY]\n)\n\nselect  * from final",
								"queryTimeout": "02:00:00",
								"partitionOption": "None"
							},
							"sink": {
								"type": "AzureSqlSink",
								"preCopyScript": "delete from [POR].[Executive_Dashboard_Stage] where snapshot_date = cast(getdate() as date);",
								"writeBehavior": "insert",
								"sqlWriterUseTableLock": false,
								"tableOption": "autoCreate",
								"disableMetricsCollection": false
							},
							"enableStaging": false,
							"translator": {
								"type": "TabularTranslator",
								"mappings": [
									{
										"source": {
											"name": "DDT",
											"type": "DateTime",
											"physicalType": "datetime"
										},
										"sink": {
											"name": "DDT",
											"type": "DateTime",
											"physicalType": "datetime"
										}
									},
									{
										"source": {
											"name": "itemkey",
											"type": "String",
											"physicalType": "nvarchar"
										},
										"sink": {
											"name": "itemkey",
											"type": "String",
											"physicalType": "nvarchar"
										}
									},
									{
										"source": {
											"name": "ItemName",
											"type": "String",
											"physicalType": "nvarchar"
										},
										"sink": {
											"name": "ItemName",
											"type": "String",
											"physicalType": "nvarchar"
										}
									},
									{
										"source": {
											"name": "CurrentStore",
											"type": "String",
											"physicalType": "nvarchar"
										},
										"sink": {
											"name": "CurrentStore",
											"type": "String",
											"physicalType": "nvarchar"
										}
									},
									{
										"source": {
											"name": "CurrentStoreName",
											"type": "String",
											"physicalType": "nvarchar"
										},
										"sink": {
											"name": "CurrentStoreName",
											"type": "String",
											"physicalType": "nvarchar"
										}
									},
									{
										"source": {
											"name": "CategoryName",
											"type": "String",
											"physicalType": "nvarchar"
										},
										"sink": {
											"name": "CategoryName",
											"type": "String",
											"physicalType": "nvarchar"
										}
									},
									{
										"source": {
											"name": "Status",
											"type": "String",
											"physicalType": "varchar"
										},
										"sink": {
											"name": "Status",
											"type": "String",
											"physicalType": "varchar"
										}
									},
									{
										"source": {
											"name": "OEC",
											"type": "Double",
											"physicalType": "float"
										},
										"sink": {
											"name": "OEC",
											"type": "Double",
											"physicalType": "float"
										}
									},
									{
										"source": {
											"name": "OnRent",
											"type": "Double",
											"physicalType": "float"
										},
										"sink": {
											"name": "OnRent",
											"type": "Double",
											"physicalType": "float"
										}
									},
									{
										"source": {
											"name": "AvailableOEC",
											"type": "Double",
											"physicalType": "float"
										},
										"sink": {
											"name": "AvailableOEC",
											"type": "Double",
											"physicalType": "float"
										}
									},
									{
										"source": {
											"name": "InRepairOEC",
											"type": "Double",
											"physicalType": "float"
										},
										"sink": {
											"name": "InRepairOEC",
											"type": "Double",
											"physicalType": "float"
										}
									},
									{
										"source": {
											"name": "OffRentOEC",
											"type": "Double",
											"physicalType": "float"
										},
										"sink": {
											"name": "OffRentOEC",
											"type": "Double",
											"physicalType": "float"
										}
									},
									{
										"source": {
											"name": "OnRentOEC",
											"type": "Double",
											"physicalType": "float"
										},
										"sink": {
											"name": "OnRentOEC",
											"type": "Double",
											"physicalType": "float"
										}
									},
									{
										"source": {
											"name": "TotalQtyOEC",
											"type": "Double",
											"physicalType": "float"
										},
										"sink": {
											"name": "TotalQtyOEC",
											"type": "Double",
											"physicalType": "float"
										}
									},
									{
										"source": {
											"name": "AvailableQty",
											"type": "Double",
											"physicalType": "float"
										},
										"sink": {
											"name": "AvailableQty",
											"type": "Double",
											"physicalType": "float"
										}
									},
									{
										"source": {
											"name": "InRepairQty",
											"type": "Double",
											"physicalType": "float"
										},
										"sink": {
											"name": "InRepairQty",
											"type": "Double",
											"physicalType": "float"
										}
									},
									{
										"source": {
											"name": "OffRentQty",
											"type": "Double",
											"physicalType": "float"
										},
										"sink": {
											"name": "OffRentQty",
											"type": "Double",
											"physicalType": "float"
										}
									},
									{
										"source": {
											"name": "OnRentQty",
											"type": "Double",
											"physicalType": "float"
										},
										"sink": {
											"name": "OnRentQty",
											"type": "Double",
											"physicalType": "float"
										}
									},
									{
										"source": {
											"name": "TotalItemQty",
											"type": "Double",
											"physicalType": "float"
										},
										"sink": {
											"name": "TotalItemQty",
											"type": "Double",
											"physicalType": "float"
										}
									},
									{
										"source": {
											"name": "New_Equipment",
											"type": "Double",
											"physicalType": "float"
										},
										"sink": {
											"name": "New_Equipment",
											"type": "Double",
											"physicalType": "float"
										}
									},
									{
										"source": {
											"name": "Used_Equipment",
											"type": "Double",
											"physicalType": "float"
										},
										"sink": {
											"name": "Used_Equipment",
											"type": "Double",
											"physicalType": "float"
										}
									},
									{
										"source": {
											"name": "Snapshot_Date",
											"type": "DateTime",
											"physicalType": "datetime"
										},
										"sink": {
											"name": "Snapshot_Date",
											"type": "DateTime",
											"physicalType": "date"
										}
									},
									{
										"source": {
											"name": "Trans_Date",
											"type": "DateTime",
											"physicalType": "datetime"
										},
										"sink": {
											"name": "Trans_Date",
											"type": "DateTime",
											"physicalType": "datetime"
										}
									},
									{
										"source": {
											"name": "CustomerType",
											"type": "String",
											"physicalType": "varchar"
										},
										"sink": {
											"name": "CustomerType",
											"type": "String",
											"physicalType": "nvarchar"
										}
									},
									{
										"source": {
											"name": "Customer Number",
											"type": "String",
											"physicalType": "nvarchar"
										},
										"sink": {
											"name": "Customer Number",
											"type": "String",
											"physicalType": "nvarchar"
										}
									},
									{
										"source": {
											"name": "Contract No",
											"type": "String",
											"physicalType": "nvarchar"
										},
										"sink": {
											"name": "Contract No",
											"type": "String",
											"physicalType": "nvarchar"
										}
									},
									{
										"source": {
											"name": "Contract Date",
											"type": "DateTime",
											"physicalType": "datetime"
										},
										"sink": {
											"name": "Contract Date",
											"type": "DateTime",
											"physicalType": "datetime"
										}
									},
									{
										"source": {
											"name": "TXTY",
											"type": "String",
											"physicalType": "nvarchar"
										},
										"sink": {
											"name": "TXTY",
											"type": "String",
											"physicalType": "nvarchar"
										}
									}
								],
								"typeConversion": true,
								"typeConversionSettings": {
									"allowDataTruncation": true,
									"treatBooleanAsNumber": false
								}
							}
						},
						"inputs": [
							{
								"referenceName": "DS_POR",
								"type": "DatasetReference",
								"parameters": {
									"schema_name": "dbo",
									"table_name": "user"
								}
							}
						],
						"outputs": [
							{
								"referenceName": "Briggs_MDW",
								"type": "DatasetReference",
								"parameters": {
									"schema_name": "POR",
									"table_name": "Executive_Dashboard_Stage"
								}
							}
						]
					},
					{
						"name": "EXECUTIVE_DASHBOARD_EQUIPMENT_STAGE",
						"type": "Copy",
						"dependsOn": [
							{
								"activity": "EXECUTIVE_DASHBOARD_STAGE",
								"dependencyConditions": [
									"Succeeded"
								]
							}
						],
						"policy": {
							"timeout": "7.00:00:00",
							"retry": 0,
							"retryIntervalInSeconds": 30,
							"secureOutput": false,
							"secureInput": false
						},
						"userProperties": [],
						"typeProperties": {
							"source": {
								"type": "SqlServerSource",
								"sqlReaderQuery": "SELECT \nstore,cast(tca.[date] as date) as date,\n  ISNULL(SUM(CASE WHEN ti.TXTY = 'SA' AND ifi.Asset = 1 AND (tca.AssetTx <> 0 OR tca.AssetNT <> 0) THEN ti.PRIC  END), '')\n  AS UsedEquipmentRevenue,\n     ISNULL(SUM(CASE WHEN ti.TXTY = 'SA' AND ifi.Asset = 1 AND (tca.AssetTx <> 0 OR tca.AssetNT <> 0) THEN ifi.PURP  END), '')\n  AS UsedEquipmentCost\n  ,\n  ISNULL(SUM(CASE WHEN ti.TXTY = 'SS' AND \nifi.Asset = 0 AND ifi.SerialNumber <> '' AND (tca.SaleTx <> 0 OR tca.SaleNT <> 0) THEN ti.PRIC  END), '')\nAS NewEquipmentRevenue,\n\n ISNULL(SUM(CASE WHEN ti.TXTY = 'SS' AND \nifi.Asset = 0 AND ifi.SerialNumber <> '' AND (tca.SaleTx <> 0 OR tca.SaleNT <> 0) THEN ifi.PURP  END), '')\nAS NewEquipmentCost,\n\nsum(ifi.purp) as Purchase_Price, sum(ifi.curv) as Current_Book_Price\n,CASE WHEN t.PYMT = 'E' THEN 'Account' ELSE 'Cash' END AS CustomerType\n, cf.[CNUM] AS [Customer Number]\n, cf.[Name] AS [Customer Name]\n, t.[CNTR] AS [Contract No]\n, t.[DATE] AS [Contract Date]\n,TI.[TXTY]\nFROM POR.dbo.TotalsContractsAccrual tca\nJOIN POR.dbo.Transactions t ON t.CNTR = tca.CNTR\nJOIN POR.dbo.TransactionItems ti ON ti.CNTR = t.CNTR\nJOIN POR.dbo.ItemFile ifi ON ifi.NUM = ti.ITEM\nINNER JOIN por.dbo.CustomerFile CF ON T.[CUSN] = CF.[CNUM]\ngroup by store,cast(tca.[date] as date)  \n,CASE WHEN t.PYMT = 'E' THEN 'Account' ELSE 'Cash' END \n, cf.[CNUM]\n, cf.[Name]\n, t.[CNTR]\n, t.[DATE] \n,TI.[TXTY]",
								"queryTimeout": "02:00:00",
								"partitionOption": "None"
							},
							"sink": {
								"type": "AzureSqlSink",
								"preCopyScript": "truncate table [POR].[Executive_Dashboard_Equipment_Stage];",
								"writeBehavior": "insert",
								"sqlWriterUseTableLock": false,
								"disableMetricsCollection": false
							},
							"enableStaging": false,
							"translator": {
								"type": "TabularTranslator",
								"mappings": [
									{
										"source": {
											"name": "store",
											"type": "String",
											"physicalType": "nvarchar"
										},
										"sink": {
											"name": "store",
											"type": "String",
											"physicalType": "nvarchar"
										}
									},
									{
										"source": {
											"name": "date",
											"type": "DateTime",
											"physicalType": "date"
										},
										"sink": {
											"name": "date",
											"type": "DateTime",
											"physicalType": "date"
										}
									},
									{
										"source": {
											"name": "UsedEquipmentRevenue",
											"type": "Decimal",
											"physicalType": "money",
											"scale": 4,
											"precision": 19
										},
										"sink": {
											"name": "UsedEquipmentRevenue",
											"type": "Decimal",
											"physicalType": "money",
											"scale": 4,
											"precision": 19
										}
									},
									{
										"source": {
											"name": "UsedEquipmentCost",
											"type": "Decimal",
											"physicalType": "money",
											"scale": 4,
											"precision": 19
										},
										"sink": {
											"name": "UsedEquipmentCost",
											"type": "Decimal",
											"physicalType": "money",
											"scale": 4,
											"precision": 19
										}
									},
									{
										"source": {
											"name": "NewEquipmentRevenue",
											"type": "Decimal",
											"physicalType": "money",
											"scale": 4,
											"precision": 19
										},
										"sink": {
											"name": "NewEquipmentRevenue",
											"type": "Decimal",
											"physicalType": "money",
											"scale": 4,
											"precision": 19
										}
									},
									{
										"source": {
											"name": "NewEquipmentCost",
											"type": "Decimal",
											"physicalType": "money",
											"scale": 4,
											"precision": 19
										},
										"sink": {
											"name": "NewEquipmentCost",
											"type": "Decimal",
											"physicalType": "money",
											"scale": 4,
											"precision": 19
										}
									},
									{
										"source": {
											"name": "Purchase_Price",
											"type": "Decimal",
											"physicalType": "money",
											"scale": 4,
											"precision": 19
										},
										"sink": {
											"name": "Purchase_Price",
											"type": "Decimal",
											"physicalType": "money",
											"scale": 4,
											"precision": 19
										}
									},
									{
										"source": {
											"name": "Current_Book_Price",
											"type": "Decimal",
											"physicalType": "money",
											"scale": 4,
											"precision": 19
										},
										"sink": {
											"name": "Current_Book_Price",
											"type": "Decimal",
											"physicalType": "money",
											"scale": 4,
											"precision": 19
										}
									},
									{
										"source": {
											"name": "CustomerType",
											"type": "String",
											"physicalType": "varchar"
										},
										"sink": {
											"name": "CustomerType",
											"type": "String",
											"physicalType": "varchar"
										}
									},
									{
										"source": {
											"name": "Customer Number",
											"type": "String",
											"physicalType": "nvarchar"
										},
										"sink": {
											"name": "Customer Number",
											"type": "String",
											"physicalType": "nvarchar"
										}
									},
									{
										"source": {
											"name": "Customer Name",
											"type": "String",
											"physicalType": "nvarchar"
										},
										"sink": {
											"name": "Customer Name",
											"type": "String",
											"physicalType": "nvarchar"
										}
									},
									{
										"source": {
											"name": "Contract No",
											"type": "String",
											"physicalType": "nvarchar"
										},
										"sink": {
											"name": "Contract No",
											"type": "String",
											"physicalType": "nvarchar"
										}
									},
									{
										"source": {
											"name": "Contract Date",
											"type": "DateTime",
											"physicalType": "datetime"
										},
										"sink": {
											"name": "Contract Date",
											"type": "DateTime",
											"physicalType": "datetime"
										}
									},
									{
										"source": {
											"name": "TXTY",
											"type": "String",
											"physicalType": "nvarchar"
										},
										"sink": {
											"name": "TXTY",
											"type": "String",
											"physicalType": "nvarchar"
										}
									}
								],
								"typeConversion": true,
								"typeConversionSettings": {
									"allowDataTruncation": true,
									"treatBooleanAsNumber": false
								}
							}
						},
						"inputs": [
							{
								"referenceName": "DS_POR",
								"type": "DatasetReference",
								"parameters": {
									"schema_name": "dbo",
									"table_name": "user"
								}
							}
						],
						"outputs": [
							{
								"referenceName": "Briggs_MDW",
								"type": "DatasetReference",
								"parameters": {
									"schema_name": "POR",
									"table_name": "Executive_Dashboard_Equipment_Stage"
								}
							}
						]
					},
					{
						"name": "EXECUTIVE_DASHBOARD_RENT_STAGE",
						"type": "Copy",
						"dependsOn": [
							{
								"activity": "EXECUTIVE_DASHBOARD_EQUIPMENT_STAGE",
								"dependencyConditions": [
									"Succeeded"
								]
							}
						],
						"policy": {
							"timeout": "7.00:00:00",
							"retry": 0,
							"retryIntervalInSeconds": 30,
							"secureOutput": false,
							"secureInput": false
						},
						"userProperties": [],
						"typeProperties": {
							"source": {
								"type": "SqlServerSource",
								"sqlReaderQuery": "WITH v_CTE AS (\n\nSELECT store,sum([TCA].[RentTX] + [TCA].[RentNT]) AS Rent,\n\n       sum([TCA].[SaleTX] + [TCA].[SaleNT] - ISNULL(dp.DelPUamt,0)) AS Sale,  --subtract out Delivery/PU type 4 transactionitems\n\ntca.[Date] AS PostedDate, sum(dp.Purchase_Price) as Purchase_Price, sum(dp.Current_Book_Price) as Current_Book_Price, dp.CustomerType, dp.[Customer Number],\ndp.[Contract No], dp.[Contract Date],dp.[TXTY]\n\nFROM POR.dbo.TotalsContractsAccrual tca\n\nLEFT JOIN (\n\n       SELECT ti.CNTR, SUM(ti.PRIC) AS DelPUamt, SUM(ifi.PURP) as Purchase_Price, \n\t   SUM(ifi.CURV) as Current_Book_Price,CASE WHEN t.PYMT = 'E' THEN 'Account' ELSE 'Cash' END AS CustomerType\n, cf.[CNUM] AS [Customer Number]\n, cf.[Name] AS [Customer Name]\n, t.[CNTR] AS [Contract No]\n, t.[DATE] AS [Contract Date]\n,TI.[TXTY]\n\n       FROM POR.dbo.TransactionItems ti\n\t   JOIN POR.dbo.Transactions t ON ti.CNTR = t.CNTR\n       INNER JOIN CustomerFile CF ON T.[CUSN] = CF.[CNUM]\n       JOIN POR.dbo.ItemFile ifi ON ifi.NUM = ti.ITEM\n\n       WHERE (ifi.Category = 4 --Delivery/PU\n\n         OR (ifi.SerialNumber <> '' AND ifi.Asset = 0))  --non-asset with serialnumber <-- ******** Not sure this works, see CNTR 103027A ** NEED TO ASK MICHAEL\n\n                      --Select * from POR.dbo.Itemfile where [key] = '6965'\n\n                       --SELECT * from POR.dbo.Itemfile where SerialNumber <> '' AND Asset = 0  <-- these 47 just might be marked incorrectly\n\n          GROUP BY ti.CNTR,CASE WHEN t.PYMT = 'E' THEN 'Account' ELSE 'Cash' END \n, cf.[CNUM]\n, cf.[Name]\n, t.[CNTR]\n, t.[DATE] \n,TI.[TXTY]\n\n) dp ON dp.CNTR = tca.CNTR\n\ngroup by store, tca.Date, dp.CustomerType, dp.[Customer Number],\ndp.[Contract No], dp.[Contract Date],dp.[TXTY]\n\n)\n\nSELECT store,SUM(Rent) AS RentSum, SUM(Sale) AS SaleSum, \ncast(PostedDate as date) as Posted_Date,isnull(sum(Purchase_Price),0) as Purchase_Price,\nisnull(sum(Current_Book_Price),0) as Current_Book_Price,CustomerType, [Customer Number],\n[Contract No], [Contract Date],[TXTY]\n\nFROM v_CTE\ngroup by store,PostedDate,CustomerType, [Customer Number],\n[Contract No], [Contract Date],[TXTY]",
								"queryTimeout": "02:00:00",
								"partitionOption": "None"
							},
							"sink": {
								"type": "AzureSqlSink",
								"preCopyScript": "truncate table  [POR].[Executive_Dashboard_Rent_Stage];",
								"writeBehavior": "insert",
								"sqlWriterUseTableLock": false,
								"tableOption": "autoCreate",
								"disableMetricsCollection": false
							},
							"enableStaging": false,
							"translator": {
								"type": "TabularTranslator",
								"mappings": [
									{
										"source": {
											"name": "store",
											"type": "String",
											"physicalType": "nvarchar"
										},
										"sink": {
											"name": "store",
											"type": "String",
											"physicalType": "nvarchar"
										}
									},
									{
										"source": {
											"name": "RentSum",
											"type": "Decimal",
											"physicalType": "money",
											"scale": 4,
											"precision": 19
										},
										"sink": {
											"name": "RentSum",
											"type": "Decimal",
											"physicalType": "money",
											"scale": 4,
											"precision": 19
										}
									},
									{
										"source": {
											"name": "SaleSum",
											"type": "Decimal",
											"physicalType": "money",
											"scale": 4,
											"precision": 19
										},
										"sink": {
											"name": "SaleSum",
											"type": "Decimal",
											"physicalType": "money",
											"scale": 4,
											"precision": 19
										}
									},
									{
										"source": {
											"name": "Posted_Date",
											"type": "DateTime",
											"physicalType": "date"
										},
										"sink": {
											"name": "Posted_Date",
											"type": "DateTime",
											"physicalType": "date"
										}
									},
									{
										"source": {
											"name": "Purchase_Price",
											"type": "Decimal",
											"physicalType": "money",
											"scale": 4,
											"precision": 19
										},
										"sink": {
											"name": "Purchase_Price",
											"type": "Decimal",
											"physicalType": "money",
											"scale": 4,
											"precision": 19
										}
									},
									{
										"source": {
											"name": "Current_Book_Price",
											"type": "Decimal",
											"physicalType": "money",
											"scale": 4,
											"precision": 19
										},
										"sink": {
											"name": "Current_Book_Price",
											"type": "Decimal",
											"physicalType": "money",
											"scale": 4,
											"precision": 19
										}
									},
									{
										"source": {
											"name": "CustomerType",
											"type": "String",
											"physicalType": "varchar"
										},
										"sink": {
											"name": "CustomerType",
											"type": "String",
											"physicalType": "nvarchar"
										}
									},
									{
										"source": {
											"name": "Customer Number",
											"type": "String",
											"physicalType": "nvarchar"
										},
										"sink": {
											"name": "Customer Number",
											"type": "String",
											"physicalType": "nvarchar"
										}
									},
									{
										"source": {
											"name": "Contract No",
											"type": "String",
											"physicalType": "nvarchar"
										},
										"sink": {
											"name": "Contract No",
											"type": "String",
											"physicalType": "nvarchar"
										}
									},
									{
										"source": {
											"name": "Contract Date",
											"type": "DateTime",
											"physicalType": "datetime"
										},
										"sink": {
											"name": "Contract Date",
											"type": "DateTime",
											"physicalType": "datetime"
										}
									},
									{
										"source": {
											"name": "TXTY",
											"type": "String",
											"physicalType": "nvarchar"
										},
										"sink": {
											"name": "TXTY",
											"type": "String",
											"physicalType": "nvarchar"
										}
									}
								],
								"typeConversion": true,
								"typeConversionSettings": {
									"allowDataTruncation": true,
									"treatBooleanAsNumber": false
								}
							}
						},
						"inputs": [
							{
								"referenceName": "DS_POR",
								"type": "DatasetReference",
								"parameters": {
									"schema_name": "dbo",
									"table_name": "user"
								}
							}
						],
						"outputs": [
							{
								"referenceName": "Briggs_MDW",
								"type": "DatasetReference",
								"parameters": {
									"schema_name": "POR",
									"table_name": "Executive_Dashboard_Rent_Stage"
								}
							}
						]
					},
					{
						"name": "EXECUTIVE_DASHBOARD_SALES_STAGE",
						"type": "Copy",
						"dependsOn": [
							{
								"activity": "EXECUTIVE_DASHBOARD_RENT_STAGE",
								"dependencyConditions": [
									"Succeeded"
								]
							}
						],
						"policy": {
							"timeout": "7.00:00:00",
							"retry": 0,
							"retryIntervalInSeconds": 30,
							"secureOutput": false,
							"secureInput": false
						},
						"userProperties": [],
						"typeProperties": {
							"source": {
								"type": "SqlServerSource",
								"sqlReaderQuery": "SELECT SoldItems.Batch,SoldItems.[Date], SoldItems.CNTR, SoldItems.ItemNo, SoldItems.CustNo, SoldItems.Amount, SoldItems.Qty, SoldItems.[Name], SoldItems.PurchaseCost,\n\n       SoldItems.Depreciation, SoldItems.PurchaseDate, SoldItems.Store, SoldItems.Asset, SoldItems.Header, SoldItems.CustomerName,\n\n          SoldItems.[KEY],\n\n           iif(ItemTL.ItemName is Null, SoldItems.ItemName,ItemTL.ItemName) as ItemName,\n\t\t   SoldItems.BoughtUsed,\n\n\n           SoldItems.ItemQty, SoldItems.PartNumber, SoldItems.ItemNum, SoldItems.MANF, SoldItems.MODN,\n\n          iif(ItemTL.UserDefined1 is Null, SoldItems.UserDefined1,ItemTL.UserDefined1) as UserDefined1,\n\n          SoldItems.INC3, SoldItems.REPC2, SoldItems.GLAccount, SoldItems.HomeStore, SoldItems.CurrentStore, SoldItems.SerialNumber,\n\n         iif(CatTL.CatName is Null,SoldItems.CategoryName,CatTL.CatName) as CategoryName,\n\n          SoldItems.AssetGL,\n\n          iif(DivTL.DivisionName is Null, SoldItems.DivisionName,DivTL.DivisionName) as DivisionName,\n\n           SoldItems.NoPrintItemNo,\n\n          SoldItems.GLEquip, SoldItems.Category, SoldItems.DivisionNumber, getdate() as Snapshot_Date, SoldItems.CustomerType, SoldItems.[Contract Date], SoldItems.[TXTY]\n\nfrom (\n\n \n\nSELECT SA.Batch,SA.[Date], SA.CNTR, SA.ItemNo,ITF.BoughtUsed ,SA.CustNo, SA.Amount, SA.Qty, SA.[Name], SA.PurchaseCost,\n\n       SA.Depreciation, SA.PurchaseDate, SA.Store, SA.Asset, ITF.Header, CF.[Name] AS CustomerName,\n\n          ITF.[KEY], ITF.[Name] as ItemName, ITF.QTY as ItemQty, ITF.PartNumber, ITF.NUM as ItemNum, ITF.MANF, ITF.MODN,\n\n          ITF.UserDefined1, ITF.INC3, ITF.REPC2, ITF.GLAccount, ITF.HomeStore, ITF.CurrentStore, ITF.SerialNumber,\n\n          CAT.[Name] as CategoryName, CAT.AssetGL, ID.DivisionName, PF.NoPrintItemNo,\n\n          AC.Equipment as GLEquip, ITF.Category, ID.DivisionNumber, CASE WHEN t.PYMT = 'E' THEN 'Account' ELSE 'Cash' END AS CustomerType\n, t.[DATE] AS [Contract Date]\n,TI.[TXTY]\n\n         \n\n \n\nFROM SoldAssetFile SA\n\n      LEFT JOIN ItemFile ITF ON SA.ItemNo = ITF.NUM\n\n         LEFT JOIN ItemCategory CAT ON ITF.Category = CAT.Category \n\n         LEFT JOIN ItemDivision ID ON CAT.DivisionNumber = ID.DivisionNumber\n\n      LEFT JOIN CustomerFile CF ON SA.CustNo = CF.CNUM\n\t  JOIN POR.dbo.Transactions t ON CF.CNUM = t.CUSN\n\t  join POR.dbo.TransactionItems ti on t.CNTR = ti.CNTR\n\n         LEFT JOIN ParameterFile PF ON ITF.HomeStore = PF.[Store]\n\n         LEFT JOIN AccountNumbers AC ON SA.Store = AC.Store  ) as SoldItems\n\n \n\n--WHERE Batch >={?BegBatch} and\n\n--      Batch <= {?EndBatch} and\n\n--      ('{?CustNo}' = '*' OR SA.CustNo = '{?CustNo}')  AND\n\n--      ('{?Header}' = '*' OR ITF.Header = '{?Header}' ) AND\n\n--      ('{?ItemNo}' = '*' OR SA.ItemNo = '{?ItemNo}')\n\n--\n\n--) as SoldItems\n\n \n\nLeft Join\n\n \n\n(SELECT TL.[NUM], TL.[Name] as ItemName, TL.INST, TL.Style1 , TL.Style2, TL.Style3 , TL.WebLink ,TL.VehicleType ,\n\nTL.[DescriptionLong],TL.WebGroup , TL.[Group] as ItemGroup,TL.[LOOKUP]  ,TL.[UserDefined1] , TL.[UserDefined2]\n\nFROM TranslationNames TN \n\nLEFT JOIN ItemFile_Tr TL on TN.LanguageCode = TL.Languagecode\n\n--WHERE TN.LanguageCode IS NULL OR TN.LanguageCode = '{?LanguageCode}'\n\n) AS ItemTL ON SoldItems.ItemNum = ItemTL.Num\n\nLeft Join\n\n \n\n(SELECT TL.Category,  TL.[Name] as CatName,TL.WebTags, TL.Style1 as CatStyle1 ,TL.Style2 as CatStyle2, TL.Style3 as CatStyle3 \n\nFROM TranslationNames TN\n\nLEFT JOIN ItemCategory_Tr TL ON TN.LanguageCode  = TL.Languagecode \n\n--WHERE TN.LanguageCode IS NULL OR TN.LanguageCode = '{?LanguageCode}' \n\n) AS CatTL ON SoldItems.Category = CatTL.Category\n\nLeft Join\n\n \n\n(  SELECT  TL.DivisionNumber,  TL.DivisionName   \n\nFROM TranslationNames TN  \n\nLEFT JOIN ItemDivision_Tr TL ON TN.LanguageCode  = TL.Languagecode\n\n--WHERE TN.LanguageCode IS NULL OR TN.LanguageCode = '{?LanguageCode}'\n\n) AS DivTL ON SoldItems.DivisionNumber = DivTL.DivisionNumber",
								"queryTimeout": "02:00:00",
								"partitionOption": "None"
							},
							"sink": {
								"type": "AzureSqlSink",
								"preCopyScript": "delete from [POR].[Executive_Dashboard_Sales_Stage] where snapshot_date=cast(getdate() as date);",
								"writeBehavior": "insert",
								"sqlWriterUseTableLock": false,
								"tableOption": "autoCreate",
								"disableMetricsCollection": false
							},
							"enableStaging": false,
							"translator": {
								"type": "TabularTranslator",
								"mappings": [
									{
										"source": {
											"name": "Batch",
											"type": "Int32",
											"physicalType": "int"
										},
										"sink": {
											"name": "Batch",
											"type": "Int32",
											"physicalType": "int"
										}
									},
									{
										"source": {
											"name": "Date",
											"type": "DateTime",
											"physicalType": "datetime"
										},
										"sink": {
											"name": "Date",
											"type": "DateTime",
											"physicalType": "datetime"
										}
									},
									{
										"source": {
											"name": "CNTR",
											"type": "String",
											"physicalType": "nvarchar"
										},
										"sink": {
											"name": "CNTR",
											"type": "String",
											"physicalType": "nvarchar"
										}
									},
									{
										"source": {
											"name": "ItemNo",
											"type": "String",
											"physicalType": "nvarchar"
										},
										"sink": {
											"name": "ItemNo",
											"type": "String",
											"physicalType": "nvarchar"
										}
									},
									{
										"source": {
											"name": "CustNo",
											"type": "String",
											"physicalType": "nvarchar"
										},
										"sink": {
											"name": "CustNo",
											"type": "String",
											"physicalType": "nvarchar"
										}
									},
									{
										"source": {
											"name": "Amount",
											"type": "Decimal",
											"physicalType": "money",
											"scale": 4,
											"precision": 19
										},
										"sink": {
											"name": "Amount",
											"type": "Decimal",
											"physicalType": "money",
											"scale": 4,
											"precision": 19
										}
									},
									{
										"source": {
											"name": "Qty",
											"type": "Int32",
											"physicalType": "int"
										},
										"sink": {
											"name": "Qty",
											"type": "Int32",
											"physicalType": "int"
										}
									},
									{
										"source": {
											"name": "Name",
											"type": "String",
											"physicalType": "nvarchar"
										},
										"sink": {
											"name": "Name",
											"type": "String",
											"physicalType": "nvarchar"
										}
									},
									{
										"source": {
											"name": "PurchaseCost",
											"type": "Decimal",
											"physicalType": "money",
											"scale": 4,
											"precision": 19
										},
										"sink": {
											"name": "PurchaseCost",
											"type": "Decimal",
											"physicalType": "money",
											"scale": 4,
											"precision": 19
										}
									},
									{
										"source": {
											"name": "Depreciation",
											"type": "Decimal",
											"physicalType": "money",
											"scale": 4,
											"precision": 19
										},
										"sink": {
											"name": "Depreciation",
											"type": "Decimal",
											"physicalType": "money",
											"scale": 4,
											"precision": 19
										}
									},
									{
										"source": {
											"name": "PurchaseDate",
											"type": "DateTime",
											"physicalType": "datetime"
										},
										"sink": {
											"name": "PurchaseDate",
											"type": "DateTime",
											"physicalType": "datetime"
										}
									},
									{
										"source": {
											"name": "Store",
											"type": "String",
											"physicalType": "nvarchar"
										},
										"sink": {
											"name": "Store",
											"type": "String",
											"physicalType": "nvarchar"
										}
									},
									{
										"source": {
											"name": "Asset",
											"type": "Boolean",
											"physicalType": "bit"
										},
										"sink": {
											"name": "Asset",
											"type": "Boolean",
											"physicalType": "bit"
										}
									},
									{
										"source": {
											"name": "Header",
											"type": "String",
											"physicalType": "nvarchar"
										},
										"sink": {
											"name": "Header",
											"type": "String",
											"physicalType": "nvarchar"
										}
									},
									{
										"source": {
											"name": "CustomerName",
											"type": "String",
											"physicalType": "nvarchar"
										},
										"sink": {
											"name": "CustomerName",
											"type": "String",
											"physicalType": "nvarchar"
										}
									},
									{
										"source": {
											"name": "KEY",
											"type": "String",
											"physicalType": "nvarchar"
										},
										"sink": {
											"name": "KEY",
											"type": "String",
											"physicalType": "nvarchar"
										}
									},
									{
										"source": {
											"name": "ItemName",
											"type": "String",
											"physicalType": "nvarchar"
										},
										"sink": {
											"name": "ItemName",
											"type": "String",
											"physicalType": "nvarchar"
										}
									},
									{
										"source": {
											"name": "BoughtUsed",
											"type": "Boolean",
											"physicalType": "bit"
										},
										"sink": {
											"name": "BoughtUsed",
											"type": "Boolean",
											"physicalType": "bit"
										}
									},
									{
										"source": {
											"name": "ItemQty",
											"type": "Double",
											"physicalType": "float"
										},
										"sink": {
											"name": "ItemQty",
											"type": "Double",
											"physicalType": "float"
										}
									},
									{
										"source": {
											"name": "PartNumber",
											"type": "String",
											"physicalType": "nvarchar"
										},
										"sink": {
											"name": "PartNumber",
											"type": "String",
											"physicalType": "nvarchar"
										}
									},
									{
										"source": {
											"name": "ItemNum",
											"type": "String",
											"physicalType": "nvarchar"
										},
										"sink": {
											"name": "ItemNum",
											"type": "String",
											"physicalType": "nvarchar"
										}
									},
									{
										"source": {
											"name": "MANF",
											"type": "String",
											"physicalType": "nvarchar"
										},
										"sink": {
											"name": "MANF",
											"type": "String",
											"physicalType": "nvarchar"
										}
									},
									{
										"source": {
											"name": "MODN",
											"type": "String",
											"physicalType": "nvarchar"
										},
										"sink": {
											"name": "MODN",
											"type": "String",
											"physicalType": "nvarchar"
										}
									},
									{
										"source": {
											"name": "UserDefined1",
											"type": "String",
											"physicalType": "nvarchar"
										},
										"sink": {
											"name": "UserDefined1",
											"type": "String",
											"physicalType": "nvarchar"
										}
									},
									{
										"source": {
											"name": "INC3",
											"type": "Decimal",
											"physicalType": "money",
											"scale": 4,
											"precision": 19
										},
										"sink": {
											"name": "INC3",
											"type": "Decimal",
											"physicalType": "money",
											"scale": 4,
											"precision": 19
										}
									},
									{
										"source": {
											"name": "REPC2",
											"type": "Decimal",
											"physicalType": "money",
											"scale": 4,
											"precision": 19
										},
										"sink": {
											"name": "REPC2",
											"type": "Decimal",
											"physicalType": "money",
											"scale": 4,
											"precision": 19
										}
									},
									{
										"source": {
											"name": "GLAccount",
											"type": "String",
											"physicalType": "nvarchar"
										},
										"sink": {
											"name": "GLAccount",
											"type": "String",
											"physicalType": "nvarchar"
										}
									},
									{
										"source": {
											"name": "HomeStore",
											"type": "String",
											"physicalType": "nvarchar"
										},
										"sink": {
											"name": "HomeStore",
											"type": "String",
											"physicalType": "nvarchar"
										}
									},
									{
										"source": {
											"name": "CurrentStore",
											"type": "String",
											"physicalType": "nvarchar"
										},
										"sink": {
											"name": "CurrentStore",
											"type": "String",
											"physicalType": "nvarchar"
										}
									},
									{
										"source": {
											"name": "SerialNumber",
											"type": "String",
											"physicalType": "nvarchar"
										},
										"sink": {
											"name": "SerialNumber",
											"type": "String",
											"physicalType": "nvarchar"
										}
									},
									{
										"source": {
											"name": "CategoryName",
											"type": "String",
											"physicalType": "nvarchar"
										},
										"sink": {
											"name": "CategoryName",
											"type": "String",
											"physicalType": "nvarchar"
										}
									},
									{
										"source": {
											"name": "AssetGL",
											"type": "String",
											"physicalType": "nvarchar"
										},
										"sink": {
											"name": "AssetGL",
											"type": "String",
											"physicalType": "nvarchar"
										}
									},
									{
										"source": {
											"name": "DivisionName",
											"type": "String",
											"physicalType": "nvarchar"
										},
										"sink": {
											"name": "DivisionName",
											"type": "String",
											"physicalType": "nvarchar"
										}
									},
									{
										"source": {
											"name": "NoPrintItemNo",
											"type": "Boolean",
											"physicalType": "bit"
										},
										"sink": {
											"name": "NoPrintItemNo",
											"type": "Boolean",
											"physicalType": "bit"
										}
									},
									{
										"source": {
											"name": "GLEquip",
											"type": "String",
											"physicalType": "nvarchar"
										},
										"sink": {
											"name": "GLEquip",
											"type": "String",
											"physicalType": "nvarchar"
										}
									},
									{
										"source": {
											"name": "Category",
											"type": "Int32",
											"physicalType": "int"
										},
										"sink": {
											"name": "Category",
											"type": "Int32",
											"physicalType": "int"
										}
									},
									{
										"source": {
											"name": "DivisionNumber",
											"type": "Int32",
											"physicalType": "int"
										},
										"sink": {
											"name": "DivisionNumber",
											"type": "Int32",
											"physicalType": "int"
										}
									},
									{
										"source": {
											"name": "Snapshot_Date",
											"type": "DateTime",
											"physicalType": "datetime"
										},
										"sink": {
											"name": "Snapshot_Date",
											"type": "DateTime",
											"physicalType": "date"
										}
									},
									{
										"source": {
											"name": "CustomerType",
											"type": "String",
											"physicalType": "varchar"
										},
										"sink": {
											"name": "CustomerType",
											"type": "String",
											"physicalType": "nvarchar"
										}
									},
									{
										"source": {
											"name": "Contract Date",
											"type": "DateTime",
											"physicalType": "datetime"
										},
										"sink": {
											"name": "Contract Date",
											"type": "DateTime",
											"physicalType": "datetime"
										}
									},
									{
										"source": {
											"name": "TXTY",
											"type": "String",
											"physicalType": "nvarchar"
										},
										"sink": {
											"name": "TXTY",
											"type": "String",
											"physicalType": "nvarchar"
										}
									}
								],
								"typeConversion": true,
								"typeConversionSettings": {
									"allowDataTruncation": true,
									"treatBooleanAsNumber": false
								}
							}
						},
						"inputs": [
							{
								"referenceName": "DS_POR",
								"type": "DatasetReference",
								"parameters": {
									"schema_name": "dbo",
									"table_name": "user"
								}
							}
						],
						"outputs": [
							{
								"referenceName": "Briggs_MDW",
								"type": "DatasetReference",
								"parameters": {
									"schema_name": "POR",
									"table_name": "Executive_Dashboard_Sales_Stage"
								}
							}
						]
					},
					{
						"name": "EXECUTIVE_DASHBOARD_EQUIPMENT_DELIVERY_STAGE",
						"type": "Copy",
						"dependsOn": [
							{
								"activity": "EXECUTIVE_DASHBOARD_SALES_STAGE",
								"dependencyConditions": [
									"Succeeded"
								]
							}
						],
						"policy": {
							"timeout": "7.00:00:00",
							"retry": 0,
							"retryIntervalInSeconds": 30,
							"secureOutput": false,
							"secureInput": false
						},
						"userProperties": [],
						"typeProperties": {
							"source": {
								"type": "SqlServerSource",
								"sqlReaderQuery": "SELECT \n\n--Below are Transaction Level Items\n\n  CASE WHEN pf.Store <> '001' THEN RIGHT(pf.STORE_NAME, LEN(pf.STORE_NAME) - 4) ELSE pf.STORE_NAME END AS [Store Name]\n\n, t.[STR] AS [Store No]\n\n, CASE WHEN t.PYMT = 'E' THEN 'Account' ELSE 'Cash' END AS CustomerType\n\n, cf.[CNUM] AS [Customer Number]\n\n, cf.[Name] AS [Customer Name]\n\n, t.JOBN AS [Job Name]\n\n, t.JBPO AS [Job PO#] \n\n, t.JBID AS [Job #]\n\n, cjs.Description AS [Job Site Name]\n\n, ISNULL(cjs.SiteAddress,'') + ' ' + ISNULL(cjs.SiteCity,'') + ' ' + ISNULL(cjs.SiteZip,'') AS [Job Site Address]\n\n, t.DMG AS [Extended Protection Plan]\n\n, s.[Name] AS [Contract Salesman]\n\n, s2.[Name] AS [Customer Salesman]\n\n, o.OPNM AS [Created by Operator Name]\n\n, o2.OPNM AS [Assigned to Operator Name]\n\n, t.[DATE] AS [Contract Date]\n\n, t1.OriginalContractDate AS [Original Contract Date]\n\n, t.[CNTR] AS [Contract No]\n\n--Below are Item level details\n\n, CASE WHEN ti.TXTY = 'R' THEN 'RENT'\n\n       WHEN ti.TXTY = 'RR' THEN 'Returned'\n\n       WHEN ti.TXTY = 'RX' THEN 'Previously Returned'\n\n       WHEN ti.TXTY = 'RH' THEN 'Not Returned. Item on hold for pickup'\n\n       WHEN ti.TXTY = 'RD' THEN 'Not Returned. Demand letter sent'\n\n       WHEN ti.TXTY = 'RM' THEN 'Not Returned. Reservation Reminder letter sent'\n\n       WHEN ti.TXTY = 'RN' THEN 'Not Returned. Reminder letter sent'\n\n       WHEN ti.TXTY = 'RV' THEN 'Not Returned. Reservation Verify letter sent'\n\n       WHEN ti.TXTY = '' THEN 'Not Returned. No letters have been sent'\n\nELSE 'Sale Item' END AS [Item Status]\n\n, ifi.Header \n\n, ti.ITEM AS [Key] \n\n, ifi.Name\n\n, ifi.SerialNumber AS [Serial Number]\n\n, ifi.MANF AS [Make]\n\n, ifi.MODN AS [Model]\n\n, ifi.Modelyear AS [Model Year]\n\n, ti.PRIC AS [Amount Charged]\n\n, ti.DailyAmount AS [Daily]\n\n, ifi.RATE1 AS [Book Rate Daily]\n\n, ti.WeeklyAmount AS [Weekly]\n\n, ifi.RATE2 AS [Book Rate Weekly]\n\n, ti.MonthlyAmount AS [Monthly]\n\n, ifi.RATE3 AS [Book Rate Monthly]\n\n, CASE WHEN ti.Substatus = 7 THEN 'Substitute' ELSE '' END AS [Is Substitute]\n\n, CASE WHEN ti.Substatus = 7 THEN ti.Comments ELSE '' END AS [Substitution Comments]\n,getdate() Report_Refresh_Date\n\n\n \n\nFROM POR.dbo.transactions t\n\nJOIN POR.dbo.TransactionItems ti ON ti.CNTR = t.CNTR\n\nJOIN POR.dbo.ItemFile ifi ON ifi.NUM = ti.ITEM\n\nJOIN POR.dbo.ParameterFile pf ON pf.Store = t.[STR]\n\nJOIN (SELECT t0.CNTR, t0.[DATE] AS OriginalContractDate FROM POR.dbo.Transactions t0 WHERE RIGHT(t0.CNTR,1) NOT LIKE '[A-Za-z]%') t1\n\n              ON t1.CNTR = CASE WHEN RIGHT(t.CNTR,1) LIKE '[A-Za-z]%' THEN LEFT(t.CNTR, LEN(t.CNTR)-1) ELSE t.CNTR END\n\nLEFT JOIN POR.dbo.ItemComments ic ON ic.NUM = ifi.NUM\n\nLEFT JOIN POR.dbo.CustomerFile cf ON cf.CNUM = t.CUSN\n\nLEFT JOIN POR.dbo.CustomerJobSite cjs ON cjs.Number = t.JobSite\n\nLEFT JOIN POR.dbo.Salesman s ON s.Number = t.Salesman\n\nLEFT JOIN POR.dbo.Salesman s2 ON s2.Number = cf.Salesman\n\nLEFT JOIN POR.dbo.OperatorId o ON o.OPNO = t.OperatorCreated\n\nLEFT JOIN POR.dbo.OperatorId o2 ON o2.OPNO = t.OperatorAssigned\n\n \n\nWHERE LEFT(t.STAT,1) = 'O'\n\nAND LEFT(t.CNTR,1) NOT IN ('q','r','s','t')\n\nAND (ifi.TYPE IN ('T','H','U','V','A','L','R','N','K','D') -- Include Rental types & delivery/pickup charges only; exclude sales, diesel, etc.\n\nOR ifi.Name LIKE 'Delivery%' --2. Sale items to include\n\nOR ifi.Name LIKE 'Pickup%' --3. Sale items to include\n\n)\n\nAND t.STAT NOT IN ('OJ','OH','RR','OR')\n\nAND ti.TXTY <> 'RR'\n\nORDER BY [Store Name], cf.[NAME], t.[DATE] ASC, t.CNTR, s.[Name]",
								"queryTimeout": "02:00:00",
								"partitionOption": "None"
							},
							"sink": {
								"type": "AzureSqlSink",
								"preCopyScript": "truncate table  [POR].[Executive_Dashboard_Equipment_Delivery_Stage];",
								"writeBehavior": "insert",
								"sqlWriterUseTableLock": false,
								"tableOption": "autoCreate",
								"disableMetricsCollection": false
							},
							"enableStaging": false,
							"translator": {
								"type": "TabularTranslator",
								"mappings": [
									{
										"source": {
											"name": "Store Name",
											"type": "String",
											"physicalType": "nvarchar"
										},
										"sink": {
											"name": "Store Name",
											"type": "String",
											"physicalType": "nvarchar"
										}
									},
									{
										"source": {
											"name": "Store No",
											"type": "String",
											"physicalType": "nvarchar"
										},
										"sink": {
											"name": "Store No",
											"type": "String",
											"physicalType": "nvarchar"
										}
									},
									{
										"source": {
											"name": "CustomerType",
											"type": "String",
											"physicalType": "varchar"
										},
										"sink": {
											"name": "CustomerType",
											"type": "String",
											"physicalType": "varchar"
										}
									},
									{
										"source": {
											"name": "Customer Number",
											"type": "String",
											"physicalType": "nvarchar"
										},
										"sink": {
											"name": "Customer Number",
											"type": "String",
											"physicalType": "nvarchar"
										}
									},
									{
										"source": {
											"name": "Customer Name",
											"type": "String",
											"physicalType": "nvarchar"
										},
										"sink": {
											"name": "Customer Name",
											"type": "String",
											"physicalType": "nvarchar"
										}
									},
									{
										"source": {
											"name": "Job Name",
											"type": "String",
											"physicalType": "nvarchar"
										},
										"sink": {
											"name": "Job Name",
											"type": "String",
											"physicalType": "nvarchar"
										}
									},
									{
										"source": {
											"name": "Job PO#",
											"type": "String",
											"physicalType": "nvarchar"
										},
										"sink": {
											"name": "Job PO#",
											"type": "String",
											"physicalType": "nvarchar"
										}
									},
									{
										"source": {
											"name": "Job #",
											"type": "String",
											"physicalType": "nvarchar"
										},
										"sink": {
											"name": "Job #",
											"type": "String",
											"physicalType": "nvarchar"
										}
									},
									{
										"source": {
											"name": "Job Site Name",
											"type": "String",
											"physicalType": "nvarchar"
										},
										"sink": {
											"name": "Job Site Name",
											"type": "String",
											"physicalType": "nvarchar"
										}
									},
									{
										"source": {
											"name": "Job Site Address",
											"type": "String",
											"physicalType": "nvarchar"
										},
										"sink": {
											"name": "Job Site Address",
											"type": "String",
											"physicalType": "nvarchar"
										}
									},
									{
										"source": {
											"name": "Extended Protection Plan",
											"type": "Decimal",
											"physicalType": "money",
											"scale": 4,
											"precision": 19
										},
										"sink": {
											"name": "Extended Protection Plan",
											"type": "Decimal",
											"physicalType": "money",
											"scale": 4,
											"precision": 19
										}
									},
									{
										"source": {
											"name": "Contract Salesman",
											"type": "String",
											"physicalType": "nvarchar"
										},
										"sink": {
											"name": "Contract Salesman",
											"type": "String",
											"physicalType": "nvarchar"
										}
									},
									{
										"source": {
											"name": "Customer Salesman",
											"type": "String",
											"physicalType": "nvarchar"
										},
										"sink": {
											"name": "Customer Salesman",
											"type": "String",
											"physicalType": "nvarchar"
										}
									},
									{
										"source": {
											"name": "Created by Operator Name",
											"type": "String",
											"physicalType": "nvarchar"
										},
										"sink": {
											"name": "Created by Operator Name",
											"type": "String",
											"physicalType": "nvarchar"
										}
									},
									{
										"source": {
											"name": "Assigned to Operator Name",
											"type": "String",
											"physicalType": "nvarchar"
										},
										"sink": {
											"name": "Assigned to Operator Name",
											"type": "String",
											"physicalType": "nvarchar"
										}
									},
									{
										"source": {
											"name": "Contract Date",
											"type": "DateTime",
											"physicalType": "datetime"
										},
										"sink": {
											"name": "Contract Date",
											"type": "DateTime",
											"physicalType": "datetime"
										}
									},
									{
										"source": {
											"name": "Original Contract Date",
											"type": "DateTime",
											"physicalType": "datetime"
										},
										"sink": {
											"name": "Original Contract Date",
											"type": "DateTime",
											"physicalType": "datetime"
										}
									},
									{
										"source": {
											"name": "Contract No",
											"type": "String",
											"physicalType": "nvarchar"
										},
										"sink": {
											"name": "Contract No",
											"type": "String",
											"physicalType": "nvarchar"
										}
									},
									{
										"source": {
											"name": "Item Status",
											"type": "String",
											"physicalType": "varchar"
										},
										"sink": {
											"name": "Item Status",
											"type": "String",
											"physicalType": "varchar"
										}
									},
									{
										"source": {
											"name": "Header",
											"type": "String",
											"physicalType": "nvarchar"
										},
										"sink": {
											"name": "Header",
											"type": "String",
											"physicalType": "nvarchar"
										}
									},
									{
										"source": {
											"name": "Key",
											"type": "String",
											"physicalType": "nvarchar"
										},
										"sink": {
											"name": "Key",
											"type": "String",
											"physicalType": "nvarchar"
										}
									},
									{
										"source": {
											"name": "Name",
											"type": "String",
											"physicalType": "nvarchar"
										},
										"sink": {
											"name": "Name",
											"type": "String",
											"physicalType": "nvarchar"
										}
									},
									{
										"source": {
											"name": "Serial Number",
											"type": "String",
											"physicalType": "nvarchar"
										},
										"sink": {
											"name": "Serial Number",
											"type": "String",
											"physicalType": "nvarchar"
										}
									},
									{
										"source": {
											"name": "Make",
											"type": "String",
											"physicalType": "nvarchar"
										},
										"sink": {
											"name": "Make",
											"type": "String",
											"physicalType": "nvarchar"
										}
									},
									{
										"source": {
											"name": "Model",
											"type": "String",
											"physicalType": "nvarchar"
										},
										"sink": {
											"name": "Model",
											"type": "String",
											"physicalType": "nvarchar"
										}
									},
									{
										"source": {
											"name": "Model Year",
											"type": "String",
											"physicalType": "nvarchar"
										},
										"sink": {
											"name": "Model Year",
											"type": "String",
											"physicalType": "nvarchar"
										}
									},
									{
										"source": {
											"name": "Amount Charged",
											"type": "Decimal",
											"physicalType": "money",
											"scale": 4,
											"precision": 19
										},
										"sink": {
											"name": "Amount Charged",
											"type": "Decimal",
											"physicalType": "money",
											"scale": 4,
											"precision": 19
										}
									},
									{
										"source": {
											"name": "Daily",
											"type": "Decimal",
											"physicalType": "money",
											"scale": 4,
											"precision": 19
										},
										"sink": {
											"name": "Daily",
											"type": "Decimal",
											"physicalType": "money",
											"scale": 4,
											"precision": 19
										}
									},
									{
										"source": {
											"name": "Book Rate Daily",
											"type": "Decimal",
											"physicalType": "money",
											"scale": 4,
											"precision": 19
										},
										"sink": {
											"name": "Book Rate Daily",
											"type": "Decimal",
											"physicalType": "money",
											"scale": 4,
											"precision": 19
										}
									},
									{
										"source": {
											"name": "Weekly",
											"type": "Decimal",
											"physicalType": "money",
											"scale": 4,
											"precision": 19
										},
										"sink": {
											"name": "Weekly",
											"type": "Decimal",
											"physicalType": "money",
											"scale": 4,
											"precision": 19
										}
									},
									{
										"source": {
											"name": "Book Rate Weekly",
											"type": "Decimal",
											"physicalType": "money",
											"scale": 4,
											"precision": 19
										},
										"sink": {
											"name": "Book Rate Weekly",
											"type": "Decimal",
											"physicalType": "money",
											"scale": 4,
											"precision": 19
										}
									},
									{
										"source": {
											"name": "Monthly",
											"type": "Decimal",
											"physicalType": "money",
											"scale": 4,
											"precision": 19
										},
										"sink": {
											"name": "Monthly",
											"type": "Decimal",
											"physicalType": "money",
											"scale": 4,
											"precision": 19
										}
									},
									{
										"source": {
											"name": "Book Rate Monthly",
											"type": "Decimal",
											"physicalType": "money",
											"scale": 4,
											"precision": 19
										},
										"sink": {
											"name": "Book Rate Monthly",
											"type": "Decimal",
											"physicalType": "money",
											"scale": 4,
											"precision": 19
										}
									},
									{
										"source": {
											"name": "Is Substitute",
											"type": "String",
											"physicalType": "varchar"
										},
										"sink": {
											"name": "Is Substitute",
											"type": "String",
											"physicalType": "varchar"
										}
									},
									{
										"source": {
											"name": "Substitution Comments",
											"type": "String",
											"physicalType": "nvarchar"
										},
										"sink": {
											"name": "Substitution Comments",
											"type": "String",
											"physicalType": "nvarchar"
										}
									},
									{
										"source": {
											"name": "Report_Refresh_Date",
											"type": "DateTime",
											"physicalType": "datetime"
										},
										"sink": {
											"name": "Report_Refresh_Date",
											"type": "DateTime",
											"physicalType": "datetime"
										}
									}
								],
								"typeConversion": true,
								"typeConversionSettings": {
									"allowDataTruncation": true,
									"treatBooleanAsNumber": false
								}
							}
						},
						"inputs": [
							{
								"referenceName": "DS_POR",
								"type": "DatasetReference",
								"parameters": {
									"schema_name": "dbo",
									"table_name": "user"
								}
							}
						],
						"outputs": [
							{
								"referenceName": "Briggs_MDW",
								"type": "DatasetReference",
								"parameters": {
									"schema_name": "POR",
									"table_name": "Executive_Dashboard_Equipment_Delivery_Stage"
								}
							}
						]
					},
					{
						"name": "PROC_LOAD_EXECUTIVE_DASHBOARD_FLEET",
						"type": "SqlServerStoredProcedure",
						"dependsOn": [
							{
								"activity": "EXECUTIVE_DASHBOARD_EQUIPMENT_DELIVERY_STAGE",
								"dependencyConditions": [
									"Succeeded"
								]
							}
						],
						"policy": {
							"timeout": "7.00:00:00",
							"retry": 0,
							"retryIntervalInSeconds": 30,
							"secureOutput": false,
							"secureInput": false
						},
						"userProperties": [],
						"typeProperties": {
							"storedProcedureName": "[dbo].[proc_load_executive_dashboard_fleet]"
						},
						"linkedServiceName": {
							"referenceName": "DS_MDW_SP",
							"type": "LinkedServiceReference"
						}
					},
					{
						"name": "PROC_LOAD_EXECUTIVE_DASHBOARD_OECNA",
						"type": "SqlServerStoredProcedure",
						"dependsOn": [
							{
								"activity": "EXECUTIVE_DASHBOARD_EQUIPMENT_DELIVERY_STAGE",
								"dependencyConditions": [
									"Succeeded"
								]
							}
						],
						"policy": {
							"timeout": "7.00:00:00",
							"retry": 0,
							"retryIntervalInSeconds": 30,
							"secureOutput": false,
							"secureInput": false
						},
						"userProperties": [],
						"typeProperties": {
							"storedProcedureName": "[dbo].[proc_load_executive_dashboard_oecna]"
						},
						"linkedServiceName": {
							"referenceName": "DS_MDW_SP",
							"type": "LinkedServiceReference"
						}
					},
					{
						"name": "EXECUTIVE_DASHBOARD_RENT_STAGE_Detail",
						"type": "Copy",
						"dependsOn": [],
						"policy": {
							"timeout": "7.00:00:00",
							"retry": 0,
							"retryIntervalInSeconds": 30,
							"secureOutput": false,
							"secureInput": false
						},
						"userProperties": [],
						"typeProperties": {
							"source": {
								"type": "SqlServerSource",
								"sqlReaderQuery": "WITH v_CTE AS (\n\nSELECT store,sum([TCA].[RentTX] + [TCA].[RentNT]) AS Rent,\n\n       sum([TCA].[SaleTX] + [TCA].[SaleNT] - ISNULL(dp.DelPUamt,0)) AS Sale,  --subtract out Delivery/PU type 4 transactionitems\n\ntca.[Date] AS PostedDate, sum(dp.Purchase_Price) as Purchase_Price, sum(dp.Current_Book_Price) as Current_Book_Price, dp.CustomerType, dp.[Customer Number],\ndp.[Contract No], dp.[Contract Date],dp.[TXTY],dp.ItemKey,dp.ItemName,dp.Make,dp.Model,dp.ModelYear,dp.categoryname\n\nFROM POR.dbo.TotalsContractsAccrual tca\n\nLEFT JOIN (\n\n       SELECT ti.CNTR, SUM(ti.PRIC) AS DelPUamt, SUM(ifi.PURP) as Purchase_Price, \n\t   SUM(ifi.CURV) as Current_Book_Price,CASE WHEN t.PYMT = 'E' THEN 'Account' ELSE 'Cash' END AS CustomerType\n, cf.[CNUM] AS [Customer Number]\n, cf.[Name] AS [Customer Name]\n, t.[CNTR] AS [Contract No]\n, t.[DATE] AS [Contract Date]\n,TI.[TXTY],ifi.[Name] ItemName,ifi.[Key] As [ItemKey],ifi.MANF As [Make],\nifi.MODN As [Model],\nifi.ModelYear,ic.[Name] categoryname\n       FROM POR.dbo.TransactionItems ti\n\t   JOIN POR.dbo.Transactions t ON ti.CNTR = t.CNTR\n       INNER JOIN CustomerFile CF ON T.[CUSN] = CF.[CNUM]\n       JOIN POR.dbo.ItemFile ifi ON ifi.NUM = ti.ITEM\n\t   JOIN POR.dbo.ItemCategory ic ON ifi.Category = ic.Category\n       WHERE (ifi.Category = 4 --Delivery/PU\n\n         OR (ifi.SerialNumber <> '' AND ifi.Asset = 0))  --non-asset with serialnumber <-- ******** Not sure this works, see CNTR 103027A ** NEED TO ASK MICHAEL\n\n                      --Select * from POR.dbo.Itemfile where [key] = '6965'\n\n                       --SELECT * from POR.dbo.Itemfile where SerialNumber <> '' AND Asset = 0  <-- these 47 just might be marked incorrectly\n\n          GROUP BY ti.CNTR,CASE WHEN t.PYMT = 'E' THEN 'Account' ELSE 'Cash' END \n, cf.[CNUM]\n, cf.[Name]\n, t.[CNTR]\n, t.[DATE] \n,TI.[TXTY],ifi.[Name] ,ifi.[Key] ,ifi.MANF ,ic.[Name],\nifi.MODN ,ifi.ModelYear\n\n) dp ON dp.CNTR = tca.CNTR\n\ngroup by store, tca.Date, dp.CustomerType, dp.[Customer Number],\ndp.[Contract No], dp.[Contract Date],dp.[TXTY],dp.ItemKey,dp.ItemName,dp.Make,dp.Model,dp.ModelYear,dp.categoryname\n\n)\n\nSELECT store,SUM(Rent) AS RentSum, SUM(Sale) AS SaleSum, \ncast(PostedDate as date) as Posted_Date,isnull(sum(Purchase_Price),0) as Purchase_Price,\nisnull(sum(Current_Book_Price),0) as Current_Book_Price,CustomerType, [Customer Number],\n[Contract No], [Contract Date],[TXTY],ItemKey,ItemName,Make,Model,ModelYear,categoryname\n\nFROM v_CTE\ngroup by store,PostedDate,CustomerType, [Customer Number],\n[Contract No], [Contract Date],[TXTY],ItemKey,ItemName,Make,Model,ModelYear,categoryname\n\n\n\n--select * from [POR]..[ItemCategory]",
								"queryTimeout": "02:00:00",
								"partitionOption": "None"
							},
							"sink": {
								"type": "AzureSqlSink",
								"preCopyScript": "truncate table  [POR].[Executive_Dashboard_Rent_Stage_Detail];",
								"writeBehavior": "insert",
								"sqlWriterUseTableLock": false,
								"tableOption": "autoCreate",
								"disableMetricsCollection": false
							},
							"enableStaging": false,
							"translator": {
								"type": "TabularTranslator",
								"mappings": [
									{
										"source": {
											"name": "store",
											"type": "String",
											"physicalType": "nvarchar"
										},
										"sink": {
											"name": "store",
											"type": "String",
											"physicalType": "nvarchar"
										}
									},
									{
										"source": {
											"name": "RentSum",
											"type": "Decimal",
											"physicalType": "money",
											"scale": 4,
											"precision": 19
										},
										"sink": {
											"name": "RentSum",
											"type": "Decimal",
											"physicalType": "money",
											"scale": 4,
											"precision": 19
										}
									},
									{
										"source": {
											"name": "SaleSum",
											"type": "Decimal",
											"physicalType": "money",
											"scale": 4,
											"precision": 19
										},
										"sink": {
											"name": "SaleSum",
											"type": "Decimal",
											"physicalType": "money",
											"scale": 4,
											"precision": 19
										}
									},
									{
										"source": {
											"name": "Posted_Date",
											"type": "DateTime",
											"physicalType": "date"
										},
										"sink": {
											"name": "Posted_Date",
											"type": "DateTime",
											"physicalType": "date"
										}
									},
									{
										"source": {
											"name": "Purchase_Price",
											"type": "Decimal",
											"physicalType": "money",
											"scale": 4,
											"precision": 19
										},
										"sink": {
											"name": "Purchase_Price",
											"type": "Decimal",
											"physicalType": "money",
											"scale": 4,
											"precision": 19
										}
									},
									{
										"source": {
											"name": "Current_Book_Price",
											"type": "Decimal",
											"physicalType": "money",
											"scale": 4,
											"precision": 19
										},
										"sink": {
											"name": "Current_Book_Price",
											"type": "Decimal",
											"physicalType": "money",
											"scale": 4,
											"precision": 19
										}
									},
									{
										"source": {
											"name": "CustomerType",
											"type": "String",
											"physicalType": "varchar"
										},
										"sink": {
											"name": "CustomerType",
											"type": "String",
											"physicalType": "varchar"
										}
									},
									{
										"source": {
											"name": "Customer Number",
											"type": "String",
											"physicalType": "nvarchar"
										},
										"sink": {
											"name": "Customer Number",
											"type": "String",
											"physicalType": "nvarchar"
										}
									},
									{
										"source": {
											"name": "Contract No",
											"type": "String",
											"physicalType": "nvarchar"
										},
										"sink": {
											"name": "Contract No",
											"type": "String",
											"physicalType": "nvarchar"
										}
									},
									{
										"source": {
											"name": "Contract Date",
											"type": "DateTime",
											"physicalType": "datetime"
										},
										"sink": {
											"name": "Contract Date",
											"type": "DateTime",
											"physicalType": "datetime"
										}
									},
									{
										"source": {
											"name": "TXTY",
											"type": "String",
											"physicalType": "nvarchar"
										},
										"sink": {
											"name": "TXTY",
											"type": "String",
											"physicalType": "nvarchar"
										}
									},
									{
										"source": {
											"name": "ItemKey",
											"type": "String",
											"physicalType": "nvarchar"
										},
										"sink": {
											"name": "ItemKey",
											"type": "String",
											"physicalType": "nvarchar"
										}
									},
									{
										"source": {
											"name": "ItemName",
											"type": "String",
											"physicalType": "nvarchar"
										},
										"sink": {
											"name": "ItemName",
											"type": "String",
											"physicalType": "nvarchar"
										}
									},
									{
										"source": {
											"name": "Make",
											"type": "String",
											"physicalType": "nvarchar"
										},
										"sink": {
											"name": "Make",
											"type": "String",
											"physicalType": "nvarchar"
										}
									},
									{
										"source": {
											"name": "Model",
											"type": "String",
											"physicalType": "nvarchar"
										},
										"sink": {
											"name": "Model",
											"type": "String",
											"physicalType": "nvarchar"
										}
									},
									{
										"source": {
											"name": "ModelYear",
											"type": "String",
											"physicalType": "nvarchar"
										},
										"sink": {
											"name": "ModelYear",
											"type": "String",
											"physicalType": "nvarchar"
										}
									},
									{
										"source": {
											"name": "categoryname",
											"type": "String",
											"physicalType": "nvarchar"
										},
										"sink": {
											"name": "CategoryName",
											"type": "String",
											"physicalType": "nvarchar"
										}
									}
								],
								"typeConversion": true,
								"typeConversionSettings": {
									"allowDataTruncation": true,
									"treatBooleanAsNumber": false
								}
							}
						},
						"inputs": [
							{
								"referenceName": "DS_POR",
								"type": "DatasetReference",
								"parameters": {
									"schema_name": "dbo",
									"table_name": "user"
								}
							}
						],
						"outputs": [
							{
								"referenceName": "Briggs_MDW",
								"type": "DatasetReference",
								"parameters": {
									"schema_name": "POR",
									"table_name": "Executive_Dashboard_Rent_Stage_Detail"
								}
							}
						]
					},
					{
						"name": "EXECUTIVE_DASHBOARD_EQUIPMENT_STAGE_Detail",
						"type": "Copy",
						"dependsOn": [
							{
								"activity": "EXECUTIVE_DASHBOARD_RENT_STAGE_Detail",
								"dependencyConditions": [
									"Succeeded"
								]
							}
						],
						"policy": {
							"timeout": "7.00:00:00",
							"retry": 0,
							"retryIntervalInSeconds": 30,
							"secureOutput": false,
							"secureInput": false
						},
						"userProperties": [],
						"typeProperties": {
							"source": {
								"type": "SqlServerSource",
								"sqlReaderQuery": "SELECT \nstore,cast(tca.[date] as date) as date,\n  ISNULL(SUM(CASE WHEN ti.TXTY = 'SA' AND ifi.Asset = 1 AND (tca.AssetTx <> 0 OR tca.AssetNT <> 0) THEN ti.PRIC  END), '')\n  AS UsedEquipmentRevenue,\n     ISNULL(SUM(CASE WHEN ti.TXTY = 'SA' AND ifi.Asset = 1 AND (tca.AssetTx <> 0 OR tca.AssetNT <> 0) THEN ifi.PURP  END), '')\n  AS UsedEquipmentCost\n  ,\n  ISNULL(SUM(CASE WHEN ti.TXTY = 'SS' AND \nifi.Asset = 0 AND ifi.SerialNumber <> '' AND (tca.SaleTx <> 0 OR tca.SaleNT <> 0) THEN ti.PRIC  END), '')\nAS NewEquipmentRevenue,\n\n ISNULL(SUM(CASE WHEN ti.TXTY = 'SS' AND \nifi.Asset = 0 AND ifi.SerialNumber <> '' AND (tca.SaleTx <> 0 OR tca.SaleNT <> 0) THEN ifi.PURP  END), '')\nAS NewEquipmentCost,\n\nsum(ifi.purp) as Purchase_Price, sum(ifi.curv) as Current_Book_Price\n,CASE WHEN t.PYMT = 'E' THEN 'Account' ELSE 'Cash' END AS CustomerType\n, cf.[CNUM] AS [Customer Number]\n, cf.[Name] AS [Customer Name]\n, t.[CNTR] AS [Contract No]\n, t.[DATE] AS [Contract Date]\n,TI.[TXTY]\n, ifi.[Name] ItemName,ifi.[Key] As [ItemKey],ifi.MANF As [Make],\nifi.MODN As [Model],\nifi.ModelYear,ic.[Name] categoryname\nFROM POR.dbo.TotalsContractsAccrual tca\nJOIN POR.dbo.Transactions t ON t.CNTR = tca.CNTR\nJOIN POR.dbo.TransactionItems ti ON ti.CNTR = t.CNTR\nJOIN POR.dbo.ItemFile ifi ON ifi.NUM = ti.ITEM\nINNER JOIN por.dbo.CustomerFile CF ON T.[CUSN] = CF.[CNUM]\nJOIN POR.dbo.ItemCategory ic ON ifi.Category = ic.Category\ngroup by store,cast(tca.[date] as date)  \n,CASE WHEN t.PYMT = 'E' THEN 'Account' ELSE 'Cash' END \n, cf.[CNUM]\n, cf.[Name]\n, t.[CNTR]\n, t.[DATE] \n,TI.[TXTY],ifi.[Name] ,ifi.[Key] ,ifi.MANF ,ic.[Name],\nifi.MODN ,ifi.ModelYear",
								"queryTimeout": "02:00:00",
								"partitionOption": "None"
							},
							"sink": {
								"type": "AzureSqlSink",
								"preCopyScript": "truncate table [POR].[Executive_Dashboard_Equipment_Stage_Detail];",
								"writeBehavior": "insert",
								"sqlWriterUseTableLock": false,
								"disableMetricsCollection": false
							},
							"enableStaging": false,
							"translator": {
								"type": "TabularTranslator",
								"mappings": [
									{
										"source": {
											"name": "store",
											"type": "String",
											"physicalType": "nvarchar"
										},
										"sink": {
											"name": "store",
											"type": "String",
											"physicalType": "nvarchar"
										}
									},
									{
										"source": {
											"name": "date",
											"type": "DateTime",
											"physicalType": "date"
										},
										"sink": {
											"name": "date",
											"type": "DateTime",
											"physicalType": "date"
										}
									},
									{
										"source": {
											"name": "UsedEquipmentRevenue",
											"type": "Decimal",
											"physicalType": "money",
											"scale": 4,
											"precision": 19
										},
										"sink": {
											"name": "UsedEquipmentRevenue",
											"type": "Decimal",
											"physicalType": "money",
											"scale": 4,
											"precision": 19
										}
									},
									{
										"source": {
											"name": "UsedEquipmentCost",
											"type": "Decimal",
											"physicalType": "money",
											"scale": 4,
											"precision": 19
										},
										"sink": {
											"name": "UsedEquipmentCost",
											"type": "Decimal",
											"physicalType": "money",
											"scale": 4,
											"precision": 19
										}
									},
									{
										"source": {
											"name": "NewEquipmentRevenue",
											"type": "Decimal",
											"physicalType": "money",
											"scale": 4,
											"precision": 19
										},
										"sink": {
											"name": "NewEquipmentRevenue",
											"type": "Decimal",
											"physicalType": "money",
											"scale": 4,
											"precision": 19
										}
									},
									{
										"source": {
											"name": "NewEquipmentCost",
											"type": "Decimal",
											"physicalType": "money",
											"scale": 4,
											"precision": 19
										},
										"sink": {
											"name": "NewEquipmentCost",
											"type": "Decimal",
											"physicalType": "money",
											"scale": 4,
											"precision": 19
										}
									},
									{
										"source": {
											"name": "Purchase_Price",
											"type": "Decimal",
											"physicalType": "money",
											"scale": 4,
											"precision": 19
										},
										"sink": {
											"name": "Purchase_Price",
											"type": "Decimal",
											"physicalType": "money",
											"scale": 4,
											"precision": 19
										}
									},
									{
										"source": {
											"name": "Current_Book_Price",
											"type": "Decimal",
											"physicalType": "money",
											"scale": 4,
											"precision": 19
										},
										"sink": {
											"name": "Current_Book_Price",
											"type": "Decimal",
											"physicalType": "money",
											"scale": 4,
											"precision": 19
										}
									},
									{
										"source": {
											"name": "CustomerType",
											"type": "String",
											"physicalType": "varchar"
										},
										"sink": {
											"name": "CustomerType",
											"type": "String",
											"physicalType": "varchar"
										}
									},
									{
										"source": {
											"name": "Customer Number",
											"type": "String",
											"physicalType": "nvarchar"
										},
										"sink": {
											"name": "Customer Number",
											"type": "String",
											"physicalType": "nvarchar"
										}
									},
									{
										"source": {
											"name": "Customer Name",
											"type": "String",
											"physicalType": "nvarchar"
										},
										"sink": {
											"name": "Customer Name",
											"type": "String",
											"physicalType": "nvarchar"
										}
									},
									{
										"source": {
											"name": "Contract No",
											"type": "String",
											"physicalType": "nvarchar"
										},
										"sink": {
											"name": "Contract No",
											"type": "String",
											"physicalType": "nvarchar"
										}
									},
									{
										"source": {
											"name": "Contract Date",
											"type": "DateTime",
											"physicalType": "datetime"
										},
										"sink": {
											"name": "Contract Date",
											"type": "DateTime",
											"physicalType": "datetime"
										}
									},
									{
										"source": {
											"name": "TXTY",
											"type": "String",
											"physicalType": "nvarchar"
										},
										"sink": {
											"name": "TXTY",
											"type": "String",
											"physicalType": "nvarchar"
										}
									},
									{
										"source": {
											"name": "ItemKey",
											"type": "String",
											"physicalType": "nvarchar"
										},
										"sink": {
											"name": "ItemKey",
											"type": "String",
											"physicalType": "nvarchar"
										}
									},
									{
										"source": {
											"name": "ItemName",
											"type": "String",
											"physicalType": "nvarchar"
										},
										"sink": {
											"name": "ItemName",
											"type": "String",
											"physicalType": "nvarchar"
										}
									},
									{
										"source": {
											"name": "Make",
											"type": "String",
											"physicalType": "nvarchar"
										},
										"sink": {
											"name": "Make",
											"type": "String",
											"physicalType": "nvarchar"
										}
									},
									{
										"source": {
											"name": "Model",
											"type": "String",
											"physicalType": "nvarchar"
										},
										"sink": {
											"name": "Model",
											"type": "String",
											"physicalType": "nvarchar"
										}
									},
									{
										"source": {
											"name": "ModelYear",
											"type": "String",
											"physicalType": "nvarchar"
										},
										"sink": {
											"name": "ModelYear",
											"type": "String",
											"physicalType": "nvarchar"
										}
									},
									{
										"source": {
											"name": "categoryname",
											"type": "String",
											"physicalType": "nvarchar"
										},
										"sink": {
											"name": "CategoryName",
											"type": "String",
											"physicalType": "nvarchar"
										}
									}
								],
								"typeConversion": true,
								"typeConversionSettings": {
									"allowDataTruncation": true,
									"treatBooleanAsNumber": false
								}
							}
						},
						"inputs": [
							{
								"referenceName": "DS_POR",
								"type": "DatasetReference",
								"parameters": {
									"schema_name": "dbo",
									"table_name": "user"
								}
							}
						],
						"outputs": [
							{
								"referenceName": "Briggs_MDW",
								"type": "DatasetReference",
								"parameters": {
									"schema_name": "POR",
									"table_name": "Executive_Dashboard_Equipment_Stage_Detail"
								}
							}
						]
					}
				],
				"policy": {
					"elapsedTimeMetric": {},
					"cancelAfter": {}
				},
				"folder": {
					"name": "MDP POR DataLoad"
				},
				"annotations": [],
				"lastPublishTime": "2022-04-27T15:23:30Z"
			},
			"dependsOn": [
				"[concat(variables('workspaceId'), '/datasets/DS_POR')]",
				"[concat(variables('workspaceId'), '/datasets/Briggs_MDW')]",
				"[concat(variables('workspaceId'), '/linkedServices/DS_MDW_SP')]"
			]
		},
		{
			"name": "[concat(parameters('workspaceName'), '/PL_SCALE_AZURE_SQL_DW')]",
			"type": "Microsoft.Synapse/workspaces/pipelines",
			"apiVersion": "2019-06-01-preview",
			"properties": {
				"activities": [
					{
						"name": "Until SQL POOL is Paused or Online",
						"type": "Until",
						"dependsOn": [],
						"userProperties": [],
						"typeProperties": {
							"expression": {
								"value": "@or(bool(startswith(activity('Check for changed SQLPool Status').Output.Properties.status,'Paused')),Bool(startswith(activity('Check for changed SQLPool Status').Output.Properties.status,'Online')))",
								"type": "Expression"
							},
							"activities": [
								{
									"name": "Check for changed SQLPool Status",
									"type": "WebActivity",
									"dependsOn": [],
									"policy": {
										"timeout": "7.00:00:00",
										"retry": 0,
										"retryIntervalInSeconds": 30,
										"secureOutput": false,
										"secureInput": false
									},
									"userProperties": [],
									"typeProperties": {
										"url": {
											"value": "https://management.azure.com/subscriptions/@{pipeline().parameters.SubscriptionID}/resourceGroups/@{pipeline().parameters.Synapse_ResourceGroupName}/providers/Microsoft.Synapse/workspaces/@{pipeline().parameters.SynapseWorkspace}/sqlPools/@{pipeline().parameters.SynapseDedicatedSQLPool}/?api-version=2019-06-01-preview",
											"type": "Expression"
										},
										"connectVia": {
											"referenceName": "AutoResolveIntegrationRuntime",
											"type": "IntegrationRuntimeReference"
										},
										"method": "GET",
										"headers": {},
										"authentication": {
											"type": "MSI",
											"resource": "https://management.azure.com/"
										}
									}
								},
								{
									"name": "Wait1",
									"type": "Wait",
									"dependsOn": [
										{
											"activity": "Check for changed SQLPool Status",
											"dependencyConditions": [
												"Succeeded"
											]
										}
									],
									"userProperties": [],
									"typeProperties": {
										"waitTimeInSeconds": {
											"value": "@pipeline().parameters.WaitTimeUntil",
											"type": "Expression"
										}
									}
								}
							],
							"timeout": "0.00:20:00"
						}
					},
					{
						"name": "Check if SQL POOL is Paused",
						"type": "IfCondition",
						"dependsOn": [
							{
								"activity": "Until SQL POOL is Paused or Online",
								"dependencyConditions": [
									"Succeeded"
								]
							}
						],
						"userProperties": [],
						"typeProperties": {
							"expression": {
								"value": "@bool(startswith(activity('Check for changed SQLPool Status').Output.Properties.status,'Paused'))",
								"type": "Expression"
							},
							"ifTrueActivities": [
								{
									"name": "Web1",
									"type": "WebActivity",
									"dependsOn": [],
									"policy": {
										"timeout": "7.00:00:00",
										"retry": 0,
										"retryIntervalInSeconds": 30,
										"secureOutput": false,
										"secureInput": false
									},
									"userProperties": [],
									"typeProperties": {
										"url": {
											"value": "https://management.azure.com/subscriptions/{pipeline().parameters.SubscriptionID}/resourceGroups/{pipeline().parameters.Synapse_ResourceGroupName}/providers/Microsoft.Synapse/workspaces/{pipeline().parameters.SynapseWorkspace}/sqlPools/{pipeline().parameters.SynapseDedicatedSQLPool}/@{pipeline().parameters.Action}?api-version=2019-06-01-preview",
											"type": "Expression"
										},
										"connectVia": {
											"referenceName": "AutoResolveIntegrationRuntime",
											"type": "IntegrationRuntimeReference"
										},
										"method": "POST",
										"headers": {},
										"body": "The",
										"authentication": {
											"type": "MSI",
											"resource": "https://management.azure.com/"
										}
									}
								},
								{
									"name": "Wait2",
									"type": "Wait",
									"dependsOn": [
										{
											"activity": "Web1",
											"dependencyConditions": [
												"Succeeded"
											]
										}
									],
									"userProperties": [],
									"typeProperties": {
										"waitTimeInSeconds": {
											"value": "@pipeline().parameters.WaitTime",
											"type": "Expression"
										}
									}
								}
							]
						}
					},
					{
						"name": "Scale SQL Pool",
						"type": "WebActivity",
						"dependsOn": [
							{
								"activity": "Check if SQL POOL is Paused",
								"dependencyConditions": [
									"Succeeded"
								]
							}
						],
						"policy": {
							"timeout": "7.00:00:00",
							"retry": 0,
							"retryIntervalInSeconds": 30,
							"secureOutput": false,
							"secureInput": false
						},
						"userProperties": [],
						"typeProperties": {
							"url": {
								"value": "https://management.azure.com/subscriptions/@{pipeline().parameters.SubscriptionID}/resourceGroups/@{pipeline().parameters.Synapse_ResourceGroupName}/providers/Microsoft.Synapse/workspaces/@{pipeline().parameters.SynapseWorkspace}/sqlPools/@{pipeline().parameters.SynapseDedicatedSQLPool}/?api-version=2019-06-01-preview",
								"type": "Expression"
							},
							"connectVia": {
								"referenceName": "AutoResolveIntegrationRuntime",
								"type": "IntegrationRuntimeReference"
							},
							"method": "PATCH",
							"headers": {
								"Content-Type": "application/json"
							},
							"body": {
								"value": "{\"sku\": { \"name\": '@{pipeline().parameters.PerformanceLevel}' } }",
								"type": "Expression"
							},
							"authentication": {
								"type": "MSI",
								"resource": "https://management.azure.com/"
							}
						}
					}
				],
				"policy": {
					"elapsedTimeMetric": {},
					"cancelAfter": {}
				},
				"parameters": {
					"Action": {
						"type": "string",
						"defaultValue": "Resume"
					},
					"WaitTime": {
						"type": "int",
						"defaultValue": 10
					},
					"WaitTimeUntil": {
						"type": "int",
						"defaultValue": 30
					},
					"Synapse_ResourceGroupName": {
						"type": "string",
						"defaultValue": "TalendResources"
					},
					"SynapseWorkspace": {
						"type": "string",
						"defaultValue": "briggs-p-wus-syn-01"
					},
					"SynapseDedicatedSQLPool": {
						"type": "string",
						"defaultValue": "briggsmdw"
					},
					"SubscriptionID": {
						"type": "string",
						"defaultValue": "92e01a22-48f8-44af-9e12-81a013ff7882"
					},
					"PerformanceLevel": {
						"type": "string",
						"defaultValue": "DW500c"
					}
				},
				"folder": {
					"name": "Briggs Data Load Theme wise"
				},
				"annotations": [],
				"lastPublishTime": "2022-04-07T07:07:44Z"
			},
			"dependsOn": [
				"[concat(variables('workspaceId'), '/integrationRuntimes/AutoResolveIntegrationRuntime')]"
			]
		},
		{
			"name": "[concat(parameters('workspaceName'), '/POR_Source_Table_Load')]",
			"type": "Microsoft.Synapse/workspaces/pipelines",
			"apiVersion": "2019-06-01-preview",
			"properties": {
				"activities": [
					{
						"name": "POR_Lookup",
						"type": "Lookup",
						"dependsOn": [],
						"policy": {
							"timeout": "7.00:00:00",
							"retry": 0,
							"retryIntervalInSeconds": 30,
							"secureOutput": false,
							"secureInput": false
						},
						"userProperties": [],
						"typeProperties": {
							"source": {
								"type": "AzureSqlSource",
								"sqlReaderQuery": "Select Distinct ID From dbo.control_table_por Where ProcessName = 'AzSQL_ADLS'  and sourcedb='POR'\nand EnableAction = 1  order by ID",
								"queryTimeout": "02:00:00",
								"partitionOption": "None"
							},
							"dataset": {
								"referenceName": "Briggs_MDW",
								"type": "DatasetReference",
								"parameters": {
									"schema_name": "dbo",
									"table_name": "user"
								}
							},
							"firstRowOnly": false
						}
					},
					{
						"name": "ForEach_POR_Load",
						"type": "ForEach",
						"dependsOn": [
							{
								"activity": "POR_Lookup",
								"dependencyConditions": [
									"Succeeded"
								]
							}
						],
						"userProperties": [],
						"typeProperties": {
							"items": {
								"value": "@activity('POR_Lookup').output.value",
								"type": "Expression"
							},
							"activities": [
								{
									"name": "Lookup_POR",
									"type": "Lookup",
									"dependsOn": [],
									"policy": {
										"timeout": "7.00:00:00",
										"retry": 0,
										"retryIntervalInSeconds": 30,
										"secureOutput": false,
										"secureInput": false
									},
									"userProperties": [],
									"typeProperties": {
										"source": {
											"type": "AzureSqlSource",
											"sqlReaderQuery": {
												"value": "@concat('select SourceQuery=''select '' +columnList+ '' from ''+ sourceDB+''.''+SourceSchemaName+''.''+SourcetableName\n,SourceDB\n,TargetContainer\n, TargetPath, TargetFile, FileFormat,targetstagetableschema,targetstagetablename\nfrom dbo.control_table_por\nwhere ID= ',item().ID)",
												"type": "Expression"
											},
											"queryTimeout": "02:00:00",
											"partitionOption": "None"
										},
										"dataset": {
											"referenceName": "Briggs_MDW",
											"type": "DatasetReference",
											"parameters": {
												"schema_name": "dbo",
												"table_name": "user"
											}
										}
									}
								},
								{
									"name": "Copy_POR_ADLS",
									"type": "Copy",
									"dependsOn": [
										{
											"activity": "Lookup_POR",
											"dependencyConditions": [
												"Succeeded"
											]
										}
									],
									"policy": {
										"timeout": "7.00:00:00",
										"retry": 0,
										"retryIntervalInSeconds": 30,
										"secureOutput": false,
										"secureInput": false
									},
									"userProperties": [],
									"typeProperties": {
										"source": {
											"type": "SqlServerSource",
											"sqlReaderQuery": {
												"value": "@activity('Lookup_POR').output.firstRow.SourceQuery\n",
												"type": "Expression"
											},
											"queryTimeout": "02:00:00",
											"partitionOption": "None"
										},
										"sink": {
											"type": "AzureSqlSink",
											"preCopyScript": {
												"value": "@{concat('truncate table ',activity('Lookup_POR').output.firstRow.TargetStageTableSchema,'.',activity('Lookup_POR').output.firstRow.TargetStageTableName)}\n",
												"type": "Expression"
											},
											"disableMetricsCollection": false
										},
										"enableStaging": false,
										"translator": {
											"type": "TabularTranslator",
											"typeConversion": true,
											"typeConversionSettings": {
												"allowDataTruncation": true,
												"treatBooleanAsNumber": false
											}
										}
									},
									"inputs": [
										{
											"referenceName": "DS_POR",
											"type": "DatasetReference",
											"parameters": {
												"schema_name": "dbo",
												"table_name": "user"
											}
										}
									],
									"outputs": [
										{
											"referenceName": "Briggs_MDW",
											"type": "DatasetReference",
											"parameters": {
												"schema_name": {
													"value": "@activity('Lookup_POR').output.firstRow.TargetStageTableSchema",
													"type": "Expression"
												},
												"table_name": {
													"value": "@activity('Lookup_POR').output.firstRow.TargetStageTableName",
													"type": "Expression"
												}
											}
										}
									]
								},
								{
									"name": "Copy_POR_ADLS_copy1",
									"type": "Copy",
									"dependsOn": [
										{
											"activity": "Copy_POR_ADLS",
											"dependencyConditions": [
												"Failed"
											]
										}
									],
									"policy": {
										"timeout": "7.00:00:00",
										"retry": 0,
										"retryIntervalInSeconds": 30,
										"secureOutput": false,
										"secureInput": false
									},
									"userProperties": [],
									"typeProperties": {
										"source": {
											"type": "SqlServerSource",
											"sqlReaderQuery": {
												"value": "@activity('Lookup_POR').output.firstRow.SourceQuery\n",
												"type": "Expression"
											},
											"queryTimeout": "02:00:00",
											"partitionOption": "None"
										},
										"sink": {
											"type": "AzureSqlSink",
											"writeBehavior": "insert",
											"sqlWriterUseTableLock": false,
											"tableOption": "autoCreate",
											"disableMetricsCollection": false
										},
										"enableStaging": false,
										"translator": {
											"type": "TabularTranslator",
											"typeConversion": true,
											"typeConversionSettings": {
												"allowDataTruncation": true,
												"treatBooleanAsNumber": false
											}
										}
									},
									"inputs": [
										{
											"referenceName": "DS_POR",
											"type": "DatasetReference",
											"parameters": {
												"schema_name": "dbo",
												"table_name": "user"
											}
										}
									],
									"outputs": [
										{
											"referenceName": "Briggs_MDW",
											"type": "DatasetReference",
											"parameters": {
												"schema_name": {
													"value": "@activity('Lookup_POR').output.firstRow.TargetStageTableSchema",
													"type": "Expression"
												},
												"table_name": {
													"value": "@activity('Lookup_POR').output.firstRow.TargetStageTableName",
													"type": "Expression"
												}
											}
										}
									]
								}
							]
						}
					}
				],
				"policy": {
					"elapsedTimeMetric": {},
					"cancelAfter": {}
				},
				"folder": {
					"name": "MDP POR DataLoad"
				},
				"annotations": [],
				"lastPublishTime": "2022-04-29T08:20:38Z"
			},
			"dependsOn": [
				"[concat(variables('workspaceId'), '/datasets/Briggs_MDW')]",
				"[concat(variables('workspaceId'), '/datasets/DS_POR')]"
			]
		},
		{
			"name": "[concat(parameters('workspaceName'), '/Pipeline 1')]",
			"type": "Microsoft.Synapse/workspaces/pipelines",
			"apiVersion": "2019-06-01-preview",
			"properties": {
				"activities": [
					{
						"name": "Wait1",
						"type": "Wait",
						"dependsOn": [],
						"userProperties": [],
						"typeProperties": {
							"waitTimeInSeconds": 1
						}
					}
				],
				"policy": {
					"elapsedTimeMetric": {},
					"cancelAfter": {}
				},
				"folder": {
					"name": "Netsuite"
				},
				"annotations": []
			},
			"dependsOn": []
		},
		{
			"name": "[concat(parameters('workspaceName'), '/Briggs_MDW')]",
			"type": "Microsoft.Synapse/workspaces/datasets",
			"apiVersion": "2019-06-01-preview",
			"properties": {
				"linkedServiceName": {
					"referenceName": "AzureSqlDatabase1",
					"type": "LinkedServiceReference"
				},
				"parameters": {
					"schema_name": {
						"type": "string",
						"defaultValue": "dbo"
					},
					"table_name": {
						"type": "string",
						"defaultValue": "user"
					}
				},
				"annotations": [],
				"type": "AzureSqlTable",
				"schema": [],
				"typeProperties": {
					"schema": {
						"value": "@dataset().schema_name",
						"type": "Expression"
					},
					"table": {
						"value": "@dataset().table_name",
						"type": "Expression"
					}
				}
			},
			"dependsOn": [
				"[concat(variables('workspaceId'), '/linkedServices/AzureSqlDatabase1')]"
			]
		},
		{
			"name": "[concat(parameters('workspaceName'), '/Briggs_MST')]",
			"type": "Microsoft.Synapse/workspaces/datasets",
			"apiVersion": "2019-06-01-preview",
			"properties": {
				"linkedServiceName": {
					"referenceName": "LS_Briggs_MST",
					"type": "LinkedServiceReference"
				},
				"annotations": [],
				"type": "SqlServerTable",
				"schema": [],
				"typeProperties": {}
			},
			"dependsOn": [
				"[concat(variables('workspaceId'), '/linkedServices/LS_Briggs_MST')]"
			]
		},
		{
			"name": "[concat(parameters('workspaceName'), '/DS_ADLS_PARQUET')]",
			"type": "Microsoft.Synapse/workspaces/datasets",
			"apiVersion": "2019-06-01-preview",
			"properties": {
				"linkedServiceName": {
					"referenceName": "LS_ADLS",
					"type": "LinkedServiceReference"
				},
				"parameters": {
					"FileName": {
						"type": "string"
					}
				},
				"annotations": [],
				"type": "Parquet",
				"typeProperties": {
					"location": {
						"type": "AzureBlobFSLocation",
						"fileName": {
							"value": "@dataset().FileName",
							"type": "Expression"
						},
						"folderPath": "Daily_Files",
						"fileSystem": "main"
					},
					"compressionCodec": "snappy"
				},
				"schema": []
			},
			"dependsOn": [
				"[concat(variables('workspaceId'), '/linkedServices/LS_ADLS')]"
			]
		},
		{
			"name": "[concat(parameters('workspaceName'), '/DS_ADLS_PARQUET_MAIN')]",
			"type": "Microsoft.Synapse/workspaces/datasets",
			"apiVersion": "2019-06-01-preview",
			"properties": {
				"linkedServiceName": {
					"referenceName": "LS_ADLS",
					"type": "LinkedServiceReference"
				},
				"parameters": {
					"FileName": {
						"type": "string"
					}
				},
				"annotations": [],
				"type": "Parquet",
				"typeProperties": {
					"location": {
						"type": "AzureBlobFSLocation",
						"fileName": {
							"value": "@dataset().FileName",
							"type": "Expression"
						},
						"folderPath": "Data",
						"fileSystem": "main"
					},
					"compressionCodec": "snappy"
				},
				"schema": [
					{
						"name": "displayvalue",
						"type": "UTF8"
					},
					{
						"name": "inventlocationid",
						"type": "UTF8"
					},
					{
						"name": "INVOICEACCOUNT",
						"type": "UTF8"
					},
					{
						"name": "INVOICEACCOUNTNAME",
						"type": "UTF8"
					},
					{
						"name": "CUSTGROUP",
						"type": "UTF8"
					},
					{
						"name": "CUSTACCOUNT",
						"type": "UTF8"
					},
					{
						"name": "CUSTNAME",
						"type": "UTF8"
					},
					{
						"name": "CALLTYPEID",
						"type": "UTF8"
					},
					{
						"name": "PROJINVOICEID",
						"type": "UTF8"
					},
					{
						"name": "INVOICEDATE",
						"type": "INT96"
					},
					{
						"name": "equipmentid",
						"type": "UTF8"
					},
					{
						"name": "INVENTSERIALID",
						"type": "UTF8"
					},
					{
						"name": "MANUFACTURERID",
						"type": "UTF8"
					},
					{
						"name": "TYPEID",
						"type": "UTF8"
					},
					{
						"name": "Labor",
						"type": "DECIMAL",
						"precision": 10,
						"scale": 2
					},
					{
						"name": "Parts",
						"type": "DECIMAL",
						"precision": 10,
						"scale": 2
					},
					{
						"name": "Misc",
						"type": "DECIMAL",
						"precision": 10,
						"scale": 2
					},
					{
						"name": "Tax",
						"type": "DECIMAL",
						"precision": 10,
						"scale": 2
					},
					{
						"name": "INVOICEAMOUNT",
						"type": "DECIMAL",
						"precision": 10,
						"scale": 2
					},
					{
						"name": "Comment_Preview",
						"type": "UTF8"
					},
					{
						"name": "Comments",
						"type": "UTF8"
					},
					{
						"name": "sort",
						"type": "INT32"
					},
					{
						"name": "SVCCALLID",
						"type": "UTF8"
					},
					{
						"name": "WennsoftId",
						"type": "UTF8"
					},
					{
						"name": "METERREADING",
						"type": "DECIMAL",
						"precision": 32,
						"scale": 16
					},
					{
						"name": "invoice_created_by",
						"type": "UTF8"
					},
					{
						"name": "CREATEDDATETIME",
						"type": "INT96"
					},
					{
						"name": "sc_created_by",
						"type": "UTF8"
					},
					{
						"name": "svcCreateDate",
						"type": "INT96"
					},
					{
						"name": "PONUMBER",
						"type": "UTF8"
					},
					{
						"name": "PERSONNELNUMBER",
						"type": "UTF8"
					},
					{
						"name": "date",
						"type": "INT96"
					},
					{
						"name": "batchtemplateid",
						"type": "UTF8"
					},
					{
						"name": "FINDINGSORCOMMENTS",
						"type": "UTF8"
					},
					{
						"name": "CORRECTION",
						"type": "UTF8"
					},
					{
						"name": "SUBJECT",
						"type": "UTF8"
					},
					{
						"name": "Shiptoaddress",
						"type": "UTF8"
					}
				]
			},
			"dependsOn": [
				"[concat(variables('workspaceId'), '/linkedServices/LS_ADLS')]"
			]
		},
		{
			"name": "[concat(parameters('workspaceName'), '/DS_ADLS_PARQUET_TEST')]",
			"type": "Microsoft.Synapse/workspaces/datasets",
			"apiVersion": "2019-06-01-preview",
			"properties": {
				"linkedServiceName": {
					"referenceName": "LS_ADLS",
					"type": "LinkedServiceReference"
				},
				"parameters": {
					"FileName": {
						"type": "string"
					}
				},
				"annotations": [],
				"type": "Parquet",
				"typeProperties": {
					"location": {
						"type": "AzureBlobFSLocation",
						"fileName": {
							"value": "@dataset().FileName",
							"type": "Expression"
						},
						"folderPath": "SourceTables",
						"fileSystem": "main"
					},
					"compressionCodec": "snappy"
				},
				"schema": []
			},
			"dependsOn": [
				"[concat(variables('workspaceId'), '/linkedServices/LS_ADLS')]"
			]
		},
		{
			"name": "[concat(parameters('workspaceName'), '/DS_ADLS_Parquet_1')]",
			"type": "Microsoft.Synapse/workspaces/datasets",
			"apiVersion": "2019-06-01-preview",
			"properties": {
				"linkedServiceName": {
					"referenceName": "LS_ADLS_1",
					"type": "LinkedServiceReference"
				},
				"parameters": {
					"ContainerName": {
						"type": "string"
					},
					"Path": {
						"type": "string"
					},
					"FileName": {
						"type": "string"
					}
				},
				"annotations": [],
				"type": "Parquet",
				"typeProperties": {
					"location": {
						"type": "AzureBlobStorageLocation",
						"fileName": {
							"value": "@dataset().FileName",
							"type": "Expression"
						},
						"folderPath": {
							"value": "@dataset().Path",
							"type": "Expression"
						},
						"container": {
							"value": "@dataset().ContainerName",
							"type": "Expression"
						}
					},
					"compressionCodec": "snappy"
				},
				"schema": []
			},
			"dependsOn": [
				"[concat(variables('workspaceId'), '/linkedServices/LS_ADLS_1')]"
			]
		},
		{
			"name": "[concat(parameters('workspaceName'), '/DS_BIE_DATA_WAREHOUSE')]",
			"type": "Microsoft.Synapse/workspaces/datasets",
			"apiVersion": "2019-06-01-preview",
			"properties": {
				"linkedServiceName": {
					"referenceName": "LS_Briggs_BIE_DATA_WAREHOUSE",
					"type": "LinkedServiceReference"
				},
				"annotations": [],
				"type": "SqlServerTable",
				"schema": [],
				"typeProperties": {}
			},
			"dependsOn": [
				"[concat(variables('workspaceId'), '/linkedServices/LS_Briggs_BIE_DATA_WAREHOUSE')]"
			]
		},
		{
			"name": "[concat(parameters('workspaceName'), '/DS_BriggsAX')]",
			"type": "Microsoft.Synapse/workspaces/datasets",
			"apiVersion": "2019-06-01-preview",
			"properties": {
				"linkedServiceName": {
					"referenceName": "LS_Briggs_AX",
					"type": "LinkedServiceReference"
				},
				"annotations": [],
				"type": "SqlServerTable",
				"schema": [],
				"typeProperties": {}
			},
			"dependsOn": [
				"[concat(variables('workspaceId'), '/linkedServices/LS_Briggs_AX')]"
			]
		},
		{
			"name": "[concat(parameters('workspaceName'), '/DS_BriggsHR')]",
			"type": "Microsoft.Synapse/workspaces/datasets",
			"apiVersion": "2019-06-01-preview",
			"properties": {
				"linkedServiceName": {
					"referenceName": "LS_Briggs_HR",
					"type": "LinkedServiceReference"
				},
				"annotations": [],
				"type": "SqlServerTable",
				"schema": [],
				"typeProperties": {}
			},
			"dependsOn": [
				"[concat(variables('workspaceId'), '/linkedServices/LS_Briggs_HR')]"
			]
		},
		{
			"name": "[concat(parameters('workspaceName'), '/DS_Briggs_MST')]",
			"type": "Microsoft.Synapse/workspaces/datasets",
			"apiVersion": "2019-06-01-preview",
			"properties": {
				"linkedServiceName": {
					"referenceName": "LS_Briggs_MST",
					"type": "LinkedServiceReference"
				},
				"annotations": [],
				"type": "SqlServerTable",
				"schema": [],
				"typeProperties": {}
			},
			"dependsOn": [
				"[concat(variables('workspaceId'), '/linkedServices/LS_Briggs_MST')]"
			]
		},
		{
			"name": "[concat(parameters('workspaceName'), '/DS_POR')]",
			"type": "Microsoft.Synapse/workspaces/datasets",
			"apiVersion": "2019-06-01-preview",
			"properties": {
				"linkedServiceName": {
					"referenceName": "LS_POR99",
					"type": "LinkedServiceReference"
				},
				"parameters": {
					"schema_name": {
						"type": "string",
						"defaultValue": "dbo"
					},
					"table_name": {
						"type": "string",
						"defaultValue": "user"
					}
				},
				"annotations": [],
				"type": "SqlServerTable",
				"schema": [],
				"typeProperties": {
					"schema": {
						"value": "@dataset().schema_name",
						"type": "Expression"
					},
					"table": {
						"value": "@dataset().table_name",
						"type": "Expression"
					}
				}
			},
			"dependsOn": [
				"[concat(variables('workspaceId'), '/linkedServices/LS_POR99')]"
			]
		},
		{
			"name": "[concat(parameters('workspaceName'), '/NDS_POR')]",
			"type": "Microsoft.Synapse/workspaces/datasets",
			"apiVersion": "2019-06-01-preview",
			"properties": {
				"linkedServiceName": {
					"referenceName": "LS_POR",
					"type": "LinkedServiceReference"
				},
				"annotations": [],
				"type": "SqlServerTable",
				"schema": [],
				"typeProperties": {}
			},
			"dependsOn": [
				"[concat(variables('workspaceId'), '/linkedServices/LS_POR')]"
			]
		},
		{
			"name": "[concat(parameters('workspaceName'), '/OdbcTable1')]",
			"type": "Microsoft.Synapse/workspaces/datasets",
			"apiVersion": "2019-06-01-preview",
			"properties": {
				"linkedServiceName": {
					"referenceName": "Odbc2",
					"type": "LinkedServiceReference"
				},
				"annotations": [],
				"type": "OdbcTable",
				"schema": [],
				"typeProperties": {
					"tableName": "\"SIND - Data Warehouse\".\"Account\""
				}
			},
			"dependsOn": [
				"[concat(variables('workspaceId'), '/linkedServices/Odbc2')]"
			]
		},
		{
			"name": "[concat(parameters('workspaceName'), '/RestResource1')]",
			"type": "Microsoft.Synapse/workspaces/datasets",
			"apiVersion": "2019-06-01-preview",
			"properties": {
				"linkedServiceName": {
					"referenceName": "NetSuiteRestAPI",
					"type": "LinkedServiceReference"
				},
				"annotations": [],
				"type": "RestResource",
				"typeProperties": {},
				"schema": []
			},
			"dependsOn": [
				"[concat(variables('workspaceId'), '/linkedServices/NetSuiteRestAPI')]"
			]
		},
		{
			"name": "[concat(parameters('workspaceName'), '/AzureSqlDatabase1')]",
			"type": "Microsoft.Synapse/workspaces/linkedServices",
			"apiVersion": "2019-06-01-preview",
			"properties": {
				"annotations": [],
				"type": "AzureSqlDatabase",
				"typeProperties": {
					"connectionString": "[parameters('AzureSqlDatabase1_connectionString')]"
				},
				"connectVia": {
					"referenceName": "AutoResolveIntegrationRuntime",
					"type": "IntegrationRuntimeReference"
				}
			},
			"dependsOn": [
				"[concat(variables('workspaceId'), '/integrationRuntimes/AutoResolveIntegrationRuntime')]"
			]
		},
		{
			"name": "[concat(parameters('workspaceName'), '/AzureSqlDatabase2')]",
			"type": "Microsoft.Synapse/workspaces/linkedServices",
			"apiVersion": "2019-06-01-preview",
			"properties": {
				"annotations": [],
				"type": "AzureSqlDatabase",
				"typeProperties": {
					"connectionString": "[parameters('AzureSqlDatabase2_connectionString')]"
				},
				"connectVia": {
					"referenceName": "AutoResolveIntegrationRuntime",
					"type": "IntegrationRuntimeReference"
				}
			},
			"dependsOn": [
				"[concat(variables('workspaceId'), '/integrationRuntimes/AutoResolveIntegrationRuntime')]"
			]
		},
		{
			"name": "[concat(parameters('workspaceName'), '/AzureSynapseAnalytics1')]",
			"type": "Microsoft.Synapse/workspaces/linkedServices",
			"apiVersion": "2019-06-01-preview",
			"properties": {
				"annotations": [],
				"type": "AzureSqlDW",
				"typeProperties": {
					"connectionString": "[parameters('AzureSynapseAnalytics1_connectionString')]"
				},
				"connectVia": {
					"referenceName": "AutoResolveIntegrationRuntime",
					"type": "IntegrationRuntimeReference"
				}
			},
			"dependsOn": [
				"[concat(variables('workspaceId'), '/integrationRuntimes/AutoResolveIntegrationRuntime')]"
			]
		},
		{
			"name": "[concat(parameters('workspaceName'), '/CeridianAPITest')]",
			"type": "Microsoft.Synapse/workspaces/linkedServices",
			"apiVersion": "2019-06-01-preview",
			"properties": {
				"annotations": [],
				"type": "RestService",
				"typeProperties": {
					"url": "[parameters('CeridianAPITest_properties_typeProperties_url')]",
					"enableServerCertificateValidation": true,
					"authenticationType": "Basic",
					"userName": "[parameters('CeridianAPITest_properties_typeProperties_userName')]",
					"password": {
						"type": "SecureString",
						"value": "[parameters('CeridianAPITest_password')]"
					}
				},
				"connectVia": {
					"referenceName": "AutoResolveIntegrationRuntime",
					"type": "IntegrationRuntimeReference"
				}
			},
			"dependsOn": [
				"[concat(variables('workspaceId'), '/integrationRuntimes/AutoResolveIntegrationRuntime')]"
			]
		},
		{
			"name": "[concat(parameters('workspaceName'), '/DS_MDW_SP')]",
			"type": "Microsoft.Synapse/workspaces/linkedServices",
			"apiVersion": "2019-06-01-preview",
			"properties": {
				"annotations": [],
				"type": "AzureSqlDW",
				"typeProperties": {
					"connectionString": "[parameters('DS_MDW_SP_connectionString')]"
				},
				"connectVia": {
					"referenceName": "AutoResolveIntegrationRuntime",
					"type": "IntegrationRuntimeReference"
				}
			},
			"dependsOn": [
				"[concat(variables('workspaceId'), '/integrationRuntimes/AutoResolveIntegrationRuntime')]"
			]
		},
		{
			"name": "[concat(parameters('workspaceName'), '/LS_ADLS')]",
			"type": "Microsoft.Synapse/workspaces/linkedServices",
			"apiVersion": "2019-06-01-preview",
			"properties": {
				"annotations": [],
				"type": "AzureBlobFS",
				"typeProperties": {
					"url": "[parameters('LS_ADLS_properties_typeProperties_url')]",
					"accountKey": {
						"type": "SecureString",
						"value": "[parameters('LS_ADLS_accountKey')]"
					}
				},
				"connectVia": {
					"referenceName": "AutoResolveIntegrationRuntime",
					"type": "IntegrationRuntimeReference"
				}
			},
			"dependsOn": [
				"[concat(variables('workspaceId'), '/integrationRuntimes/AutoResolveIntegrationRuntime')]"
			]
		},
		{
			"name": "[concat(parameters('workspaceName'), '/LS_ADLS_1')]",
			"type": "Microsoft.Synapse/workspaces/linkedServices",
			"apiVersion": "2019-06-01-preview",
			"properties": {
				"annotations": [],
				"type": "AzureBlobStorage",
				"typeProperties": {
					"connectionString": "[parameters('LS_ADLS_1_connectionString')]"
				},
				"connectVia": {
					"referenceName": "AutoResolveIntegrationRuntime",
					"type": "IntegrationRuntimeReference"
				}
			},
			"dependsOn": [
				"[concat(variables('workspaceId'), '/integrationRuntimes/AutoResolveIntegrationRuntime')]"
			]
		},
		{
			"name": "[concat(parameters('workspaceName'), '/LS_Briggs_AX')]",
			"type": "Microsoft.Synapse/workspaces/linkedServices",
			"apiVersion": "2019-06-01-preview",
			"properties": {
				"annotations": [],
				"type": "SqlServer",
				"typeProperties": {
					"connectionString": "[parameters('LS_Briggs_AX_connectionString')]"
				},
				"connectVia": {
					"referenceName": "intrt-IntegrationRuntime",
					"type": "IntegrationRuntimeReference"
				}
			},
			"dependsOn": [
				"[concat(variables('workspaceId'), '/integrationRuntimes/intrt-IntegrationRuntime')]"
			]
		},
		{
			"name": "[concat(parameters('workspaceName'), '/LS_Briggs_BIE_DATA_WAREHOUSE')]",
			"type": "Microsoft.Synapse/workspaces/linkedServices",
			"apiVersion": "2019-06-01-preview",
			"properties": {
				"annotations": [],
				"type": "SqlServer",
				"typeProperties": {
					"connectionString": "[parameters('LS_Briggs_BIE_DATA_WAREHOUSE_connectionString')]"
				},
				"connectVia": {
					"referenceName": "IntegrationRuntimeBriggs1",
					"type": "IntegrationRuntimeReference"
				}
			},
			"dependsOn": [
				"[concat(variables('workspaceId'), '/integrationRuntimes/IntegrationRuntimeBriggs1')]"
			]
		},
		{
			"name": "[concat(parameters('workspaceName'), '/LS_Briggs_HR')]",
			"type": "Microsoft.Synapse/workspaces/linkedServices",
			"apiVersion": "2019-06-01-preview",
			"properties": {
				"annotations": [],
				"type": "SqlServer",
				"typeProperties": {
					"connectionString": "[parameters('LS_Briggs_HR_connectionString')]"
				},
				"connectVia": {
					"referenceName": "intrt-IntegrationRuntime",
					"type": "IntegrationRuntimeReference"
				}
			},
			"dependsOn": [
				"[concat(variables('workspaceId'), '/integrationRuntimes/intrt-IntegrationRuntime')]"
			]
		},
		{
			"name": "[concat(parameters('workspaceName'), '/LS_Briggs_MST')]",
			"type": "Microsoft.Synapse/workspaces/linkedServices",
			"apiVersion": "2019-06-01-preview",
			"properties": {
				"annotations": [],
				"type": "SqlServer",
				"typeProperties": {
					"connectionString": "[parameters('LS_Briggs_MST_connectionString')]"
				},
				"connectVia": {
					"referenceName": "intrt-IntegrationRuntime",
					"type": "IntegrationRuntimeReference"
				}
			},
			"dependsOn": [
				"[concat(variables('workspaceId'), '/integrationRuntimes/intrt-IntegrationRuntime')]"
			]
		},
		{
			"name": "[concat(parameters('workspaceName'), '/LS_Briggsmdw_MI_User')]",
			"type": "Microsoft.Synapse/workspaces/linkedServices",
			"apiVersion": "2019-06-01-preview",
			"properties": {
				"annotations": [],
				"type": "AzureSqlDatabase",
				"typeProperties": {
					"connectionString": "[parameters('LS_Briggsmdw_MI_User_connectionString')]"
				},
				"connectVia": {
					"referenceName": "AutoResolveIntegrationRuntime",
					"type": "IntegrationRuntimeReference"
				}
			},
			"dependsOn": [
				"[concat(variables('workspaceId'), '/integrationRuntimes/AutoResolveIntegrationRuntime')]"
			]
		},
		{
			"name": "[concat(parameters('workspaceName'), '/LS_POR')]",
			"type": "Microsoft.Synapse/workspaces/linkedServices",
			"apiVersion": "2019-06-01-preview",
			"properties": {
				"annotations": [],
				"type": "SqlServer",
				"typeProperties": {
					"connectionString": "[parameters('LS_POR_connectionString')]"
				},
				"connectVia": {
					"referenceName": "AutoResolveIntegrationRuntime",
					"type": "IntegrationRuntimeReference"
				}
			},
			"dependsOn": [
				"[concat(variables('workspaceId'), '/integrationRuntimes/AutoResolveIntegrationRuntime')]"
			]
		},
		{
			"name": "[concat(parameters('workspaceName'), '/LS_POR99')]",
			"type": "Microsoft.Synapse/workspaces/linkedServices",
			"apiVersion": "2019-06-01-preview",
			"properties": {
				"annotations": [],
				"type": "SqlServer",
				"typeProperties": {
					"connectionString": "[parameters('LS_POR99_connectionString')]"
				},
				"connectVia": {
					"referenceName": "intrt-IntegrationRuntime",
					"type": "IntegrationRuntimeReference"
				}
			},
			"dependsOn": [
				"[concat(variables('workspaceId'), '/integrationRuntimes/intrt-IntegrationRuntime')]"
			]
		},
		{
			"name": "[concat(parameters('workspaceName'), '/NetSuiteDataTeamRESTAPI')]",
			"type": "Microsoft.Synapse/workspaces/linkedServices",
			"apiVersion": "2019-06-01-preview",
			"properties": {
				"annotations": [],
				"type": "RestService",
				"typeProperties": {
					"url": "[parameters('NetSuiteDataTeamRESTAPI_properties_typeProperties_url')]",
					"enableServerCertificateValidation": true,
					"authenticationType": "Anonymous",
					"authHeaders": {
						"Authorization": {
							"type": "SecureString",
							"value": "**********"
						}
					}
				},
				"connectVia": {
					"referenceName": "AutoResolveIntegrationRuntime",
					"type": "IntegrationRuntimeReference"
				}
			},
			"dependsOn": [
				"[concat(variables('workspaceId'), '/integrationRuntimes/AutoResolveIntegrationRuntime')]"
			]
		},
		{
			"name": "[concat(parameters('workspaceName'), '/NetSuiteRestAPI')]",
			"type": "Microsoft.Synapse/workspaces/linkedServices",
			"apiVersion": "2019-06-01-preview",
			"properties": {
				"annotations": [],
				"type": "RestService",
				"typeProperties": {
					"url": "[parameters('NetSuiteRestAPI_properties_typeProperties_url')]",
					"enableServerCertificateValidation": true,
					"authenticationType": "Anonymous"
				},
				"connectVia": {
					"referenceName": "AutoResolveIntegrationRuntime",
					"type": "IntegrationRuntimeReference"
				}
			},
			"dependsOn": [
				"[concat(variables('workspaceId'), '/integrationRuntimes/AutoResolveIntegrationRuntime')]"
			]
		},
		{
			"name": "[concat(parameters('workspaceName'), '/NewPOR_test')]",
			"type": "Microsoft.Synapse/workspaces/linkedServices",
			"apiVersion": "2019-06-01-preview",
			"properties": {
				"description": "vm-porsql-p00.sammons.tech\n[10.13.5.4]",
				"annotations": [],
				"type": "SqlServer",
				"typeProperties": {
					"connectionString": "[parameters('NewPOR_test_connectionString')]"
				},
				"connectVia": {
					"referenceName": "intrt-IntegrationRuntime",
					"type": "IntegrationRuntimeReference"
				}
			},
			"dependsOn": [
				"[concat(variables('workspaceId'), '/integrationRuntimes/intrt-IntegrationRuntime')]"
			]
		},
		{
			"name": "[concat(parameters('workspaceName'), '/Odbc1')]",
			"type": "Microsoft.Synapse/workspaces/linkedServices",
			"apiVersion": "2019-06-01-preview",
			"properties": {
				"annotations": [],
				"type": "Odbc",
				"typeProperties": {
					"connectionString": {
						"type": "SecureString",
						"value": "[parameters('Odbc1_connectionString')]"
					},
					"authenticationType": "Basic",
					"userName": "[parameters('Odbc1_properties_typeProperties_userName')]",
					"password": {
						"type": "SecureString",
						"value": "[parameters('Odbc1_password')]"
					}
				},
				"connectVia": {
					"referenceName": "netsuite-IntegrationRuntime",
					"type": "IntegrationRuntimeReference"
				}
			},
			"dependsOn": [
				"[concat(variables('workspaceId'), '/integrationRuntimes/netsuite-IntegrationRuntime')]"
			]
		},
		{
			"name": "[concat(parameters('workspaceName'), '/Odbc2')]",
			"type": "Microsoft.Synapse/workspaces/linkedServices",
			"apiVersion": "2019-06-01-preview",
			"properties": {
				"annotations": [],
				"type": "Odbc",
				"typeProperties": {
					"connectionString": {
						"type": "SecureString",
						"value": "[parameters('Odbc2_connectionString')]"
					},
					"authenticationType": "Basic",
					"userName": "[parameters('Odbc2_properties_typeProperties_userName')]",
					"password": {
						"type": "SecureString",
						"value": "[parameters('Odbc2_password')]"
					}
				},
				"connectVia": {
					"referenceName": "netsuite-IntegrationRuntime",
					"type": "IntegrationRuntimeReference"
				}
			},
			"dependsOn": [
				"[concat(variables('workspaceId'), '/integrationRuntimes/netsuite-IntegrationRuntime')]"
			]
		},
		{
			"name": "[concat(parameters('workspaceName'), '/SFTP')]",
			"type": "Microsoft.Synapse/workspaces/linkedServices",
			"apiVersion": "2019-06-01-preview",
			"properties": {
				"annotations": [],
				"type": "Sftp",
				"typeProperties": {
					"host": "[parameters('SFTP_properties_typeProperties_host')]",
					"port": "2222",
					"skipHostKeyValidation": true,
					"authenticationType": "Basic",
					"userName": "[parameters('SFTP_properties_typeProperties_userName')]",
					"password": {
						"type": "SecureString",
						"value": "[parameters('SFTP_password')]"
					}
				},
				"connectVia": {
					"referenceName": "AutoResolveIntegrationRuntime",
					"type": "IntegrationRuntimeReference"
				}
			},
			"dependsOn": [
				"[concat(variables('workspaceId'), '/integrationRuntimes/AutoResolveIntegrationRuntime')]"
			]
		},
		{
			"name": "[concat(parameters('workspaceName'), '/briggs-b-wus-syn-01-WorkspaceDefaultSqlServer')]",
			"type": "Microsoft.Synapse/workspaces/linkedServices",
			"apiVersion": "2019-06-01-preview",
			"properties": {
				"parameters": {
					"DBName": {
						"type": "String"
					}
				},
				"annotations": [],
				"type": "AzureSqlDW",
				"typeProperties": {
					"connectionString": "[parameters('briggs-b-wus-syn-01-WorkspaceDefaultSqlServer_connectionString')]"
				},
				"connectVia": {
					"referenceName": "AutoResolveIntegrationRuntime",
					"type": "IntegrationRuntimeReference"
				}
			},
			"dependsOn": [
				"[concat(variables('workspaceId'), '/integrationRuntimes/AutoResolveIntegrationRuntime')]"
			]
		},
		{
			"name": "[concat(parameters('workspaceName'), '/briggs-b-wus-syn-01-WorkspaceDefaultStorage')]",
			"type": "Microsoft.Synapse/workspaces/linkedServices",
			"apiVersion": "2019-06-01-preview",
			"properties": {
				"annotations": [],
				"type": "AzureBlobFS",
				"typeProperties": {
					"url": "[parameters('briggs-b-wus-syn-01-WorkspaceDefaultStorage_properties_typeProperties_url')]"
				},
				"connectVia": {
					"referenceName": "AutoResolveIntegrationRuntime",
					"type": "IntegrationRuntimeReference"
				}
			},
			"dependsOn": [
				"[concat(variables('workspaceId'), '/integrationRuntimes/AutoResolveIntegrationRuntime')]"
			]
		},
		{
			"name": "[concat(parameters('workspaceName'), '/briggs-p-wus-syn-01-WorkspaceDefaultSqlServer')]",
			"type": "Microsoft.Synapse/workspaces/linkedServices",
			"apiVersion": "2019-06-01-preview",
			"properties": {
				"parameters": {
					"DBName": {
						"type": "String"
					}
				},
				"annotations": [],
				"type": "AzureSqlDW",
				"typeProperties": {
					"connectionString": "[parameters('briggs-p-wus-syn-01-WorkspaceDefaultSqlServer_connectionString')]"
				},
				"connectVia": {
					"referenceName": "AutoResolveIntegrationRuntime",
					"type": "IntegrationRuntimeReference"
				}
			},
			"dependsOn": [
				"[concat(variables('workspaceId'), '/integrationRuntimes/AutoResolveIntegrationRuntime')]"
			]
		},
		{
			"name": "[concat(parameters('workspaceName'), '/briggs-p-wus-syn-01-WorkspaceDefaultStorage')]",
			"type": "Microsoft.Synapse/workspaces/linkedServices",
			"apiVersion": "2019-06-01-preview",
			"properties": {
				"annotations": [],
				"type": "AzureBlobFS",
				"typeProperties": {
					"url": "[parameters('briggs-p-wus-syn-01-WorkspaceDefaultStorage_properties_typeProperties_url')]"
				},
				"connectVia": {
					"referenceName": "AutoResolveIntegrationRuntime",
					"type": "IntegrationRuntimeReference"
				}
			},
			"dependsOn": [
				"[concat(variables('workspaceId'), '/integrationRuntimes/AutoResolveIntegrationRuntime')]"
			]
		},
		{
			"name": "[concat(parameters('workspaceName'), '/1 AM CST')]",
			"type": "Microsoft.Synapse/workspaces/triggers",
			"apiVersion": "2019-06-01-preview",
			"properties": {
				"annotations": [],
				"runtimeState": "Started",
				"pipelines": [
					{
						"pipelineReference": {
							"referenceName": "PL_MASTER_CALL_FOR_THEME",
							"type": "PipelineReference"
						},
						"parameters": {}
					}
				],
				"type": "ScheduleTrigger",
				"typeProperties": {
					"recurrence": {
						"frequency": "Day",
						"interval": 1,
						"startTime": "2022-01-24T06:05:00",
						"timeZone": "India Standard Time",
						"schedule": {
							"minutes": [
								25
							],
							"hours": [
								13
							]
						}
					}
				}
			},
			"dependsOn": [
				"[concat(variables('workspaceId'), '/pipelines/PL_MASTER_CALL_FOR_THEME')]"
			]
		},
		{
			"name": "[concat(parameters('workspaceName'), '/1 pm trigger')]",
			"type": "Microsoft.Synapse/workspaces/triggers",
			"apiVersion": "2019-06-01-preview",
			"properties": {
				"annotations": [],
				"runtimeState": "Stopped",
				"pipelines": [],
				"type": "ScheduleTrigger",
				"typeProperties": {
					"recurrence": {
						"frequency": "Day",
						"interval": 1,
						"startTime": "2021-12-15T06:31:00",
						"timeZone": "India Standard Time",
						"schedule": {
							"minutes": [
								0
							],
							"hours": [
								13
							]
						}
					}
				}
			},
			"dependsOn": []
		},
		{
			"name": "[concat(parameters('workspaceName'), '/12_30 PM')]",
			"type": "Microsoft.Synapse/workspaces/triggers",
			"apiVersion": "2019-06-01-preview",
			"properties": {
				"annotations": [],
				"runtimeState": "Stopped",
				"pipelines": [],
				"type": "ScheduleTrigger",
				"typeProperties": {
					"recurrence": {
						"frequency": "Day",
						"interval": 1,
						"startTime": "2021-12-15T06:28:00",
						"timeZone": "India Standard Time",
						"schedule": {
							"minutes": [
								30
							],
							"hours": [
								12
							]
						}
					}
				}
			},
			"dependsOn": []
		},
		{
			"name": "[concat(parameters('workspaceName'), '/12_45 Trigger')]",
			"type": "Microsoft.Synapse/workspaces/triggers",
			"apiVersion": "2019-06-01-preview",
			"properties": {
				"annotations": [],
				"runtimeState": "Stopped",
				"pipelines": [],
				"type": "ScheduleTrigger",
				"typeProperties": {
					"recurrence": {
						"frequency": "Day",
						"interval": 1,
						"startTime": "2021-12-22T04:01:00",
						"timeZone": "India Standard Time",
						"schedule": {
							"minutes": [
								45
							],
							"hours": [
								12
							]
						}
					}
				}
			},
			"dependsOn": []
		},
		{
			"name": "[concat(parameters('workspaceName'), '/12_PM Trigger')]",
			"type": "Microsoft.Synapse/workspaces/triggers",
			"apiVersion": "2019-06-01-preview",
			"properties": {
				"annotations": [],
				"runtimeState": "Stopped",
				"pipelines": [],
				"type": "ScheduleTrigger",
				"typeProperties": {
					"recurrence": {
						"frequency": "Day",
						"interval": 1,
						"startTime": "2021-12-16T16:49:00",
						"timeZone": "India Standard Time",
						"schedule": {
							"minutes": [
								0
							],
							"hours": [
								12
							]
						}
					}
				}
			},
			"dependsOn": []
		},
		{
			"name": "[concat(parameters('workspaceName'), '/1_15 PM Trigger')]",
			"type": "Microsoft.Synapse/workspaces/triggers",
			"apiVersion": "2019-06-01-preview",
			"properties": {
				"annotations": [],
				"runtimeState": "Stopped",
				"pipelines": [],
				"type": "ScheduleTrigger",
				"typeProperties": {
					"recurrence": {
						"frequency": "Day",
						"interval": 1,
						"startTime": "2021-12-22T04:04:00",
						"timeZone": "India Standard Time",
						"schedule": {
							"minutes": [
								15
							],
							"hours": [
								13
							]
						}
					}
				}
			},
			"dependsOn": []
		},
		{
			"name": "[concat(parameters('workspaceName'), '/1_30 pm trigger')]",
			"type": "Microsoft.Synapse/workspaces/triggers",
			"apiVersion": "2019-06-01-preview",
			"properties": {
				"annotations": [],
				"runtimeState": "Stopped",
				"pipelines": [],
				"type": "ScheduleTrigger",
				"typeProperties": {
					"recurrence": {
						"frequency": "Day",
						"interval": 1,
						"startTime": "2021-12-15T06:32:00",
						"timeZone": "India Standard Time",
						"schedule": {
							"minutes": [
								30
							],
							"hours": [
								13
							]
						}
					}
				}
			},
			"dependsOn": []
		},
		{
			"name": "[concat(parameters('workspaceName'), '/1_45 PM Trigger')]",
			"type": "Microsoft.Synapse/workspaces/triggers",
			"apiVersion": "2019-06-01-preview",
			"properties": {
				"annotations": [],
				"runtimeState": "Stopped",
				"pipelines": [],
				"type": "ScheduleTrigger",
				"typeProperties": {
					"recurrence": {
						"frequency": "Day",
						"interval": 1,
						"startTime": "2021-12-22T04:05:00",
						"timeZone": "India Standard Time",
						"schedule": {
							"minutes": [
								45
							],
							"hours": [
								13
							]
						}
					}
				}
			},
			"dependsOn": []
		},
		{
			"name": "[concat(parameters('workspaceName'), '/2 PM Trigger')]",
			"type": "Microsoft.Synapse/workspaces/triggers",
			"apiVersion": "2019-06-01-preview",
			"properties": {
				"annotations": [],
				"runtimeState": "Stopped",
				"pipelines": [],
				"type": "ScheduleTrigger",
				"typeProperties": {
					"recurrence": {
						"frequency": "Day",
						"interval": 1,
						"startTime": "2021-12-15T06:33:00",
						"timeZone": "India Standard Time",
						"schedule": {
							"minutes": [
								0
							],
							"hours": [
								14
							]
						}
					}
				}
			},
			"dependsOn": []
		},
		{
			"name": "[concat(parameters('workspaceName'), '/2_30 PM TRIGGER')]",
			"type": "Microsoft.Synapse/workspaces/triggers",
			"apiVersion": "2019-06-01-preview",
			"properties": {
				"annotations": [],
				"runtimeState": "Stopped",
				"pipelines": [],
				"type": "ScheduleTrigger",
				"typeProperties": {
					"recurrence": {
						"frequency": "Day",
						"interval": 1,
						"startTime": "2021-12-15T06:37:00",
						"timeZone": "India Standard Time",
						"schedule": {
							"minutes": [
								15
							],
							"hours": [
								14
							]
						}
					}
				}
			},
			"dependsOn": []
		},
		{
			"name": "[concat(parameters('workspaceName'), '/Every_Sunday')]",
			"type": "Microsoft.Synapse/workspaces/triggers",
			"apiVersion": "2019-06-01-preview",
			"properties": {
				"annotations": [],
				"runtimeState": "Started",
				"pipelines": [
					{
						"pipelineReference": {
							"referenceName": "PL_Briggs_Heavy_Table_Load",
							"type": "PipelineReference"
						},
						"parameters": {}
					}
				],
				"type": "ScheduleTrigger",
				"typeProperties": {
					"recurrence": {
						"frequency": "Week",
						"interval": 1,
						"startTime": "2022-03-14T14:08:00",
						"timeZone": "India Standard Time",
						"schedule": {
							"minutes": [
								30
							],
							"hours": [
								17
							],
							"weekDays": [
								"Sunday"
							]
						}
					}
				}
			},
			"dependsOn": [
				"[concat(variables('workspaceId'), '/pipelines/PL_Briggs_Heavy_Table_Load')]"
			]
		},
		{
			"name": "[concat(parameters('workspaceName'), '/POR 2 AM CST')]",
			"type": "Microsoft.Synapse/workspaces/triggers",
			"apiVersion": "2019-06-01-preview",
			"properties": {
				"annotations": [],
				"runtimeState": "Stopped",
				"pipelines": [
					{
						"pipelineReference": {
							"referenceName": "Load_POR_TEMP",
							"type": "PipelineReference"
						},
						"parameters": {}
					}
				],
				"type": "ScheduleTrigger",
				"typeProperties": {
					"recurrence": {
						"frequency": "Day",
						"interval": 1,
						"startTime": "2022-01-20T05:39:00",
						"timeZone": "Central America Standard Time",
						"schedule": {
							"minutes": [
								0
							],
							"hours": [
								2
							]
						}
					}
				}
			},
			"dependsOn": [
				"[concat(variables('workspaceId'), '/pipelines/Load_POR_TEMP')]"
			]
		},
		{
			"name": "[concat(parameters('workspaceName'), '/POR_Main_Pipeline_Trigger')]",
			"type": "Microsoft.Synapse/workspaces/triggers",
			"apiVersion": "2019-06-01-preview",
			"properties": {
				"annotations": [],
				"runtimeState": "Started",
				"pipelines": [
					{
						"pipelineReference": {
							"referenceName": "PL_MASTER_LOAD_POR",
							"type": "PipelineReference"
						},
						"parameters": {}
					}
				],
				"type": "ScheduleTrigger",
				"typeProperties": {
					"recurrence": {
						"frequency": "Day",
						"interval": 1,
						"startTime": "2022-02-07T12:00:00",
						"timeZone": "India Standard Time",
						"schedule": {
							"hours": [
								12
							]
						}
					}
				}
			},
			"dependsOn": [
				"[concat(variables('workspaceId'), '/pipelines/PL_MASTER_LOAD_POR')]"
			]
		},
		{
			"name": "[concat(parameters('workspaceName'), '/POR_Stage_Table_Refresh')]",
			"type": "Microsoft.Synapse/workspaces/triggers",
			"apiVersion": "2019-06-01-preview",
			"properties": {
				"annotations": [],
				"runtimeState": "Stopped",
				"pipelines": [
					{
						"pipelineReference": {
							"referenceName": "PL_POR_EXECUTIVE_STAGE_TABLES_LOAD",
							"type": "PipelineReference"
						},
						"parameters": {}
					}
				],
				"type": "ScheduleTrigger",
				"typeProperties": {
					"recurrence": {
						"frequency": "Day",
						"interval": 1,
						"startTime": "2022-02-08T13:00:00",
						"timeZone": "India Standard Time"
					}
				}
			},
			"dependsOn": [
				"[concat(variables('workspaceId'), '/pipelines/PL_POR_EXECUTIVE_STAGE_TABLES_LOAD')]"
			]
		},
		{
			"name": "[concat(parameters('workspaceName'), '/Trigger 2')]",
			"type": "Microsoft.Synapse/workspaces/triggers",
			"apiVersion": "2019-06-01-preview",
			"properties": {
				"annotations": [],
				"runtimeState": "Stopped",
				"pipelines": [
					{
						"pipelineReference": {
							"referenceName": "PL_Master_Dimension_Load",
							"type": "PipelineReference"
						},
						"parameters": {}
					}
				],
				"type": "ScheduleTrigger",
				"typeProperties": {
					"recurrence": {
						"frequency": "Day",
						"interval": 1,
						"startTime": "2021-10-26T07:45:00",
						"timeZone": "India Standard Time",
						"schedule": {
							"minutes": [
								30
							],
							"hours": [
								10
							]
						}
					}
				}
			},
			"dependsOn": [
				"[concat(variables('workspaceId'), '/pipelines/PL_Master_Dimension_Load')]"
			]
		},
		{
			"name": "[concat(parameters('workspaceName'), '/AutoResolveIntegrationRuntime')]",
			"type": "Microsoft.Synapse/workspaces/integrationRuntimes",
			"apiVersion": "2019-06-01-preview",
			"properties": {
				"type": "Managed",
				"typeProperties": {
					"computeProperties": {
						"location": "AutoResolve",
						"dataFlowProperties": {
							"computeType": "General",
							"coreCount": 8,
							"timeToLive": 0
						}
					}
				}
			},
			"dependsOn": []
		},
		{
			"name": "[concat(parameters('workspaceName'), '/IntegrationRuntime1')]",
			"type": "Microsoft.Synapse/workspaces/integrationRuntimes",
			"apiVersion": "2019-06-01-preview",
			"properties": {
				"type": "SelfHosted",
				"typeProperties": {}
			},
			"dependsOn": []
		},
		{
			"name": "[concat(parameters('workspaceName'), '/IntegrationRuntimeBriggs1')]",
			"type": "Microsoft.Synapse/workspaces/integrationRuntimes",
			"apiVersion": "2019-06-01-preview",
			"properties": {
				"type": "SelfHosted",
				"typeProperties": {}
			},
			"dependsOn": []
		},
		{
			"name": "[concat(parameters('workspaceName'), '/POR-IntegrationRuntime')]",
			"type": "Microsoft.Synapse/workspaces/integrationRuntimes",
			"apiVersion": "2019-06-01-preview",
			"properties": {
				"type": "SelfHosted",
				"typeProperties": {}
			},
			"dependsOn": []
		},
		{
			"name": "[concat(parameters('workspaceName'), '/intrt-IntegrationRuntime')]",
			"type": "Microsoft.Synapse/workspaces/integrationRuntimes",
			"apiVersion": "2019-06-01-preview",
			"properties": {
				"type": "SelfHosted",
				"description": "SHIR installed on data center:  db-intrt-p00",
				"typeProperties": {}
			},
			"dependsOn": []
		},
		{
			"name": "[concat(parameters('workspaceName'), '/netsuite-IntegrationRuntime')]",
			"type": "Microsoft.Synapse/workspaces/integrationRuntimes",
			"apiVersion": "2019-06-01-preview",
			"properties": {
				"type": "SelfHosted",
				"description": "10.13.0.4",
				"typeProperties": {}
			},
			"dependsOn": []
		},
		{
			"name": "[concat(parameters('workspaceName'), '/WorkspaceSystemIdentity')]",
			"type": "Microsoft.Synapse/workspaces/credentials",
			"apiVersion": "2019-06-01-preview",
			"properties": {
				"type": "ManagedIdentity",
				"typeProperties": {}
			},
			"dependsOn": []
		},
		{
			"name": "[concat(parameters('workspaceName'), '/Briggs views')]",
			"type": "Microsoft.Synapse/workspaces/sqlscripts",
			"apiVersion": "2019-06-01-preview",
			"properties": {
				"content": {
					"query": "CREATE VIEW dbo.VW_Department \nAS\nSELECT OMD.[OMOPERATINGUNITNUMBER] 'Department_ID'\n\t  ,replace(OMD.[NAME],' Dept','') 'Department'\n\t  ,case\n\t\t\twhen OMD.OMOPERATINGUNITNUMBER like '2%' and OMD.OMOPERATINGUNITNUMBER <> '28' then 'Operations'\n\t\t\twhen OMD.OMOPERATINGUNITNUMBER like '3%' or OMD.OMOPERATINGUNITNUMBER = '28' then 'Sales'\n\t\t\twhen OMD.OMOPERATINGUNITNUMBER like '8%' then 'Support'\n\t\t\telse 'Unknown'\n\t\tend 'Primary_Function'\n\t  ,case\n\t\t\twhen OMD.OMOPERATINGUNITNUMBER  = '24' then 'Sales'\n\t\t\twhen OMD.OMOPERATINGUNITNUMBER  = '28' then 'Operations'\n\t\t\twhen OMD.OMOPERATINGUNITNUMBER = '32' then 'Support'\n\t\t\twhen OMD.OMOPERATINGUNITNUMBER like '2%' then 'Operations'\n\t\t\twhen OMD.OMOPERATINGUNITNUMBER like '3%' then 'Sales'\n\t\t\twhen OMD.OMOPERATINGUNITNUMBER like '8%' then 'Support'\n\t\t\telse 'Unknown'\n\t   end 'Secondary_Function'\n\t  ,isnull(DIR2.NAME,'No Leader') 'Department_Head'\nFROM [Briggs_MST].[OMDepartmentView_ext] OMD\nleft join [Briggs_MST].[DIRPartyTable_ext] DIR on dir.PARTYNUMBER = OMD.PARTYNUMBER\nleft join [Briggs_MST].[HCMWorker_ext] HCM on HCM.recid = DIR.HCMWORKER\nleft join [Briggs_MST].[DIRPartyTable_ext] DIR2 on DIR2.recid = HCM.PERSON\nGO\n\n--\n\nCREATE VIEW dbo.VW_Customer\nAS\nWITH cte_MinitracConversion\nAS\n(\nSELECT DISTINCT cusnum\n\t\t\t   ,CASE \n\t\t\t\t\tWHEN len(cusnum) = 4 THEN 'C100' + cast(cusnum as varchar)\n\t\t\t\t\tWHEN len(cusnum) = 5 THEN 'C10' + cast(cusnum as varchar)\n\t\t\t\t    WHEN len(cusnum) = 6 THEN 'C1' + cast(cusnum as varchar)\n\t\t\t\t\tELSE null\n\t\t\t\tEND 'Customer Account'\nFROM [BIE_DATA_WAREHOUSE].[MPCust_ext]\n)\nSELECT CT.accountnum 'Customer_ID'\n\t  ,DIR.name 'Customer_Name'\n\t  ,CT.accountnum + ' - ' + DIR.name 'Customer'\n\t  ,CASE \n\t\t\tWHEN CT.INVOICEACCOUNT = '' THEN 'Bill-to'\n\t\t\tWHEN CT.INVOICEACCOUNT <> '' THEN 'Ship-to'\n\t\t\tELSE null \n\t   END 'Customer_Account_Type'\n\t  ,isnull(cast([DATE_OPENED] as date),cast(CT.CREATEDDATETIME as date)) 'Date_Account_Opened'\n\t  ,CG.NAME 'Customer_Group'\n\t  ,rtrim(ltrim(\n\t   CASE\n\t\t\tWHEN CCG.DESCRIPTION like 'TAA%' THEN  ccg.DESCRIPTION\n\t\t\tELSE isnull(substring(CCG.DESCRIPTION,charindex('-',CCG.DESCRIPTION)+1,len(CCG.DESCRIPTION)),'NO REP')\n\t   END)) 'Collections_Agent'\n\t  ,CASE \n\t\t\tWHEN CT.blocked = 0 THEN 'None'\n\t\t\tWHEN CT.blocked = 3 THEN 'Payment'\n\t\t\tWHEN CT.blocked = 20 THEN 'Stopped'\n\t\t\tWHEN CT.blocked = 2 THEN 'All'  \n\t\t\tELSE 'None'\n\t   END 'Account_Hold_Type'\n\t  ,CASE \n\t\t\tWHEN CT.POREQUIRED = 1 THEN 'Yes' \n\t\t\tELSE 'No' \n\t   END 'PO_Required'\n\t  ,isnull(BCT.DESCRIPTION,'Unknown') 'Collection_Type_Description'\nFROM [Briggs_MST].[CustTable_ext] CT\nleft join [Briggs_MST].[DIRPartyTable_ext] DIR on DIR.recid = CT.party\nleft join [Briggs_MST].[CustGroup_ext] CG on CG.CUSTGROUP = CT.CUSTGROUP\nleft join [Briggs_MST].[XAP_CreditCustomerGroups_ext] CCG on CCG.recid = CT.CREDITCUSTOMERGROUPS\nleft join [Briggs_MST].[XAP_PartPriceGroup_ext] PPG on PPG.recid = CT.PARTPRICEGROUPRECID\nleft join [Briggs_MST].[PayMTerm_ext] PAYM on PAYM.PAYMTERMID = ct.PAYMTERMID\nleft join [Briggs_MST].[SMMBUSRelSalesDistrictGroup_ext] SDC on sdc.SALESDISTRICTID = ct.SALESDISTRICTID\nleft join cte_MinitracConversion CONV on CONV.[Customer Account] = CT.ACCOUNTNUM\nleft join [BIE_DATA_WAREHOUSE].[MPCust_ext] MT on MT.CUSNUM = conv.CUSNUM\nleft join [Briggs_MST].[BRGCollectionType_ext] BCT ON BCT.BRG_CUSTOMERCOLLECTIONTYPE = CT.BRG_CUSTOMERCOLLECTIONTYPE\nGO\n\n--\n\nCREATE VIEW dbo.VW_Worker\nAS\nSELECT HCM.PERSONNELNUMBER 'Worker_ID'\n\t  ,DIR.NAME 'Worker_Name'\n\t  ,isnull(DU.USER_,'NoUser') 'Username'\n\t  ,RE.Job\n\t  ,RE.Department\n\t  ,RE.Branch\nFROM [Briggs_MST].[HCMWorker_ext] HCM\nleft join [Briggs_MST].[DIRPartyTable_ext] DIR on DIR.RECID = HCM.PERSON\nleft join [BriggsAX].[RosterEmployee_ext] RE on RE.Employee_ID = HCM.PERSONNELNUMBER and RE.File_Date = (select max(file_date) from [BriggsAX].[RosterEmployee_ext])\nleft join [Briggs_MST].[DirPersonUser_ext] DU on DU.PERSONPARTY = DIR.recid\nGO\n\n--\n\nCREATE VIEW dbo.VW_WorkCenter\nAS\nSELECT WC.WRKCTRID 'Work_Center_ID'\n\t  ,WC.NAME 'Work_Center_Name'\n\t  ,CASE\n\t\t\tWHEN WC.WRKCTRTYPE = 2 THEN 'Vendor'\n\t\t\twhen WC.WRKCTRTYPE = 5 then 'Group'\n\t\t\twhen WC.WRKCTRTYPE = 1 and HCM.PERSONNELNUMBER is not null then 'Individual Employee'\n\t\t\twhen WC.WRKCTRTYPE = 1 then 'Individual Non-Employee'\n\t\t\telse 'Unknown'\n\t   END 'Work_Center_Type'\n\t  ,CASE\n\t\t\tWHEN WC.WRKCTRTYPE = 5 THEN 'NA'\n\t\t\twhen WG.WRKCTRID IS NULL then 'Unknown'\n\t\t\telse WG.WRKCTRID\n\t   END 'Work_Center_Group'\n\t  ,CASE \n\t\t\tWHEN WC.WRKCTRTYPE IN(2,5) THEN 'No'\n\t\t\twhen WC.WRKCTRTYPE = 1 and HCM.PERSONNELNUMBER is not null then 'Yes'\n\t\t\tWHEN WC.WRKCTRTYPE = 1 and HCM.PERSONNELNUMBER IS NULL THEN 'No'\n\t\t\telse 'Unknown'\n\t   END 'is_Worker'\n\t  ,CASE \n\t\t\tWHEN WC.WRKCTRTYPE IN(2,5) THEN 'NA'\n\t\t\twhen WC.WRKCTRTYPE = 1 and HCM.PERSONNELNUMBER is not null then HCM.PERSONNELNUMBER\n\t\t\tWHEN WC.WRKCTRTYPE = 1 and HCM.PERSONNELNUMBER IS NULL THEN 'NA'\n\t\t\telse 'Unknown'\n\t   END 'Worker_ID'\n\t  ,CASE \n\t\t\tWHEN WC.WRKCTRTYPE IN(2,5) THEN 'NA'\n\t\t\twhen WC.WRKCTRTYPE = 1 and HCM.PERSONNELNUMBER is not null then DIR.NAME\n\t\t\tWHEN WC.WRKCTRTYPE = 1 and HCM.PERSONNELNUMBER IS NULL THEN 'NA'\n\t\t\telse 'Unknown'\n\t   END 'Worker_Name'\n\t  ,CASE \n\t\t\tWHEN WC.WRKCTRTYPE IN(2,5) THEN 'NA'\n\t\t\twhen WC.WRKCTRTYPE = 1 and HCM.PERSONNELNUMBER is not null then isnull(replace(la.languagecodeid,'TEAM','Team'),'Unknown')\n\t\t\tWHEN WC.WRKCTRTYPE = 1 and HCM.PERSONNELNUMBER IS NULL THEN 'NA'\n\t\t\telse 'Unknown'\n\t   END 'Worker_Team'\nFROM [Briggs_MST].[WrkCtrTable_ext] WC\nLEFT JOIN [Briggs_MST].[HCMWorker_ext] HCM ON HCM.PERSONNELNUMBER = WC.WRKCTRID\nleft join [Briggs_MST].[WrkCtrTableIndividualView_ext] WCI on WCI.WRKCTRID = WC.WRKCTRID and WCI.VALIDTO >= getdate()\nleft join [Briggs_MST].[WrkCtrResourceGroup_ext] WG on WG.recid = WCI.RESOURCEGROUP\nleft join [Briggs_MST].[DIRPartyTable_ext] dir on DIR.RECID = HCM.PERSON\nLEFT JOIN [Briggs_MST].[HCMPersonPrivateDetails_ext] HPD on HPD.person = HCM.PERSON\nleft join [Briggs_MST].[HCMLanguageCode_ext] LA on LA.recid = HPD.NATIVELANGUAGE\nGO\n\n--\n\nCREATE VIEW dbo.VW_GL_Account\nAS\nSELECT M.MAINACCOUNTID 'Ledger_Account_ID'\n\t  ,M.NAME 'Ledger_Account'\n\t  ,MC.DESCRIPTION 'Description'\n\t  ,MC.ACCOUNTCATEGORY 'Account_Category'\n\t  ,MC.ACCOUNTTYPE 'Account_Type'\nFROM [Briggs_MST].[MainAccount_ext] M\nleft join [Briggs_MST].[MainAccountCategory_ext] MC on MC.ACCOUNTCATEGORYREF = M.ACCOUNTCATEGORYREF\nGO\n\n--\n\nCREATE VIEW dbo.VW_Employee\nAS\nSELECT E.Employee_ID 'Employee_ID'\n\t  ,E.[Employee_Name] 'Employee_Name_LFM'\n\t  ,CASE\n\t\t\tWHEN E.[Status] like 'Term%' THEN 'Terminated'\n\t\t\tWHEN E.[Status] like 'Inact%' THEN 'Inactive'\n\t\t\tELSE E.[Status]\n\t   END 'Employment_Status'\n\t  ,JJ.CategoryDescription 'Job_Category'\n\t  ,E.[Job] 'Job'\n\t  ,E.Last_Hire_Date 'Employee_Last_Hire_Date'\n\t  ,datediff(dd,E.Last_Hire_Date,cast(E.file_date as date)) 'Employee_Days_Employed'\n\t  ,eomonth(E.[File_Date]) 'Roster_End_Month'\nFROM [BriggsAX].[RosterEmployee_ext] E\nleft join [BriggsAX].[RosterEmployee_ext] M on M.Employee_ID = E.Employee_ID and M.File_Date = E.File_Date\nleft join [BriggsHR].[EmployeeHeader_ext] EMPHIST on ltrim(rtrim(EMPHIST.IdentificationNumber)) = E.Employee_ID\nleft join [BriggsHR].[GLCodesDepartments_ext] G on cast(G.GLCode as varchar) = cast(E.Position_Ledger_Code as varchar) and cast(G.DepartmentCode as varchar) = cast(E.Department as varchar)\nleft join [BriggsHR].[JobCategory_ext] JJ on JJ.CategoryCode = G.CategoryCode\nleft join [BriggsHR].[GLCodesDepartments_ext] GM on cast(GM.GLCode as varchar) = cast(M.Position_Ledger_Code as varchar) and cast(GM.DepartmentCode as varchar) = cast(M.Department as varchar)\nleft join [BriggsHR].[JobCategory_ext] JJM on JJM.CategoryCode = GM.CategoryCode\nGO\n\n--\n\nCREATE VIEW dbo.Supervisor\nAS\nSELECT M.[Employee_ID] 'Supervisor_Employee_ID'\n\t  ,M.[Employee_Name] 'Supervisor_Name_LFM'\n\t  ,JJM.CategoryDescription 'Supervisor_Job_Category'\n\t  ,M.[Job] 'Supervisor_Job'\n\t  ,M.Last_Hire_Date 'Supervisor_Last_Hire_Date'\n\t  ,datediff(dd,M.Last_Hire_Date,cast(E.file_date as date)) 'Supervisor_Days_Employed'\nFROM [BriggsAX].[RosterEmployee_ext] E\nleft join [BriggsAX].[RosterEmployee_ext] M on M.Employee_ID = E.Employee_ID and M.File_Date = E.File_Date\nleft join [BriggsHR].[EmployeeHeader_ext] EMPHIST on ltrim(rtrim(EMPHIST.IdentificationNumber)) = E.Employee_ID\nleft join [BriggsHR].[GLCodesDepartments_ext] G on cast(G.GLCode as varchar) = cast(E.Position_Ledger_Code as varchar) and cast(G.DepartmentCode as varchar) = cast(E.Department as varchar)\nleft join [BriggsHR].[JobCategory_ext] JJ on JJ.CategoryCode = G.CategoryCode\nleft join [BriggsHR].[GLCodesDepartments_ext] GM on cast(GM.GLCode as varchar) = cast(M.Position_Ledger_Code as varchar) and cast(GM.DepartmentCode as varchar) = cast(M.Department as varchar)\nleft join [BriggsHR].[JobCategory_ext] JJM on JJM.CategoryCode = GM.CategoryCode\nGO\n\n--\n\nCREATE VIEW dbo.TerrirtorySalesperson \nAS\nselect cs.territory 'Territory_Salesperson_ID'\n,DP.BranchID 'Territory_Salesperson_Branch'\n,isnull(DP.BranchID,'Unknown') 'Territory_Salesperson_Default_Branch'\n,cs.division 'Territory_Salesperson_Division'\n,cs.[type] 'Territory_Salesperson_Plan'\nfrom [BriggsAX].[CommissionsSalesPeople_ext] CS\nleft join [Briggs_MST].[DIRPartyTable_ext] DP on DP.BranchID = CS.Branch\nGO\n\n--\n\nCREATE VIEW dbo.AssignedSalesperson\nAS\nselect isnull(CS.NAME,'Unassigned') 'Assigned_Salesperson'\n\t  ,case \n\t\t\twhen CS.workerid like 'SLS%' then 'NA'\n\t\t\telse isnull(ISNULL(DP.Name,'Unknown'),'Unknown')\n\t   end 'Assigned_Salesperson_Roster_Branch'\n\t  ,isnull(isnull(DP.Name,'Unknown'),'Unassigned') 'Assigned_Salesperson_Terr_Default_Branch'\n\t  ,isnull(DP.Name,'Unassigned') 'Assigned_Salesperson_Terr_Branch'\n\t  ,case\n\t\t\twhen CS.workerid like 'SLS%' then 'NA'\n\t\t\telse isnull(g.DepartmentCodeDescription,'Unknown')\n\t   end 'Assigned_Salesperson_Empl_Status'\nfrom [BriggsAX].[CommissionsSalesPeople_ext] CS\nleft join [Briggs_MST].[DIRPartyTable_ext] DP on DP.BranchID = CS.Branch\nleft join [BriggsAX].[RosterEmployee_ext] RE on DP.BranchID = RE.Branch\nleft join [BriggsHR].[EmployeeHeader_ext] emphist on ltrim(rtrim(emphist.IdentificationNumber)) = cs.WorkerId\nleft join [BriggsHR].[GLCodesDepartments_ext] G on cast(g.GLCode as varchar) = cast(isnull(RE.Position_Ledger_Code,emphist.GLCode) as varchar) \n\t\t\t\t\t\t\t\t\t\t\t\tand cast(g.DepartmentCode as varchar) = cast(isnull(RE.Department,emphist.DepartmentCode) as varchar)\nGO\n\n--\n\nCREATE VIEW dbo.CallTypes\nAS\nSELECT tt.CALLTYPEID 'Call_Type_ID'\n,tl.CALLSTATUSID 'Call_Status_ID'\n,tl.LINENUM 'Line_Num'\nfrom [Briggs_MST].[XAP_SVCCallTypeLine_ext] tl\nleft join [Briggs_MST].[XAP_SVCCallTable_ext] tt on tt.recid = tl.CALLTYPEID\nGO\n\n--\n\nCREATE VIEW dbo.Branch\nAS\nwith p_addr_newest\nAS(\nSELECT \nddv.DISPLAYVALUE\n,MAX(LA.RECID) 'MAX_LOC'\nFROM [Briggs_MST].[InventLocationLogisticsLocationPrimary_ext] ILV\nLEFT JOIN [Briggs_MST].[LogisticsPostalAddressView_ext] LPA ON ILV.LOCATION = LPA.LOCATION\nINNER JOIN [Briggs_MST].[LogisticsLocation_ext] LA ON LA.RECID = LPA.LOCATION\nLEFT JOIN [Briggs_MST].[InventLocation_ext] i ON i.recid = ilv.INVENTLOCATION\nLEFT JOIN [Briggs_MST].[DefaultDimensionView_ext] ddv ON ddv.DEFAULTDIMENSION = i.DEFAULTDIMENSION AND ddv.DIMENSIONATTRIBUTEID = 5637145333\n\nWHERE LPA.VALIDTO >= GETDATE()\nAND i.INVENTSITEID = 'PARTS'\nAND i.INVENTLOCATIONID LIKE 'P%'\nAND i.NAME NOT LIKE '%DO NOT USE%'\nGROUP BY\nddv.DISPLAYVALUE\n) \n\n,p_addr\nAS(\nSELECT DISTINCT\n ddv.DISPLAYVALUE 'Branch_ID'\n,RIGHT(ddv.Displayvalue,2) 'Branch_ID_Short'\n,lpa.STREET\n,lpa.ZIPCODE\n,lpa.CITY\n,lpa.STATE\n,lv.ISOCODE\n,lpa.COUNTRYREGIONID\n,lv.COUNTRYCURRENCYCODE\n,lpa.ADDRESS\n,il.INVENTLOCATIONID\n,lpa.TIMEZONE 'Time_Zone_ID'\nFROM [Briggs_MST].[InventLocation_ext] il\nINNER JOIN [Briggs_MST].[InventLocationLogisticsLocationPrimary_ext] a ON il.recid = a.INVENTLOCATION\nLEFT JOIN [Briggs_MST].[LogisticsPostalAddressView_ext] lv ON lv.LOCATION = a.LOCATION AND lv.VALIDTO >= GETDATE()\nLEFT JOIN [Briggs_MST].[DefaultDimensionView_ext] ddv ON ddv.DEFAULTDIMENSION = il.DEFAULTDIMENSION AND ddv.DIMENSIONATTRIBUTEID = 5637145333\nLEFT JOIN [Briggs_MST].[LogisticsPostalAddress_ext] lpa ON lpa.LOCATION = lv.LOCATION AND LPA.VALIDTO >= GETDATE()\nINNER JOIN [Briggs_MST].[LogisticsLocation_ext] LA ON LA.RECID = LPA.LOCATION\nINNER JOIN p_addr_newest pn ON pn.DISPLAYVALUE = ddv.DISPLAYVALUE AND pn.MAX_LOC = la.RECID\nWHERE il.INVENTSITEID = 'PARTS'\nAND il.INVENTLOCATIONID LIKE 'P%'\n) \n\nselect dir.[OMOPERATINGUNITNUMBER] 'Branch_ID'\n,dir.[NAME] 'Branch'\n,ISNULL(ISNULL(p_addr.ADDRESS,pc.ADDRESS),'Unknown') 'Address'\n,ISNULL(ISNULL(p_addr.STREET,pc.STREET),'Unknown') 'Street'\n,ISNULL(ISNULL(p_addr.CITY,pc.CITY),'Unknown') 'City'\n,ISNULL(ISNULL(p_addr.STATE,pc.STATE),'Unknown') 'State'\n,ISNULL(CAST(ISNULL(p_addr.ZIPCODE,pc.ZIPCODE) AS VARCHAR(20)),'Unknown') 'Zip_Code'\n\nFROM [Briggs_MST].[DIRPartyTable_ext] dir \nLEFT JOIN [Briggs_MST].[DIRPartyMemo_ext] m ON m.PARTY = dir.RECID\nLEFT JOIN [Briggs_MST].[HCMWorker_ext] hcm ON hcm.recid = dir.HCMWORKER\nLEFT JOIN [Briggs_MST].[DIRPartyTable_ext] dir_ldr ON dir_ldr.recid = hcm.PERSON\nLEFT JOIN p_addr ON p_addr.Branch_ID = dir.[OMOPERATINGUNITNUMBER]\nLEFT JOIN p_addr pc ON pc.Branch_ID_Short = RIGHT(dir.[OMOPERATINGUNITNUMBER],2)\nLEFT JOIN [Briggs_MST].[TimeZonesList_ext] tz ON tz.TZENUM = ISNULL(p_addr.Time_Zone_ID,pc.Time_Zone_ID)\n\norder by dir.[OMOPERATINGUNITNUMBER]\nGO\n\n--\n\nCREATE VIEW dbo.Region\nAS\nwith wh\nas(\nselect \ndp.[OMOPERATINGUNITNUMBER] as [VALUE]\n,il.INVENTLOCATIONID\nfrom [Briggs_MST].[InventLocation_ext] il\ninner join [Briggs_MST].[DefaultDimensionView_ext] ddv on ddv.DEFAULTDIMENSION = il.DEFAULTDIMENSION and ddv.DIMENSIONATTRIBUTEID = 5637145333\ninner join [Briggs_MST].[DIRPartyTable_ext] DP on DP.[OMOPERATINGUNITNUMBER] = ddv.DISPLAYVALUE\n\n),tech_status\nas(\n\nselect \nbranch\n,count(*) 'Employees'\n\nfrom [BriggsAX].[RosterEmployee_ext] e\nwhere e.file_date = (select max(file_date) from [BriggsAX].[RosterEmployee_ext])\nand e.Status = 'Active'\nand e.Position_Ledger_Code = '600010'\ngroup by branch\n\n)\nselect m.MEMO 'Region'\n\t  ,case \n\t\t\twhen dir_ldr.[NAME] is null or dir_ldr.[NAME] = '' then 'Inactive Branch' \n\t\t\telse dir_ldr.[NAME]\n\t   end 'Region_Leader'\n\t  ,case \n\t\t\twhen isnull(es.employees,0) = 0 then 'Inactive'\n\t\t\telse 'Active'\n\t   end 'Branch_Tech_Empl_Status'\nfrom [Briggs_MST].[DIRPartyTable_ext] br\nleft join wh on wh.[VALUE] = br.[OMOPERATINGUNITNUMBER]\nleft join [Briggs_MST].[InventLocation_ext] a on wh.[INVENTLOCATIONID] = a.INVENTLOCATIONID\nleft join [Briggs_MST].[OMOperatingUnitView_ext] om on OM.RECID = br.[RECID]\nleft join [Briggs_MST].[DIRPartyTable_ext] dir on dir.PARTYNUMBER = om.PARTYNUMBER\nleft join [Briggs_MST].[DIRPartyMemo_ext] m on m.PARTY = dir.RECID\nleft join tech_status es on es.Branch = br.[OMOPERATINGUNITNUMBER]\nleft join [Briggs_MST].[HCMWorker_ext] hcm on hcm.recid = dir.HCMWORKER\nleft join [Briggs_MST].[DIRPartyTable_ext] dir_ldr on dir_ldr.recid = hcm.PERSON\nwhere ((a.INVENTLOCATIONID like 'P%') or (a.INVENTLOCATIONID like 'E%'))\nGO",
					"metadata": {
						"language": "sql"
					},
					"currentConnection": {
						"databaseName": "master",
						"poolName": "Built-in"
					},
					"resultLimit": 5000
				},
				"type": "SqlQuery"
			},
			"dependsOn": []
		},
		{
			"name": "[concat(parameters('workspaceName'), '/BriggsDimensionTables')]",
			"type": "Microsoft.Synapse/workspaces/sqlscripts",
			"apiVersion": "2019-06-01-preview",
			"properties": {
				"content": {
					"query": "-- DIM_CallTypes\nSET ANSI_NULLS ON\nGO\n\nSET QUOTED_IDENTIFIER ON\nGO\n\nCREATE TABLE [Briggs].[DIM_CallTypes]\n(\n\tCallType_SK\t[int] IDENTITY(1,1) NOT NULL,\n\tCall_Type_ID\tINTEGER,\n\tCall_Status_ID\tINTEGER,\n\tLine_Num\tINTEGER,\n\tCreated_datetime datetime,\n\tCreated_by\tVARCHAR2 (200),\n\tModified_datetime datetime,\n\tModified_by\tVARCHAR2 (200),\n\tStart_datetime datetime ,\n\tEnd_datetime datetime,\n\tis_Active CHAR (1)\n)\nWITH\n(\n\tDISTRIBUTION = REPLICATE,\n\tCLUSTERED COLUMNSTORE INDEX\n)\nGO\n\n--Warehouse\nSET ANSI_NULLS ON\nGO\n\nSET QUOTED_IDENTIFIER ON\nGO\n\nCREATE TABLE [Briggs].[DIM_Warehouse]\n(\n\tWarehouse_SK [int] IDENTITY(1,1) NOT NULL,\n\tWarehouseID\tINTEGER NULL,\n\tWarehouse\tVARCHAR2 (200) NULL,\n\tSite\tVARCHAR2 (200) NULL,\n\tTransactionStatus\tVARCHAR2 (200) NULL,\n\tAddress\tVARCHAR2 (200) NULL,\n\tStreet\tVARCHAR2 (200) NULL,\n\tCity\tVARCHAR2 (200) NULL,\n\tState\tVARCHAR2 (200) NULL,\n\tZipCode\tINTEGER NULL,\n\tTransitID\tINTEGER NULL,\n\tCreated_datetime\tdatetime NULL,\n\tCreated_by\tVARCHAR2 (200) NULL,\n\tModified_datetime\tdatetime NULL,\n\tModified_by\tVARCHAR2 (200) NULL,\n\tStart_datetime\tdatetime NULL,\n\tEnd_datetime\tdatetime NULL,\n\tis_Active\tCHAR (1) NULL\n)\nWITH\n(\n\tDISTRIBUTION = REPLICATE,\n\tCLUSTERED COLUMNSTORE INDEX\n)\nGO\n\n--WorkCenter\nSET ANSI_NULLS ON\nGO\n\nSET QUOTED_IDENTIFIER ON\nGO\n\nCREATE TABLE [Briggs].[DIM_Workcenter]\n(\n\tWorkcenter_SK\t[int] IDENTITY(1,1) NOT NULL,\n\tWorkCenterID\tINTEGER NULL,\n\tWorkCenterName\tVARCHAR2 (200) NULL,\n\tWorkCenterType\tINTEGER NULL,\n\tWorkCenterGroup\tVARCHAR2 (200) NULL,\n\tisWorker\tINTEGER NULL,\n\tWorkerID\tINTEGER NULL,\n\tWorkerName\tVARCHAR2 (200) NULL,\n\tWorkerTeam\tVARCHAR2 (200) NULL,\n\tCreated_datetime\tdatetime NULL,\n\tCreated_by\tVARCHAR2 (200) NULL,\n\tModified_datetime\tdatetime NULL,\n\tModified_by\tVARCHAR2 (200) NULL,\n\tStart_datetime\tdatetime NULL,\n\tEnd_datetime\tdatetime NULL,\n\tis_Active\tCHAR (1) NULL\n)\nWITH\n(\n\tDISTRIBUTION = REPLICATE,\n\tCLUSTERED COLUMNSTORE INDEX\n)\nGO\n\n--GLAccount\nSET ANSI_NULLS ON\nGO\n\nSET QUOTED_IDENTIFIER ON\nGO\n\nCREATE TABLE [Briggs].[DIM_GLAccount]\n(\n\tGL_Account_SK\t[int] IDENTITY(1,1) NOT NULL,\n\tLedger_Account_ID\tINTEGER NULL,\n\tLedger_Account\tINTEGER NULL,\n\tDescription\tVARCHAR2 (200) NULL,\n\tAccount_Category\tVARCHAR2 (200) NULL,\n\tAccount_Type\tVARCHAR2 (200) NULL,\n\tCreated_datetime\tdatetime NULL,\n\tCreated_by\tVARCHAR2 (200) NULL,\n\tModified_datetime\tdatetime NULL,\n\tModified_by\tVARCHAR2 (200) NULL,\n\tStart_datetime\tdatetime NULL,\n\tEnd_datetime\tdatetime NULL,\n\tis_Active\tCHAR (1) NULL\n)\nWITH\n(\n\tDISTRIBUTION = REPLICATE,\n\tCLUSTERED COLUMNSTORE INDEX\n)\nGO\n\n--TerritorySalesperson\nSET ANSI_NULLS ON\nGO\n\nSET QUOTED_IDENTIFIER ON\nGO\n\nCREATE TABLE [Briggs].[DIM_TerritorySalesperson]\n(\n\tTerritorySalesperson_SK\tIDENTITY(1,1) NOT NULL,\n\tTerritory_Salesperson_ID\tINTEGER NULL,\n\tTerritory_Salesperson_Branch\tVARCHAR2 (200) NULL,\n\tTerritorySalespersonDefBranch\tVARCHAR2 (200) NULL,\n\tTerritory_Salesperson_Division\tINTEGER NULL,\n\tTerritory_Salesperson_Plan\tVARCHAR2 (200) NULL,\n\tCreated_datetime\tdatetime NULL,\n\tCreated_by\tVARCHAR2 (200) NULL,\n\tModified_datetime\tdatetime NULL,\n\tModified_by\tVARCHAR2 (200) NULL,\n\tStart_datetime\tdatetime NULL,\n\tEnd_datetime\tdatetime NULL,\n\tis_Active\tCHAR (1) NULL\n)\nWITH\n(\n\tDISTRIBUTION = REPLICATE,\n\tCLUSTERED COLUMNSTORE INDEX\n)\nGO\n\n--Region\nSET ANSI_NULLS ON\nGO\n\nSET QUOTED_IDENTIFIER ON\nGO\n\nCREATE TABLE [Briggs].[DIM_Region]\n(\n\tRegion_SK\tIDENTITY(1,1) NOT NULL,\n\tRegion_Leader\tVARCHAR2 (200) NULL,\n\tBranch_Tech_Empl_Status\tVARCHAR2 (200) NULL,\n\tCreated_datetime\tdatetime NULL,\n\tCreated_by\tVARCHAR2 (200) NULL,\n\tModified_datetime\tdatetime NULL,\n\tModified_by\tVARCHAR2 (200) NULL,\n\tStart_datetime\tdatetime NULL,\n\tEnd_datetime\tdatetime NULL,\n\tis_Active\tCHAR (1) NULL\n)\nWITH\n(\n\tDISTRIBUTION = REPLICATE,\n\tCLUSTERED COLUMNSTORE INDEX\n)\nGO\n\n--Employee\nSET ANSI_NULLS ON\nGO\n\nSET QUOTED_IDENTIFIER ON\nGO\n\nCREATE TABLE [Briggs].[DIM_Employee]\n(\n\tEmp_SK\tIDENTITY(1,1) NOT NULL,\n\tEmpID\tINTEGER NULL,\n\tEmployee_Name_LFM\tVARCHAR2 (200) NULL,\n\tEmployment_Status\tVARCHAR2 (200) NULL,\n\tJob_Category\tVARCHAR2 (200) NULL,\n\tJob\tVARCHAR2 (200) NULL,\n\tEmployee_Last_Hire_datetime\tdatetime NULL,\n\tEmployee_Days_Employed\tINTEGER NULL,\n\tRoster_End_Month\tVARCHAR2 (200) NULL,\n\tCreated_datetime\tdatetime NULL,\n\tCreated_by\tVARCHAR2 (200) NULL,\n\tModified_datetime\tdatetime NULL,\n\tModified_by\tVARCHAR2 (200) NULL,\n\tStart_datetime\tdatetime NULL,\n\tEnd_datetime\tdatetime NULL,\n\tis_Active\tCHAR (1) NULL\n)\nWITH\n(\n\tDISTRIBUTION = REPLICATE,\n\tCLUSTERED COLUMNSTORE INDEX\n)\nGO\n\n--Customer\nSET ANSI_NULLS ON\nGO\n\nSET QUOTED_IDENTIFIER ON\nGO\n\nCREATE TABLE [Briggs].[DIM_Customer]\n(\n\tCustomer_SK\tIDENTITY(1,1) NOT NULL,\n\tCustomer_ID\tINTEGER NULL,\n\tCustomer_Name\tVARCHAR2 (200) NULL,\n\tCustomer\tVARCHAR2 (200) NULL,\n\tCustomer_Account_Type\tVARCHAR2 (200) NULL,\n\tdatetime_Account_Opened\tdatetime NULL,\n\tCustomer_Group\tVARCHAR2 (200) NULL,\n\tCollections_Agent\tVARCHAR2 (200) NULL,\n\tAccount_Hold_Type\tVARCHAR2 (200) NULL,\n\tPO_Required\tINTEGER NULL,\n\tCollection_Type_Description\tVARCHAR2 (200) NULL,\n\tCreated_datetime\tdatetime NULL,\n\tCreated_by\tVARCHAR2 (200) NULL,\n\tModified_datetime\tdatetime NULL,\n\tModified_by\tVARCHAR2 (200) NULL,\n\tStart_datetime\tdatetime NULL,\n\tEnd_datetime\tdatetime NULL,\n\tis_Active\tCHAR (1) NULL\n)\nWITH\n(\n\tDISTRIBUTION = REPLICATE,\n\tCLUSTERED COLUMNSTORE INDEX\n)\nGO\n\n--Department\nSET ANSI_NULLS ON\nGO\n\nSET QUOTED_IDENTIFIER ON\nGO\n\nCREATE TABLE [Briggs].[DIM_Department]\n(\n\tDepartment_SK\tIDENTITY(1,1) NOT NULL,\n\tDepartment_ID\tINTEGER NULL,\n\tDepartment\tVARCHAR2 (200) NULL,\n\tPrimary_Function\tVARCHAR2 (200) NULL,\n\tSecondary_Function\tVARCHAR2 (200) NULL,\n\tDepartment_Head\tVARCHAR2 (200) NULL,\n\tCreated_datetime\tdatetime NULL,\n\tCreated_by\tVARCHAR2 (200) NULL,\n\tModified_datetime\tdatetime NULL,\n\tModified_by\tVARCHAR2 (200) NULL,\n\tStart_datetime\tdatetime NULL,\n\tEnd_datetime\tdatetime NULL,\n\tis_Active\tCHAR (1) NULL\n)\nWITH\n(\n\tDISTRIBUTION = REPLICATE,\n\tCLUSTERED COLUMNSTORE INDEX\n)\nGO\n\n--Branch\nSET ANSI_NULLS ON\nGO\n\nSET QUOTED_IDENTIFIER ON\nGO\n\nCREATE TABLE [Briggs].[DIM_Branch]\n(\n\tBranch_SK\tIDENTITY(1,1) NOT NULL,\n\tBranchID\tINTEGER NULL,\n\tBranch\tVARCHAR2 (200) NULL,\n\tAddress\tVARCHAR2 (255) NULL,\n\tStreet\tVARCHAR2 (200) NULL,\n\tCity\tVARCHAR2 (200) NULL,\n\tState\tVARCHAR2 (200) NULL,\n\tZip_Code\tVARCHAR2 (200) NULL,\n\tCreated_datetime\tdatetime NULL,\n\tCreated_by\tVARCHAR2 (200) NULL,\n\tModified_datetime\tdatetime NULL,\n\tModified_by\tVARCHAR2 (200) NULL,\n\tStart_datetime\tdatetime NULL,\n\tEnd_datetime\tdatetime NULL,\n\tis_Active\tCHAR (1) NULL\n)\nWITH\n(\n\tDISTRIBUTION = REPLICATE,\n\tCLUSTERED COLUMNSTORE INDEX\n)\nGO\n\n--Supervisor\nSET ANSI_NULLS ON\nGO\n\nSET QUOTED_IDENTIFIER ON\nGO\n\nCREATE TABLE [Briggs].[DIM_Supervisor]\n(\n\tSupervisor_SK\tIDENTITY(1,1) NOT NULL,\n\tSupervisor_Employee_ID\tINTEGER NULL,\n\tSupervisor_Name_LFM\tVARCHAR2 (200) NULL,\n\tSupervisor_Job_Category\tVARCHAR2 (200) NULL,\n\tSupervisor_Job\tVARCHAR2 (200) NULL,\n\tSupervisor_Last_Hire_datetime\tdatetime NULL,\n\tSupervisor_Days_Employed\tINTEGER NULL,\n\tCreated_datetime\tdatetime NULL,\n\tCreated_by\tVARCHAR2 (200) NULL,\n\tModified_datetime\tdatetime NULL,\n\tModified_by\tVARCHAR2 (200) NULL,\n\tStart_datetime\tdatetime NULL,\n\tEnd_datetime\tdatetime NULL,\n\tis_Active\tCHAR (1) NULL\n)\nWITH\n(\n\tDISTRIBUTION = REPLICATE,\n\tCLUSTERED COLUMNSTORE INDEX\n)\nGO\n\n--AssignedSalesperson\nSET ANSI_NULLS ON\nGO\n\nSET QUOTED_IDENTIFIER ON\nGO\n\nCREATE TABLE [Briggs].[DIM_AssignedSalesperson]\n(\n\tAssignedSalesperson_SK\tIDENTITY(1,1) NOT NULL,\n\tAssignedSalesperson_ID\tINTEGER NULL,\n\tAssignedSalespersonRosterBrch\tVARCHAR2 (200) NULL,\n\tAssignedSalespersonTerrDefBr\tVARCHAR2 (200) NULL,\n\tAssignedSalespersonTerrBrch\tVARCHAR2 (200) NULL,\n\tAssignedSalespersonEmplStatus\tINTEGER NULL,\n\tCreated_datetime\tdatetime NULL,\n\tCreated_by\tVARCHAR2 (200) NULL,\n\tModified_datetime\tdatetime NULL,\n\tModified_by\tVARCHAR2 (200) NULL,\n\tStart_datetime\tdatetime NULL,\n\tEnd_datetime\tdatetime NULL,\n\tis_Active\tCHAR (1) NULL\n)\nWITH\n(\n\tDISTRIBUTION = REPLICATE,\n\tCLUSTERED COLUMNSTORE INDEX\n)\nGO\n\n--Worker\nSET ANSI_NULLS ON\nGO\n\nSET QUOTED_IDENTIFIER ON\nGO\n\nCREATE TABLE [Briggs].[DIM_Worker]\n(\n\tWorker_SK\tIDENTITY(1,1) NOT NULL,\n\tWorkerID\tINTEGER NULL,\n\tWorkerName\tVARCHAR2 (200) NULL,\n\tUsername\tVARCHAR2 (200) NULL,\n\tJob\tVARCHAR2 (200) NULL,\n\tBranch\tINTEGER NULL,\n\tDepartment\tINTEGER NULL,\n\tCreated_datetime\tdatetime NULL,\n\tCreated_by\tVARCHAR2 (200) NULL,\n\tModified_datetime\tdatetime NULL,\n\tModified_by\tVARCHAR2 (200) NULL,\n\tStart_datetime\tdatetime NULL,\n\tEnd_datetime\tdatetime NULL,\n\tis_Active\tCHAR (1) NULL\n)\nWITH\n(\n\tDISTRIBUTION = REPLICATE,\n\tCLUSTERED COLUMNSTORE INDEX\n)\nGO",
					"metadata": {
						"language": "sql"
					},
					"currentConnection": {
						"databaseName": "master",
						"poolName": "Built-in"
					},
					"resultLimit": 5000
				},
				"type": "SqlQuery"
			},
			"dependsOn": []
		},
		{
			"name": "[concat(parameters('workspaceName'), '/DimAnalysisforAR')]",
			"type": "Microsoft.Synapse/workspaces/sqlscripts",
			"apiVersion": "2019-06-01-preview",
			"properties": {
				"content": {
					"query": "--Department\n--1. Department_ID\n select [OMOPERATINGUNITNUMBER] from [Briggs_MST].[OMDepartmentView_ext]\n--2. Department\nselect [NAME] from [Briggs_MST].[OMDepartmentView_ext]\n--3. Primary_Function \t\nselect\n\t\tcase\n\t\t\twhen o.OMOPERATINGUNITNUMBER like '2%' and o.OMOPERATINGUNITNUMBER <> '28' then 'Operations'\n\t\t\twhen o.OMOPERATINGUNITNUMBER like '3%' or o.OMOPERATINGUNITNUMBER = '28' then 'Sales'\n\t\t\twhen o.OMOPERATINGUNITNUMBER like '8%' then 'Support'\n\t\t\telse 'Unknown'\n\t\tend 'Primary_Function' \nfrom [Briggs_MST].[OMDepartmentView_ext]\n--4. Secondary_Function\nselect\n\t  case\n\t\t\twhen o.OMOPERATINGUNITNUMBER  = '24' then 'Sales'\n\t\t\twhen o.OMOPERATINGUNITNUMBER  = '28' then 'Operations'\n\t\t\twhen o.OMOPERATINGUNITNUMBER = '32' then 'Support'\n\t\t\twhen o.OMOPERATINGUNITNUMBER like '2%' then 'Operations'\n\t\t\twhen o.OMOPERATINGUNITNUMBER like '3%' then 'Sales'\n\t\t\twhen o.OMOPERATINGUNITNUMBER like '8%' then 'Support'\n\t\t\telse 'Unknown'\n\t  end 'Secondary_Function' \nfrom [Briggs_MST].[OMDepartmentView_ext]\n--5.Department_Head\nselect NAME from [Briggs_MST].[DIRPartyTable_ext]\n\n--Customer\n--1. Customer_ID\nselect accountnum from [Briggs_MST].[CustTable_ext]\n--2. Customer_Name\nselect name from [Briggs_MST].[DIRPartyTable_ext]\n--3. Customer\nselect (ct.accountnum + ' - ' + dir.name) from [Briggs_MST].[CustTable_ext], [Briggs_MST].[DIRPartyTable_ext]\n--4. Customer_Account_Type\nselect\n\tcase \n\t\twhen ct.INVOICEACCOUNT = '' then 'Bill-to'\n\t\twhen ct.INVOICEACCOUNT <> '' then 'Ship-to'\n\t\telse null \n\tend 'Customer_Account_Type' \nfrom [Briggs_MST].[CustTable_ext]\n--5. Date_Account_Opened\nselect isnull(cast([DATE_OPENED] as date),cast(ct.CREATEDDATETIME as date)) from [Briggs_MST].[CustTable_ext]\n--6. Customer_Group\nselect NAME from [Briggs_MST].[CustGroup_ext]\n--7. Collections_Agent\nselect\nrtrim(ltrim(case\n\twhen ccg.DESCRIPTION like 'TAA%' then  ccg.DESCRIPTION\n\telse isnull(substring(ccg.DESCRIPTION,charindex('-',ccg.DESCRIPTION)+1,len(ccg.DESCRIPTION)),'NO REP')\nEND)) \nfrom [Briggs_MST].[XAP_CreditCustomerGroups_ext]\n--8. Account_Hold_Type\nselect \n\tcase \n\t\twhen ct.blocked = 0 then 'None'\n\t\twhen ct.blocked = 3 then 'Payment'\n\t\twhen ct.blocked = 20 then 'Stopped'\n\t\twhen ct.blocked = 2 then 'All'  \n\t\telse 'None'\n\tend 'Account_Hold_Type'\nfrom [Briggs_MST].[CustTable_ext]\n--9. PO_Required\nselect \n\tcase when ct.POREQUIRED = 1 then 'Yes' else 'No' \n\tend 'PO_Required'\nfrom [Briggs_MST].[CustTable_ext]\n--10. Collection_Type_Description\nselect isnull(BCT.DESCRIPTION,'Unknown') 'Collection_Type_Description' \nfrom from [Briggs_MST].[BRGCollectionType_ext]\n\n--Worker\n--1.WorkerID\nselect hcm.PERSONNELNUMBER 'Worker_ID' from [Briggs_MST].[HCMWorker_ext]\n--2. Worker_Name\nselect dir.NAME 'Worker_Name' from [Briggs_MST].[DIRPartyTable_ext]\n--3. Username\nselect isnull(du.USER_,'NoUser') 'Username' from [Briggs_MST].[DirPersonUser_ext]\n--4. Job\nselect e.Job from [BriggsAX].[RosterEmployee_ext]\n--5. Department\nselect Department from [BriggsAX].[RosterEmployee_ext]\n--6.Branch\nselect Branch from [BriggsAX].[RosterEmployee_ext]\n\n--dim_Branch\n--1. BranchID\nselect br.[VALUE] 'Branch_ID' from [Briggs_MST].[DefaultDimensionView_ext]\n--2. Branch\nselect dir.[NAME] 'Branch' from [Briggs_MST].[DIRPartyTable_ext]\n--3. Address\nselect ISNULL(ISNULL(p_addr.ADDRESS,pc.ADDRESS),'Unknown') 'Address' from [Briggs_MST].[LogisticsPostalAddress_ext]\n--4. Street\nselect ISNULL(ISNULL(p_addr.STREET,pc.STREET),'Unknown') 'Street' from [Briggs_MST].[LogisticsPostalAddress_ext]\n--5. City\nselect ISNULL(ISNULL(p_addr.CITY,pc.CITY),'Unknown') 'City' from [Briggs_MST].[LogisticsPostalAddress_ext]\n--6. State\nselect ISNULL(ISNULL(p_addr.STATE,pc.STATE),'Unknown') 'State' from [Briggs_MST].[LogisticsPostalAddress_ext]\n--7. Zip_code\nselect ISNULL(CAST(ISNULL(p_addr.ZIPCODE,pc.ZIPCODE) AS VARCHAR(20)),'Unknown') 'Zip_Code' from [Briggs_MST].[LogisticsPostalAddress_ext]\n\n--dim_WorkCenter\n--1. Work_Center_ID\nselect WC.WRKCTRID 'Work_Center_ID' from [Briggs_MST].[WrkCtrTable_ext]\n--2. Work_Center_Name\nselect WC.NAME 'Work_Center_Name' from [Briggs_MST].[WrkCtrTable_ext]\n--3. Work_Center_Type\nselect\n\tCASE\n\t\tWHEN WC.WRKCTRTYPE = 2 THEN 'Vendor'\n\t\twhen wc.WRKCTRTYPE = 5 then 'Group'\n\t\twhen wc.WRKCTRTYPE = 1 and hcm.PERSONNELNUMBER is not null then 'Individual Employee'\n\t\twhen wc.WRKCTRTYPE = 1 then 'Individual Non-Employee'\n\t\telse 'Unknown'\n\tend 'Work_Center_Type'\nfrom [Briggs_MST].[WrkCtrTable_ext]\n--4.Work_Center_Group\nselect\n\tCASE\n\t\tWHEN WC.WRKCTRTYPE = 5 THEN 'NA'\n\t\twhen WG.WRKCTRID IS NULL then 'Unknown'\n\t\telse WG.WRKCTRID\n\tend 'Work_Center_Group'\nfrom [Briggs_MST].[WrkCtrResourceGroup_ext]\n--5.is_WOrker\nselect\n\tCASE \n\t\tWHEN WC.WRKCTRTYPE IN(2,5) THEN 'No'\n\t\twhen wc.WRKCTRTYPE = 1 and hcm.PERSONNELNUMBER is not null then 'Yes'\n\t\tWHEN wc.WRKCTRTYPE = 1 and HCM.PERSONNELNUMBER IS NULL THEN 'No'\n\t\telse 'Unknown'\n\tend 'is_Worker'\nfrom [Briggs_MST].[WrkCtrTable_ext]\n--6.WOrker_ID\nselect\n\tCASE \n\t\tWHEN WC.WRKCTRTYPE IN(2,5) THEN 'NA'\n\t\twhen wc.WRKCTRTYPE = 1 and hcm.PERSONNELNUMBER is not null then hcm.PERSONNELNUMBER\n\t\tWHEN wc.WRKCTRTYPE = 1 and HCM.PERSONNELNUMBER IS NULL THEN 'NA'\n\t\telse 'Unknown'\n\tend 'Worker_ID'\nfrom [Briggs_MST].[WrkCtrTable_ext]\n--7.Worker_Name\nselect\n\tCASE \n\t\tWHEN WC.WRKCTRTYPE IN(2,5) THEN 'NA'\n\t\twhen wc.WRKCTRTYPE = 1 and hcm.PERSONNELNUMBER is not null then DIR.NAME\n\t\tWHEN wc.WRKCTRTYPE = 1 and HCM.PERSONNELNUMBER IS NULL THEN 'NA'\n\t\telse 'Unknown'\n\tend 'Worker_Name'\nfrom [Briggs_MST].[WrkCtrTable_ext]\n--8.Worker_Team\nselect\n\tCASE \n\t\tWHEN WC.WRKCTRTYPE IN(2,5) THEN 'NA'\n\t\twhen wc.WRKCTRTYPE = 1 and hcm.PERSONNELNUMBER is not null then isnull(replace(la.languagecodeid,'TEAM','Team'),'Unknown')\n\t\tWHEN wc.WRKCTRTYPE = 1 and HCM.PERSONNELNUMBER IS NULL THEN 'NA'\n\t\telse 'Unknown'\n\tend 'Worker_Team'\nfrom [Briggs_MST].[WrkCtrTable_ext]\n\n--Warehouse\n--1. Warehouse SK\nselect a.RECID 'SK_Warehouse_BIGINT' from [Briggs_MST].[InventLocation_ext]\n--2. Warehouse_ID\nselect a.INVENTLOCATIONID 'Warehouse_ID' from [Briggs_MST].[InventLocation_ext]\n--3. Warehouse\nselect\n\tcase \n\t\twhen a.INVENTSITEID = 'PARTS' then 'Parts - '\n\t\twhen a.INVENTSITEID = 'EQUIPMENT' then 'Equipment - '\n\tend\n\t\t+\n\t\tbr.NAME \n\t'Warehouse'\nfrom [Briggs_MST].[InventLocation_ext]\n--4.Site\nselect a.INVENTSITEID 'Site' from [Briggs_MST].[InventLocation_ext]\n--5. Transaction_Status\nselect\n\tcase \n\t\twhen isnull(sls_wip.[Open],0) + isnull(svc_wip.[Open],0) = 0 then 'Inactive'\n\t\telse 'Active'\n\tend 'Transaction_Status'\nfrom sls_wip\n(select st.INVENTLOCATIONID,count(*) 'Open'\nfrom briggs_mst.dbo.SALESTABLE st\nwhere st.SALESSTATUS = 2\ngroup by st.INVENTLOCATIONID)\n--6. Address\nselect isnull(isnull(e.ADDRESS,p.ADDRESS),'Unknown Address') 'Address' from e_addr\n(e_addr\nas(\nselect \n--distinct\n il.INVENTLOCATIONID\n,STREET\n,ZIPCODE\n,CITY\n,STATE\n,ADDRESS\nfrom [Briggs_MST].[InventLocation_ext] il\nleft join [Briggs_MST].[InventLocationLogisticsLocationPrimary_ext] a on il.recid = a.INVENTLOCATION\nleft join [Briggs_MST].[LogisticsPostalAddressView_ext] lv on lv.LOCATION = a.LOCATION and lv.VALIDTO >= getdate()\nwhere il.INVENTLOCATIONID like 'E%')\n--7. Street\nselect isnull(isnull(e.STREET,p.street),'Unknown Address') 'Street' from e_addr\n--8.City\nselect isnull(isnull(e.CITY,p.CITY),'Unknown Address') 'City' from e_addr\n--9.State\nselect isnull(isnull(e.STATE,p.STATE),'Unknown Address') 'State' from e_addr\n--10. Zip_code\nselect isnull(isnull(e.ZIPCODE,p.ZIPCODE),'Unknown Address') 'Zip_Code' from e_addr\n--11. Transit_ID\nselect a.INVENTLOCATIONIDTRANSIT 'Transit_ID' from [Briggs_MST].[InventLocation_ext]\n\n--DIM_Region\n--1.Region\nselect m.MEMO 'Region' from [Briggs_MST].[DIRPartyMemo_ext]\n--2.Region_Leader\nselect\n\tcase \n\t\twhen dir_ldr.[NAME] is null or dir_ldr.[NAME] = '' then 'Inactive Branch' \n\t\telse dir_ldr.[NAME]\n\tend 'Region_Leader'\nfrom [Briggs_MST].[DIRPartyTable_ext]\n--3. Branch_Tech_Empl_Status\nselect\n\tcase \n\t\twhen isnull(es.employees,0) = 0 then 'Inactive'\n\t\telse 'Active'\n\tend 'Branch_Tech_Empl_Status'\nfrom tech_status\n(tech_status\nas(\n\nselect \nbranch\n,count(*) 'Employees'\n\nfrom briggsax.dbo.roster_employee e\nwhere e.file_date = (select max(file_date) from briggsax.dbo.roster_employee)\nand e.Status = 'Active'\nand e.Position_Ledger_Code = '600010'\ngroup by branch)\n\n--Territory Salesperson\n--1. SK_Territory_Salesperson\nselect cs.RECID 'SK_Territory_Salesperson_BIGINT' from [BriggsAX].[CommissionsSalesPeople_ext]\n--2. Territory_Salesperson_ID\nselect cs.territory 'Territory_Salesperson_ID' from [BriggsAX].[CommissionsSalesPeople_ext]\n--3. Territory_Salesperson_Branch\nselect db.Branch 'Territory_Salesperson_Branch' from [Briggs_MST].[DIRPartyTable_ext]\n--4. Territory_Salesperson_Default_Branch\nselect isnull(db2.Branch,'Unknown') 'Territory_Salesperson_Default_Branch' from [Briggs_MST].[DIRPartyTable_ext]\n--5. Territory_Salesperson_Division\nselect cs.division 'Territory_Salesperson_Division' from [BriggsAX].[CommissionsSalesPeople_ext]\n--6. Plan\nselect cs.[type] 'Territory_Salesperson_Plan' from [BriggsAX].[CommissionsSalesPeople_ext]\n\n--Dim_Calltypes\n--1. SK_Call_Type\nselect tt.recid 'SK_Call_Type_BIGINT' from [Briggs_MST].[XAP_SVCCallTable_ext]\n,\nselect tt.CALLTYPEID 'Call_Type_ID' from [Briggs_MST].[XAP_SVCCallTable_ext]\n,\nselect tl.CALLSTATUSID 'Call_Status_ID' from [Briggs_MST].[XAP_SVCCallTypeLine_ext]\n,\nselect tl.LINENUM 'Line_Num' from [Briggs_MST].[XAP_SVCCallTypeLine_ext]\n\n--GL_Account\n--1.\nselect m.RECID 'SK_Ledger_Account_BIGINT' from [Briggs_MST].[MainAccount_ext]\n,\nselect m.MAINACCOUNTID 'Ledger_Account_ID' from [Briggs_MST].[MainAccount_ext]\n,\nselect m.NAME 'Ledger_Account' from [Briggs_MST].[MainAccount_ext]\n,\nselect mc.DESCRIPTION 'Description' from [Briggs_MST].[MainAccountCategory_ext]\n,\nselect mc.ACCOUNTCATEGORY 'Account_Category' from [Briggs_MST].[MainAccountCategory_ext]\n,\nselect mc.ACCOUNTTYPE 'Account_Type' from [Briggs_MST].[MainAccountCategory_ext]\n\n--Dim_Emp\n--1. SK_Employee\nSELECT cast(e.employee_id as bigint) 'SK_Employee_BIGINT' from [BriggsAX].[RosterEmployee_ext]\n,\nselect e.Employee_ID 'Employee_ID' from [BriggsAX].[RosterEmployee_ext]\n,\nselect e.Employee_Name 'Name_LFM' from [BriggsAX].[RosterEmployee_ext]\n,\nselect \n\tcase\n\t\twhen e.[Status] like 'Term%' then 'Terminated'\n\t\twhen e.[Status] like 'Inact%' then 'Inactive'\n\t\telse e.[Status]\n\tend 'Employment_Status'\nfrom [BriggsAX].[RosterEmployee_ext]\n,\nselect jj.CategoryDescription 'Job_Category' from [BriggsHR].[JobCategory_ext]\n,\nselect e.[Job] 'Job' from [BriggsAX].[RosterEmployee_ext]\n,\nselect e.Last_Hire_Date 'Last_Hire_Date' from [BriggsAX].[RosterEmployee_ext]\n\n\n--Supervisor\nselect isnull(m.Employee_Name,'Unknown') 'Supervisor_Name_LFM' from [BriggsAX].[RosterEmployee_ext]\n,\nselect isnull(dbm.Branch,'Unknown') 'Supervisor_Branch' from [Briggs_MST].[DIRPartyTable_ext]\n,\nselect isnull(ddm.[Department],'Unknown') 'Supervisor_Department' from [Briggs_MST].[OMDepartmentView_ext]\n,\nselect isnull(jjm.CategoryDescription,'Unknown') 'Supervisor_Job_Category' from [BriggsHR].[JobCategory_ext]\n,\nselect isnull(m.[Job],'Unknown') 'Supervisor_Job' from [BriggsAX].[RosterEmployee_ext]\n,\nselect isnull(m.Last_Hire_Date,'1900-01-01') 'Supervisor_Last_Hire_Date' from [BriggsAX].[RosterEmployee_ext]\n,\nselect cast(e.[File_Date] as date) 'Roster_Valid_To' from [BriggsAX].[RosterEmployee_ext]\n\n--dim_AssignedSalesPerson\n--1.\nselect isnull(sp.Salesperson_Name_AX,'Unassigned') 'Assigned_Salesperson' from [BriggsAX].[CommissionsSalesPeople_ext]\n,\nselect isnull(sp.Salesperson_Branch_Roster,'Unassigned') 'Assigned_Salesperson_Roster_Branch' from [Briggs_MST].[DIRPartyTable_ext]\n,\nselect isnull(sp.Territory_Salesperson_Default_Branch,'Unassigned') 'Assigned_Salesperson_Terr_Default_Branch' from [Briggs_MST].[DIRPartyTable_ext]\n,\nselect isnull(sp.Territory_Salesperson_Branch,'Unassigned') 'Assigned_Salesperson_Terr_Branch' from [Briggs_MST].[DIRPartyTable_ext]\n,\nselect\n\tcase\n\t\twhen sp.Salesperson_Worker_ID_AX like 'SLS%' then 'NA'\n\t\telse isnull(sp.Salesperson_Department_Roster,'Unassigned')\n\tend 'Assigned_Salesperson_Empl_Status'\nfrom [BriggsAX].[RosterEmployee_ext]",
					"metadata": {
						"language": "sql"
					},
					"currentConnection": {
						"databaseName": "master",
						"poolName": "Built-in"
					},
					"resultLimit": 5000
				},
				"type": "SqlQuery"
			},
			"dependsOn": []
		},
		{
			"name": "[concat(parameters('workspaceName'), '/RDL_Queries')]",
			"type": "Microsoft.Synapse/workspaces/sqlscripts",
			"apiVersion": "2019-06-01-preview",
			"properties": {
				"content": {
					"query": "--Batch Service Call Summary\n--Report\nSELECT  svc.SVCCALLID, \n\t\tsvc.INVENTLOCATIONID, \n\t\tsvc.INVOICEACCOUNTNAME AS [INVOICE NAME], \n\t\tsvc.CUSTNAME, \n\t\tsvc.CUSTACCOUNT,\n                                svc.Subject,\n\t\tsvcType.CALLSTATUSID, \n        svcTypeTable.CALLTYPEID, \n\t\tsvc.CREATEDBY, \n\t\tsvcReason.REASONCODE, \n\t\tsvcReason.DESCRIPTION, \n        svc.CREATEDDATETIME,\n\t\tsvc.WRKCTRID 'PERSONNELNUMBER',\n\t\tdir.name,\n\t\teq.equipmentid,\n\t\teq.INVENTSERIALID,\n\t\tmake.MANUFACTURERID,\n\t\tmodel.TYPEID,\n\t\tsvcRep.Incident,\n\t\teqUsage.SMULAST,\n\t\tctShipTo.MEMO 'ShipToMemo',\n\t\tlpa.ADDRESS,\n\t\tsvc.CONTACTPERSONNAME\n\t\t,svc.IVRNumber\n\t\t,svc.PONumber\n\t\t,eqTech.CUSTEQUIPMENTNUMBER\n\t\t,svc.WENNSOFTID\nFROM dbo.XAP_SVCCALLTABLE svc \nLEFT JOIN dbo.XAP_SVCCALLREASONCODES svcReason ON svc.CALLREASONCODE = svcReason.RECID \nLEFT JOIN dbo.XAP_SVCCALLTYPETABLE svcTypeTable ON svc.CALLTYPEID = svcTypeTable.RECID \nLEFT JOIN dbo.XAP_SVCCALLTYPELINE svcType ON svc.CALLSTATUS = svcType.RECID\nLEFT join HCMWORKER wrker on svc.WRKCTRID = wrker.PERSONNELNUMBER\nLEFT join DIRPARTYTABLE dir on wrker.PERSON = dir.RECID\nLEFT join INVENTLOCATION il on il.INVENTLOCATIONID = svc.INVENTLOCATIONID\nLEFT join DEFAULTDIMENSIONVIEW ddv on ddv.DEFAULTDIMENSION = il.DEFAULTDIMENSION and ddv.DIMENSIONATTRIBUTEID = 5637145333\nleft join xap_equipmenttable eq on eq.recid = svc.equipmentid\nleft join XAP_EQUIPMENTTECHNICALINFO eqTech on eq.RECID = eqTech.EQUIPMENT\nleft join XAP_MACHINEMANUFACTURER make on eq.MACHINEMANUFACTURER = make.RECID\nleft join XAP_MACHINETYPE model on eq.MACHINETYPE= model.RECID\nleft join XAP_SVCREPORTINGTABLE svcRep on svcRep.RECID = svc.REPORTINGTABLEREFERENCE\nleft join XAP_EQUIPMENTUSAGETABLE eqUsage on eq.RECID = eqUsage.EQUIPMENT\nleft join CUSTTABLE ctShipTo on ctShipTo.ACCOUNTNUM = svc.CUSTACCOUNT\nleft join DIRPARTYLOCATION dirp on dirp.PARTY = ctShipTo.PARTY and dirp.ISPRIMARY = 1\nleft join LOGISTICSPOSTALADDRESS lpa on lpa.LOCATION = svc.DELIVERYADDRESS and lpa.VALIDTO > getdate()\nwhere SVCCALLID in (@svccallid)\n--Pending commission by Salesperson V2\n--Dataset1\nSELECT a.*\n  FROM [BriggsAX].[dbo].[Briggs_CommissionDailyDW_Unpaid] a\n  where exists (SELECT salesmancode  FROM [BriggsAX].[dbo].[eqa_User_AllUsers] b  \n\t\twhere networkalias = replace(@uid,'BRIGGSEQUIPMENT\\','')\n\t\tand a.[territory] = b.salesmancode)\n\t\t\n--Commission summary by Salesperson\n--Report\nSELECT *\n  FROM [BriggsAX].[dbo].[Briggs_CommissionDailyDW] a\n  where exists (SELECT salesmancode  FROM [BriggsAX].[dbo].[eqa_User_AllUsers] b  \n\t\twhere username = replace(@uid,'BRIGGSEQUIPMENT\\','')\n\t\tand a.[territory] = b.salesmancode)\n\t\tand RIGHT('0'+CAST(MONTH(a.invoicedate) AS VARCHAR) + '/' + CAST(YEAR(a.invoicedate) AS VARCHAR),7) =@Date\n\t\tand a.salesplan <> '14'\n\n\n--paramUsername\nselect replace(@uid,'BRIGGSEQUIPMENT\\','')\n\n--ParamSalespersonLookup\nSELECT * FROM [BriggsAX].[dbo].[eqa_User_AllUsers] b  where username = replace(@uid,'BRIGGSEQUIPMENT\\','')\n\n--ParamDateSelect\nSELECT distinct MONTH(INVOICEDATE)'month',YEAR(INVOICEDATE) 'year', RIGHT('0'+CAST(MONTH(INVOICEDATE) AS VARCHAR) + '/' + CAST(YEAR(INVOICEDATE) AS VARCHAR),7) 'monthyear'\n  FROM [BriggsAX].[dbo].[Briggs_CommissionDailyDW] a\n  order BY 2 DESC,1 DESC\n  \n--ParamCurrentMonth\nselect RIGHT('0'+CAST(MONTH(getdate()) AS VARCHAR) + '/' + CAST(YEAR(getdate()) AS VARCHAR),7) 'monthyear'\n\n--Commission Summary by Salesperson V2\n--Report\nSELECT a.*\n  FROM [BriggsAX].[dbo].[Briggs_CommissionDailyDW_PayComOnPay] a\n  where exists (SELECT salesmancode  FROM [BriggsAX].[dbo].[eqa_User_AllUsers] b  \n\t\twhere networkalias = \n\t\t\t(case when \n\t\t\treplace(@uid,'BRIGGSEQUIPMENT\\','') = 'nrountree' then 'mrountree'\n\t\t\telse replace(@uid,'BRIGGSEQUIPMENT\\','')\n\t\t\tend)\n\t\tand a.[territory] = b.salesmancode)\n\t\tand (Case when cast(RIGHT(@Date,4) as smallint) >=2021 then\n\t\t\tRIGHT('0'+CAST(MONTH(a.[LastSettleDate]) AS VARCHAR) + '/' + CAST(YEAR(a.[LastSettleDate]) AS VARCHAR),7) \n\t\tElse \n\t\t\tRIGHT('0'+CAST(MONTH(a.[InvoiceDate]) AS VARCHAR) + '/' + CAST(YEAR(a.[InvoiceDate]) AS VARCHAR),7)\n\t\tEnd) = @Date\n\t\tand a.salesplan <> '14'\n\nUNION ALL\n\nSELECT c.* \n\n  FROM [BriggsAX].[dbo].[Briggs_CommissionDW] c\n  where exists (SELECT salesmancode  FROM [BriggsAX].[dbo].[eqa_User_AllUsers] d  \n\t\twhere networkalias = \n\t\t\t(case when \n\t\t\treplace(@uid,'BRIGGSEQUIPMENT\\','') = 'nrountree' then 'mrountree'\n\t\t\telse replace(@uid,'BRIGGSEQUIPMENT\\','')\n\t\t\tend)\n\t\tand c.[territory] = d.salesmancode)\n\t\tand (Case when cast(RIGHT(@Date,4) as smallint) >=2021 then\n\t\t\tRIGHT('0'+CAST(MONTH(c.[LastSettleDate]) AS VARCHAR) + '/' + CAST(YEAR(c.[LastSettleDate]) AS VARCHAR),7) \n\t\tElse \n\t\t\tRIGHT('0'+CAST(MONTH(c.[InvoiceDate]) AS VARCHAR) + '/' + CAST(YEAR(c.[InvoiceDate]) AS VARCHAR),7)\n\t\tEnd) = @Date\n\t\tand c.salesplan <> '14'\n\t\t\n--ParamUsername\nselect replace(@uid,'BRIGGSEQUIPMENT\\','')\n\n--ParamSalespersonLookup\nSELECT * FROM [BriggsAX].[dbo].[eqa_User_AllUsers] b  where username = replace(@uid,'BRIGGSEQUIPMENT\\','')\n\n--ParamDateSelect\nselect distinct c.*\n\nfrom(\n\nSELECT distinct MONTH(INVOICEDATE)'month',YEAR(INVOICEDATE) 'year', RIGHT('0'+CAST(MONTH(INVOICEDATE) AS VARCHAR) + '/' + CAST(YEAR(INVOICEDATE) AS VARCHAR),7) 'monthyear'\n  FROM [BriggsAX].[dbo].[Briggs_CommissionDailyDW_PayComOnPay] a\n\n\nUNION ALL\n\nSELECT distinct MONTH(INVOICEDATE)'month',YEAR(INVOICEDATE) 'year', RIGHT('0'+CAST(MONTH(INVOICEDATE) AS VARCHAR) + '/' + CAST(YEAR(INVOICEDATE) AS VARCHAR),7) 'monthyear'\n  FROM [BriggsAX].[dbo].[Briggs_CommissionDW] a\n) as c\n\n  order BY 2 DESC,1 DESC\n  \n--ParamCurrentMonth\n  select RIGHT('0'+CAST(MONTH(getdate()) AS VARCHAR) + '/' + CAST(YEAR(getdate()) AS VARCHAR),7) 'monthyear'\n  \n--Commission Summary by Salesperson v2 Manager\n--Report\nSELECT a.*, 'DailyPCOP'\n  FROM [BriggsAX].[dbo].[Briggs_CommissionDailyDW_PayComOnPay] a\n  where \n\t\t (Case when cast(RIGHT(@Date,4) as smallint) >=2021 then\n\t\t\tRIGHT('0'+CAST(MONTH(a.[LastSettleDate]) AS VARCHAR) + '/' + CAST(YEAR(a.[LastSettleDate]) AS VARCHAR),7) \n\t\tElse \n\t\t\tRIGHT('0'+CAST(MONTH(a.[InvoiceDate]) AS VARCHAR) + '/' + CAST(YEAR(a.[InvoiceDate]) AS VARCHAR),7)\n\t\tEnd) = @Date\n\t\tand a.salesplan <> '14'\n\t\tand a.SalesPerson1 in (@salesperson)\n\nUNION ALL\n\nSELECT b.* , 'CommsDW'\n\n\tFROM [BriggsAX].[dbo].[Briggs_CommissionDW] b\n\twhere \n\t\t(Case when cast(RIGHT(@Date,4) as smallint) >=2021 then\n\t\t\tRIGHT('0'+CAST(MONTH(b.[LastSettleDate]) AS VARCHAR) + '/' + CAST(YEAR(b.[LastSettleDate]) AS VARCHAR),7) \n\t\tElse \n\t\t\tRIGHT('0'+CAST(MONTH(b.[InvoiceDate]) AS VARCHAR) + '/' + CAST(YEAR(b.[InvoiceDate]) AS VARCHAR),7)\n\t\tEnd) = @Date\n\t\tand b.salesplan <> '14'\n\t\tand b.SalesPerson1 in (@salesperson)\n\t\t\n--ParamUsername\nselect replace(@uid,'BRIGGSEQUIPMENT\\','')\n\n--ParamSalespersonLookup\nSELECT * FROM [BriggsAX].[dbo].[eqa_User_AllUsers] b  where username = replace(@uid,'BRIGGSEQUIPMENT\\','')\n\n--ParamDateSelct\nselect distinct c.*\n\nfrom(\n\nSELECT distinct MONTH(INVOICEDATE)'month',YEAR(INVOICEDATE) 'year', RIGHT('0'+CAST(MONTH(INVOICEDATE) AS VARCHAR) + '/' + CAST(YEAR(INVOICEDATE) AS VARCHAR),7) 'monthyear'\n  FROM [BriggsAX].[dbo].[Briggs_CommissionDailyDW_PayComOnPay] a\n\n\nUNION ALL\n\nSELECT distinct MONTH(INVOICEDATE)'month',YEAR(INVOICEDATE) 'year', RIGHT('0'+CAST(MONTH(INVOICEDATE) AS VARCHAR) + '/' + CAST(YEAR(INVOICEDATE) AS VARCHAR),7) 'monthyear'\n  FROM [BriggsAX].[dbo].[Briggs_CommissionDW] a\n) as c\n\n  order BY 2 DESC,1 DESC\n  \n--ParamCurrentMonth\n  select RIGHT('0'+CAST(MONTH(getdate()) AS VARCHAR) + '/' + CAST(YEAR(getdate()) AS VARCHAR),7) 'monthyear'\n  \n --salesperson\n SELECT distinct*\n  FROM\n\t(select distinct SalesPerson1  \n\t\tfrom  [BriggsAX].[dbo].[Briggs_CommissionDailyDW_PayComOnPay] a\n\t\tWHERE\t\t (Case when cast(RIGHT(@Date,4) as smallint) >=2021 then\n\t\t\tRIGHT('0'+CAST(MONTH(a.[LastSettleDate]) AS VARCHAR) + '/' + CAST(YEAR(a.[LastSettleDate]) AS VARCHAR),7) \n\t\tElse \n\t\t\tRIGHT('0'+CAST(MONTH(a.[InvoiceDate]) AS VARCHAR) + '/' + CAST(YEAR(a.[InvoiceDate]) AS VARCHAR),7)\n\t\tEnd) = @Date\n\t\tAND a.SalesPerson1 <> ''\n\t\tand a.branch in (@Branch)\nunion all \n\nselect distinct SalesPerson1 from [BriggsAX].[dbo].[Briggs_CommissionDW] b\nWHERE\t\t (Case when cast(RIGHT(@Date,4) as smallint) >=2021 then\n\t\t\tRIGHT('0'+CAST(MONTH(b.[LastSettleDate]) AS VARCHAR) + '/' + CAST(YEAR(b.[LastSettleDate]) AS VARCHAR),7) \n\t\tElse \n\t\t\tRIGHT('0'+CAST(MONTH(b.[InvoiceDate]) AS VARCHAR) + '/' + CAST(YEAR(b.[InvoiceDate]) AS VARCHAR),7)\n\t\tEnd) = @Date\n\t\tAND b.SalesPerson1 <> ''\n\t\tand b.branch in (@Branch)) as c\norder by 1\n\n--ParamBranch\nSELECT distinct*\n  FROM\n\t(select distinct branch\n\t\tfrom  [BriggsAX].[dbo].[Briggs_CommissionDailyDW_PayComOnPay] a\n\t\tWHERE\t\t (Case when cast(RIGHT(@Date,4) as smallint) >=2021 then\n\t\t\tRIGHT('0'+CAST(MONTH(a.[LastSettleDate]) AS VARCHAR) + '/' + CAST(YEAR(a.[LastSettleDate]) AS VARCHAR),7) \n\t\tElse \n\t\t\tRIGHT('0'+CAST(MONTH(a.[InvoiceDate]) AS VARCHAR) + '/' + CAST(YEAR(a.[InvoiceDate]) AS VARCHAR),7)\n\t\tEnd) = @Date\n\t\tAND a.branch <> ''\nunion all \n\nselect distinct branch from [BriggsAX].[dbo].[Briggs_CommissionDW] b\n\t\tWHERE\t\t (Case when cast(RIGHT(@Date,4) as smallint) >=2021 then\n\t\t\tRIGHT('0'+CAST(MONTH(b.[LastSettleDate]) AS VARCHAR) + '/' + CAST(YEAR(b.[LastSettleDate]) AS VARCHAR),7) \n\t\tElse \n\t\t\tRIGHT('0'+CAST(MONTH(b.[InvoiceDate]) AS VARCHAR) + '/' + CAST(YEAR(b.[InvoiceDate]) AS VARCHAR),7)\n\t\tEnd) = @Date\n\t\tAND b.branch <> '') as c\norder by 1\n\n--Current Inventory\n--TS\nselect * from AAAImportStamp\n\n--Report\nselect * from [BriggsAX].[dbo].[cache_BriggsCurrentInventory]\nwhere [FleetType] in (@fleettype)\nand isnull([BelongsTo],'') in (@belongsto)\nand  isnull([Warehhouse],'') in (@warehouse)\nand PhysicalStatus <> 'Sold'\nand PhysicalStatus in (@physicalstatus)\nand agrementstatus in (@agreementstatus)\nand Model in (@model)\norder by [BelongsTo],FleetType,itemid\n\n--ParamBranch\nwith all_br\nas(\n\nSELECT distinct DISPLAYVALUE,DISPLAYVALUE_Value\n  FROM [BriggsAX].[dbo].[Branch_Equipment]\nunion\n\nSELECT distinct DISPLAYVALUE, DISPLAYVALUE_Value\n  FROM [BriggsAX].[dbo].[Branch_Parts]\n)\n\nselect *\nfrom all_br\norder by [Displayvalue]\n\n--ParamsFleetType\nselect * from FleetTypes where BATCHTEMPLATEID in ('Used','Used Rental','Rental','Lease','New','Like Kind Exchange','Used lease')\n\n--ParamMakes\nselect a.MANUFACTURERID,a.RECID from XAP_MACHINEMANUFACTURER a\nwhere exists (select * from XAP_EQUIPMENTTABLE b where a.RECID = b.MACHINEMANUFACTURER)\norder by 1\n\n--ParamModel\nselect a.TYPEID,a.RECID\nfrom XAP_MACHINETYPE a\ninner join XAP_MACHINEMANUFACTURER b on a.MACHINEMANUFACTURER = b.recid\nwhere b.MANUFACTURERID in (@make)\norder by 1\n\n--ParamPhysicalStatus\nselect * from BRIGGS_PhysicalStatus order by 1\n\n--ParamAgreementStatus\nselect * from [dbo].[BRIGGS_AgreementStatus]  order by 1\n\n--Param_WH\nSELECT DISTINCT INVENTLOCATIONID\nFROM BRANCH_EQUIPMENT\nORDER BY INVENTLOCATIONID",
					"metadata": {
						"language": "sql"
					},
					"currentConnection": {
						"databaseName": "master",
						"poolName": "Built-in"
					},
					"resultLimit": 5000
				},
				"type": "SqlQuery"
			},
			"dependsOn": []
		},
		{
			"name": "[concat(parameters('workspaceName'), '/SQL script 1')]",
			"type": "Microsoft.Synapse/workspaces/sqlscripts",
			"apiVersion": "2019-06-01-preview",
			"properties": {
				"content": {
					"query": "DECLARE @json NVARCHAR(Max)\nDECLARE @countColumns int = 35;\nDECLARE @query VARCHAR(max) = 'CREATE  EXTERNAL TABLE _______ ( '\n\nSET @json = N'[{\"name\": \"VendorNumber\",\"type\": \"Int32\"},{\"name\": \"VendorName\",\"type\": \"String\"},{\"name\": \"Address1\",\"type\": \"String\"},{\"name\": \"Address2\",\"type\": \"String\"},{\"name\": \"CityState\",\"type\": \"String\"},{\"name\": \"Zip\",\"type\": \"String\"},{\"name\": \"Phone\",\"type\": \"String\"},{\"name\": \"Fax\",\"type\": \"String\"},{\"name\": \"WebAddress\",\"type\": \"String\"},{\"name\": \"Contact1\",\"type\": \"String\"},{\"name\": \"Contact1Phone\",\"type\": \"String\"},{\"name\": \"Contact1Email\",\"type\": \"String\"},{\"name\": \"Contact2\",\"type\": \"String\"},{\"name\": \"Contact2Phone\",\"type\": \"String\"},{\"name\": \"Contact2Email\",\"type\": \"String\"},{\"name\": \"AccountNumber\",\"type\": \"String\"},{\"name\": \"Terms\",\"type\": \"String\"},{\"name\": \"MinimumOrder\",\"type\": \"Decimal\"},{\"name\": \"YearToDate\",\"type\": \"Decimal\"},{\"name\": \"LifeToDate\",\"type\": \"Decimal\"},{\"name\": \"LastYear\",\"type\": \"Decimal\"},{\"name\": \"Products\",\"type\": \"String\"},{\"name\": \"Inactive\",\"type\": \"Boolean\"},{\"name\": \"Notes\",\"type\": \"String\"},{\"name\": \"SubrentalVendor\",\"type\": \"Boolean\"},{\"name\": \"GLLink\",\"type\": \"String\"},{\"name\": \"PaymentMethod\",\"type\": \"Int32\"},{\"name\": \"POApprovalOverride\",\"type\": \"Decimal\"},{\"name\": \"CurrencyNumber\",\"type\": \"Int32\"},{\"name\": \"Language\",\"type\": \"Int32\"},{\"name\": \"POPrintout\",\"type\": \"String\"},{\"name\": \"TaxCode\",\"type\": \"Int32\"},{\"name\": \"AccountingVendorId\",\"type\": \"Int32\"},{\"name\": \"TermDays\",\"type\": \"Int32\"},{\"name\": \"CountryCode\",\"type\": \"Int32\"}]'\n\nDECLARE @i int = 0\nDECLARE @row varchar(5)\nDECLARE @colName varchar(100)\nDECLARE @dataType VARCHAR(100)\nDECLARE @loopQuery VARCHAR(max)\nDECLARE @name VARCHAR(20) = '$.name'\nDECLARE @type VARCHAR(20) = '$.type'\n\nWHILE @i < @countColumns\nBEGIN\n    SET @i = @i + 1;\n\n    SET @row = concat('$[', @i ,']')\n    \n    select \n        @colName = name, \n        @dataType = CASE\n                WHEN type in ('Int32', 'Int64')  THEN 'INT'\n                WHEN type = 'String' THEN 'VARCHAR(MAX)'\n                WHEN type = 'Boolean' THEN 'BIT'\n                ELSE type\n                 \n            END\n\n    from openjson(@JSON, @row )\n    with (\n        name varchar(100) '$.name',\n        type varchar(100) '$.type'\n    )\n    \n    SET @query = @query + ' ' + @colName + ' ' + @dataType + ', '\n    --PRINT concat('@colName ', @colName, ' @dataType ', @dataType)\n\nEND\n\nSET @query = LEFT(@query , LEN(@query) - 1)\nSET @query = @query + ');'\nprint(@query)",
					"metadata": {
						"language": "sql"
					},
					"currentConnection": {
						"databaseName": "master",
						"poolName": "Built-in"
					},
					"resultLimit": 5000
				},
				"type": "SqlQuery"
			},
			"dependsOn": []
		},
		{
			"name": "[concat(parameters('workspaceName'), '/briggsbetamdw')]",
			"type": "Microsoft.Synapse/workspaces/sqlPools",
			"apiVersion": "2019-06-01-preview",
			"properties": {
				"collation": "SQL_Latin1_General_CP1_CI_AS",
				"maxSizeBytes": 263882790666240,
				"annotations": []
			},
			"dependsOn": [],
			"location": "westus"
		}
	]
}